function e(){e=function(){return t};var t={},i=Object.prototype,r=i.hasOwnProperty,n=Object.defineProperty||function(e,t,i){e[t]=i.value},o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,i){return e[t]=i}}function h(e,t,i,r){var o=Object.create((t&&t.prototype instanceof f?t:f).prototype),s=new x(r||[]);return n(o,"_invoke",{value:E(e,i,s)}),o}function u(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var d={};function f(){}function v(){}function p(){}var y={};l(y,s,function(){return this});var m=Object.getPrototypeOf,b=m&&m(m(S([])));b&&b!==i&&r.call(b,s)&&(y=b);var g=p.prototype=f.prototype=Object.create(y);function w(e){["next","throw","return"].forEach(function(t){l(e,t,function(e){return this._invoke(t,e)})})}function P(e,t){function i(n,o,s,a){var c=u(e[n],e,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==typeof h&&r.call(h,"__await")?t.resolve(h.__await).then(function(e){i("next",e,s,a)},function(e){i("throw",e,s,a)}):t.resolve(h).then(function(e){l.value=e,s(l)},function(e){return i("throw",e,s,a)})}a(c.arg)}var o;n(this,"_invoke",{value:function(e,r){function n(){return new t(function(t,n){i(e,r,t,n)})}return o=o?o.then(n,n):n()}})}function E(e,t,i){var r="suspendedStart";return function(n,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===n)throw o;return{value:void 0,done:!0}}for(i.method=n,i.arg=o;;){var s=i.delegate;if(s){var a=T(s,i);if(a){if(a===d)continue;return a}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===r)throw r="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r="executing";var c=u(e,t,i);if("normal"===c.type){if(r=i.done?"completed":"suspendedYield",c.arg===d)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(r="completed",i.method="throw",i.arg=c.arg)}}}function T(e,t){var i=t.method,r=e.iterator[i];if(void 0===r)return t.delegate=null,"throw"===i&&e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method)||"return"!==i&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+i+"' method")),d;var n=u(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,d;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function S(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,n=function t(){for(;++i<e.length;)if(r.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:M}}function M(){return{value:void 0,done:!0}}return v.prototype=p,n(g,"constructor",{value:p,configurable:!0}),n(p,"constructor",{value:v,configurable:!0}),v.displayName=l(p,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,l(e,c,"GeneratorFunction")),e.prototype=Object.create(g),e},t.awrap=function(e){return{__await:e}},w(P.prototype),l(P.prototype,a,function(){return this}),t.AsyncIterator=P,t.async=function(e,i,r,n,o){void 0===o&&(o=Promise);var s=new P(h(e,i,r,n),o);return t.isGeneratorFunction(i)?s:s.next().then(function(e){return e.done?e.value:s.next()})},w(g),l(g,c,"Generator"),l(g,s,function(){return this}),l(g,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),i=[];for(var r in t)i.push(r);return i.reverse(),function e(){for(;i.length;){var r=i.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=S,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(I),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(i,r){return s.type="throw",s.arg=e,t.next=i,r&&(t.method="next",t.arg=void 0),!!r}for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var a=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&r.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),I(i),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var r=i.completion;if("throw"===r.type){var n=r.arg;I(i)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:S(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=void 0),d}},t}function t(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,"symbol"==typeof(n=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key))?n:String(n),r)}var n}function i(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,o(e,t)}function n(e){return n=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},n(e)}function o(e,t){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},o(e,t)}function s(e,t,i){return s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct.bind():function(e,t,i){var r=[null];r.push.apply(r,t);var n=new(Function.bind.apply(e,r));return i&&o(n,i.prototype),n},s.apply(null,arguments)}function a(e){var t="function"==typeof Map?new Map:void 0;return a=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return s(e,arguments,n(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),o(i,e)},a(e)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function h(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return l(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?l(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u=0;function d(e){return"__private_"+u+++"_"+e}function f(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var v=/*#__PURE__*/d("ievent"),p=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,v,{writable:!0,value:void 0}),f(this,v)[v]=e}var t=e.prototype;return t.subscribe=function(e){return f(this,v)[v].asEvent().subscribe(e)},t.dispatch=function(e,t){f(this,v)[v].dispatch(e,t)},t.sub=function(e){return f(this,v)[v].asEvent().sub(e)},t.unsubscribe=function(e){f(this,v)[v].asEvent().unsubscribe(e)},t.unsub=function(e){f(this,v)[v].asEvent().unsub(e)},t.one=function(e){return f(this,v)[v].asEvent().one(e)},t.has=function(e){return f(this,v)[v].asEvent().has(e)},t.clear=function(){f(this,v)[v].asEvent().clear()},i(e,[{key:"count",get:function(){return f(this,v)[v].count}}]),e}();function y(e){var t={exports:{}};return e(t,t.exports),t.exports}var m=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DispatcherWrapper=void 0,t.DispatcherWrapper=class{constructor(e){this._subscribe=t=>e.subscribe(t),this._unsubscribe=t=>e.unsubscribe(t),this._one=t=>e.one(t),this._has=t=>e.has(t),this._clear=()=>e.clear(),this._count=()=>e.count,this._onSubscriptionChange=()=>e.onSubscriptionChange}get onSubscriptionChange(){return this._onSubscriptionChange()}get count(){return this._count()}subscribe(e){return this._subscribe(e)}sub(e){return this.subscribe(e)}unsubscribe(e){this._unsubscribe(e)}unsub(e){this.unsubscribe(e)}one(e){return this._one(e)}has(e){return this._has(e)}clear(){this._clear()}}}),b=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Subscription=void 0,t.Subscription=class{constructor(e,t){this.handler=e,this.isOnce=t,this.isExecuted=!1}execute(e,t,i){if(!this.isOnce||!this.isExecuted){this.isExecuted=!0;var r=this.handler;e?setTimeout(()=>{r.apply(t,i)},1):r.apply(t,i)}}}}),g=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventManagement=void 0,t.EventManagement=class{constructor(e){this.unsub=e,this.propagationStopped=!1}stopPropagation(){this.propagationStopped=!0}}}),w=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SubscriptionChangeEventDispatcher=t.DispatcherBase=void 0;class i{constructor(){this._subscriptions=new Array}get count(){return this._subscriptions.length}get onSubscriptionChange(){return null==this._onSubscriptionChange&&(this._onSubscriptionChange=new r),this._onSubscriptionChange.asEvent()}subscribe(e){return e&&(this._subscriptions.push(this.createSubscription(e,!1)),this.triggerSubscriptionChange()),()=>{this.unsubscribe(e)}}sub(e){return this.subscribe(e)}one(e){return e&&(this._subscriptions.push(this.createSubscription(e,!0)),this.triggerSubscriptionChange()),()=>{this.unsubscribe(e)}}has(e){return!!e&&this._subscriptions.some(t=>t.handler==e)}unsubscribe(e){if(!e)return;let t=!1;for(let i=0;i<this._subscriptions.length;i++)if(this._subscriptions[i].handler==e){this._subscriptions.splice(i,1),t=!0;break}t&&this.triggerSubscriptionChange()}unsub(e){this.unsubscribe(e)}_dispatch(e,t,i){for(let r of[...this._subscriptions]){let n=new g.EventManagement(()=>this.unsub(r.handler)),o=Array.prototype.slice.call(i);if(o.push(n),r.execute(e,t,o),this.cleanup(r),!e&&n.propagationStopped)return{propagationStopped:!0}}return e?null:{propagationStopped:!1}}createSubscription(e,t){return new b.Subscription(e,t)}cleanup(e){let t=!1;if(e.isOnce&&e.isExecuted){let i=this._subscriptions.indexOf(e);i>-1&&(this._subscriptions.splice(i,1),t=!0)}t&&this.triggerSubscriptionChange()}asEvent(){return null==this._wrap&&(this._wrap=new m.DispatcherWrapper(this)),this._wrap}clear(){0!=this._subscriptions.length&&(this._subscriptions.splice(0,this._subscriptions.length),this.triggerSubscriptionChange())}triggerSubscriptionChange(){null!=this._onSubscriptionChange&&this._onSubscriptionChange.dispatch(this.count)}}t.DispatcherBase=i;class r extends i{dispatch(e){this._dispatch(!1,this,arguments)}}t.SubscriptionChangeEventDispatcher=r}),P=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DispatchError=void 0;class i extends Error{constructor(e){super(e)}}t.DispatchError=i}),E=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventListBase=void 0,t.EventListBase=class{constructor(){this._events={}}get(e){let t=this._events[e];return t||(t=this.createDispatcher(),this._events[e]=t,t)}remove(e){delete this._events[e]}}}),T=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.HandlingBase=void 0,t.HandlingBase=class{constructor(e){this.events=e}one(e,t){this.events.get(e).one(t)}has(e,t){return this.events.get(e).has(t)}subscribe(e,t){this.events.get(e).subscribe(t)}sub(e,t){this.subscribe(e,t)}unsubscribe(e,t){this.events.get(e).unsubscribe(t)}unsub(e,t){this.unsubscribe(e,t)}}}),_=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSubscription=void 0,t.PromiseSubscription=class{constructor(e,t){this.handler=e,this.isOnce=t,this.isExecuted=!1}async execute(e,t,i){if(!this.isOnce||!this.isExecuted){this.isExecuted=!0;var r=this.handler;if(e)return void setTimeout(()=>{r.apply(t,i)},1);let n=r.apply(t,i);await n}}}}),I=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseDispatcherBase=void 0,t.PromiseDispatcherBase=class extends w.DispatcherBase{_dispatch(e,t,i){throw new P.DispatchError("_dispatch not supported. Use _dispatchAsPromise.")}createSubscription(e,t){return new _.PromiseSubscription(e,t)}async _dispatchAsPromise(e,t,i){for(let r of[...this._subscriptions]){let n=new g.EventManagement(()=>this.unsub(r.handler)),o=Array.prototype.slice.call(i);o.push(n);let s=r;if(await s.execute(e,t,o),this.cleanup(r),!e&&n.propagationStopped)return{propagationStopped:!0}}return e?null:{propagationStopped:!1}}}}),x=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SubscriptionChangeEventDispatcher=t.HandlingBase=t.PromiseDispatcherBase=t.PromiseSubscription=t.DispatchError=t.EventManagement=t.EventListBase=t.DispatcherWrapper=t.DispatcherBase=t.Subscription=void 0,Object.defineProperty(t,"DispatcherBase",{enumerable:!0,get:function(){return w.DispatcherBase}}),Object.defineProperty(t,"SubscriptionChangeEventDispatcher",{enumerable:!0,get:function(){return w.SubscriptionChangeEventDispatcher}}),Object.defineProperty(t,"DispatchError",{enumerable:!0,get:function(){return P.DispatchError}}),Object.defineProperty(t,"DispatcherWrapper",{enumerable:!0,get:function(){return m.DispatcherWrapper}}),Object.defineProperty(t,"EventListBase",{enumerable:!0,get:function(){return E.EventListBase}}),Object.defineProperty(t,"EventManagement",{enumerable:!0,get:function(){return g.EventManagement}}),Object.defineProperty(t,"HandlingBase",{enumerable:!0,get:function(){return T.HandlingBase}}),Object.defineProperty(t,"PromiseDispatcherBase",{enumerable:!0,get:function(){return I.PromiseDispatcherBase}}),Object.defineProperty(t,"PromiseSubscription",{enumerable:!0,get:function(){return _.PromiseSubscription}}),Object.defineProperty(t,"Subscription",{enumerable:!0,get:function(){return b.Subscription}})}),S=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventDispatcher=void 0,t.EventDispatcher=class extends x.DispatcherBase{constructor(){super()}dispatch(e,t){const i=this._dispatch(!1,this,arguments);if(null==i)throw new x.DispatchError("Got `null` back from dispatch.");return i}dispatchAsync(e,t){this._dispatch(!0,this,arguments)}asEvent(){return super.asEvent()}}}),M=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventList=void 0,t.EventList=class extends x.EventListBase{constructor(){super()}createDispatcher(){return new S.EventDispatcher}}}),O=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventHandlingBase=void 0,t.EventHandlingBase=class extends x.HandlingBase{constructor(){super(new M.EventList)}}}),j=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformEventList=void 0,t.NonUniformEventList=class{constructor(){this._events={}}get(e){if(this._events[e])return this._events[e];const t=this.createDispatcher();return this._events[e]=t,t}remove(e){delete this._events[e]}createDispatcher(){return new S.EventDispatcher}}}),R=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformEventList=t.EventList=t.EventHandlingBase=t.EventDispatcher=void 0,Object.defineProperty(t,"EventDispatcher",{enumerable:!0,get:function(){return S.EventDispatcher}}),Object.defineProperty(t,"EventHandlingBase",{enumerable:!0,get:function(){return O.EventHandlingBase}}),Object.defineProperty(t,"EventList",{enumerable:!0,get:function(){return M.EventList}}),Object.defineProperty(t,"NonUniformEventList",{enumerable:!0,get:function(){return j.NonUniformEventList}})}),D=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleEventDispatcher=void 0,t.SimpleEventDispatcher=class extends x.DispatcherBase{constructor(){super()}dispatch(e){const t=this._dispatch(!1,this,arguments);if(null==t)throw new x.DispatchError("Got `null` back from dispatch.");return t}dispatchAsync(e){this._dispatch(!0,this,arguments)}asEvent(){return super.asEvent()}}}),A=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleEventList=void 0,t.SimpleEventList=class extends x.EventListBase{constructor(){super()}createDispatcher(){return new D.SimpleEventDispatcher}}}),C=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleEventHandlingBase=void 0,t.SimpleEventHandlingBase=class extends x.HandlingBase{constructor(){super(new A.SimpleEventList)}}}),k=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformSimpleEventList=void 0,t.NonUniformSimpleEventList=class{constructor(){this._events={}}get(e){if(this._events[e])return this._events[e];const t=this.createDispatcher();return this._events[e]=t,t}remove(e){delete this._events[e]}createDispatcher(){return new D.SimpleEventDispatcher}}}),B=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformSimpleEventList=t.SimpleEventList=t.SimpleEventHandlingBase=t.SimpleEventDispatcher=void 0,Object.defineProperty(t,"SimpleEventDispatcher",{enumerable:!0,get:function(){return D.SimpleEventDispatcher}}),Object.defineProperty(t,"SimpleEventHandlingBase",{enumerable:!0,get:function(){return C.SimpleEventHandlingBase}}),Object.defineProperty(t,"NonUniformSimpleEventList",{enumerable:!0,get:function(){return k.NonUniformSimpleEventList}}),Object.defineProperty(t,"SimpleEventList",{enumerable:!0,get:function(){return A.SimpleEventList}})}),L=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SignalDispatcher=void 0,t.SignalDispatcher=class extends x.DispatcherBase{dispatch(){const e=this._dispatch(!1,this,arguments);if(null==e)throw new x.DispatchError("Got `null` back from dispatch.");return e}dispatchAsync(){this._dispatch(!0,this,arguments)}asEvent(){return super.asEvent()}}}),F=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SignalList=void 0,t.SignalList=class extends x.EventListBase{constructor(){super()}createDispatcher(){return new L.SignalDispatcher}}}),U=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SignalHandlingBase=void 0,t.SignalHandlingBase=class extends x.HandlingBase{constructor(){super(new F.SignalList)}}}),N=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SignalList=t.SignalHandlingBase=t.SignalDispatcher=void 0,Object.defineProperty(t,"SignalDispatcher",{enumerable:!0,get:function(){return L.SignalDispatcher}}),Object.defineProperty(t,"SignalHandlingBase",{enumerable:!0,get:function(){return U.SignalHandlingBase}}),Object.defineProperty(t,"SignalList",{enumerable:!0,get:function(){return F.SignalList}})}),V=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseEventDispatcher=void 0,t.PromiseEventDispatcher=class extends x.PromiseDispatcherBase{constructor(){super()}async dispatch(e,t){const i=await this._dispatchAsPromise(!1,this,arguments);if(null==i)throw new x.DispatchError("Got `null` back from dispatch.");return i}dispatchAsync(e,t){this._dispatchAsPromise(!0,this,arguments)}asEvent(){return super.asEvent()}}}),G=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseEventList=void 0,t.PromiseEventList=class extends x.EventListBase{constructor(){super()}createDispatcher(){return new V.PromiseEventDispatcher}}}),H=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseEventHandlingBase=void 0,t.PromiseEventHandlingBase=class extends x.HandlingBase{constructor(){super(new G.PromiseEventList)}}}),X=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformPromiseEventList=void 0,t.NonUniformPromiseEventList=class{constructor(){this._events={}}get(e){if(this._events[e])return this._events[e];const t=this.createDispatcher();return this._events[e]=t,t}remove(e){delete this._events[e]}createDispatcher(){return new V.PromiseEventDispatcher}}}),W=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformPromiseEventList=t.PromiseEventList=t.PromiseEventHandlingBase=t.PromiseEventDispatcher=void 0,Object.defineProperty(t,"PromiseEventDispatcher",{enumerable:!0,get:function(){return V.PromiseEventDispatcher}}),Object.defineProperty(t,"PromiseEventHandlingBase",{enumerable:!0,get:function(){return H.PromiseEventHandlingBase}}),Object.defineProperty(t,"PromiseEventList",{enumerable:!0,get:function(){return G.PromiseEventList}}),Object.defineProperty(t,"NonUniformPromiseEventList",{enumerable:!0,get:function(){return X.NonUniformPromiseEventList}})}),Y=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSignalDispatcher=void 0,t.PromiseSignalDispatcher=class extends x.PromiseDispatcherBase{constructor(){super()}async dispatch(){const e=await this._dispatchAsPromise(!1,this,arguments);if(null==e)throw new x.DispatchError("Got `null` back from dispatch.");return e}dispatchAsync(){this._dispatchAsPromise(!0,this,arguments)}asEvent(){return super.asEvent()}}}),K=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSignalList=void 0,t.PromiseSignalList=class extends x.EventListBase{constructor(){super()}createDispatcher(){return new Y.PromiseSignalDispatcher}}}),z=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSignalHandlingBase=void 0,t.PromiseSignalHandlingBase=class extends x.HandlingBase{constructor(){super(new K.PromiseSignalList)}}}),q=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSignalList=t.PromiseSignalHandlingBase=t.PromiseSignalDispatcher=void 0,Object.defineProperty(t,"PromiseSignalDispatcher",{enumerable:!0,get:function(){return Y.PromiseSignalDispatcher}}),Object.defineProperty(t,"PromiseSignalHandlingBase",{enumerable:!0,get:function(){return z.PromiseSignalHandlingBase}}),Object.defineProperty(t,"PromiseSignalList",{enumerable:!0,get:function(){return K.PromiseSignalList}})}),Z=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSimpleEventDispatcher=void 0,t.PromiseSimpleEventDispatcher=class extends x.PromiseDispatcherBase{constructor(){super()}async dispatch(e){const t=await this._dispatchAsPromise(!1,this,arguments);if(null==t)throw new x.DispatchError("Got `null` back from dispatch.");return t}dispatchAsync(e){this._dispatchAsPromise(!0,this,arguments)}asEvent(){return super.asEvent()}}}),Q=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformPromiseSimpleEventList=void 0,t.NonUniformPromiseSimpleEventList=class{constructor(){this._events={}}get(e){if(this._events[e])return this._events[e];const t=this.createDispatcher();return this._events[e]=t,t}remove(e){delete this._events[e]}createDispatcher(){return new Z.PromiseSimpleEventDispatcher}}}),J=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSimpleEventList=void 0,t.PromiseSimpleEventList=class extends x.EventListBase{constructor(){super()}createDispatcher(){return new Z.PromiseSimpleEventDispatcher}}}),$=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSimpleEventHandlingBase=void 0,t.PromiseSimpleEventHandlingBase=class extends x.HandlingBase{constructor(){super(new J.PromiseSimpleEventList)}}}),ee=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformPromiseSimpleEventList=t.PromiseSimpleEventList=t.PromiseSimpleEventHandlingBase=t.PromiseSimpleEventDispatcher=void 0,Object.defineProperty(t,"NonUniformPromiseSimpleEventList",{enumerable:!0,get:function(){return Q.NonUniformPromiseSimpleEventList}}),Object.defineProperty(t,"PromiseSimpleEventDispatcher",{enumerable:!0,get:function(){return Z.PromiseSimpleEventDispatcher}}),Object.defineProperty(t,"PromiseSimpleEventHandlingBase",{enumerable:!0,get:function(){return $.PromiseSimpleEventHandlingBase}}),Object.defineProperty(t,"PromiseSimpleEventList",{enumerable:!0,get:function(){return J.PromiseSimpleEventList}})}),te=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformPromiseSimpleEventList=t.PromiseSimpleEventList=t.PromiseSimpleEventHandlingBase=t.PromiseSimpleEventDispatcher=t.PromiseSignalList=t.PromiseSignalHandlingBase=t.PromiseSignalDispatcher=t.NonUniformPromiseEventList=t.PromiseEventList=t.PromiseEventHandlingBase=t.PromiseEventDispatcher=t.SignalList=t.SignalHandlingBase=t.SignalDispatcher=t.NonUniformSimpleEventList=t.SimpleEventList=t.SimpleEventHandlingBase=t.SimpleEventDispatcher=t.NonUniformEventList=t.EventList=t.EventHandlingBase=t.EventDispatcher=t.HandlingBase=t.PromiseDispatcherBase=t.PromiseSubscription=t.DispatchError=t.EventManagement=t.EventListBase=t.DispatcherWrapper=t.DispatcherBase=t.Subscription=void 0,Object.defineProperty(t,"Subscription",{enumerable:!0,get:function(){return x.Subscription}}),Object.defineProperty(t,"DispatcherBase",{enumerable:!0,get:function(){return x.DispatcherBase}}),Object.defineProperty(t,"DispatcherWrapper",{enumerable:!0,get:function(){return x.DispatcherWrapper}}),Object.defineProperty(t,"EventListBase",{enumerable:!0,get:function(){return x.EventListBase}}),Object.defineProperty(t,"EventManagement",{enumerable:!0,get:function(){return x.EventManagement}}),Object.defineProperty(t,"DispatchError",{enumerable:!0,get:function(){return x.DispatchError}}),Object.defineProperty(t,"PromiseSubscription",{enumerable:!0,get:function(){return x.PromiseSubscription}}),Object.defineProperty(t,"PromiseDispatcherBase",{enumerable:!0,get:function(){return x.PromiseDispatcherBase}}),Object.defineProperty(t,"HandlingBase",{enumerable:!0,get:function(){return x.HandlingBase}}),Object.defineProperty(t,"EventDispatcher",{enumerable:!0,get:function(){return R.EventDispatcher}}),Object.defineProperty(t,"EventHandlingBase",{enumerable:!0,get:function(){return R.EventHandlingBase}}),Object.defineProperty(t,"EventList",{enumerable:!0,get:function(){return R.EventList}}),Object.defineProperty(t,"NonUniformEventList",{enumerable:!0,get:function(){return R.NonUniformEventList}}),Object.defineProperty(t,"SimpleEventDispatcher",{enumerable:!0,get:function(){return B.SimpleEventDispatcher}}),Object.defineProperty(t,"SimpleEventHandlingBase",{enumerable:!0,get:function(){return B.SimpleEventHandlingBase}}),Object.defineProperty(t,"SimpleEventList",{enumerable:!0,get:function(){return B.SimpleEventList}}),Object.defineProperty(t,"NonUniformSimpleEventList",{enumerable:!0,get:function(){return B.NonUniformSimpleEventList}}),Object.defineProperty(t,"SignalDispatcher",{enumerable:!0,get:function(){return N.SignalDispatcher}}),Object.defineProperty(t,"SignalHandlingBase",{enumerable:!0,get:function(){return N.SignalHandlingBase}}),Object.defineProperty(t,"SignalList",{enumerable:!0,get:function(){return N.SignalList}}),Object.defineProperty(t,"PromiseEventDispatcher",{enumerable:!0,get:function(){return W.PromiseEventDispatcher}}),Object.defineProperty(t,"PromiseEventHandlingBase",{enumerable:!0,get:function(){return W.PromiseEventHandlingBase}}),Object.defineProperty(t,"PromiseEventList",{enumerable:!0,get:function(){return W.PromiseEventList}}),Object.defineProperty(t,"NonUniformPromiseEventList",{enumerable:!0,get:function(){return W.NonUniformPromiseEventList}}),Object.defineProperty(t,"PromiseSignalDispatcher",{enumerable:!0,get:function(){return q.PromiseSignalDispatcher}}),Object.defineProperty(t,"PromiseSignalHandlingBase",{enumerable:!0,get:function(){return q.PromiseSignalHandlingBase}}),Object.defineProperty(t,"PromiseSignalList",{enumerable:!0,get:function(){return q.PromiseSignalList}}),Object.defineProperty(t,"PromiseSimpleEventDispatcher",{enumerable:!0,get:function(){return ee.PromiseSimpleEventDispatcher}}),Object.defineProperty(t,"PromiseSimpleEventHandlingBase",{enumerable:!0,get:function(){return ee.PromiseSimpleEventHandlingBase}}),Object.defineProperty(t,"PromiseSimpleEventList",{enumerable:!0,get:function(){return ee.PromiseSimpleEventList}}),Object.defineProperty(t,"NonUniformPromiseSimpleEventList",{enumerable:!0,get:function(){return ee.NonUniformPromiseSimpleEventList}})}),ie=function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&i]+e[i>>8&255]+"-"+e[i>>16&15|64]+e[i>>24&255]+"-"+e[63&r|128]+e[r>>8&255]+"-"+e[r>>16&255]+e[r>>24&255]+e[255&n]+e[n>>8&255]+e[n>>16&255]+e[n>>24&255]}}(),re=/*#__PURE__*/d("owner"),ne=/*#__PURE__*/d("ownedComponents"),oe=/*#__PURE__*/d("prefixMessageWithID"),se=/*#__PURE__*/d("own"),ae=/*#__PURE__*/function(){function e(e,t){void 0===t&&(t={}),Object.defineProperty(this,se,{value:le}),Object.defineProperty(this,oe,{value:ce}),this.id=void 0,this.destroyed=void 0,this.dirty=void 0,Object.defineProperty(this,re,{writable:!0,value:void 0}),Object.defineProperty(this,ne,{writable:!0,value:void 0}),this.onDestroyed=void 0,f(this,re)[re]=e,this.id=t.id||ie(),this.destroyed=!1,f(this,ne)[ne]=null,this.dirty=!1,this.onDestroyed=new p(new te.EventDispatcher),e&&f(e,se)[se](this)}var t=e.prototype;return t.log=function(e){e="[LOG] "+f(this,oe)[oe](e),console.log(e)},t.warn=function(e){e="[WARN] "+f(this,oe)[oe](e),console.warn(e)},t.error=function(e){e="[ERROR] "+f(this,oe)[oe](e),console.error(e)},t.setDirty=function(){this.dirty||(this.dirty=!0)},t.cleanIfDirty=function(){this.dirty&&(this.dirty=!1,this.clean())},t.clean=function(){},t.destroy=function(){if(!this.destroyed){if(this.destroyed=!0,f(this,ne)[ne])for(var e in f(this,ne)[ne])f(this,ne)[ne].hasOwnProperty(e)&&(f(this,ne)[ne][e].destroy(),delete f(this,ne)[ne][e]);f(this,ne)[ne]=null,this.dirty=!1,this.onDestroyed.dispatch(this,null),this.onDestroyed.clear()}},e}();function ce(e){return" ["+this.constructor.name+' "'+this.id+'"]: '+e}function le(e){var t=this;f(this,ne)[ne]||(f(this,ne)[ne]={}),f(this,ne)[ne][e.id]||(f(this,ne)[ne][e.id]=e),e.onDestroyed.one(function(){delete f(t,ne)[ne][e.id]})}var he=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return r(t,e),t}(/*#__PURE__*/a(Error)),ue={__proto__:null,Component:ae,SDKError:he,EventEmitter:p},de=1e3,fe=1003,ve=1006,pe=1007,ye=1008,me=1009,be=1023,ge=33776,we=33777,Pe=33778,Ee=33779,Te=35840,_e=35841,Ie=35842,xe=35843,Se=36196,Me=37492,Oe=37496,je=37808,Re=37809,De=37810,Ae=37811,Ce=37812,ke=37813,Be=37814,Le=37815,Fe=37816,Ue=37817,Ne=37818,Ve=37819,Ge=37820,He=37821,Xe=36492,We=3e3,Ye=3001,Ke=2e4,ze=20001,qe=20002,Ze=20003,Qe=20004,Je=3e4,$e=4e5,et=5e5,tt=500001,it=500002,rt=500003,nt={__proto__:null,RepeatWrapping:de,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002,NearestFilter:fe,NearestMipMapNearestFilter:1004,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,NearestMipMapLinearFilter:1005,LinearFilter:ve,LinearMipmapNearestFilter:1007,LinearMipMapNearestFilter:pe,LinearMipmapLinearFilter:ye,LinearMipMapLinearFilter:1008,UnsignedByteType:me,ByteType:1010,ShortType:1011,UnsignedShortType:1012,IntType:1013,UnsignedIntType:1014,FloatType:1015,HalfFloatType:1016,UnsignedShort4444Type:1017,UnsignedShort5551Type:1018,UnsignedInt248Type:1020,AlphaFormat:1021,RGBFormat:1022,RGBAFormat:be,LuminanceFormat:1024,LuminanceAlphaFormat:1025,DepthFormat:1026,DepthStencilFormat:1027,RedFormat:1028,RedIntegerFormat:1029,RGFormat:1030,RGIntegerFormat:1031,RGBAIntegerFormat:1033,RGB_S3TC_DXT1_Format:ge,RGBA_S3TC_DXT1_Format:we,RGBA_S3TC_DXT3_Format:Pe,RGBA_S3TC_DXT5_Format:Ee,RGB_PVRTC_4BPPV1_Format:Te,RGB_PVRTC_2BPPV1_Format:_e,RGBA_PVRTC_4BPPV1_Format:Ie,RGBA_PVRTC_2BPPV1_Format:xe,RGB_ETC1_Format:Se,RGB_ETC2_Format:Me,RGBA_ETC2_EAC_Format:Oe,RGBA_ASTC_4x4_Format:je,RGBA_ASTC_5x4_Format:Re,RGBA_ASTC_5x5_Format:De,RGBA_ASTC_6x5_Format:Ae,RGBA_ASTC_6x6_Format:Ce,RGBA_ASTC_8x5_Format:ke,RGBA_ASTC_8x6_Format:Be,RGBA_ASTC_8x8_Format:Le,RGBA_ASTC_10x5_Format:Fe,RGBA_ASTC_10x6_Format:Ue,RGBA_ASTC_10x8_Format:Ne,RGBA_ASTC_10x10_Format:Ve,RGBA_ASTC_12x10_Format:Ge,RGBA_ASTC_12x12_Format:He,RGBA_BPTC_Format:Xe,LinearEncoding:We,sRGBEncoding:Ye,GIFMediaType:1e4,JPEGMediaType:10001,PNGMediaType:10002,PointsPrimitive:Ke,LinesPrimitive:ze,TrianglesPrimitive:qe,SolidPrimitive:Ze,SurfacePrimitive:Qe,QualityRender:Je,FastRender:300001,MetersUnit:$e,CentimetersUnit:400001,MillimetersUnit:400002,YardsUnit:400003,FeetUnit:400004,InchesUnit:400005,PerspectiveProjectionType:et,OrthoProjectionType:tt,FrustumProjectionType:it,CustomProjectionType:rt},ot=-Number.MAX_SAFE_INTEGER,st=Number.MAX_SAFE_INTEGER,at=.0174532925;function ct(e,t,i){return Math.max(t,Math.min(i,e))}function lt(e){return new Float64Array(e)}var ht={__proto__:null,MIN_DOUBLE:ot,MAX_DOUBLE:st,DEGTORAD:at,RADTODEG:57.295779513,clamp:ct,newFloatArray:lt},ut=Pt(),dt=wt(),ft=wt(),vt=wt(),pt=wt(),yt=wt(),mt=Pt();function bt(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function gt(e){return new Float64Array(e||2)}function wt(e){return new Float64Array(e||3)}function Pt(e){return new Float64Array(e||4)}function Et(e,t,i){return i||(i=e),i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i[3]=e[3]+t[3],i}function Tt(e,t,i){return i||(i=e),i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i}function _t(e,t,i){return i||(i=e),i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i}function It(e,t,i){return i||(i=e),i[0]=e[0]*t,i[1]=e[1]*t,i}function xt(e,t,i){return i||(i=e),i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i}function St(e,t,i){return i||(i=e),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i[3]=e[3]-t[3],i}function Mt(e,t,i){return i||(i=e),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i}function Ot(e,t,i){return i||(i=e),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i}function jt(){for(var e=[].slice.call(arguments),t=new Float32Array(e[0]),i=1;i<e.length;i++)t[0]+=e[i][0],t[1]+=e[i][1];return t[0]/=e.length,t[1]/=e.length,t}function Rt(e,t,i){return i||(i=t),i[0]=e/t[0],i[1]=e/t[1],i[2]=e/t[2],i}function Dt(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function At(e,t,i){i||(i=e);var r=e[0],n=e[1],o=e[2],s=t[0],a=t[1],c=t[2];return i[0]=n*c-o*a,i[1]=o*s-r*c,i[2]=r*a-n*s,i}function Ct(e){return Dt(e,e)}function kt(e){return Math.sqrt(Ct(e))}function Bt(e,t){return e[0]*t[0]+e[1]*t[1]}function Lt(e){return bt(e,e)}function Ft(e){return Bt(e,e)}function Ut(e){return Math.sqrt(Lt(e))}var Nt,Vt=(Nt=wt(),function(e,t){return Ut(Mt(e,t,Nt))});function Gt(e){return Math.sqrt(Ft(e))}function Ht(e,t,i,r,n,o){var s=o||wt(),a=(e-t)/(i-t);return s[0]=r[0]+a*(n[0]-r[0]),s[1]=r[1]+a*(n[1]-r[1]),s[2]=r[2]+a*(n[2]-r[2]),s}var Xt=function(){var e=gt();return function(t,i){return Gt(Ot(t,i,e))}}();function Wt(e,t){return Tt(e,1/kt(e),t)}function Yt(e,t){return _t(e,1/Ut(e),t)}var Kt=function(){var e=wt();return function(t,i){return e[0]=t[0],e[1]=t[1],e[2]=t[2],i[0]=Ut(e),e[0]=t[4],e[1]=t[5],e[2]=t[6],i[1]=Ut(e),e[0]=t[8],e[1]=t[9],e[2]=t[10],i[2]=Ut(e),i}}();function zt(e){return Math.round(1e5*e)/1e5}function qt(e){return new lt(e||9)}function Zt(e){return lt(e||16)}var Qt=Zt(),Jt=Zt();function $t(e,t,i,r,n){var o=[],s=[];return o[2]=i,s[2]=r,s[1]=o[2]*Math.tan(e/2),o[1]=-s[1],s[0]=s[1]*t,o[0]=-s[0],ei(o,s,n)}function ei(e,t,i){i||(i=Zt());var r=[e[0],e[1],e[2],0],n=[t[0],t[1],t[2],0];Et(n,r,Qt),St(n,r,Jt);var o=2*r[2],s=Jt[0],a=Jt[1],c=Jt[2];return i[0]=o/s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o/a,i[6]=0,i[7]=0,i[8]=Qt[0]/s,i[9]=Qt[1]/a,i[10]=-Qt[2]/c,i[11]=-1,i[12]=0,i[13]=0,i[14]=-o*n[2]/c,i[15]=0,i}function ti(e,t,i,r,n,o,s){s||(s=Zt());var a=t-e,c=r-i,l=o-n;return s[0]=2/a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2/c,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=-2/l,s[11]=0,s[12]=-(e+t)/a,s[13]=-(r+i)/c,s[14]=-(o+n)/l,s[15]=1,s}function ii(e,t,i,r,n,o,s){s||(s=Zt());var a=t-e,c=r-i,l=o-n;return s[0]=2*n/a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2*n/c,s[6]=0,s[7]=0,s[8]=(t+e)/a,s[9]=(r+i)/c,s[10]=-(o+n)/l,s[11]=-1,s[12]=0,s[13]=0,s[14]=-o*n*2/l,s[15]=0,s}function ri(e){return e||(e=Zt()),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ni(e){return e||(e=Zt()),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function oi(e,t,i){i||(i=Zt());var r,n,o,s,a,c,l=Wt([t[0],t[1],t[2],0],[]),h=Math.sin(e),u=Math.cos(e),d=1-u,f=l[0],v=l[1],p=l[2];return r=f*v,n=v*p,o=p*f,s=f*h,a=v*h,c=p*h,i[0]=d*f*f+u,i[1]=d*r+c,i[2]=d*o-a,i[3]=0,i[4]=d*r-c,i[5]=d*v*v+u,i[6]=d*n+s,i[7]=0,i[8]=d*o+a,i[9]=d*n-s,i[10]=d*p*p+u,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function si(e,t,i,r){r||(r=Zt());var n,o,s,a,c,l,h,u,d,f,v=e[0],p=e[1],y=e[2],m=i[0],b=i[1],g=i[2],w=t[0],P=t[1],E=t[2];return v===w&&p===P&&y===E?ri():(n=v-w,o=p-P,s=y-E,a=b*(s*=f=1/Math.sqrt(n*n+o*o+s*s))-g*(o*=f),c=g*(n*=f)-m*s,l=m*o-b*n,(f=Math.sqrt(a*a+c*c+l*l))?(a*=f=1/f,c*=f,l*=f):(a=0,c=0,l=0),h=o*l-s*c,u=s*a-n*l,d=n*c-o*a,(f=Math.sqrt(h*h+u*u+d*d))?(h*=f=1/f,u*=f,d*=f):(h=0,u=0,d=0),r[0]=a,r[1]=h,r[2]=n,r[3]=0,r[4]=c,r[5]=u,r[6]=o,r[7]=0,r[8]=l,r[9]=d,r[10]=s,r[11]=0,r[12]=-(a*v+c*p+l*y),r[13]=-(h*v+u*p+d*y),r[14]=-(n*v+o*p+s*y),r[15]=1,r)}function ai(e,t){t||(t=e);var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],c=e[6],l=e[7],h=e[8],u=e[9],d=e[10],f=e[11],v=e[12],p=e[13],y=e[14],m=e[15],b=i*a-r*s,g=i*c-n*s,w=i*l-o*s,P=r*c-n*a,E=r*l-o*a,T=n*l-o*c,_=h*p-u*v,I=h*y-d*v,x=h*m-f*v,S=u*y-d*p,M=u*m-f*p,O=d*m-f*y,j=1/(b*O-g*M+w*S+P*x-E*I+T*_);return t[0]=(a*O-c*M+l*S)*j,t[1]=(-r*O+n*M-o*S)*j,t[2]=(p*T-y*E+m*P)*j,t[3]=(-u*T+d*E-f*P)*j,t[4]=(-s*O+c*x-l*I)*j,t[5]=(i*O-n*x+o*I)*j,t[6]=(-v*T+y*w-m*g)*j,t[7]=(h*T-d*w+f*g)*j,t[8]=(s*M-a*x+l*_)*j,t[9]=(-i*M+r*x-o*_)*j,t[10]=(v*E-p*w+m*b)*j,t[11]=(-h*E+u*w-f*b)*j,t[12]=(-s*S+a*I-c*_)*j,t[13]=(i*S-r*I+n*_)*j,t[14]=(-v*P+p*g-y*b)*j,t[15]=(h*P-u*g+d*b)*j,t}function ci(e,t){var i=e[4],r=e[14],n=e[8],o=e[13],s=e[12],a=e[9];if(!t||e===t){var c=e[1],l=e[2],h=e[3],u=e[6],d=e[7],f=e[11];return e[1]=i,e[2]=n,e[3]=s,e[4]=c,e[6]=a,e[7]=o,e[8]=l,e[9]=u,e[11]=r,e[12]=h,e[13]=d,e[14]=f,e}return t[0]=e[0],t[1]=i,t[2]=n,t[3]=s,t[4]=e[1],t[5]=e[5],t[6]=a,t[7]=o,t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=r,t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t}function li(e,t,i){i||(i=e);var r=t[0],n=t[1],o=t[2],s=t[3];return i[0]=e[0]*r+e[4]*n+e[8]*o+e[12]*s,i[1]=e[1]*r+e[5]*n+e[9]*o+e[13]*s,i[2]=e[2]*r+e[6]*n+e[10]*o+e[14]*s,i[3]=e[3]*r+e[7]*n+e[11]*o+e[15]*s,i}function hi(e,t,i){i||(i=e);var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],c=e[5],l=e[6],h=e[7],u=e[8],d=e[9],f=e[10],v=e[11],p=e[12],y=e[13],m=e[14],b=e[15],g=t[0],w=t[1],P=t[2],E=t[3],T=t[4],_=t[5],I=t[6],x=t[7],S=t[8],M=t[9],O=t[10],j=t[11],R=t[12],D=t[13],A=t[14],C=t[15];return i[0]=g*r+w*a+P*u+E*p,i[1]=g*n+w*c+P*d+E*y,i[2]=g*o+w*l+P*f+E*m,i[3]=g*s+w*h+P*v+E*b,i[4]=T*r+_*a+I*u+x*p,i[5]=T*n+_*c+I*d+x*y,i[6]=T*o+_*l+I*f+x*m,i[7]=T*s+_*h+I*v+x*b,i[8]=S*r+M*a+O*u+j*p,i[9]=S*n+M*c+O*d+j*y,i[10]=S*o+M*l+O*f+j*m,i[11]=S*s+M*h+O*v+j*b,i[12]=R*r+D*a+A*u+C*p,i[13]=R*n+D*c+A*d+C*y,i[14]=R*o+D*l+A*f+C*m,i[15]=R*s+D*h+A*v+C*b,i}function ui(e,t,i){void 0===i&&(i=lt(9));var r=e[0],n=e[3],o=e[6],s=e[1],a=e[4],c=e[7],l=e[2],h=e[5],u=e[8],d=t[0],f=t[3],v=t[6],p=t[1],y=t[4],m=t[7],b=t[2],g=t[5],w=t[8];return i[0]=r*d+n*p+o*b,i[3]=r*f+n*y+o*g,i[6]=r*v+n*m+o*w,i[1]=s*d+a*p+c*b,i[4]=s*f+a*y+c*g,i[7]=s*v+a*m+c*w,i[2]=l*d+h*p+u*b,i[5]=l*f+h*y+u*g,i[8]=l*v+h*m+u*w,i}function di(e,t,i){i||(i=t);var r=t[0],n=t[1],o=t[2];return i[0]=e[0]*r+e[4]*n+e[8]*o+e[12],i[1]=e[1]*r+e[5]*n+e[9]*o+e[13],i[2]=e[2]*r+e[6]*n+e[10]*o+e[14],i}function fi(e,t,i){return i[0]=e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12]*t[3],i[1]=e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13]*t[3],i[2]=e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14]*t[3],i[3]=e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]*t[3],i}function vi(e,t,i){var r;i||(i=t);var n,o,s,a=t.length,c=e[0],l=e[1],h=e[2],u=e[3],d=e[4],f=e[5],v=e[6],p=e[7],y=e[8],m=e[9],b=e[10],g=e[11],w=e[12],P=e[13],E=e[14],T=e[15];for(r=0;r<a;r+=3)i[r+0]=c*(n=t[r+0])+d*(o=t[r+1])+y*(s=t[r+2])+w,i[r+1]=l*n+f*o+m*s+P,i[r+2]=h*n+v*o+b*s+E,i[r+3]=u*n+p*o+g*s+T;return i}function pi(e,t,i){var r=t[0],n=t[1],o=t[2];return(i=i||wt())[0]=e[0]*r+e[4]*n+e[8]*o,i[1]=e[1]*r+e[5]*n+e[9]*o,i[2]=e[2]*r+e[6]*n+e[10]*o,i}function yi(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3];return(i=i||Pt())[0]=e[0]*r+e[4]*n+e[8]*o+e[12]*s,i[1]=e[1]*r+e[5]*n+e[9]*o+e[13]*s,i[2]=e[2]*r+e[6]*n+e[10]*o+e[14]*s,i[3]=e[3]*r+e[7]*n+e[11]*o+e[15]*s,i}function mi(e,t){void 0===t&&(t=ri());var i=e[0],r=e[1],n=e[2];return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,t}function bi(e,t){return void 0===t&&(t=ri()),t[0]=e[0],t[5]=e[1],t[10]=e[2],t}function gi(e,t){return void 0===t&&(t=ni()),t[0]=e[0],t[4]=e[1],t}var wi,Pi=(wi=lt(3),function(e,t,i,r){return wi[0]=e,wi[1]=t,wi[2]=i,bi(wi,r)});function Ei(e,t,i,r){return void 0===r&&(r=Zt()),Bi(t,r),mi(i,r),_i(e,r),r}var Ti=function(){var e=wt(),t=Zt();return function(i,r,n,o){e[0]=i[0],e[1]=i[1],e[2]=i[2];var s=Ut(e);e[0]=i[4],e[1]=i[5],e[2]=i[6];var a=Ut(e);e[8]=i[8],e[9]=i[9],e[10]=i[10];var c=Ut(e);ji(i)<0&&(s=-s),r[0]=i[12],r[1]=i[13],r[2]=i[14],t.set(i);var l=1/s,h=1/a,u=1/c;t[0]*=l,t[1]*=l,t[2]*=l,t[4]*=h,t[5]*=h,t[6]*=h,t[8]*=u,t[9]*=u,t[10]*=u,ki(t,n),o[0]=s,o[1]=a,o[2]=c}}();function _i(e,t){return void 0===t&&(t=ri()),Ii(e[0],e[1],e[2],t)}function Ii(e,t,i,r){void 0===r&&(r=ri());var n=r[3];r[0]+=n*e,r[1]+=n*t,r[2]+=n*i;var o=r[7];r[4]+=o*e,r[5]+=o*t,r[6]+=o*i;var s=r[11];r[8]+=s*e,r[9]+=s*t,r[10]+=s*i;var a=r[15];return r[12]+=a*e,r[13]+=a*t,r[14]+=a*i,r}function xi(e,t,i){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=t[0],i[13]=t[1],i[14]=t[2],i[15]=e[15],i}function Si(e,t){var i=t||ri();return i[12]=e[0],i[13]=e[1],i[14]=e[2],i}function Mi(e,t){var i=t||ni();return i[6]=e[0],i[7]=e[1],i}var Oi=function(){var e=lt(3);return function(t,i,r,n){return e[0]=t,e[1]=i,e[2]=r,Si(e,n)}}();function ji(e){var t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],s=e[5],a=e[6],c=e[7],l=e[8],h=e[9],u=e[10],d=e[11],f=e[12],v=e[13],p=e[14],y=e[15];return f*h*a*n-l*v*a*n-f*s*u*n+o*v*u*n+l*s*p*n-o*h*p*n-f*h*r*c+l*v*r*c+f*i*u*c-t*v*u*c-l*i*p*c+t*h*p*c+f*s*r*d-o*v*r*d-f*i*a*d+t*v*a*d+o*i*p*d-t*s*p*d-l*s*r*y+o*h*r*y+l*i*a*y-t*h*a*y-o*i*u*y+t*s*u*y}function Ri(e,t,i){void 0===i&&(i=wt());var r=e[0],n=e[4],o=e[8],s=e[1],a=e[5],c=e[9],l=e[2],h=e[6],u=e[10];return"XYZ"===t?(i[1]=Math.asin(ct(o,-1,1)),Math.abs(o)<.99999?(i[0]=Math.atan2(-c,u),i[2]=Math.atan2(-n,r)):(i[0]=Math.atan2(h,a),i[2]=0)):"YXZ"===t?(i[0]=Math.asin(-ct(c,-1,1)),Math.abs(c)<.99999?(i[1]=Math.atan2(o,u),i[2]=Math.atan2(s,a)):(i[1]=Math.atan2(-l,r),i[2]=0)):"ZXY"===t?(i[0]=Math.asin(ct(h,-1,1)),Math.abs(h)<.99999?(i[1]=Math.atan2(-l,u),i[2]=Math.atan2(-n,a)):(i[1]=0,i[2]=Math.atan2(s,r))):"ZYX"===t?(i[1]=Math.asin(-ct(l,-1,1)),Math.abs(l)<.99999?(i[0]=Math.atan2(h,u),i[2]=Math.atan2(s,r)):(i[0]=0,i[2]=Math.atan2(-n,a))):"YZX"===t?(i[2]=Math.asin(ct(s,-1,1)),Math.abs(s)<.99999?(i[0]=Math.atan2(-c,a),i[1]=Math.atan2(-l,r)):(i[0]=0,i[1]=Math.atan2(o,u))):"XZY"===t&&(i[2]=Math.asin(-ct(n,-1,1)),Math.abs(n)<.99999?(i[0]=Math.atan2(h,a),i[1]=Math.atan2(o,r)):(i[0]=Math.atan2(-c,u),i[1]=0)),i}function Di(e,t,i,r,n,o){var s=o||Zt(),a=(e-t)/(i-t);return s[0]=r[0]+a*(n[0]-r[0]),s[1]=r[1]+a*(n[1]-r[1]),s[2]=r[2]+a*(n[2]-r[2]),s[3]=r[3]+a*(n[3]-r[3]),s[4]=r[4]+a*(n[4]-r[4]),s[5]=r[5]+a*(n[5]-r[5]),s[6]=r[6]+a*(n[6]-r[6]),s[7]=r[7]+a*(n[7]-r[7]),s[8]=r[8]+a*(n[8]-r[8]),s[9]=r[9]+a*(n[9]-r[9]),s[10]=r[10]+a*(n[10]-r[10]),s[11]=r[11]+a*(n[11]-r[11]),s[12]=r[12]+a*(n[12]-r[12]),s[13]=r[13]+a*(n[13]-r[13]),s[14]=r[14]+a*(n[14]-r[14]),s[15]=r[15]+a*(n[15]-r[15]),s}function Ai(e){return void 0===e&&(e=Pt()),e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Ci(e,t,i){void 0===i&&(i=Pt());var r=e[0]*at/2,n=e[1]*at/2,o=e[2]*at/2,s=Math.cos(r),a=Math.cos(n),c=Math.cos(o),l=Math.sin(r),h=Math.sin(n),u=Math.sin(o);return"XYZ"===t?(i[0]=l*a*c+s*h*u,i[1]=s*h*c-l*a*u,i[2]=s*a*u+l*h*c,i[3]=s*a*c-l*h*u):"YXZ"===t?(i[0]=l*a*c+s*h*u,i[1]=s*h*c-l*a*u,i[2]=s*a*u-l*h*c,i[3]=s*a*c+l*h*u):"ZXY"===t?(i[0]=l*a*c-s*h*u,i[1]=s*h*c+l*a*u,i[2]=s*a*u+l*h*c,i[3]=s*a*c-l*h*u):"ZYX"===t?(i[0]=l*a*c-s*h*u,i[1]=s*h*c+l*a*u,i[2]=s*a*u-l*h*c,i[3]=s*a*c+l*h*u):"YZX"===t?(i[0]=l*a*c+s*h*u,i[1]=s*h*c+l*a*u,i[2]=s*a*u-l*h*c,i[3]=s*a*c-l*h*u):"XZY"===t&&(i[0]=l*a*c-s*h*u,i[1]=s*h*c-l*a*u,i[2]=s*a*u+l*h*c,i[3]=s*a*c+l*h*u),i}function ki(e,t){void 0===t&&(t=Pt());var i,r=e[0],n=e[4],o=e[8],s=e[1],a=e[5],c=e[9],l=e[2],h=e[6],u=e[10],d=r+a+u;return d>0?(i=.5/Math.sqrt(d+1),t[3]=.25/i,t[0]=(h-c)*i,t[1]=(o-l)*i,t[2]=(s-n)*i):r>a&&r>u?(i=2*Math.sqrt(1+r-a-u),t[3]=(h-c)/i,t[0]=.25*i,t[1]=(n+s)/i,t[2]=(o+l)/i):a>u?(i=2*Math.sqrt(1+a-r-u),t[3]=(o-l)/i,t[0]=(n+s)/i,t[1]=.25*i,t[2]=(c+h)/i):(i=2*Math.sqrt(1+u-r-a),t[3]=(s-n)/i,t[0]=(o+l)/i,t[1]=(c+h)/i,t[2]=.25*i),t}function Bi(e,t){var i=e[0],r=e[1],n=e[2],o=e[3],s=i+i,a=r+r,c=n+n,l=i*s,h=i*a,u=i*c,d=r*a,f=r*c,v=n*c,p=o*s,y=o*a,m=o*c;return t[0]=1-(d+v),t[4]=h-m,t[8]=u+y,t[1]=h+m,t[5]=1-(l+v),t[9]=f-p,t[2]=u-y,t[6]=f+p,t[10]=1-(l+d),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Li(e,t){void 0===t&&(t=e);var i=kt([e[0],e[1],e[2],e[3]]);return t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i,t[3]=e[3]/i,t}function Fi(e,t){return void 0===t&&(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}var Ui={__proto__:null,dotVec3:bt,createVec2:gt,createVec3:wt,createVec4:Pt,negateVec3:function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},negateVec4:function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},addVec4:Et,addVec4Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t,i[3]=e[3]+t,i},mulVec4Scalar:Tt,mulVec3Scalar:_t,mulVec2Scalar:It,addVec3:xt,addVec3Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t,i},subVec4:St,compareVec3:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},subVec3:Mt,subVec2:Ot,geometricMeanVec2:jt,subVec4Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]-t,i[1]=e[1]-t,i[2]=e[2]-t,i[3]=e[3]-t,i},subScalarVec4:function(e,t,i){return i||(i=e),i[0]=t-e[0],i[1]=t-e[1],i[2]=t-e[2],i[3]=t-e[3],i},mulVec4:function(e,t,i){return i||(i=e),i[0]=e[0]*t[0],i[1]=e[1]*t[1],i[2]=e[2]*t[2],i[3]=e[3]*t[3],i},divVec3:function(e,t,i){return i||(i=e),i[0]=e[0]/t[0],i[1]=e[1]/t[1],i[2]=e[2]/t[2],i},divVec4:function(e,t,i){return i||(i=e),i[0]=e[0]/t[0],i[1]=e[1]/t[1],i[2]=e[2]/t[2],i[3]=e[3]/t[3],i},divScalarVec3:Rt,divVec3Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]/t,i[1]=e[1]/t,i[2]=e[2]/t,i},divVec4Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]/t,i[1]=e[1]/t,i[2]=e[2]/t,i[3]=e[3]/t,i},divScalarVec4:function(e,t,i){return i||(i=t),i[0]=e/t[0],i[1]=e/t[1],i[2]=e/t[2],i[3]=e/t[3],i},dotVec4:Dt,cross3Vec4:function(e,t){var i=e[0],r=e[1],n=e[2],o=t[0],s=t[1],a=t[2];return[r*a-n*s,n*o-i*a,i*s-r*o,0]},cross3Vec3:At,sqLenVec4:Ct,lenVec4:kt,dotVec2:Bt,sqLenVec3:Lt,sqLenVec2:Ft,lenVec3:Ut,distVec3:Vt,lenVec2:Gt,lerpVec3:Ht,distVec2:Xt,rcpVec3:function(e,t){return Rt(1,e,t)},normalizeVec4:Wt,normalizeVec3:Yt,normalizeVec2:function(e,t){return It(e,1/Gt(e),t)},angleVec3:function(e,t){var i=bt(e,t)/Math.sqrt(Lt(e)*Lt(t));return i=i<-1?-1:i>1?1:i,Math.acos(i)},vec3FromMat4Scale:Kt,vecToArray:function(e){for(var t=0,i=(e=Array.prototype.slice.call(e)).length;t<i;t++)e[t]=zt(e[t]);return e},triangleNormal:function(e,t,i,r){void 0===r&&(r=wt());var n=t[0]-e[0],o=t[1]-e[1],s=t[2]-e[2],a=i[0]-e[0],c=i[1]-e[1],l=i[2]-e[2],h=o*l-s*c,u=s*a-n*l,d=n*c-o*a,f=Math.sqrt(h*h+u*u+d*d);return 0===f?(r[0]=0,r[1]=0,r[2]=0):(r[0]=h/f,r[1]=u/f,r[2]=d/f),r},createMat3:qt,mat3ToMat4:function(e,t){return t||(t=Zt()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=0,t[4]=e[3],t[5]=e[4],t[6]=e[5],t[7]=0,t[8]=e[6],t[9]=e[7],t[10]=e[8],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},createMat4:Zt,compareMat4:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},perspectiveMat4:$t,frustumMat4v:ei,orthoMat4c:ti,frustumMat4:ii,identityMat4:ri,identityMat3:ni,isIdentityMat4:function(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]},rotationMat4v:oi,lookAtMat4v:si,inverseMat4:ai,transposeMat4:ci,mulMat4v4:li,mulMat4:hi,mulMat3:ui,transformPoint3:di,transformPoint4:fi,transformPoints3:function(e,t,i){for(var r,n,o,s,a,c=i||[],l=t.length,h=e[0],u=e[1],d=e[2],f=e[3],v=e[4],p=e[5],y=e[6],m=e[7],b=e[8],g=e[9],w=e[10],P=e[11],E=e[12],T=e[13],_=e[14],I=e[15],x=0;x<l;++x)r=(s=t[x])[0],n=s[1],o=s[2],(a=c[x]||(c[x]=[0,0,0]))[0]=h*r+v*n+b*o+E,a[1]=u*r+p*n+g*o+T,a[2]=d*r+y*n+w*o+_,a[3]=f*r+m*n+P*o+I;return c.length=l,c},transformPositions3:vi,transformPositions4:function(e,t,i){var r;i||(i=t);var n,o,s,a=t.length,c=e[0],l=e[1],h=e[2],u=e[3],d=e[4],f=e[5],v=e[6],p=e[7],y=e[8],m=e[9],b=e[10],g=e[11],w=e[12],P=e[13],E=e[14],T=e[15];for(r=0;r<a;r+=4)i[r+0]=c*(n=t[r+0])+d*(o=t[r+1])+y*(s=t[r+2])+w,i[r+1]=l*n+f*o+m*s+P,i[r+2]=h*n+v*o+b*s+E,i[r+3]=u*n+p*o+g*s+T;return i},transformVec3:pi,transformVec4:yi,scaleMat4v:mi,scalingMat4v:bi,scalingMat3v:gi,scalingMat4c:Pi,scaleMat4c:function(e,t,i,r){return r[0]*=e,r[4]*=t,r[8]*=i,r[1]*=e,r[5]*=t,r[9]*=i,r[2]*=e,r[6]*=t,r[10]*=i,r[3]*=e,r[7]*=t,r[11]*=i,r},scalingMat4s:function(e){return Pi(e,e,e)},composeMat4:Ei,decomposeMat4:Ti,translateMat4v:_i,translateMat4c:Ii,setMat4Translation:xi,translationMat4v:Si,translationMat3v:Mi,translationMat4c:Oi,translationMat4s:function(e,t){return Oi(e,e,e,t)},determinantMat4:ji,mat4ToEuler:Ri,lerpMat4:Di,identityQuat:Ai,eulerToQuat:Ci,mat4ToQuat:ki,vec3PairToQuat:function(e,t,i){void 0===i&&(i=Pt());var r=Math.sqrt(bt(e,e)*bt(t,t)),n=r+bt(e,t);return n<1e-8*r?(n=0,Math.abs(e[0])>Math.abs(e[2])?(i[0]=-e[1],i[1]=e[0],i[2]=0):(i[0]=0,i[1]=-e[2],i[2]=e[1])):At(e,t,i),i[3]=n,Li(i)},angleAxisToQuaternion:function(e,t){void 0===t&&(t=Pt());var i=e[3]/2,r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t},quatToEuler:function(e,t,i){return void 0===i&&(i=wt()),Bi(e,Qt),Ri(Qt,t,i),i},mulQuats:function(e,t,i){void 0===i&&(i=Pt());var r=e[0],n=e[1],o=e[2],s=e[3],a=t[0],c=t[1],l=t[2],h=t[3];return i[0]=s*a+r*h+n*l-o*c,i[1]=s*c+n*h+o*a-r*l,i[2]=s*l+o*h+r*c-n*a,i[3]=s*h-r*a-n*c-o*l,i},vec3ApplyQuat:function(e,t,i){void 0===i&&(i=wt());var r=t[0],n=t[1],o=t[2],s=e[0],a=e[1],c=e[2],l=e[3],h=l*r+a*o-c*n,u=l*n+c*r-s*o,d=l*o+s*n-a*r,f=-s*r-a*n-c*o;return i[0]=h*l+f*-s+u*-c-d*-a,i[1]=u*l+f*-a+d*-s-h*-c,i[2]=d*l+f*-c+h*-a-u*-s,i},quatToMat4:function(e,t){t=ri(t);var i=e[0],r=e[1],n=e[2],o=e[3],s=2*i,a=2*r,c=2*n,l=s*o,h=a*o,u=c*o,d=s*i,f=a*i,v=c*i,p=a*r,y=c*r,m=c*n;return t[0]=1-(p+m),t[1]=f+u,t[2]=v-h,t[4]=f-u,t[5]=1-(d+m),t[6]=y+l,t[8]=v+h,t[9]=y-l,t[10]=1-(d+p),t},quatToRotationMat4:Bi,normalizeQuat:Li,conjugateQuat:Fi,inverseQuat:function(e,t){return Li(Fi(e,t))},quatToAngleAxis:function(e,t){void 0===t&&(t=Pt());var i=(e=Li(e,ut))[3],r=2*Math.acos(i),n=Math.sqrt(1-i*i);return n<.001?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n),t[3]=r,t},rayTriangleIntersect:function(e,t,i,r,n,o){o=o||wt();var s=Mt(r,i,dt),a=Mt(n,i,ft),c=At(t,a,vt),l=bt(s,c);if(l<1e-6)return null;var h=Mt(e,i,pt),u=bt(h,c);if(u<0||u>l)return null;var d=At(h,s,yt),f=bt(t,d);if(f<0||u+f>l)return null;var v=bt(a,d)/l;return o[0]=e[0]+v*t[0],o[1]=e[1]+v*t[1],o[2]=e[2]+v*t[2],o},transformRay:function(e,t,i,r,n){ut[0]=t[0],ut[1]=t[1],ut[2]=t[2],ut[3]=1,yi(e,ut,mt),r[0]=mt[0],r[1]=mt[1],r[2]=mt[2],ut[0]=i[0],ut[1]=i[1],ut[2]=i[2],pi(e,ut,mt),Yt(mt),n[0]=mt[0],n[1]=mt[1],n[2]=mt[2]}},Ni=/*#__PURE__*/d("items"),Vi=/*#__PURE__*/d("lastUniqueId"),Gi=/*#__PURE__*/function(){function e(e,t){Object.defineProperty(this,Ni,{writable:!0,value:void 0}),Object.defineProperty(this,Vi,{writable:!0,value:void 0}),f(this,Ni)[Ni]=e||[],f(this,Vi)[Vi]=(t||0)+1}var t=e.prototype;return t.addItem=function(){var e;if(2===arguments.length){var t=arguments[0];if(e=arguments[1],f(this,Ni)[Ni][t])throw"ID clash: '"+t+"'";return f(this,Ni)[Ni][t]=e,t}for(e=arguments[0]||{};;){var i=f(this,Vi)[Vi]++;if(!f(this,Ni)[Ni][i])return f(this,Ni)[Ni][i]=e,i}},t.removeItem=function(e){var t=f(this,Ni)[Ni][e];return delete f(this,Ni)[Ni][e],t},e}(),Hi=/*#__PURE__*/function(){function e(){this._head=void 0,this._headLength=void 0,this._tail=void 0,this._index=void 0,this._length=void 0,this._head=[],this._headLength=0,this._tail=[],this._index=0,this._length=0}var t=e.prototype;return t.shift=function(){if(this._index>=this._headLength){var e=this._head;if(e.length=0,this._head=this._tail,this._tail=e,this._index=0,this._headLength=this._head.length,!this._headLength)return}var t=this._head[this._index];return this._index<0?delete this._head[this._index++]:this._head[this._index++]=void 0,this._length--,t},t.push=function(e){return this._length++,this._tail.push(e),this},t.unshift=function(e){return this._head[--this._index]=e,this._length++,this},t.clear=function(){this._head=[],this._headLength=0,this._tail=[],this._index=0,this._length=0},i(e,[{key:"length",get:function(){return this._length}}]),e}(),Xi=/*#__PURE__*/function(){function e(e,t,i){this.isLoading=void 0,this.itemsLoaded=void 0,this.itemsTotal=void 0,this.urlModifier=void 0,this.handlers=void 0,this.onStart=void 0,this.onLoad=void 0,this.onProgress=void 0,this.onError=void 0,this.isLoading=!1,this.itemsLoaded=0,this.itemsTotal=0,this.urlModifier=void 0,this.handlers=[],this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i}var t=e.prototype;return t.itemStart=function(e){this.itemsTotal++,this.isLoading||void 0!==this.onStart&&this.onStart(e,this.itemsLoaded,this.itemsTotal),this.isLoading=!0},t.itemEnd=function(e){this.itemsLoaded++,void 0!==this.onProgress&&this.onProgress(e,this.itemsLoaded,this.itemsTotal),this.itemsLoaded===this.itemsTotal&&(this.isLoading=!1,void 0!==this.onLoad&&this.onLoad())},t.itemError=function(e){void 0!==this.onError&&this.onError(e)},t.resolveURL=function(e){return this.urlModifier?this.urlModifier(e):e},t.setURLModifier=function(e){return this.urlModifier=e,this},t.addHandler=function(e,t){return this.handlers.push(e,t),this},t.removeHandler=function(e){var t=this.handlers.indexOf(e);return-1!==t&&this.handlers.splice(t,2),this},t.getHandler=function(e){for(var t=0,i=this.handlers.length;t<i;t+=2){var r=this.handlers[t],n=this.handlers[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return n}return null},e}(),Wi=new Xi,Yi=/*#__PURE__*/function(){function e(e){this.manager=void 0,this.crossOrigin=void 0,this.withCredentials=void 0,this.path=void 0,this.resourcePath=void 0,this.requestHeader=void 0,this.manager=void 0!==e?e:Wi,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}var t=e.prototype;return t.load=function(e,t,i,r){},t.loadAsync=function(e,t){var i=this;return new Promise(function(r,n){i.load(e,r,t,n)})},t.parse=function(){},t.setCrossOrigin=function(e){return this.crossOrigin=e,this},t.setWithCredentials=function(e){return this.withCredentials=e,this},t.setPath=function(e){return this.path=e,this},t.setResourcePath=function(e){return this.resourcePath=e,this},t.setRequestHeader=function(e){return this.requestHeader=e,this},e}(),Ki=/*#__PURE__*/function(){function e(e){void 0===e&&(e=4),this.pool=void 0,this.queue=void 0,this.workers=void 0,this.workersResolve=void 0,this.workerStatus=void 0,this.workerCreator=void 0,this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}var t=e.prototype;return t._initWorker=function(e){if(!this.workers[e]){var t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}},t._getIdleWorker=function(){for(var e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1},t._onMessage=function(e,t){var i=this.workersResolve[e];if(i&&i(t),this.queue.length){var r=this.queue.shift(),n=r.msg,o=r.transfer;this.workersResolve[e]=r.resolve,this.workers[e].postMessage(n,o)}else this.workerStatus^=1<<e},t.setWorkerCreator=function(e){this.workerCreator=e},t.setWorkerLimit=function(e){this.pool=e},t.postMessage=function(e,t){var i=this;return new Promise(function(r){var n=i._getIdleWorker();-1!==n?(i._initWorker(n),i.workerStatus|=1<<n,i.workersResolve[n]=r,i.workers[n].postMessage(e,t)):i.queue.push({resolve:r,msg:e,transfer:t})})},t.destroy=function(){this.workers.forEach(function(e){return e.terminate()}),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0},e}(),zi={enabled:!1,files:{},add:function(e,t){},get:function(e){},remove:function(e){},clear:function(){this.files={}}},qi={},Zi=/*#__PURE__*/function(e){function t(t){var i;return(i=e.call(this,t)||this).mimeType=void 0,i.responseType=void 0,i}r(t,e);var i=t.prototype;return i.load=function(e,t,i,r){var n=this;void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var o=zi.get(e);if(void 0!==o)return this.manager.itemStart(e),setTimeout(function(){t&&t(o),n.manager.itemEnd(e)},0),o;if(void 0===qi[e]){qi[e]=[],qi[e].push({onLoad:t,onProgress:i,onError:r});var s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,c=this.responseType;fetch(s).then(function(t){if(200===t.status||0===t.status){if(0===t.status&&console.warn("FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body.getReader)return t;var i=qi[e],r=t.body.getReader(),n=t.headers.get("Content-Length"),o=n?parseInt(n):0,s=0!==o,a=0,c=new ReadableStream({start:function(e){!function t(){r.read().then(function(r){var n=r.value;if(r.done)e.close();else{for(var c=new ProgressEvent("progress",{lengthComputable:s,loaded:a+=n.byteLength,total:o}),l=0,h=i.length;l<h;l++){var u=i[l];u.onProgress&&u.onProgress(c)}e.enqueue(n),t()}})}()}});return new Response(c)}throw new Error('fetch for "'+t.url+'" responded with '+t.status+": "+t.statusText)}).then(function(e){switch(c){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(function(e){return(new DOMParser).parseFromString(e,a)});case"json":return e.json();default:if(void 0===a)return e.text();var t=/charset="?([^;"\s]*)"?/i.exec(a),i=t&&t[1]?t[1].toLowerCase():void 0,r=new TextDecoder(i);return e.arrayBuffer().then(function(e){return r.decode(e)})}}).then(function(t){zi.add(e,t);var i=qi[e];delete qi[e];for(var r=0,n=i.length;r<n;r++){var o=i[r];o.onLoad&&o.onLoad(t)}}).catch(function(t){var i=qi[e];if(void 0===i)throw n.manager.itemError(e),t;delete qi[e];for(var r=0,o=i.length;r<o;r++){var s=i[r];s.onError&&s.onError(t)}n.manager.itemError(e)}).finally(function(){n.manager.itemEnd(e)}),this.manager.itemStart(e)}else qi[e].push({onLoad:t,onProgress:i,onError:r})},i.setResponseType=function(e){return this.responseType=e,this},i.setMimeType=function(e){return this.mimeType=e,this},t}(Yi),Qi=[["0",10],["A",26],["a",26],["_",1],["$",1]].map(function(e){for(var t=[],i=e[0].charCodeAt(0),r=i+e[1],n=i;n<r;++n)t.push(n);return String.fromCharCode.apply(null,t)}).join("");function Ji(e,t){return(t&&4!==t?[0,6]:[0,6,12,18]).map(function(t){return Qi.substr(parseInt(String(e/(1<<t)))%64,1)}).reverse().join("")}function $i(e,t,i){var r=function(e){};t=t||r,i=i||r;var n=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(n){var o=!!n[2],s=n[3];s=window.decodeURIComponent(s),o&&(s=window.atob(s));try{for(var a=new ArrayBuffer(s.length),c=new Uint8Array(a),l=0;l<s.length;l++)c[l]=s.charCodeAt(l);window.setTimeout(function(){t(a)},0)}catch(e){window.setTimeout(function(){i(e)},0)}}else{var h=new XMLHttpRequest;h.open("GET",e,!0),h.responseType="arraybuffer",h.onreadystatechange=function(){4===h.readyState&&(200===h.status?t(h.response):i("loadArrayBuffer error : "+h.response))},h.send(null)}}function er(e){return e&&!e.propertyIsEnumerable("length")&&"object"==typeof e&&"number"==typeof e.length}function tr(e){return"string"==typeof e||e instanceof String}function ir(e){return!isNaN(parseFloat(e))&&isFinite(e)}function rr(e,t){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}function nr(e){return ir(e)?""+e:"'"+e+"'"}var or=function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&i]+e[i>>8&255]+"-"+e[i>>16&15|64]+e[i>>24&255]+"-"+e[63&r|128]+e[r>>8&255]+"-"+e[r>>16&255]+e[r>>24&255]+e[255&n]+e[n>>8&255]+e[n>>16&255]+e[n>>24&255]}}(),sr={__proto__:null,clone:function(e){return JSON.parse(JSON.stringify(e))},b64:Ji,compressGuid:function(e){var t=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30].map(function(t){return parseInt(e.substr(t,2),16)});return Ji(t[0],2)+[1,4,7,10,13].map(function(e){return Ji((t[e]<<16)+(t[e+1]<<8)+t[e+2],4)}).join("")},findNodeOfType:function(e,t){var i=[];return function e(r){r.type===t&&i.push(r),(r.children||[]).forEach(function(t){e(t)})}(e),i},timeout:function(e){return new Promise(function(t,i){setTimeout(t,e)})},httpRequest:function(e){return new Promise(function(t,i){var r=new XMLHttpRequest;r.open(e.method||"GET",e.url,!0),r.onload=function(n){console.log(e.url,r.readyState,r.status),4===r.readyState&&(200===r.status?t(r.responseXML):i(r.statusText))},r.send(null)})},loadJSON:function(e,t,i){var r=function(e){};t=t||r,i=i||r;var n=new XMLHttpRequest;n.overrideMimeType("application/json"),n.open("GET",e,!0),n.addEventListener("load",function(e){var r=e.target.response;if(200===this.status){var n;try{n=JSON.parse(r)}catch(e){i("utils.loadJSON(): Failed to parse JSON response - "+e)}t(n)}else if(0===this.status){console.warn("loadFile: HTTP Status 0 received.");try{t(JSON.parse(r))}catch(e){i("utils.loadJSON(): Failed to parse JSON response - "+e)}}else i(e)},!1),n.addEventListener("error",function(e){i(e)},!1),n.send(null)},loadArraybuffer:$i,isArray:er,isString:tr,isNumeric:ir,isID:function(e){return tr(e)||ir(e)},isFunction:function(e){return"function"==typeof e},isObject:function(e){return!!e&&e.constructor==={}.constructor},copy:function(e){return rr(e,{})},apply:rr,apply2:function(e,t){for(var i in e)e.hasOwnProperty(i)&&null!=e[i]&&(t[i]=e[i]);return t},applyIf:function(e,t){for(var i in e)e.hasOwnProperty(i)&&null==t[i]&&(t[i]=e[i]);return t},isEmptyObject:function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},inQuotes:nr,concat:function(e,t){var i=new e.constructor(e.length+t.length);return i.set(e),i.set(t,e.length),i},createUUID:or,Map:Gi,Queue:Hi,Loader:Yi,DefaultLoadingManager:Wi,LoadingManager:Xi,WorkerPool:Ki,Cache:zi,FileLoader:Zi},ar=Zt(),cr=Zt();function lr(e,t,i){return void 0===i&&(i=e),i[0]=e[0]*t[0]+t[12],i[1]=e[1]*t[5]+t[13],i[2]=e[2]*t[10]+t[14],i}function hr(e,t,i){void 0===i&&(i=new Float32Array(e.length));for(var r=0,n=e.length;r<n;r+=3)i[r+0]=e[r+0]*t[0]+t[12],i[r+1]=e[r+1]*t[5]+t[13],i[r+2]=e[r+2]*t[10]+t[14];return i}var ur=function(){var e=qt(),t=qt();return function(i,r,n){var o,s=new Uint16Array(i.length),a=new Float32Array([65535/(n[0]-r[0]),65535/(n[1]-r[1])]);for(o=0;o<i.length;o+=2)s[o+0]=Math.floor((i[o+0]-r[0])*a[0]),s[o+1]=Math.floor((i[o+1]-r[1])*a[1]);return ni(e),Mi(r,e),ni(t),gi([(n[0]-r[0])/65535,(n[1]-r[1])/65535],t),{quantized:s,decompressMatrix:ui(e,t,ni())}}}();function dr(e,t,i,r){var n=e[t]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2])),o=e[t+1]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2]));if(e[t+2]<0){var s=(1-Math.abs(o))*(n>=0?1:-1),a=(1-Math.abs(n))*(o>=0?1:-1);n=s,o=a}return new Int8Array([Math[i](127.5*n+(n<0?-1:0)),Math[r](127.5*o+(o<0?-1:0))])}function fr(e,t,i){return e[t]*i[0]+e[t+1]*i[1]+e[t+2]*i[2]}function vr(e,t){void 0===t&&(t=wt());var i=e[0],r=e[1];i=(2*i+1)/255,r=(2*r+1)/255;var n=1-Math.abs(i)-Math.abs(r);n<0&&(i=(1-Math.abs(r))*(i>=0?1:-1),r=(1-Math.abs(i))*(r>=0?1:-1));var o=Math.sqrt(i*i+r*r+n*n);return t[0]=i/o,t[1]=r/o,t[2]=n/o,t}function pr(e,t,i){for(var r=e.length,n=new Uint16Array(r),o=t[0],s=t[1],a=t[2],c=t[3]-o,l=t[4]-s,h=t[5]-a,u=65525,d=u/c,f=u/l,v=u/h,p=function(e){return e>=0?e:0},y=0;y<r;y+=3)n[y+0]=Math.floor(p(e[y+0]-o)*d),n[y+1]=Math.floor(p(e[y+1]-s)*f),n[y+2]=Math.floor(p(e[y+2]-a)*v);return ri(ar),Si(t,ar),ri(cr),bi([c/u,l/u,h/u],cr),hi(ar,cr,i),n}function yr(e,t,i){var r,n,o=e[0]/(Math.abs(e[0])+Math.abs(e[1])+Math.abs(e[2])),s=e[1]/(Math.abs(e[0])+Math.abs(e[1])+Math.abs(e[2]));return e[2]<0&&(r=(1-Math.abs(s))*(o>=0?1:-1),n=(1-Math.abs(o))*(s>=0?1:-1),o=r,s=n),new Int8Array([Math[t](127.5*o+(o<0?-1:0)),Math[i](127.5*s+(s<0?-1:0))])}function mr(e,t,i,r){var n=e[t]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2])),o=e[t+1]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2]));if(e[t+2]<0){var s=(1-Math.abs(o))*(n>=0?1:-1),a=(1-Math.abs(n))*(o>=0?1:-1);n=s,o=a}return new Int8Array([Math[i](127.5*n+(n<0?-1:0)),Math[r](127.5*o+(o<0?-1:0))])}var br={__proto__:null,getPositions3MinMax:function(e,t,i){var r,n;for(t=t||new Float64Array(3),i=i||new Float64Array(3),r=0;r<3;r++)t[r]=Number.MAX_VALUE,i[r]=-Number.MAX_VALUE;for(r=0;r<e.length;r+=3)for(n=0;n<3;n++)t[n]=Math.min(t[n],e[r+n]),i[n]=Math.max(i[n],e[r+n]);return{min:t,max:i}},createPositions3DecompressMat4:function(e,t){t=t||Zt();var i=e[3]-e[0],r=e[4]-e[1],n=e[5]-e[2],o=65535;return ri(ar),Si(e,ar),ri(cr),bi([i/o,r/o,n/o],cr),hi(ar,cr,t),t},compressPositions3:function(e,t,i){var r,n=new Uint16Array(e.length),o=new Float32Array([i[0]!==t[0]?65535/(i[0]-t[0]):0,i[1]!==t[1]?65535/(i[1]-t[1]):0,i[2]!==t[2]?65535/(i[2]-t[2]):0]);for(r=0;r<e.length;r+=3)n[r+0]=Math.floor((e[r+0]-t[0])*o[0]),n[r+1]=Math.floor((e[r+1]-t[1])*o[1]),n[r+2]=Math.floor((e[r+2]-t[2])*o[2]);return ri(ar),Si(t,ar),ri(cr),bi([(i[0]-t[0])/65535,(i[1]-t[1])/65535,(i[2]-t[2])/65535],cr),{quantized:n,decompressMatrix:hi(ar,cr,ri())}},compressPoint3:function(e,t,i){void 0===i&&(i=e);var r=new Float32Array([t[3]!==t[0]?65535/(t[3]-t[0]):0,t[4]!==t[1]?65535/(t[4]-t[1]):0,t[5]!==t[2]?65535/(t[5]-t[2]):0]);return i[0]=Math.max(0,Math.min(65535,Math.floor((e[0]-t[0])*r[0]))),i[1]=Math.max(0,Math.min(65535,Math.floor((e[1]-t[1])*r[1]))),i[2]=Math.max(0,Math.min(65535,Math.floor((e[2]-t[2])*r[2]))),i},decompressPoint3:lr,decompressAABB3:function(e,t,i){return void 0===i&&(i=e),i[0]=e[0]*t[0]+t[12],i[1]=e[1]*t[5]+t[13],i[2]=e[2]*t[10]+t[14],i[3]=e[3]*t[0]+t[12],i[4]=e[4]*t[5]+t[13],i[5]=e[5]*t[10]+t[14],i},decompressPositions3:hr,getUVBounds:function(e){var t,i,r=new Float32Array(2),n=new Float32Array(2);for(t=0;t<2;t++)r[t]=Number.MAX_VALUE,n[t]=-Number.MAX_VALUE;for(t=0;t<e.length;t+=2)for(i=0;i<2;i++)r[i]=Math.min(r[i],e[t+i]),n[i]=Math.max(n[i],e[t+i]);return{min:r,max:n}},compressUVs:ur,compressNormals:function(e){for(var t,i,r,n,o=new Int8Array(e.length),s=0;s<e.length;s+=3)i=t=dr(e,s,"floor","floor"),r=n=fr(e,s,vr(t)),(r=fr(e,s,vr(t=dr(e,s,"ceil","floor"))))>n&&(i=t,n=r),(r=fr(e,s,vr(t=dr(e,s,"floor","ceil"))))>n&&(i=t,n=r),(r=fr(e,s,vr(t=dr(e,s,"ceil","ceil"))))>n&&(i=t,n=r),o[s]=i[0],o[s+1]=i[1];return o},decompressUV:function(e,t,i){void 0===i&&(i=new Float32Array(2)),i[0]=e[0]*t[0]+t[6],i[1]=e[1]*t[4]+t[7]},decompressUVs:function(e,t,i){void 0===i&&(i=new Float32Array(e.length));for(var r=0,n=e.length;r<n;r+=3)i[r+0]=e[r+0]*t[0]+t[6],i[r+1]=e[r+1]*t[4]+t[7];return i},decompressNormal:function(e,t){var i=e[0],r=e[1];i=(2*i+1)/255,r=(2*r+1)/255;var n=1-Math.abs(i)-Math.abs(r);n<0&&(i=(1-Math.abs(r))*(i>=0?1:-1),r=(1-Math.abs(i))*(r>=0?1:-1));var o=Math.sqrt(i*i+r*r+n*n);return t[0]=i/o,t[1]=r/o,t[2]=n/o,t},decompressNormals:function(e,t){for(var i=0,r=0,n=e.length;i<n;i+=2){var o=e[i+0],s=e[i+1];o=(2*o+1)/255,s=(2*s+1)/255;var a=1-Math.abs(o)-Math.abs(s);a<0&&(o=(1-Math.abs(s))*(o>=0?1:-1),s=(1-Math.abs(o))*(s>=0?1:-1));var c=Math.sqrt(o*o+s*s+a*a);t[r+0]=o/c,t[r+1]=s/c,t[r+2]=a/c,r+=3}return t},quantizePositions3:pr,transformAndOctEncodeNormals:function(e,t,i,r,n){function o(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}var s,a,c,l,h,u=new Float32Array([0,0,0,0]),d=new Float32Array([0,0,0,0]);for(h=0;h<i;h+=3)u[0]=t[h],u[1]=t[h+1],u[2]=t[h+2],pi(e,u,d),Yt(d,d),a=s=yr(d,"floor","floor"),c=l=o(d,vr(s)),(c=o(d,vr(s=yr(d,"ceil","floor"))))>l&&(a=s,l=c),(c=o(d,vr(s=yr(d,"floor","ceil"))))>l&&(a=s,l=c),(c=o(d,vr(s=yr(d,"ceil","ceil"))))>l&&(a=s,l=c),r[n+h+0]=a[0],r[n+h+1]=a[1],r[n+h+2]=0;return n+i},octEncodeNormals:function(e){for(var t,i,r,n,o=e.length,s=new Int8Array(o),a=0;a<o;a+=3)i=t=mr(e,a,"floor","floor"),r=n=fr(e,a,vr(t)),(r=fr(e,a,vr(t=mr(e,a,"ceil","floor"))))>n&&(i=t,n=r),(r=fr(e,a,vr(t=mr(e,a,"floor","ceil"))))>n&&(i=t,n=r),(r=fr(e,a,vr(t=mr(e,a,"ceil","ceil"))))>n&&(i=t,n=r),s[a+0]=i[0],s[a+1]=i[1],s[a+2]=0;return s},octEncodeVec3:yr,octEncodeNormal:mr},gr=wt(),wr=wt(),Pr=Zt();function Er(e){return new Float64Array(e||6)}function Tr(e){return new Int16Array(e||6)}function _r(e){return lt(e||32)}function Ir(e,t){return e[0]<=t[0]&&t[3]<=e[3]&&e[1]<=t[1]&&e[2]<=t[2]}function xr(e,t){return e[0]<=t[0]&&t[3]<=e[3]&&e[1]<=t[1]&&t[4]<=e[4]&&e[2]<=t[2]&&t[5]<=e[5]}var Sr=function(){var e=lt(3),t=lt(3),i=lt(3);return function(r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],t[0]=r[3],t[1]=r[4],t[2]=r[5],Mt(t,e,i),Math.abs(Ut(i))}}(),Mr=function(){var e=lt(3),t=lt(3),i=lt(3);return function(r,n){e[0]=r[0],e[1]=r[1],e[2]=r[2],t[0]=r[3],t[1]=r[4],t[2]=r[5];var o=Mt(t,e,i),s=n[0]-r[0],a=r[3]-n[0],c=n[1]-r[1],l=r[4]-n[1],h=n[2]-r[2],u=r[5]-n[2];return o[0]+=s>a?s:a,o[1]+=c>l?c:l,o[2]+=h>u?h:u,Math.abs(Ut(o))}}();function Or(e,t){return void 0===t&&(t=wt()),t[0]=(e[0]+e[3])/2,t[1]=(e[1]+e[4])/2,t[2]=(e[2]+e[5])/2,t}function jr(e){return void 0===e&&(e=Er()),e[0]=st,e[1]=st,e[2]=st,e[3]=ot,e[4]=ot,e[5]=ot,e}function Rr(e,t){return void 0===e&&(e=Er()),void 0===t&&(t=_r()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=1,t[4]=e[3],t[5]=e[1],t[6]=e[2],t[7]=1,t[8]=e[3],t[9]=e[4],t[10]=e[2],t[11]=1,t[12]=e[0],t[13]=e[4],t[14]=e[2],t[15]=1,t[16]=e[0],t[17]=e[1],t[18]=e[5],t[19]=1,t[20]=e[3],t[21]=e[1],t[22]=e[5],t[23]=1,t[24]=e[3],t[25]=e[4],t[26]=e[5],t[27]=1,t[28]=e[0],t[29]=e[4],t[30]=e[5],t[31]=1,t}function Dr(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[3]&&(e[3]=t[3]),e[4]<t[4]&&(e[4]=t[4]),e[5]<t[5]&&(e[5]=t[5]),e}function Ar(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[0]&&(e[3]=t[0]),e[4]<t[1]&&(e[4]=t[1]),e[5]<t[2]&&(e[5]=t[2]),e}function Cr(e,t){for(var i,r,n,o=0,s=t.length;o<s;o+=3)r=t[o+1],n=t[o+2],e[0]>(i=t[o])&&(e[0]=i),e[1]>r&&(e[1]=r),e[2]>n&&(e[2]=n),e[3]<i&&(e[3]=i),e[4]<r&&(e[4]=r),e[5]<n&&(e[5]=n);return e}var kr=function(){var e=lt(3);return function(t,i,r){i=i||Er();for(var n,o,s,a=st,c=st,l=st,h=ot,u=ot,d=ot,f=0,v=t.length;f<v;f+=3)r?(e[0]=t[f+0],e[1]=t[f+1],e[2]=t[f+2],lr(e,r,e),n=e[0],o=e[1],s=e[2]):(n=t[f+0],o=t[f+1],s=t[f+2]),n<a&&(a=n),o<c&&(c=o),s<l&&(l=s),n>h&&(h=n),o>u&&(u=o),s>d&&(d=s);return i[0]=a,i[1]=c,i[2]=l,i[3]=h,i[4]=u,i[5]=d,i}}();function Br(e,t){void 0===t&&(t=wt());for(var i=0,r=0,n=0,o=0,s=e.length;o<s;o+=3)i+=e[o+0],r+=e[o+1],n+=e[o+2];var a=e.length/3;return t[0]=i/a,t[1]=r/a,t[2]=n/a,t}var Lr=/*#__PURE__*/function(){function e(){this.testVertex=void 0,this.offset=void 0,this.normal=void 0,this.normal=wt(),this.offset=0,this.testVertex=wt()}return e.prototype.set=function(e,t,i,r){var n=1/Math.sqrt(e*e+t*t+i*i);this.normal[0]=e*n,this.normal[1]=t*n,this.normal[2]=i*n,this.offset=r*n,this.testVertex[0]=this.normal[0]>=0?1:0,this.testVertex[1]=this.normal[1]>=0?1:0,this.testVertex[2]=this.normal[2]>=0?1:0},e}(),Fr=1,Ur=2,Nr=3,Vr=function(){this.planes=void 0,this.planes=[new Lr,new Lr,new Lr,new Lr,new Lr,new Lr]};function Gr(e,t,i){var r=hi(t,e,Pr),n=r[0],o=r[1],s=r[2],a=r[3],c=r[4],l=r[5],h=r[6],u=r[7],d=r[8],f=r[9],v=r[10],p=r[11],y=r[12],m=r[13],b=r[14],g=r[15];return(i=i||new Vr).planes[0].set(a-n,u-c,p-d,g-y),i.planes[1].set(a+n,u+c,p+d,g+y),i.planes[2].set(a-o,u-l,p-f,g-m),i.planes[3].set(a+o,u+l,p+f,g+m),i.planes[4].set(a-s,u-h,p-v,g-b),i.planes[5].set(a+s,u+h,p+v,g+b),i}function Hr(e,t){var i=Fr,r=gr,n=wr;r[0]=t[0],r[1]=t[1],r[2]=t[2],n[0]=t[3],n[1]=t[4],n[2]=t[5];for(var o=[r,n],s=0;s<6;++s){var a=e.planes[s];if(a.normal[0]*o[a.testVertex[0]][0]+a.normal[1]*o[a.testVertex[1]][1]+a.normal[2]*o[a.testVertex[2]][2]+a.offset<0)return Nr;a.normal[0]*o[1-a.testVertex[0]][0]+a.normal[1]*o[1-a.testVertex[1]][1]+a.normal[2]*o[1-a.testVertex[2]][2]+a.offset<0&&(i=Ur)}return i}function Xr(e,t){return Ur}var Wr={__proto__:null,createAABB3:Er,createAABB3Int16:Tr,createAABB2:function(e){return lt(e||4)},createOBB3:_r,createOBB2:function(e){return lt(e||16)},createSphere3:function(e,t,i,r){return lt([e,t,i,r])},transformOBB3:function(e,t,i){var r;void 0===i&&(i=t);var n,o,s,a=t.length,c=e[0],l=e[1],h=e[2],u=e[3],d=e[4],f=e[5],v=e[6],p=e[7],y=e[8],m=e[9],b=e[10],g=e[11],w=e[12],P=e[13],E=e[14],T=e[15];for(r=0;r<a;r+=4)i[r+0]=c*(n=t[r+0])+d*(o=t[r+1])+y*(s=t[r+2])+w,i[r+1]=l*n+f*o+m*s+P,i[r+2]=h*n+v*o+b*s+E,i[r+3]=u*n+p*o+g*s+T;return i},containsAABB2:Ir,containsAABB3:xr,getAABB3Diag:Sr,getAABB3DiagPoint:Mr,getAABB3Area:function(e){return(e[3]-e[0])*(e[4]-e[1])*(e[5]-e[2])},getAABB3Center:Or,getAABB2Center:function(e,t){return void 0===t&&(t=gt()),t[0]=(e[2]+e[0])/2,t[1]=(e[3]+e[1])/2,t},collapseAABB3:jr,collapseAABB3Int16:function(e){return void 0===e&&(e=Tr()),e[0]=65535,e[1]=65535,e[2]=65535,e[3]=-65535,e[4]=-65535,e[5]=-65535,e},AABB3ToOBB3:Rr,expandAABB3:Dr,expandAABB2:function(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[3]<t[3]&&(e[3]=t[3]),e[4]<t[4]&&(e[4]=t[4]),e},expandAABB3Point3:Ar,expandAABB2Point2:function(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[3]<t[0]&&(e[3]=t[0]),e[4]<t[1]&&(e[4]=t[1]),e},expandAABB3Points3:Cr,ABB3ToOBB3:function(e,t){return void 0===t&&(t=_r()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=1,t[4]=e[3],t[5]=e[1],t[6]=e[2],t[7]=1,t[8]=e[3],t[9]=e[4],t[10]=e[2],t[11]=1,t[12]=e[0],t[13]=e[4],t[14]=e[2],t[15]=1,t[16]=e[0],t[17]=e[1],t[18]=e[5],t[19]=1,t[20]=e[3],t[21]=e[1],t[22]=e[5],t[23]=1,t[24]=e[3],t[25]=e[4],t[26]=e[5],t[27]=1,t[28]=e[0],t[29]=e[4],t[30]=e[5],t[31]=1,t},positions3ToAABB3:kr,OBB3ToAABB3:function(e,t){void 0===t&&(t=Er());for(var i,r,n,o=st,s=st,a=st,c=ot,l=ot,h=ot,u=0,d=e.length;u<d;u+=4)(i=e[u+0])<o&&(o=i),(r=e[u+1])<s&&(s=r),(n=e[u+2])<a&&(a=n),i>c&&(c=i),r>l&&(l=r),n>h&&(h=n);return t[0]=o,t[1]=s,t[2]=a,t[3]=c,t[4]=l,t[5]=h,t},points3ToAABB3:function(e,t){void 0===t&&(t=Er());for(var i,r,n,o=st,s=st,a=st,c=ot,l=ot,h=ot,u=0,d=e.length;u<d;u++)(i=e[u][0])<o&&(o=i),(r=e[u][1])<s&&(s=r),(n=e[u][2])<a&&(a=n),i>c&&(c=i),r>l&&(l=r),n>h&&(h=n);return t[0]=o,t[1]=s,t[2]=a,t[3]=c,t[4]=l,t[5]=h,t},getPositions3Center:Br,FrustumPlane3:Lr,INSIDE:Fr,INTERSECT:Ur,OUTSIDE:Nr,Frustum3:Vr,setFrustum3:Gr,intersectFrustum3AABB3:Hr,intersectAABB3s:Xr,intersectFrustum3Triangles3:function(e,t,i){return!0},intersectFrustum3Triangle3:function(e,t,i,r){return!0},intersectFrustum3Lines3:function(e,t,i){return!0},intersectFrustum3Positions3:function(e,t){return!0},intersectFrustum3Point3:function(e,t){return!0},intersectAABB3Triangles3:function(e,t,i){return!1},intersectAABB3Lines3:function(e,t,i){return!1},intersectAABB3Positions3:function(e,t){for(var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],c=0,l=t.length;c<l;c+=3){var h=t[c];if(i<=h&&h<=o){var u=t[c+1];if(r<=u&&u<=s){var d=t[c+2];if(n<=d&&d<=a)return!0}}}return!1},containsAABB3Point3:function(e,t){return e[0]<=t[0]&&t[0]<=e[3]&&e[1]<=t[1]&&t[1]<=e[4]&&e[2]<=t[2]&&t[2]<=e[5]},containsAABB2Point2:function(e,t){return e[0]<=t[0]&&t[0]<=e[3]&&e[1]<=t[1]&&t[1]<=e[4]}},Yr=wt(),Kr=new Float32Array(16),zr=new Float64Array(4),qr=new Float64Array(4);function Zr(e,t,i){return void 0===i&&(i=Kr),zr[0]=t[0],zr[1]=t[1],zr[2]=t[2],zr[3]=1,yi(e,zr,qr),xi(e,qr,i),i}function Qr(e,t,i){return void 0===i&&(i=200),t[0]=Math.round(e[0]/i)*i,t[1]=Math.round(e[1]/i)*i,t[2]=Math.round(e[2]/i)*i,t}var Jr={__proto__:null,createRTCViewMat:Zr,worldToRTCPos:function(e,t,i){var r=Float32Array.from([e[0]])[0],n=e[0]-r,o=Float32Array.from([e[1]])[0],s=e[1]-o,a=Float32Array.from([e[2]])[0],c=e[2]-a;t[0]=r,t[1]=o,t[2]=a,i[0]=n,i[1]=s,i[2]=c},worldToRTCCenter:Qr,worldToRTCPositions:function(e,t,i,r){void 0===r&&(r=200);for(var n=Br(e,Yr),o=Math.round(n[0]/r)*r,s=Math.round(n[1]/r)*r,a=Math.round(n[2]/r)*r,c=0,l=e.length;c<l;c+=3)t[c+0]=e[c+0]-o,t[c+1]=e[c+1]-s,t[c+2]=e[c+2]-a;return i[0]=o,i[1]=s,i[2]=a,0!==i[0]||0!==i[1]||0!==i[2]},rtcToWorldPos:function(e,t,i){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i},getPlaneRTCPos:function(e,t,i,r){var n=bt(t,i)+e;return _t(Yt(t,Yr),-n,r),r}},$r=/*#__PURE__*/d("messages"),en=/*#__PURE__*/d("locales"),tn=/*#__PURE__*/d("locale");function rn(e,t){if(t[e])return t[e];for(var i=e.split("."),r=t,n=0,o=i.length;r&&n<o;n++)r=r[i[n]];return r}function nn(e,t){return void 0===t&&(t=[]),e.replace(/\{\{|\}\}|\{(\d+)\}/g,function(e,i){return"{{"===e?"{":"}}"===e?"}":t[i]})}var on={__proto__:null,LocaleService:/*#__PURE__*/function(){function e(e){void 0===e&&(e={messages:{},locale:""}),this.onUpdated=void 0,Object.defineProperty(this,$r,{writable:!0,value:void 0}),Object.defineProperty(this,en,{writable:!0,value:void 0}),Object.defineProperty(this,tn,{writable:!0,value:"en"}),this.onUpdated=new p(new te.EventDispatcher),this.messages=e.messages,this.locale=e.locale}var t=e.prototype;return t.loadMessages=function(e){for(var t in void 0===e&&(e={}),e)f(this,$r)[$r][t]=e[t];this.messages=f(this,$r)[$r]},t.clearMessages=function(){this.messages={}},t.translate=function(e,t){var i=f(this,$r)[$r][f(this,tn)[tn]];if(!i)return null;var r=rn(e,i);return r?t?nn(r,t):r:null},t.translatePlurals=function(e,t,i){var r=f(this,$r)[$r][f(this,tn)[tn]];if(!r)return null;var n=rn(e,r);return(n=0===(t=parseInt(""+t,10))?n.zero:t>1?n.other:n.one)?(n=nn(n,[t]),i&&(n=nn(n,i)),n):null},i(e,[{key:"messages",set:function(e){f(this,$r)[$r]=e||{},f(this,en)[en]=Object.keys(f(this,$r)[$r]),this.onUpdated.dispatch(this,f(this,tn)[tn])}},{key:"locales",get:function(){return f(this,en)[en]}},{key:"locale",get:function(){return f(this,tn)[tn]},set:function(e){e=e||"de",f(this,tn)[tn]!==e&&(f(this,tn)[tn]=e,this.onUpdated.dispatch(this,f(this,tn)[tn]))}}]),e}()},sn=function(e,t){this.propertySet=void 0,this.name=void 0,this.value=void 0,this.type=void 0,this.valueType=void 0,this.description=void 0,this.propertySet=e,this.name=t.name,this.type=t.type,this.value=t.value,this.valueType=t.valueType,this.description=t.description},an=function(e,t){if(this.models=void 0,this.id=void 0,this.originalSystemId=void 0,this.name=void 0,this.type=void 0,this.properties=void 0,this.models=[e],this.id=t.id,this.name=t.name,this.type=t.type,this.properties=[],t.properties)for(var i=0,r=t.properties.length;i<r;i++){var n=new sn(this,t.properties[i]);this.properties.push(n)}},cn=function(e,t,i,r,n,o){this.data=void 0,this.models=void 0,this.id=void 0,this.name=void 0,this.type=void 0,this.propertySets=void 0,this.relating=void 0,this.related=void 0,this.data=e,this.models=[t],this.id=i,this.name=r,this.type=n,this.propertySets=o||[],this.related={},this.relating={}},ln=function(e,t,i){this.type=void 0,this.relatingObject=void 0,this.relatedObject=void 0,this.type=e,this.relatingObject=t,this.relatedObject=i},hn=/*#__PURE__*/d("destroyed"),un=/*#__PURE__*/d("removeObjectFromModels"),dn=/*#__PURE__*/function(e){function t(t,i,r,n){var o;return o=e.call(this,t)||this,Object.defineProperty(c(o),un,{value:fn}),o.data=void 0,o.name=void 0,o.projectId=void 0,o.revisionId=void 0,o.author=void 0,o.createdAt=void 0,o.creatingApplication=void 0,o.schema=void 0,o.propertySets=void 0,o.objects=void 0,o.rootObjects=void 0,o.objectsByType=void 0,o.relationships=void 0,o.typeCounts=void 0,o.onBuilt=void 0,o.built=void 0,Object.defineProperty(c(o),hn,{writable:!0,value:void 0}),o.onBuilt=new p(new te.EventDispatcher),o.data=t,o.id=i,o.projectId=r.projectId||"",o.revisionId=r.revisionId||"",o.author=r.author||"",o.createdAt=r.createdAt||"",o.creatingApplication=r.creatingApplication||"",o.schema=r.schema||"",o.propertySets={},o.objects={},o.objectsByType={},o.relationships=[],o.typeCounts={},o.rootObjects={},o.built=!1,f(c(o),hn)[hn]=!1,o.fromJSON(r),o}r(t,e);var i=t.prototype;return i.fromJSON=function(e){if(this.destroyed)return new he("Failed to add components to DataModel - DataModel already destroyed");if(this.built)throw new he("Failed to add components to DataModel - DataModel already built");if(e.propertySets)for(var t=0,i=e.propertySets.length;t<i;t++)this.createPropertySet(e.propertySets[t]);if(e.objects)for(var r=0,n=e.objects.length;r<n;r++)this.createObject(e.objects[r]);if(e.relationships)for(var o=0,s=e.relationships.length;o<s;o++)this.createRelationship(e.relationships[o])},i.createPropertySet=function(e){if(this.destroyed)return new he("Failed to create PropertySet - DataModel already destroyed");if(this.built)return new he("DataModel already built");if(this.propertySets[e.id])return new he("Failed to create PropertySet - PropertySet with same ID already created in this DataModel. It's OK to have duplicates shared between DataModels, but they must be unique within each DataModel.");var t=this.data.propertySets[e.id];return t?(this.propertySets[e.id]=t,t.models.push(this),t):(t=new an(this,e),this.propertySets[e.id]=t,this.data.propertySets[e.id]=t,t)},i.createObject=function(e){if(this.destroyed)return new he("Failed to create DataObject - DataModel already destroyed");if(this.built)return new he("Failed to create DataObject - DataModel already built");var t=e.id;if(this.objects[t])return new he("Failed to create DataObject - DataObject with same ID already created in this DataModel. It's OK to have duplicates shared between DataModels, but they must be unique within each DataModel.");var i=e.type,r=this.data.objects[t];if(r)this.objects[t]=r,this.data.objects[t]=r,this.objectsByType[i]||(this.objectsByType[i]={}),this.objectsByType[i][t]=r,this.typeCounts[i]=void 0===this.typeCounts[i]?1:this.typeCounts[i]+1,r.models.push(this);else{var n=[];if(e.propertySetIds)for(var o=0,s=e.propertySetIds.length;o<s;o++){var a=e.propertySetIds[o],c=this.propertySets[a];if(!c)return new he('Failed to create DataObject - PropertySet not found: "'+a+'"');n.push(c)}r=new cn(this.data,this,t,e.name,e.type,n),this.objects[t]=r,this.data.objects[t]=r,this.data.objectsByType[i]||(this.data.objectsByType[i]={}),this.data.objectsByType[i][t]=r,this.data.typeCounts[i]=void 0===this.data.typeCounts[i]?1:this.data.typeCounts[i]+1,r.models.push(this),this.data.onObjectCreated.dispatch(this.data,r)}return r},i.createRelationship=function(e){if(this.destroyed)return new he("Failed to create Relationship - DataModel already destroyed");if(this.built)return new he("Failed to create Relationship - DataModel already built");var t=this.data.objects[e.relatingObjectId];if(!t)return new he("Failed to create Relationship - relating DataObject not found: "+e.relatingObjectId);var i=this.data.objects[e.relatedObjectId];if(!i)return new he("Failed to create Relationship - related DataObject not found: "+e.relatedObjectId);var r=new ln(e.type,t,i);return i.relating[e.type]||(i.relating[e.type]=[]),i.relating[e.type].push(r),t.related[e.type]||(t.related[e.type]=[]),t.related[e.type].push(r),this.relationships.push(r),r},i.build=function(){var e=this;return new Promise(function(t){if(e.destroyed)throw new he("Failed to build DataModel - DataModel already destroyed");if(e.built)throw new he("Failed to build DataModel - DataModel already built");e.built=!0,e.onBuilt.dispatch(e,null),t(e)})},i.getJSON=function(){if(this.destroyed)return new he("DataModel already destroyed");var e={id:this.id,propertySets:[],objects:[],relationships:[]};for(var t in this.propertySets){for(var i,r=this.propertySets[t],n={id:t,name:r.name,properties:[],type:r.type,originalSystemId:r.originalSystemId},o=0,s=r.properties.length;o<s;o++){var a=r.properties[o];n.properties.push({name:a.name,value:a.value,type:a.type,valueType:a.valueType,description:a.description})}null==(i=e.propertySets)||i.push(n)}for(var c in this.objects){var l,h=this.objects[c],u={id:c,type:h.type,name:h.name,propertySetIds:[]};if(h.propertySets)for(var d=0,f=h.propertySets.length;d<f;d++){var v;null==(v=u.propertySetIds)||v.push(h.propertySets[d].id)}null==(l=e.objects)||l.push(u)}for(var p=0,y=this.relationships.length;p<y;p++){var m,b=this.relationships[p];null==(m=e.relationships)||m.push({type:b.type,relatingObjectId:b.relatingObject.id,relatedObjectId:b.relatedObject.id})}return e},i.destroy=function(){if(this.destroyed)return new he("Failed to destroy DataModel - DataModel already destroyed");for(var t in this.objects){var i=this.objects[t];if(i.models.length>1)f(this,un)[un](i);else{delete this.data.objects[t];var r=i.type;if(0==--this.data.typeCounts[r])for(var n in delete this.data.typeCounts[r],delete this.data.objectsByType[r],this.data.onObjectDestroyed.dispatch(this.data,i),i.relating)for(var o=i.relating[n],s=0,a=o.length;s<a;s++)for(var c=o[s].relatedObject.relating[n],l=0,h=c.length;l<h;l++)c[0].relatingObject===i&&(c[l]=c[l])}}f(this,hn)[hn]=!0,this.onBuilt.clear(),e.prototype.destroy.call(this)},t}(ae);function fn(e){for(var t=0,i=e.models.length;t<i;t++)if(e.models[t]===this){e.models=e.models.splice(t,1);break}}var vn=/*#__PURE__*/function(e){function t(){var t;return(t=e.call(this,null,{})||this).models=void 0,t.propertySets=void 0,t.objects=void 0,t.rootObjects=void 0,t.objectsByType=void 0,t.typeCounts=void 0,t.onModelCreated=void 0,t.onModelDestroyed=void 0,t.onObjectCreated=void 0,t.onObjectDestroyed=void 0,t.models={},t.propertySets={},t.objects={},t.rootObjects={},t.objectsByType={},t.typeCounts={},t.onModelCreated=new p(new te.EventDispatcher),t.onModelDestroyed=new p(new te.EventDispatcher),t.onObjectCreated=new p(new te.EventDispatcher),t.onObjectDestroyed=new p(new te.EventDispatcher),t}r(t,e);var i=t.prototype;return i.createModel=function(e,t){var i=this;if(this.destroyed)return new he("Data already destroyed");var r=e.id;if(this.models[r])return new he("DataModel already created in this Data: "+r);var n=new dn(this,r,e,t);return this.models[n.id]=n,n.onDestroyed.one(function(){delete i.models[n.id],i.onModelDestroyed.dispatch(i,n)}),n.onBuilt.one(function(){i.onModelCreated.dispatch(i,n)}),n},i.getObjectIdsByType=function(e){if(this.destroyed)return new he("Data already destroyed");var t=this.objectsByType[e];return t?Object.keys(t):[]},i.searchObjects=function(e){if(this.destroyed)return new he("Data already destroyed");var t=e.includeObjects&&e.includeObjects.length>0?pn(e.includeObjects):null,i=e.excludeObjects&&e.excludeObjects.length>0?pn(e.excludeObjects):null,r=e.includeRelating&&e.includeRelating.length>0?pn(e.includeRelating):null,n=e.excludeRelating&&e.excludeRelating.length>0?pn(e.excludeRelating):null;function o(s,a){if(s){var c=!0;(i&&i[s.type]||t&&!t[s.type])&&(c=!1),0===a&&!1===e.includeStart&&(c=!1),c&&(e.resultObjectIds?e.resultObjectIds.push(s.id):e.resultObjects?e.resultObjects.push(s):e.resultCallback&&e.resultCallback(s));var l=s.related;for(var h in l){var u=l[h];if(u)for(var d=0,f=u.length;d<f;d++){var v=!0;(n&&n[s.type]||r&&!r[s.type])&&(v=!1),v&&o(u[d].relatedObject,a+1)}}}}if(e.startObjectId){var s=this.objects[e.startObjectId];if(!s)return new he('Failed to search DataObjects - starting DataObject not found in Data: "'+e.startObjectId+'"');o(s,0)}else if(e.startObject){if(e.startObject.data!=this)return new he('Failed to search DataObjects - starting DataObject not in same Data: "'+e.startObjectId+'"');o(e.startObject,1)}else for(var a in this.rootObjects)o(this.rootObjects[a],1)},i.clear=function(){if(this.destroyed)return new he("Data already destroyed");for(var e in this.models)this.models[e].destroy()},i.destroy=function(){if(this.destroyed)return new he("Data already destroyed");this.clear(),this.onModelCreated.clear(),this.onModelDestroyed.clear(),e.prototype.destroy.call(this)},t}(ae);function pn(e){for(var t={},i=0,r=e.length;i<r;i++)t[e[i]]=!0;return t}var yn={__proto__:null,Data:vn,DataModel:dn,DataObject:cn,Relationship:ln,Property:sn,PropertySet:an},mn=function(e){this.positionsCompressed=void 0,this.uvsCompressed=void 0,this.colorsCompressed=void 0,this.indices=void 0,this.edgeIndices=void 0,this.positionsCompressed=e.positionsCompressed,this.uvsCompressed=e.uvsCompressed,this.colorsCompressed=e.colorsCompressed,this.indices=e.indices,this.edgeIndices=e.edgeIndices},bn=function(e){this.id=void 0,this.primitive=void 0,this.positionsDecompressMatrix=void 0,this.aabb=void 0,this.uvsDecompressMatrix=void 0,this.geometryBuckets=void 0,this.rendererGeometry=void 0,this.geometryBuckets=[];for(var t=0,i=e.geometryBuckets.length;t<i;t++)this.geometryBuckets[t]=new mn(e.geometryBuckets[t]);this.id=e.id,this.positionsDecompressMatrix=e.positionsDecompressMatrix,this.primitive=e.primitive},gn=/*#__PURE__*/d("positionsDecompressed"),wn=/*#__PURE__*/d("positionsWorld"),Pn=/*#__PURE__*/function(){function e(){this.object=void 0,this.mesh=void 0,this.meshIndex=void 0,this.geometry=void 0,this.geometryBucket=void 0,this.geometryBucketIndex=void 0,Object.defineProperty(this,gn,{writable:!0,value:void 0}),Object.defineProperty(this,wn,{writable:!0,value:void 0}),this.object=null,this.mesh=null,this.meshIndex=0,this.geometry=null,this.geometryBucket=null,this.geometryBucketIndex=0,f(this,gn)[gn]=null,f(this,wn)[wn]=null}return e.prototype.reset=function(){f(this,gn)[gn]=null,f(this,wn)[wn]=null},i(e,[{key:"totalGeometryBuckets",get:function(){var e=0;if(this.object)for(var t=0,i=this.object.meshes.length;t<i;t++)e+=this.object.meshes[t].geometry.geometryBuckets.length;return e}},{key:"numPrimitives",get:function(){var e=this.geometry.primitive;return this.geometryBucket.indices.length/(e===qe?3:e===ze?2:1)}},{key:"positionsDecompressed",get:function(){return f(this,gn)[gn]||(f(this,gn)[gn]=new Float32Array(this.geometryBucket.positionsCompressed.length),hr(this.geometryBucket.positionsCompressed,this.geometry.positionsDecompressMatrix,f(this,gn)[gn])),f(this,gn)[gn]}},{key:"positionsWorld",get:function(){if(!f(this,wn)[wn]){var e=this.positionsDecompressed;f(this,wn)[wn]=new Float64Array(e.length),vi(e,this.mesh.matrix,f(this,wn)[wn])}return f(this,wn)[wn]}},{key:"uvsDecompressed",get:function(){return null}}]),e}(),En=new Pn;function Tn(e,t){En.reset(),En.object=e;for(var i=0,r=e.meshes.length;i<r;i++){var n=e.meshes[i];En.mesh=n,En.meshIndex=i;var o=n.geometry;En.geometry=o;for(var s=0,a=o.geometryBuckets.length;s<a;s++)if(En.geometryBucket=o.geometryBuckets[s],En.geometryBucketIndex=s,t(En))return!0}return!1}var _n=/*#__PURE__*/d("aabb"),In=/*#__PURE__*/d("aabbDirty"),xn=/*#__PURE__*/function(){function e(e){this.model=void 0,this.id=void 0,this.meshes=void 0,this.layerId=void 0,this.rendererObject=void 0,Object.defineProperty(this,_n,{writable:!0,value:void 0}),Object.defineProperty(this,In,{writable:!0,value:void 0}),this.id=e.id,this.layerId=e.layerId,this.meshes=e.meshes,f(this,_n)[_n]=Er(),f(this,In)[In]=!0,this.rendererObject=null}return e.prototype.setAABBDirty=function(){f(this,In)[In]=!0},i(e,[{key:"aabb",get:function(){var e=this;return f(this,In)[In]&&(jr(f(this,_n)[_n]),Tn(this,function(t){return Cr(f(e,_n)[_n],t.positionsWorld),!1}),f(this,In)[In]=!1),f(this,_n)[_n]}}]),e}(),Sn=function(e,t){this.id=void 0,this.colorTexture=void 0,this.metallicRoughnessTexture=void 0,this.occlusionTexture=void 0,this.emissiveTexture=void 0,this.rendererTextureSet=void 0,this.id=e.id,this.colorTexture=t.colorTexture,this.metallicRoughnessTexture=t.metallicRoughnessTexture,this.occlusionTexture=t.occlusionTexture,this.emissiveTexture=t.emissiveTexture,this.rendererTextureSet=null},Mn=function(e){this.rendererTexture=void 0,this.id=void 0,this.src=void 0,this.imageData=void 0,this.buffers=void 0,this.image=void 0,this.height=void 0,this.width=void 0,this.compressed=void 0,this.mediaType=void 0,this.magFilter=void 0,this.minFilter=void 0,this.wrapS=void 0,this.wrapT=void 0,this.wrapR=void 0,this.flipY=void 0,this.encoding=void 0,this.preloadColor=void 0,this.channel=void 0,this.id=e.id,this.imageData=e.imageData,this.src=e.src,this.mediaType=e.mediaType,this.minFilter=e.minFilter||pe,this.magFilter=e.magFilter||pe,this.wrapS=e.wrapS||de,this.wrapT=e.wrapT||de,this.wrapR=e.wrapR||de,this.encoding=e.encoding||We,this.preloadColor=Pt(e.preloadColor||[1,1,1,1]),this.channel=0,this.rendererTexture=null},On=/*#__PURE__*/d("color"),jn=/*#__PURE__*/d("matrix"),Rn=/*#__PURE__*/d("metallic"),Dn=/*#__PURE__*/d("roughness"),An=/*#__PURE__*/d("opacity"),Cn=/*#__PURE__*/function(){function e(e){this.id=void 0,this.geometry=void 0,this.textureSet=void 0,this.rendererMesh=void 0,this.object=void 0,Object.defineProperty(this,On,{writable:!0,value:void 0}),Object.defineProperty(this,jn,{writable:!0,value:void 0}),Object.defineProperty(this,Rn,{writable:!0,value:void 0}),Object.defineProperty(this,Dn,{writable:!0,value:void 0}),Object.defineProperty(this,An,{writable:!0,value:void 0}),this.id=e.id,f(this,jn)[jn]=e.matrix?Zt(e.matrix):ri(),this.geometry=e.geometry,this.textureSet=e.textureSet,this.rendererMesh=null,this.color=e.color||wt([1,1,1]),this.metallic=null!=e.metallic?e.metallic:0,this.roughness=null!=e.roughness?e.roughness:1,this.opacity=null!=e.opacity?e.opacity:1}return i(e,[{key:"color",get:function(){return f(this,On)[On]},set:function(e){var t=f(this,On)[On];t||((t=f(this,On)[On]=new Float32Array(4))[3]=1),e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.rendererMesh&&this.rendererMesh.setColor(f(this,On)[On])}},{key:"matrix",get:function(){return f(this,jn)[jn]},set:function(e){e?f(this,jn)[jn].set(e):ri(f(this,jn)[jn]),this.rendererMesh&&this.rendererMesh.setMatrix(f(this,jn)[jn]),this.object&&this.object.setAABBDirty()}},{key:"metallic",get:function(){return f(this,Rn)[Rn]},set:function(e){e=null!=e?e:1,f(this,Rn)[Rn]!==e&&(f(this,Rn)[Rn]=e,this.rendererMesh&&this.rendererMesh.setMetallic(f(this,Rn)[Rn]))}},{key:"roughness",get:function(){return f(this,Dn)[Dn]},set:function(e){e=null!=e?e:1,f(this,Dn)[Dn]!==e&&(f(this,Dn)[Dn]=e,this.rendererMesh&&this.rendererMesh.setRoughness(f(this,Dn)[Dn]))}},{key:"opacity",get:function(){return f(this,An)[An]},set:function(e){e=null!=e?e:1,f(this,An)[An]!==e&&(f(this,An)[An]=e)}}]),e}(),kn=[],Bn=[],Ln=[],Fn=[],Un=[],Nn=0,Vn=new Uint16Array(3),Gn=new Uint16Array(3),Hn=new Uint16Array(3),Xn=wt(),Wn=wt(),Yn=wt(),Kn=wt(),zn=wt(),qn=wt(),Zn=wt(),Qn=null;function Jn(e,t){for(var i,r=0;r<3;r++)if(0!=(i=Qn[3*e+r]-Qn[3*t+r]))return i;return 0}var $n=null,eo=null;function to(e,t){var i,r,n,o,s,a,c=3*e,l=3*t,h=Math.min(i=eo[c],r=eo[c+1],n=eo[c+2]),u=Math.min(o=eo[l],s=eo[l+1],a=eo[l+2]);if(h!=u)return h-u;var d=Math.max(i,r,n),f=Math.max(o,s,a);return d!=f?d-f:0}function io(e){var t=Zt(),i=jr();Cr(i,e.positions);var r,n=pr(e.positions,i,t),o=e.primitive!==Ze&&e.primitive!==Qe&&e.primitive!==qe||!e.indices?null:function(e,t,i,r){!function(e,t){var i,r,n,o,s,a,c={},l=Math.pow(10,4),h=0;for(s=0,a=e.length;s<a;s+=3)i=e[s],r=e[s+1],n=e[s+2],void 0===c[o=Math.round(i*l)+"_"+Math.round(r*l)+"_"+Math.round(n*l)]&&(c[o]=h/3,kn[h++]=i,kn[h++]=r,kn[h++]=n),Bn[s/3]=c[o];for(s=0,a=t.length;s<a;s++)Fn[s]=Bn[t[s]],Ln[Fn[s]]=t[s]}(e,t),function(e,t){Nn=0;for(var i=0,r=e;i<r;i+=3){var n=3*Fn[i],o=3*Fn[i+1],s=3*Fn[i+2];t?(Vn[0]=kn[n],Vn[1]=kn[n+1],Vn[2]=kn[n+2],Gn[0]=kn[o],Gn[1]=kn[o+1],Gn[2]=kn[o+2],Hn[0]=kn[s],Hn[1]=kn[s+1],Hn[2]=kn[s+2],lr(Vn,t,Xn),lr(Gn,t,Wn),lr(Hn,t,Yn)):(Xn[0]=kn[n],Xn[1]=kn[n+1],Xn[2]=kn[n+2],Wn[0]=kn[o],Wn[1]=kn[o+1],Wn[2]=kn[o+2],Yn[0]=kn[s],Yn[1]=kn[s+1],Yn[2]=kn[s+2]),Mt(Yn,Wn,Kn),Mt(Xn,Wn,zn),At(Kn,zn,qn),Yt(qn,Zn);var a=Un[Nn]||(Un[Nn]={normal:wt()});a.normal[0]=Zn[0],a.normal[1]=Zn[1],a.normal[2]=Zn[2],Nn++}}(t.length,i);for(var n,o,s,a,c,l,h,u,d=[],f=Math.cos(10*at),v={},p=!1,y=0,m=t.length;y<m;y+=3)for(var b=y/3,g=0;g<3;g++)n=Fn[y+g],o=Fn[y+(g+1)%3],void 0===v[c=(s=Math.min(n,o))+","+(a=Math.max(n,o))]?v[c]={index1:s,index2:a,face1:b,face2:void 0}:v[c].face2=b;for(c in v)void 0!==(l=v[c]).face2&&bt(Un[l.face1].normal,Un[l.face2].normal)>f||(h=Ln[l.index1],u=Ln[l.index2],(!p&&h>65535||u>65535)&&(p=!0),d.push(h),d.push(u));return p?new Uint32Array(d):new Uint16Array(d)}(n,e.indices,t),s=function(e){var t=e.positionsCompressed,i=e.indices,r=e.edgeIndices;!function(e){if(!(null!==$n&&$n.length>=e)){$n=new Uint32Array(e);for(var t=0;t<e;t++)$n[t]=t}}(t.length/3);var n=$n.slice(0,t.length/3),o=$n.slice(0,t.length/3);Qn=t,n.sort(Jn);var s=0;o[n[0]]=0;for(var a=1,c=n.length;a<c;a++)0!=Jn(n[a],n[a-1])&&s++,o[n[a]]=s;var l=new Uint16Array(3*(s+1));l[3*(s=0)+0]=t[3*n[0]+0],l[3*s+1]=t[3*n[0]+1],l[3*s+2]=t[3*n[0]+2];for(var h=1,u=n.length;h<u;h++)0!==Jn(n[h],n[h-1])&&(l[3*++s+0]=t[3*n[h]+0],l[3*s+1]=t[3*n[h]+1],l[3*s+2]=t[3*n[h]+2]),o[n[h]]=s;Qn=null;for(var d,f=new Uint32Array(i.length),v=0,p=i.length;v<p;v++)f[v]=o[i[v]];if(r){d=new Uint32Array(r.length);for(var y=0,m=r.length;y<m;y++)d[y]=o[r[y]]}return[l,f,d]}({positionsCompressed:n,uvs:e.uvs,indices:e.indices,edgeIndices:o}),a=function(e,t,i){void 0===i&&(i=!1);var r=e.positionsCompressed||[],n=function(e,t){for(var i=new Int32Array(e.length/3),r=0,n=i.length;r<n;r++)i[r]=r;eo=new Int32Array(e.length);for(var o=0,s=e.length;o<s;o++)eo[o]=e[o]>>t;i.sort(to);for(var a=new Int32Array(e.length),c=0,l=i.length;c<l;c++)a[3*c+0]=e[3*i[c]+0],a[3*c+1]=e[3*i[c]+1],a[3*c+2]=e[3*i[c]+2];return a}(e.indices||[],t),o=[];function s(e,t){if(e>t){var i=e;e=t,t=i}function r(i,r){return i!=e?e-i:r!=t?t-r:0}for(var n=0,s=(o.length>>1)-1;n<=s;){var a=s+n>>1,c=r(o[2*a],o[2*a+1]);if(c>0)n=a+1;else{if(!(c<0))return a;s=a-1}}return-n-1}var a=new Int32Array(o.length/2);a.fill(0);var c=r.length/3;if(c>8*(1<<t))return[e];var l=new Int32Array(c);l.fill(-1);var h=[];function u(){l.fill(-1);var e={positionsCompressed:[],indices:[],edgeIndices:[],maxNumPositions:(1<<t)-t,numPositions:0,bucketNumber:h.length};return h.push(e),e}for(var d=u(),f=0,v=n.length;f<v;f+=3){var p=0,y=n[f],m=n[f+1],b=n[f+2];if(-1==l[y]&&p++,-1==l[m]&&p++,-1==l[b]&&p++,p+d.numPositions>d.maxNumPositions&&(d=u()),d.bucketNumber>8)return[e];-1==l[y]&&(l[y]=d.numPositions++,d.positionsCompressed.push(r[3*y]),d.positionsCompressed.push(r[3*y+1]),d.positionsCompressed.push(r[3*y+2])),-1==l[m]&&(l[m]=d.numPositions++,d.positionsCompressed.push(r[3*m]),d.positionsCompressed.push(r[3*m+1]),d.positionsCompressed.push(r[3*m+2])),-1==l[b]&&(l[b]=d.numPositions++,d.positionsCompressed.push(r[3*b]),d.positionsCompressed.push(r[3*b+1]),d.positionsCompressed.push(r[3*b+2])),d.indices.push(l[y]),d.indices.push(l[m]),d.indices.push(l[b]);var g=void 0;(g=s(y,m))>=0&&0==a[g]&&(a[g]=1,d.edgeIndices.push(l[o[2*g]]),d.edgeIndices.push(l[o[2*g+1]])),(g=s(y,b))>=0&&0==a[g]&&(a[g]=1,d.edgeIndices.push(l[o[2*g]]),d.edgeIndices.push(l[o[2*g+1]])),(g=s(m,b))>=0&&0==a[g]&&(a[g]=1,d.edgeIndices.push(l[o[2*g]]),d.edgeIndices.push(l[o[2*g+1]]))}var w=t/8,P=2*r.length+(n.length+o.length)*(t/8*2),E=0;return h.forEach(function(e){E+=2*e.positionsCompressed.length+(e.indices.length+e.edgeIndices.length)*w}),E>P?[e]:(i&&function(e,t){var i={};e.forEach(function(e){for(var t=e.indices,r=e.edgeIndices,n=e.positionsCompressed,o=0,s=t.length;o<s;o+=3)i[n[3*t[o]]+"_"+n[3*t[o]+1]+"_"+n[3*t[o]+2]+"/"+n[3*t[o+1]]+"_"+n[3*t[o+1]+1]+"_"+n[3*t[o+1]+2]+"/"+n[3*t[o+2]]+"_"+n[3*t[o+2]+1]+"_"+n[3*t[o+2]+2]]=!0;for(o=0,s=r.length;o<s;o+=2);});for(var r=t.indices,n=t.positionsCompressed,o=0,s=r.length;o<s;o+=3){var a=n[3*r[o]]+"_"+n[3*r[o]+1]+"_"+n[3*r[o]+2]+"/"+n[3*r[o+1]]+"_"+n[3*r[o+1]+1]+"_"+n[3*r[o+1]+2]+"/"+n[3*r[o+2]]+"_"+n[3*r[o+2]+1]+"_"+n[3*r[o+2]+2];if(!(a in i))throw console.log("Not found "+a),"Ohhhh!"}}(h,e),h)}({positionsCompressed:r=s[0],indices:s[1],edgeIndices:s[2]},r.length/3>65536?16:8);return{id:e.id,primitive:e.primitive===Ze&&a.length>1?qe:e.primitive,aabb:i,positionsDecompressMatrix:t,uvsDecompressMatrix:void 0,geometryBuckets:a}}var ro=/*#__PURE__*/d("texturesList"),no=/*#__PURE__*/d("numObjects"),oo=/*#__PURE__*/d("meshUsedByObject"),so=/*#__PURE__*/d("removeUnusedTextures"),ao=/*#__PURE__*/function(e){function t(t,i){var r;return r=e.call(this,t,{id:i.id})||this,Object.defineProperty(c(r),so,{value:co}),r.scene=void 0,r.layerId=void 0,r.built=void 0,r.edgeThreshold=void 0,r.geometries=void 0,r.textures=void 0,r.textureSets=void 0,r.meshes=void 0,r.objects=void 0,r.aabb=void 0,r.onBuilt=void 0,r.rendererModel=void 0,r.stats=void 0,Object.defineProperty(c(r),ro,{writable:!0,value:void 0}),Object.defineProperty(c(r),no,{writable:!0,value:void 0}),Object.defineProperty(c(r),oo,{writable:!0,value:void 0}),r.scene=t,r.onBuilt=new p(new te.EventDispatcher),r.onDestroyed=new p(new te.EventDispatcher),f(c(r),no)[no]=0,f(c(r),oo)[oo]={},r.id=i.id||"default",r.layerId=i.layerId,r.edgeThreshold=10,r.geometries={},r.textures={},f(c(r),ro)[ro]=[],r.textureSets={},r.meshes={},r.objects={},r.aabb=Er(),r.built=!1,r.rendererModel=null,r.stats={numGeometries:0,numLines:0,numMeshes:0,numObjects:0,numPoints:0,numTextureSets:0,numTextures:0,numTriangles:0,numVertices:0,textureBytes:0},r.fromJSON(i),r}r(t,e);var i=t.prototype;return i.fromJSON=function(e){if(this.destroyed)return new he("Failed to add components to SceneModel - SceneModel already destroyed");if(this.built)return new he("Failed to add components to SceneModel - SceneModel already built");if(e.geometries)for(var t=0,i=e.geometries.length;t<i;t++)this.createGeometry(e.geometries[t]);if(e.textures)for(var r=0,n=e.textures.length;r<n;r++)this.createTexture(e.textures[r]);if(e.textureSets)for(var o=0,s=e.textureSets.length;o<s;o++)this.createTextureSet(e.textureSets[o]);if(e.meshes)for(var a=0,c=e.meshes.length;a<c;a++)this.createMesh(e.meshes[a]);if(e.objects)for(var l=0,h=e.objects.length;l<h;l++)this.createObject(e.objects[l])},i.createTransform=function(e){return this.destroyed?new he("Failed to create Transform in SceneModel - SceneModel already destroyed"):this.built?new he("Failed to create Transform in SceneModel - SceneModel already built"):void 0},i.createTexture=function(e){if(this.destroyed)return new he("Failed to create Texture in SceneModel - SceneModel already destroyed");if(this.built)return new he("Failed to create Texture in SceneModel - SceneModel already built");if(!e.imageData&&!e.src&&!e.buffers)return new he("Failed to create Texture in SceneModel - Parameter expected: textureParams.imageData, textureParams.src or textureParams.buffers");if(this.textures[e.id])return new he("Failed to create Texture in SceneModel - Texture already exists with this ID: "+e.id);e.src&&e.src.split(".").pop(),e.imageData&&(this.stats.textureBytes+=e.imageData.width*e.imageData.height*4);var t=new Mn(e);return this.textures[e.id]=t,f(this,ro)[ro].push(t),this.stats.numTextures++,t},i.createTextureSet=function(e){if(this.destroyed)return new he("Failed to create TextureSet in SceneModel - SceneModel already destroyed");if(this.built)return new he("Failed to create TextureSet in SceneModel - SceneModel already built");if(this.textureSets[e.id])return new he("Failed to create TextureSet in SceneModel - TextureSet already exists with this ID: "+e.id);var t,i,r,n,o;if(null!=e.colorTextureId){if(!(t=this.textures[e.colorTextureId]))return new he("Failed to create TextureSet in SceneModel - Texture not found: "+e.colorTextureId+" - ensure that you create it first with createTexture()");t.channel=0}if(null!=e.metallicRoughnessTextureId){if(!(i=this.textures[e.metallicRoughnessTextureId]))return new he("Failed to create TextureSet in SceneModel - Texture not found: "+e.metallicRoughnessTextureId+" - ensure that you create it first with createTexture()");i.channel=1}if(null!=e.normalsTextureId){if(!(r=this.textures[e.normalsTextureId]))return new he("Failed to create TextureSet in SceneModel - Texture not found: "+e.normalsTextureId+" - ensure that you create it first with createTexture()");r.channel=2}if(null!=e.emissiveTextureId){if(!(n=this.textures[e.emissiveTextureId]))return new he("Failed to create TextureSet in SceneModel - Texture not found: "+e.emissiveTextureId+" - ensure that you create it first with createTexture()");n.channel=3}if(null!=e.occlusionTextureId){if(!(o=this.textures[e.occlusionTextureId]))return new he("Failed to create TextureSet in SceneModel - Texture not found: "+e.occlusionTextureId+" - ensure that you create it first with createTexture()");o.channel=4}var s=new Sn(e,{emissiveTexture:n,occlusionTexture:o,metallicRoughnessTexture:i,colorTexture:t});return this.textureSets[e.id]=s,this.stats.numTextureSets++,s},i.createGeometry=function(e){if(this.destroyed)return new he("Failed to create Geometry in SceneModel - SceneModel already destroyed");if(this.built)return new he("Failed to create Geometry in SceneModel - SceneModel already built");if(!e)return new he("Failed to create Geometry in SceneModel - Parameters expected: geometryParams");if(null==e.id)return new he("Failed to create Geometry in SceneModel - Parameter expected: geometryParams.id");var t=e.id;if(this.geometries[t])return new he("Failed to create Geometry in SceneModel - Geometry with this ID already created: "+t);var i=e.primitive;if(i!==Ke&&i!==ze&&i!==qe&&i!==Ze&&i!==Qe)return new he("Failed to create Geometry in SceneModel - Unsupported value for geometryParams.primitive: '"+i+"' - supported values are PointsPrimitive, LinesPrimitive, TrianglesPrimitive, SolidPrimitive and SurfacePrimitive");if(!e.positions)return new he("Failed to create Geometry in SceneModel - Param expected: geometryParams.positions");if(!e.indices&&i!==Ke)return new he("Failed to create Geometry in SceneModel - Param expected: geometryParams.indices (required for primitive type)");if(e.uvs&&e.uvs.length/2!=e.positions.length/3)return new he("Failed to create Geometry in SceneModel - mismatch between given quantities of vertex positions and UVs");if(e.indices)for(var r=e.positions.length/3,n=0,o=e.indices.length;n<o;n++){var s=e.indices[n];if(s<0||s>=r)return new he("Failed to create Geometry in SceneModel - indices out of range of vertex positions");if(e.uvs&&(s<0||s>=e.uvs.length/2))return new he("Failed to create Geometry in SceneModel - indices out of range of vertex UVs")}var a=new bn(io(e));return this.geometries[t]=a,this.stats.numGeometries++,e.indices?a.primitive===qe?this.stats.numTriangles+=e.indices.length/3:a.primitive===ze&&(this.stats.numLines+=e.indices.length/2):a.primitive===Ke&&(this.stats.numPoints+=e.positions.length/3),this.stats.numVertices+=e.positions.length/3,a},i.createGeometryCompressed=function(e){if(this.destroyed)return new he("Failed to add compressed Geometry to SceneModel - SceneModel already destroyed");if(this.built)return new he("Failed to add compressed Geometry to SceneModel - SceneModel already built");if(!e)return new he("Failed to add compressed Geometry to SceneModel - Parameters expected: geometryCompressedParams");var t=e.id;if(this.geometries[t])return new he("Failed to add compressed Geometry to SceneModel - Geometry with this ID already created: "+t);var i=e.primitive;if(i!==Ke&&i!==ze&&i!==qe&&i!==Ze&&i!==Qe)return new he("Failed to add compressed Geometry to SceneModel - Unsupported value for geometryCompressedParams.primitive: '"+i+"' - supported values are PointsPrimitive, LinesPrimitive, TrianglesPrimitive, SolidPrimitive and SurfacePrimitive");var r=new bn(e);return this.geometries[t]=r,this.stats.numGeometries++,r},i.createMesh=function(e){if(this.destroyed)return new he("Failed to create Mesh in SceneModel - SceneModel already destroyed");if(this.built)return new he("Failed to create Mesh in SceneModel - SceneModel already built");if(this.meshes[e.id])return new he("Failed to create Mesh in SceneModel - Mesh already exists with this ID: "+e.id);var t=this.geometries[e.geometryId];if(!t)return new he("Failed to create Mesh in SceneModel - Geometry not found: "+e.geometryId);var i=e.textureSetId?this.textureSets[e.textureSetId]:void 0;if(e.textureSetId&&!i)return new he("Failed to create Mesh in SceneModel - TextureSet not found: "+e.textureSetId);var r=new Cn({id:e.id,geometry:t,textureSet:i,matrix:e.matrix,color:e.color,opacity:e.opacity,roughness:e.roughness,metallic:e.metallic});return this.meshes[e.id]=r,this.stats.numMeshes++,r},i.createObject=function(e){if(this.destroyed)return new he("Failed to create SceneObject - SceneModel already destroyed");if(this.built)return new he("Failed to create SceneObject SceneModel already built");if(0===e.meshIds.length)return new he("Failed to create SceneObject - no meshes specified");if(this.scene.objects[e.id])return new he("Failed to create SceneObject - SceneObject already exists in Scene: "+e.id);for(var t=e.meshIds,i=[],r=0,n=t.length;r<n;r++){var o=t[r],s=this.meshes[o];if(!s)return new he("Failed to create SceneObject - Mesh not found: "+o);if(f(this,oo)[oo][o])return new he("Failed to create SceneObject - Mesh "+o+" already belongs to another SceneObject");i.push(s),f(this,oo)[oo][s.id]=!0}for(var a=new xn({id:e.id,layerId:e.layerId||this.layerId,model:this,meshes:i}),c=0,l=i.length;c<l;c++)i[c].object=a;return f(this,no)[no]++,this.objects[e.id]=a,this.stats.numObjects++,a},i.build=function(){var e=this;return new Promise(function(t){if(e.destroyed)throw new he("Failed to build SceneModel - SceneModel already destroyed");if(e.built)throw new he("Failed to build SceneModel - SceneModel already built");f(e,so)[so](),e.built=!0,e.onBuilt.dispatch(e,null),t(e)})},t}(ae);function co(){}var lo=/*#__PURE__*/d("onModelBuilts"),ho=/*#__PURE__*/d("onModelDestroys"),uo=/*#__PURE__*/d("center"),fo=/*#__PURE__*/d("aabbDirty"),vo=/*#__PURE__*/d("aabb"),po=/*#__PURE__*/d("registerObjects"),yo=/*#__PURE__*/d("deregisterObjects"),mo=/*#__PURE__*/function(e){function t(){var t;return t=e.call(this,null,{})||this,Object.defineProperty(c(t),yo,{value:go}),Object.defineProperty(c(t),po,{value:bo}),t.models=void 0,t.objects=void 0,t.onModelCreated=void 0,t.onModelDestroyed=void 0,Object.defineProperty(c(t),lo,{writable:!0,value:void 0}),Object.defineProperty(c(t),ho,{writable:!0,value:void 0}),Object.defineProperty(c(t),uo,{writable:!0,value:void 0}),Object.defineProperty(c(t),fo,{writable:!0,value:void 0}),Object.defineProperty(c(t),vo,{writable:!0,value:void 0}),f(c(t),vo)[vo]=Er(),f(c(t),fo)[fo]=!0,t.models={},t.objects={},f(c(t),lo)[lo]={},f(c(t),ho)[ho]={},t.onModelCreated=new p(new te.EventDispatcher),t.onModelDestroyed=new p(new te.EventDispatcher),t}r(t,e);var n=t.prototype;return n.createModel=function(e){var t=this;if(this.destroyed)return new he("Scene already destroyed");var i=e.id;if(this.models[i])return new he("SceneModel already created in this Scene: "+i);var r=new ao(this,e);return this.models[i]=r,r.onDestroyed.one(function(){delete t.models[r.id],f(t,yo)[yo](r),t.onModelDestroyed.dispatch(t,r)}),r.onBuilt.one(function(){f(t,po)[po](r),t.onModelCreated.dispatch(t,r)}),r},n.setAABBDirty=function(){f(this,fo)[fo]||(f(this,fo)[fo]=!0)},n.clear=function(){if(this.destroyed)return new he("Scene already destroyed");for(var e in this.models)this.models[e].destroy()},n.destroy=function(){this.clear(),this.onModelCreated.clear(),this.onModelDestroyed.clear(),e.prototype.destroy.call(this)},i(t,[{key:"center",get:function(){if(f(this,fo)[fo]){var e=this.aabb;f(this,uo)[uo][0]=(e[0]+e[3])/2,f(this,uo)[uo][1]=(e[1]+e[4])/2,f(this,uo)[uo][2]=(e[2]+e[5])/2}return f(this,uo)[uo]}},{key:"aabb",get:function(){if(f(this,fo)[fo]){var e,t=st,i=st,r=st,n=ot,o=ot,s=ot,a=this.objects,c=!1;for(var l in a)a.hasOwnProperty(l)&&((e=a[l].aabb)[0]<t&&(t=e[0]),e[1]<i&&(i=e[1]),e[2]<r&&(r=e[2]),e[3]>n&&(n=e[3]),e[4]>o&&(o=e[4]),e[5]>s&&(s=e[5]),c=!0);c||(t=-100,i=-100,r=-100,n=100,o=100,s=100),f(this,vo)[vo][0]=t,f(this,vo)[vo][1]=i,f(this,vo)[vo][2]=r,f(this,vo)[vo][3]=n,f(this,vo)[vo][4]=o,f(this,vo)[vo][5]=s,f(this,fo)[fo]=!1}return f(this,vo)[vo]}}]),t}(ae);function bo(e){var t=e.objects;for(var i in t){var r=t[i];this.objects[r.id]=r}f(this,fo)[fo]=!0}function go(e){var t=e.objects;for(var i in t)delete this.objects[t[i].id];f(this,fo)[fo]=!0}var wo={__proto__:null,Scene:mo,SceneModel:ao,SceneObject:xn,Texture:Mn,TextureSet:Sn,Geometry:bn,GeometryBucket:mn,Mesh:Cn,compressGeometryParams:io,getSceneObjectGeometry:Tn},Po=new Float32Array(2),Eo=/*#__PURE__*/d("insertItem"),To=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,Eo,{value:_o}),this.root=void 0,this.maxDepth=void 0,this.maxDepth=(null==e?void 0:e.maxDepth)||10,this.root={aabb:e.aabb.slice()}}return e.prototype.insertItem=function(e,t){f(this,Eo)[Eo](this.root,{item:e},t,1)},e}();function _o(e,t,i,r){if(r>=this.maxDepth)return e.items=e.items||[],void e.items.push(t);if(e.left&&Ir(e.left.aabb,i))f(this,Eo)[Eo](e.left,t,i,r+1);else if(e.right&&Ir(e.right.aabb,i))f(this,Eo)[Eo](e.right,t,i,r+1);else{var n=e.aabb;Po[0]=n[2]-n[0],Po[1]=n[3]-n[1];var o=0;if(Po[1]>Po[o]&&(o=1),!e.left){var s=n.slice();if(s[o+2]=(n[o]+n[o+2])/2,e.left={aabb:s},Ir(s,i))return void f(this,Eo)[Eo](e.left,t,i,r+1)}if(!e.right){var a=n.slice();if(a[o]=(n[o]+n[o+2])/2,e.right={aabb:a},Ir(a,i))return void f(this,Eo)[Eo](e.right,t,i,r+1)}e.items=e.items||[],e.items.push(t)}}var Io={__proto__:null,KdVertex2:function(){this.sceneObject=void 0,this.worldPos=void 0,this.canvasPos=void 0},KdTree2:To,createKdTree2FromSceneObjectVerts:function(e){var t=new To({aabb:e.canvasBoundary}),i=Zt(e.viewMatrix),r=Zt(e.projMatrix),n=Gr(i,r),o=e.canvasBoundary,s=e.sceneObjects;if(s)for(var a=0,c=s.length;a<c;a++)l(s[a]);function l(e,t){void 0===t&&(t=Ur),t!==Fr&&(t=Hr(n,e.aabb)),t!==Nr&&Tn(e,function(t){for(var i=t.positionsWorld,r=0,n=i.length;r<n;r+=3){var o=Pt();o[0]=i[r],o[1]=i[r+1],o[2]=i[r+2],o[3]=1,h(e,o)}return!1})}function h(e,n){var s=Pt(),a=Pt(),c=new Uint16Array(2);fi(i,n,s),fi(r,s,a),c[0]=Math.floor((1+a[0]/a[3])*o[2]/2),c[1]=Math.floor((1-a[1]/a[3])*o[3]/2),t.insertItem({sceneObject:e,worldPos:n,canvasPos:c},[c[0],c[1],c[0],c[1]])}return t},searchKdTree2ForNearestNeighbor:function(e){return[]}},xo=new Float32Array(3),So=/*#__PURE__*/d("root"),Mo=/*#__PURE__*/d("maxDepth"),Oo=/*#__PURE__*/d("numNodes"),jo=/*#__PURE__*/d("numObjects"),Ro=/*#__PURE__*/d("insertItem"),Do=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,Ro,{value:Ao}),Object.defineProperty(this,So,{writable:!0,value:void 0}),Object.defineProperty(this,Mo,{writable:!0,value:void 0}),Object.defineProperty(this,Oo,{writable:!0,value:void 0}),Object.defineProperty(this,jo,{writable:!0,value:void 0}),f(this,Mo)[Mo]=(null==e?void 0:e.maxDepth)||10,f(this,So)[So]={index:0,aabb:e.aabb.slice()},f(this,Oo)[Oo]=0}return e.prototype.insertItem=function(e,t){f(this,Ro)[Ro](f(this,So)[So],{index:f(this,jo)[jo]++,item:e},t,1)},i(e,[{key:"root",get:function(){return f(this,So)[So]}}]),e}();function Ao(e,t,i,r){if(r>=f(this,Mo)[Mo])return e.items=e.items||[],e.items.push(t),void Dr(e.aabb,i);if(e.left&&xr(e.left.aabb,i))f(this,Ro)[Ro](e.left,t,i,r+1);else if(e.right&&xr(e.right.aabb,i))f(this,Ro)[Ro](e.right,t,i,r+1);else{var n=e.aabb;xo[0]=n[3]-n[0],xo[1]=n[4]-n[1],xo[2]=n[5]-n[2];var o=0;if(xo[1]>xo[o]&&(o=1),xo[2]>xo[o]&&(o=2),!e.left){var s=n.slice();if(s[o+3]=(n[o]+n[o+3])/2,e.left={index:f(this,Oo)[Oo]++,aabb:s},xr(s,i))return void f(this,Ro)[Ro](e.left,t,i,r+1)}if(!e.right){var a=n.slice();if(a[o]=(n[o]+n[o+3])/2,e.right={index:f(this,Oo)[Oo]++,aabb:a},xr(a,i))return void f(this,Ro)[Ro](e.right,t,i,r+1)}e.items=e.items||[],e.items.push(t),Dr(e.aabb,i)}}var Co=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return r(t,e),t}(Do),ko=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return r(t,e),t}(Do),Bo=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return r(t,e),t}(Do),Lo=new Int16Array(6);function Fo(e,t,i){var r=e[3*t+1],n=e[3*t+2],o=Lo;o[0]=o[3]=e[3*t],o[1]=o[4]=r,o[2]=o[5]=n,i.insertItem({a:t},o)}function Uo(e,t,i,r){var n=e[3*t],o=e[3*t+1],s=e[3*t+2],a=e[3*i],c=e[3*i+1],l=e[3*i+2],h=Lo;h[0]=Math.min(n,a),h[1]=Math.min(o,c),h[2]=Math.min(s,l),h[3]=Math.max(n,a),h[4]=Math.max(o,c),h[5]=Math.max(s,l),r.insertItem({a:t,b:i},h)}function No(e,t,i,r,n){var o=e[3*t],s=e[3*t+1],a=e[3*t+2],c=e[3*i],l=e[3*i+1],h=e[3*i+2],u=e[3*r],d=e[3*r+1],f=e[3*r+2],v=Lo;v[0]=Math.min(o,c,u),v[1]=Math.min(s,l,d),v[2]=Math.min(a,h,f),v[3]=Math.max(o,c,u),v[4]=Math.max(s,l,d),v[5]=Math.max(a,h,f),n.insertItem({a:t,b:i,c:r},v)}var Vo,Go,Ho={__proto__:null,KdTree3:Do,createSceneObjectsKdTree3:function(e){for(var t=jr(),i=0,r=e.length;i<r;i++)Dr(t,e[i].aabb);for(var n=new Co({aabb:t}),o=0,s=e.length;o<s;o++){var a=e[o];n.insertItem(a,a.aabb)}return n},SceneObjectsPrimsKdTree3:ko,createSceneObjectPrimsKdTree3:function(e){var t=new Int16Array(6);function i(e,i,r,n,o){var s=r[3*n+1],a=r[3*n+2],c=t;c[0]=c[3]=r[3*n],c[1]=c[4]=s,c[2]=c[5]=a,o.insertItem({sceneObject:e,geometryBucket:i,prim:{a:n}},c)}function r(e,i,r,n,o,s){var a=r[3*n],c=r[3*n+1],l=r[3*n+2],h=r[3*o],u=r[3*o+1],d=r[3*o+2],f=t;f[0]=Math.min(a,h),f[1]=Math.min(c,u),f[2]=Math.min(l,d),f[3]=Math.max(a,h),f[4]=Math.max(c,u),f[5]=Math.max(l,d),s.insertItem({sceneObject:e,geometryBucket:i,prim:{a:n,b:o}},f)}function n(e,i,r,n,o,s,a){var c=r[3*n],l=r[3*n+1],h=r[3*n+2],u=r[3*o],d=r[3*o+1],f=r[3*o+2],v=r[3*s],p=r[3*s+1],y=r[3*s+2],m=t;m[0]=Math.min(c,u,v),m[1]=Math.min(l,d,p),m[2]=Math.min(h,f,y),m[3]=Math.max(c,u,v),m[4]=Math.max(l,d,p),m[5]=Math.max(h,f,y),a.insertItem({sceneObject:e,geometryBucket:i,prim:{a:n,b:o,c:s}},m)}for(var o=jr(),s=0,a=e.length;s<a;s++)Dr(o,e[s].aabb);for(var c=new ko({aabb:o}),l=function(){var t=e[h];Tn(t,function(e){var o=e.geometryBucket,s=e.positionsWorld,a=o.indices;switch(e.geometry.primitive){case Ke:for(var l=0,h=s.length/3;l<h;l++)i(t,o,s,l,c);break;case qe:if(a)for(var u=0,d=a.length;u<d;u+=3)n(t,o,s,a[u],a[u+1],a[u+2],c);break;case ze:if(a)for(var f=0,v=a.length;f<v;f+=2)r(t,o,s,a[f],a[f+1],c)}return!0})},h=0,u=e.length;h<u;h++)l();return c},createPrimsKdTree3:function(e,t,i){var r=new Bo({aabb:Cr(Tr(),t)});switch(e){case Ke:for(var n=0,o=t.length/3;n<o;n++)Fo(t,n,r);break;case qe:if(i)for(var s=0,a=i.length;s<a;s+=3)No(t,i[s],i[s+1],i[s+2],r);break;case ze:if(i)for(var c=0,l=i.length;c<l;c+=2)Uo(t,i[c],i[c+1],r)}return r},searchKdTree3WithAABB:function(e){var t=[];return function e(i,r){if(r!==Nr&&(r=Xr())!==Nr){var n=i.items;if(n&&n.length>0)for(var o=0,s=n.length;o<s;o++)t.push(n[o].item);i.left&&e(i.left,r),i.right&&e(i.right,r)}}(e.kdTree.root,Ur),t},searchKdTree3WithFrustum:function(e){var t=e.frustum,i=[];return function e(r,n){if(n!==Nr&&(n=Hr(t,r.aabb))!==Nr){var o=r.items;if(o&&o.length>0)for(var s=0,a=o.length;s<a;s++)i.push(o[s].item);r.left&&e(r.left,n),r.right&&e(r.right,n)}}(e.kdTree.root,Ur),i},searchKdTree3WithRay:function(e){var t=[];return function e(i,r){if(r!==Nr&&(r=0)!==Nr){var n=i.items;if(n&&n.length>0)for(var o=0,s=n.length;o<s;o++)t.push(n[o].item);i.left&&e(i.left,r),i.right&&e(i.right,r)}}(e.kdTree.root,Ur),t},PrimsKdTree3:Bo,SceneObjectsKdTree3:Co},Xo=1001,Wo=((Vo={})[1e3]="BasicEntity",Vo[1001]="BasicAggregation",Vo),Yo={__proto__:null,BasicEntity:1e3,BasicAggregation:Xo,typeNames:Wo,typeCodes:{BasicEntity:1e3,BasicAggregation:Xo}},Ko=2023,zo=2026,qo=((Go={})[2e3]="Bridge",Go[2001]="BridgePart",Go[2002]="BridgeInstallation",Go[2003]="BridgeConstructiveElement",Go[2004]="BridgeRoom",Go[2005]="BridgeFurniture",Go[2006]="Building",Go[2007]="BuildingPart",Go[2008]="BuildingInstallation",Go[2009]="BuildingConstructiveElement",Go[2010]="BuildingFurniture",Go[2011]="BuildingStorey",Go[2012]="BuildingRoom",Go[2013]="BuildingUnit",Go[2014]="CityFurniture",Go[2015]="CityObjectGroup",Go[2016]="LandUse",Go[2017]="OtherConstruction",Go[2018]="PlantCover",Go[2019]="SolitaryVegetationObject",Go[2020]="TINRelief",Go[2021]="TransportationSquare",Go[2022]="Railway",Go[Ko]="Road",Go[2024]="Tunnel",Go[2025]="TunnelPart",Go[2026]="TunnelInstallation",Go[2027]="TunnelInstallation",Go[2028]="TunnelHollowSpace",Go[2029]="TunnelFurniture",Go[2030]="WaterBody",Go[2031]="Waterway",Go),Zo={Bridge:2e3,BridgePart:2001,BridgeInstallation:2002,BridgeConstructiveElement:2003,BridgeRoom:2004,BridgeFurniture:2005,Building:2006,BuildingPart:2007,BuildingInstallation:2008,BuildingConstructiveElement:2009,BuildingFurniture:2010,BuildingStorey:2011,BuildingRoom:2012,BuildingUnit:2013,CityFurniture:2014,CityObjectGroup:2015,LandUse:2016,OtherConstruction:2017,PlantCover:2018,SolitaryVegetationObject:2019,TINRelief:2020,TransportationSquare:2021,Railway:2022,Road:Ko,Tunnel:2024,TunnelPart:2025,TunnelInstallation:zo,TunnelConstructiveElement:zo,TunnelHollowSpace:2028,TunnelFurniture:2029,WaterBody:2030,Waterway:2031},Qo={__proto__:null,BasicAggregation:2001,Bridge:2e3,BridgePart:2001,BridgeInstallation:2002,BridgeConstructiveElement:2003,BridgeRoom:2004,BridgeFurniture:2005,Building:2006,BuildingPart:2007,BuildingInstallation:2008,BuildingConstructiveElement:2009,BuildingFurniture:2010,BuildingStorey:2011,BuildingRoom:2012,BuildingUnit:2013,CityFurniture:2014,CityObjectGroup:2015,LandUse:2016,OtherConstruction:2017,PlantCover:2018,SolitaryVegetationObject:2019,TINRelief:2020,TransportationSquare:2021,Railway:2022,Road:Ko,Tunnel:2024,TunnelPart:2025,TunnelInstallation:zo,TunnelConstructiveElement:2027,TunnelHollowSpace:2028,TunnelFurniture:2029,WaterBody:2030,Waterway:2031,typeNames:qo,typeCodes:Zo};function Jo(e,t,i){i=i||2;var r,n,o,s,a,c,l,h=t&&t.length,u=h?t[0]*i:e.length,d=$o(e,0,u,i,!0),f=[];if(!d||d.next===d.prev)return f;if(h&&(d=function(e,t,i,r){var n,o,s,a=[];for(n=0,o=t.length;n<o;n++)(s=$o(e,t[n]*r,n<o-1?t[n+1]*r:e.length,r,!1))===s.next&&(s.steiner=!0),a.push(hs(s));for(a.sort(ss),n=0;n<a.length;n++)as(a[n],i),i=es(i,i.next);return i}(e,t,d,i)),e.length>80*i){r=o=e[0],n=s=e[1];for(var v=i;v<u;v+=i)(a=e[v])<r&&(r=a),(c=e[v+1])<n&&(n=c),a>o&&(o=a),c>s&&(s=c);l=0!==(l=Math.max(o-r,s-n))?1/l:0}return ts(d,f,i,r,n,l),f}function $o(e,t,i,r,n){var o,s;if(n===Ts(e,t,i,r)>0)for(o=t;o<i;o+=r)s=ws(o,e[o],e[o+1],s);else for(o=i-r;o>=t;o-=r)s=ws(o,e[o],e[o+1],s);return s&&vs(s,s.next)&&(Ps(s),s=s.next),s}function es(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!vs(r,r.next)&&0!==fs(r.prev,r,r.next))r=r.next;else{if(Ps(r),(r=t=r.prev)===r.next)break;i=!0}}while(i||r!==t);return t}function ts(e,t,i,r,n,o,s){if(e){!s&&o&&function(e,t,i,r){var n=e;do{null===n.z&&(n.z=ls(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,i,r,n,o,s,a,c,l=1;do{for(i=e,e=null,o=null,s=0;i;){for(s++,r=i,a=0,t=0;t<l&&(a++,r=r.nextZ);t++);for(c=l;a>0||c>0&&r;)0!==a&&(0===c||!r||i.z<=r.z)?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,c--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;i=r}o.nextZ=null,l*=2}while(s>1)}(n)}(e,r,n,o);for(var a,c,l=e;e.prev!==e.next;)if(a=e.prev,c=e.next,o?rs(e,r,n,o):is(e))t.push(a.i/i),t.push(e.i/i),t.push(c.i/i),Ps(e),e=c.next,l=c.next;else if((e=c)===l){s?1===s?ts(e=ns(es(e),t,i),t,i,r,n,o,2):2===s&&os(e,t,i,r,n,o):ts(es(e),t,i,r,n,o,1);break}}}function is(e){var t=e.prev,i=e,r=e.next;if(fs(t,i,r)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(us(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&fs(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function rs(e,t,i,r){var n=e.prev,o=e,s=e.next;if(fs(n,o,s)>=0)return!1;for(var a=n.x>o.x?n.x>s.x?n.x:s.x:o.x>s.x?o.x:s.x,c=n.y>o.y?n.y>s.y?n.y:s.y:o.y>s.y?o.y:s.y,l=ls(n.x<o.x?n.x<s.x?n.x:s.x:o.x<s.x?o.x:s.x,n.y<o.y?n.y<s.y?n.y:s.y:o.y<s.y?o.y:s.y,t,i,r),h=ls(a,c,t,i,r),u=e.prevZ,d=e.nextZ;u&&u.z>=l&&d&&d.z<=h;){if(u!==e.prev&&u!==e.next&&us(n.x,n.y,o.x,o.y,s.x,s.y,u.x,u.y)&&fs(u.prev,u,u.next)>=0)return!1;if(u=u.prevZ,d!==e.prev&&d!==e.next&&us(n.x,n.y,o.x,o.y,s.x,s.y,d.x,d.y)&&fs(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;u&&u.z>=l;){if(u!==e.prev&&u!==e.next&&us(n.x,n.y,o.x,o.y,s.x,s.y,u.x,u.y)&&fs(u.prev,u,u.next)>=0)return!1;u=u.prevZ}for(;d&&d.z<=h;){if(d!==e.prev&&d!==e.next&&us(n.x,n.y,o.x,o.y,s.x,s.y,d.x,d.y)&&fs(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function ns(e,t,i){var r=e;do{var n=r.prev,o=r.next.next;!vs(n,o)&&ps(n,r,r.next,o)&&bs(n,o)&&bs(o,n)&&(t.push(n.i/i),t.push(r.i/i),t.push(o.i/i),Ps(r),Ps(r.next),r=e=o),r=r.next}while(r!==e);return es(r)}function os(e,t,i,r,n,o){var s=e;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&ds(s,a)){var c=gs(s,a);return s=es(s,s.next),c=es(c,c.next),ts(s,t,i,r,n,o),void ts(c,t,i,r,n,o)}a=a.next}s=s.next}while(s!==e)}function ss(e,t){return e.x-t.x}function as(e,t){if(t=function(e,t){var i,r=t,n=e.x,o=e.y,s=-Infinity;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>s){if(s=a,a===n){if(o===r.y)return r;if(o===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(n===s)return i;var c,l=i,h=i.x,u=i.y,d=Infinity;r=i;do{n>=r.x&&r.x>=h&&n!==r.x&&us(o<u?n:s,o,h,u,o<u?s:n,o,r.x,r.y)&&(c=Math.abs(o-r.y)/(n-r.x),bs(r,e)&&(c<d||c===d&&(r.x>i.x||r.x===i.x&&cs(i,r)))&&(i=r,d=c)),r=r.next}while(r!==l);return i}(e,t),t){var i=gs(t,e);es(t,t.next),es(i,i.next)}}function cs(e,t){return fs(e.prev,e,t.prev)<0&&fs(t.next,e,e.next)<0}function ls(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function hs(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function us(e,t,i,r,n,o,s,a){return(n-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(r-a)-(i-s)*(t-a)>=0&&(i-s)*(o-a)-(n-s)*(r-a)>=0}function ds(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&ps(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(bs(e,t)&&bs(t,e)&&function(e,t){var i=e,r=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)&&(fs(e.prev,e,t.prev)||fs(e,t.prev,t))||vs(e,t)&&fs(e.prev,e,e.next)>0&&fs(t.prev,t,t.next)>0)}function fs(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function vs(e,t){return e.x===t.x&&e.y===t.y}function ps(e,t,i,r){var n=ms(fs(e,t,i)),o=ms(fs(e,t,r)),s=ms(fs(i,r,e)),a=ms(fs(i,r,t));return n!==o&&s!==a||!(0!==n||!ys(e,i,t))||!(0!==o||!ys(e,r,t))||!(0!==s||!ys(i,e,r))||!(0!==a||!ys(i,t,r))}function ys(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function ms(e){return e>0?1:e<0?-1:0}function bs(e,t){return fs(e.prev,e,e.next)<0?fs(e,t,e.next)>=0&&fs(e,e.prev,t)>=0:fs(e,t,e.prev)<0||fs(e,e.next,t)<0}function gs(e,t){var i=new Es(e.i,e.x,e.y),r=new Es(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function ws(e,t,i,r){var n=new Es(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function Ps(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Es(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ts(e,t,i,r){for(var n=0,o=t,s=i-r;o<i;o+=r)n+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return n}Jo.deviation=function(e,t,i,r){var n=t&&t.length,o=Math.abs(Ts(e,0,n?t[0]*i:e.length,i));if(n)for(var s=0,a=t.length;s<a;s++)o-=Math.abs(Ts(e,t[s]*i,s<a-1?t[s+1]*i:e.length,i));var c=0;for(s=0;s<r.length;s+=3){var l=r[s]*i,h=r[s+1]*i,u=r[s+2]*i;c+=Math.abs((e[l]-e[u])*(e[h+1]-e[l+1])-(e[l]-e[h])*(e[u+1]-e[l+1]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},Jo.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,n=0;n<e.length;n++){for(var o=0;o<e[n].length;o++)for(var s=0;s<t;s++)i.vertices.push(e[n][o][s]);n>0&&i.holes.push(r+=e[n-1].length)}return i};var _s=gt(),Is=wt(),xs=wt(),Ss=wt();function Ms(e,t,i){for(var r=[],n=t.scale||wt([1,1,1]),o=t.translate||wt([0,0,0]),s=0,a=0;s<e.length;s++,a+=3){var c=e[s][0]*n[0]+o[0],l=e[s][1]*n[1]+o[1],h=e[s][2]*n[2]+o[2];r.push(i?[c,h,l]:[c,l,h])}return r}function Os(e,t,i){if(e.dataModel&&e.dataModel.createObject({id:i,name:t.type+" : "+i,type:0|Zo[t.type],parent:t.parents?t.parents[0]:null}),e.sceneModel){if(!(t.geometry&&t.geometry.length>0))return;for(var r=[],n=0,o=t.geometry.length;n<o;n++){var s=t.geometry[n],a=void 0,c=void 0,l=e.fileData.appearance;if(l){var h=l.materials;if(h){var u=s.material;if(u){var d=Object.keys(u);if(d.length>0){var f=u[d[0]];if(void 0!==f.value)a=h[f.value];else{var v=f.values;if(v){c=[];for(var p=0,y=v.length;p<y;p++)c.push(h[v[n]])}}}}}}c?Rs(e,s,c,r):As(e,s,a,r)}r.length>0&&e.sceneModel.createObject({id:i,meshIds:r})}}function js(e,t,i){t.parents&&e.dataModel.createRelationship({relatingObjectId:t.parents[0],relatedObjectId:i,type:Xo})}function Rs(e,t,i,r){switch(t.type){case"MultiPoint":case"MultiLineString":break;case"MultiSurface":case"CompositeSurface":Ds(e,i,t.boundaries,r);break;case"Solid":for(var n=t.boundaries,o=0;o<n.length;o++)Ds(e,i,n[o],r);break;case"MultiSolid":case"CompositeSolid":for(var s=t.boundaries,a=0;a<s.length;a++)for(var c=0;c<s[a].length;c++)Ds(e,i,s[a][c],r)}}function Ds(e,t,i,r){for(var n=e.vertices,o=e.sceneModel,s=0;s<i.length;s++){for(var a=i[s],c=t[s]||{diffuseColor:[.8,.8,.8],transparency:1},l=[],h=[],u=[],d={positions:[],indices:[]},f=0;f<a.length;f++){l.length>0&&h.push(l.length);var v=ks(e,a[f],u,d);l.push.apply(l,v)}if(3===l.length)d.indices.push(l[0]),d.indices.push(l[1]),d.indices.push(l[2]);else if(l.length>3){for(var p=[],y=0;y<l.length;y++)p.push({x:n[u[l[y]]][0],y:n[u[l[y]]][1],z:n[u[l[y]]][2]});for(var m=Bs(p,wt()),b=[],g=0;g<p.length;g++)Ls(p[g],m,_s),b.unshift(_s[0]),b.unshift(_s[1]);for(var w=Jo(b,h,2),P=0;P<w.length;P+=3)d.indices.unshift(l[w[P]]),d.indices.unshift(l[w[P+1]]),d.indices.unshift(l[w[P+2]])}var E=""+e.nextId++;o.createGeometry({id:E,primitive:qe,positions:d.positions,indices:d.indices});var T=""+e.nextId++;o.createMesh({id:T,geometryId:E,color:c&&c.diffuseColor?c.diffuseColor:[.8,.8,.8],opacity:c&&void 0!==c.transparency?1-c.transparency:1}),r.push(T)}}function As(e,t,i,r){var n=e.sceneModel,o=[],s={positions:[],indices:[]};switch(t.type){case"MultiPoint":case"MultiLineString":break;case"MultiSurface":case"CompositeSurface":Cs(e,t.boundaries,o,s);break;case"Solid":for(var a=t.boundaries,c=0;c<a.length;c++)Cs(e,a[c],o,s);break;case"MultiSolid":case"CompositeSolid":for(var l=t.boundaries,h=0;h<l.length;h++)for(var u=0;u<l[h].length;u++)Cs(e,l[h][u],o,s)}if(s.positions.length>0&&s.indices.length>0){var d=""+e.nextId++;n.createGeometry({id:d,primitive:qe,positions:s.positions,indices:s.indices});var f=""+e.nextId++;n.createMesh({id:f,geometryId:d,color:i&&i.diffuseColor?i.diffuseColor:[.8,.8,.8],opacity:1}),r.push(f)}}function Cs(e,t,i,r){for(var n=e.vertices,o=0;o<t.length;o++){for(var s=[],a=[],c=0;c<t[o].length;c++){s.length>0&&a.push(s.length);var l=ks(e,t[o][c],i,r);s.push.apply(s,l)}if(3===s.length)r.indices.push(s[0]),r.indices.push(s[1]),r.indices.push(s[2]);else if(s.length>3){for(var h=[],u=0;u<s.length;u++)h.push({x:n[i[s[u]]][0],y:n[i[s[u]]][1],z:n[i[s[u]]][2]});for(var d=Bs(h,wt()),f=[],v=0;v<h.length;v++)Ls(h[v],d,_s),f.unshift(_s[0]),f.unshift(_s[1]);for(var p=Jo(f,a,2),y=0;y<p.length;y+=3)r.indices.unshift(s[p[y]]),r.indices.unshift(s[p[y+1]]),r.indices.unshift(s[p[y+2]])}}}function ks(e,t,i,r){for(var n=e.vertices,o=[],s=0,a=t.length;s<a;s++){var c=t[s];if(i.includes(c)){var l=i.indexOf(c);o.push(l)}else r.positions.push(n[c][0]),r.positions.push(n[c][1]),r.positions.push(n[c][2]),o.push(i.length),i.push(c)}return o}function Bs(e,t){for(var i=0;i<e.length;i++){var r=i+1;r===e.length&&(r=0),t[0]+=(e[i].y-e[r].y)*(e[i].z+e[r].z),t[1]+=(e[i].z-e[r].z)*(e[i].x+e[r].x),t[2]+=(e[i].x-e[r].x)*(e[i].y+e[r].y)}return Yt(t)}function Ls(e,t,i){var r=Is,n=xs,o=Ss;r[0]=e.x,r[1]=e.y,r[2]=e.z,n[0]=t.x,n[1]=t.y,n[2]=t.z,o[0]=1.1,o[1]=1.1,o[2]=1.1,Ut(Mt(o,n))<.01&&(o[0]+=1,o[1]+=2,o[2]+=3);var s=_t(n,bt(o,n),wt());o[0]-=s[0],o[1]-=s[1],o[2]-=s[2],Yt(o);var a=At(n,o,wt()),c=bt(r,o),l=bt(r,a);i[0]=c,i[1]=l}var Fs,Us={__proto__:null,loadCityJSON:function(e,t){if(void 0===t&&(t={rotateX:!1}),e.sceneModel){if(e.sceneModel.destroyed)return Promise.reject(new he("SceneModel already destroyed"));if(e.sceneModel.built)return Promise.reject(new he("SceneModel already built"))}if(e.dataModel){if(e.dataModel.destroyed)return Promise.reject(new he("DataModel already destroyed"));if(e.dataModel.built)return Promise.reject(new he("DataModel already built"))}var i=e.fileData;return function(e){var t=e.fileData.CityObjects;for(var i in t)Os(e,t[i],i);if(e.dataModel)for(var r in t)js(e,t[r],r)}({fileData:i,vertices:i.transform&&e.sceneModel?Ms(i.vertices,i.transform,t.rotateX):i.vertices,sceneModel:e.sceneModel,dataModel:e.dataModel,nextId:0}),Promise.resolve()}},Ns={__proto__:null,loadDotBIM:function(e,t){return void 0===t&&(t={}),new Promise(function(i,r){if(e.sceneModel.destroyed)throw new he("SceneModel already destroyed");if(e.sceneModel.built)throw new he("SceneModel already built");if(e.dataModel){if(e.dataModel.destroyed)throw new he("DataModel already destroyed");if(e.dataModel.built)throw new he("DataModel already built")}!function(e){for(var t=e.fileData,i=t.meshes,r=0,n=i.length;r<n;r++){var o=i[r],s=e.sceneModel.createGeometry({id:o.mesh_id,primitive:qe,positions:o.coordinates,indices:o.indices});s instanceof he&&e.error("[SceneModel.createGeometry]: "+s.message)}for(var a=t.elements,c=0,l=a.length;c<l;c++){var h=a[c],u=""+h.guid;if(e.sceneModel){var d=u+"-mesh-"+c,f=e.sceneModel.createMesh({id:d,geometryId:h.mesh_id,baseColor:h.color});if(f instanceof he){e.error("[SceneModel.createMesh]: "+f.message);continue}var v=e.sceneModel.createObject({id:u,meshIds:[d]});if(v instanceof he){e.error("[SceneModel.createObject]: "+v.message);continue}}if(e.dataModel&&!e.dataModel.objects[h.guid]){var p=e.dataModel.createObject({id:u,type:h.type});p instanceof he&&e.error("[SceneModel.createObject]: "+p.message)}}}({fileData:e.fileData,sceneModel:e.sceneModel,dataModel:e.dataModel,nextId:0,error:t.error||function(e){}}),i()})}},Vs=/*#__PURE__*/d("rendererViewObject"),Gs=/*#__PURE__*/d("state"),Hs=/*#__PURE__*/function(){function e(e,t,i){this.id=void 0,this.layer=void 0,this.sceneObject=void 0,Object.defineProperty(this,Vs,{writable:!0,value:void 0}),Object.defineProperty(this,Gs,{writable:!0,value:void 0}),this.id=t.id,this.layer=e,this.sceneObject=t,f(this,Vs)[Vs]=i,f(this,Gs)[Gs]={visible:!0,culled:!1,pickable:!0,clippable:!0,collidable:!0,xrayed:!1,selected:!1,highlighted:!1,edges:!1,colorize:new Float32Array(4),colorized:!1,opacityUpdated:!1},f(this,Vs)[Vs].setVisible(this.layer.view.viewIndex,f(this,Gs)[Gs].visible),this.layer.objectVisibilityUpdated(this,f(this,Gs)[Gs].visible,!0)}return e.prototype._destroy=function(){f(this,Gs)[Gs].visible&&this.layer.objectVisibilityUpdated(this,!1,!1),f(this,Gs)[Gs].xrayed&&this.layer.objectXRayedUpdated(this,!1),f(this,Gs)[Gs].selected&&this.layer.objectSelectedUpdated(this,!1),f(this,Gs)[Gs].highlighted&&this.layer.objectHighlightedUpdated(this,!1),f(this,Gs)[Gs].colorized&&this.layer.objectColorizeUpdated(this,!1),f(this,Gs)[Gs].opacityUpdated&&this.layer.objectOpacityUpdated(this,!1),this.layer.redraw()},i(e,[{key:"aabb",get:function(){return this.sceneObject.aabb}},{key:"visible",get:function(){return f(this,Gs)[Gs].visible},set:function(e){e!==f(this,Gs)[Gs].visible&&(f(this,Gs)[Gs].visible=e,f(this,Vs)[Vs].setVisible(this.layer.view.viewIndex,e),this.layer.objectVisibilityUpdated(this,e,!0),this.layer.redraw())}},{key:"xrayed",get:function(){return f(this,Gs)[Gs].xrayed},set:function(e){f(this,Gs)[Gs].xrayed!==e&&(f(this,Gs)[Gs].xrayed=e,f(this,Vs)[Vs].setXRayed(this.layer.view.viewIndex,e),this.layer.objectXRayedUpdated(this,e),this.layer.redraw())}},{key:"edges",get:function(){return f(this,Gs)[Gs].edges},set:function(e){f(this,Gs)[Gs].edges!==e&&(f(this,Gs)[Gs].edges=e,f(this,Vs)[Vs].setEdges(this.layer.view.viewIndex,e),this.layer.redraw())}},{key:"highlighted",get:function(){return f(this,Gs)[Gs].highlighted},set:function(e){e!==f(this,Gs)[Gs].highlighted&&(f(this,Gs)[Gs].highlighted=e,f(this,Vs)[Vs].setHighlighted(this.layer.view.viewIndex,e),this.layer.objectHighlightedUpdated(this,e),this.layer.redraw())}},{key:"selected",get:function(){return f(this,Gs)[Gs].selected},set:function(e){e!==f(this,Gs)[Gs].selected&&(f(this,Gs)[Gs].selected=e,f(this,Vs)[Vs].setSelected(this.layer.view.viewIndex,e),this.layer.objectSelectedUpdated(this,e),this.layer.redraw())}},{key:"culled",get:function(){return f(this,Gs)[Gs].culled},set:function(e){e!==f(this,Gs)[Gs].culled&&(f(this,Gs)[Gs].culled=e,this.layer.redraw())}},{key:"clippable",get:function(){return f(this,Gs)[Gs].clippable},set:function(e){e!==f(this,Gs)[Gs].clippable&&(f(this,Gs)[Gs].clippable=e,this.layer.redraw())}},{key:"collidable",get:function(){return f(this,Gs)[Gs].collidable},set:function(e){e!==f(this,Gs)[Gs].collidable&&(f(this,Gs)[Gs].collidable=e)}},{key:"pickable",get:function(){return f(this,Gs)[Gs].pickable},set:function(e){f(this,Gs)[Gs].pickable!==e&&(f(this,Gs)[Gs].pickable=e)}},{key:"colorize",get:function(){return f(this,Gs)[Gs].colorize},set:function(e){var t=f(this,Gs)[Gs].colorize;e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),f(this,Gs)[Gs].colorized=!!e,this.layer.objectColorizeUpdated(this,f(this,Gs)[Gs].colorized),this.layer.redraw()}},{key:"opacity",get:function(){return f(this,Gs)[Gs].colorize[3]},set:function(e){var t=f(this,Gs)[Gs].colorize;f(this,Gs)[Gs].opacityUpdated=null!=e,t[3]=f(this,Gs)[Gs].opacityUpdated?e:1,this.layer.objectOpacityUpdated(this,f(this,Gs)[Gs].opacityUpdated),this.layer.redraw()}}]),e}(),Xs=/*#__PURE__*/d("state"),Ws=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,r.onPos=void 0,r.onDir=void 0,r.onActive=void 0,Object.defineProperty(c(r),Xs,{writable:!0,value:void 0}),r.view=t,f(c(r),Xs)[Xs]={active:!1!==i.active,pos:new Float64Array(i.pos||[0,0,0]),dir:new Float32Array(i.pos||[0,0,-1]),dist:0},r.onPos=new p(new te.EventDispatcher),r.onDir=new p(new te.EventDispatcher),r.onActive=new p(new te.EventDispatcher),r}r(t,e);var n=t.prototype;return n.flipDir=function(){var e=f(this,Xs)[Xs].dir;e[0]*=-1,e[1]*=-1,e[2]*=-1,f(this,Xs)[Xs].dist=-bt(f(this,Xs)[Xs].pos,f(this,Xs)[Xs].dir),this.onDir.dispatch(this,f(this,Xs)[Xs].dir),this.view.redraw()},n.destroy=function(){this.onPos.clear(),this.onDir.clear(),e.prototype.destroy.call(this)},i(t,[{key:"active",get:function(){return f(this,Xs)[Xs].active},set:function(e){f(this,Xs)[Xs].active!==e&&(f(this,Xs)[Xs].active=e,this.view.redraw(),this.onActive.dispatch(this,f(this,Xs)[Xs].active))}},{key:"pos",get:function(){return f(this,Xs)[Xs].pos},set:function(e){f(this,Xs)[Xs].pos.set(e),f(this,Xs)[Xs].dist=-bt(f(this,Xs)[Xs].pos,f(this,Xs)[Xs].dir),this.onPos.dispatch(this,f(this,Xs)[Xs].pos)}},{key:"dir",get:function(){return f(this,Xs)[Xs].dir},set:function(e){f(this,Xs)[Xs].dir.set(e),f(this,Xs)[Xs].dist=-bt(f(this,Xs)[Xs].pos,f(this,Xs)[Xs].dir),this.view.redraw(),this.onDir.dispatch(this,f(this,Xs)[Xs].dir)}},{key:"dist",get:function(){return f(this,Xs)[Xs].dist}}]),t}(ae),Ys=((Fs={})[4e5]={abbrev:"m"},Fs[400001]={abbrev:"cm"},Fs[400002]={abbrev:"mm"},Fs[400003]={abbrev:"yd"},Fs[400004]={abbrev:"ft"},Fs[400005]={abbrev:"in"},Fs),Ks=/*#__PURE__*/d("units"),zs=/*#__PURE__*/d("scale"),qs=/*#__PURE__*/d("origin"),Zs=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={units:$e,scale:1,origin:[1,1,1]}),r=e.call(this,t,i)||this,Object.defineProperty(c(r),Ks,{writable:!0,value:void 0}),Object.defineProperty(c(r),zs,{writable:!0,value:void 0}),Object.defineProperty(c(r),qs,{writable:!0,value:void 0}),r.onUnits=void 0,r.onScale=void 0,r.onOrigin=void 0,r.onUnits=new p(new te.EventDispatcher),r.onScale=new p(new te.EventDispatcher),r.onOrigin=new p(new te.EventDispatcher),f(c(r),Ks)[Ks]=$e,f(c(r),zs)[zs]=1,f(c(r),qs)[qs]=wt([0,0,0]),r.units=i.units,r.scale=i.scale,r.origin=i.origin,r}r(t,e);var n=t.prototype;return n.worldToRealPos=function(e,t){return void 0===t&&(t=wt()),t[0]=f(this,qs)[qs][0]+f(this,zs)[zs]*e[0],t[1]=f(this,qs)[qs][1]+f(this,zs)[zs]*e[1],t[2]=f(this,qs)[qs][2]+f(this,zs)[zs]*e[2],t},n.realToWorldPos=function(e,t){return void 0===t&&(t=wt()),t[0]=(e[0]-f(this,qs)[qs][0])/f(this,zs)[zs],t[1]=(e[1]-f(this,qs)[qs][1])/f(this,zs)[zs],t[2]=(e[2]-f(this,qs)[qs][2])/f(this,zs)[zs],t},n.destroy=function(){e.prototype.destroy.call(this),this.onUnits.clear(),this.onScale.clear(),this.onOrigin.clear()},i(t,[{key:"unitsInfo",get:function(){return Ys}},{key:"units",get:function(){return f(this,Ks)[Ks]},set:function(e){e||(e=$e),Ys[e]||(this.error("Unsupported value for 'units': "+e+" defaulting to MetersUnit"),e=$e),f(this,Ks)[Ks]=e,this.onUnits.dispatch(this,f(this,Ks)[Ks])}},{key:"scale",get:function(){return f(this,zs)[zs]},set:function(e){(e=e||1)<=0?this.error("scale value should be larger than zero"):(f(this,zs)[zs]=e,this.onScale.dispatch(this,f(this,zs)[zs]))}},{key:"origin",get:function(){return f(this,qs)[qs]},set:function(e){if(!e)return f(this,qs)[qs][0]=0,f(this,qs)[qs][1]=0,void(f(this,qs)[qs][2]=0);f(this,qs)[qs][0]=e[0],f(this,qs)[qs][1]=e[1],f(this,qs)[qs][2]=e[2],this.onOrigin.dispatch(this,f(this,qs)[qs])}}]),t}(ae),Qs=/*#__PURE__*/d("state"),Js=/*#__PURE__*/function(e){function t(t,i){var r;return(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(c(r),Qs,{writable:!0,value:void 0}),r.view=t,f(c(r),Qs)[Qs]={renderModes:[Je],enabled:!1!==i.enabled,kernelRadius:i.kernelRadius||100,intensity:void 0!==i.intensity?i.intensity:.15,bias:void 0!==i.bias?i.bias:.5,scale:void 0!==i.scale?i.scale:1,minResolution:void 0!==i.minResolution?i.minResolution:0,numSamples:void 0!==i.numSamples?i.numSamples:10,blur:!!i.blur,blendCutoff:void 0!==i.blendCutff?i.blendCutoff:.3,blendFactor:void 0!==i.blendFactor?i.blendFactor:1},r}return r(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this)},i(t,[{key:"renderModes",get:function(){return f(this,Qs)[Qs].renderModes},set:function(e){f(this,Qs)[Qs].renderModes=e,this.view.redraw()}},{key:"supported",get:function(){return this.view.viewer.renderer.getSAOSupported()}},{key:"enabled",get:function(){return f(this,Qs)[Qs].enabled},set:function(e){e=!!e,f(this,Qs)[Qs].enabled!==e&&(f(this,Qs)[Qs].enabled=e,this.view.redraw())}},{key:"possible",get:function(){if(!this.supported)return!1;if(!f(this,Qs)[Qs].enabled)return!1;var e=this.view.camera.projectionType;return e!==rt&&e!==it}},{key:"kernelRadius",get:function(){return f(this,Qs)[Qs].kernelRadius},set:function(e){null==e&&(e=100),f(this,Qs)[Qs].kernelRadius!==e&&(f(this,Qs)[Qs].kernelRadius=e,this.view.redraw())}},{key:"intensity",get:function(){return f(this,Qs)[Qs].intensity},set:function(e){null==e&&(e=.15),f(this,Qs)[Qs].intensity!==e&&(f(this,Qs)[Qs].intensity=e,this.view.redraw())}},{key:"bias",get:function(){return f(this,Qs)[Qs].bias},set:function(e){null==e&&(e=.5),f(this,Qs)[Qs].bias!==e&&(f(this,Qs)[Qs].bias=e,this.view.redraw())}},{key:"scale",get:function(){return f(this,Qs)[Qs].scale},set:function(e){null==e&&(e=1),f(this,Qs)[Qs].scale!==e&&(f(this,Qs)[Qs].scale=e,this.view.redraw())}},{key:"minResolution",get:function(){return f(this,Qs)[Qs].minResolution},set:function(e){null==e&&(e=0),f(this,Qs)[Qs].minResolution!==e&&(f(this,Qs)[Qs].minResolution=e,this.view.redraw())}},{key:"numSamples",get:function(){return f(this,Qs)[Qs].numSamples},set:function(e){null==e&&(e=10),f(this,Qs)[Qs].numSamples!==e&&(f(this,Qs)[Qs].numSamples=e,this.view.redraw())}},{key:"blur",get:function(){return f(this,Qs)[Qs].blur},set:function(e){e=!1!==e,f(this,Qs)[Qs].blur!==e&&(f(this,Qs)[Qs].blur=e,this.view.redraw())}},{key:"blendCutoff",get:function(){return f(this,Qs)[Qs].blendCutoff},set:function(e){null==e&&(e=.3),f(this,Qs)[Qs].blendCutoff!==e&&(f(this,Qs)[Qs].blendCutoff=e,this.view.redraw())}},{key:"blendFactor",get:function(){return f(this,Qs)[Qs].blendFactor},set:function(e){null==e&&(e=1),f(this,Qs)[Qs].blendFactor!==e&&(f(this,Qs)[Qs].blendFactor=e,this.view.redraw())}}]),t}(ae),$s=/*#__PURE__*/d("state"),ea=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={lineWidth:1}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(c(r),$s,{writable:!0,value:void 0}),r.view=t,f(c(r),$s)[$s]={lineWidth:null!=i.lineWidth?i.lineWidth:1},r}return r(t,e),i(t,[{key:"lineWidth",get:function(){return f(this,$s)[$s].lineWidth},set:function(e){f(this,$s)[$s].lineWidth=e||1,this.view.redraw()}}]),t}(ae),ta=/*#__PURE__*/d("numObjects"),ia=/*#__PURE__*/d("objectIds"),ra=/*#__PURE__*/d("numVisibleObjects"),na=/*#__PURE__*/d("visibleObjectIds"),oa=/*#__PURE__*/d("numXRayedObjects"),sa=/*#__PURE__*/d("xrayedObjectIds"),aa=/*#__PURE__*/d("numHighlightedObjects"),ca=/*#__PURE__*/d("highlightedObjectIds"),la=/*#__PURE__*/d("numSelectedObjects"),ha=/*#__PURE__*/d("selectedObjectIds"),ua=/*#__PURE__*/d("numColorizedObjects"),da=/*#__PURE__*/d("colorizedObjectIds"),fa=/*#__PURE__*/d("numOpacityObjects"),va=/*#__PURE__*/d("opacityObjectIds"),pa=/*#__PURE__*/d("qualityRender"),ya=/*#__PURE__*/d("initViewObjects"),ma=/*#__PURE__*/d("createViewObjects"),ba=/*#__PURE__*/d("destroyViewObjects"),ga=/*#__PURE__*/function(e){function t(t){var i;return i=e.call(this,t.view,t)||this,Object.defineProperty(c(i),ba,{value:Ea}),Object.defineProperty(c(i),ma,{value:Pa}),Object.defineProperty(c(i),ya,{value:wa}),i.objects=void 0,i.visibleObjects=void 0,i.xrayedObjects=void 0,i.highlightedObjects=void 0,i.selectedObjects=void 0,i.colorizedObjects=void 0,i.opacityObjects=void 0,i.autoDestroy=void 0,i.onObjectVisibility=void 0,Object.defineProperty(c(i),ta,{writable:!0,value:void 0}),Object.defineProperty(c(i),ia,{writable:!0,value:void 0}),Object.defineProperty(c(i),ra,{writable:!0,value:void 0}),Object.defineProperty(c(i),na,{writable:!0,value:void 0}),Object.defineProperty(c(i),oa,{writable:!0,value:void 0}),Object.defineProperty(c(i),sa,{writable:!0,value:void 0}),Object.defineProperty(c(i),aa,{writable:!0,value:void 0}),Object.defineProperty(c(i),ca,{writable:!0,value:void 0}),Object.defineProperty(c(i),la,{writable:!0,value:void 0}),Object.defineProperty(c(i),ha,{writable:!0,value:void 0}),Object.defineProperty(c(i),ua,{writable:!0,value:void 0}),Object.defineProperty(c(i),da,{writable:!0,value:void 0}),Object.defineProperty(c(i),fa,{writable:!0,value:void 0}),Object.defineProperty(c(i),va,{writable:!0,value:void 0}),Object.defineProperty(c(i),pa,{writable:!0,value:void 0}),i.gammaOutput=void 0,i.id=t.id,i.viewer=t.viewer,i.view=t.view,i.objects={},i.visibleObjects={},i.xrayedObjects={},i.highlightedObjects={},i.selectedObjects={},i.colorizedObjects={},i.opacityObjects={},i.autoDestroy=!1!==t.autoDestroy,f(c(i),ta)[ta]=0,f(c(i),ra)[ra]=0,f(c(i),oa)[oa]=0,f(c(i),aa)[aa]=0,f(c(i),la)[la]=0,f(c(i),ua)[ua]=0,f(c(i),fa)[fa]=0,f(c(i),pa)[pa]=!!t.qualityRender,i.onObjectVisibility=new p(new te.EventDispatcher),f(c(i),ya)[ya](),i}r(t,e);var n=t.prototype;return n.registerViewObject=function(e){this.objects[e.id]=e,f(this,ta)[ta]++,f(this,ia)[ia]=null},n.deregisterViewObject=function(e){delete this.objects[e.id],delete this.visibleObjects[e.id],delete this.xrayedObjects[e.id],delete this.highlightedObjects[e.id],delete this.selectedObjects[e.id],delete this.colorizedObjects[e.id],delete this.opacityObjects[e.id],f(this,ta)[ta]--,f(this,ia)[ia]=null},n.redraw=function(){this.viewer.renderer.setImageDirty(this.view.viewIndex)},n.objectVisibilityUpdated=function(e,t,i){void 0===i&&(i=!0),t?(this.visibleObjects[e.id]=e,f(this,ra)[ra]++):(delete this.visibleObjects[e.id],f(this,ra)[ra]--),f(this,na)[na]=null,i&&this.onObjectVisibility.dispatch(this,e),this.view.objectVisibilityUpdated(e,t,i)},n.objectXRayedUpdated=function(e,t){t?(this.xrayedObjects[e.id]=e,f(this,oa)[oa]++):(delete this.xrayedObjects[e.id],f(this,oa)[oa]--),f(this,sa)[sa]=null,this.view.objectXRayedUpdated(e,t)},n.objectHighlightedUpdated=function(e,t){t?(this.highlightedObjects[e.id]=e,f(this,aa)[aa]++):(delete this.highlightedObjects[e.id],f(this,aa)[aa]--),f(this,ca)[ca]=null,this.view.objectHighlightedUpdated(e,t)},n.objectSelectedUpdated=function(e,t){t?(this.selectedObjects[e.id]=e,f(this,la)[la]++):(delete this.selectedObjects[e.id],f(this,la)[la]--),f(this,ha)[ha]=null,this.view.objectSelectedUpdated(e,t)},n.objectColorizeUpdated=function(e,t){t?(this.colorizedObjects[e.id]=e,f(this,ua)[ua]++):(delete this.colorizedObjects[e.id],f(this,ua)[ua]--),f(this,da)[da]=null,this.view.objectColorizeUpdated(e,t)},n.objectOpacityUpdated=function(e,t){t?(this.opacityObjects[e.id]=e,f(this,fa)[fa]++):(delete this.opacityObjects[e.id],f(this,fa)[fa]--),f(this,va)[va]=null,this.view.objectOpacityUpdated(e,t)},n.setObjectsVisible=function(e,t){return this.withObjects(e,function(e){var i=e.visible!==t;return e.visible=t,i})},n.setObjectsCollidable=function(e,t){return this.withObjects(e,function(e){var i=e.collidable!==t;return e.collidable=t,i})},n.setObjectsCulled=function(e,t){return this.withObjects(e,function(e){var i=e.culled!==t;return e.culled=t,i})},n.setObjectsSelected=function(e,t){return this.withObjects(e,function(e){var i=e.selected!==t;return e.selected=t,i})},n.setObjectsHighlighted=function(e,t){return this.withObjects(e,function(e){var i=e.highlighted!==t;return e.highlighted=t,i})},n.setObjectsXRayed=function(e,t){return this.withObjects(e,function(e){var i=e.xrayed!==t;return i&&(e.xrayed=t),i})},n.setObjectsColorized=function(e,t){return this.withObjects(e,function(e){e.colorize=t})},n.setObjectsOpacity=function(e,t){return this.withObjects(e,function(e){var i=e.opacity!==t;return i&&(e.opacity=t),i})},n.setObjectsPickable=function(e,t){return this.withObjects(e,function(e){var i=e.pickable!==t;return i&&(e.pickable=t),i})},n.setObjectsClippable=function(e,t){return this.withObjects(e,function(e){var i=e.clippable!==t;return i&&(e.clippable=t),i})},n.withObjects=function(e,t){for(var i=!1,r=0,n=e.length;r<n;r++){var o=this.objects[e[r]];o&&(i=t(o)||i)}return i},n.destroy=function(){e.prototype.destroy.call(this)},i(t,[{key:"gammaFactor",get:function(){return 1}},{key:"qualityRender",get:function(){return f(this,pa)[pa]},set:function(e){f(this,pa)[pa]!==e&&(f(this,pa)[pa]=e,this.redraw())}},{key:"numObjects",get:function(){return f(this,ta)[ta]}},{key:"objectIds",get:function(){return f(this,ia)[ia]||(f(this,ia)[ia]=Object.keys(this.objects)),f(this,ia)[ia]}},{key:"numVisibleObjects",get:function(){return f(this,ra)[ra]}},{key:"visibleObjectIds",get:function(){return f(this,na)[na]||(f(this,na)[na]=Object.keys(this.visibleObjects)),f(this,na)[na]}},{key:"numXRayedObjects",get:function(){return f(this,oa)[oa]}},{key:"xrayedObjectIds",get:function(){return f(this,sa)[sa]||(f(this,sa)[sa]=Object.keys(this.xrayedObjects)),f(this,sa)[sa]}},{key:"numHighlightedObjects",get:function(){return f(this,aa)[aa]}},{key:"highlightedObjectIds",get:function(){return f(this,ca)[ca]||(f(this,ca)[ca]=Object.keys(this.highlightedObjects)),f(this,ca)[ca]}},{key:"numSelectedObjects",get:function(){return f(this,la)[la]}},{key:"selectedObjectIds",get:function(){return f(this,ha)[ha]||(f(this,ha)[ha]=Object.keys(this.selectedObjects)),f(this,ha)[ha]}},{key:"numColorizedObjects",get:function(){return f(this,ua)[ua]}},{key:"colorizedObjectIds",get:function(){return f(this,da)[da]||(f(this,da)[da]=Object.keys(this.colorizedObjects)),f(this,da)[da]}},{key:"opacityObjectIds",get:function(){return f(this,va)[va]||(f(this,va)[va]=Object.keys(this.opacityObjects)),f(this,va)[va]}},{key:"numOpacityObjects",get:function(){return f(this,fa)[fa]}}]),t}(ae);function wa(){var e=this,t=this.viewer.scene.models;for(var i in t){var r=t[i];f(this,ma)[ma](r)}this.viewer.scene.onModelCreated.subscribe(function(t,i){f(e,ma)[ma](i)}),this.viewer.scene.onModelDestroyed.subscribe(function(t,i){f(e,ba)[ba](i)})}function Pa(e){var t=e.objects;for(var i in t){var r=this.viewer.renderer.rendererViewObjects[i];if(r.layerId==this.id){var n=new Hs(this,t[i],r);this.objects[n.id]=n,f(this,ta)[ta]++,f(this,ia)[ia]=null}}}function Ea(e){var t=e.objects;for(var i in t)this.objects[t[i].id]._destroy(),f(this,ta)[ta]--,f(this,ia)[ia]=null}var Ta=/*#__PURE__*/d("state"),_a=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(c(r),Ta,{writable:!0,value:void 0}),r.view=t,f(c(r),Ta)[Ta]={fill:!!i.fill,fillColor:new Float32Array(i.fillColor||[.4,.4,.4]),fillAlpha:null!=i.fillAlpha?i.fillAlpha:.2,edges:!1!==i.edges,edgeColor:new Float32Array(i.edgeColor||[.2,.2,.2]),edgeAlpha:null!=i.edgeAlpha?i.edgeAlpha:.5,edgeWidth:null!=i.edgeWidth?i.edgeWidth:1,backfaces:!!i.backfaces},r}return r(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this)},i(t,[{key:"fill",get:function(){return f(this,Ta)[Ta].fill},set:function(e){f(this,Ta)[Ta].fill!==e&&(f(this,Ta)[Ta].fill=e,this.view.redraw())}},{key:"fillColor",get:function(){return f(this,Ta)[Ta].fillColor},set:function(e){var t=f(this,Ta)[Ta].fillColor;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]||(t[0]=.4,t[1]=.4,t[2]=.4,this.view.redraw())}},{key:"fillAlpha",get:function(){return f(this,Ta)[Ta].fillAlpha},set:function(e){f(this,Ta)[Ta].fillAlpha!==e&&(f(this,Ta)[Ta].fillAlpha=e,this.view.redraw())}},{key:"edges",get:function(){return f(this,Ta)[Ta].edges},set:function(e){f(this,Ta)[Ta].edges!==e&&(f(this,Ta)[Ta].edges=e,this.view.redraw())}},{key:"edgeColor",get:function(){return f(this,Ta)[Ta].edgeColor},set:function(e){var t=f(this,Ta)[Ta].edgeColor;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]||(t[0]=.2,t[1]=.2,t[2]=.2,this.view.redraw())}},{key:"edgeAlpha",get:function(){return f(this,Ta)[Ta].edgeAlpha},set:function(e){f(this,Ta)[Ta].edgeAlpha!==e&&(f(this,Ta)[Ta].edgeAlpha=e,this.view.redraw())}},{key:"edgeWidth",get:function(){return f(this,Ta)[Ta].edgeWidth},set:function(e){f(this,Ta)[Ta].edgeWidth=e,this.view.redraw()}},{key:"backfaces",get:function(){return f(this,Ta)[Ta].backfaces},set:function(e){f(this,Ta)[Ta].backfaces!==e&&(f(this,Ta)[Ta].backfaces=e,this.view.redraw())}},{key:"hash",get:function(){return""}}]),t}(ae),Ia=/*#__PURE__*/d("state"),xa=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(c(r),Ia,{writable:!0,value:void 0}),r.view=t,f(c(r),Ia)[Ia]={renderModes:i.renderModes||[Je],edges:!1!==i.edges,edgeColor:new Float32Array(i.edgeColor||[.2,.2,.2]),edgeAlpha:null!=i.edgeAlpha?i.edgeAlpha:.5,edgeWidth:null!=i.edgeWidth?i.edgeWidth:1},r}return r(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this)},i(t,[{key:"renderModes",get:function(){return f(this,Ia)[Ia].renderModes},set:function(e){f(this,Ia)[Ia].renderModes=e,this.view.redraw()}},{key:"edges",get:function(){return f(this,Ia)[Ia].edges},set:function(e){f(this,Ia)[Ia].edges!==e&&(f(this,Ia)[Ia].edges=e,this.view.redraw())}},{key:"edgeColor",get:function(){return f(this,Ia)[Ia].edgeColor},set:function(e){var t=f(this,Ia)[Ia].edgeColor;e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]||(t[0]=.2,t[1]=.2,t[2]=.2,this.view.redraw())}},{key:"edgeAlpha",get:function(){return f(this,Ia)[Ia].edgeAlpha},set:function(e){f(this,Ia)[Ia].edgeAlpha!==e&&(f(this,Ia)[Ia].edgeAlpha=e,this.view.redraw())}},{key:"edgeWidth",get:function(){return f(this,Ia)[Ia].edgeWidth},set:function(e){f(this,Ia)[Ia].edgeWidth!==e&&(f(this,Ia)[Ia].edgeWidth=e,this.view.redraw())}}]),t}(ae),Sa=/*#__PURE__*/d("state"),Ma=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(c(r),Sa,{writable:!0,value:void 0}),r.view=t,f(c(r),Sa)[Sa]={pointSize:null!=i.pointSize?i.pointSize:1,roundPoints:!1!==i.roundPoints,perspectivePoints:!1!==i.perspectivePoints,minPerspectivePointSize:null!=i.minPerspectivePointSize?i.minPerspectivePointSize:1,maxPerspectivePointSize:null!=i.maxPerspectivePointSize?i.maxPerspectivePointSize:6,filterIntensity:!!i.filterIntensity,minIntensity:null!=i.minIntensity?i.minIntensity:0,maxIntensity:null!=i.maxIntensity?i.maxIntensity:1},r}return r(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this)},i(t,[{key:"pointSize",get:function(){return f(this,Sa)[Sa].pointSize},set:function(e){f(this,Sa)[Sa].pointSize=e,this.view.redraw()}},{key:"roundPoints",get:function(){return f(this,Sa)[Sa].roundPoints},set:function(e){f(this,Sa)[Sa].roundPoints!==e&&(f(this,Sa)[Sa].roundPoints=e,this.view.rebuild())}},{key:"perspectivePoints",get:function(){return f(this,Sa)[Sa].perspectivePoints},set:function(e){f(this,Sa)[Sa].perspectivePoints!==e&&(f(this,Sa)[Sa].perspectivePoints=e,this.view.rebuild())}},{key:"minPerspectivePointSize",get:function(){return f(this,Sa)[Sa].minPerspectivePointSize},set:function(e){f(this,Sa)[Sa].minPerspectivePointSize!==e&&(f(this,Sa)[Sa].minPerspectivePointSize=e,this.view.rebuild())}},{key:"maxPerspectivePointSize",get:function(){return f(this,Sa)[Sa].maxPerspectivePointSize},set:function(e){f(this,Sa)[Sa].maxPerspectivePointSize!==e&&(f(this,Sa)[Sa].maxPerspectivePointSize=e,this.view.rebuild())}},{key:"filterIntensity",get:function(){return f(this,Sa)[Sa].filterIntensity},set:function(e){f(this,Sa)[Sa].filterIntensity!==e&&(f(this,Sa)[Sa].filterIntensity=e,this.view.rebuild())}},{key:"minIntensity",get:function(){return f(this,Sa)[Sa].minIntensity},set:function(e){f(this,Sa)[Sa].minIntensity!==e&&(f(this,Sa)[Sa].minIntensity=e,this.view.redraw())}},{key:"maxIntensity",get:function(){return f(this,Sa)[Sa].maxIntensity},set:function(e){f(this,Sa)[Sa].maxIntensity!==e&&(f(this,Sa)[Sa].maxIntensity=e,this.view.redraw())}},{key:"hash",get:function(){var e=f(this,Sa)[Sa];return e.pointSize+";\n        "+e.roundPoints+";\n        "+e.perspectivePoints+";\n        "+e.minPerspectivePointSize+";\n        "+e.maxPerspectivePointSize+";\n        "+e.filterIntensity}}]),t}(ae),Oa=/*#__PURE__*/d("state"),ja=/*#__PURE__*/d("inverseMatrixDirty"),Ra=/*#__PURE__*/d("transposedProjMatrixDirty"),Da=/*#__PURE__*/d("onViewBoundary"),Aa=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).camera=void 0,r.onProjMatrix=void 0,Object.defineProperty(c(r),Oa,{writable:!0,value:void 0}),Object.defineProperty(c(r),ja,{writable:!0,value:void 0}),Object.defineProperty(c(r),Ra,{writable:!0,value:void 0}),Object.defineProperty(c(r),Da,{writable:!0,value:void 0}),r.camera=t,f(c(r),Oa)[Oa]={near:i.near||.1,far:i.far||2e3,fov:i.fov||60,fovAxis:i.fovAxis||"min",projMatrix:Zt(),inverseProjMatrix:Zt(),transposedProjMatrix:Zt()},f(c(r),ja)[ja]=!0,f(c(r),Ra)[Ra]=!0,f(c(r),Da)[Da]=r.camera.view.onBoundary.subscribe(function(){r.setDirty()}),r.onProjMatrix=new p(new te.EventDispatcher),r}r(t,e);var n=t.prototype;return n.clean=function(){var e=this.camera.view.boundary,t=e[2]/e[3],i=f(this,Oa)[Oa].fovAxis,r=f(this,Oa)[Oa].fov;("x"===i||"min"===i&&t<1||"max"===i&&t>1)&&(r/=t),$t((r=Math.min(r,120))*(Math.PI/180),t,f(this,Oa)[Oa].near,f(this,Oa)[Oa].far,f(this,Oa)[Oa].projMatrix),f(this,ja)[ja]=!0,f(this,Ra)[Ra]=!0,this.camera.view.redraw(),this.onProjMatrix.dispatch(this,f(this,Oa)[Oa].projMatrix)},n.unproject=function(e,t,i,r,n){var o=this.camera.view.canvasElement,s=o.offsetWidth/2,a=o.offsetHeight/2;return i[0]=(e[0]-s)/s,i[1]=(e[1]-a)/a,i[2]=t,i[3]=1,li(this.inverseProjMatrix,i,r),_t(r,1/r[3]),r[3]=1,r[1]*=-1,li(this.camera.inverseViewMatrix,r,n),n},n.destroy=function(){e.prototype.destroy.call(this),this.camera.view.onBoundary.unsubscribe(f(this,Da)[Da]),this.onProjMatrix.clear()},i(t,[{key:"fov",get:function(){return f(this,Oa)[Oa].fov},set:function(e){e!==f(this,Oa)[Oa].fov&&(f(this,Oa)[Oa].fov=e,this.setDirty())}},{key:"fovAxis",get:function(){return f(this,Oa)[Oa].fovAxis},set:function(e){e=e||"min",f(this,Oa)[Oa].fovAxis!==e&&("x"!==e&&"y"!==e&&"min"!==e&&(this.error("Unsupported value for 'fovAxis': "+e+" - defaulting to 'min'"),e="min"),f(this,Oa)[Oa].fovAxis=e,this.setDirty())}},{key:"near",get:function(){return f(this,Oa)[Oa].near},set:function(e){f(this,Oa)[Oa].near!==e&&(f(this,Oa)[Oa].near=e,this.setDirty())}},{key:"far",get:function(){return f(this,Oa)[Oa].far},set:function(e){f(this,Oa)[Oa].far!==e&&(f(this,Oa)[Oa].far=e,this.setDirty())}},{key:"projMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),f(this,Oa)[Oa].projMatrix}},{key:"inverseProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),f(this,ja)[ja]&&(ai(f(this,Oa)[Oa].projMatrix,f(this,Oa)[Oa].inverseProjMatrix),f(this,ja)[ja]=!1),f(this,Oa)[Oa].inverseProjMatrix}},{key:"transposedProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),f(this,Ra)[Ra]&&(ci(f(this,Oa)[Oa].projMatrix,f(this,Oa)[Oa].transposedProjMatrix),f(this,Ra)[Ra]=!1),f(this,Oa)[Oa].transposedProjMatrix}}]),t}(ae);Aa.type=et;var Ca=/*#__PURE__*/d("state"),ka=/*#__PURE__*/d("inverseMatrixDirty"),Ba=/*#__PURE__*/d("transposedProjMatrixDirty"),La=/*#__PURE__*/d("onViewBoundary"),Fa=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).camera=void 0,r.onProjMatrix=void 0,Object.defineProperty(c(r),Ca,{writable:!0,value:void 0}),Object.defineProperty(c(r),ka,{writable:!0,value:void 0}),Object.defineProperty(c(r),Ba,{writable:!0,value:void 0}),Object.defineProperty(c(r),La,{writable:!0,value:void 0}),r.camera=t,f(c(r),Ca)[Ca]={near:i.near||.1,far:i.far||2e3,scale:i.scale||1,projMatrix:Zt(),inverseProjMatrix:Zt(),transposedProjMatrix:Zt()},r.onProjMatrix=new p(new te.EventDispatcher),f(c(r),ka)[ka]=!0,f(c(r),Ba)[Ba]=!0,f(c(r),La)[La]=r.camera.view.onBoundary.subscribe(function(){r.setDirty()}),r}r(t,e);var n=t.prototype;return n.clean=function(){var e,t,i,r,n=this.camera.view,o=.5*f(this,Ca)[Ca].scale,s=n.boundary,a=s[2],c=s[3],l=a/c;a>c?(e=-o,t=o,i=o/l,r=-o/l):(e=-o*l,t=o*l,i=o,r=-o),ti(e,t,r,i,f(this,Ca)[Ca].near,f(this,Ca)[Ca].far,f(this,Ca)[Ca].projMatrix),f(this,ka)[ka]=!0,f(this,Ba)[Ba]=!0,this.camera.view.redraw(),this.onProjMatrix.dispatch(this,f(this,Ca)[Ca].projMatrix)},n.unproject=function(e,t,i,r,n){var o=this.camera.view.canvasElement,s=o.offsetWidth/2,a=o.offsetHeight/2;return i[0]=(e[0]-s)/s,i[1]=(e[1]-a)/a,i[2]=t,i[3]=1,li(this.inverseProjMatrix,i,r),_t(r,1/r[3]),r[3]=1,r[1]*=-1,li(this.camera.inverseViewMatrix,r,n),n},n.destroy=function(){e.prototype.destroy.call(this),this.camera.view.onBoundary.unsubscribe(f(this,La)[La]),this.onProjMatrix.clear()},i(t,[{key:"scale",get:function(){return f(this,Ca)[Ca].scale},set:function(e){e<=0&&(e=.01),f(this,Ca)[Ca].scale=e,this.setDirty()}},{key:"near",get:function(){return f(this,Ca)[Ca].near},set:function(e){f(this,Ca)[Ca].near!==e&&(f(this,Ca)[Ca].near=e,this.setDirty())}},{key:"far",get:function(){return f(this,Ca)[Ca].far},set:function(e){f(this,Ca)[Ca].far!==e&&(f(this,Ca)[Ca].far=e,this.setDirty())}},{key:"projMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),f(this,Ca)[Ca].projMatrix}},{key:"inverseProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),f(this,ka)[ka]&&(ai(f(this,Ca)[Ca].projMatrix,f(this,Ca)[Ca].inverseProjMatrix),f(this,ka)[ka]=!1),f(this,Ca)[Ca].inverseProjMatrix}},{key:"transposedProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),f(this,Ba)[Ba]&&(ci(f(this,Ca)[Ca].projMatrix,f(this,Ca)[Ca].transposedProjMatrix),f(this,Ba)[Ba]=!1),f(this,Ca)[Ca].transposedProjMatrix}}]),t}(ae);Fa.type=tt;var Ua=/*#__PURE__*/d("state"),Na=/*#__PURE__*/d("inverseMatrixDirty"),Va=/*#__PURE__*/d("transposedProjMatrixDirty"),Ga=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).camera=void 0,r.onProjMatrix=void 0,Object.defineProperty(c(r),Ua,{writable:!0,value:void 0}),Object.defineProperty(c(r),Na,{writable:!0,value:void 0}),Object.defineProperty(c(r),Va,{writable:!0,value:void 0}),r.camera=t,f(c(r),Ua)[Ua]={projMatrix:Zt(),inverseProjMatrix:Zt(),transposedProjMatrix:Zt(),near:.1,far:1e4,left:null!=i.left?i.left:-1,right:null!=i.right?i.right:1,bottom:null!=i.bottom?i.bottom:-1,top:null!=i.top?i.top:1},r.onProjMatrix=new p(new te.EventDispatcher),f(c(r),Na)[Na]=!0,f(c(r),Va)[Va]=!0,r}r(t,e);var n=t.prototype;return n.clean=function(){ii(f(this,Ua)[Ua].left,f(this,Ua)[Ua].right,f(this,Ua)[Ua].bottom,f(this,Ua)[Ua].top,f(this,Ua)[Ua].near,f(this,Ua)[Ua].far,f(this,Ua)[Ua].projMatrix),f(this,Na)[Na]=!0,f(this,Va)[Va]=!0,this.camera.view.redraw(),this.onProjMatrix.dispatch(this,f(this,Ua)[Ua].projMatrix)},n.unproject=function(e,t,i,r,n){var o=this.camera.view.canvasElement,s=o.offsetWidth/2,a=o.offsetHeight/2;return i[0]=(e[0]-s)/s,i[1]=(e[1]-a)/a,i[2]=t,i[3]=1,li(this.inverseProjMatrix,i,r),_t(r,1/r[3]),r[3]=1,r[1]*=-1,li(this.camera.inverseViewMatrix,r,n),n},n.destroy=function(){e.prototype.destroy.call(this),this.onProjMatrix.clear()},i(t,[{key:"left",get:function(){return f(this,Ua)[Ua].left},set:function(e){f(this,Ua)[Ua].left=e,this.setDirty()}},{key:"right",get:function(){return f(this,Ua)[Ua].right},set:function(e){f(this,Ua)[Ua].right=e,this.setDirty()}},{key:"top",get:function(){return f(this,Ua)[Ua].top},set:function(e){f(this,Ua)[Ua].top=e,this.setDirty()}},{key:"bottom",get:function(){return f(this,Ua)[Ua].bottom},set:function(e){f(this,Ua)[Ua].bottom=e,this.setDirty()}},{key:"near",get:function(){return f(this,Ua)[Ua].near},set:function(e){f(this,Ua)[Ua].near=e,this.setDirty()}},{key:"far",get:function(){return f(this,Ua)[Ua].far},set:function(e){f(this,Ua)[Ua].far=e,this.setDirty()}},{key:"projMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),f(this,Ua)[Ua].projMatrix}},{key:"inverseProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),f(this,Na)[Na]&&(ai(f(this,Ua)[Ua].projMatrix,f(this,Ua)[Ua].inverseProjMatrix),f(this,Na)[Na]=!1),f(this,Ua)[Ua].inverseProjMatrix}},{key:"transposedProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),f(this,Va)[Va]&&(ci(f(this,Ua)[Ua].projMatrix,f(this,Ua)[Ua].transposedProjMatrix),f(this,Va)[Va]=!1),f(this,Ua)[Ua].transposedProjMatrix}}]),t}(ae);Ga.type=it;var Ha=/*#__PURE__*/d("state"),Xa=/*#__PURE__*/d("inverseProjMatrixDirty"),Wa=/*#__PURE__*/d("transposedProjMatrixDirty"),Ya=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).camera=void 0,r.onProjMatrix=void 0,Object.defineProperty(c(r),Ha,{writable:!0,value:void 0}),Object.defineProperty(c(r),Xa,{writable:!0,value:void 0}),Object.defineProperty(c(r),Wa,{writable:!0,value:void 0}),r.camera=t,f(c(r),Ha)[Ha]={projMatrix:Zt(i.projMatrix||ri()),inverseProjMatrix:Zt(),transposedProjMatrix:Zt()},r.onProjMatrix=new p(new te.EventDispatcher),f(c(r),Xa)[Xa]=!0,f(c(r),Wa)[Wa]=!1,r}r(t,e);var n=t.prototype;return n.unproject=function(e,t,i,r,n){var o=this.camera.view.canvasElement,s=o.offsetWidth/2,a=o.offsetHeight/2;return i[0]=(e[0]-s)/s,i[1]=(e[1]-a)/a,i[2]=t,i[3]=1,li(this.inverseProjMatrix,i,r),_t(r,1/r[3]),r[3]=1,r[1]*=-1,li(this.camera.inverseViewMatrix,r,n),n},n.destroy=function(){e.prototype.destroy.call(this),this.onProjMatrix.clear()},i(t,[{key:"projMatrix",get:function(){return f(this,Ha)[Ha].projMatrix},set:function(e){f(this,Ha)[Ha].projMatrix.set(e),f(this,Xa)[Xa]=!0,f(this,Wa)[Wa]=!0,this.setDirty(),this.camera.view.redraw(),this.onProjMatrix.dispatch(this,f(this,Ha)[Ha].projMatrix)}},{key:"inverseProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),f(this,Xa)[Xa]&&(ai(f(this,Ha)[Ha].projMatrix,f(this,Ha)[Ha].inverseProjMatrix),f(this,Xa)[Xa]=!1),f(this,Ha)[Ha].inverseProjMatrix}},{key:"transposedProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),f(this,Wa)[Wa]&&(ci(f(this,Ha)[Ha].projMatrix,f(this,Ha)[Ha].transposedProjMatrix),f(this,Wa)[Wa]=!1),f(this,Ha)[Ha].transposedProjMatrix}}]),t}(ae);Ya.type=rt;var Ka=wt(),za=wt(),qa=wt(),Za=wt(),Qa=wt(),Ja=wt(),$a=Zt(),ec=Zt(),tc=wt(),ic=wt(),rc=wt(),nc=wt(),oc=/*#__PURE__*/d("state"),sc=/*#__PURE__*/d("frustum"),ac=/*#__PURE__*/d("activeProjection"),cc=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,r.perspectiveProjection=void 0,r.orthoProjection=void 0,r.frustumProjection=void 0,r.customProjection=void 0,r.onProjectionType=void 0,r.onViewMatrix=void 0,r.onProjMatrix=void 0,r.onWorldAxis=void 0,r.onFrustum=void 0,Object.defineProperty(c(r),oc,{writable:!0,value:void 0}),Object.defineProperty(c(r),sc,{writable:!0,value:void 0}),Object.defineProperty(c(r),ac,{writable:!0,value:void 0}),r.onProjectionType=new p(new te.EventDispatcher),r.onViewMatrix=new p(new te.EventDispatcher),r.onProjMatrix=new p(new te.EventDispatcher),r.onWorldAxis=new p(new te.EventDispatcher),r.onFrustum=new p(new te.EventDispatcher),r.view=t,f(c(r),oc)[oc]={eye:wt(i.eye||[0,0,10]),look:wt(i.look||[0,0,0]),up:wt(i.up||[0,1,0]),worldUp:wt([0,1,0]),worldRight:wt([1,0,0]),worldForward:wt([0,0,-1]),worldAxis:new Float32Array(i.worldAxis||[1,0,0,0,1,0,0,0,1]),gimbalLock:!1!==i.gimbalLock,constrainPitch:!0===i.constrainPitch,projectionType:i.projectionType||et,deviceMatrix:i.deviceMatrix?Zt(i.deviceMatrix):ri(),hasDeviceMatrix:!!i.deviceMatrix,viewMatrix:Zt(),viewNormalMatrix:Zt(),inverseViewMatrix:Zt()},f(c(r),sc)[sc]=new Vr,r.perspectiveProjection=new Aa(c(r)),r.orthoProjection=new Fa(c(r)),r.frustumProjection=new Ga(c(r)),r.customProjection=new Ya(c(r)),f(c(r),ac)[ac]=r.perspectiveProjection,r.perspectiveProjection.onProjMatrix.subscribe(function(){f(c(r),oc)[oc].projectionType===et&&r.onProjMatrix.dispatch(c(r),r.perspectiveProjection.projMatrix)}),r.orthoProjection.onProjMatrix.subscribe(function(){f(c(r),oc)[oc].projectionType===tt&&r.onProjMatrix.dispatch(c(r),r.orthoProjection.projMatrix)}),r.frustumProjection.onProjMatrix.subscribe(function(){f(c(r),oc)[oc].projectionType===it&&r.onProjMatrix.dispatch(c(r),r.frustumProjection.projMatrix)}),r.customProjection.onProjMatrix.subscribe(function(){f(c(r),oc)[oc].projectionType===rt&&r.onProjMatrix.dispatch(c(r),r.customProjection.projMatrix)}),r}r(t,e);var n=t.prototype;return n.clean=function(){var e,t=f(this,oc)[oc];this.projectionType===tt?(Mt(f(this,oc)[oc].eye,f(this,oc)[oc].look,tc),Yt(tc,ic),_t(ic,1e3,rc),xt(f(this,oc)[oc].look,rc,nc),e=nc):e=f(this,oc)[oc].eye,t.hasDeviceMatrix?(si(e,f(this,oc)[oc].look,f(this,oc)[oc].up,ec),hi(t.deviceMatrix,ec,t.viewMatrix)):si(e,f(this,oc)[oc].look,f(this,oc)[oc].up,t.viewMatrix),ai(f(this,oc)[oc].viewMatrix,f(this,oc)[oc].inverseViewMatrix),ci(f(this,oc)[oc].inverseViewMatrix,f(this,oc)[oc].viewNormalMatrix),this.view.redraw(),Gr(f(this,oc)[oc].viewMatrix,f(this,ac)[ac].projMatrix,f(this,sc)[sc]),this.onViewMatrix.dispatch(this,f(this,oc)[oc].viewMatrix),this.onFrustum.dispatch(this,f(this,sc)[sc])},n.orbitYaw=function(e){var t=Mt(f(this,oc)[oc].eye,f(this,oc)[oc].look,Ka);oi(.0174532925*e,f(this,oc)[oc].gimbalLock?f(this,oc)[oc].worldUp:f(this,oc)[oc].up,$a),t=di($a,t,za),this.eye=xt(f(this,oc)[oc].look,t,qa),this.up=di($a,f(this,oc)[oc].up,Za)},n.orbitPitch=function(e){if(!(f(this,oc)[oc].constrainPitch&&(e=bt(f(this,oc)[oc].up,f(this,oc)[oc].worldUp)/at)<1)){var t=Mt(f(this,oc)[oc].eye,f(this,oc)[oc].look,Ka);oi(.0174532925*e,At(Yt(t,za),Yt(f(this,oc)[oc].up,qa)),$a),t=di($a,t,Za),this.up=di($a,f(this,oc)[oc].up,Qa),this.eye=xt(t,f(this,oc)[oc].look,Ja)}},n.yaw=function(e){var t=Mt(f(this,oc)[oc].look,f(this,oc)[oc].eye,Ka);oi(.0174532925*e,f(this,oc)[oc].gimbalLock?f(this,oc)[oc].worldUp:f(this,oc)[oc].up,$a),t=di($a,t,za),this.look=xt(t,f(this,oc)[oc].eye,qa),f(this,oc)[oc].gimbalLock&&(this.up=di($a,f(this,oc)[oc].up,Za))},n.pitch=function(e){if(!(f(this,oc)[oc].constrainPitch&&(e=bt(f(this,oc)[oc].up,f(this,oc)[oc].worldUp)/at)<1)){var t=Mt(f(this,oc)[oc].look,f(this,oc)[oc].eye,Ka);oi(.0174532925*e,At(Yt(t,za),Yt(f(this,oc)[oc].up,qa)),$a),this.up=di($a,f(this,oc)[oc].up,Ja),t=di($a,t,Za),this.look=xt(t,f(this,oc)[oc].eye,Qa)}},n.pan=function(e){var t,i=Mt(f(this,oc)[oc].eye,f(this,oc)[oc].look,Ka),r=[0,0,0];0!==e[0]&&(t=_t(At(Yt(i,[]),Yt(f(this,oc)[oc].up,za)),e[0]),r[0]+=t[0],r[1]+=t[1],r[2]+=t[2]),0!==e[1]&&(t=_t(Yt(f(this,oc)[oc].up,qa),e[1]),r[0]+=t[0],r[1]+=t[1],r[2]+=t[2]),0!==e[2]&&(t=_t(Yt(i,Za),e[2]),r[0]+=t[0],r[1]+=t[1],r[2]+=t[2]),this.eye=xt(f(this,oc)[oc].eye,r,Qa),this.look=xt(f(this,oc)[oc].look,r,Ja)},n.zoom=function(e){var t=Mt(f(this,oc)[oc].eye,f(this,oc)[oc].look,Ka),i=Math.abs(Ut(t)),r=Math.abs(i+e);if(!(r<.5)){var n=Yt(t,qa);this.eye=xt(f(this,oc)[oc].look,_t(n,r),Za)}},n.destroy=function(){e.prototype.destroy.call(this),this.onProjectionType.clear(),this.onViewMatrix.clear(),this.onProjMatrix.clear(),this.onWorldAxis.clear()},i(t,[{key:"project",get:function(){return f(this,ac)[ac]}},{key:"eye",get:function(){return f(this,oc)[oc].eye},set:function(e){f(this,oc)[oc].eye.set(e),this.setDirty()}},{key:"look",get:function(){return f(this,oc)[oc].look},set:function(e){f(this,oc)[oc].look.set(e),this.setDirty()}},{key:"up",get:function(){return f(this,oc)[oc].up},set:function(e){f(this,oc)[oc].up.set(e),this.setDirty()}},{key:"worldUp",get:function(){return f(this,oc)[oc].worldUp}},{key:"worldRight",get:function(){return f(this,oc)[oc].worldRight}},{key:"worldForward",get:function(){return f(this,oc)[oc].worldForward}},{key:"constrainPitch",get:function(){return f(this,oc)[oc].constrainPitch},set:function(e){f(this,oc)[oc].constrainPitch=e}},{key:"gimbalLock",get:function(){return f(this,oc)[oc].gimbalLock},set:function(e){f(this,oc)[oc].gimbalLock=e}},{key:"worldAxis",get:function(){return f(this,oc)[oc].worldAxis},set:function(e){var t=f(this,oc)[oc];t.worldAxis.set(e),t.worldRight[0]=t.worldAxis[0],t.worldRight[1]=t.worldAxis[1],t.worldRight[2]=t.worldAxis[2],t.worldUp[0]=t.worldAxis[3],t.worldUp[1]=t.worldAxis[4],t.worldUp[2]=t.worldAxis[5],t.worldForward[0]=t.worldAxis[6],t.worldForward[1]=t.worldAxis[7],t.worldForward[2]=t.worldAxis[8],this.onWorldAxis.dispatch(this,t.worldAxis)}},{key:"deviceMatrix",get:function(){return f(this,oc)[oc].deviceMatrix},set:function(e){f(this,oc)[oc].deviceMatrix.set(e||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),f(this,oc)[oc].hasDeviceMatrix=!!e,this.setDirty()}},{key:"xUp",get:function(){return f(this,oc)[oc].worldUp[0]>f(this,oc)[oc].worldUp[1]&&f(this,oc)[oc].worldUp[0]>f(this,oc)[oc].worldUp[2]}},{key:"yUp",get:function(){return f(this,oc)[oc].worldUp[1]>f(this,oc)[oc].worldUp[0]&&f(this,oc)[oc].worldUp[1]>f(this,oc)[oc].worldUp[2]}},{key:"zUp",get:function(){return f(this,oc)[oc].worldUp[2]>f(this,oc)[oc].worldUp[0]&&f(this,oc)[oc].worldUp[2]>f(this,oc)[oc].worldUp[1]}},{key:"eyeLookDist",get:function(){return Ut(Mt(f(this,oc)[oc].look,f(this,oc)[oc].eye,Ka))}},{key:"viewMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),f(this,oc)[oc].viewMatrix}},{key:"inverseViewMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),f(this,oc)[oc].inverseViewMatrix}},{key:"projMatrix",get:function(){return f(this,ac)[ac].projMatrix}},{key:"frustum",get:function(){return this.dirty&&this.cleanIfDirty(),f(this,sc)[sc]}},{key:"projectionType",get:function(){return f(this,oc)[oc].projectionType},set:function(e){e=e||et,f(this,oc)[oc].projectionType!==e&&(e===et?f(this,ac)[ac]=this.perspectiveProjection:e===tt?f(this,ac)[ac]=this.orthoProjection:e===it?f(this,ac)[ac]=this.frustumProjection:e===rt?f(this,ac)[ac]=this.customProjection:(this.error("Unsupported value for 'projection': "+e+" defaulting to PerspectiveProjectionType"),f(this,ac)[ac]=this.perspectiveProjection,e=et),f(this,ac)[ac].clean(),f(this,oc)[oc].projectionType=e,this.clean(),this.onProjectionType.dispatch(this,f(this,oc)[oc].projectionType),this.onProjMatrix.dispatch(this,f(this,ac)[ac].projMatrix))}}]),t}(ae),lc={viewerId:"",time:0,startTime:0,prevTime:0,deltaTime:0},hc=/*#__PURE__*/d("viewersRenderInfo"),uc=/*#__PURE__*/d("viewerIDMap"),dc=/*#__PURE__*/d("taskQueue"),fc=/*#__PURE__*/d("taskBudget"),vc=/*#__PURE__*/d("lastTime"),pc=/*#__PURE__*/d("elapsedTime"),yc=/*#__PURE__*/d("runTasks"),mc=/*#__PURE__*/d("runTasksUntil"),bc=/*#__PURE__*/d("fireTickEvents"),gc=/*#__PURE__*/d("renderViewers");function wc(e){f(this,mc)[mc](e+f(this,fc)[fc]),this.getNumTasks(),f(this,fc)}function Pc(e){void 0===e&&(e=-1);for(var t=(new Date).getTime(),i=0;f(this,dc)[dc].length>0&&(e<0||t<e);){var r=f(this,dc)[dc].shift(),n=f(this,dc)[dc].shift();n?r.call(n):r(),t=(new Date).getTime(),i++}return i}function Ec(e){for(var t in lc.time=e,_c.viewers)if(this.viewers.hasOwnProperty(t)){var i=this.viewers[t];lc.viewerId=t,lc.startTime=i.startTime,lc.deltaTime=null!=lc.prevTime?lc.time-lc.prevTime:0,i.onTick.dispatch(i,lc)}lc.prevTime=e}function Tc(){for(var e in this.viewers)if(this.viewers.hasOwnProperty(e)){var t=this.viewers[e],i=f(this,hc)[hc][e];i||(i=f(this,hc)[hc][e]={}),t.render({})}}var _c=new(/*#__PURE__*/function(){function e(){var e=this;Object.defineProperty(this,gc,{value:Tc}),Object.defineProperty(this,bc,{value:Ec}),Object.defineProperty(this,mc,{value:Pc}),Object.defineProperty(this,yc,{value:wc}),this.viewers=void 0,Object.defineProperty(this,hc,{writable:!0,value:{}}),Object.defineProperty(this,uc,{writable:!0,value:new Gi}),Object.defineProperty(this,dc,{writable:!0,value:new Hi}),Object.defineProperty(this,fc,{writable:!0,value:10}),Object.defineProperty(this,vc,{writable:!0,value:0}),Object.defineProperty(this,pc,{writable:!0,value:0}),this.viewers={},requestAnimationFrame(function t(){var i=Date.now();f(e,vc)[vc]>0&&(f(e,pc)[pc]=i-f(e,vc)[vc]),f(e,yc)[yc](i),f(e,bc)[bc](i),f(e,gc)[gc](),f(e,vc)[vc]=i,requestAnimationFrame(t)})}var t=e.prototype;return t.registerViewer=function(e){if(e.id){if(this.viewers[e.id])return void console.error("[ERROR] Viewer "+nr(e.id)+" already exists")}else e.id=f(this,uc)[uc].addItem({});this.viewers[e.id]=e,f(this,hc)[hc][e.id]={}},t.deregisterViewer=function(e){this.viewers[e.id]&&(f(this,uc)[uc].removeItem(e.id),delete this.viewers[e.id],delete f(this,hc)[hc][e.id])},t.scheduleTask=function(e,t){f(this,dc)[dc].push(e),f(this,dc)[dc].push(t)},t.getNumTasks=function(){return f(this,dc)[dc].length},e}()),Ic=wt(),xc=wt(),Sc=wt(),Mc=wt(),Oc=wt(),jc=/*#__PURE__*/d("duration"),Rc=/*#__PURE__*/d("look1"),Dc=/*#__PURE__*/d("eye1"),Ac=/*#__PURE__*/d("up1"),Cc=/*#__PURE__*/d("look2"),kc=/*#__PURE__*/d("eye2"),Bc=/*#__PURE__*/d("up2"),Lc=/*#__PURE__*/d("orthoScale1"),Fc=/*#__PURE__*/d("orthoScale2"),Uc=/*#__PURE__*/d("fit"),Nc=/*#__PURE__*/d("trail"),Vc=/*#__PURE__*/d("flying"),Gc=/*#__PURE__*/d("flyEyeLookUp"),Hc=/*#__PURE__*/d("flyingEye"),Xc=/*#__PURE__*/d("flyingLook"),Wc=/*#__PURE__*/d("callback"),Yc=/*#__PURE__*/d("callbackScope"),Kc=/*#__PURE__*/d("time1"),zc=/*#__PURE__*/d("time2"),qc=/*#__PURE__*/d("flyingEyeLookUp"),Zc=/*#__PURE__*/d("fitFOV"),Qc=/*#__PURE__*/d("projection2"),Jc=/*#__PURE__*/d("projMatrix1"),$c=/*#__PURE__*/d("projMatrix2"),el=/*#__PURE__*/d("jumpTo"),tl=/*#__PURE__*/d("update"),il=/*#__PURE__*/d("ease"),rl=/*#__PURE__*/d("easeInCubic"),nl=/*#__PURE__*/d("easeOutExpo"),ol=/*#__PURE__*/function(e){function t(t,i){var r;return r=e.call(this,t,i)||this,Object.defineProperty(c(r),tl,{value:al}),Object.defineProperty(c(r),el,{value:sl}),r.view=void 0,r.camera=void 0,Object.defineProperty(c(r),jc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Rc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Dc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Ac,{writable:!0,value:void 0}),Object.defineProperty(c(r),Cc,{writable:!0,value:void 0}),Object.defineProperty(c(r),kc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Bc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Lc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Fc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Uc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Nc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Vc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Gc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Hc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Xc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Wc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Yc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Kc,{writable:!0,value:void 0}),Object.defineProperty(c(r),zc,{writable:!0,value:void 0}),r.easing=void 0,Object.defineProperty(c(r),qc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Zc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Qc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Jc,{writable:!0,value:void 0}),Object.defineProperty(c(r),$c,{writable:!0,value:void 0}),r.onStarted=void 0,r.onStopped=void 0,r.onCancelled=void 0,r.view=t,r.camera=t.camera,f(c(r),Rc)[Rc]=wt(),f(c(r),Dc)[Dc]=wt(),f(c(r),Ac)[Ac]=wt(),f(c(r),Cc)[Cc]=wt(),f(c(r),kc)[kc]=wt(),f(c(r),Bc)[Bc]=wt(),f(c(r),Lc)[Lc]=1,f(c(r),Fc)[Fc]=1,f(c(r),Vc)[Vc]=!1,f(c(r),Gc)[Gc]=!1,f(c(r),Hc)[Hc]=!1,f(c(r),Xc)[Xc]=!1,f(c(r),Wc)[Wc]=null,f(c(r),Yc)[Yc]=null,f(c(r),Kc)[Kc]=null,f(c(r),zc)[zc]=null,r.easing=!0,f(c(r),Nc)[Nc]=!1,f(c(r),Uc)[Uc]=!0,f(c(r),jc)[jc]=500,r.onStarted=new p(new te.EventDispatcher),r.onStopped=new p(new te.EventDispatcher),r.onCancelled=new p(new te.EventDispatcher),r}r(t,e);var n=t.prototype;return n.flyTo=function(e,t){void 0===e&&(e={}),f(this,Vc)[Vc]&&this.stop(),f(this,Vc)[Vc]=!1,f(this,Hc)[Hc]=!1,f(this,Xc)[Xc]=!1,f(this,qc)[qc]=!1,f(this,Wc)[Wc]=t;var i,r,n,o,s=this.camera,a=!!e.projection&&e.projection!==s.projectionType;f(this,Dc)[Dc][0]=s.eye[0],f(this,Dc)[Dc][1]=s.eye[1],f(this,Dc)[Dc][2]=s.eye[2],f(this,Rc)[Rc][0]=s.look[0],f(this,Rc)[Rc][1]=s.look[1],f(this,Rc)[Rc][2]=s.look[2],f(this,Ac)[Ac][0]=s.up[0],f(this,Ac)[Ac][1]=s.up[1],f(this,Ac)[Ac][2]=s.up[2],f(this,Lc)[Lc]=s.orthoProjection.scale,f(this,Fc)[Fc]=e.orthoScale||f(this,Lc)[Lc],e.aabb?i=e.aabb:e.eye&&e.look||e.up?(r=e.eye,n=e.look,o=e.up):e.eye?r=e.eye:e.look?n=e.look:a||(i=this.view.aabb);var c=e.poi;if(i){if(i[3]<i[0]||i[4]<i[1]||i[5]<i[2])return;if(i[3]===i[0]&&i[4]===i[1]&&i[5]===i[2])return;var l=Or(i=i.slice());f(this,Cc)[Cc]=c||l;var h=Yt(Mt(f(this,Dc)[Dc],f(this,Rc)[Rc],Ic)),u=c?Mr(i,c):Sr(i),d=e.fitFOV||f(this,Zc)[Zc],v=Math.abs(u/Math.tan(d*at));f(this,Fc)[Fc]=1.1*u,f(this,kc)[kc][0]=f(this,Cc)[Cc][0]+h[0]*v,f(this,kc)[kc][1]=f(this,Cc)[Cc][1]+h[1]*v,f(this,kc)[kc][2]=f(this,Cc)[Cc][2]+h[2]*v,f(this,Bc)[Bc][0]=f(this,Ac)[Ac][0],f(this,Bc)[Bc][1]=f(this,Ac)[Ac][1],f(this,Bc)[Bc][2]=f(this,Ac)[Ac][2],f(this,qc)[qc]=!0}else(r||n||o)&&(f(this,qc)[qc]=!!r&&!!n&&!!o,f(this,Hc)[Hc]=!!r&&!n,f(this,Xc)[Xc]=!!n&&!r,r&&(f(this,kc)[kc][0]=r[0],f(this,kc)[kc][1]=r[1],f(this,kc)[kc][2]=r[2]),n&&(f(this,Cc)[Cc][0]=n[0],f(this,Cc)[Cc][1]=n[1],f(this,Cc)[Cc][2]=n[2]),o&&(f(this,Bc)[Bc][0]=o[0],f(this,Bc)[Bc][1]=o[1],f(this,Bc)[Bc][2]=o[2]));a?(e.projection===tt&&s.projectionType!==tt&&(f(this,Qc)[Qc]=tt,f(this,Jc)[Jc]=s.projMatrix.slice(),f(this,$c)[$c]=s.orthoProjection.projMatrix.slice(),s.projectionType=rt),e.projection===et&&s.projectionType!==et&&(f(this,Qc)[Qc]=et,f(this,Jc)[Jc]=s.projMatrix.slice(),f(this,$c)[$c]=s.perspectiveProjection.projMatrix.slice(),s.projectionType=rt)):f(this,Qc)[Qc]=null,this.onStarted.dispatch(this,null),f(this,Kc)[Kc]=Date.now(),f(this,zc)[zc]=f(this,Kc)[Kc]+(e.duration?1e3*e.duration:f(this,jc)[jc]),f(this,Vc)[Vc]=!0,_c.scheduleTask(f(this,tl)[tl],this)},n.jumpTo=function(e){f(this,el)[el](e)},n.stop=function(){if(f(this,Vc)[Vc]){f(this,Vc)[Vc]=!1,f(this,Kc)[Kc]=null,f(this,zc)[zc]=null,f(this,Qc)[Qc]&&(this.camera.projectionType=f(this,Qc)[Qc]);var e=f(this,Wc)[Wc];e&&(f(this,Wc)[Wc]=null,e()),this.onStopped.dispatch(this,null)}},n.cancel=function(){f(this,Vc)[Vc]&&(f(this,Vc)[Vc]=!1,f(this,Kc)[Kc]=null,f(this,zc)[zc]=null,f(this,Wc)[Wc]&&(f(this,Wc)[Wc]=null),this.onCancelled.dispatch(this,null))},n.destroy=function(){this.stop(),e.prototype.destroy.call(this),this.onStarted.clear(),this.onStopped.clear(),this.onCancelled.clear()},i(t,[{key:"duration",get:function(){return f(this,jc)[jc]/1e3},set:function(e){f(this,jc)[jc]=e?1e3*e:500,this.stop()}},{key:"fit",get:function(){return f(this,Uc)[Uc]},set:function(e){f(this,Uc)[Uc]=e}},{key:"fitFOV",get:function(){return f(this,Zc)[Zc]},set:function(e){f(this,Zc)[Zc]=e}},{key:"trail",get:function(){return f(this,Nc)[Nc]},set:function(e){f(this,Nc)[Nc]=e}}]),t}(ae);function sl(e){f(this,Vc)[Vc]&&this.stop();var t,i,r,n,o=this.camera;e.aabb?t=e.aabb:e.eye||e.look||e.up?(i=e.eye,r=e.look,n=e.up):t=this.view.aabb;var s=e.poi;if(t){if(t[3]<=t[0]||t[4]<=t[1]||t[5]<=t[2])return;var a,c=s?Mr(t,s):Sr(t);r=s||Or(t,r),f(this,Nc)[Nc]?Mt(o.look,r,Oc):Mt(o.eye,o.look,Oc),Yt(Oc),a=(void 0!==e.fit?e.fit:f(this,Uc)[Uc])?Math.abs(c/Math.tan((e.fitFOV||f(this,Zc)[Zc])*at)):Ut(Mt(o.eye,o.look,Ic)),_t(Oc,a),o.eye=xt(r,Oc,Ic),o.look=r,this.camera.orthoProjection.scale=1.1*c}else(i||r||n)&&(i&&(o.eye=i),r&&(o.look=r),n&&(o.up=n));e.projection&&(o.projectionType=e.projection)}function al(){if(f(this,Vc)[Vc]){var e=(Date.now()-f(this,Kc)[Kc])/(f(this,zc)[zc]-f(this,Kc)[Kc]),t=e>=1;e>1&&(e=1);var i=this.easing?f(ol,il)[il](e,0,1,1):e,r=this.camera;if(f(this,Hc)[Hc]||f(this,Xc)[Xc]?f(this,Hc)[Hc]?(Mt(r.eye,r.look,Oc),r.eye=Ht(i,0,1,f(this,Dc)[Dc],f(this,kc)[kc],Sc),r.look=Mt(Sc,Oc,xc)):f(this,Xc)[Xc]&&(r.look=Ht(i,0,1,f(this,Rc)[Rc],f(this,Cc)[Cc],xc),r.up=Ht(i,0,1,f(this,Ac)[Ac],f(this,Bc)[Bc],Mc)):f(this,qc)[qc]&&(r.eye=Ht(i,0,1,f(this,Dc)[Dc],f(this,kc)[kc],Sc),r.look=Ht(i,0,1,f(this,Rc)[Rc],f(this,Cc)[Cc],xc),r.up=Ht(i,0,1,f(this,Ac)[Ac],f(this,Bc)[Bc],Mc)),f(this,Qc)[Qc]){var n=f(this,Qc)[Qc]===tt?f(ol,nl)[nl](e,0,1,1):f(ol,rl)[rl](e,0,1,1);r.customProjection.projMatrix=Di(n,0,1,f(this,Jc)[Jc],f(this,$c)[$c])}else r.orthoProjection.scale=f(this,Lc)[Lc]+e*(f(this,Fc)[Fc]-f(this,Lc)[Lc]);if(t)return r.orthoProjection.scale=f(this,Fc)[Fc],void this.stop();_c.scheduleTask(f(this,tl)[tl],this)}}Object.defineProperty(ol,nl,{value:function(e,t,i,r){return i*(1-Math.pow(2,-10*e/r))+t}}),Object.defineProperty(ol,rl,{value:function(e,t,i,r){return i*(e/=r)*e*e+t}}),Object.defineProperty(ol,il,{value:function(e,t,i,r){return-i*(e/=r)*(e-2)+t}});var cl=/*#__PURE__*/d("onTick"),ll=/*#__PURE__*/d("backgroundColor"),hl=/*#__PURE__*/d("backgroundColorFromAmbientLight"),ul=/*#__PURE__*/d("resolutionScale"),dl=/*#__PURE__*/d("numObjects"),fl=/*#__PURE__*/d("objectIds"),vl=/*#__PURE__*/d("numVisibleObjects"),pl=/*#__PURE__*/d("visibleObjectIds"),yl=/*#__PURE__*/d("numXRayedObjects"),ml=/*#__PURE__*/d("xrayedObjectIds"),bl=/*#__PURE__*/d("numHighlightedObjects"),gl=/*#__PURE__*/d("highlightedObjectIds"),wl=/*#__PURE__*/d("numSelectedObjects"),Pl=/*#__PURE__*/d("selectedObjectIds"),El=/*#__PURE__*/d("numColorizedObjects"),Tl=/*#__PURE__*/d("colorizedObjectIds"),_l=/*#__PURE__*/d("numOpacityObjects"),Il=/*#__PURE__*/d("opacityObjectIds"),xl=/*#__PURE__*/d("qualityRender"),Sl=/*#__PURE__*/d("lightsHash"),Ml=/*#__PURE__*/d("sectionPlanesHash"),Ol=/*#__PURE__*/d("createViewObjects"),jl=/*#__PURE__*/d("registerSectionPlane"),Rl=/*#__PURE__*/d("deregisterSectionPlane"),Dl=/*#__PURE__*/d("destroyViewObjects"),Al=/*#__PURE__*/function(e){function t(t){var i;i=e.call(this,null,t)||this,Object.defineProperty(c(i),Dl,{value:Ll}),Object.defineProperty(c(i),Rl,{value:Bl}),Object.defineProperty(c(i),jl,{value:kl}),Object.defineProperty(c(i),Ol,{value:Cl}),i.viewIndex=void 0,i.camera=void 0,i.canvasElement=void 0,i.transparent=void 0,i.boundary=void 0,i.logarithmicDepthBufferEnabled=void 0,i.sao=void 0,i.cameraFlight=void 0,i.metrics=void 0,i.xrayMaterial=void 0,i.highlightMaterial=void 0,i.selectedMaterial=void 0,i.edgeMaterial=void 0,i.pointsMaterial=void 0,i.linesMaterial=void 0,i.objects=void 0,i.visibleObjects=void 0,i.xrayedObjects=void 0,i.highlightedObjects=void 0,i.selectedObjects=void 0,i.colorizedObjects=void 0,i.opacityObjects=void 0,i.sectionPlanes=void 0,i.sectionPlanesList=[],i.lights=void 0,i.lightsList=[],i.gammaOutput=void 0,i.layers=void 0,i.autoLayers=void 0,i.onBoundary=void 0,i.onObjectVisibility=void 0,i.onObjectXRayed=void 0,i.onLayerCreated=void 0,i.onLayerDestroyed=void 0,i.onSectionPlaneCreated=void 0,i.onSectionPlaneDestroyed=void 0,Object.defineProperty(c(i),cl,{writable:!0,value:void 0}),Object.defineProperty(c(i),ll,{writable:!0,value:void 0}),Object.defineProperty(c(i),hl,{writable:!0,value:void 0}),Object.defineProperty(c(i),ul,{writable:!0,value:void 0}),Object.defineProperty(c(i),dl,{writable:!0,value:void 0}),Object.defineProperty(c(i),fl,{writable:!0,value:void 0}),Object.defineProperty(c(i),vl,{writable:!0,value:void 0}),Object.defineProperty(c(i),pl,{writable:!0,value:void 0}),Object.defineProperty(c(i),yl,{writable:!0,value:void 0}),Object.defineProperty(c(i),ml,{writable:!0,value:void 0}),Object.defineProperty(c(i),bl,{writable:!0,value:void 0}),Object.defineProperty(c(i),gl,{writable:!0,value:void 0}),Object.defineProperty(c(i),wl,{writable:!0,value:void 0}),Object.defineProperty(c(i),Pl,{writable:!0,value:void 0}),Object.defineProperty(c(i),El,{writable:!0,value:void 0}),Object.defineProperty(c(i),Tl,{writable:!0,value:void 0}),Object.defineProperty(c(i),_l,{writable:!0,value:void 0}),Object.defineProperty(c(i),Il,{writable:!0,value:void 0}),Object.defineProperty(c(i),xl,{writable:!0,value:void 0}),Object.defineProperty(c(i),Sl,{writable:!0,value:null}),Object.defineProperty(c(i),Ml,{writable:!0,value:null}),i.viewer=t.viewer;var r=t.canvasElement||document.getElementById(t.canvasId);if(!(r instanceof HTMLCanvasElement))throw"Mandatory View config expected: valid canvasId or canvasElement";i.canvasElement=r,i.viewIndex=0,i.objects={},i.visibleObjects={},i.xrayedObjects={},i.highlightedObjects={},i.selectedObjects={},i.colorizedObjects={},i.opacityObjects={},i.sectionPlanes={},i.sectionPlanesList=[],i.lights={},i.lightsList=[],i.layers={},f(c(i),dl)[dl]=0,f(c(i),fl)[fl]=null,f(c(i),vl)[vl]=0,f(c(i),pl)[pl]=null,f(c(i),yl)[yl]=0,f(c(i),ml)[ml]=null,f(c(i),bl)[bl]=0,f(c(i),gl)[gl]=null,f(c(i),wl)[wl]=0,f(c(i),Pl)[Pl]=null,f(c(i),El)[El]=0,f(c(i),Tl)[Tl]=null,f(c(i),_l)[_l]=0,f(c(i),Il)[Il]=null,f(c(i),xl)[xl]=!!t.qualityRender,i.gammaOutput=!0,f(c(i),Ml)[Ml]=null,f(c(i),Sl)[Sl]=null,i.onBoundary=new p(new te.EventDispatcher),f(c(i),ul)[ul]=1,f(c(i),ll)[ll]=wt([t.backgroundColor?t.backgroundColor[0]:1,t.backgroundColor?t.backgroundColor[1]:1,t.backgroundColor?t.backgroundColor[2]:1]),f(c(i),hl)[hl]=!!t.backgroundColorFromAmbientLight,i.transparent=!!t.transparent,i.canvasElement.width=i.canvasElement.clientWidth,i.canvasElement.height=i.canvasElement.clientHeight,i.boundary=[i.canvasElement.offsetLeft,i.canvasElement.offsetTop,i.canvasElement.clientWidth,i.canvasElement.clientHeight];var n=0,o=0,s=0,a=0,l=0,h=0,u=null,d=null;return f(c(i),cl)[cl]=i.viewer.onTick.subscribe(function(){var e=i.canvasElement,t=f(c(i),ul)[ul]!==d,r=window.innerWidth!==n||window.innerHeight!==o,v=e.clientWidth!==s||e.clientHeight!==a,p=e.offsetLeft!==l||e.offsetTop!==h,y=e.parentElement;if(t||r||v||p||y!==u){if(t||v||p){var m=e.clientWidth,b=e.clientHeight;(t||v)&&(e.width=Math.round(e.clientWidth*f(c(i),ul)[ul]),e.height=Math.round(e.clientHeight*f(c(i),ul)[ul]));var g=i.boundary;g[0]=e.offsetLeft,g[1]=e.offsetTop,g[2]=m,g[3]=b,t&&!v||i.onBoundary.dispatch(c(i),g),s=m,a=b}t&&(d=f(c(i),ul)[ul]),r&&(n=window.innerWidth,o=window.innerHeight),p&&(l=e.offsetLeft,h=e.offsetTop),u=y}}),i.camera=new cc(c(i)),i.sao=new Js(c(i),{}),i.cameraFlight=new ol(c(i),{duration:.5}),i.metrics=new Zs(c(i),{units:t.units,scale:t.scale,origin:t.origin}),i.xrayMaterial=new _a(c(i),{fill:!0,fillColor:[.9,.7,.6],fillAlpha:.4,edges:!0,edgeColor:[.5,.4,.4],edgeAlpha:1,edgeWidth:1}),i.highlightMaterial=new _a(c(i),{fill:!0,fillColor:[1,1,0],fillAlpha:.5,edges:!0,edgeColor:[.5,.4,.4],edgeAlpha:1,edgeWidth:1}),i.selectedMaterial=new _a(c(i),{fill:!0,fillColor:[0,1,0],fillAlpha:.5,edges:!0,edgeColor:[.4,.5,.4],edgeAlpha:1,edgeWidth:1}),i.edgeMaterial=new xa(c(i),{edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1,edges:!0,renderModes:[Je]}),i.pointsMaterial=new Ma(c(i),{pointSize:1,roundPoints:!0,perspectivePoints:!0,minPerspectivePointSize:1,maxPerspectivePointSize:6,filterIntensity:!1,minIntensity:0,maxIntensity:1}),i.linesMaterial=new ea(c(i),{lineWidth:1}),i.lights={},f(c(i),xl)[xl]=!!t.qualityRender,i.autoLayers=!1!==t.autoLayers,i.logarithmicDepthBufferEnabled=!!t.logarithmicDepthBufferEnabled,i.onObjectVisibility=new p(new te.EventDispatcher),i.onObjectXRayed=new p(new te.EventDispatcher),i.onLayerCreated=new p(new te.EventDispatcher),i.onLayerDestroyed=new p(new te.EventDispatcher),i.onSectionPlaneCreated=new p(new te.EventDispatcher),i.onSectionPlaneDestroyed=new p(new te.EventDispatcher),i}r(t,e);var n=t.prototype;return n.initViewObjects=function(){var e=this;for(var t in this.viewer.scene.models)f(this,Ol)[Ol](this.viewer.scene.models[t]);this.viewer.scene.onModelCreated.subscribe(function(t,i){f(e,Ol)[Ol](i)}),this.viewer.scene.onModelDestroyed.subscribe(function(t,i){f(e,Dl)[Dl](i)})},n.registerViewObject=function(e){this.objects[e.id]=e,f(this,dl)[dl]++,f(this,fl)[fl]=null},n.deregisterViewObject=function(e){delete this.objects[e.id],delete this.visibleObjects[e.id],delete this.xrayedObjects[e.id],delete this.highlightedObjects[e.id],delete this.selectedObjects[e.id],delete this.colorizedObjects[e.id],delete this.opacityObjects[e.id],f(this,dl)[dl]--,f(this,fl)[fl]=null},n.objectVisibilityUpdated=function(e,t,i){void 0===i&&(i=!0),t?(this.visibleObjects[e.id]=e,f(this,vl)[vl]++):(delete this.visibleObjects[e.id],f(this,vl)[vl]--),f(this,pl)[pl]=null,i&&this.onObjectVisibility.dispatch(this,e)},n.objectXRayedUpdated=function(e,t,i){void 0===i&&(i=!0),t?(this.xrayedObjects[e.id]=e,f(this,yl)[yl]++):(delete this.xrayedObjects[e.id],f(this,yl)[yl]--),f(this,ml)[ml]=null,i&&this.onObjectXRayed.dispatch(this,e)},n.objectHighlightedUpdated=function(e,t){t?(this.highlightedObjects[e.id]=e,f(this,bl)[bl]++):(delete this.highlightedObjects[e.id],f(this,bl)[bl]--),f(this,gl)[gl]=null},n.objectSelectedUpdated=function(e,t){t?(this.selectedObjects[e.id]=e,f(this,wl)[wl]++):(delete this.selectedObjects[e.id],f(this,wl)[wl]--),f(this,Pl)[Pl]=null},n.objectColorizeUpdated=function(e,t){t?(this.colorizedObjects[e.id]=e,f(this,El)[El]++):(delete this.colorizedObjects[e.id],f(this,El)[El]--),f(this,Tl)[Tl]=null},n.objectOpacityUpdated=function(e,t){t?(this.opacityObjects[e.id]=e,f(this,_l)[_l]++):(delete this.opacityObjects[e.id],f(this,_l)[_l]--),f(this,Il)[Il]=null},n.createSectionPlane=function(e){var t=this,i=e.id||or();this.sectionPlanes[i]&&(this.error('SectionPlane with ID "'+i+'" already exists - will randomly-generate ID'),i=or());var r=new Ws(this,e);return f(this,jl)[jl](r),r.onDestroyed.one(function(){f(t,Rl)[Rl](r)}),r},n.clearSectionPlanes=function(){for(var e=Object.keys(this.sectionPlanes),t=0,i=e.length;t<i;t++)this.sectionPlanes[e[t]].destroy();this.sectionPlanesList.length=0,f(this,Ml)[Ml]=null},n.getSectionPlanesHash=function(){if(f(this,Ml)[Ml])return f(this,Ml)[Ml];if(0===this.sectionPlanesList.length)return f(this,Ml)[Ml]=";";for(var e=[],t=0,i=this.sectionPlanesList.length;t<i;t++)e.push("cp");return e.push(";"),f(this,Ml)[Ml]=e.join(""),f(this,Ml)[Ml]},n.registerLight=function(e){this.lightsList.push(e),this.lights[e.id]=e,f(this,Sl)[Sl]=null,this.rebuild()},n.deregisterLight=function(e){for(var t=0,i=this.lightsList.length;t<i;t++)if(this.lightsList[t].id===e.id)return this.lightsList.splice(t,1),f(this,Sl)[Sl]=null,delete this.lights[e.id],void this.rebuild()},n.clearLights=function(){for(var e=Object.keys(this.lights),t=0,i=e.length;t<i;t++)this.lights[e[t]].destroy()},n.getLightsHash=function(){if(f(this,Sl)[Sl])return f(this,Sl)[Sl];if(0===this.lightsList.length)return f(this,Sl)[Sl]=";";for(var e=[],t=this.lightsList,i=0,r=t.length;i<r;i++){var n=t[i];e.push("/"),e.push(n.type),e.push("world"===n.space?"w":"v"),n.castsShadow&&e.push("sh")}return e.push(";"),f(this,Sl)[Sl]=e.join(""),f(this,Sl)[Sl]},n.rebuild=function(){this.viewer.renderer.needsRebuild(this.viewIndex)},n.redraw=function(){this.viewer.renderer.setImageDirty(this.viewIndex)},n.getAmbientColorAndIntensity=function(){return[0,0,0,1]},n.setObjectsVisible=function(e,t){return this.withObjects(e,function(e){var i=e.visible!==t;return e.visible=t,i})},n.setObjectsCollidable=function(e,t){return this.withObjects(e,function(e){var i=e.collidable!==t;return e.collidable=t,i})},n.setObjectsCulled=function(e,t){return this.withObjects(e,function(e){var i=e.culled!==t;return e.culled=t,i})},n.setObjectsSelected=function(e,t){return this.withObjects(e,function(e){var i=e.selected!==t;return e.selected=t,i})},n.setObjectsHighlighted=function(e,t){return this.withObjects(e,function(e){var i=e.highlighted!==t;return e.highlighted=t,i})},n.setObjectsXRayed=function(e,t){return this.withObjects(e,function(e){var i=e.xrayed!==t;return i&&(e.xrayed=t),i})},n.setObjectsColorized=function(e,t){return this.withObjects(e,function(e){e.colorize=t})},n.setObjectsOpacity=function(e,t){return this.withObjects(e,function(e){var i=e.opacity!==t;return i&&(e.opacity=t),i})},n.setObjectsPickable=function(e,t){return this.withObjects(e,function(e){var i=e.pickable!==t;return i&&(e.pickable=t),i})},n.setObjectsClippable=function(e,t){return this.withObjects(e,function(e){var i=e.clippable!==t;return i&&(e.clippable=t),i})},n.withObjects=function(e,t){for(var i=!1,r=0,n=e.length;r<n;r++){var o=this.objects[e[r]];o&&(i=t(o)||i)}return i},n.createLayer=function(e){var t=this,i=this.layers[e.id];return i||(i=new ga({id:e.id,view:this,viewer:this.viewer}),this.layers[e.id]=i,this.onLayerCreated.dispatch(this,i),i.onDestroyed.one(function(){delete t.layers[i.id],t.onLayerDestroyed.dispatch(t,i)})),i.autoDestroy=!1,i},n.destroy=function(){this.viewer.onTick.unsubscribe(f(this,cl)[cl]),e.prototype.destroy.call(this),this.onObjectVisibility.clear(),this.onObjectXRayed.clear(),this.onLayerCreated.clear(),this.onLayerDestroyed.clear(),this.onSectionPlaneCreated.clear(),this.onSectionPlaneDestroyed.clear()},i(t,[{key:"aabb",get:function(){return this.viewer.scene.aabb}},{key:"backgroundColor",get:function(){return f(this,ll)[ll]},set:function(e){e?(f(this,ll)[ll][0]=e[0],f(this,ll)[ll][1]=e[1],f(this,ll)[ll][2]=e[2]):(f(this,ll)[ll][0]=1,f(this,ll)[ll][1]=1,f(this,ll)[ll][2]=1),this.redraw()}},{key:"backgroundColorFromAmbientLight",get:function(){return f(this,hl)[hl]},set:function(e){f(this,hl)[hl]=!1!==e}},{key:"resolutionScale",get:function(){return f(this,ul)[ul]},set:function(e){if((e=e||1)!==f(this,ul)[ul]){f(this,ul)[ul]=e;var t=this.canvasElement;t.width=Math.round(t.clientWidth*f(this,ul)[ul]),t.height=Math.round(t.clientHeight*f(this,ul)[ul]),this.redraw()}}},{key:"gammaFactor",get:function(){return 1}},{key:"qualityRender",get:function(){return f(this,xl)[xl]},set:function(e){f(this,xl)[xl]!==e&&(f(this,xl)[xl]=e,this.redraw())}},{key:"numObjects",get:function(){return f(this,dl)[dl]}},{key:"objectIds",get:function(){return f(this,fl)[fl]||(f(this,fl)[fl]=Object.keys(this.objects)),f(this,fl)[fl]}},{key:"numVisibleObjects",get:function(){return f(this,vl)[vl]}},{key:"visibleObjectIds",get:function(){return f(this,pl)[pl]||(f(this,pl)[pl]=Object.keys(this.visibleObjects)),f(this,pl)[pl]}},{key:"numXRayedObjects",get:function(){return f(this,yl)[yl]}},{key:"xrayedObjectIds",get:function(){return f(this,ml)[ml]||(f(this,ml)[ml]=Object.keys(this.xrayedObjects)),f(this,ml)[ml]}},{key:"numHighlightedObjects",get:function(){return f(this,bl)[bl]}},{key:"highlightedObjectIds",get:function(){return f(this,gl)[gl]||(f(this,gl)[gl]=Object.keys(this.highlightedObjects)),f(this,gl)[gl]}},{key:"numSelectedObjects",get:function(){return f(this,wl)[wl]}},{key:"selectedObjectIds",get:function(){return f(this,Pl)[Pl]||(f(this,Pl)[Pl]=Object.keys(this.selectedObjects)),f(this,Pl)[Pl]}},{key:"numColorizedObjects",get:function(){return f(this,El)[El]}},{key:"colorizedObjectIds",get:function(){return f(this,Tl)[Tl]||(f(this,Tl)[Tl]=Object.keys(this.colorizedObjects)),f(this,Tl)[Tl]}},{key:"opacityObjectIds",get:function(){return f(this,Il)[Il]||(f(this,Il)[Il]=Object.keys(this.opacityObjects)),f(this,Il)[Il]}},{key:"numOpacityObjects",get:function(){return f(this,_l)[_l]}}]),t}(ae);function Cl(e){var t=this,i=e.objects,r=this.viewer.renderer.rendererViewObjects,n=function(){var e=i[o],n=r[o],s="default",a=t.layers[s];if(!a){if(!t.autoLayers)return"continue";a=new ga({id:s,view:t,viewer:t.viewer}),t.layers[s]=a,a.onDestroyed.one(function(){delete t.layers[a.id],t.onLayerDestroyed.dispatch(t,a)}),t.onLayerCreated.dispatch(t,a)}var c=new Hs(a,e,n);a.registerViewObject(c),t.registerViewObject(c)};for(var o in i)n()}function kl(e){this.sectionPlanesList.push(e),this.sectionPlanes[e.id]=e,f(this,Ml)[Ml]=null,this.rebuild(),this.onSectionPlaneCreated.dispatch(this,e)}function Bl(e){for(var t=0,i=this.sectionPlanesList.length;t<i;t++)if(this.sectionPlanesList[t].id===e.id)return this.sectionPlanesList.splice(t,1),f(this,Ml)[Ml]=null,delete this.sectionPlanes[e.id],this.rebuild(),void this.onSectionPlaneDestroyed.dispatch(this,e)}function Ll(e){var t=e.objects;for(var i in t){var r=this.layers.default,n=this.objects[t[i].id];this.deregisterViewObject(n),r&&(r.deregisterViewObject(n),r.autoDestroy&&0===r.numObjects&&r.destroy())}}var Fl=/*#__PURE__*/d("prefixMessageWithID"),Ul=/*#__PURE__*/d("registerView"),Nl=/*#__PURE__*/d("deregisterView"),Vl=/*#__PURE__*/function(e){function t(t){var i;return i=e.call(this,null,{})||this,Object.defineProperty(c(i),Nl,{value:Xl}),Object.defineProperty(c(i),Ul,{value:Hl}),Object.defineProperty(c(i),Fl,{value:Gl}),i.capabilities=void 0,i.onTick=void 0,i.onViewCreated=void 0,i.onViewDestroyed=void 0,i.scene=void 0,i.views=void 0,i.viewList=void 0,i.numViews=void 0,i.startTime=(new Date).getTime(),i.renderer=void 0,i.onTick=new p(new te.EventDispatcher),i.onViewCreated=new p(new te.EventDispatcher),i.onViewDestroyed=new p(new te.EventDispatcher),i.id=t.id||or(),i.viewList=[],i.numViews=0,i.views={},i.destroyed=!1,i.capabilities={maxViews:0,astcSupported:!1,etc1Supported:!1,etc2Supported:!1,dxtSupported:!1,bptcSupported:!1,pvrtcSupported:!1},i.scene=t.scene||new mo,i.renderer=t.renderer,i.renderer.getCapabilities(i.capabilities),i.renderer.attachViewer(c(i)),_c.registerViewer(c(i)),i}r(t,e);var i=t.prototype;return i.createView=function(e){var t=this;if(this.viewList.length>=this.capabilities.maxViews)return new he("Attempted to create too many Views with View.createView() - maximum of "+this.capabilities.maxViews+" is allowed");var i=e.id||or();if(this.views[i])return new he('View with ID "'+i+'" already exists');if(!((e.canvasElement||document.getElementById(e.canvasId))instanceof HTMLCanvasElement))return new he("Mandatory View config expected: valid canvasId or canvasElement");var r=new Al(rr({viewId:i,viewer:this},e));for(var n in f(this,Ul)[Ul](r),r.viewIndex=this.renderer.attachView(r),r.onDestroyed.one(function(){f(t,Nl)[Nl](r),t.renderer.detachView(r.viewIndex),t.onViewDestroyed.dispatch(t,r)}),this.scene.onModelCreated.subscribe(function(e,i){t.renderer.attachSceneModel(i)}),this.scene.onModelDestroyed.subscribe(function(e,i){t.renderer.detachSceneModel(i)}),this.scene.models)this.renderer.attachSceneModel(this.scene.models[n]);return r.initViewObjects(),this.onViewCreated.dispatch(this,r),this.log("View created: "+r.viewId),r},i.redraw=function(){for(var e in this.views)this.views[e].redraw()},i.log=function(e){e="[LOG] "+f(this,Fl)[Fl](e),window.console.log(e)},i.warn=function(e){e="[WARN] "+f(this,Fl)[Fl](e),window.console.warn(e)},i.error=function(e){e="[ERROR] "+f(this,Fl)[Fl](e),window.console.error(e)},i.destroy=function(){if(!this.destroyed){for(var e in _c.deregisterViewer(this),this.views)this.views[e].destroy();this.onTick.clear(),this.onViewCreated.clear(),this.onViewDestroyed.clear()}},i.render=function(e){for(var t=0;t<this.viewList.length;t++)this.renderer.render(t,{force:!0})},t}(ae);function Gl(e){return" ["+this.constructor.name+' "'+nr(this.id)+'"]: '+e}function Hl(e){if(!this.views[e.id]){this.views[e.id]=e;for(var t=0;;t++)if(!this.viewList[t])return this.viewList[t]=e,this.numViews++,void(e.viewIndex=t)}}function Xl(e){this.views[e.id]&&(delete this.views[e.id],delete this.viewList[e.viewIndex],this.numViews--)}var Wl=/*#__PURE__*/d("state"),Yl=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(c(r),Wl,{writable:!0,value:void 0}),r.view=t,f(c(r),Wl)[Wl]={type:"ambient",color:new Float32Array(i.color||[.7,.7,.7]),intensity:null!=i.intensity?i.intensity:1},r.view.registerLight(c(r)),r}return r(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.view.deregisterLight(this)},i(t,[{key:"color",get:function(){return f(this,Wl)[Wl].color},set:function(e){f(this,Wl)[Wl].color.set(e),this.view.redraw()}},{key:"intensity",get:function(){return f(this,Wl)[Wl].intensity},set:function(e){f(this,Wl)[Wl].intensity=void 0!==e?e:1,this.view.redraw()}}]),t}(ae),Kl=/*#__PURE__*/d("state"),zl=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(c(r),Kl,{writable:!0,value:void 0}),r.view=t,f(c(r),Kl)[Kl]={type:"dir",dir:new Float32Array(i.dir||[1,1,1]),color:new Float32Array(i.color||[.7,.7,.8]),intensity:null!=i.intensity?i.intensity:1,space:i.space||"view"},r.view.registerLight(c(r)),r}return r(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.view.deregisterLight(this),this.view.redraw()},i(t,[{key:"dir",get:function(){return f(this,Kl)[Kl].dir},set:function(e){f(this,Kl)[Kl].dir.set(e),this.view.redraw()}},{key:"color",get:function(){return f(this,Kl)[Kl].color},set:function(e){f(this,Kl)[Kl].color.set(e),this.view.redraw()}},{key:"intensity",get:function(){return f(this,Kl)[Kl].intensity},set:function(e){f(this,Kl)[Kl].intensity=e,this.view.redraw()}}]),t}(ae),ql=/*#__PURE__*/d("state"),Zl=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(c(r),ql,{writable:!0,value:void 0}),r.view=t,f(c(r),ql)[ql]={type:"point",pos:new Float64Array(i.pos||[1,1,1]),color:new Float32Array(i.color||[.7,.7,.8]),intensity:1,attenuation:new Float32Array([i.constantAttenuation,i.linearAttenuation,i.quadraticAttenuation]),space:i.space||"view"},r.view.registerLight(c(r)),r}return r(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.view.deregisterLight(this),this.view.redraw()},i(t,[{key:"pos",get:function(){return f(this,ql)[ql].pos},set:function(e){f(this,ql)[ql].pos.set(e||[1,1,1]),this.view.redraw()}},{key:"color",get:function(){return f(this,ql)[ql].color},set:function(e){f(this,ql)[ql].color.set(e||[.7,.7,.8]),this.view.redraw()}},{key:"intensity",get:function(){return f(this,ql)[ql].intensity},set:function(e){e!==f(this,ql)[ql].intensity&&(f(this,ql)[ql].intensity=e,this.view.redraw())}},{key:"constantAttenuation",get:function(){return f(this,ql)[ql].attenuation[0]},set:function(e){f(this,ql)[ql].attenuation[0]=e,this.view.redraw()}},{key:"linearAttenuation",get:function(){return f(this,ql)[ql].attenuation[1]},set:function(e){f(this,ql)[ql].attenuation[1]=e,this.view.redraw()}},{key:"quadraticAttenuation",get:function(){return f(this,ql)[ql].attenuation[2]},set:function(e){f(this,ql)[ql].attenuation[2]=e,this.view.redraw()}}]),t}(ae),Ql=/*#__PURE__*/d("viewObject"),Jl=/*#__PURE__*/d("gotCanvasPos"),$l=/*#__PURE__*/d("gotOrigin"),eh=/*#__PURE__*/d("gotDirection"),th=/*#__PURE__*/d("gotIndices"),ih=/*#__PURE__*/d("gotLocalPos"),rh=/*#__PURE__*/d("gotWorldPos"),nh=/*#__PURE__*/d("gotViewPos"),oh=/*#__PURE__*/d("gotWorldNormal"),sh=/*#__PURE__*/d("gotUV"),ah=/*#__PURE__*/d("canvasPos"),ch=/*#__PURE__*/d("origin"),lh=/*#__PURE__*/d("direction"),hh=/*#__PURE__*/d("indices"),uh=/*#__PURE__*/d("localPos"),dh=/*#__PURE__*/d("worldPos"),fh=/*#__PURE__*/d("viewPos"),vh=/*#__PURE__*/d("worldNormal"),ph=/*#__PURE__*/d("uv"),yh={__proto__:null,Viewer:Vl,Camera:cc,FrustumProjection:Ga,OrthoProjection:Fa,PerspectiveProjection:Aa,CustomProjection:Ya,CameraFlightAnimation:ol,AmbientLight:Yl,DirLight:zl,PointLight:Zl,EmphasisMaterial:_a,EdgeMaterial:xa,PointsMaterial:Ma,Metrics:Zs,View:Al,ViewLayer:ga,ViewObject:Hs,SectionPlane:Ws,SAO:Js,PickResult:/*#__PURE__*/function(){function e(){Object.defineProperty(this,Ql,{writable:!0,value:void 0}),Object.defineProperty(this,Jl,{writable:!0,value:void 0}),Object.defineProperty(this,$l,{writable:!0,value:void 0}),Object.defineProperty(this,eh,{writable:!0,value:void 0}),Object.defineProperty(this,th,{writable:!0,value:void 0}),Object.defineProperty(this,ih,{writable:!0,value:void 0}),Object.defineProperty(this,rh,{writable:!0,value:void 0}),Object.defineProperty(this,nh,{writable:!0,value:void 0}),Object.defineProperty(this,oh,{writable:!0,value:void 0}),Object.defineProperty(this,sh,{writable:!0,value:void 0}),Object.defineProperty(this,ah,{writable:!0,value:void 0}),Object.defineProperty(this,ch,{writable:!0,value:void 0}),Object.defineProperty(this,lh,{writable:!0,value:void 0}),Object.defineProperty(this,hh,{writable:!0,value:void 0}),Object.defineProperty(this,uh,{writable:!0,value:void 0}),Object.defineProperty(this,dh,{writable:!0,value:void 0}),Object.defineProperty(this,fh,{writable:!0,value:void 0}),Object.defineProperty(this,vh,{writable:!0,value:void 0}),Object.defineProperty(this,ph,{writable:!0,value:void 0}),f(this,Ql)[Ql]=null,f(this,ah)[ah]=new Int16Array([0,0]),f(this,ch)[ch]=new Float64Array([0,0,0]),f(this,lh)[lh]=new Float64Array([0,0,0]),f(this,hh)[hh]=new Int32Array(3),f(this,uh)[uh]=new Float64Array([0,0,0]),f(this,dh)[dh]=new Float64Array([0,0,0]),f(this,fh)[fh]=new Float64Array([0,0,0]),f(this,vh)[vh]=new Float64Array([0,0,0]),f(this,ph)[ph]=new Float64Array([0,0]),f(this,$l)[$l]=!1,f(this,eh)[eh]=!1,f(this,th)[th]=!1,f(this,Jl)[Jl]=!1,f(this,ih)[ih]=!1,f(this,rh)[rh]=!1,f(this,nh)[nh]=!1,f(this,oh)[oh]=!1,f(this,sh)[sh]=!1,this.reset()}return e.prototype.reset=function(){f(this,Ql)[Ql]=null,f(this,Jl)[Jl]=!1,f(this,$l)[$l]=!1,f(this,eh)[eh]=!1,f(this,th)[th]=!1,f(this,ih)[ih]=!1,f(this,rh)[rh]=!1,f(this,nh)[nh]=!1,f(this,oh)[oh]=!1,f(this,sh)[sh]=!1},i(e,[{key:"viewObject",get:function(){return f(this,Ql)[Ql]},set:function(e){f(this,Ql)[Ql]=e}},{key:"canvasPos",get:function(){return f(this,Jl)[Jl]?f(this,ah)[ah]:void 0},set:function(e){e?(f(this,ah)[ah][0]=e[0],f(this,ah)[ah][1]=e[1],f(this,Jl)[Jl]=!0):f(this,Jl)[Jl]=!1}},{key:"origin",get:function(){return f(this,$l)[$l]?f(this,ch)[ch]:null},set:function(e){e?(f(this,ch)[ch][0]=e[0],f(this,ch)[ch][1]=e[1],f(this,ch)[ch][2]=e[2],f(this,$l)[$l]=!0):f(this,$l)[$l]=!1}},{key:"direction",get:function(){return f(this,eh)[eh]?f(this,lh)[lh]:null},set:function(e){e?(f(this,lh)[lh][0]=e[0],f(this,lh)[lh][1]=e[1],f(this,lh)[lh][2]=e[2],f(this,eh)[eh]=!0):f(this,eh)[eh]=!1}},{key:"indices",get:function(){return f(this,Ql)[Ql]&&f(this,th)[th]?f(this,hh)[hh]:null},set:function(e){e?(f(this,hh)[hh][0]=e[0],f(this,hh)[hh][1]=e[1],f(this,hh)[hh][2]=e[2],f(this,th)[th]=!0):f(this,th)[th]=!1}},{key:"localPos",get:function(){return f(this,Ql)[Ql]&&f(this,ih)[ih]?f(this,uh)[uh]:null},set:function(e){e?(f(this,uh)[uh][0]=e[0],f(this,uh)[uh][1]=e[1],f(this,uh)[uh][2]=e[2],f(this,ih)[ih]=!0):f(this,ih)[ih]=!1}},{key:"worldPos",get:function(){return f(this,Ql)[Ql]&&f(this,rh)[rh]?f(this,dh)[dh]:null},set:function(e){e?(f(this,dh)[dh][0]=e[0],f(this,dh)[dh][1]=e[1],f(this,dh)[dh][2]=e[2],f(this,rh)[rh]=!0):f(this,rh)[rh]=!1}},{key:"viewPos",get:function(){return f(this,Ql)[Ql]&&f(this,nh)[nh]?f(this,fh)[fh]:null},set:function(e){e?(f(this,fh)[fh][0]=e[0],f(this,fh)[fh][1]=e[1],f(this,fh)[fh][2]=e[2],f(this,nh)[nh]=!0):f(this,nh)[nh]=!1}},{key:"worldNormal",get:function(){return f(this,Ql)[Ql]&&f(this,oh)[oh]?f(this,vh)[vh]:null},set:function(e){e?(f(this,vh)[vh][0]=e[0],f(this,vh)[vh][1]=e[1],f(this,vh)[vh][2]=e[2],f(this,oh)[oh]=!0):f(this,oh)[oh]=!1}},{key:"uv",get:function(){return f(this,Ql)[Ql]&&f(this,sh)[sh]?f(this,ph)[ph]:null},set:function(e){e?(f(this,ph)[ph][0]=e[0],f(this,ph)[ph][1]=e[1],f(this,sh)[sh]=!0):f(this,sh)[sh]=!1}}]),e}()},mh=0,bh={ETC1S:0,UASTC_4x4:1},gh={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},wh={RGBAFormat:be,RGBA_ASTC_4x4_Format:je,RGBA_BPTC_Format:Xe,RGBA_ETC2_EAC_Format:Oe,RGBA_PVRTC_4BPPV1_Format:Ie,RGBA_S3TC_DXT5_Format:Ee,RGB_ETC1_Format:Se,RGB_ETC2_Format:Me,RGB_PVRTC_4BPPV1_Format:Te,RGB_S3TC_DXT1_Format:ge},Ph=/*#__PURE__*/d("transcoderPath"),Eh=/*#__PURE__*/d("transcoderBinary"),Th=/*#__PURE__*/d("transcoderPending"),_h=/*#__PURE__*/d("workerPool"),Ih=/*#__PURE__*/d("workerSourceURL"),xh=/*#__PURE__*/d("workerConfig"),Sh=/*#__PURE__*/d("supportedFileTypes"),Mh=/*#__PURE__*/d("withCredentials"),Oh=/*#__PURE__*/d("initTranscoder"),jh=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,Oh,{value:Rh}),Object.defineProperty(this,Ph,{writable:!0,value:void 0}),Object.defineProperty(this,Eh,{writable:!0,value:void 0}),Object.defineProperty(this,Th,{writable:!0,value:void 0}),Object.defineProperty(this,_h,{writable:!0,value:void 0}),Object.defineProperty(this,Ih,{writable:!0,value:void 0}),Object.defineProperty(this,xh,{writable:!0,value:void 0}),Object.defineProperty(this,Sh,{writable:!0,value:void 0}),Object.defineProperty(this,Mh,{writable:!0,value:void 0}),f(this,Ph)[Ph]=e.transcoderPath||"https://cdn.jsdelivr.net/npm/@xeokit/sdk/dist/basis/",f(this,Eh)[Eh]=null,f(this,Th)[Th]=null,f(this,_h)[_h]=new Ki,f(this,Ih)[Ih]="",e.workerLimit&&f(this,_h)[_h].setWorkerLimit(e.workerLimit),f(this,xh)[xh]=null,f(this,Mh)[Mh]=!1,f(this,Sh)[Sh]=["xkt2"]}var t=e.prototype;return t.init=function(e){f(this,xh)[xh]={astcSupported:e.astcSupported,etc1Supported:e.etc1Supported,etc2Supported:e.etc2Supported,dxtSupported:e.dxtSupported,bptcSupported:e.bptcSupported,pvrtcSupported:e.pvrtcSupported}},t.transcode=function(e,t){var i=this;return void 0===t&&(t={}),new Promise(function(r,n){var o=t;f(i,Oh)[Oh]().then(function(){return f(i,_h)[_h].postMessage({type:"transcode",buffers:e,taskConfig:o},e)}).then(function(e){var t=e.data,i=t.mipmaps,o=t.format,s=t.dfdTransferFn,a=t.dfdFlags;if("error"===t.type)return n(t.error);r({mipmaps:i,props:{format:o,minFilter:1===i.length?ve:ye,magFilter:1===i.length?ve:ye,encoding:2===s?Ye:We,premultiplyAlpha:!!(1&a)}})})})},t.destroy=function(){URL.revokeObjectURL(f(this,Ih)[Ih]),f(this,_h)[_h].destroy(),mh--},e}();function Rh(){var e=this;if(!f(this,Th)[Th]){var t=new Zi;t.setPath(f(this,Ph)[Ph]),t.setWithCredentials(f(this,Mh)[Mh]);var i=t.loadAsync("basis_transcoder.js"),r=new Zi;r.setPath(f(this,Ph)[Ph]),r.setResponseType("arraybuffer"),r.setWithCredentials(f(this,Mh)[Mh]);var n=r.loadAsync("basis_transcoder.wasm");f(this,Th)[Th]=Promise.all([i,n]).then(function(t){var i=t[0],r=t[1],n=Dh.toString(),o=["/* constants */","let _EngineFormat = "+JSON.stringify(wh),"let _TranscoderFormat = "+JSON.stringify(gh),"let _BasisFormat = "+JSON.stringify(bh),"/* basis_transcoder.js */",i,"/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");f(e,Ih)[Ih]=URL.createObjectURL(new Blob([o])),f(e,Eh)[Eh]=r,f(e,_h)[_h].setWorkerCreator(function(){var t=new Worker(f(e,Ih)[Ih]),i=f(e,Eh)[Eh].slice(0);return t.postMessage({type:"init",config:f(e,xh)[xh],transcoderBinary:i},[i]),t})}),mh>0&&console.warn("KTX2TextureTranscoder: Multiple active KTX2TextureTranscoder may cause performance issues. Use a single KTX2TextureTranscoder instance, or call .dispose() on old instances."),mh++}return f(this,Th)[Th]}var Dh=function(){var e,t,i,r=_EngineFormat,n=_TranscoderFormat,o=_BasisFormat;self.addEventListener("message",function(s){var h,u=s.data;switch(u.type){case"init":e=u.config,h=u.transcoderBinary,t=new Promise(function(e){i={wasmBinary:h,onRuntimeInitialized:e},BASIS(i)}).then(function(){i.initializeBasis(),void 0===i.KTX2File&&console.warn("KTX2TextureTranscoder: Please update Basis Universal transcoder.")});break;case"transcode":t.then(function(){try{for(var t=function(t){var s=new i.KTX2File(new Uint8Array(t));function h(){s.close(),s.delete()}if(!s.isValid())throw h(),new Error("KTX2TextureTranscoder: Invalid or unsupported .ktx2 file");var u=s.isUASTC()?o.UASTC_4x4:o.ETC1S,d=s.getWidth(),f=s.getHeight(),v=s.getLevels(),p=s.getHasAlpha(),y=s.getDFDTransferFunc(),m=s.getDFDFlags(),b=function(t,i,s,h){for(var u=t===o.ETC1S?a:c,d=0;d<u.length;d++){var f=u[d];if(e[f.if]&&f.basisFormat.includes(t)&&!(h&&f.transcoderFormat.length<2)&&(!f.needsPowerOfTwo||l(i)&&l(s)))return{transcoderFormat:f.transcoderFormat[h?1:0],engineFormat:f.engineFormat[h?1:0]}}return console.warn("KTX2TextureTranscoder: No suitable compressed texture format found. Decoding to RGBA32."),{transcoderFormat:n.RGBA32,engineFormat:r.RGBAFormat}}(u,d,f,p),g=b.transcoderFormat,w=b.engineFormat;if(!d||!f||!v)throw h(),new Error("KTX2TextureTranscoder: Invalid texture");if(!s.startTranscoding())throw h(),new Error("KTX2TextureTranscoder: .startTranscoding failed");for(var P=[],E=0;E<v;E++){var T=s.getImageLevelInfo(E,0,0),_=T.origWidth,I=T.origHeight,x=new Uint8Array(s.getImageTranscodedSizeInBytes(E,0,0,g));if(!s.transcodeImage(x,E,0,0,g,0,-1,-1))throw h(),new Error("KTX2TextureTranscoder: .transcodeImage failed.");P.push({data:x,width:_,height:I})}return h(),{width:d,height:f,hasAlpha:p,mipmaps:P,format:w,dfdTransferFn:y,dfdFlags:m}}(u.buffers[0]),s=t.width,h=t.height,d=t.hasAlpha,f=t.mipmaps,v=t.format,p=t.dfdTransferFn,y=t.dfdFlags,m=[],b=0;b<f.length;++b)m.push(f[b].data.buffer);self.postMessage({type:"transcode",id:u.id,width:s,height:h,hasAlpha:d,mipmaps:f,format:v,dfdTransferFn:p,dfdFlags:y},m)}catch(e){console.error("[BasisWorker]: "+e),self.postMessage({type:"error",id:u.id,error:e.message})}})}});var s=[{if:"astcSupported",basisFormat:[o.UASTC_4x4],transcoderFormat:[n.ASTC_4x4,n.ASTC_4x4],engineFormat:[r.RGBA_ASTC_4x4_Format,r.RGBA_ASTC_4x4_Format],priorityETC1S:Infinity,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[n.BC7_M5,n.BC7_M5],engineFormat:[r.RGBA_BPTC_Format,r.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[n.BC1,n.BC3],engineFormat:[r.RGB_S3TC_DXT1_Format,r.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[n.ETC1,n.ETC2],engineFormat:[r.RGB_ETC2_Format,r.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[n.ETC1],engineFormat:[r.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[n.PVRTC1_4_RGB,n.PVRTC1_4_RGBA],engineFormat:[r.RGB_PVRTC_4BPPV1_Format,r.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],a=s.sort(function(e,t){return e.priorityETC1S-t.priorityETC1S}),c=s.sort(function(e,t){return e.priorityUASTC-t.priorityUASTC});function l(e){return e<=2||0==(e&e-1)&&0!==e}},Ah={__proto__:null,KTX2TextureTranscoder:jh},Ch=/*#__PURE__*/function(){function e(e,t){this.gl=void 0,this.location=void 0,this.gl=e,this.location=t}return e.prototype.bindArrayBuffer=function(e){e&&(e.bind(),this.gl.enableVertexAttribArray(this.location),this.gl.vertexAttribPointer(this.location,e.itemSize,e.itemType,e.normalized,e.stride,e.offset))},e}(),kh=/*#__PURE__*/d("onDestroyed"),Bh=/*#__PURE__*/function(){function e(e){void 0===e&&(e={}),this.gl=void 0,this.texture=void 0,this.textureWidth=void 0,this.textureHeight=void 0,this.textureData=void 0,Object.defineProperty(this,kh,{writable:!0,value:void 0}),this.gl=e.gl,this.texture=e.texture,this.textureWidth=e.textureWidth,this.textureHeight=e.textureHeight,this.textureData=e.textureData,f(this,kh)[kh]=e.onDestroyed}var t=e.prototype;return t.bindTexture=function(e,t,i){this.gl&&t.bindTexture(this,i)},t.bind=function(e){return!(!this.gl||!this.texture||(this.gl.activeTexture(this.gl["TEXTURE"+e]),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),0))},t.disableFiltering=function(){this.gl&&(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE))},t.unbind=function(e){},t.destroy=function(){this.gl&&this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null,f(this,kh)[kh]&&f(this,kh)[kh]())},e}(),Lh=/*#__PURE__*/function(){function e(e,t,i){if(this.errors=void 0,this.allocated=void 0,this.compiled=void 0,this.handle=void 0,this.allocated=!1,this.compiled=!1,this.handle=e.createShader(t),this.handle){if(this.allocated=!0,e.shaderSource(this.handle,i),e.compileShader(this.handle),this.compiled=e.getShaderParameter(this.handle,e.COMPILE_STATUS),!this.compiled&&!e.isContextLost()){for(var r=i.split("\n"),n=[],o=0;o<r.length;o++)n.push(o+1+": "+r[o]+"\n");this.errors=[],this.errors.push(""),this.errors.push(e.getShaderInfoLog(this.handle)||""),this.errors=this.errors.concat(n.join(""))}}else this.errors=["Failed to allocate"]}return e.prototype.destroy=function(){},e}(),Fh=/*#__PURE__*/function(){function e(e,t){this.location=void 0,this.gl=void 0,this.gl=e,this.location=t}return e.prototype.bindTexture=function(e,t){return!!e.bind(t)&&(this.gl.uniform1i(this.location,t),!0)},e}(),Uh=new Gi({},""),Nh=/*#__PURE__*/function(){function e(e,t){if(this.id=void 0,this.vertexShader=void 0,this.fragmentShader=void 0,this.attributes=void 0,this.samplers=void 0,this.uniforms=void 0,this.errors=void 0,this.validated=void 0,this.linked=void 0,this.compiled=void 0,this.allocated=void 0,this.gl=void 0,this.source=void 0,this.handle=void 0,this.id=Uh.addItem({}),this.source=t,this.gl=e,this.allocated=!1,this.compiled=!1,this.linked=!1,this.validated=!1,this.errors=[],this.uniforms={},this.samplers={},this.attributes={},this.vertexShader=new Lh(e,e.VERTEX_SHADER,this.source.vertex),this.fragmentShader=new Lh(e,e.FRAGMENT_SHADER,this.source.fragment),!this.vertexShader.allocated)return this.errors=["Vertex shader failed to allocate"].concat(this.vertexShader.errors),void Vh(this.errors);if(!this.fragmentShader.allocated)return this.errors=["Fragment shader failed to allocate"].concat(this.fragmentShader.errors),void Vh(this.errors);if(this.allocated=!0,!this.vertexShader.compiled)return this.errors=["Vertex shader failed to compile"].concat(this.vertexShader.errors),void Vh(this.errors);if(!this.fragmentShader.compiled)return this.errors=["Fragment shader failed to compile"].concat(this.fragmentShader.errors),void Vh(this.errors);if(this.compiled=!0,this.handle=e.createProgram(),this.handle){if(e.attachShader(this.handle,this.vertexShader.handle),e.attachShader(this.handle,this.fragmentShader.handle),e.linkProgram(this.handle),this.linked=e.getProgramParameter(this.handle,e.LINK_STATUS),this.validated=!0,!this.linked||!this.validated)return this.errors=[],this.errors.push(""),this.errors.push(e.getProgramInfoLog(this.handle)),this.errors.push("\nVertex shader:\n"),this.errors=this.errors.concat(this.source.vertex),this.errors.push("\nFragment shader:\n"),this.errors=this.errors.concat(this.source.fragment),void Vh(this.errors);for(var i=e.getProgramParameter(this.handle,e.ACTIVE_UNIFORMS),r=0;r<i;++r){var n=e.getActiveUniform(this.handle,r);if(n){var o=n.name;"\0"===o[o.length-1]&&(o=o.substr(0,o.length-1));var s=e.getUniformLocation(this.handle,o);n.type===e.SAMPLER_2D||n.type===e.SAMPLER_CUBE||35682===n.type?this.samplers[o]=new Fh(e,s):this.uniforms[o]=s}}for(var a=e.getProgramParameter(this.handle,e.ACTIVE_ATTRIBUTES),c=0;c<a;c++){var l=e.getActiveAttrib(this.handle,c);if(l){var h=e.getAttribLocation(this.handle,l.name);this.attributes[l.name]=new Ch(e,h)}}this.allocated=!0}else this.errors=["Failed to allocate program"]}var t=e.prototype;return t.bind=function(){this.allocated&&this.gl.useProgram(this.handle)},t.getLocation=function(e){return this.uniforms[e]},t.getAttribute=function(e){return this.attributes[e]},t.getSampler=function(e){return this.samplers[e]},t.bindTexture=function(e,t,i){if(!this.allocated)return!1;var r=this.samplers[e];return!!r&&r.bindTexture(t,i)},t.destroy=function(){this.allocated&&(Uh.removeItem(this.id),this.gl.deleteProgram(this.handle),this.gl.deleteShader(this.vertexShader.handle),this.gl.deleteShader(this.fragmentShader.handle),this.attributes={},this.uniforms={},this.samplers={},this.allocated=!1)},e}();function Vh(e){console.error(e.join("\n"))}function Gh(e,t){if(void 0===e._cachedExtensions&&(e._cachedExtensions={}),void 0!==e._cachedExtensions[t])return e._cachedExtensions[t];var i;switch(t){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(t)}return e._cachedExtensions[t]=i,i}function Hh(e,t,i){var r,n=t;if(n===me)return e.UNSIGNED_BYTE;if(1017===n)return e.UNSIGNED_SHORT_4_4_4_4;if(1018===n)return e.UNSIGNED_SHORT_5_5_5_1;if(1010===n)return e.BYTE;if(1011===n)return e.SHORT;if(1012===n)return e.UNSIGNED_SHORT;if(1013===n)return e.INT;if(1014===n)return e.UNSIGNED_INT;if(1015===n)return e.FLOAT;if(1016===n)return e.HALF_FLOAT;if(1021===n)return e.ALPHA;if(n===be)return e.RGBA;if(1024===n)return e.LUMINANCE;if(1025===n)return e.LUMINANCE_ALPHA;if(1026===n)return e.DEPTH_COMPONENT;if(1027===n)return e.DEPTH_STENCIL;if(1028===n)return e.RED;if(1022===n)return e.RGBA;if(1029===n)return e.RED_INTEGER;if(1030===n)return e.RG;if(1031===n)return e.RG_INTEGER;if(1033===n)return e.RGBA_INTEGER;if(n===ge||n===we||n===Pe||n===Ee)if(i===Ye){var o=Gh(e,"WEBGL_compressed_texture_s3tc_srgb");if(null===o)return null;if(n===ge)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===we)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Pe)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===Ee)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(r=Gh(e,"WEBGL_compressed_texture_s3tc")))return null;if(n===ge)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===we)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Pe)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Ee)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===Te||n===_e||n===Ie||n===xe){var s=Gh(e,"WEBGL_compressed_texture_pvrtc");if(null===s)return null;if(n===Te)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===_e)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===Ie)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===xe)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===Se){var a=Gh(e,"WEBGL_compressed_texture_etc1");return null!==a?a.COMPRESSED_RGB_ETC1_WEBGL:null}if(n===Me||n===Oe){var c=Gh(e,"WEBGL_compressed_texture_etc");if(null===c)return null;if(n===Me)return i===Ye?c.COMPRESSED_SRGB8_ETC2:c.COMPRESSED_RGB8_ETC2;if(n===Oe)return i===Ye?c.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:c.COMPRESSED_RGBA8_ETC2_EAC}if(n===je||n===Re||n===De||n===Ae||n===Ce||n===ke||n===Be||n===Le||n===Fe||n===Ue||n===Ne||n===Ve||n===Ge||n===He){var l=Gh(e,"WEBGL_compressed_texture_astc");if(null===l)return null;if(n===je)return i===Ye?l.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:l.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===Re)return i===Ye?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:l.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===De)return i===Ye?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:l.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===Ae)return i===Ye?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:l.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===Ce)return i===Ye?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:l.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===ke)return i===Ye?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:l.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===Be)return i===Ye?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:l.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===Le)return i===Ye?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:l.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===Fe)return i===Ye?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:l.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===Ue)return i===Ye?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:l.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===Ne)return i===Ye?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:l.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===Ve)return i===Ye?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:l.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===Ge)return i===Ye?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:l.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===He)return i===Ye?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:l.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===Xe){var h=Gh(e,"EXT_texture_compression_bptc");if(null===h)return null;if(n===Xe)return i===Ye?h.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:h.COMPRESSED_RGBA_BPTC_UNORM_EXT}return 1020===n?e.UNSIGNED_INT_24_8:n===de?e.REPEAT:1001===n?e.CLAMP_TO_EDGE:1004===n||1005===n?e.NEAREST_MIPMAP_LINEAR:n===pe?e.LINEAR_MIPMAP_NEAREST:1008===n?e.LINEAR_MIPMAP_LINEAR:n===fe?e.NEAREST:n===ve?e.LINEAR:null}!function(){var e=document.createElement("canvas");if(!e.getContext)return{saveAsBMP:function(){},saveAsPNG:function(){},saveAsJPEG:function(){}};e.getContext("2d"),window}();var Xh=new Uint8Array([0,0,0,1]),Wh=/*#__PURE__*/function(){function e(e){this.gl=void 0,this.target=void 0,this.format=void 0,this.type=void 0,this.internalFormat=void 0,this.premultiplyAlpha=void 0,this.flipY=void 0,this.unpackAlignment=void 0,this.wrapS=void 0,this.wrapT=void 0,this.wrapR=void 0,this.texture=void 0,this.allocated=void 0,this.minFilter=void 0,this.magFilter=void 0,this.encoding=void 0,this.gl=e.gl,this.target=e.target||e.gl.TEXTURE_2D,this.format=e.format||be,this.type=e.type||me,this.internalFormat=-1,this.premultiplyAlpha=!!e.premultiplyAlpha,this.flipY=!!e.flipY,this.unpackAlignment=4,this.wrapS=e.wrapS||de,this.wrapT=e.wrapT||de,this.wrapR=e.wrapR||de,this.texture=e.gl.createTexture(),e.preloadColor&&this.setPreloadColor(e.preloadColor),this.allocated=!0}var t=e.prototype;return t.setPreloadColor=function(e){e?(Xh[0]=Math.floor(255*e[0]),Xh[1]=Math.floor(255*e[1]),Xh[2]=Math.floor(255*e[2]),Xh[3]=Math.floor(255*(void 0!==e[3]?e[3]:1))):(Xh[0]=0,Xh[1]=0,Xh[2]=0,Xh[3]=255);var t=this.gl;if(t.bindTexture(this.target,this.texture),this.target===t.TEXTURE_CUBE_MAP)for(var i=[t.TEXTURE_CUBE_MAP_POSITIVE_X,t.TEXTURE_CUBE_MAP_NEGATIVE_X,t.TEXTURE_CUBE_MAP_POSITIVE_Y,t.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.TEXTURE_CUBE_MAP_POSITIVE_Z,t.TEXTURE_CUBE_MAP_NEGATIVE_Z],r=0,n=i.length;r<n;r++)t.texImage2D(i[r],0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,Xh);else t.texImage2D(this.target,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,Xh);t.bindTexture(this.target,null)},t.setTarget=function(e){this.target=e||this.gl.TEXTURE_2D},t.setImage=function(e,t){void 0===t&&(t={});var i=this.gl;void 0!==t.format&&(this.format=t.format),void 0!==t.internalFormat&&(this.internalFormat=t.internalFormat),void 0!==t.encoding&&(this.encoding=t.encoding),void 0!==t.type&&(this.type=t.type),void 0!==t.flipY&&(this.flipY=t.flipY),void 0!==t.premultiplyAlpha&&(this.premultiplyAlpha=t.premultiplyAlpha),void 0!==t.unpackAlignment&&(this.unpackAlignment=t.unpackAlignment),void 0!==t.minFilter&&(this.minFilter=t.minFilter),void 0!==t.magFilter&&(this.magFilter=t.magFilter),void 0!==t.wrapS&&(this.wrapS=t.wrapS),void 0!==t.wrapT&&(this.wrapT=t.wrapT),void 0!==t.wrapR&&(this.wrapR=t.wrapR),i.bindTexture(this.target,this.texture),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,this.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,this.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,i.NONE);var r=Hh(i,this.minFilter);i.texParameteri(this.target,i.TEXTURE_MIN_FILTER,r);var n=Hh(i,this.magFilter);n&&i.texParameteri(this.target,i.TEXTURE_MAG_FILTER,n);var o=Hh(i,this.wrapS);o&&i.texParameteri(this.target,i.TEXTURE_WRAP_S,o);var s=Hh(i,this.wrapT);s&&i.texParameteri(this.target,i.TEXTURE_WRAP_T,s);var a=Hh(i,this.format,this.encoding),c=Hh(i,this.type),l=Yh(i,this.internalFormat,a,c,this.encoding,!1);if(this.target===i.TEXTURE_CUBE_MAP){if(er(e))for(var h=e,u=[i.TEXTURE_CUBE_MAP_POSITIVE_X,i.TEXTURE_CUBE_MAP_NEGATIVE_X,i.TEXTURE_CUBE_MAP_POSITIVE_Y,i.TEXTURE_CUBE_MAP_NEGATIVE_Y,i.TEXTURE_CUBE_MAP_POSITIVE_Z,i.TEXTURE_CUBE_MAP_NEGATIVE_Z],d=0,f=u.length;d<f;d++)i.texImage2D(u[d],0,l,a,c,h[d])}else i.texImage2D(i.TEXTURE_2D,0,l,a,c,e);i.bindTexture(this.target,null)},t.setCompressedData=function(e){var t=this.gl,i=e.mipmaps||[],r=i.length,n=e.props;void 0!==n.format&&(this.format=n.format),void 0!==n.internalFormat&&(this.internalFormat=n.internalFormat),void 0!==n.encoding&&(this.encoding=n.encoding),void 0!==n.type&&(this.type=n.type),void 0!==n.flipY&&(this.flipY=n.flipY),void 0!==n.premultiplyAlpha&&(this.premultiplyAlpha=n.premultiplyAlpha),void 0!==n.unpackAlignment&&(this.unpackAlignment=n.unpackAlignment),void 0!==n.minFilter&&(this.minFilter=n.minFilter),void 0!==n.magFilter&&(this.magFilter=n.magFilter),void 0!==n.wrapS&&(this.wrapS=n.wrapS),void 0!==n.wrapT&&(this.wrapT=n.wrapT),void 0!==n.wrapR&&(this.wrapR=n.wrapR),t.activeTexture(t.TEXTURE0+0),t.bindTexture(this.target,this.texture);var o=i.length>1;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,this.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,this.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE);var s=Hh(t,this.wrapS);s&&t.texParameteri(this.target,t.TEXTURE_WRAP_S,s);var a=Hh(t,this.wrapT);if(a&&t.texParameteri(this.target,t.TEXTURE_WRAP_T,a),this.type===t.TEXTURE_3D||this.type===t.TEXTURE_2D_ARRAY){var c=Hh(t,this.wrapR);c&&t.texParameteri(this.target,t.TEXTURE_WRAP_R,c),t.texParameteri(this.type,t.TEXTURE_WRAP_R,c)}o?(t.texParameteri(this.target,t.TEXTURE_MIN_FILTER,Kh(t,this.minFilter)),t.texParameteri(this.target,t.TEXTURE_MAG_FILTER,Kh(t,this.magFilter))):(t.texParameteri(this.target,t.TEXTURE_MIN_FILTER,Hh(t,this.minFilter)),t.texParameteri(this.target,t.TEXTURE_MAG_FILTER,Hh(t,this.magFilter)));var l=Hh(t,this.format,this.encoding),h=Hh(t,this.type),u=Yh(t,this.internalFormat,l,h,this.encoding,!1);t.texStorage2D(t.TEXTURE_2D,r,u,i[0].width,i[0].height);for(var d=0,f=i.length;d<f;d++){var v=i[d];this.format!==be?null!==l?t.compressedTexSubImage2D(t.TEXTURE_2D,d,0,0,v.width,v.height,l,v.data):console.warn("Attempt to load unsupported compressed texture format in .setCompressedData()"):t.texSubImage2D(t.TEXTURE_2D,d,0,0,v.width,v.height,l,h,v.data)}t.bindTexture(this.target,null)},t.setProps=function(e){var t=this.gl;t.bindTexture(this.target,this.texture),this._uploadProps(e),t.bindTexture(this.target,null)},t._uploadProps=function(e){var t=this.gl;if(void 0!==e.format&&(this.format=e.format),void 0!==e.internalFormat&&(this.internalFormat=e.internalFormat),void 0!==e.encoding&&(this.encoding=e.encoding),void 0!==e.type&&(this.type=e.type),void 0!==e.minFilter){var i=Hh(t,e.minFilter);i&&(this.minFilter=e.minFilter,t.texParameteri(this.target,t.TEXTURE_MIN_FILTER,i),i!==t.NEAREST_MIPMAP_NEAREST&&i!==t.LINEAR_MIPMAP_NEAREST&&i!==t.NEAREST_MIPMAP_LINEAR&&i!==t.LINEAR_MIPMAP_LINEAR||t.generateMipmap(this.target))}if(void 0!==e.magFilter){var r=Hh(t,e.magFilter);r&&(this.magFilter=e.magFilter,t.texParameteri(this.target,t.TEXTURE_MAG_FILTER,r))}if(void 0!==e.wrapS){var n=Hh(t,e.wrapS);n&&(this.wrapS=e.wrapS,t.texParameteri(this.target,t.TEXTURE_WRAP_S,n))}if(void 0!==e.wrapT){var o=Hh(t,e.wrapT);o&&(this.wrapT=e.wrapT,t.texParameteri(this.target,t.TEXTURE_WRAP_T,o))}},t.bind=function(e){if(!this.allocated)return!1;if(this.texture){var t=this.gl;return t.activeTexture(t["TEXTURE"+e]),t.bindTexture(this.target,this.texture),!0}return!1},t.unbind=function(e){if(this.allocated&&this.texture){var t=this.gl;t.activeTexture(t["TEXTURE"+e]),t.bindTexture(this.target,null)}},t.destroy=function(){this.allocated&&this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null)},e}();function Yh(e,t,i,r,n,o){if(void 0===o&&(o=!1),null!==t){if(void 0!==e[t])return e[t];console.warn("Attempt to use non-existing WebGL internal format '"+t+"'")}var s=i;return i===e.RED&&(r===e.FLOAT&&(s=e.R32F),r===e.HALF_FLOAT&&(s=e.R16F),r===e.UNSIGNED_BYTE&&(s=e.R8)),i===e.RG&&(r===e.FLOAT&&(s=e.RG32F),r===e.HALF_FLOAT&&(s=e.RG16F),r===e.UNSIGNED_BYTE&&(s=e.RG8)),i===e.RGBA&&(r===e.FLOAT&&(s=e.RGBA32F),r===e.HALF_FLOAT&&(s=e.RGBA16F),r===e.UNSIGNED_BYTE&&(s=n===Ye&&!1===o?e.SRGB8_ALPHA8:e.RGBA8),r===e.UNSIGNED_SHORT_4_4_4_4&&(s=e.RGBA4),r===e.UNSIGNED_SHORT_5_5_5_1&&(s=e.RGB5_A1)),s!==e.R16F&&s!==e.R32F&&s!==e.RG16F&&s!==e.RG32F&&s!==e.RGBA16F&&s!==e.RGBA32F||Gh(e,"EXT_color_buffer_float"),s}function Kh(e,t){return t===fe||1004===t||1005===t?e.NEAREST:e.LINEAR}var zh={WEBGL:!1,SUPPORTED_EXTENSIONS:{}},qh=document.createElement("canvas");if(qh){var Zh=qh.getContext("webgl2",{antialias:!0});zh.WEBGL=!!Zh,zh.WEBGL&&(zh.ANTIALIAS=Zh.getContextAttributes().antialias,zh.FS_MAX_FLOAT_PRECISION=Zh.getShaderPrecisionFormat?Zh.getShaderPrecisionFormat(Zh.FRAGMENT_SHADER,Zh.HIGH_FLOAT).precision>0?"highp":Zh.getShaderPrecisionFormat(Zh.FRAGMENT_SHADER,Zh.MEDIUM_FLOAT).precision>0?"mediump":"lowp":"mediump",zh.DEPTH_BUFFER_BITS=Zh.getParameter(Zh.DEPTH_BITS),zh.MAX_TEXTURE_SIZE=Zh.getParameter(Zh.MAX_TEXTURE_SIZE),zh.MAX_CUBE_MAP_SIZE=Zh.getParameter(Zh.MAX_CUBE_MAP_TEXTURE_SIZE),zh.MAX_RENDERBUFFER_SIZE=Zh.getParameter(Zh.MAX_RENDERBUFFER_SIZE),zh.MAX_TEXTURE_UNITS=Zh.getParameter(Zh.MAX_COMBINED_TEXTURE_IMAGE_UNITS),zh.MAX_TEXTURE_IMAGE_UNITS=Zh.getParameter(Zh.MAX_TEXTURE_IMAGE_UNITS),zh.MAX_VERTEX_ATTRIBS=Zh.getParameter(Zh.MAX_VERTEX_ATTRIBS),zh.MAX_VERTEX_UNIFORM_VECTORS=Zh.getParameter(Zh.MAX_VERTEX_UNIFORM_VECTORS),zh.MAX_FRAGMENT_UNIFORM_VECTORS=Zh.getParameter(Zh.MAX_FRAGMENT_UNIFORM_VECTORS),zh.MAX_VARYING_VECTORS=Zh.getParameter(Zh.MAX_VARYING_VECTORS),Zh.getSupportedExtensions().forEach(function(e){zh.SUPPORTED_EXTENSIONS[e]=!0}),zh.depthTexturesSupported=zh.SUPPORTED_EXTENSIONS.WEBGL_depth_texture)}var Qh=/*#__PURE__*/function(){function e(e,t,i){this.viewer=void 0,this.view=void 0,this.gl=void 0,this.viewMatrixDataTexture=void 0,this.pbrEnabled=void 0,this.withSAO=void 0,this.backfaces=void 0,this.frontface=void 0,this.textureUnit=void 0,this.bindTexture=void 0,this.renderPass=void 0,this.shadowViewMatrix=void 0,this.shadowProjMatrix=void 0,this.pickViewMatrix=void 0,this.pickProjMatrix=void 0,this.pickZNear=void 0,this.pickZFar=void 0,this.pickInvisible=void 0,this.lineWidth=void 0,this.lastProgramId=void 0,this.occlusionTexture=void 0,this.viewer=e,this.view=t,this.gl=i,this.reset()}return e.prototype.reset=function(){this.lastProgramId=-1,this.pbrEnabled=!1,this.withSAO=!1,this.backfaces=!1,this.frontface=!0,this.textureUnit=0,this.shadowViewMatrix=null,this.shadowProjMatrix=null,this.pickViewMatrix=null,this.pickProjMatrix=null,this.pickZNear=.01,this.pickZFar=5e3,this.pickInvisible=!1,this.lineWidth=1,this.occlusionTexture=null},i(e,[{key:"nextTextureUnit",get:function(){var e=this.textureUnit;return this.textureUnit=(this.textureUnit+1)%zh.MAX_TEXTURE_UNITS,e}}]),e}(),Jh={NOT_RENDERED:0,COLOR_OPAQUE:1,COLOR_TRANSPARENT:2,SILHOUETTE_HIGHLIGHTED:3,SILHOUETTE_SELECTED:4,SILHOUETTE_XRAYED:5,EDGES_COLOR_OPAQUE:6,EDGES_COLOR_TRANSPARENT:7,EDGES_HIGHLIGHTED:8,EDGES_SELECTED:9,EDGES_XRAYED:10,PICK:11},$h=Pt(),eu=/*#__PURE__*/d("hash"),tu=/*#__PURE__*/d("program"),iu=/*#__PURE__*/d("needRebuild"),ru=/*#__PURE__*/d("uniforms"),nu=/*#__PURE__*/d("samplers"),ou=/*#__PURE__*/d("build"),su=/*#__PURE__*/d("buildShader"),au=/*#__PURE__*/d("getValid"),cu=/*#__PURE__*/d("bind"),lu=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,cu,{value:fu}),Object.defineProperty(this,au,{value:du}),Object.defineProperty(this,su,{value:uu}),Object.defineProperty(this,ou,{value:hu}),this.errors=void 0,this.renderContext=void 0,Object.defineProperty(this,eu,{writable:!0,value:void 0}),Object.defineProperty(this,tu,{writable:!0,value:void 0}),Object.defineProperty(this,iu,{writable:!0,value:void 0}),Object.defineProperty(this,ru,{writable:!0,value:void 0}),Object.defineProperty(this,nu,{writable:!0,value:void 0}),this.renderContext=e,f(this,iu)[iu]=!0,f(this,ou)[ou]()}var t=e.prototype;return t.needRebuild=function(){f(this,iu)[iu]=!0},t.draw=function(e){if(f(this,tu)[tu]&&!f(this,au)[au]()&&(f(this,tu)[tu].destroy(),f(this,tu)[tu]=null),!f(this,tu)[tu]){if(f(this,ou)[ou](),this.errors)return;this.renderContext.lastProgramId=-1}var t=e.renderState,i=f(this,tu)[tu],r=this.renderContext,n=r.renderPass,o=this.renderContext.gl,s=this.renderContext.view,a=f(this,ru)[ru],c=f(this,nu)[nu];if(r.lastProgramId!==i.id&&(r.lastProgramId=i.id,f(this,cu)[cu]()),a.renderPass&&o.uniform1i(a.renderPass,n),a.projMatrix&&o.uniformMatrix4fv(a.projMatrix,!1,s.camera.projMatrix),a.worldMatrix&&o.uniformMatrix4fv(a.worldMatrix,!1,e.rendererModel.worldMatrix),a.color)if(n===Jh.SILHOUETTE_XRAYED){var l=s.xrayMaterial,h=l.fillColor;o.uniform4f(a.color,h[0],h[1],h[2],l.fillAlpha)}else if(n===Jh.SILHOUETTE_HIGHLIGHTED){var u=s.highlightMaterial,d=u.fillColor;o.uniform4f(a.color,d[0],d[1],d[2],u.fillAlpha)}else if(n===Jh.SILHOUETTE_SELECTED){var v=s.selectedMaterial,p=v.fillColor;o.uniform4f(a.color,p[0],p[1],p[2],v.fillAlpha)}else o.uniform4fv(a.color,new Float32Array([1,1,1]));c.viewMatrices&&t.dataTextureSet.viewMatrices.bindTexture(i,c.viewMatrices,r.nextTextureUnit),c.positions&&t.dataTextureSet.positions.bindTexture(i,c.positions,r.nextTextureUnit),c.eachMeshMatrices&&t.dataTextureSet.eachMeshMatrices.bindTexture(i,c.eachMeshMatrices,r.nextTextureUnit),c.eachMeshAttributes&&t.dataTextureSet.eachMeshAttributes.bindTexture(i,c.eachMeshAttributes,r.nextTextureUnit),c.eachPrimitiveMesh&&(t.numIndices8Bits>0&&(t.dataTextureSet.eachPrimitiveMesh_8Bits.bindTexture(i,c.eachPrimitiveMesh,r.nextTextureUnit),t.dataTextureSet.indices_8Bits.bindTexture(i,c.indices,r.nextTextureUnit),o.drawArrays(o.TRIANGLES,0,t.numIndices8Bits)),t.numIndices16Bits>0&&(t.dataTextureSet.eachPrimitiveMesh_16Bits.bindTexture(i,c.eachPrimitiveMesh,r.nextTextureUnit),t.dataTextureSet.indices_16Bits.bindTexture(i,c.indices,r.nextTextureUnit),o.drawArrays(o.TRIANGLES,0,t.numIndices16Bits)),t.numIndices32Bits>0&&(t.dataTextureSet.eachPrimitiveMesh_32Bits.bindTexture(i,c.eachPrimitiveMesh,r.nextTextureUnit),t.dataTextureSet.indices_32Bits.bindTexture(i,c.indices,r.nextTextureUnit),o.drawArrays(o.TRIANGLES,0,t.numIndices32Bits))),c.baseColorMap&&c.baseColorMap.bindTexture(t.materialTextureSet.colorTexture.texture2D,r.nextTextureUnit),c.metallicRoughMap&&c.metallicRoughMap.bindTexture(t.materialTextureSet.metallicRoughnessTexture.texture2D,r.nextTextureUnit),c.emissiveMap&&c.emissiveMap.bindTexture(t.materialTextureSet.emissiveTexture.texture2D,r.nextTextureUnit),c.occlusionMap&&c.occlusionMap.bindTexture(t.materialTextureSet.occlusionTexture.texture2D,r.nextTextureUnit)},t.destroy=function(){f(this,tu)[tu]&&f(this,tu)[tu].destroy(),f(this,tu)[tu]=null},i(e,[{key:"vertHeader",get:function(){return"#version 300 es\n                #ifdef GL_FRAGMENT_PRECISION_HIGH\n                precision highp float;\n                precision highp int;\n                precision highp usampler2D;\n                precision highp isampler2D;\n                precision highp sampler2D;\n                #else\n                precision mediump float;\n                precision mediump int;\n                precision mediump usampler2D;\n                precision mediump isampler2D;\n                precision mediump sampler2D;\n                uniform int renderPass;\n                #endif"}},{key:"vertDataTextureDefs",get:function(){return"uniform mediump sampler2D eachMeshMatrices;\n                uniform lowp usampler2D eachMeshAttributes;\n                uniform highp sampler2D eachMeshOffset;\n                uniform mediump usampler2D positions;\n                uniform highp usampler2D indices;\n                uniform mediump usampler2D eachPrimitiveMesh;\n                uniform highp sampler2D cameraMatrices;\n                uniform highp sampler2D sceneModelRendererMatrices;"}},{key:"vertLogDepthBufDefs",get:function(){return this.renderContext.view.logarithmicDepthBufferEnabled?"uniform float logDepthBufFC;\n                    out float fragDepth;\n                    bool isPerspectiveMatrix(mat4 m) {\n                        return (m[2][3] == - 1.0);\n                    }\n                    out float isPerspective;":""}},{key:"vertDataTextureSamples",get:function(){return""}},{key:"vertLogDepthBufOutputs",get:function(){return this.renderContext.view.logarithmicDepthBufferEnabled?"fragDepth = 1.0 + clipPos.w;\n                    isPerspective = float (isPerspectiveMatrix(projMatrix));":""}},{key:"fragmentShader",get:function(){return this.fragHeader+"\n        "+this.fragGammaDefs+"\n        "+this.fragSectionPlaneDefs+"\n        "+this.fragLightDefs+"\n        "+this.fragLogDepthBufDefs+"\n        void main(void) {\n            "+this.fragSectionPlanesSlice+"\n            "+this.fragLighting+"\n            "+this.fragLogDepthBufOutput+"\n        }"}},{key:"fragHeader",get:function(){return"#version 300 es\n        #ifdef GL_FRAGMENT_PRECISION_HIGH\n       precision highp float;\n        precision highp int;\n        #else\n        precision mediump float;\n        precision mediump int;\n        #endif"}},{key:"fragGammaDefs",get:function(){return'uniform float gammaFactor;\n        vec4 linearToLinear( in vec4 value ) {\n            return value;\n        }\n        vec4 sRGBToLinear( in vec4 value ) {\n            return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n        }\n        vec4 gammaToLinear( in vec4 value) {\n            return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n        }\n        vec4 linearToGamma( in vec4 value, in float gammaFactor ) {\n              return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );");\n        }'}},{key:"fragLightDefs",get:function(){var e=this.renderContext.view,t=[];t.push("uniform vec4 lightAmbient;");for(var i=0,r=e.lightsList.length;i<r;i++){var n=e.lightsList[i];"ambient"!==n.type&&(t.push("uniform vec4 lightColor"+i+";"),"dir"===n.type&&t.push("uniform vec3 lightDir"+i+";"),"point"===n.type&&t.push("uniform vec3 lightPos"+i+";"),"spot"===n.type&&(t.push("uniform vec3 lightPos"+i+";"),t.push("uniform vec3 lightDir"+i+";")))}return t.join("\n")}},{key:"fragLogDepthBufDefs",get:function(){return this.renderContext.view.logarithmicDepthBufferEnabled?"in float isPerspective;\n                    uniform float logDepthBufFC;\n                    in float fragDepth;":""}},{key:"fragLogDepthBufOutput",get:function(){return this.renderContext.view.logarithmicDepthBufferEnabled?"gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( fragDepth ) * logDepthBufFC * 0.5;":""}},{key:"fragLighting",get:function(){var e=[];e.push("vec4 viewPosition  = viewMatrix * worldPosition; "),e.push("vec4 modelNormal = vec4(octDecode(normal.xy), 0.0); "),e.push("vec4 worldNormal = worldNormalMatrix * vec4(dot(modelNormal, modelNormalMatrixCol0), dot(modelNormal, modelNormalMatrixCol1), dot(modelNormal, modelNormalMatrixCol2), 0.0);"),e.push("vec3 viewNormal = normalize(vec4(viewNormalMatrix * worldNormal).xyz);"),e.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),e.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),e.push("float lambertian = 1.0;");for(var t=0,i=this.renderContext.view.lightsList.length;t<i;t++){var r=this.renderContext.view.lightsList[t];if("ambient"!==r.type){if("dir"===r.type)e.push("view"===r.space?"viewLightDir = normalize(lightDir"+t+");":"viewLightDir = normalize((viewMatrix * vec4(lightDir"+t+", 0.0)).xyz);");else if("point"===r.type)e.push("view"===r.space?"viewLightDir = -normalize(lightPos"+t+" - viewPosition.xyz);":"viewLightDir = -normalize((viewMatrix * vec4(lightPos"+t+", 0.0)).xyz);");else{if("spot"!==r.type)continue;e.push("view"===r.space?"viewLightDir = normalize(lightDir"+t+");":"viewLightDir = normalize((viewMatrix * vec4(lightDir"+t+", 0.0)).xyz);")}e.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),e.push("reflectedColor += lambertian * (lightColor"+t+".rgb * lightColor"+t+".a);")}}return e.push("vec3 rgb = (vec3(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0));"),e.push("meshColor =  vec4((lightAmbient.rgb * lightAmbient.a * rgb) + (reflectedColor * rgb), float(color.a) / 255.0);"),e.join("\n")}},{key:"fragSAOOutput",get:function(){return this.renderContext.view.sao.enabled?"float viewportWidth     = uSAOParams[0];\n                    float viewportHeight    = uSAOParams[1];\n                    float blendCutoff       = uSAOParams[2];\n                    float blendFactor       = uSAOParams[3];\n                    vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);\n                    float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture(uOcclusionTexture, uv))) * blendFactor;\n                    outColor                = vec4(fragColor.rgb * ambient, 1.0);":"outColor            = fragColor;"}},{key:"fragOutput",get:function(){return"outColor            = fragColor;"}},{key:"fragSectionPlaneDefs",get:function(){var e=[];e.push("in vec4 worldPosition;\n                  in vec4 meshFlags2;");for(var t=0,i=this.renderContext.view.sectionPlanesList.length;t<i;t++)e.push("uniform bool sectionPlaneActive"+t+";\n                      uniform vec3 sectionPlanePos"+t+";\n                      uniform vec3 sectionPlaneDir"+t+";");return e.join("\n")}},{key:"fragLightSourceUniforms",get:function(){var e=[];e.push("uniform vec4 lightAmbient;");for(var t=0,i=this.renderContext.view.lightsList.length;t<i;t++){var r=this.renderContext.view.lightsList[t];r instanceof Yl||(e.push("uniform vec4 lightColor"+t+";"),r instanceof zl&&e.push("uniform vec3 lightDir"+t+";"),r instanceof Zl&&e.push("uniform vec3 lightPos"+t+";"))}return e.join("\n")}},{key:"fragSectionPlanesSlice",get:function(){var e=[];if(this.renderContext.view.sectionPlanesList.length>0){e.push("bool clippable = (float(meshFlags2.x) > 0.0);\n                      if (clippable) {\n                          float dist = 0.0;");for(var t=0,i=this.renderContext.view.sectionPlanesList.length;t<i;t++)e.push("if (sectionPlaneActive"+t+") {\n                              dist += clamp(dot(-sectionPlaneDir"+t+".xyz, worldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);\n                          }");e.push("if (dist > 0.0) { \n                          discard;\n                      }\n                  }")}return e.join("\n")}},{key:"fragFlatShading",get:function(){var e=[];return e.push(""),e.join("\n")}}]),e}();function hu(){var e=this.renderContext.view,t=this.renderContext.gl;if(f(this,tu)[tu]=new Nh(t,f(this,su)[su]()),f(this,tu)[tu].errors)this.errors=f(this,tu)[tu].errors;else{var i=f(this,tu)[tu];f(this,ru)[ru]={renderPass:i.getLocation("renderPass"),viewMatrix:i.getLocation("viewMatrix"),projMatrix:i.getLocation("projMatrix"),worldMatrix:i.getLocation("worldMatrix"),sao:i.getLocation("sao"),logDepthBufFC:i.getLocation("logDepthBufFC"),gammaFactor:i.getLocation("gammaFactor"),pointSize:i.getLocation("pointSize"),nearPlaneHeight:i.getLocation("nearPlaneHeight"),pointCloudIntensityRange:i.getLocation("pointCloudIntensityRange"),pickZNear:i.getLocation("pickZNear"),pickZFar:i.getLocation("pickZFar"),pickInvisible:i.getLocation("pickInvisible"),color:i.getLocation("color"),lightAmbient:i.getLocation("lightAmbient"),lights:[],sectionPlanes:[]};for(var r=f(this,ru)[ru],n=e.lightsList,o=0,s=n.length;o<s;o++)switch(n[o].type){case"dir":r.lights.push({color:i.getLocation("lightColor"+o),dir:i.getLocation("lightDir"+o)});break;case"point":r.lights.push({color:i.getLocation("lightColor"+o),pos:i.getLocation("lightPos"+o),attenuation:i.getLocation("lightAttenuation"+o)});break;case"spot":r.lights.push({color:i.getLocation("lightColor"+o),pos:i.getLocation("lightPos"+o),dir:i.getLocation("lightDir"+o),attenuation:i.getLocation("lightAttenuation"+o)})}for(var a=0,c=e.sectionPlanesList.length;a<c;a++)r.sectionPlanes.push({active:i.getLocation("sectionPlaneActive"+a),pos:i.getLocation("sectionPlanePos"+a),dir:i.getLocation("sectionPlaneDir"+a)});f(this,nu)[nu]={viewMatrices:i.getSampler("viewMatrices"),positions:i.getSampler("positions"),indices:i.getSampler("indices"),edgeIndices:i.getSampler("edgeIndices"),eachMeshAttributes:i.getSampler("eachMeshAttributes"),eachMeshMatrices:i.getSampler("eachMeshMatrices"),eachEdgeOffset:i.getSampler("eachMeshOffset"),eachPrimitiveMesh:i.getSampler("eachMeshTriangleMesh"),eachEdgeMesh:i.getSampler("eachEdgeMesh"),baseColorMap:i.getSampler("baseColorMap"),metallicRoughMap:i.getSampler("metallicRoughMap"),emissiveMap:i.getSampler("emissiveMap"),normalMap:i.getSampler("normalMap"),occlusionMap:i.getSampler("occlusionMap")},f(this,eu)[eu]=this.getHash()}}function uu(){return{vertex:this.buildVertexShader(),fragment:this.buildFragmentShader()}}function du(){return!f(this,iu)[iu]||(f(this,iu)[iu]=!1,f(this,eu)[eu]===this.getHash())}function fu(){var e=this.renderContext.view,t=this.renderContext.gl,i=f(this,ru)[ru],r=e.camera.project;f(this,tu)[tu].bind(),i.lightAmbient&&t.uniform4fv(i.lightAmbient,e.getAmbientColorAndIntensity());for(var n=0,o=i.lights.length;n<o;n++){var s=i.lights[n],a=e.lightsList[n];s.color&&t.uniform4f(s.color,a.color[0],a.color[1],a.color[2],a.intensity),s.dir&&t.uniform3f(s.dir,a.dir[0],a.dir[1],a.dir[2]),s.pos&&t.uniform3f(s.pos,a.pos[0],a.pos[1],a.pos[2]),s.attenuation&&t.uniform1f(s.attenuation,a.attenuation)}if(i.sao){var c=e.sao;if(c.possible){var l=t.drawingBufferHeight;$h[0]=t.drawingBufferWidth,$h[1]=l,$h[2]=c.blendCutoff,$h[3]=c.blendFactor,t.uniform4fv(i.sao,$h)}}if(i.gammaFactor&&t.uniform1f(i.gammaFactor,e.gammaFactor),i.pointSize&&t.uniform1f(i.pointSize,e.pointsMaterial.pointSize),i.nearPlaneHeight&&t.uniform1f(i.nearPlaneHeight,e.camera.projectionType===tt?1:t.drawingBufferHeight/(2*Math.tan(.5*e.camera.perspectiveProjection.fov*Math.PI/180))),i.pickZNear&&(t.uniform1f(i.pickZNear,this.renderContext.pickZNear),t.uniform1f(i.pickZFar,this.renderContext.pickZFar)),i.pickInvisible&&t.uniform1i(i.pickInvisible,this.renderContext.pickInvisible?1:0),i.logDepthBufFC){var h=2/(Math.log(r.far+1)/Math.LN2);t.uniform1f(i.logDepthBufFC,h)}}var vu,pu=/*#__PURE__*/function(e){function t(t){return e.call(this,t)||this}r(t,e);var i=t.prototype;return i.getHash=function(){return this.renderContext.view.getSectionPlanesHash()+"-"+this.renderContext.view.getLightsHash()},i.buildVertexShader=function(){return this.vertHeader+"   \n        \n                uniform int                 renderPass;   \n            \n                uniform highp   mat4        projMatrix;\n                uniform highp   mat4        worldMatrix;\n                      \n                uniform mediump sampler2D   viewMatrices;\n                           \n                uniform mediump usampler2D  eachPrimitiveMesh;\n                uniform lowp    usampler2D  eachMeshAttributes;\n                \n                uniform mediump sampler2D   eachMeshMatrices;\n                uniform mediump usampler2D  positions;\n                uniform highp   usampler2D  indices;\n                \n                uniform  float  logDepthBufFC;\n                 \n                out vec4        worldPosition;\n                flat out uint   meshFlags2r;                       \n                flat out uvec4  meshColor;\n                out float       fragDepth;\n                \n                bool isPerspectiveMatrix(mat4 m) {\n                    return (m[2][3] == - 1.0);\n                }\n                \n                out float isPerspective;\n                    \n                void main(void) {\n                                   \n                    int triangleIndex      = gl_VertexID / 3;\n                    \n                    int hPackedMeshIdIndex = (triangleIndex >> 3) & 1023;\n                    int vPackedMeshIdIndex = (triangleIndex >> 3) >> 10;\n                    \n                    int meshIndex          = int(texelFetch(eachPrimitiveMesh, ivec2(hPackedMeshIdIndex, vPackedMeshIdIndex), 0).r);                   \n                    uvec4 meshFlags        = texelFetch (eachMeshAttributes, ivec2(2, meshIndex), 0);\n\n                    if (int(meshFlags.x) != renderPass) {\n                        gl_Position = vec4(3.0, 3.0, 3.0, 1.0);\n                        return;\n                    } \n                 \n                    uvec4 meshFlags2 = texelFetch (eachMeshAttributes, ivec2(3, meshIndex), 0);\n\n                    ivec4 packedVertexBase = ivec4(texelFetch (eachMeshAttributes, ivec2(4, meshIndex), 0));\n                    ivec4 packedIndexBaseOffset = ivec4(texelFetch (eachMeshAttributes, ivec2(5, meshIndex), 0));\n                    int indexBaseOffset =   (packedIndexBaseOffset.r << 24) + \n                                            (packedIndexBaseOffset.g << 16) + \n                                            (packedIndexBaseOffset.b << 8) + \n                                            (packedIndexBaseOffset.a);\n\n                    int hIndex = (triangleIndex - indexBaseOffset) & 1023;\n                    int vIndex = (triangleIndex - indexBaseOffset) >> 10;\n\n                    ivec3 vertexIndices = ivec3(texelFetch(indices, ivec2(hIndex, vIndex), 0));\n                    ivec3 uniqueVertexIndexes = vertexIndices + (packedVertexBase.r << 24) + (packedVertexBase.g << 16) + (packedVertexBase.b << 8) + packedVertexBase.a;\n\n                    ivec3 indexPositionH = uniqueVertexIndexes & 1023;\n                    ivec3 indexPositionV = uniqueVertexIndexes >> 10;\n\n                    mat4 positionsDecompressMatrix = mat4 (\n                        texelFetch (eachMeshMatrices, ivec2(0, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(1, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(2, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(3, meshIndex), 0));\n                        \n                    mat4 meshMatrix = mat4 (\n                        texelFetch (eachMeshMatrices, ivec2(4, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(5, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(6, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(7, meshIndex), 0));\n\n                    ivec4 packedViewMatrixIndex = ivec4(texelFetch (eachMeshAttributes, ivec2(7, meshIndex), 0));\n                    int viewMatrixIndex = \n                            (packedViewMatrixIndex.r << 24) + \n                            (packedViewMatrixIndex.g << 16) + \n                            (packedViewMatrixIndex.b << 8) + \n                            (packedViewMatrixIndex.a);\n                   \n                    mat4 viewMatrix = mat4 (\n                        texelFetch (viewMatrices, ivec2(4, viewMatrixIndex), 0), \n                        texelFetch (viewMatrices, ivec2(5, viewMatrixIndex), 0), \n                        texelFetch (viewMatrices, ivec2(6, viewMatrixIndex), 0), \n                        texelFetch (viewMatrices, ivec2(7, viewMatrixIndex), 0));\n\n                    vec3 _positions[3];\n                   \n                    _positions[0] = vec3(texelFetch(positions, ivec2(indexPositionH.r, indexPositionV.r), 0));\n                    _positions[1] = vec3(texelFetch(positions, ivec2(indexPositionH.g, indexPositionV.g), 0));\n                    _positions[2] = vec3(texelFetch(positions, ivec2(indexPositionH.b, indexPositionV.b), 0));\n  \n                    vec3  position       = _positions[gl_VertexID % 3];\n                   \n                    vec4  _worldPosition = worldMatrix * ((meshMatrix * positionsDecompressMatrix) * vec4(position, 1.0)); \n                    vec4  viewPosition   = viewMatrix * _worldPosition;                   \n                    vec4  clipPosition   = projMatrix * viewPosition;\n\n                    meshFlags2r     = meshFlags2.r;                     \n                    meshColor       = texelFetch (eachMeshAttributes, ivec2(0, meshIndex), 0);                          \n                    fragDepth       = 1.0 + clipPosition.w;\n                    isPerspective   = float (isPerspectiveMatrix(projMatrix));\n                    worldPosition   = _worldPosition;                                               \n                    \n                    gl_Position     = clipPosition;\n                }"},i.buildFragmentShader=function(){return this.fragHeader+"                        \n    \n             flat   in uvec4    meshColor;\n                in float        fragDepth;\n                in float        isPerspective;    \n                flat in uint    meshFlags2r;        \n                uniform float   logDepthBufFC;                        \n    \n                "+this.fragSectionPlaneDefs+"                  \n                "+this.fragLightSourceUniforms+'                                                             \n    \n                out vec4 outColor;        \n    \n                void main(void) {         \n                \n                // src.push("float lambertian = 1.0;");\n                // \n                //  vec3 xTangent = dFdx( vViewPosition.xyz );\n                //  vec3 yTangent = dFdy( vViewPosition.xyz );\n                // \n                //  vec3 viewNormal = normalize( cross( xTangent, yTangent ) );        \n    \n                    '+this.fragSectionPlanesSlice+"                                    \n                    "+this.fragFlatShading+"     \n          \n                    outColor = vec4(meshColor);                   \n                    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( fragDepth ) * logDepthBufFC * 0.5;                        \n                }"},t}(lu),yu=/*#__PURE__*/d("built"),mu=/*#__PURE__*/function(){function e(){this.positions=void 0,this.indices_8Bits=void 0,this.indices_16Bits=void 0,this.indices_32Bits=void 0,this.edgeIndices_8Bits=void 0,this.edgeIndices_16Bits=void 0,this.edgeIndices_32Bits=void 0,this.indices=void 0,this.edgeIndices=void 0,this.eachMeshAttributes=void 0,this.eachMeshMatrices=void 0,this.eachEdgeOffset=void 0,this.eachPrimitiveMesh_8Bits=void 0,this.eachPrimitiveMesh_16Bits=void 0,this.eachPrimitiveMesh_32Bits=void 0,this.eachPrimitiveMesh=void 0,this.eachEdgeMesh_8Bits=void 0,this.eachEdgeMesh_16Bits=void 0,this.eachEdgeMesh_32Bits=void 0,this.eachEdgeMesh=void 0,Object.defineProperty(this,yu,{writable:!0,value:void 0}),this.positions=null,this.indices_8Bits=null,this.indices_16Bits=null,this.indices_32Bits=null,this.edgeIndices_8Bits=null,this.edgeIndices_16Bits=null,this.edgeIndices_32Bits=null,this.eachMeshAttributes=null,this.eachMeshMatrices=null,this.eachPrimitiveMesh_8Bits=null,this.eachPrimitiveMesh_16Bits=null,this.eachPrimitiveMesh_32Bits=null,this.eachEdgeMesh_8Bits=null,this.eachEdgeMesh_16Bits=null,this.eachEdgeMesh_32Bits=null,this.eachEdgeOffset=null,f(this,yu)[yu]=!1}var t=e.prototype;return t.build=function(){this.indices={8:this.indices_8Bits,16:this.indices_16Bits,32:this.indices_32Bits},this.eachPrimitiveMesh={8:this.eachPrimitiveMesh_8Bits,16:this.eachPrimitiveMesh_16Bits,32:this.eachPrimitiveMesh_32Bits},this.edgeIndices={8:this.edgeIndices_8Bits,16:this.edgeIndices_16Bits,32:this.edgeIndices_32Bits},this.eachEdgeMesh={8:this.eachEdgeMesh_8Bits,16:this.eachEdgeMesh_16Bits,32:this.eachEdgeMesh_32Bits},f(this,yu)[yu]=!0},t.destroy=function(){this.positions&&this.positions.destroy(),this.indices_8Bits&&this.indices_8Bits.destroy(),this.indices_16Bits&&this.indices_16Bits.destroy(),this.indices_32Bits&&this.indices_32Bits.destroy(),this.edgeIndices_8Bits&&this.edgeIndices_8Bits.destroy(),this.edgeIndices_16Bits&&this.edgeIndices_16Bits.destroy(),this.edgeIndices_32Bits&&this.edgeIndices_32Bits.destroy(),this.eachMeshMatrices&&this.eachMeshMatrices.destroy(),this.eachMeshAttributes&&this.eachMeshAttributes.destroy(),this.eachEdgeOffset&&this.eachEdgeOffset.destroy(),this.eachPrimitiveMesh_8Bits&&this.eachPrimitiveMesh_8Bits.destroy(),this.eachPrimitiveMesh_16Bits&&this.eachPrimitiveMesh_16Bits.destroy(),this.eachPrimitiveMesh_32Bits&&this.eachPrimitiveMesh_32Bits.destroy(),this.eachEdgeMesh_8Bits&&this.eachEdgeMesh_8Bits.destroy(),this.eachEdgeMesh_16Bits&&this.eachEdgeMesh_16Bits.destroy(),this.eachEdgeMesh_32Bits&&this.eachEdgeMesh_32Bits.destroy()},e}(),bu=/*#__PURE__*/function(){function e(){this.numMeshes=void 0,this.numVisible=void 0,this.numTransparent=void 0,this.numEdges=void 0,this.numXRayed=void 0,this.numSelected=void 0,this.numHighlighted=void 0,this.numClippable=void 0,this.numPickable=void 0,this.numCulled=void 0,this.reset()}return e.prototype.reset=function(){this.numMeshes=0,this.numVisible=0,this.numTransparent=0,this.numEdges=0,this.numXRayed=0,this.numSelected=0,this.numHighlighted=0,this.numClippable=0,this.numPickable=0,this.numCulled=0},e}(),gu={VISIBLE:1,CULLED:4,PICKABLE:8,CLIPPABLE:16,COLLIDABLE:32,CAST_SHADOW:64,RECEIVE_SHADOW:128,XRAYED:256,HIGHLIGHTED:512,SELECTED:1024,EDGES:2048,BACKFACES:4096,TRANSPARENT:8192};function wu(e){return function(t){return Eu(e,t,[].slice.call(arguments,1))}}function Pu(e,t){return wu(xu(e,t).get)}for(var Eu=Reflect.apply,Tu=Reflect.construct,_u=Reflect.defineProperty,Iu=Reflect.get,xu=Reflect.getOwnPropertyDescriptor,Su=Reflect.getPrototypeOf,Mu=Reflect.has,Ou=Reflect.ownKeys,ju=Reflect.set,Ru=Reflect.setPrototypeOf,Du=Proxy,Au=Number,Cu=Au.isFinite,ku=Au.isNaN,Bu=Symbol.iterator,Lu=Symbol.species,Fu=Symbol.toStringTag,Uu=Symbol.for,Nu=Object,Vu=Nu.create,Gu=Nu.defineProperty,Hu=Nu.freeze,Xu=Nu.is,Wu=Nu.prototype,Yu=wu(Wu.isPrototypeOf),Ku=Nu.hasOwn||wu(Wu.hasOwnProperty),zu=Array,qu=zu.isArray,Zu=zu.prototype,Qu=wu(Zu.join),Ju=wu(Zu.push),$u=wu(Zu.toLocaleString),ed=Zu[Bu],td=wu(ed),id=Math.trunc,rd=ArrayBuffer,nd=rd.isView,od=wu(rd.prototype.slice),sd=Pu(rd.prototype,"byteLength"),ad="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:null,cd=ad&&Pu(ad.prototype,"byteLength"),ld=Su(Uint8Array),hd=ld.from,ud=ld.prototype,dd=ud[Bu],fd=wu(ud.keys),vd=wu(ud.values),pd=wu(ud.entries),yd=wu(ud.set),md=wu(ud.reverse),bd=wu(ud.fill),gd=wu(ud.copyWithin),wd=wu(ud.sort),Pd=wu(ud.slice),Ed=wu(ud.subarray),Td=Pu(ud,"buffer"),_d=Pu(ud,"byteOffset"),Id=Pu(ud,"length"),xd=Pu(ud,Fu),Sd=Uint16Array,Md=function(){return Eu(hd,Sd,[].slice.call(arguments))},Od=Uint32Array,jd=Float32Array,Rd=Su([][Bu]()),Dd=wu(Rd.next),Ad=wu(e().mark(function t(){return e().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},t)})().next),Cd=Su(Rd),kd=TypeError,Bd=RangeError,Ld=Set,Fd=Ld.prototype,Ud=wu(Fd.add),Nd=wu(Fd.has),Vd=WeakMap,Gd=Vd.prototype,Hd=wu(Gd.get),Xd=wu(Gd.has),Wd=wu(Gd.set),Yd=new rd(4),Kd=new jd(Yd),zd=new Od(Yd),qd=new Od(512),Zd=new Od(512),Qd=0;Qd<256;++Qd){var Jd=Qd-127;Jd<-27?(qd[Qd]=0,qd[256|Qd]=32768,Zd[Qd]=24,Zd[256|Qd]=24):Jd<-14?(qd[Qd]=1024>>-Jd-14,qd[256|Qd]=1024>>-Jd-14|32768,Zd[Qd]=-Jd-1,Zd[256|Qd]=-Jd-1):Jd<=15?(qd[Qd]=Jd+15<<10,qd[256|Qd]=Jd+15<<10|32768,Zd[Qd]=13,Zd[256|Qd]=13):Jd<128?(qd[Qd]=31744,qd[256|Qd]=64512,Zd[Qd]=24,Zd[256|Qd]=24):(qd[Qd]=31744,qd[256|Qd]=64512,Zd[Qd]=13,Zd[256|Qd]=13)}function $d(e){Kd[0]=e;var t=zd[0],i=t>>23&511;return qd[i]+((8388607&t)>>Zd[i])}var ef=new Od(2048),tf=new Od(64),rf=new Od(64);ef[0]=0;for(var nf=1;nf<1024;++nf){for(var of=nf<<13,sf=0;0==(8388608&of);)sf-=8388608,of<<=1;ef[nf]=(of&=-8388609)|(sf+=947912704)}for(var af=1024;af<2048;++af)ef[af]=939524096+(af-1024<<13);tf[0]=0;for(var cf=1;cf<31;++cf)tf[cf]=cf<<23;tf[31]=1199570944,tf[32]=2147483648;for(var lf=33;lf<63;++lf)tf[lf]=2147483648+(lf-32<<23);tf[63]=3347054592,rf[0]=0;for(var hf=1;hf<64;++hf)rf[hf]=32===hf?0:1024;function uf(e){var t=e>>10;return zd[0]=ef[rf[t]+(1023&e)]+tf[t],Kd[0]}function df(e){var t;if(e[Bu]===ed)return e;var i=td(e);return Vu(null,((t={next:{value:function(){return Dd(i)}}})[Bu]={value:function(){return this}},t))}var ff=new Vd,vf=Vu(Cd,(vu={next:{value:function(){var e=Hd(ff,this);return Ad(e)},writable:!0,configurable:!0}},vu[Fu]={value:"Array Iterator",configurable:!0},vu));function pf(e){var t=Vu(vf);return Wd(ff,t,e),t}function yf(e){return null!==e&&"object"==typeof e||"function"==typeof e}function mf(e){return null!==e&&"object"==typeof e}function bf(e){return void 0!==xd(e)}function gf(e){var t=xd(e);return"BigInt64Array"===t||"BigUint64Array"===t}function wf(e){if(null===ad)return!1;try{return cd(e),!0}catch(e){return!1}}function Pf(e){return!!qu(e)&&(e[Bu]===ed||"Array Iterator"===e[Bu]()[Fu])}function Ef(e){if("string"!=typeof e)return!1;var t=Au(e);return e===t+""&&!!Cu(t)&&t===id(t)}var Tf=Au.MAX_SAFE_INTEGER;function _f(e){if("bigint"==typeof e)throw kd("Cannot convert a BigInt value to a number");var t=Au(e);return ku(t)||0===t?0:id(t)}function If(e){var t=_f(e);return t<0?0:t<Tf?t:Tf}function xf(e,t){if(!yf(e))throw kd("This is not an object");var i=e.constructor;if(void 0===i)return t;if(!yf(i))throw kd("The constructor property value is not an object");var r=i[Lu];return null==r?t:r}function Sf(e){if(wf(e))return!1;try{return od(e,0,0),!1}catch(e){}return!0}function Mf(e,t){var i=ku(e),r=ku(t);if(i&&r)return 0;if(i)return 1;if(r)return-1;if(e<t)return-1;if(e>t)return 1;if(0===e&&0===t){var n=Xu(e,0),o=Xu(t,0);if(!n&&o)return-1;if(n&&!o)return 1}return 0}var Of=Uu("__Float16Array__"),jf=new Vd;function Rf(e){return Xd(jf,e)||!nd(e)&&function(e){if(!mf(e))return!1;var t=Su(e);if(!mf(t))return!1;var i=t.constructor;if(void 0===i)return!1;if(!yf(i))throw kd("The constructor property value is not an object");return Mu(i,Of)}(e)}function Df(e){if(!Rf(e))throw kd("This is not a Float16Array object")}function Af(e,t){var i=Rf(e),r=bf(e);if(!i&&!r)throw kd("Species constructor didn't return TypedArray object");if("number"==typeof t){var n;if(i){var o=Cf(e);n=Id(o)}else n=Id(e);if(n<t)throw kd("Derived constructor created TypedArray object which was too small length")}if(gf(e))throw kd("Cannot mix BigInt and other types, use explicit conversions")}function Cf(e){var t=Hd(jf,e);if(void 0!==t){if(Sf(Td(t)))throw kd("Attempting to access detached ArrayBuffer");return t}var i=e.buffer;if(Sf(i))throw kd("Attempting to access detached ArrayBuffer");var r=Tu(Gf,[i,e.byteOffset,e.length],e.constructor);return Hd(jf,r)}function kf(e){for(var t=Id(e),i=[],r=0;r<t;++r)i[r]=uf(e[r]);return i}for(var Bf,Lf=new Ld,Ff=h(Ou(ud));!(Bf=Ff()).done;){var Uf=Bf.value;if(Uf!==Fu){var Nf=xu(ud,Uf);Ku(Nf,"get")&&Ud(Lf,Uf)}}var Vf=Hu({get:function(e,t,i){return Ef(t)&&Ku(e,t)?uf(Iu(e,t)):Nd(Lf,t)&&Yu(ud,e)?Iu(e,t):Iu(e,t,i)},set:function(e,t,i,r){return Ef(t)&&Ku(e,t)?ju(e,t,$d(i)):ju(e,t,i,r)},getOwnPropertyDescriptor:function(e,t){if(Ef(t)&&Ku(e,t)){var i=xu(e,t);return i.value=uf(i.value),i}return xu(e,t)},defineProperty:function(e,t,i){return Ef(t)&&Ku(e,t)&&Ku(i,"value")?(i.value=$d(i.value),_u(e,t,i)):_u(e,t,i)}}),Gf=/*#__PURE__*/function(){function t(e,i,r){var n;if(Rf(e))n=Tu(Sd,[Cf(e)],this instanceof t?this.constructor:void 0);else if(yf(e)&&!function(e){try{return sd(e),!0}catch(e){return!1}}(e)){var o,s;if(bf(e)){o=e,s=Id(e);var a=Td(e),c=wf(a)?rd:xf(a,rd);if(Sf(a))throw kd("Attempting to access detached ArrayBuffer");if(gf(e))throw kd("Cannot mix BigInt and other types, use explicit conversions");var l=new c(2*s);n=Tu(Sd,[l],this instanceof t?this.constructor:void 0)}else{var h=e[Bu];if(null!=h&&"function"!=typeof h)throw kd("@@iterator property is not callable");null!=h?Pf(e)?(o=e,s=e.length):s=(o=[].concat(e)).length:s=If((o=e).length),n=Tu(Sd,[s],this instanceof t?this.constructor:void 0)}for(var u=0;u<s;++u)n[u]=$d(o[u])}else n=Tu(Sd,arguments,this instanceof t?this.constructor:void 0);var d=new Du(n,Vf);return Wd(jf,d,n),d}t.from=function(e){var i,r,n=this,o=[].slice.call(arguments,1),s=this;if(!Mu(s,Of))throw kd("This constructor is not a subclass of Float16Array");if(s===t){if(Rf(e)&&0===o.length){var a=Cf(e),c=new Sd(Td(a),_d(a),Id(a));return new t(Td(Pd(c)))}if(0===o.length)return new t(Td(Md(e,$d)));var l=o[0];return new t(Td(Md(e,function(e){return $d(Eu(l,n,[e].concat(df([].slice.call(arguments,1)))))},o[1])))}var h,u=e[Bu];if(null!=u&&"function"!=typeof u)throw kd("@@iterator property is not callable");if(null!=u)Pf(e)?(i=e,r=e.length):!bf(h=e)||h[Bu]!==dd&&"Array Iterator"!==h[Bu]()[Fu]?r=(i=[].concat(e)).length:(i=e,r=Id(e));else{if(null==e)throw kd("Cannot convert undefined or null to object");r=If((i=Nu(e)).length)}var d=new s(r);if(0===o.length)for(var f=0;f<r;++f)d[f]=i[f];else for(var v=o[0],p=o[1],y=0;y<r;++y)d[y]=Eu(v,p,[i[y],y]);return d},t.of=function(){var e=[].slice.call(arguments),i=this;if(!Mu(i,Of))throw kd("This constructor is not a subclass of Float16Array");var r=e.length;if(i===t){for(var n=new t(r),o=Cf(n),s=0;s<r;++s)o[s]=$d(e[s]);return n}for(var a=new i(r),c=0;c<r;++c)a[c]=e[c];return a};var r=t.prototype;return r.keys=function(){Df(this);var e=Cf(this);return fd(e)},r.values=function(){Df(this);var t=Cf(this);return pf(/*#__PURE__*/e().mark(function i(){var r,n,o;return e().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=h(vd(t));case 1:if((n=r()).done){e.next=7;break}return o=n.value,e.next=5,uf(o);case 5:e.next=1;break;case 7:case"end":return e.stop()}},i)})())},r.entries=function(){Df(this);var t=Cf(this);return pf(/*#__PURE__*/e().mark(function i(){var r,n,o,s,a;return e().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=h(pd(t));case 1:if((n=r()).done){e.next=7;break}return s=(o=n.value)[0],a=o[1],e.next=5,[s,uf(a)];case 5:e.next=1;break;case 7:case"end":return e.stop()}},i)})())},r.at=function(e){Df(this);var t=Cf(this),i=Id(t),r=_f(e),n=r>=0?r:i+r;if(!(n<0||n>=i))return uf(t[n])},r.map=function(e){Df(this);var i=Cf(this),r=Id(i),n=[].slice.call(arguments,1)[0],o=xf(i,t);if(o===t){for(var s=new t(r),a=Cf(s),c=0;c<r;++c){var l=uf(i[c]);a[c]=$d(Eu(e,n,[l,c,this]))}return s}var h=new o(r);Af(h,r);for(var u=0;u<r;++u){var d=uf(i[u]);h[u]=Eu(e,n,[d,u,this])}return h},r.filter=function(e){Df(this);for(var i=Cf(this),r=Id(i),n=[].slice.call(arguments,1)[0],o=[],s=0;s<r;++s){var a=uf(i[s]);Eu(e,n,[a,s,this])&&Ju(o,a)}var c=new(xf(i,t))(o);return Af(c),c},r.reduce=function(e){var t=[].slice.call(arguments,1);Df(this);var i,r,n=Cf(this),o=Id(n);if(0===o&&0===t.length)throw kd("Reduce of empty array with no initial value");0===t.length?(i=uf(n[0]),r=1):(i=t[0],r=0);for(var s=r;s<o;++s)i=e(i,uf(n[s]),s,this);return i},r.reduceRight=function(e){var t=[].slice.call(arguments,1);Df(this);var i,r,n=Cf(this),o=Id(n);if(0===o&&0===t.length)throw kd("Reduce of empty array with no initial value");0===t.length?(i=uf(n[o-1]),r=o-2):(i=t[0],r=o-1);for(var s=r;s>=0;--s)i=e(i,uf(n[s]),s,this);return i},r.forEach=function(e){Df(this);for(var t=Cf(this),i=Id(t),r=[].slice.call(arguments,1)[0],n=0;n<i;++n)Eu(e,r,[uf(t[n]),n,this])},r.find=function(e){Df(this);for(var t=Cf(this),i=Id(t),r=[].slice.call(arguments,1)[0],n=0;n<i;++n){var o=uf(t[n]);if(Eu(e,r,[o,n,this]))return o}},r.findIndex=function(e){Df(this);for(var t=Cf(this),i=Id(t),r=[].slice.call(arguments,1)[0],n=0;n<i;++n){var o=uf(t[n]);if(Eu(e,r,[o,n,this]))return n}return-1},r.findLast=function(e){Df(this);for(var t=Cf(this),i=Id(t),r=[].slice.call(arguments,1)[0],n=i-1;n>=0;--n){var o=uf(t[n]);if(Eu(e,r,[o,n,this]))return o}},r.findLastIndex=function(e){Df(this);for(var t=Cf(this),i=Id(t),r=[].slice.call(arguments,1)[0],n=i-1;n>=0;--n){var o=uf(t[n]);if(Eu(e,r,[o,n,this]))return n}return-1},r.every=function(e){Df(this);for(var t=Cf(this),i=Id(t),r=[].slice.call(arguments,1)[0],n=0;n<i;++n)if(!Eu(e,r,[uf(t[n]),n,this]))return!1;return!0},r.some=function(e){Df(this);for(var t=Cf(this),i=Id(t),r=[].slice.call(arguments,1)[0],n=0;n<i;++n)if(Eu(e,r,[uf(t[n]),n,this]))return!0;return!1},r.set=function(e){Df(this);var t=Cf(this),i=_f([].slice.call(arguments,1)[0]);if(i<0)throw Bd("Offset is out of bounds");if(null==e)throw kd("Cannot convert undefined or null to object");if(gf(e))throw kd("Cannot mix BigInt and other types, use explicit conversions");if(Rf(e))return yd(Cf(this),Cf(e),i);if(bf(e)&&Sf(Td(e)))throw kd("Attempting to access detached ArrayBuffer");var r=Id(t),n=Nu(e),o=If(n.length);if(i===1/0||o+i>r)throw Bd("Offset is out of bounds");for(var s=0;s<o;++s)t[s+i]=$d(n[s])},r.reverse=function(){Df(this);var e=Cf(this);return md(e),this},r.fill=function(e){Df(this);var t=Cf(this);return bd.apply(void 0,[t,$d(e)].concat(df([].slice.call(arguments,1)))),this},r.copyWithin=function(e,t){Df(this);var i=Cf(this);return gd.apply(void 0,[i,e,t].concat(df([].slice.call(arguments,2)))),this},r.sort=function(){var e=[].slice.call(arguments);Df(this);var t=Cf(this),i=void 0!==e[0]?e[0]:Mf;return wd(t,function(e,t){return i(uf(e),uf(t))}),this},r.slice=function(){var e=[].slice.call(arguments);Df(this);var i=Cf(this),r=xf(i,t);if(r===t){var n=new Sd(Td(i),_d(i),Id(i));return new t(Td(Pd.apply(void 0,[n].concat(df(e)))))}var o,s,a=Id(i),c=_f(e[0]),l=void 0===e[1]?a:_f(e[1]),h=(s=l===-1/0?0:l<0?a+l>0?a+l:0:a<l?a:l)-(o=c===-1/0?0:c<0?a+c>0?a+c:0:a<c?a:c)>0?s-o:0,u=new r(h);if(Af(u,h),0===h)return u;if(Sf(Td(i)))throw kd("Attempting to access detached ArrayBuffer");for(var d=0;o<s;)u[d]=uf(i[o]),++o,++d;return u},r.subarray=function(){Df(this);var e=Cf(this),i=xf(e,t),r=new Sd(Td(e),_d(e),Id(e)),n=Ed.apply(void 0,[r].concat(df([].slice.call(arguments)))),o=new i(Td(n),_d(n),Id(n));return Af(o),o},r.indexOf=function(e){Df(this);var t=Cf(this),i=Id(t),r=_f([].slice.call(arguments,1)[0]);if(r===1/0)return-1;r<0&&(r+=i)<0&&(r=0);for(var n=r;n<i;++n)if(Ku(t,n)&&uf(t[n])===e)return n;return-1},r.lastIndexOf=function(e){var t=[].slice.call(arguments,1);Df(this);var i=Cf(this),r=Id(i),n=t.length>=1?_f(t[0]):r-1;if(n===-1/0)return-1;n>=0?n=n<r-1?n:r-1:n+=r;for(var o=n;o>=0;--o)if(Ku(i,o)&&uf(i[o])===e)return o;return-1},r.includes=function(e){Df(this);var t=Cf(this),i=Id(t),r=_f([].slice.call(arguments,1)[0]);if(r===1/0)return!1;r<0&&(r+=i)<0&&(r=0);for(var n=ku(e),o=r;o<i;++o){var s=uf(t[o]);if(n&&ku(s))return!0;if(s===e)return!0}return!1},r.join=function(){Df(this);var e=kf(Cf(this));return Qu.apply(void 0,[e].concat(df([].slice.call(arguments))))},r.toLocaleString=function(){Df(this);var e=kf(Cf(this));return $u.apply(void 0,[e].concat(df([].slice.call(arguments))))},i(t,[{key:Fu,get:function(){if(Rf(this))return"Float16Array"}}]),t}();Gu(Gf,"BYTES_PER_ELEMENT",{value:2}),Gu(Gf,Of,{}),Ru(Gf,ld);var Hf=Gf.prototype;Gu(Hf,"BYTES_PER_ELEMENT",{value:2}),Gu(Hf,Bu,{value:Hf.values,writable:!0,configurable:!0}),Ru(Hf,ud);var Xf=new Bh({textureWidth:0,textureHeight:0});function Wf(e){e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}var Yf=function(){this.positionsDecompressMatrices=void 0,this.positionsCompressed=void 0,this.indices_8Bits=void 0,this.indices_16Bits=void 0,this.indices_32Bits=void 0,this.edgeIndices_8Bits=void 0,this.edgeIndices_16Bits=void 0,this.edgeIndices_32Bits=void 0,this.eachPrimitiveMesh_8Bits=void 0,this.eachPrimitiveMesh_16Bits=void 0,this.eachPrimitiveMesh_32Bits=void 0,this.eachEdgeMesh_8Bits=void 0,this.eachEdgeMesh_16Bits=void 0,this.eachEdgeMesh_32Bits=void 0,this.eachMeshVertexPortionBase=void 0,this.eachMeshVertexPortionOffset=void 0,this.eachMeshEdgeIndicesOffset=void 0,this.eachMeshColor=void 0,this.eachMeshPickColor=void 0,this.eachMeshMatrices=void 0,this.eachMeshNormalMatrix=void 0,this.eachMeshPositionsDecompressMatrix=void 0,this.eachMeshFlags1=void 0,this.eachMeshFlags2=void 0,this.eachEdgeOffset=void 0,this.eachMeshParts=void 0,this.positionsDecompressMatrices=[],this.positionsCompressed=[],this.indices_8Bits=[],this.indices_16Bits=[],this.indices_32Bits=[],this.edgeIndices_8Bits=[],this.edgeIndices_16Bits=[],this.edgeIndices_32Bits=[],this.eachMeshVertexPortionBase=[],this.eachMeshVertexPortionOffset=[],this.eachMeshEdgeIndicesOffset=[],this.eachMeshColor=[],this.eachMeshPickColor=[],this.eachMeshMatrices=[],this.eachMeshNormalMatrix=[],this.eachMeshPositionsDecompressMatrix=[],this.eachMeshFlags1=[],this.eachMeshFlags2=[],this.eachPrimitiveMesh_32Bits=[],this.eachPrimitiveMesh_16Bits=[],this.eachPrimitiveMesh_8Bits=[],this.eachEdgeMesh_32Bits=[],this.eachEdgeMesh_16Bits=[],this.eachEdgeMesh_8Bits=[],this.eachEdgeOffset=[],this.eachMeshParts=[]},Kf=8,zf=ri(),qf=Pt([0,0,0,1]),Zf=Pt([0,0,0,1]),Qf=new Uint8Array(4),Jf=new Float32Array(3),$f=/*#__PURE__*/d("gl"),ev=/*#__PURE__*/d("view"),tv=/*#__PURE__*/d("dataTextureBuffer"),iv=/*#__PURE__*/d("geometryHandles"),rv=/*#__PURE__*/d("meshPartHandles"),nv=/*#__PURE__*/d("numMeshParts"),ov=/*#__PURE__*/d("deferredSetFlagsActive"),sv=/*#__PURE__*/d("deferredSetFlagsDirty"),av=/*#__PURE__*/d("built"),cv=/*#__PURE__*/d("createGeometryBucket"),lv=/*#__PURE__*/d("createMeshPart"),hv=/*#__PURE__*/d("setMeshFlags"),uv=/*#__PURE__*/d("setMeshFlags2"),dv=/*#__PURE__*/function(){function e(e,t){Object.defineProperty(this,uv,{value:yv}),Object.defineProperty(this,hv,{value:pv}),Object.defineProperty(this,lv,{value:vv}),Object.defineProperty(this,cv,{value:fv}),this.rendererModel=void 0,this.layerIndex=void 0,this.meshCounts=void 0,this.renderState=void 0,Object.defineProperty(this,$f,{writable:!0,value:void 0}),Object.defineProperty(this,ev,{writable:!0,value:void 0}),Object.defineProperty(this,tv,{writable:!0,value:void 0}),Object.defineProperty(this,iv,{writable:!0,value:void 0}),Object.defineProperty(this,rv,{writable:!0,value:void 0}),Object.defineProperty(this,nv,{writable:!0,value:void 0}),Object.defineProperty(this,ov,{writable:!0,value:void 0}),Object.defineProperty(this,sv,{writable:!0,value:void 0}),Object.defineProperty(this,av,{writable:!0,value:void 0}),this.meshCounts=new bu,this.layerIndex=e.layerIndex,this.rendererModel=e.rendererModel,this.renderState={primitive:e.primitive,dataTextureSet:new mu,numIndices8Bits:0,numIndices16Bits:0,numIndices32Bits:0,numEdgeIndices8Bits:0,numEdgeIndices16Bits:0,numEdgeIndices32Bits:0,numVertices:0},f(this,$f)[$f]=e.gl,f(this,ev)[ev]=e.view,f(this,tv)[tv]=new Yf,f(this,nv)[nv]=0,f(this,iv)[iv]={},f(this,rv)[rv]=[],f(this,av)[av]=!1,this.beginDeferredFlags()}var t=e.prototype;return t.canCreateMesh=function(e){if(f(this,av)[av])throw"Already built";var t=this.renderState,i=e.geometryBuckets.length;if(f(this,nv)[nv]+i>4096)return!1;for(var r=0,n=0,o=0;o<i;o++){var s=e.geometryBuckets[o];r+=s.positionsCompressed.length,s.indices&&(n+=s.indices.length)}return t.numVertices+r/(e.primitive===Ke?1:e.primitive==ze?2:3)<=2097152&&n/3+n<=2097152},t.hasGeometry=function(e){return f(this,iv)[iv][e]},t.createGeometryCompressed=function(e){if(f(this,av)[av])throw"Already built";for(var t=[],i=0,r=e.geometryBuckets.length;i<r;i++)t.push(f(this,cv)[cv](e.geometryBuckets[i]));f(this,iv)[iv][e.id]={id:e.id,aabb:e.aabb,positionsDecompressMatrix:e.positionsDecompressMatrix,geometryBucketHandles:t}},t.createMesh=function(e){var t=this;if(f(this,av)[av])throw new Error("Already built");var i=this.meshCounts.numMeshes;if(!e.geometryId)throw new Error("geometryId expected");var r=f(this,iv)[iv][e.geometryId];if(!r)throw new Error("Geometry not found");r.geometryBucketHandles.forEach(function(i){f(t,lv)[lv](e,r,i)});for(var n=jr(),o=Rr(r.aabb),s=0,a=o.length;s<a;s+=4)qf[0]=o[s+0],qf[1]=o[s+1],qf[2]=o[s+2],e.matrix?(fi(e.matrix,qf,Zf),Ar(n,Zf)):Ar(n,Zf);return this.meshCounts.numMeshes++,i},t.build=function(){if(f(this,av)[av])throw new Error("Already built");var e=f(this,$f)[$f],t=f(this,tv)[tv],i=this.renderState.dataTextureSet;i.positions=function(e,t){var i=1024,r=Math.ceil(t.length/3/i);if(0==r)throw"texture height == 0";var n=new Uint16Array(i*r*3);n.fill(0),n.set(t,0);var o=e.createTexture();return e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGB16UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RGB_INTEGER,e.UNSIGNED_SHORT,n,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new Bh({gl:e,texture:o,textureWidth:i,textureHeight:r})}(e,t.positionsCompressed),i.indices_8Bits=function(e,t){if(0==t.length)return Xf;var i=1024,r=Math.ceil(t.length/3/i);if(0==r)throw"texture height == 0";var n=new Uint8Array(i*r*3);n.fill(0),n.set(t,0);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGB8UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RGB_INTEGER,e.UNSIGNED_BYTE,n,0),Wf(e),e.bindTexture(e.TEXTURE_2D,null),new Bh({gl:e,texture:o,textureWidth:i,textureHeight:r})):Xf}(e,t.indices_8Bits),i.indices_16Bits=function(e,t){if(0==t.length)return Xf;var i=1024,r=Math.ceil(t.length/3/i);if(0==r)throw"texture height == 0";var n=new Uint16Array(i*r*3);n.fill(0),n.set(t,0);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGB16UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RGB_INTEGER,e.UNSIGNED_SHORT,n,0),Wf(e),e.bindTexture(e.TEXTURE_2D,null),new Bh({gl:e,texture:o,textureWidth:i,textureHeight:r})):Xf}(e,t.indices_16Bits),i.indices_32Bits=function(e,t){if(0==t.length)return Xf;var i=1024,r=Math.ceil(t.length/3/i);if(0==r)throw"texture height == 0";var n=new Uint32Array(i*r*3);n.fill(0),n.set(t,0);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGB32UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RGB_INTEGER,e.UNSIGNED_INT,n,0),Wf(e),e.bindTexture(e.TEXTURE_2D,null),new Bh({gl:e,texture:o,textureWidth:i,textureHeight:r})):Xf}(e,t.indices_32Bits),i.edgeIndices_8Bits=function(e,t){if(0==t.length)return Xf;var i=1024,r=Math.ceil(t.length/2/i);if(0==r)throw"texture height == 0";var n=new Uint8Array(i*r*2);n.fill(0),n.set(t,0);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RG8UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RG_INTEGER,e.UNSIGNED_BYTE,n,0),Wf(e),e.bindTexture(e.TEXTURE_2D,null),new Bh({gl:e,texture:o,textureWidth:i,textureHeight:r})):Xf}(e,t.edgeIndices_8Bits),i.edgeIndices_16Bits=function(e,t){if(0==t.length)return Xf;var i=1024,r=Math.ceil(t.length/2/i);if(0==r)throw"texture height == 0";var n=new Uint16Array(i*r*2);n.fill(0),n.set(t,0);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RG16UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RG_INTEGER,e.UNSIGNED_SHORT,n,0),Wf(e),e.bindTexture(e.TEXTURE_2D,null),new Bh({gl:e,texture:o,textureWidth:i,textureHeight:r})):Xf}(e,t.edgeIndices_16Bits),i.edgeIndices_32Bits=function(e,t){if(0==t.length)return Xf;var i=1024,r=Math.ceil(t.length/2/i);if(0==r)throw"texture height == 0";var n=new Uint32Array(i*r*2);n.fill(0),n.set(t,0);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RG32UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RG_INTEGER,e.UNSIGNED_INT,n,0),Wf(e),e.bindTexture(e.TEXTURE_2D,null),new Bh({gl:e,texture:o,textureWidth:i,textureHeight:r})):Xf}(e,t.edgeIndices_32Bits),i.eachMeshAttributes=function(e,t,i,r,n,o){var s=t.length;if(0==s)throw"texture height == 0";for(var a=new Uint8Array(32*s),c=0;c<s;c++)a.set(t[c],28*c+0),a.set(i[c],28*c+4),a.set([0,0,0,0],28*c+8),a.set([0,0,0,0],28*c+12),a.set([r[c]>>24&255,r[c]>>16&255,r[c]>>8&255,255&r[c]],28*c+16),a.set([n[c]>>24&255,n[c]>>16&255,n[c]>>8&255,255&n[c]],28*c+20),a.set([o[c]>>24&255,o[c]>>16&255,o[c]>>8&255,255&o[c]],28*c+24);var l=e.createTexture();return l?(e.bindTexture(e.TEXTURE_2D,l),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA8UI,8,s),e.texSubImage2D(e.TEXTURE_2D,0,0,0,8,s,e.RGBA_INTEGER,e.UNSIGNED_BYTE,a,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new Bh({gl:e,texture:l,textureWidth:8,textureHeight:s,textureData:a})):Xf}(e,t.eachMeshColor,t.eachMeshPickColor,t.eachMeshVertexPortionBase,t.eachMeshVertexPortionOffset,t.eachMeshEdgeIndicesOffset),i.eachMeshMatrices=function(e,t,i){var r=t.length;if(0==r)throw"texture height == 0";for(var n=new Gf(48*r),o=0;o<t.length;o++)n.set(t[o],48*o),n.set(i[o],48*o+16);var s=e.createTexture();return s?(e.bindTexture(e.TEXTURE_2D,s),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA16F,12,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,12,r,e.RGBA,e.HALF_FLOAT,new Uint16Array(n.buffer),0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new Bh({gl:e,texture:s,textureWidth:12,textureHeight:r})):Xf}(e,t.eachMeshPositionsDecompressMatrix,t.eachMeshMatrices),i.eachEdgeOffset=function(e,t){var i=t.length;if(0==i)throw"texture height == 0";for(var r=new Float32Array(3*i),n=0;n<t.length;n++)r.set(t[n],3*n);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGB32F,1,i),e.texSubImage2D(e.TEXTURE_2D,0,0,0,1,i,e.RGB,e.FLOAT,r,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new Bh({gl:e,texture:o,textureWidth:1,textureHeight:i,textureData:r})):Xf}(e,t.eachEdgeOffset),i.build(),f(this,tv)[tv]=null,f(this,iv)[iv]={},f(this,rv)[rv]=[],f(this,av)[av]=!0},t.isEmpty=function(){return 0==this.meshCounts.numMeshes},t.initFlags=function(e,t,i){t&gu.VISIBLE&&this.meshCounts.numVisible++,t&gu.HIGHLIGHTED&&this.meshCounts.numHighlighted++,t&gu.XRAYED&&this.meshCounts.numXRayed++,t&gu.SELECTED&&this.meshCounts.numSelected++,t&gu.CLIPPABLE&&this.meshCounts.numClippable++,t&gu.EDGES&&this.meshCounts.numEdges++,t&gu.PICKABLE&&this.meshCounts.numPickable++,t&gu.CULLED&&this.meshCounts.numCulled++,i&&this.meshCounts.numTransparent++,f(this,hv)[hv](e,t,i),f(this,uv)[uv](e,t)},t.beginDeferredFlags=function(){f(this,ov)[ov]=!0},t.commitDeferredFlags=function(){if(f(this,ov)[ov]=!1,f(this,sv)[sv]){f(this,sv)[sv]=!1;var e=f(this,$f)[$f],t=this.renderState.dataTextureSet;e.bindTexture(e.TEXTURE_2D,t.eachMeshAttributes.texture),e.texSubImage2D(e.TEXTURE_2D,0,0,0,t.eachMeshAttributes.textureWidth,t.eachMeshAttributes.textureHeight,e.RGBA_INTEGER,e.UNSIGNED_BYTE,t.eachMeshAttributes.textureData),e.bindTexture(e.TEXTURE_2D,t.eachEdgeOffset.texture),e.texSubImage2D(e.TEXTURE_2D,0,0,0,t.eachEdgeOffset.textureWidth,t.eachEdgeOffset.textureHeight,e.RGB,e.FLOAT,t.eachEdgeOffset.textureData)}},t.flushInitFlags=function(){this.commitDeferredFlags()},t.setMeshVisible=function(e,t,i){if(!f(this,av)[av])throw"Not built";t&gu.VISIBLE?this.meshCounts.numVisible++:this.meshCounts.numVisible--,f(this,hv)[hv](e,t,i)},t.setMeshHighlighted=function(e,t,i){if(!f(this,av)[av])throw"Not built";t&gu.HIGHLIGHTED?this.meshCounts.numHighlighted++:this.meshCounts.numHighlighted--,f(this,hv)[hv](e,t,i)},t.setMeshXRayed=function(e,t,i){if(!f(this,av)[av])throw"Not built";t&gu.XRAYED?this.meshCounts.numXRayed++:this.meshCounts.numXRayed--,f(this,hv)[hv](e,t,i)},t.setMeshSelected=function(e,t,i){if(!f(this,av)[av])throw"Not built";t&gu.SELECTED?this.meshCounts.numSelected++:this.meshCounts.numSelected--,f(this,hv)[hv](e,t,i)},t.setMeshEdges=function(e,t,i){if(!f(this,av)[av])throw"Not built";t&gu.EDGES?this.meshCounts.numEdges++:this.meshCounts.numEdges--,f(this,hv)[hv](e,t,i)},t.setMeshClippable=function(e,t){if(!f(this,av)[av])throw"Not built";t&gu.CLIPPABLE?this.meshCounts.numClippable++:this.meshCounts.numClippable--,f(this,uv)[uv](e,t)},t.setMeshCulled=function(e,t,i){if(!f(this,av)[av])throw"Not built";t&gu.CULLED?this.meshCounts.numCulled++:this.meshCounts.numCulled--,f(this,hv)[hv](e,t,i)},t.setMeshCollidable=function(e,t){if(!f(this,av)[av])throw"Not built"},t.setMeshPickable=function(e,t,i){if(!f(this,av)[av])throw"Not built";t&gu.PICKABLE?this.meshCounts.numPickable++:this.meshCounts.numPickable--,f(this,hv)[hv](e,t,i)},t.setMeshColor=function(e,t,i){if(!f(this,av)[av])throw"Not built";var r=this.renderState.dataTextureSet,n=f(this,$f)[$f];Qf[0]=t[0],Qf[1]=t[1],Qf[2]=t[2],Qf[3]=t[3],r.eachMeshAttributes.textureData.set(Qf,28*e),f(this,ov)[ov]?f(this,sv)[sv]=!0:(n.bindTexture(n.TEXTURE_2D,r.eachMeshAttributes.texture),n.texSubImage2D(n.TEXTURE_2D,0,0,e,1,1,n.RGBA_INTEGER,n.UNSIGNED_BYTE,Qf))},t.setMeshTransparent=function(e,t,i){if(!f(this,av)[av])throw"Not built";i?(this.meshCounts.numTransparent++,this.meshCounts.numTransparent++):(this.meshCounts.numTransparent--,this.meshCounts.numTransparent--),f(this,hv)[hv](e,t,i)},t.setMeshOffset=function(e,t){if(!f(this,av)[av])throw"Not built";var i=f(this,$f)[$f];Jf[0]=t[0],Jf[1]=t[1],Jf[2]=t[2],f(this,ov)[ov]?f(this,sv)[sv]=!0:i.texSubImage2D(i.TEXTURE_2D,0,0,e,1,1,i.RGB,i.FLOAT,Jf)},t.setMeshMatrix=function(e,t){if(!f(this,av)[av])throw"Not built";f(this,$f),f(this,ov)[ov]&&(f(this,sv)[sv]=!0)},t.setMeshViewMatrixIndex=function(e,t){if(!f(this,av)[av])throw"Not built";f(this,$f),f(this,ov)[ov]&&(f(this,sv)[sv]=!0)},t.destroy=function(){this.renderState.dataTextureSet.destroy()},i(e,[{key:"hash",get:function(){return"layer-"+this.renderState.primitive}}]),e}();function fv(e){var t=this.renderState;if(e.indices){var i=this.renderState.primitive===Ke?1:this.renderState.primitive===ze?2:3,r=Math.ceil(e.indices.length/i/Kf)*Kf*i,n=new Uint32Array(r);n.fill(0),n.set(e.indices),e.indices=n}if(e.edgeIndices){var o=Math.ceil(e.edgeIndices.length/2/Kf)*Kf*2,s=new Uint32Array(o);s.fill(0),s.set(e.edgeIndices),e.edgeIndices=s}for(var a,c=f(this,tv)[tv],l=e.positionsCompressed,h=e.indices,u=e.edgeIndices,d=c.positionsCompressed.length/3,v=l.length/3,p=0,y=l.length;p<y;p++)c.positionsCompressed.push(l[p]);var m,b=0;if(h){var g;b=h.length/3,a=(g=v<=256?c.indices_8Bits:v<=65536?c.indices_16Bits:c.indices_32Bits).length/3;for(var w=0,P=h.length;w<P;w++)g.push(h[w])}var E=0;if(u){var T;E=u.length/2,m=(T=v<=256?c.edgeIndices_8Bits:v<=65536?c.edgeIndices_16Bits:c.edgeIndices_32Bits).length/2;for(var _=0,I=u.length;_<I;_++)T.push(u[_])}return t.numVertices+=v,{vertexBase:d,numVertices:v,numTriangles:b,numEdges:E,indicesBase:a,edgeIndicesBase:m}}function vv(e,t,i){var r,n=f(this,tv)[tv],o=this.renderState,s=e.matrix||zf,a=e.color||[255,255,255],c=n.positionsCompressed.length/3;n.eachMeshPositionsDecompressMatrix.push(t.positionsDecompressMatrix),n.eachMeshMatrices.push(s),n.eachMeshColor.push([a[0],a[1],a[2],255]),n.eachMeshPickColor.push(e.pickColor),r=i.numVertices<=256?o.numIndices8Bits:i.numVertices<=65536?o.numIndices16Bits:o.numIndices32Bits,n.eachMeshVertexPortionBase.push(i.vertexBase),n.eachMeshVertexPortionOffset.push(r/3-i.indicesBase),n.eachMeshEdgeIndicesOffset.push((i.numVertices<=256?o.numEdgeIndices8Bits:i.numVertices<=65536?o.numEdgeIndices16Bits:o.numEdgeIndices32Bits)/2-i.edgeIndicesBase);var l=f(this,rv)[rv].length;if(i.numTriangles>0){var h,u=3*i.numTriangles;i.numVertices<=256?(h=n.eachPrimitiveMesh_8Bits,o.numIndices8Bits+=u):i.numVertices<=65536?(h=n.eachPrimitiveMesh_16Bits,o.numIndices16Bits+=u):(h=n.eachPrimitiveMesh_32Bits,o.numIndices32Bits+=u);for(var d=0;d<i.numTriangles;d+=Kf)h.push(l)}if(i.numEdges>0){var v,p=2*i.numEdges;i.numVertices<=256?(v=n.eachEdgeMesh_8Bits,o.numEdgeIndices8Bits+=p):i.numVertices<=65536?(v=n.eachEdgeMesh_16Bits,o.numEdgeIndices16Bits+=p):(v=n.eachEdgeMesh_32Bits,o.numEdgeIndices32Bits+=p);for(var y=0;y<i.numEdges;y+=Kf)v.push(l)}return n.eachEdgeOffset.push([0,0,0]),f(this,rv)[rv].push({vertsBase:c,numVerts:i.numTriangles}),f(this,nv)[nv]++,l}function pv(e,t,i){if(!f(this,av)[av])throw"Not built";var r,n,o,s=!!(t&gu.VISIBLE),a=!!(t&gu.XRAYED),c=!!(t&gu.HIGHLIGHTED),l=!!(t&gu.SELECTED),h=!!(t&gu.CULLED);r=!s||h||a?Jh.NOT_RENDERED:i?Jh.COLOR_TRANSPARENT:Jh.COLOR_OPAQUE,n=!s||h?Jh.NOT_RENDERED:l?Jh.SILHOUETTE_SELECTED:c?Jh.SILHOUETTE_HIGHLIGHTED:a?Jh.SILHOUETTE_XRAYED:Jh.NOT_RENDERED,o=!s||h?Jh.NOT_RENDERED:l?Jh.EDGES_SELECTED:c?Jh.EDGES_HIGHLIGHTED:a?Jh.EDGES_XRAYED:t&gu.EDGES?i?Jh.EDGES_COLOR_TRANSPARENT:Jh.EDGES_COLOR_OPAQUE:Jh.NOT_RENDERED;var u=s&&!h&&t&gu.PICKABLE?Jh.PICK:Jh.NOT_RENDERED,d=this.renderState.dataTextureSet,v=f(this,$f)[$f];if(Qf[0]=r,Qf[1]=n,Qf[2]=o,Qf[3]=u,f(this,ov)[ov])return d.eachMeshAttributes.textureData.set(Qf,28*e+8),void(f(this,sv)[sv]=!0);v.bindTexture(v.TEXTURE_2D,d.eachMeshAttributes.texture),v.texSubImage2D(v.TEXTURE_2D,0,2,e,1,1,v.RGBA_INTEGER,v.UNSIGNED_BYTE,Qf)}function yv(e,t){if(!f(this,av)[av])throw"Not built";var i=t&gu.CLIPPABLE?255:0,r=this.renderState.dataTextureSet,n=f(this,$f)[$f];if(Qf[0]=i,Qf[1]=0,Qf[2]=1,Qf[3]=2,f(this,ov)[ov])return r.eachMeshAttributes.textureData.set(Qf,28*e+12),void(f(this,sv)[sv]=!0);n.bindTexture(n.TEXTURE_2D,r.eachMeshAttributes.texture),n.texSubImage2D(n.TEXTURE_2D,0,3,e,1,1,n.RGBA_INTEGER,n.UNSIGNED_BYTE,Qf)}var mv=function(){},bv=/*#__PURE__*/function(){function e(e,t){this.texture=void 0,this.texture2D=void 0,this.texture=e,this.texture2D=t}return e.prototype.destroy=function(){this.texture2D&&this.texture2D.destroy()},e}(),gv=new Uint16Array([0,0,0]),wv=/*#__PURE__*/d("flags"),Pv=/*#__PURE__*/d("aabb"),Ev=/*#__PURE__*/d("offsetAABB"),Tv=/*#__PURE__*/d("offset"),_v=/*#__PURE__*/d("colorizeUpdated"),Iv=/*#__PURE__*/d("opacityUpdated"),xv=/*#__PURE__*/function(){function e(e){this.id=void 0,this.rendererModel=void 0,this.sceneObject=void 0,this.layerId=void 0,this.rendererMeshes=void 0,Object.defineProperty(this,wv,{writable:!0,value:void 0}),Object.defineProperty(this,Pv,{writable:!0,value:void 0}),Object.defineProperty(this,Ev,{writable:!0,value:void 0}),Object.defineProperty(this,Tv,{writable:!0,value:void 0}),Object.defineProperty(this,_v,{writable:!0,value:void 0}),Object.defineProperty(this,Iv,{writable:!0,value:void 0}),this.id=e.id,this.sceneObject=e.sceneObject,this.rendererModel=e.rendererModel,this.rendererMeshes=e.rendererMeshes||[],f(this,wv)[wv]=0,f(this,Pv)[Pv]=e.aabb,f(this,Ev)[Ev]=Er(e.aabb),f(this,Tv)[Tv]=wt(),f(this,_v)[_v]=!1,f(this,Iv)[Iv]=!1,this.layerId=e.layerId||null;for(var t=0,i=this.rendererMeshes.length;t<i;t++)this.rendererMeshes[t].setRendererObject(this)}var t=e.prototype;return t.setVisible=function(e,t){if(!!(f(this,wv)[wv]&gu.VISIBLE)!==t){f(this,wv)[wv]=t?f(this,wv)[wv]|gu.VISIBLE:f(this,wv)[wv]&~gu.VISIBLE;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setVisible(f(this,wv)[wv])}},t.setHighlighted=function(e,t){if(!!(f(this,wv)[wv]&gu.HIGHLIGHTED)!==t){f(this,wv)[wv]=t?f(this,wv)[wv]|gu.HIGHLIGHTED:f(this,wv)[wv]&~gu.HIGHLIGHTED;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setHighlighted(f(this,wv)[wv])}},t.setXRayed=function(e,t){if(!!(f(this,wv)[wv]&gu.XRAYED)!==t){f(this,wv)[wv]=t?f(this,wv)[wv]|gu.XRAYED:f(this,wv)[wv]&~gu.XRAYED;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setXRayed(f(this,wv)[wv])}},t.setSelected=function(e,t){if(!!(f(this,wv)[wv]&gu.SELECTED)!==t){f(this,wv)[wv]=t?f(this,wv)[wv]|gu.SELECTED:f(this,wv)[wv]&~gu.SELECTED;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setSelected(f(this,wv)[wv])}},t.setEdges=function(e,t){if(!!(f(this,wv)[wv]&gu.EDGES)!==t){f(this,wv)[wv]=t?f(this,wv)[wv]|gu.EDGES:f(this,wv)[wv]&~gu.EDGES;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setEdges(f(this,wv)[wv])}},t.setCulled=function(e,t){if(!!(f(this,wv)[wv]&gu.CULLED)!==t){f(this,wv)[wv]=t?f(this,wv)[wv]|gu.CULLED:f(this,wv)[wv]&~gu.CULLED;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setCulled(f(this,wv)[wv])}},t.setClippable=function(e,t){if(!!(f(this,wv)[wv]&gu.CLIPPABLE)!==t){f(this,wv)[wv]=t?f(this,wv)[wv]|gu.CLIPPABLE:f(this,wv)[wv]&~gu.CLIPPABLE;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setClippable(f(this,wv)[wv])}},t.setCollidable=function(e,t){if(!!(f(this,wv)[wv]&gu.COLLIDABLE)!==t){f(this,wv)[wv]=t?f(this,wv)[wv]|gu.COLLIDABLE:f(this,wv)[wv]&~gu.COLLIDABLE;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setCollidable(f(this,wv)[wv])}},t.setPickable=function(e,t){if(!!(f(this,wv)[wv]&gu.PICKABLE)!==t){f(this,wv)[wv]=t?f(this,wv)[wv]|gu.PICKABLE:f(this,wv)[wv]&~gu.PICKABLE;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setPickable(f(this,wv)[wv])}},t.setColorize=function(e,t){if(t){gv[0]=Math.floor(255*t[0]),gv[1]=Math.floor(255*t[1]),gv[2]=Math.floor(255*t[2]);for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setColorize(gv)}else for(var n=0,o=this.rendererMeshes.length;n<o;n++)this.rendererMeshes[n].setColorize(null)},t.setOpacity=function(e,t){if(0!==this.rendererMeshes.length){var i=this.rendererMeshes[0].colorize[3],r=255;if(null!=t){if(t<0?t=0:t>1&&(t=1),i===(r=Math.floor(255*t)))return}else if(i===(r=255))return;for(var n=0,o=this.rendererMeshes.length;n<o;n++)this.rendererMeshes[n].setOpacity(r,f(this,wv)[wv])}},t.setOffset=function(e,t){},t.build=function(){for(var e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].build(f(this,wv)[wv])},t.build2=function(){for(var e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].build2()},t.destroy=function(){for(var e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].destroy()},i(e,[{key:"aabb",get:function(){return f(this,Ev)[Ev]}}]),e}(),Sv=Zt(),Mv=Zt(),Ov=/*#__PURE__*/function(){function e(e){this.id=void 0,this.color=void 0,this.rendererGeometry=void 0,this.rendererTextureSet=void 0,this.matrix=void 0,this.metallic=void 0,this.roughness=void 0,this.opacity=void 0,this.pickId=void 0,this.tileManager=void 0,this.tile=void 0,this.sceneObjectRenderer=void 0,this.aabb=void 0,this.layer=void 0,this.meshIndex=void 0,this.colorize=void 0,this.colorizing=void 0,this.transparent=void 0,this.sceneObjectRenderer=null,this.tileManager=e.tileManager,this.id=e.id,this.pickId=0,this.color=[e.color[0],e.color[1],e.color[2],e.opacity],this.colorize=[e.color[0],e.color[1],e.color[2],e.opacity],this.colorizing=!1,this.transparent=e.opacity<255,this.layer=e.layer,this.matrix=e.matrix,this.metallic=e.metallic,this.roughness=e.roughness,this.opacity=e.opacity,this.aabb=Er(),this.rendererTextureSet=e.rendererTextureSet,this.rendererGeometry=e.rendererGeometry,this.meshIndex=e.meshIndex}var t=e.prototype;return t.delegatePickedEntity=function(){throw new Error("Method not implemented.")},t.setRendererObject=function(e){this.sceneObjectRenderer=e},t.build=function(e){this.layer.initFlags(this.meshIndex,e,this.transparent)},t.build2=function(){this.layer.flushInitFlags()},t.setVisible=function(e){this.layer.setMeshVisible(this.meshIndex,e,this.transparent)},t.setMatrix=function(e){var t=di(e,[0,0,0]),i=this.tile;this.tile=i?this.tileManager.updateTileCenter(i,t):this.tileManager.getTile(t);var r=!i||i.id!==this.tile.id,n=this.tile.center;this.layer.setMeshMatrix(this.meshIndex,0!==n[0]||0!==n[1]||0!==n[2]?hi(e,Oi(-n[0],-n[1],-n[2],Sv),Mv):e),r&&this.layer.setMeshViewMatrixIndex(this.meshIndex,this.tile.index)},t.setMetallic=function(e){},t.setRoughness=function(e){},t.setColor=function(e){this.color[0]=e[0],this.color[1]=e[1],this.color[2]=e[2],this.colorizing||this.layer.setMeshColor(this.meshIndex,this.color)},t.setColorize=function(e){e?(this.colorize[0]=e[0],this.colorize[1]=e[1],this.colorize[2]=e[2],this.layer.setMeshColor(this.meshIndex,this.colorize,!1),this.colorizing=!0):(this.layer.setMeshColor(this.meshIndex,this.color,!1),this.colorizing=!1)},t.setOpacity=function(e,t){var i=e<255,r=this.transparent!==i;this.color[3]=e,this.colorize[3]=e,this.transparent=i,this.layer.setMeshColor(this.meshIndex,this.colorizing?this.colorize:this.color),r&&this.layer.setMeshTransparent(this.meshIndex,t,i)},t.setHighlighted=function(e){this.layer.setMeshHighlighted(this.meshIndex,e,this.transparent)},t.setXRayed=function(e){this.layer.setMeshXRayed(this.meshIndex,e,this.transparent)},t.setSelected=function(e){this.layer.setMeshSelected(this.meshIndex,e,this.transparent)},t.setEdges=function(e){this.layer.setMeshEdges(this.meshIndex,e,this.transparent)},t.setClippable=function(e){this.layer.setMeshClippable(this.meshIndex,e)},t.setCollidable=function(e){this.layer.setMeshCollidable(this.meshIndex,e)},t.setPickable=function(e){this.layer.setMeshPickable(this.meshIndex,e,this.transparent)},t.setCulled=function(e){this.layer.setMeshCulled(this.meshIndex,e,this.transparent)},t.canPickTriangle=function(){return!1},t.drawPickTriangles=function(e,t){},t.pickTriangleSurface=function(e){},t.canPickWorldPos=function(){return!0},t.drawPickNormals=function(e){},t.destroy=function(){this.tile&&this.tileManager&&this.tileManager.putTile(this.tile)},e}(),jv=function(e){this.id=void 0,this.colorTexture=void 0,this.metallicRoughnessTexture=void 0,this.emissiveTexture=void 0,this.occlusionTexture=void 0,this.id=e.id,this.colorTexture=e.colorTexture,this.metallicRoughnessTexture=e.metallicRoughnessTexture,this.emissiveTexture=e.emissiveTexture,this.occlusionTexture=e.occlusionTexture};Ai();var Rv="defaultTextureSet",Dv=/*#__PURE__*/d("view"),Av=/*#__PURE__*/d("webglRenderer"),Cv=/*#__PURE__*/d("renderContext"),kv=/*#__PURE__*/d("position"),Bv=/*#__PURE__*/d("rotation"),Lv=/*#__PURE__*/d("quaternion"),Fv=/*#__PURE__*/d("scale"),Uv=/*#__PURE__*/d("worldMatrix"),Nv=/*#__PURE__*/d("viewMatrix"),Vv=/*#__PURE__*/d("colorTextureEnabled"),Gv=/*#__PURE__*/d("backfaces"),Hv=/*#__PURE__*/d("layers"),Xv=/*#__PURE__*/d("numGeometries"),Wv=/*#__PURE__*/d("numTriangles"),Yv=/*#__PURE__*/d("numLines"),Kv=/*#__PURE__*/d("numPoints"),zv=/*#__PURE__*/d("numRendererObjects"),qv=/*#__PURE__*/d("textureTranscoder"),Zv=/*#__PURE__*/d("aabbDirty"),Qv=/*#__PURE__*/d("edgeThreshold"),Jv=/*#__PURE__*/d("currentLayers"),$v=/*#__PURE__*/d("aabb"),ep=/*#__PURE__*/d("viewMatrixDirty"),tp=/*#__PURE__*/d("worldMatrixNonIdentity"),ip=/*#__PURE__*/d("onCameraViewMatrix"),rp=/*#__PURE__*/d("layerId"),np=/*#__PURE__*/d("attachSceneModel"),op=/*#__PURE__*/d("attachTexture"),sp=/*#__PURE__*/d("attachGeometry"),ap=/*#__PURE__*/d("attachMesh"),cp=/*#__PURE__*/d("getLayer"),lp=/*#__PURE__*/d("attachSceneObject"),hp=/*#__PURE__*/d("createDefaultTextureSet"),up=/*#__PURE__*/d("rebuildAABB"),dp=/*#__PURE__*/d("detachSceneModel"),fp=/*#__PURE__*/function(e){function t(t){var i;i=e.call(this,t.view)||this,Object.defineProperty(c(i),dp,{value:Ep}),Object.defineProperty(c(i),up,{value:Pp}),Object.defineProperty(c(i),hp,{value:wp}),Object.defineProperty(c(i),lp,{value:gp}),Object.defineProperty(c(i),cp,{value:bp}),Object.defineProperty(c(i),ap,{value:mp}),Object.defineProperty(c(i),sp,{value:yp}),Object.defineProperty(c(i),op,{value:pp}),Object.defineProperty(c(i),np,{value:vp}),i.qualityRender=void 0,i.sceneModel=void 0,i.rendererGeometries=void 0,i.rendererTextures=void 0,i.rendererTextureSets=void 0,i.rendererMeshes=void 0,i.rendererObjects=void 0,i.rendererObjectsList=void 0,i.rendererViewObjects=void 0,i.viewer=void 0,i.layerList=void 0,i.onBuilt=void 0,Object.defineProperty(c(i),Dv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Av,{writable:!0,value:void 0}),Object.defineProperty(c(i),Cv,{writable:!0,value:void 0}),Object.defineProperty(c(i),kv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Bv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Lv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Fv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Uv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Nv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Vv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Gv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Hv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Xv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Wv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Yv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Kv,{writable:!0,value:void 0}),Object.defineProperty(c(i),zv,{writable:!0,value:void 0}),Object.defineProperty(c(i),qv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Zv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Qv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Jv,{writable:!0,value:void 0}),Object.defineProperty(c(i),$v,{writable:!0,value:void 0}),Object.defineProperty(c(i),ep,{writable:!0,value:void 0}),Object.defineProperty(c(i),tp,{writable:!0,value:void 0}),Object.defineProperty(c(i),ip,{writable:!0,value:void 0}),Object.defineProperty(c(i),rp,{writable:!0,value:void 0}),i.id=t.id,i.sceneModel=t.sceneModel,i.viewer=t.view.viewer,f(c(i),Dv)[Dv]=t.view,f(c(i),Av)[Av]=t.webglRenderer,f(c(i),Cv)[Cv]=t.renderContext,f(c(i),qv)[qv]=t.textureTranscoder,f(c(i),$v)[$v]=jr(),f(c(i),Zv)[Zv]=!1,f(c(i),Hv)[Hv]={},i.layerList=[],f(c(i),Jv)[Jv]={},i.rendererGeometries={},i.rendererTextures={},i.rendererTextureSets={},i.rendererMeshes={},i.rendererObjects={},i.rendererObjectsList=[],i.rendererViewObjects={},f(c(i),Xv)[Xv]=0,f(c(i),zv)[zv]=0,f(c(i),Wv)[Wv]=0,f(c(i),Yv)[Yv]=0,f(c(i),Kv)[Kv]=0,f(c(i),Qv)[Qv]=t.edgeThreshold||10,i.built=!1,f(c(i),kv)[kv]=wt(t.position||[0,0,0]),f(c(i),Bv)[Bv]=wt(t.rotation||[0,0,0]),f(c(i),Lv)[Lv]=Pt(t.quaternion||[0,0,0,1]),t.rotation&&Ci(f(c(i),Bv)[Bv],"XYZ",f(c(i),Lv)[Lv]),f(c(i),Fv)[Fv]=wt(t.scale||[1,1,1]),f(c(i),Uv)[Uv]=Zt(),Ei(f(c(i),kv)[kv],f(c(i),Lv)[Lv],f(c(i),Fv)[Fv],f(c(i),Uv)[Uv]),(t.matrix||t.position||t.rotation||t.scale||t.quaternion)&&(f(c(i),Nv)[Nv]=Zt(),f(c(i),ep)[ep]=!0,f(c(i),tp)[tp]=!0),i.qualityRender=!1!==t.qualityRender,f(c(i),rp)[rp]=t.layerId,f(c(i),ip)[ip]=f(c(i),Dv)[Dv].camera.onViewMatrix.subscribe(function(e,t){f(c(i),ep)[ep]=!0}),f(c(i),hp)[hp](),i.onBuilt=new p(new te.EventDispatcher),f(c(i),np)[np](t.sceneModel);for(var r=0,n=i.layerList.length;r<n;r++)i.layerList[r].layerIndex=r;return f(c(i),Jv)[Jv]={},i.built=!0,f(c(i),Av)[Av].setImageDirty(),i.onBuilt.dispatch(c(i),null),i}r(t,e);var n=t.prototype;return n.setVisible=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setVisible(e,t);f(this,Av)[Av].setImageDirty(e)},n.setXRayed=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setXRayed(e,t);f(this,Av)[Av].setImageDirty(e)},n.setHighlighted=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setHighlighted(e,t);f(this,Av)[Av].setImageDirty(e)},n.setSelected=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setSelected(e,t);f(this,Av)[Av].setImageDirty(e)},n.setEdges=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setEdges(e,t);f(this,Av)[Av].setImageDirty(e)},n.setCulled=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setCulled(e,t);f(this,Av)[Av].setImageDirty(e)},n.setClippable=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setClippable(e,t);f(this,Av)[Av].setImageDirty(e)},n.setCollidable=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setCollidable(e,t)},n.setPickable=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setPickable(e,t)},n.setColorize=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setColorize(e,t)},n.setOpacity=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setOpacity(e,t)},n.destroy=function(){if(!this.destroyed){for(var t in f(this,dp)[dp](),f(this,Dv)[Dv].camera.onViewMatrix.unsubscribe(f(this,ip)[ip]),f(this,Jv)[Jv])f(this,Jv)[Jv].hasOwnProperty(t)&&f(this,Jv)[Jv][t].destroy();for(var i=0,r=this.layerList.length;i<r;i++)this.layerList[i].destroy();for(var n in this.rendererObjects)this.rendererObjects[n].destroy();f(this,Jv)[Jv]={},f(this,Hv)[Hv]={},this.layerList=[],this.rendererGeometries={},this.rendererTextures={},this.rendererTextureSets={},this.rendererMeshes={},this.rendererViewObjects={},this.onBuilt.clear(),e.prototype.destroy.call(this)}},i(t,[{key:"position",get:function(){return f(this,kv)[kv]}},{key:"rotation",get:function(){return f(this,Bv)[Bv]}},{key:"quaternion",get:function(){return f(this,Lv)[Lv]}},{key:"scale",get:function(){return f(this,Fv)[Fv]}},{key:"worldMatrix",get:function(){return f(this,Uv)[Uv]}},{key:"viewMatrix",get:function(){return f(this,Nv)[Nv]?(f(this,ep)[ep]&&(hi(f(this,Dv)[Dv].camera.viewMatrix,f(this,Uv)[Uv],f(this,Nv)[Nv]),f(this,ep)[ep]=!1),f(this,Nv)[Nv]):f(this,Dv)[Dv].camera.viewMatrix}},{key:"colorTextureEnabled",get:function(){return f(this,Vv)[Vv]}},{key:"backfaces",get:function(){return f(this,Gv)[Gv]},set:function(e){e=!!e,f(this,Gv)[Gv]=e,f(this,Av)[Av].setImageDirty()}},{key:"matrix",get:function(){return f(this,Uv)[Uv]}},{key:"aabb",get:function(){return f(this,Zv)[Zv]&&f(this,up)[up](),f(this,$v)[$v]}},{key:"numTriangles",get:function(){return f(this,Wv)[Wv]}},{key:"numLines",get:function(){return f(this,Yv)[Yv]}},{key:"numPoints",get:function(){return f(this,Kv)[Kv]}}]),t}(ae);function vp(e){var t=e.textures,i=e.geometries,r=e.meshes,n=e.objects;if(t)for(var o in t)f(this,op)[op](t[o]);if(i)for(var s in i)f(this,sp)[sp](i[s]);if(r)for(var a in r)f(this,ap)[ap](r[a]);if(n)for(var c in n)f(this,lp)[lp](n[c]);for(var l in f(this,Jv)[Jv])f(this,Jv)[Jv][l].build();for(var h=0,u=this.rendererObjectsList.length;h<u;h++)this.rendererObjectsList[h].build();for(var d=0,v=this.rendererObjectsList.length;d<v;d++)this.rendererObjectsList[d].build2()}function pp(e){var t=this,i=e.id;if(this.rendererTextures[i])throw new he("RendererTexture already created: "+i);var r=new Wh({gl:f(this,Cv)[Cv].gl});if(e.preloadColor&&r.setPreloadColor(e.preloadColor),e.image){var n=e.image;n.crossOrigin="Anonymous",r.setImage(n,{minFilter:e.minFilter,magFilter:e.magFilter,wrapS:e.wrapS,wrapT:e.wrapT,wrapR:e.wrapR,flipY:e.flipY,encoding:e.encoding})}else if(e.src){var o=e.src.split(".").pop();switch(o){case"jpeg":case"jpg":case"png":case"gif":var s=new Image;s.onload=function(){r.setImage(s,{minFilter:e.minFilter,magFilter:e.magFilter,wrapS:e.wrapS,wrapT:e.wrapT,wrapR:e.wrapR,flipY:e.flipY,encoding:e.encoding})},s.src=e.src;break;default:f(this,qv)[qv]?$i(e.src,function(e){e.byteLength?f(t,qv)[qv].transcode([e]).then(function(e){r.setCompressedData(e),f(t,Av)[Av].setImageDirty()}):t.error("Can't create texture from 'src': file data is zero length")},function(e){t.error("Can't create texture from 'src': "+e)}):this.error("Can't create texture from 'src' - rendererModel needs to be configured with a TextureTranscoder for this file type ('"+o+"')")}}else e.buffers&&(f(this,qv)[qv]?f(this,qv)[qv].transcode(e.buffers).then(function(e){r.setCompressedData(e),f(t,Av)[Av].setImageDirty()}):this.error("Can't create texture from 'buffers' - rendererModel needs to be configured with a TextureTranscoder for this option"));var a=new bv(e,r);e.rendererTexture=a,this.rendererTextures[i]=a}function yp(e){var t=e.id;if(this.rendererGeometries[t])throw new he("RendererGeometry already created: "+t);var i=new mv;this.rendererGeometries[t]=i,e.rendererGeometry=i,f(this,Xv)[Xv]++}function mp(e){var t=this.rendererGeometries[e.geometry.id];if(!t)throw new he("RendererGeometry not found");var i=e.textureSet?e.textureSet.id:Rv,r=this.rendererTextureSets[i];if(!r)throw new he("TextureSet not found");var n=f(this,cp)[cp](i,e.geometry);if(n){var o;n.hasGeometry(e.geometry.id)||n.createGeometryCompressed(e.geometry),f(this,tp)[tp]&&f(this,Uv),o=e.matrix;var s=e.color?new Uint8Array([Math.floor(255*e.color[0]),Math.floor(255*e.color[1]),Math.floor(255*e.color[2])]):[255,255,255],a=null!=e.opacity?Math.floor(255*e.opacity):255,c=null!=e.metallic?Math.floor(255*e.metallic):0,l=null!=e.roughness?Math.floor(255*e.roughness):255,h=new Ov({tileManager:f(this,Av)[Av].tileManager,id:e.id,layer:n,color:s,opacity:a,matrix:o,metallic:c,roughness:l,rendererTextureSet:r,rendererGeometry:t,meshIndex:0});h.pickId=f(this,Av)[Av].attachPickable(h);var u=new Uint8Array([255&h.pickId,h.pickId>>8&255,h.pickId>>16&255,h.pickId>>24&255]);jr(h.aabb);var d=n.createMesh({id:e.id,geometryId:e.geometry.id,color:s,opacity:a,metallic:c,roughness:l,matrix:o,pickColor:u});f(this,Xv)[Xv]++,Dr(f(this,$v)[$v],h.aabb),h.layer=n,h.meshIndex=d,this.rendererMeshes[e.id]=h}}function bp(e,t){var i,r=e+"_"+t.primitive,n=f(this,Jv)[Jv][r];if(n){if(n.canCreateMesh(t))return n;n.build(),delete f(this,Jv)[Jv][r]}if(!e||(i=this.rendererTextureSets[e]))return n=new dv({gl:f(this,Cv)[Cv].gl,view:f(this,Dv)[Dv],rendererModel:this,primitive:t.primitive,textureSet:i,layerIndex:0}),f(this,Hv)[Hv][r]=n,this.layerList.push(n),f(this,Jv)[Jv][r]=n,n;this.error("TextureSet not found: "+e+" - ensure that you create it first with createTextureSet()")}function gp(e){var t=e.id;void 0===t?t=or():this.rendererObjects[t]&&(this.error("[createObject] rendererModel already has a ViewerObject with this ID: "+t+" - will assign random ID"),t=or());var i=e.meshes;if(void 0===i)throw new he("[createObject] Param expected: meshes");for(var r=[],n=0,o=i.length;n<o;n++)r.push(this.rendererMeshes[i[n].id]);var s=new xv({id:t,sceneObject:e,rendererModel:this,rendererMeshes:r,aabb:e.aabb,layerId:f(this,rp)[rp]});this.rendererObjectsList.push(s),this.rendererObjects[t]=s,this.rendererViewObjects[t]=s,f(this,zv)[zv]++}function wp(){var e=new bv(null,new Wh({gl:f(this,Cv)[Cv].gl,preloadColor:[1,1,1,1]})),t=new bv(null,new Wh({gl:f(this,Cv)[Cv].gl,preloadColor:[0,1,1,1]})),i=new bv(null,new Wh({gl:f(this,Cv)[Cv].gl,preloadColor:[0,0,0,0]})),r=new bv(null,new Wh({gl:f(this,Cv)[Cv].gl,preloadColor:[0,0,0,1]})),n=new bv(null,new Wh({gl:f(this,Cv)[Cv].gl,preloadColor:[1,1,1,1]}));this.rendererTextures.defaultColorTexture=e,this.rendererTextures.defaultMetalRoughTexture=t,this.rendererTextures.defaultNormalsTexture=i,this.rendererTextures.defaultEmissiveTexture=r,this.rendererTextures.defaultOcclusionTexture=n,this.rendererTextureSets[Rv]=new jv({id:Rv,colorTexture:e,metallicRoughnessTexture:t,emissiveTexture:r,occlusionTexture:n})}function Pp(){jr(f(this,$v)[$v]);for(var e=0,t=this.rendererObjectsList.length;e<t;e++){var i=this.rendererObjectsList[e];Dr(f(this,$v)[$v],i.aabb)}f(this,Zv)[Zv]=!1}function Ep(){var e=this.sceneModel;if(e){var t=e.textures,i=e.geometries,r=e.meshes,n=e.objects;if(t)for(var o in t){var s=t[o];s.rendererTexture&&(s.rendererTexture=null)}if(i)for(var a in i){var c=i[a];c.rendererGeometry&&(c.rendererGeometry=null)}if(r)for(var l in r){var h=r[l];h.rendererMesh&&(h.rendererMesh=null)}if(n)for(var u in n){var d=n[u];d.rendererObject&&(d.rendererObject=null)}this.sceneModel=null}}var Tp=2e3,_p=/*#__PURE__*/d("gl"),Ip=/*#__PURE__*/d("indexesUsed"),xp=/*#__PURE__*/d("tiles"),Sp=/*#__PURE__*/d("dataTexture"),Mp=/*#__PURE__*/d("camera"),Op=/*#__PURE__*/d("lastFreeIndex"),jp=/*#__PURE__*/d("numTiles"),Rp=/*#__PURE__*/d("putFreeTile"),Dp=/*#__PURE__*/d("findFreeTile"),Ap=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,Dp,{value:kp}),Object.defineProperty(this,Rp,{value:Cp}),Object.defineProperty(this,_p,{writable:!0,value:void 0}),Object.defineProperty(this,Ip,{writable:!0,value:void 0}),Object.defineProperty(this,xp,{writable:!0,value:void 0}),Object.defineProperty(this,Sp,{writable:!0,value:void 0}),Object.defineProperty(this,Mp,{writable:!0,value:void 0}),Object.defineProperty(this,Op,{writable:!0,value:void 0}),Object.defineProperty(this,jp,{writable:!0,value:void 0}),f(this,Mp)[Mp]=e.camera,f(this,_p)[_p]=e.gl,f(this,Ip)[Ip]=[],f(this,Op)[Op]=0,f(this,xp)[xp]={},f(this,Sp)[Sp]=function(e,t){var i=Tp;if(0===i)throw"texture height == 0";var r=new Gf(48*i),n=e.createTexture();return n?(e.bindTexture(e.TEXTURE_2D,n),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA16F,12,i),e.texSubImage2D(e.TEXTURE_2D,0,0,0,12,i,e.RGBA,e.HALF_FLOAT,new Uint16Array(r.buffer),0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new Bh({gl:e,texture:n,textureWidth:12,textureHeight:i})):Xf}(f(this,_p)[_p]),f(this,jp)[jp]=0}var t=e.prototype;return t.getTile=function(e){var t=Qr(e,wt()),i=t[0]+"-"+t[1]+"-"+t[2],r=f(this,xp)[xp][i];return r||(r={id:i,index:f(this,Dp)[Dp](),useCount:0,center:wt(),rtcViewMatrix:Zt()},f(this,xp)[xp][r.id]=r,f(this,jp)[jp]++),r.useCount++,r},t.putTile=function(e){0==--e.useCount&&(delete f(this,xp)[xp][e.id],f(this,Rp)[Rp](e.index),f(this,jp)[jp]--)},t.updateTileCenter=function(e,t){var i=Qr(t,wt()),r=i[0]+"-"+i[1]+"-"+i[2];if(r===e.id)return e;this.putTile(e);var n=f(this,xp)[xp][r];return n||(n={id:r,index:f(this,Dp)[Dp](),useCount:0,center:wt(),rtcViewMatrix:Zt()},f(this,xp)[xp][n.id]=n),n.useCount++,n},t.refreshMatrices=function(){if(f(this,Sp)[Sp].texture){var e=Object.keys(f(this,xp)[xp]),t=e.length;if(t>0){for(var i=f(this,_p)[_p],r=f(this,Mp)[Mp].viewMatrix,n=new Float32Array(16*t),o=0;o<t;o++){var s=e[o],a=f(this,xp)[xp][s];Zr(r,a.center,a.rtcViewMatrix),n.set(a.rtcViewMatrix,16*a.index)}i.bindTexture(i.TEXTURE_2D,f(this,Sp)[Sp].texture),i.texSubImage2D(i.TEXTURE_2D,0,0,0,1,1,i.RGBA,i.FLOAT,n),i.bindTexture(i.TEXTURE_2D,null)}}},e}();function Cp(e){f(this,Ip)[Ip][e]&&(delete f(this,Ip)[Ip][e],f(this,Op)[Op]=e,f(this,jp)[jp]--)}function kp(){for(var e=f(this,Op)[Op];;e=(e+1)%Tp)if(!f(this,Ip)[Ip][e])return f(this,Ip)[Ip][e]=!0,e}var Bp=navigator.userAgent.match(/(opera|chrome|safari|firefox|msie|mobile)\/?\s*(\.?\d+(\.\d+)*)/i),Lp=Bp&&"safari"===Bp[1].toLowerCase(),Fp=/*#__PURE__*/d("sceneModels"),Up=/*#__PURE__*/d("viewer"),Np=/*#__PURE__*/d("view"),Vp=/*#__PURE__*/d("renderContext"),Gp=/*#__PURE__*/d("canvasTransparent"),Hp=/*#__PURE__*/d("transparentEnabled"),Xp=/*#__PURE__*/d("edgesEnabled"),Wp=/*#__PURE__*/d("imageDirty"),Yp=/*#__PURE__*/d("saoEnabled"),Kp=/*#__PURE__*/d("pbrEnabled"),zp=/*#__PURE__*/d("backgroundColor"),qp=/*#__PURE__*/d("rendererModels"),Zp=/*#__PURE__*/d("layerList"),Qp=/*#__PURE__*/d("layerListDirty"),Jp=/*#__PURE__*/d("stateSortDirty"),$p=/*#__PURE__*/d("pickIDs"),ey=/*#__PURE__*/d("saoDepthRenderBuffer"),ty=/*#__PURE__*/d("extensionHandles"),iy=/*#__PURE__*/d("logarithmicDepthBufferEnabled"),ry=/*#__PURE__*/d("alphaDepthMask"),ny=/*#__PURE__*/d("occlusionTester"),oy=/*#__PURE__*/d("textureTranscoder"),sy=/*#__PURE__*/d("layerRenderers"),ay=/*#__PURE__*/d("viewMatrixDirty"),cy=/*#__PURE__*/d("attachRendererViewObjects"),ly=/*#__PURE__*/d("detachRendererViewObjects"),hy=/*#__PURE__*/d("updateLayerList"),uy=/*#__PURE__*/d("buildLayerList"),dy=/*#__PURE__*/d("draw"),fy=/*#__PURE__*/d("activateExtensions"),vy=/*#__PURE__*/d("drawSAOBuffers"),py=/*#__PURE__*/d("drawDepth"),yy=/*#__PURE__*/d("drawColor"),my=/*#__PURE__*/d("drawLayer"),by=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,my,{value:My}),Object.defineProperty(this,yy,{value:Sy}),Object.defineProperty(this,py,{value:xy}),Object.defineProperty(this,vy,{value:Iy}),Object.defineProperty(this,fy,{value:_y}),Object.defineProperty(this,dy,{value:Ty}),Object.defineProperty(this,uy,{value:Ey}),Object.defineProperty(this,hy,{value:Py}),Object.defineProperty(this,ly,{value:wy}),Object.defineProperty(this,cy,{value:gy}),this.rendererViewObjects=void 0,this.tileManager=void 0,Object.defineProperty(this,Fp,{writable:!0,value:void 0}),Object.defineProperty(this,Up,{writable:!0,value:void 0}),Object.defineProperty(this,Np,{writable:!0,value:void 0}),Object.defineProperty(this,Vp,{writable:!0,value:void 0}),Object.defineProperty(this,Gp,{writable:!0,value:void 0}),Object.defineProperty(this,Hp,{writable:!0,value:void 0}),Object.defineProperty(this,Xp,{writable:!0,value:void 0}),Object.defineProperty(this,Wp,{writable:!0,value:void 0}),Object.defineProperty(this,Yp,{writable:!0,value:void 0}),Object.defineProperty(this,Kp,{writable:!0,value:void 0}),Object.defineProperty(this,zp,{writable:!0,value:void 0}),Object.defineProperty(this,qp,{writable:!0,value:void 0}),Object.defineProperty(this,Zp,{writable:!0,value:void 0}),Object.defineProperty(this,Qp,{writable:!0,value:void 0}),Object.defineProperty(this,Jp,{writable:!0,value:void 0}),Object.defineProperty(this,$p,{writable:!0,value:new Gi({})}),Object.defineProperty(this,ey,{writable:!0,value:void 0}),Object.defineProperty(this,ty,{writable:!0,value:void 0}),Object.defineProperty(this,iy,{writable:!0,value:void 0}),Object.defineProperty(this,ry,{writable:!0,value:void 0}),Object.defineProperty(this,ny,{writable:!0,value:void 0}),Object.defineProperty(this,oy,{writable:!0,value:void 0}),Object.defineProperty(this,sy,{writable:!0,value:void 0}),Object.defineProperty(this,ay,{writable:!0,value:void 0}),this.rendererViewObjects={},this.tileManager=null,f(this,Fp)[Fp]={},f(this,oy)[oy]=e.textureTranscoder||new jh({}),f(this,Gp)[Gp]=!1,f(this,ry)[ry]=!1,f(this,ty)[ty]={},f(this,$p)[$p]=new Gi({}),f(this,Zp)[Zp]=[],f(this,Qp)[Qp]=!0,f(this,Jp)[Jp]=!0,f(this,Wp)[Wp]=!0,f(this,Hp)[Hp]=!0,f(this,Xp)[Xp]=!0,f(this,Yp)[Yp]=!0,f(this,Kp)[Kp]=!0,f(this,zp)[zp]=wt(),f(this,ny)[ny]=null,f(this,iy)[iy]=!1,f(this,qp)[qp]={},f(this,ay)[ay]=!0}var t=e.prototype;return t.getCapabilities=function(e){e.maxViews=1;var t,i=document.createElement("canvas");try{t=i.getContext("webgl2")}catch(e){console.error("Failed to get a WebGL context")}t&&(e.astcSupported=!!Gh(t,"WEBGL_compressed_texture_astc"),e.etc1Supported=!0,e.etc2Supported=!!Gh(t,"WEBGL_compressed_texture_etc"),e.dxtSupported=!!Gh(t,"WEBGL_compressed_texture_s3tc"),e.bptcSupported=!!Gh(t,"EXT_texture_compression_bptc"),e.pvrtcSupported=!(!Gh(t,"WEBGL_compressed_texture_pvrtc")&&!Gh(t,"WEBKIT_WEBGL_compressed_texture_pvrtc")))},t.attachViewer=function(e){f(this,Up)[Up]=e,f(this,oy)[oy].init(f(this,Up)[Up].capabilities)},t.attachView=function(e){var t=this;if(f(this,Vp)[Vp])throw"Only one View allowed with WebGLRenderer (see WebViewerCapabilities.maxViews)";f(this,Np)[Np]=e;for(var i=["webgl2"],r=e.canvasElement,n={},o=null,s=0;!o&&s<i.length;s++)try{o=r.getContext(i[s],n)}catch(e){}return o?(o&&o.hint(o.FRAGMENT_SHADER_DERIVATIVE_HINT,o.NICEST),f(this,Vp)[Vp]=new Qh(f(this,Up)[Up],f(this,Np)[Np],o),this.tileManager=new Ap({camera:e.camera,gl:o}),f(this,sy)[sy]={colorTriangles:new pu(f(this,Vp)[Vp])},e.camera.onViewMatrix.sub(function(){f(t,ay)[ay]=!0}),0):(console.error("Failed to get a WebGL2 context"),0)},t.detachView=function(e){},t.attachSceneModel=function(e){var t=this;if(!f(this,Vp)[Vp])throw new he("Must attach a View before you attach a SceneModel");var i=new fp({id:e.id,sceneModel:e,view:f(this,Np)[Np],textureTranscoder:f(this,oy)[oy],webglRenderer:this,renderContext:f(this,Vp)[Vp]});f(this,qp)[qp][i.id]=i,f(this,cy)[cy](i),f(this,Qp)[Qp]=!0,i.onDestroyed.one(function(e){var i=f(t,qp)[qp][e.id];delete f(t,qp)[qp][e.id],f(t,ly)[ly](i),f(t,Qp)[Qp]=!0}),e.rendererModel=i},t.detachSceneModel=function(e){if(f(this,Fp)[Fp][e.id]){var t=f(this,qp)[qp][e.id];delete f(this,qp)[qp][e.id],f(this,ly)[ly](t),f(this,Qp)[Qp]=!0,e.rendererModel=null}},t.attachPickable=function(e){return f(this,$p)[$p].addItem(e)},t.detachPickable=function(e){f(this,$p)[$p].removeItem(e)},t.setImageDirty=function(e){f(this,Wp)[Wp]=!0},t.setBackgroundColor=function(e,t){f(this,zp)[zp].set(t),f(this,Wp)[Wp]=!0},t.setEdgesEnabled=function(e,t){f(this,Xp)[Xp]=t,f(this,Wp)[Wp]=!0},t.setPBREnabled=function(e,t){f(this,Kp)[Kp]=t,f(this,Wp)[Wp]=!0},t.getSAOSupported=function(){return Lp&&zh.SUPPORTED_EXTENSIONS.OES_standard_derivatives},t.setSAOEnabled=function(e,t){f(this,Yp)[Yp]=t,f(this,Wp)[Wp]=!0},t.setTransparentEnabled=function(e,t){f(this,Hp)[Hp]=t,f(this,Wp)[Wp]=!0},t.clear=function(e){var t=f(this,Vp)[Vp].gl;t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),f(this,Gp)[Gp]?t.clearColor(1,1,1,1):t.clearColor(f(this,zp)[zp][0],f(this,zp)[zp][1],f(this,zp)[zp][2],1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},t.needsRebuild=function(e){for(var t in f(this,sy)[sy])f(this,sy)[sy][t].needRebuild()},t.needsRender=function(e){return f(this,Wp)[Wp]||f(this,Qp)[Qp]||f(this,Jp)[Jp]},t.render=function(e,t){(t=t||{}).force&&(f(this,Wp)[Wp]=!0),f(this,ay)[ay]&&(this.tileManager.refreshMatrices(),f(this,ay)[ay]=!1),f(this,hy)[hy](),f(this,Wp)[Wp]&&(f(this,dy)[dy]({clear:!0}),f(this,Wp)[Wp]=!1)},t.pickSceneObject=function(e,t){return null},e}();function gy(e){var t=e.rendererViewObjects;for(var i in t)this.rendererViewObjects[i]=t[i]}function wy(e){var t=e.rendererViewObjects;for(var i in t)delete this.rendererViewObjects[i]}function Py(){f(this,Qp)[Qp]&&(f(this,uy)[uy](),f(this,Qp)[Qp]=!1,f(this,Jp)[Jp]=!0),f(this,Jp)[Jp]&&(f(this,Jp)[Jp]=!1,f(this,Wp)[Wp]=!0)}function Ey(){var e=0;for(var t in f(this,qp)[qp])for(var i=f(this,qp)[qp][t],r=0,n=i.layerList.length;r<n;r++)f(this,Zp)[Zp][e++]=i.layerList[r];f(this,Zp)[Zp].length=e}function Ty(e){f(this,fy)[fy](),f(this,Yp)[Yp]&&f(this,Np)[Np].sao.possible&&f(this,vy)[vy](e),f(this,yy)[yy](e)}function _y(){zh.SUPPORTED_EXTENSIONS.OES_element_index_uint&&(f(this,ty)[ty].OES_element_index_uint=f(this,Vp)[Vp].gl.getExtension("OES_element_index_uint")),f(this,iy)[iy]&&zh.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(f(this,ty)[ty].EXT_frag_depth=f(this,Vp)[Vp].gl.getExtension("EXT_frag_depth")),zh.SUPPORTED_EXTENSIONS.WEBGL_depth_texture&&(f(this,ty)[ty].WEBGL_depth_texture=f(this,Vp)[Vp].gl.getExtension("WEBGL_depth_texture"))}function Iy(e){}function xy(e){f(this,Vp)[Vp].reset();var t=f(this,Vp)[Vp].gl;t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),t.clearColor(0,0,0,0),t.enable(t.DEPTH_TEST),t.frontFace(t.CCW),t.enable(t.CULL_FACE),t.depthMask(!0),!1!==e.clear&&t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}function Sy(e){var t=f(this,Np)[Np],i=f(this,Vp)[Vp],r=i.gl,n=[],o=[],s=[],a=[],c=[],l=[],h=[],u=[],d=[],v=[],p=[],y=[],m=[],b=[],g=[],w=[];i.reset(),i.withSAO=!1,i.pbrEnabled=f(this,Kp)[Kp]&&!!t.qualityRender,r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),f(this,Gp)[Gp]?r.clearColor(0,0,0,0):r.clearColor(f(this,zp)[zp][0],f(this,zp)[zp][1],f(this,zp)[zp][2],1),r.enable(r.DEPTH_TEST),r.frontFace(r.CCW),r.enable(r.CULL_FACE),r.depthMask(!0),r.lineWidth(1),i.lineWidth=1;var P=t.sao.possible;f(this,Yp)[Yp]&&P||(i.occlusionTexture=null),!1!==e.clear&&r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);for(var E=0,T=0,_=0,I=0,x=0,S=0,M=0,O=0,j=0,R=0,D=0,A=0,C=0,k=0,B=0,L=0,F=0,U=f(this,Zp)[Zp].length;F<U;F++){var N=f(this,Zp)[Zp][F],V=N.meshCounts;V.numCulled!==V.numMeshes&&0!==V.numVisible&&(V.numTransparent<V.numMeshes&&(f(this,Yp)[Yp]&&P&&N.rendererModel.qualityRender?n[E++]=N:f(this,my)[my](N,Jh.COLOR_OPAQUE,N.rendererModel.qualityRender)),f(this,Hp)[Hp]&&V.numTransparent&&(s[_++]=N),V.numXRayed>0&&t.xrayMaterial.fill&&(t.xrayMaterial.fillAlpha<1?h[M++]=N:c[x++]=N),V.numHighlighted>0&&t.highlightMaterial.fill&&(t.highlightMaterial.fillAlpha<1?p[D++]=N:d[j++]=N),V.numSelected>0&&t.selectedMaterial.fill&&(t.selectedMaterial.fillAlpha<1?g[B++]=N:m[C++]=N),f(this,Xp)[Xp]&&f(this,Np)[Np].edgeMaterial.edges&&V.numEdges>0&&(V.numTransparent<V.numMeshes&&(o[T++]=N),V.numTransparent>0&&(a[I++]=N),t.selectedMaterial.edgeAlpha<1?w[L++]=N:b[k++]=N,t.xrayMaterial.edgeAlpha<1?u[O++]=N:l[S++]=N,t.highlightMaterial.edgeAlpha<1?y[A++]=N:v[R++]=N))}E>0&&(i.withSAO=!0);for(var G=0;G<T;G++)f(this,my)[my](o[G],Jh.EDGES_COLOR_OPAQUE);for(var H=0;H<x;H++)f(this,my)[my](c[H],Jh.SILHOUETTE_XRAYED);for(var X=0;X<S;X++)f(this,my)[my](l[X],Jh.EDGES_XRAYED);if(M>0||O>0||_>0||I>0){r.enable(r.CULL_FACE),r.enable(r.BLEND),f(this,Gp)[Gp]?(r.blendEquation(r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)):(r.blendEquation(r.FUNC_ADD),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA)),i.backfaces=!1,f(this,ry)[ry]||r.depthMask(!1);for(var W=0;W<O;W++)f(this,my)[my](u[W],Jh.EDGES_XRAYED);for(var Y=0;Y<M;Y++)f(this,my)[my](h[Y],Jh.SILHOUETTE_XRAYED);(_>0||I>0)&&r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);for(var K=0;K<I;K++)f(this,my)[my](a[K],Jh.EDGES_COLOR_TRANSPARENT);for(var z=0;z<_;z++)f(this,my)[my](s[z],Jh.COLOR_TRANSPARENT);r.disable(r.BLEND),f(this,ry)[ry]||r.depthMask(!0)}if(j>0||R>0){i.lastProgramId=-1,r.clear(r.DEPTH_BUFFER_BIT);for(var q=0;q<R;q++)f(this,my)[my](v[q],Jh.EDGES_HIGHLIGHTED);for(var Z=0;Z<j;Z++)f(this,my)[my](d[Z],Jh.SILHOUETTE_HIGHLIGHTED)}if(D>0||A>0||j>0){i.lastProgramId=-1,r.clear(r.DEPTH_BUFFER_BIT),r.enable(r.CULL_FACE),r.enable(r.BLEND),f(this,Gp)[Gp]?(r.blendEquation(r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)):r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);for(var Q=0;Q<A;Q++)f(this,my)[my](y[Q],Jh.EDGES_HIGHLIGHTED);for(var J=0;J<D;J++)f(this,my)[my](p[J],Jh.SILHOUETTE_HIGHLIGHTED);r.disable(r.BLEND)}if(C>0||k>0){i.lastProgramId=-1,r.clear(r.DEPTH_BUFFER_BIT);for(var $=0;$<k;$++)f(this,my)[my](b[$],Jh.EDGES_SELECTED);for(var ee=0;ee<C;ee++)f(this,my)[my](m[ee],Jh.SILHOUETTE_SELECTED)}if(B>0||L>0){i.lastProgramId=-1,r.clear(r.DEPTH_BUFFER_BIT),r.enable(r.CULL_FACE),r.enable(r.BLEND),f(this,Gp)[Gp]?(r.blendEquation(r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)):r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);for(var te=0;te<L;te++)f(this,my)[my](w[te],Jh.EDGES_SELECTED);for(var ie=0;ie<B;ie++)f(this,my)[my](g[ie],Jh.SILHOUETTE_SELECTED);r.disable(r.BLEND)}for(var re=zh.MAX_TEXTURE_UNITS,ne=0;ne<re;ne++)r.activeTexture(r.TEXTURE0+ne);r.bindTexture(r.TEXTURE_CUBE_MAP,null),r.bindTexture(r.TEXTURE_2D,null);for(var oe=zh.MAX_VERTEX_ATTRIBS,se=0;se<oe;se++)r.disableVertexAttribArray(se)}function My(e,t,i){switch(void 0===i&&(i=!0),e.renderState.primitive){case qe:case Qe:case Ze:switch(t){case Jh.COLOR_OPAQUE:if(e.meshCounts.numTransparent===e.meshCounts.numMeshes||e.meshCounts.numXRayed===e.meshCounts.numMeshes)return;i||f(this,sy)[sy].colorTriangles.draw(e);break;case Jh.COLOR_TRANSPARENT:if(0===e.meshCounts.numTransparent)return;i||f(this,sy)[sy].colorTriangles.draw(e)}}}var Oy={__proto__:null,WebGLRenderer:by},jy=Pt(),Ry=Pt(),Dy=wt(),Ay=wt(),Cy=wt(),ky=Pt(),By=Pt(),Ly=Pt(),Fy=/*#__PURE__*/d("unproject"),Uy=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,Fy,{value:Ny}),this.view=void 0,this.view=e.view}var t=e.prototype;return t.dollyToCanvasPos=function(e,t,i){var r=!1,n=this.view.camera;if(e&&(r=Ut(Mt(e,n.eye,Dy))<i),n.projectionType===et){n.orthoProjection.scale=n.orthoProjection.scale-i;var o=_t(Yt(Mt(f(this,Fy)[Fy](t,ky),n.eye,Ly)),-i,[]);if(n.eye=[n.eye[0]-o[0],n.eye[1]-o[1],n.eye[2]-o[2]],n.look=[n.look[0]-o[0],n.look[1]-o[1],n.look[2]-o[2]],e){var s=Ut(Mt(e,n.eye,Dy)),a=_t(Yt(Mt(n.look,n.eye,Ay)),s);n.look=[n.eye[0]+a[0],n.eye[1]+a[1],n.eye[2]+a[2]]}}else if(n.projectionType===tt){var c=f(this,Fy)[Fy](t,ky);n.orthoProjection.scale=n.orthoProjection.scale-i,n.orthoProjection.clean();var l=xt(Mt(f(this,Fy)[Fy](t,By),c,Ly),_t(Yt(Mt(n.look,n.eye,Dy)),-i,Ay),Cy);n.eye=[n.eye[0]-l[0],n.eye[1]-l[1],n.eye[2]-l[2]],n.look=[n.look[0]-l[0],n.look[1]-l[1],n.look[2]-l[2]]}return r},t.destroy=function(){},e}();function Ny(e,t){var i=this.view.camera,r=i.project.transposedProjMatrix,n=r.subarray(8,12),o=r.subarray(12),s=[0,0,-1,1],a=Dt(s,n)/Dt(s,o);return i.project.unproject(e,a,jy,Ry,t),t}var Vy=wt(),Gy=wt(),Hy=wt(),Xy=Pt(),Wy=Pt(),Yy=Pt(),Ky=/*#__PURE__*/d("view"),zy=/*#__PURE__*/d("configs"),qy=/*#__PURE__*/d("pivotWorldPos"),Zy=/*#__PURE__*/d("cameraOffset"),Qy=/*#__PURE__*/d("azimuth"),Jy=/*#__PURE__*/d("polar"),$y=/*#__PURE__*/d("radius"),em=/*#__PURE__*/d("pivotPosSet"),tm=/*#__PURE__*/d("pivoting"),im=/*#__PURE__*/d("shown"),rm=/*#__PURE__*/d("pivotViewPos"),nm=/*#__PURE__*/d("pivotProjPos"),om=/*#__PURE__*/d("pivotCanvasPos"),sm=/*#__PURE__*/d("cameraDirty"),am=/*#__PURE__*/d("onViewMatrix"),cm=/*#__PURE__*/d("onProjMatrix"),lm=/*#__PURE__*/d("onTick"),hm=/*#__PURE__*/d("hideTimeout"),um=/*#__PURE__*/d("pivotElement"),dm=/*#__PURE__*/d("cameraLookingDownwards"),fm=/*#__PURE__*/function(){function e(e,t){var i=this;Object.defineProperty(this,dm,{value:vm}),Object.defineProperty(this,Ky,{writable:!0,value:void 0}),Object.defineProperty(this,zy,{writable:!0,value:void 0}),Object.defineProperty(this,qy,{writable:!0,value:void 0}),Object.defineProperty(this,Zy,{writable:!0,value:void 0}),Object.defineProperty(this,Qy,{writable:!0,value:void 0}),Object.defineProperty(this,Jy,{writable:!0,value:void 0}),Object.defineProperty(this,$y,{writable:!0,value:void 0}),Object.defineProperty(this,em,{writable:!0,value:void 0}),Object.defineProperty(this,tm,{writable:!0,value:void 0}),Object.defineProperty(this,im,{writable:!0,value:void 0}),Object.defineProperty(this,rm,{writable:!0,value:void 0}),Object.defineProperty(this,nm,{writable:!0,value:void 0}),Object.defineProperty(this,om,{writable:!0,value:void 0}),Object.defineProperty(this,sm,{writable:!0,value:void 0}),Object.defineProperty(this,am,{writable:!0,value:void 0}),Object.defineProperty(this,cm,{writable:!0,value:void 0}),Object.defineProperty(this,lm,{writable:!0,value:void 0}),Object.defineProperty(this,hm,{writable:!0,value:void 0}),Object.defineProperty(this,um,{writable:!0,value:void 0}),f(this,Ky)[Ky]=e.view,f(this,zy)[zy]=t,f(this,qy)[qy]=wt(),f(this,Zy)[Zy]=wt(),f(this,Qy)[Qy]=0,f(this,Jy)[Jy]=0,f(this,$y)[$y]=0,f(this,em)[em]=!1,f(this,tm)[tm]=!1,f(this,im)[im]=!1,f(this,rm)[rm]=Pt(),f(this,nm)[nm]=Pt(),f(this,rm)[rm]=gt(),f(this,sm)[sm]=!0,f(this,am)[am]=f(this,Ky)[Ky].camera.onViewMatrix.subscribe(function(){f(i,sm)[sm]=!0}),f(this,cm)[cm]=f(this,Ky)[Ky].camera.onProjMatrix.subscribe(function(){f(i,sm)[sm]=!0}),f(this,lm)[lm]=f(this,Ky)[Ky].viewer.onTick.subscribe(function(){i.updatePivotElement()})}var t=e.prototype;return t.updatePivotElement=function(){var e=f(this,Ky)[Ky].camera,t=f(this,Ky)[Ky].canvasElement;if(f(this,tm)[tm]&&f(this,sm)[sm]){di(e.viewMatrix,this.getPivotPos(),f(this,rm)[rm]),f(this,rm)[rm][3]=1,fi(e.projMatrix,f(this,rm)[rm],f(this,nm)[nm]);var i=f(this,Ky)[Ky].boundary,r=i[2],n=i[3];f(this,rm)[rm][0]=Math.floor((1+f(this,nm)[nm][0]/f(this,nm)[nm][3])*r/2),f(this,rm)[rm][1]=Math.floor((1-f(this,nm)[nm][1]/f(this,nm)[nm][3])*n/2);var o=t.getBoundingClientRect();f(this,um)[um]&&(f(this,um)[um].style.left=Math.floor(o.left+f(this,rm)[rm][0])-f(this,um)[um].clientWidth/2+window.scrollX+"px",f(this,um)[um].style.top=Math.floor(o.top+f(this,rm)[rm][1])-f(this,um)[um].clientHeight/2+window.scrollY+"px"),f(this,sm)[sm]=!1}},t.setPivotElement=function(e){f(this,um)[um]=e},t.startPivot=function(){if(f(this,dm)[dm]())return f(this,tm)[tm]=!1,!1;var e=f(this,Ky)[Ky].camera,t=si(e.eye,e.look,e.worldUp);di(t,this.getPivotPos(),f(this,Zy)[Zy]);var i=this.getPivotPos();f(this,Zy)[Zy][2]+=Vt(e.eye,i);var r=pi(t=ai(t),f(this,Zy)[Zy]),n=wt();if(Mt(e.eye,i,n),xt(n,r),e.zUp){var o=n[1];n[1]=n[2],n[2]=o}f(this,$y)[$y]=Ut(n),f(this,Jy)[Jy]=Math.acos(n[1]/f(this,$y)[$y]),f(this,Qy)[Qy]=Math.atan2(n[0],n[2]),f(this,tm)[tm]=!0},t.getPivoting=function(){return f(this,tm)[tm]},t.setPivotPos=function(e){f(this,qy)[qy].set(e),f(this,em)[em]=!0},t.setCanvasPivotPos=function(e){var t=f(this,Ky)[Ky].camera,i=Math.abs(Vt(Or(f(this,Ky)[Ky].aabb),t.eye)),r=t.project.transposedProjMatrix,n=r.subarray(8,12),o=r.subarray(12),s=[0,0,-1,1],a=Dt(s,n)/Dt(s,o),c=Xy;t.project.unproject(e,a,Wy,Yy,c);var l=Yt(Mt(c,t.eye,Vy)),h=xt(t.eye,_t(l,i,Gy),Hy);this.setPivotPos(h)},t.getPivotPos=function(){return f(this,em)[em]?f(this,qy)[qy]:f(this,Ky)[Ky].camera.look},t.continuePivot=function(e,t){if(f(this,tm)[tm]&&(0!==e||0!==t)){var i=f(this,Ky)[Ky].camera,r=-e,n=-t;1===i.worldUp[2]&&(r=-r),f(this,Qy)[Qy]+=.01*-r,f(this,Jy)[Jy]+=.01*n,f(this,Jy)[Jy]=ct(f(this,Jy)[Jy],.001,Math.PI-.001);var o=[f(this,$y)[$y]*Math.sin(f(this,Jy)[Jy])*Math.sin(f(this,Qy)[Qy]),f(this,$y)[$y]*Math.cos(f(this,Jy)[Jy]),f(this,$y)[$y]*Math.sin(f(this,Jy)[Jy])*Math.cos(f(this,Qy)[Qy])];if(1===i.worldUp[2]){var s=o[1];o[1]=o[2],o[2]=s}var a=Ut(Mt(i.look,i.eye,wt())),c=this.getPivotPos();xt(o,c);var l=si(o,c,i.worldUp),h=pi(l=ai(l),f(this,Zy)[Zy]);l[12]-=h[0],l[13]-=h[1],l[14]-=h[2];var u=[l[8],l[9],l[10]];i.eye=[l[12],l[13],l[14]],Mt(i.eye,_t(u,a),i.look),i.up=[l[4],l[5],l[6]],this.showPivot()}},t.showPivot=function(){var e=this;f(this,im)[im]||(null!==f(this,hm)[hm]&&(window.clearTimeout(f(this,hm)[hm]),f(this,hm)[hm]=null),f(this,um)[um]&&(this.updatePivotElement(),f(this,um)[um].style.visibility="visible",f(this,im)[im]=!0,f(this,hm)[hm]=window.setTimeout(function(){e.hidePivot()},1e3)))},t.hidePivot=function(){f(this,im)[im]&&(null!==f(this,hm)[hm]&&(window.clearTimeout(f(this,hm)[hm]),f(this,hm)[hm]=null),f(this,um)[um]&&(f(this,um)[um].style.visibility="hidden"),f(this,im)[im]=!1)},t.endPivot=function(){f(this,tm)[tm]=!1},t.destroy=function(){f(this,Ky)[Ky].camera.onViewMatrix.unsubscribe(f(this,am)[am]),f(this,Ky)[Ky].camera.onProjMatrix.unsubscribe(f(this,cm)[cm]),f(this,Ky)[Ky].viewer.onTick.unsubscribe(f(this,lm)[lm])},e}();function vm(){var e=f(this,Ky)[Ky].camera;return Lt(At(Yt(Mt(e.look,e.eye,Vy)),e.worldUp,Gy))<=1e-4}var pm=/*#__PURE__*/d("view"),ym=/*#__PURE__*/d("cameraControl"),mm=/*#__PURE__*/d("config"),bm=/*#__PURE__*/d("lastPickedobjectId"),gm=/*#__PURE__*/d("needFireEvents"),wm=/*#__PURE__*/function(){function e(e,t){this.schedulePickEntity=void 0,this.schedulePickSurface=void 0,this.pickCursorPos=void 0,this.picked=void 0,this.pickedSurface=void 0,this.pickResult=void 0,Object.defineProperty(this,pm,{writable:!0,value:void 0}),Object.defineProperty(this,ym,{writable:!0,value:void 0}),Object.defineProperty(this,mm,{writable:!0,value:void 0}),Object.defineProperty(this,bm,{writable:!0,value:void 0}),Object.defineProperty(this,gm,{writable:!0,value:void 0}),f(this,pm)[pm]=e.view,f(this,ym)[ym]=e,f(this,pm)[pm].canvasElement.oncontextmenu=function(e){e.preventDefault()},f(this,mm)[mm]=t,this.schedulePickEntity=!1,this.schedulePickSurface=!1,this.pickCursorPos=gt(),this.picked=!1,this.pickedSurface=!1,this.pickResult=null,f(this,bm)[bm]=null,f(this,gm)[gm]=!1}var t=e.prototype;return t.update=function(){if(f(this,mm)[mm].pointerEnabled&&(this.schedulePickEntity||this.schedulePickSurface)){this.picked=!1,this.pickedSurface=!1,f(this,gm)[gm]=!1;var e=f(this,ym)[ym].onHoverSurface.count>0;if(this.schedulePickSurface&&this.pickResult&&this.pickResult.worldPos){var t=this.pickResult.canvasPos;if(t[0]===this.pickCursorPos[0]&&t[1]===this.pickCursorPos[1])return this.picked=!0,this.pickedSurface=!0,f(this,gm)[gm]=e,this.schedulePickEntity=!1,void(this.schedulePickSurface=!1)}if(this.schedulePickEntity&&this.pickResult){var i=this.pickResult.canvasPos;if(i[0]===this.pickCursorPos[0]&&i[1]===this.pickCursorPos[1])return this.picked=!0,this.pickedSurface=!1,f(this,gm)[gm]=!1,this.schedulePickEntity=!1,void(this.schedulePickSurface=!1)}this.schedulePickEntity=!1,this.schedulePickSurface=!1}},t.fireEvents=function(){if(f(this,gm)[gm]){if(this.picked&&this.pickResult&&this.pickResult.entity){var e=this.pickResult.entity.id;f(this,bm)[bm]!==e&&(void 0!==f(this,bm)[bm]&&null!==f(this,bm)[bm]&&f(this,ym)[ym].onHoverOut.dispatch(f(this,ym)[ym],{entity:f(this,pm)[pm].objects[f(this,bm)[bm]]}),f(this,ym)[ym].onHoverOut.dispatch(f(this,ym)[ym],this.pickResult),f(this,bm)[bm]=e),f(this,ym)[ym].onHover.dispatch(f(this,ym)[ym],this.pickResult),this.pickResult.worldPos&&(this.pickedSurface=!0,f(this,ym)[ym].onHoverSurface.dispatch(f(this,ym)[ym],this.pickResult))}else void 0!==f(this,bm)[bm]&&null!==f(this,bm)[bm]&&(f(this,ym)[ym].onHoverOut.dispatch(f(this,ym)[ym],{entity:f(this,pm)[pm].objects[f(this,bm)[bm]]}),f(this,bm)[bm]=void 0),f(this,ym)[ym].onHoverOff.dispatch(f(this,ym)[ym],{canvasPos:this.pickCursorPos});this.pickResult=null,f(this,gm)[gm]=!1}},t.destroy=function(){},e}(),Pm=gt(),Em=/*#__PURE__*/d("view"),Tm=/*#__PURE__*/d("documentKeyDownHandler"),_m=/*#__PURE__*/d("documentKeyUpHandler"),Im=/*#__PURE__*/d("mouseDownHandler"),xm=/*#__PURE__*/d("documentMouseMoveHandler"),Sm=/*#__PURE__*/d("canvasMouseMoveHandler"),Mm=/*#__PURE__*/d("documentMouseUpHandler"),Om=/*#__PURE__*/d("mouseUpHandler"),jm=/*#__PURE__*/d("mouseEnterHandler"),Rm=/*#__PURE__*/d("mouseWheelHandler"),Dm=/*#__PURE__*/function(){function e(e,t,i,r,n){var o=this;Object.defineProperty(this,Em,{writable:!0,value:void 0}),Object.defineProperty(this,Tm,{writable:!0,value:void 0}),Object.defineProperty(this,_m,{writable:!0,value:void 0}),Object.defineProperty(this,Im,{writable:!0,value:void 0}),Object.defineProperty(this,xm,{writable:!0,value:void 0}),Object.defineProperty(this,Sm,{writable:!0,value:void 0}),Object.defineProperty(this,Mm,{writable:!0,value:void 0}),Object.defineProperty(this,Om,{writable:!0,value:void 0}),Object.defineProperty(this,jm,{writable:!0,value:void 0}),Object.defineProperty(this,Rm,{writable:!0,value:void 0}),f(this,Em)[Em]=e.view;var s,a,c,l=t.pickController,h=0,u=0,d=0,v=0,p=!1,y=new Float64Array(3),m=!0,b=f(this,Em)[Em].canvasElement,g=[];function w(e){void 0===e&&(e=!0),b.style.cursor="move",h=r.pointerViewPos[0],u=r.pointerViewPos[1],d=r.pointerViewPos[0],v=r.pointerViewPos[1],e&&(l.pickCursorPos=r.pointerViewPos,l.schedulePickSurface=!0,l.update(),l.picked&&l.pickedSurface&&l.pickResult&&l.pickResult.worldPos?(p=!0,y.set(l.pickResult.worldPos)):p=!1)}document.addEventListener("keydown",f(this,Tm)[Tm]=function(e){i.active&&i.pointerEnabled&&i.keyboardEnabled&&(g[e.keyCode]=!0)}),document.addEventListener("keyup",f(this,_m)[_m]=function(e){i.active&&i.pointerEnabled&&i.keyboardEnabled&&(g[e.keyCode]=!1)}),b.addEventListener("mousedown",f(this,Im)[Im]=function(e){if(i.active&&i.pointerEnabled)switch(e.which){case 1:g[16]||i.planView?(s=!0,w()):(s=!0,w(!1));break;case 2:a=!0,w();break;case 3:c=!0,i.panRightClick&&w()}}),document.addEventListener("mousemove",f(this,xm)[xm]=function(){if(i.active&&i.pointerEnabled&&(s||a||c)){var e=f(o,Em)[Em].boundary,t=e[0],l=e[1],d=r.pointerViewPos[0],v=r.pointerViewPos[1];if(g[16]||i.planView||!i.panRightClick&&a||i.panRightClick&&c){var m=d-h,b=v-u,w=f(o,Em)[Em].camera;if(w.projectionType===et){var P=Math.abs(p?Ut(Mt(y,f(o,Em)[Em].camera.eye,[])):f(o,Em)[Em].camera.eyeLookDist)*Math.tan(w.perspectiveProjection.fov/2*Math.PI/180);n.panDeltaX+=1.5*m*P/l,n.panDeltaY+=1.5*b*P/l}else n.panDeltaX+=.5*w.orthoProjection.scale*(m/l),n.panDeltaY+=.5*w.orthoProjection.scale*(b/l)}else!s||a||c||i.planView||(i.firstPerson?(n.rotateDeltaY-=(d-h)/t*i.dragRotationRate/2,n.rotateDeltaX+=(v-u)/l*(i.dragRotationRate/4)):(n.rotateDeltaY-=(d-h)/t*(1.5*i.dragRotationRate),n.rotateDeltaX+=(v-u)/l*(1.5*i.dragRotationRate)));h=d,u=v}}),b.addEventListener("mousemove",f(this,Sm)[Sm]=function(e){i.active&&i.pointerEnabled&&r.mouseover&&(m=!0)}),document.addEventListener("mouseup",f(this,Mm)[Mm]=function(e){if(i.active&&i.pointerEnabled)switch(e.which){case 1:case 2:case 3:s=!1,a=!1,c=!1}}),b.addEventListener("mouseup",f(this,Om)[Om]=function(e){if(i.active&&i.pointerEnabled){if(3===e.which){Am(e,Pm);var r=Pm[1];Math.abs(Pm[0]-d)<3&&Math.abs(r-v)<3&&t.cameraControl.events.fire("rightClick",{pagePos:[Math.round(e.pageX),Math.round(e.pageY)],canvasPos:Pm,event:e},!0)}b.style.removeProperty("cursor")}}),b.addEventListener("mouseenter",f(this,jm)[jm]=function(){});var P=1/60,E=null;b.addEventListener("wheel",f(this,Rm)[Rm]=function(e){if(i.active&&i.pointerEnabled){var t=performance.now()/1e3,o=null!==E?t-E:0;E=t,o>.05&&(o=.05),o<P&&(o=P);var s=Math.max(-1,Math.min(1,40*-e.deltaY));if(0!==s){var a=s/Math.abs(s);n.dollyDelta+=-a*o*i.mouseWheelDollyRate,m&&(r.followPointerDirty=!0,m=!1),e.preventDefault()}}})}var t=e.prototype;return t.reset=function(){},t.destroy=function(){var e=f(this,Em)[Em].canvasElement;document.removeEventListener("keydown",f(this,Tm)[Tm]),document.removeEventListener("keyup",f(this,_m)[_m]),e.removeEventListener("mousedown",f(this,Im)[Im]),document.removeEventListener("mousemove",f(this,xm)[xm]),e.removeEventListener("mousemove",f(this,Sm)[Sm]),document.removeEventListener("mouseup",f(this,Mm)[Mm]),e.removeEventListener("mouseup",f(this,Om)[Om]),e.removeEventListener("mouseenter",f(this,jm)[jm]),e.removeEventListener("wheel",f(this,Rm)[Rm])},e}(),Am=function(e,t){if(e){for(var i=e.target,r=0,n=0;i.offsetParent;)r+=i.offsetLeft,n+=i.offsetTop,i=i.offsetParent;t[0]=e.pageX-r,t[1]=e.pageY-n}else e=window.event,t[0]=e.x,t[1]=e.y;return t},Cm=wt(),km=wt(),Bm=wt(),Lm=wt(),Fm=wt(),Um={eye:new Float64Array(3),look:new Float64Array(3),up:new Float64Array(3),orthoScale:1},Nm=/*#__PURE__*/d("documentKeyDownHandler"),Vm=/*#__PURE__*/function(){function e(e,t,i,r,n){Object.defineProperty(this,Nm,{writable:!0,value:void 0});var o=e.view,s=e.camera,a=t.cameraControl;document.addEventListener("keydown",f(this,Nm)[Nm]=function(e){if(i.active&&i.pointerEnabled&&i.keyboardEnabled&&r.mouseover){var n=a._isKeyDownForAction(a.AXIS_VIEW_RIGHT),c=a._isKeyDownForAction(a.AXIS_VIEW_BACK),l=a._isKeyDownForAction(a.AXIS_VIEW_LEFT),h=a._isKeyDownForAction(a.AXIS_VIEW_FRONT),u=a._isKeyDownForAction(a.AXIS_VIEW_TOP),d=a._isKeyDownForAction(a.AXIS_VIEW_BOTTOM);if(n||c||l||h||u||d){var f=o.aabb,v=Sr(f);Or(f,Cm);var p=Math.abs(v/Math.tan(t.cameraFlight.fitFOV*at));Um.orthoScale=1.1*v,n?(Um.eye.set(xt(Cm,_t(s.worldRight,p,km),Fm)),Um.look.set(Cm),Um.up.set(s.worldUp)):c?(Um.eye.set(xt(Cm,_t(s.worldForward,p,km),Fm)),Um.look.set(Cm),Um.up.set(s.worldUp)):l?(Um.eye.set(xt(Cm,_t(s.worldRight,-p,km),Fm)),Um.look.set(Cm),Um.up.set(s.worldUp)):h?(Um.eye.set(xt(Cm,_t(s.worldForward,-p,km),Fm)),Um.look.set(Cm),Um.up.set(s.worldUp)):u?(Um.eye.set(xt(Cm,_t(s.worldUp,p,km),Fm)),Um.look.set(Cm),Um.up.set(Yt(_t(s.worldForward,1,Bm),Lm))):d&&(Um.eye.set(xt(Cm,_t(s.worldUp,-p,km),Fm)),Um.look.set(Cm),Um.up.set(Yt(_t(s.worldForward,-1,Bm)))),!i.firstPerson&&i.followPointer&&t.pivotController.setPivotPos(Cm),t.cameraFlight.duration>0?t.cameraFlight.flyTo(Um,function(){t.pivotController.getPivoting()&&i.followPointer&&t.pivotController.showPivot()}):(t.cameraFlight.jumpTo(Um),t.pivotController.getPivoting()&&i.followPointer&&t.pivotController.showPivot())}}})}var t=e.prototype;return t.reset=function(){},t.destroy=function(){document.removeEventListener("keydown",f(this,Nm)[Nm])},e}(),Gm=/*#__PURE__*/d("view"),Hm=/*#__PURE__*/d("clicks"),Xm=/*#__PURE__*/d("timeout"),Wm=/*#__PURE__*/d("lastPickedobjectId"),Ym=/*#__PURE__*/d("canvasMouseMoveHandler"),Km=/*#__PURE__*/d("canvasMouseDownHandler"),zm=/*#__PURE__*/d("documentMouseUpHandler"),qm=/*#__PURE__*/d("canvasMouseUpHandler"),Zm=/*#__PURE__*/function(){function e(e,t,i,r,n){var o=this;Object.defineProperty(this,Gm,{writable:!0,value:void 0}),Object.defineProperty(this,Hm,{writable:!0,value:void 0}),Object.defineProperty(this,Xm,{writable:!0,value:void 0}),Object.defineProperty(this,Wm,{writable:!0,value:void 0}),Object.defineProperty(this,Ym,{writable:!0,value:void 0}),Object.defineProperty(this,Km,{writable:!0,value:void 0}),Object.defineProperty(this,zm,{writable:!0,value:void 0}),Object.defineProperty(this,qm,{writable:!0,value:void 0}),f(this,Gm)[Gm]=e.view;var s=t.pickController,a=t.pivotController,c=t.cameraControl;f(this,Hm)[Hm]=0,f(this,Xm)[Xm]=null,f(this,Wm)[Wm]=null;var l=!1,h=!1,u=f(this,Gm)[Gm].canvasElement,d=function(e){var i;e&&e.worldPos&&(i=e.worldPos);var r=e&&e.viewObject?e.viewObject.aabb:f(o,Gm)[Gm].aabb;if(i){var n=f(o,Gm)[Gm].camera;Mt(n.eye,n.look,[]),t.cameraFlight.flyTo({aabb:r})}else t.cameraFlight.flyTo({aabb:r})};u.addEventListener("mousemove",f(this,Ym)[Ym]=function(e){if(i.active&&i.pointerEnabled&&!l&&!h){var t=c.events.hasSubs("hover"),n=c.events.hasSubs("hoverOut"),a=c.events.hasSubs("hoverOff"),u=c.events.hasSubs("hoverSurface");if(t||n||a||u)if(s.pickCursorPos=r.pointerViewPos,s.schedulePickEntity=!0,s.schedulePickSurface=u,s.update(),s.pickResult){var d=s.pickResult.entity.id;f(o,Wm)[Wm]!==d&&(void 0!==f(o,Wm)[Wm]&&c.events.fire("hoverOut",{entity:f(o,Gm)[Gm].objects[f(o,Wm)[Wm]]},!0),c.events.fire("hoverEnter",s.pickResult,!0),f(o,Wm)[Wm]=d),c.events.fire("hover",s.pickResult,!0),s.pickResult.worldPos&&c.events.fire("hoverSurface",s.pickResult,!0)}else void 0!==f(o,Wm)[Wm]&&(c.events.fire("hoverOut",{entity:f(o,Gm)[Gm].objects[f(o,Wm)[Wm]]},!0),f(o,Wm)[Wm]=void 0),c.events.fire("hoverOff",{canvasPos:s.pickCursorPos},!0)}}),u.addEventListener("mousedown",f(this,Km)[Km]=function(e){if(1===e.which&&(l=!0),3===e.which&&(h=!0),1===e.which&&i.active&&i.pointerEnabled&&(r.mouseDownClientX=e.clientX,r.mouseDownClientY=e.clientY,r.mouseDownCursorX=r.pointerViewPos[0],r.mouseDownCursorY=r.pointerViewPos[1],!i.firstPerson&&i.followPointer&&(s.pickCursorPos=r.pointerViewPos,s.schedulePickSurface=!0,s.update(),1===e.which))){var t=s.pickResult;t&&t.worldPos?(a.setPivotPos(t.worldPos),a.startPivot()):(i.smartPivot?a.setViewPivotPos(r.pointerViewPos):a.setPivotPos(f(o,Gm)[Gm].camera.look),a.startPivot())}}),document.addEventListener("mouseup",f(this,zm)[zm]=function(e){1===e.which&&(l=!1),3===e.which&&(h=!1)}),u.addEventListener("mouseup",f(this,qm)[qm]=function(e){if(i.active&&i.pointerEnabled&&1===e.which&&(a.hidePivot(),!(Math.abs(e.clientX-r.mouseDownClientX)>3||Math.abs(e.clientY-r.mouseDownClientY)>3))){var n=c.events.hasSubs("picked"),l=c.events.hasSubs("pickedNothing"),h=c.events.hasSubs("pickedSurface"),u=c.events.hasSubs("doublePicked"),v=c.events.hasSubs("doublePickedSurface"),p=c.events.hasSubs("doublePickedNothing");if(!(i.doublePickFlyTo||u||v||p))return(n||l||h)&&(s.pickCursorPos=r.pointerViewPos,s.schedulePickEntity=!0,s.schedulePickSurface=h,s.update(),s.pickResult?(c.events.fire("picked",s.pickResult,!0),s.pickedSurface&&c.events.fire("pickedSurface",s.pickResult,!0)):c.events.fire("pickedNothing",{canvasPos:r.pointerViewPos},!0)),void(f(o,Hm)[Hm]=0);if(f(o,Hm)[Hm]++,1===f(o,Hm)[Hm])f(o,Xm)[Xm]=setTimeout(function(){s.pickCursorPos=r.pointerViewPos,s.schedulePickEntity=i.doublePickFlyTo,s.schedulePickSurface=h,s.update(),s.pickResult?(c.events.fire("picked",s.pickResult,!0),s.pickedSurface&&(c.events.fire("pickedSurface",s.pickResult,!0),!i.firstPerson&&i.followPointer&&(t.pivotController.setPivotPos(s.pickResult.worldPos),t.pivotController.startPivot()&&t.pivotController.showPivot()))):c.events.fire("pickedNothing",{canvasPos:r.pointerViewPos},!0),f(o,Hm)[Hm]=0},250);else{if(null!==f(o,Xm)[Xm]&&(window.clearTimeout(f(o,Xm)[Xm]),f(o,Xm)[Xm]=null),s.pickCursorPos=r.pointerViewPos,s.schedulePickEntity=i.doublePickFlyTo||u||v,s.schedulePickSurface=s.schedulePickEntity&&v,s.update(),s.pickResult){if(c.events.fire("doublePicked",s.pickResult,!0),s.pickedSurface&&c.onDoublePickedSurface.dispatch(s.pickResult,!0),i.doublePickFlyTo&&(d(s.pickResult),!i.firstPerson&&i.followPointer)){var y=Or(s.pickResult.entity.aabb);t.pivotController.setPivotPos(y),t.pivotController.startPivot()&&t.pivotController.showPivot()}}else if(c.events.fire("doublePickedNothing",{canvasPos:r.pointerViewPos},!0),i.doublePickFlyTo&&(d(),!i.firstPerson&&i.followPointer)){var m=Or(f(o,Gm)[Gm].aabb);t.pivotController.setPivotPos(m),t.pivotController.startPivot()&&t.pivotController.showPivot()}f(o,Hm)[Hm]=0}}},!1)}var t=e.prototype;return t.reset=function(){f(this,Hm)[Hm]=0,f(this,Wm)[Wm]=null,f(this,Xm)[Xm]&&(window.clearTimeout(f(this,Xm)[Xm]),f(this,Xm)[Xm]=null)},t.destroy=function(){var e=f(this,Gm)[Gm].canvasElement;e.removeEventListener("mousemove",f(this,Ym)[Ym]),e.removeEventListener("mousedown",f(this,Km)[Km]),document.removeEventListener("mouseup",f(this,zm)[zm]),e.removeEventListener("mouseup",f(this,qm)[qm]),f(this,Xm)[Xm]&&(window.clearTimeout(f(this,Xm)[Xm]),f(this,Xm)[Xm]=null)},e}(),Qm=/*#__PURE__*/d("view"),Jm=/*#__PURE__*/d("documentMouseMoveHandler"),$m=/*#__PURE__*/d("documentKeyDownHandler"),eb=/*#__PURE__*/d("documentKeyUpHandler"),tb=/*#__PURE__*/d("onTick"),ib=/*#__PURE__*/function(){function e(e,t,i,r,n){Object.defineProperty(this,Qm,{writable:!0,value:void 0}),Object.defineProperty(this,Jm,{writable:!0,value:void 0}),Object.defineProperty(this,$m,{writable:!0,value:void 0}),Object.defineProperty(this,eb,{writable:!0,value:void 0}),Object.defineProperty(this,tb,{writable:!0,value:void 0}),this.keycodes=void 0,f(this,Qm)[Qm]=e.view;var o=[],s=e.view.canvasElement,a=!0;document.addEventListener("mousemove",f(this,Jm)[Jm]=function(){a=!0}),document.addEventListener("keydown",f(this,$m)[$m]=function(e){if(i.active&&i.pointerEnabled&&i.keyboardEnabled&&r.mouseover){var t=e.keyCode;o[t]=!0,16===t&&(s.style.cursor="move")}}),document.addEventListener("keyup",f(this,eb)[eb]=function(e){if(i.active&&i.pointerEnabled&&i.keyboardEnabled&&r.mouseover){var t=e.keyCode;o[t]=!1,16===t&&(s.style.cursor=null)}}),f(this,tb)[tb]=e.view.viewer.events.on("tick",function(e){if(i.active&&i.pointerEnabled&&i.keyboardEnabled&&r.mouseover){var s=t.cameraControl,c=e.deltaTime/1e3;if(!i.planView){var l=s._isKeyDownForAction(s.ROTATE_Y_POS,o),h=s._isKeyDownForAction(s.ROTATE_Y_NEG,o),u=s._isKeyDownForAction(s.ROTATE_X_POS,o),d=s._isKeyDownForAction(s.ROTATE_X_NEG,o),f=c*i.keyboardRotationRate;(l||h||u||d)&&(!i.firstPerson&&i.followPointer&&t.pivotController.startPivot(),l?n.rotateDeltaY+=f:h&&(n.rotateDeltaY-=f),u?n.rotateDeltaX+=f:d&&(n.rotateDeltaX-=f),!i.firstPerson&&i.followPointer&&t.pivotController.startPivot())}if(!o[17]&&!o[18]){var v=s._isKeyDownForAction(s.DOLLY_BACKWARDS,o),p=s._isKeyDownForAction(s.DOLLY_FORWARDS,o);if(v||p){var y=c*i.keyboardDollyRate;!i.firstPerson&&i.followPointer&&t.pivotController.startPivot(),p?n.dollyDelta-=y:v&&(n.dollyDelta+=y),a&&(r.followPointerDirty=!0,a=!1)}}var m=s._isKeyDownForAction(s.PAN_FORWARDS,o),b=s._isKeyDownForAction(s.PAN_BACKWARDS,o),g=s._isKeyDownForAction(s.PAN_LEFT,o),w=s._isKeyDownForAction(s.PAN_RIGHT,o),P=s._isKeyDownForAction(s.PAN_UP,o),E=s._isKeyDownForAction(s.PAN_DOWN,o),T=(o[18]?.3:1)*c*i.keyboardPanRate;(m||b||g||w||P||E)&&(!i.firstPerson&&i.followPointer&&t.pivotController.startPivot(),E?n.panDeltaY+=T:P&&(n.panDeltaY+=-T),w?n.panDeltaX+=-T:g&&(n.panDeltaX+=T),b?n.panDeltaZ+=T:m&&(n.panDeltaZ+=-T))}})}var t=e.prototype;return t.reset=function(){},t.destroy=function(){f(this,Qm)[Qm].viewer.onTick.unsubscribe(f(this,tb)[tb]),document.removeEventListener("mousemove",f(this,Jm)[Jm]),document.removeEventListener("keydown",f(this,$m)[$m]),document.removeEventListener("keyup",f(this,eb)[eb])},e}(),rb=.001,nb=wt(),ob=/*#__PURE__*/d("onTick"),sb=/*#__PURE__*/d("view"),ab=/*#__PURE__*/function(){function e(e,t,i,r,n){Object.defineProperty(this,ob,{writable:!0,value:void 0}),Object.defineProperty(this,sb,{writable:!0,value:void 0}),f(this,sb)[sb]=e;var o=e.camera,s=t.pickController,a=t.pivotController,c=t.panController,l=1,h=1,u=null;f(this,ob)[ob]=e.viewer.onTick.subscribe(function(){if(i.active&&i.pointerEnabled){var t="default";if(Math.abs(n.dollyDelta)<rb&&(n.dollyDelta=0),Math.abs(n.rotateDeltaX)<rb&&(n.rotateDeltaX=0),Math.abs(n.rotateDeltaY)<rb&&(n.rotateDeltaY=0),0===n.rotateDeltaX&&0===n.rotateDeltaY||(n.dollyDelta=0),i.followPointer&&--l<=0&&(l=1,0!==n.dollyDelta)){if(0===n.rotateDeltaY&&0===n.rotateDeltaX&&i.followPointer&&r.followPointerDirty&&(s.pickCursorPos=r.pointerViewPos,s.schedulePickSurface=!0,s.update(),s.pickResult&&s.pickResult.worldPos?u=s.pickResult.worldPos:(h=1,u=null),r.followPointerDirty=!1),u){var d=Math.abs(Ut(Mt(u,e.camera.eye,nb)));h=d/i.dollyProximityThreshold}h<i.dollyMinSpeed&&(h=i.dollyMinSpeed)}var f=n.dollyDelta*h;if(0===n.rotateDeltaY&&0===n.rotateDeltaX||(!i.firstPerson&&i.followPointer&&a.getPivoting()?(a.continuePivot(n.rotateDeltaY,n.rotateDeltaX),a.showPivot()):(0!==n.rotateDeltaX&&(i.firstPerson?o.pitch(-n.rotateDeltaX):o.orbitPitch(n.rotateDeltaX)),0!==n.rotateDeltaY&&(i.firstPerson?o.yaw(n.rotateDeltaY):o.orbitYaw(n.rotateDeltaY))),n.rotateDeltaX*=i.rotationInertia,n.rotateDeltaY*=i.rotationInertia,t="grabbing"),Math.abs(n.panDeltaX)<rb&&(n.panDeltaX=0),Math.abs(n.panDeltaY)<rb&&(n.panDeltaY=0),Math.abs(n.panDeltaZ)<rb&&(n.panDeltaZ=0),0!==n.panDeltaX||0!==n.panDeltaY||0!==n.panDeltaZ){var v,p,y=wt();if(y[0]=n.panDeltaX,y[1]=n.panDeltaY,y[2]=n.panDeltaZ,i.constrainVertical){o.xUp?(v=o.eye[0],p=o.look[0]):o.yUp?(v=o.eye[1],p=o.look[1]):o.zUp&&(v=o.eye[2],p=o.look[2]),o.pan(y);var m=o.eye,b=o.look;o.xUp?(m[0]=v,b[0]=p):o.yUp?(m[1]=v,b[1]=p):o.zUp&&(m[2]=v,b[2]=p),o.eye=m,o.look=b}else o.pan(y);t="grabbing"}if(n.panDeltaX*=i.panInertia,n.panDeltaY*=i.panInertia,n.panDeltaZ*=i.panInertia,0!==f){var g,w;if(t=f<0?"zoom-in":"zoom-out",i.firstPerson){if(i.constrainVertical&&(o.xUp?(g=o.eye[0],w=o.look[0]):o.yUp?(g=o.eye[1],w=o.look[1]):o.zUp&&(g=o.eye[2],w=o.look[2])),i.followPointer?c.dollyToViewPos(u,r.pointerViewPos,-f)&&(r.followPointerDirty=!0):(o.pan([0,0,f]),o.orthoProjection.scale=o.orthoProjection.scale-f),i.constrainVertical){var P=o.eye,E=o.look;o.xUp?(P[0]=g,E[0]=w):o.yUp?(P[1]=g,E[1]=w):o.zUp&&(P[2]=g,E[2]=w),o.eye=P,o.look=E}}else i.followPointer?c.dollyToViewPos(u,r.pointerViewPos,-f)&&(r.followPointerDirty=!0):(o.orthoProjection.scale=o.orthoProjection.scale+f,o.zoom(f));n.dollyDelta*=i.dollyInertia}s.fireEvents(),document.body.style.cursor=t}})}return e.prototype.destroy=function(){f(this,sb)[sb].viewer.onTick.unsubscribe(f(this,ob)[ob])},e}(),cb=/*#__PURE__*/d("view"),lb=/*#__PURE__*/d("mouseEnterHandler"),hb=/*#__PURE__*/d("mouseMoveHandler"),ub=/*#__PURE__*/d("mouseLeaveHandler"),db=/*#__PURE__*/d("mouseDownHandler"),fb=/*#__PURE__*/d("mouseUpHandler"),vb=/*#__PURE__*/function(){function e(e,t,i,r,n){Object.defineProperty(this,cb,{writable:!0,value:void 0}),Object.defineProperty(this,lb,{writable:!0,value:void 0}),Object.defineProperty(this,hb,{writable:!0,value:void 0}),Object.defineProperty(this,ub,{writable:!0,value:void 0}),Object.defineProperty(this,db,{writable:!0,value:void 0}),Object.defineProperty(this,fb,{writable:!0,value:void 0}),f(this,cb)[cb]=e.view;var o=f(this,cb)[cb].canvasElement;o.addEventListener("mouseenter",f(this,lb)[lb]=function(){r.mouseover=!0}),o.addEventListener("mouseleave",f(this,ub)[ub]=function(){r.mouseover=!1,o.style.cursor=null}),document.addEventListener("mousemove",f(this,hb)[hb]=function(e){pb(e,o,r.pointerViewPos)}),o.addEventListener("mousedown",f(this,db)[db]=function(e){i.active&&i.pointerEnabled&&(pb(e,o,r.pointerViewPos),r.mouseover=!0)}),o.addEventListener("mouseup",f(this,fb)[fb]=function(e){})}var t=e.prototype;return t.reset=function(){},t.destroy=function(){var e=f(this,cb)[cb].canvasElement;document.removeEventListener("mousemove",f(this,hb)[hb]),e.removeEventListener("mouseenter",f(this,lb)[lb]),e.removeEventListener("mouseleave",f(this,ub)[ub]),e.removeEventListener("mousedown",f(this,db)[db]),e.removeEventListener("mouseup",f(this,fb)[fb])},e}();function pb(e,t,i){if(e){var r=t.getBoundingClientRect(),n=r.y;i[0]=e.clientX-r.x,i[1]=e.clientY-n}else e=window.event,i[0]=e.x,i[1]=e.y;return i}var yb=function(e,t){if(e){for(var i=e.target,r=0,n=0;i.offsetParent;)r+=i.offsetLeft,n+=i.offsetTop,i=i.offsetParent;t[0]=e.pageX-r,t[1]=e.pageY-n}else e=window.event,t[0]=e.x,t[1]=e.y;return t},mb=/*#__PURE__*/d("view"),bb=/*#__PURE__*/d("onTick"),gb=/*#__PURE__*/d("canvasTouchStartHandler"),wb=/*#__PURE__*/d("canvasTouchMoveHandler"),Pb=/*#__PURE__*/function(){function e(e,t,i,r,n){var o=this;Object.defineProperty(this,mb,{writable:!0,value:void 0}),Object.defineProperty(this,bb,{writable:!0,value:void 0}),Object.defineProperty(this,gb,{writable:!0,value:void 0}),Object.defineProperty(this,wb,{writable:!0,value:void 0}),f(this,mb)[mb]=e.view;var s=t.pickController,a=t.pivotController,c=gt(),l=gt(),h=gt(),u=gt(),d=[],v=f(this,mb)[mb].canvasElement,p=0,y=!1;f(this,bb)[bb]=f(this,mb)[mb].viewer.onTick.subscribe(function(){y=!1}),v.addEventListener("touchstart",f(this,gb)[gb]=function(e){if(i.active&&i.pointerEnabled){e.preventDefault();var t=e.touches,n=e.changedTouches;for(r.touchStartTime=Date.now(),1===t.length&&1===n.length&&(yb(t[0],c),i.followPointer&&(s.pickCursorPos=c,s.schedulePickSurface=!0,s.update(),i.planView||(s.picked&&s.pickedSurface&&s.pickResult&&s.pickResult.worldPos?(a.setPivotPos(s.pickResult.worldPos),!i.firstPerson&&a.startPivot()&&a.showPivot()):(i.smartPivot?a.setCanvasPivotPos(r.pointerCanvasPos):a.setPivotPos(f(o,mb)[mb].camera.look),!i.firstPerson&&a.startPivot()&&a.showPivot()))));d.length<t.length;)d.push(gt());for(var l=0,h=t.length;l<h;++l)yb(t[l],d[l]);p=t.length}}),v.addEventListener("touchmove",f(this,wb)[wb]=function(e){if(i.active&&i.pointerEnabled&&(e.stopPropagation(),e.preventDefault(),!y)){y=!0;var t=f(o,mb)[mb].boundary,a=t[0],c=t[1],v=e.touches;if(e.touches.length===p){if(1===p){yb(v[0],l),Ot(l,d[0],u);var m=u[0],b=u[1];if(null!==r.longTouchTimeout&&(Math.abs(m)>i.longTapRadius||Math.abs(b)>i.longTapRadius)&&(clearTimeout(r.longTouchTimeout),r.longTouchTimeout=null),i.planView){var g=f(o,mb)[mb].camera;if(g.projectionType===et){var w=Math.abs(f(o,mb)[mb].camera.eyeLookDist)*Math.tan(g.perspectiveProjection.fov/2*Math.PI/180);n.panDeltaX+=m*w/c*i.touchPanRate,n.panDeltaY+=b*w/c*i.touchPanRate}else n.panDeltaX+=.5*g.orthoProjection.scale*(m/c)*i.touchPanRate,n.panDeltaY+=.5*g.orthoProjection.scale*(b/c)*i.touchPanRate}else n.rotateDeltaY-=m/a*(1*i.dragRotationRate),n.rotateDeltaX+=b/c*(1.5*i.dragRotationRate)}else if(2===p){var P=v[0],E=v[1];yb(P,l),yb(E,h);var T=jt(d[0],d[1]),_=jt(l,h),I=gt();Ot(T,_,I);var x=I[0],S=I[1],M=f(o,mb)[mb].camera,O=Xt([P.pageX,P.pageY],[E.pageX,E.pageY]),j=(Xt(d[0],d[1])-O)*i.touchDollyRate;if(n.dollyDelta=j,Math.abs(j)<1)if(M.projectionType===et){var R=s.pickResult?s.pickResult.worldPos:Or(f(o,mb)[mb].aabb),D=Math.abs(Ut(Mt(R,f(o,mb)[mb].camera.eye,[])))*Math.tan(M.perspectiveProjection.fov/2*Math.PI/180);n.panDeltaX-=x*D/c*i.touchPanRate,n.panDeltaY-=S*D/c*i.touchPanRate}else n.panDeltaX-=.5*M.orthoProjection.scale*(x/c)*i.touchPanRate,n.panDeltaY-=.5*M.orthoProjection.scale*(S/c)*i.touchPanRate;r.pointerCanvasPos=_}for(var A=0;A<p;++A)yb(v[A],d[A])}}})}var t=e.prototype;return t.reset=function(){},t.destroy=function(){var e=f(this,mb)[mb].canvasElement;e.removeEventListener("touchstart",f(this,gb)[gb]),e.removeEventListener("touchmove",f(this,wb)[wb]),f(this,mb)[mb].viewer.onTick.unsubscribe(f(this,bb)[bb])},e}(),Eb=/*#__PURE__*/d("view"),Tb=/*#__PURE__*/function(){function e(e,t,i,r,n){var o=this;Object.defineProperty(this,Eb,{writable:!0,value:void 0}),this._canvasTouchStartHandler=void 0,this._canvasTouchEndHandler=void 0,f(this,Eb)[Eb]=e.view;var s,a=t.pickController,c=t.cameraControl,l=[],h=new Float32Array(2),u=-1,d=-1,v=f(this,Eb)[Eb].canvas.canvas,p=function(e){var i;e&&e.worldPos&&(i=e.worldPos);var r=e&&e.viewObject?e.viewObject.aabb:f(o,Eb)[Eb].viewer.aabb;if(i){var n=f(o,Eb)[Eb].camera;Mt(n.eye,n.look,[]),t.cameraFlight.flyTo({aabb:r})}else t.cameraFlight.flyTo({aabb:r})};v.addEventListener("touchstart",this._canvasTouchStartHandler=function(e){if(i.active&&i.pointerEnabled){null!==r.longTouchTimeout&&(clearTimeout(r.longTouchTimeout),r.longTouchTimeout=null);var n=e.touches,o=e.changedTouches;if(s=Date.now(),1===n.length&&1===o.length){u=s,h[0]=n[0].pageX,h[1]=n[0].pageY;var a=n[0].clientX,d=n[0].clientY,f=n[0].pageX,v=n[0].pageY;r.longTouchTimeout=setTimeout(function(){t.cameraControl.onRightClick.dispatch(c,{pagePos:[Math.round(f),Math.round(v)],canvasPos:[Math.round(a),Math.round(d)],event:e}),r.longTouchTimeout=null},i.longTapTimeout)}else u=-1;for(;l.length<n.length;)l.push(new Float32Array(2));for(var p=0,y=n.length;p<y;++p)l[p][0]=n[p].pageX,l[p][1]=n[p].pageY;l.length=n.length}},{passive:!0}),v.addEventListener("touchend",this._canvasTouchEndHandler=function(e){if(i.active&&i.pointerEnabled){var t=Date.now(),n=e.touches,o=e.changedTouches,s=c.events.hasSubs("pickedSurface");null!==r.longTouchTimeout&&(clearTimeout(r.longTouchTimeout),r.longTouchTimeout=null),0===n.length&&1===o.length&&u>-1&&t-u<150&&(d>-1&&u-d<325?(a.pickCursorPos[0]=Math.round(o[0].clientX),a.pickCursorPos[1]=Math.round(o[0].clientY),a.schedulePickEntity=!0,a.schedulePickSurface=s,a.update(),a.pickResult?(c.onDoublePickedSurface.dispatch(c,a.pickResult),a.pickedSurface&&c.onPickedSurface.dispatch(c,a.pickResult),i.doublePickFlyTo&&p(a.pickResult)):(c.onDoublePickedNothing.dispatch(c,null),i.doublePickFlyTo&&p()),d=-1):Xt(l[0],h)<4&&(a.pickCursorPos[0]=Math.round(o[0].clientX),a.pickCursorPos[1]=Math.round(o[0].clientY),a.schedulePickEntity=!0,a.schedulePickSurface=s,a.update(),a.pickResult?(c.onPicked.dispatch(c,a.pickResult),a.pickedSurface&&c.onPickedSurface.dispatch(c,a.pickResult)):c.onPickedNothing.dispatch(c),d=t),u=-1),l.length=n.length;for(var f=0,v=n.length;f<v;++f)l[f][0]=n[f].pageX,l[f][1]=n[f].pageY;e.stopPropagation()}},{passive:!0})}var t=e.prototype;return t.reset=function(){},t.destroy=function(){var e=f(this,Eb)[Eb].canvas.canvas;e.removeEventListener("touchstart",this._canvasTouchStartHandler),e.removeEventListener("touchend",this._canvasTouchEndHandler)},e}(),_b=/*#__PURE__*/d("components"),Ib=/*#__PURE__*/d("configs"),xb=/*#__PURE__*/d("states"),Sb=/*#__PURE__*/d("updates"),Mb=/*#__PURE__*/d("controllers"),Ob=/*#__PURE__*/d("handlers"),jb=/*#__PURE__*/d("cameraUpdater"),Rb=/*#__PURE__*/d("reset"),Db=/*#__PURE__*/d("destroyHandlers"),Ab=/*#__PURE__*/d("destroyControllers"),Cb=/*#__PURE__*/function(e){function t(t,i){var r;return r=e.call(this,t,i)||this,Object.defineProperty(c(r),Ab,{value:Lb}),Object.defineProperty(c(r),Db,{value:Bb}),Object.defineProperty(c(r),Rb,{value:kb}),r.view=void 0,r.canvasElement=void 0,r.camera=void 0,Object.defineProperty(c(r),_b,{writable:!0,value:void 0}),Object.defineProperty(c(r),Ib,{writable:!0,value:void 0}),Object.defineProperty(c(r),xb,{writable:!0,value:void 0}),Object.defineProperty(c(r),Sb,{writable:!0,value:void 0}),Object.defineProperty(c(r),Mb,{writable:!0,value:void 0}),Object.defineProperty(c(r),Ob,{writable:!0,value:void 0}),Object.defineProperty(c(r),jb,{writable:!0,value:void 0}),r.onRightClick=void 0,r.onHover=void 0,r.onHoverSurface=void 0,r.onHoverOff=void 0,r.onHoverEnter=void 0,r.onHoverOut=void 0,r.onPicked=void 0,r.onPickedSurface=void 0,r.onPickedNothing=void 0,r.onDoublePickedSurface=void 0,r.onDoublePickedNothing=void 0,r.view=t,r.camera=t.camera,t.canvasElement.oncontextmenu=function(e){e.preventDefault()},f(c(r),_b)[_b]={view:t,camera:r.camera},f(c(r),Ib)[Ib]={longTapTimeout:600,longTapRadius:5,active:!0,keyboardLayout:"qwerty",navMode:"orbit",planView:!1,firstPerson:!1,followPointer:!0,doublePickFlyTo:!0,panRightClick:!0,showPivot:!1,pointerEnabled:!0,constrainVertical:!1,smartPivot:!1,dragRotationRate:360,keyboardRotationRate:90,rotationInertia:0,keyboardPanRate:1,touchPanRate:1,panInertia:.5,keyboardDollyRate:10,mouseWheelDollyRate:100,touchDollyRate:.2,dollyInertia:0,dollyProximityThreshold:30,dollyMinSpeed:.04,keyboardEnabled:!0,keyMap:{}},f(c(r),xb)[xb]={pointerCanvasPos:gt(),mouseover:!1,followPointerDirty:!0,mouseDownClientX:0,mouseDownClientY:0,mouseDownCursorX:0,mouseDownCursorY:0,touchStartTime:null,activeTouches:[],tapStartPos:gt(),tapStartTime:-1,lastTapTime:-1,longTouchTimeout:null,altDown:!1,ctrlDown:!1,keyDown:[],shiftDown:!1},f(c(r),Sb)[Sb]={rotateDeltaX:0,rotateDeltaY:0,panDeltaX:0,panDeltaY:0,panDeltaZ:0,dollyDelta:0},f(c(r),Mb)[Mb]={cameraControl:c(r),pickController:new wm(c(r),f(c(r),Ib)[Ib]),pivotController:new fm(c(r),f(c(r),Ib)[Ib]),panController:new Uy(c(r)),cameraFlight:new ol(r.view,{duration:.5})},f(c(r),Ob)[Ob]=[new vb(f(c(r),_b)[_b],f(c(r),Mb)[Mb],f(c(r),Ib)[Ib],f(c(r),xb)[xb],f(c(r),Sb)[Sb]),new Pb(f(c(r),_b)[_b],f(c(r),Mb)[Mb],f(c(r),Ib)[Ib],f(c(r),xb)[xb],f(c(r),Sb)[Sb]),new Dm(f(c(r),_b)[_b],f(c(r),Mb)[Mb],f(c(r),Ib)[Ib],f(c(r),xb)[xb],f(c(r),Sb)[Sb]),new Vm(f(c(r),_b)[_b],f(c(r),Mb)[Mb],f(c(r),Ib)[Ib],f(c(r),xb)[xb],f(c(r),Sb)[Sb]),new Zm(f(c(r),_b)[_b],f(c(r),Mb)[Mb],f(c(r),Ib)[Ib],f(c(r),xb)[xb],f(c(r),Sb)[Sb]),new Tb(f(c(r),_b)[_b],f(c(r),Mb)[Mb],f(c(r),Ib)[Ib],f(c(r),xb)[xb],f(c(r),Sb)[Sb]),new ib(f(c(r),_b)[_b],f(c(r),Mb)[Mb],f(c(r),Ib)[Ib],f(c(r),xb)[xb],f(c(r),Sb)[Sb])],f(c(r),jb)[jb]=new ab(c(r),f(c(r),Mb)[Mb],f(c(r),Ib)[Ib],f(c(r),xb)[xb],f(c(r),Sb)[Sb]),r.onHover=new p(new te.EventDispatcher),r.onHoverOff=new p(new te.EventDispatcher),r.onHoverEnter=new p(new te.EventDispatcher),r.onHoverOut=new p(new te.EventDispatcher),r.navMode=i.navMode,r.constrainVertical=i.constrainVertical,r.keyMap=i.keyMap,r.doublePickFlyTo=i.doublePickFlyTo,r.panRightClick=i.panRightClick,r.active=i.active,r.followPointer=i.followPointer,r.rotationInertia=i.rotationInertia,r.keyboardPanRate=i.keyboardPanRate,r.touchPanRate=i.touchPanRate,r.keyboardRotationRate=i.keyboardRotationRate,r.dragRotationRate=i.dragRotationRate,r.touchDollyRate=i.touchDollyRate,r.dollyInertia=i.dollyInertia,r.dollyProximityThreshold=i.dollyProximityThreshold,r.dollyMinSpeed=i.dollyMinSpeed,r.panInertia=i.panInertia,r.pointerEnabled=!0,r.keyboardDollyRate=i.keyboardDollyRate,r.mouseWheelDollyRate=i.mouseWheelDollyRate,r.keyboardEnabled=i.keyboardEnabled,r}r(t,e);var n=t.prototype;return n._isKeyDownForAction=function(e,t){var i=f(this,Ib)[Ib].keyMap[e];if(!i)return!1;t||(t=f(this,xb)[xb].keyDown);for(var r=0,n=i.length;r<n;r++)if(t[i[r]])return!0;return!1},n.destroy=function(){f(this,Db)[Db](),f(this,Ab)[Ab](),f(this,jb)[jb].destroy(),this.onHover.clear(),this.onHoverOff.clear(),this.onHoverEnter.clear(),this.onHoverOut.clear(),e.prototype.destroy.call(this)},i(t,[{key:"keyMap",get:function(){return f(this,Ib)[Ib].keyMap},set:function(e){if(tr(e=e||"qwerty")){var i={};switch(e){default:this.error("Unsupported value for 'keyMap': "+e+" defaulting to 'qwerty'");case"qwerty":i[t.PAN_LEFT]=[65],i[t.PAN_RIGHT]=[68],i[t.PAN_UP]=[90],i[t.PAN_DOWN]=[88],i[t.PAN_BACKWARDS]=[],i[t.PAN_FORWARDS]=[],i[t.DOLLY_FORWARDS]=[87,107],i[t.DOLLY_BACKWARDS]=[83,109],i[t.ROTATE_X_POS]=[40],i[t.ROTATE_X_NEG]=[38],i[t.ROTATE_Y_POS]=[81,37],i[t.ROTATE_Y_NEG]=[69,39],i[t.AXIS_VIEW_RIGHT]=[49],i[t.AXIS_VIEW_BACK]=[50],i[t.AXIS_VIEW_LEFT]=[51],i[t.AXIS_VIEW_FRONT]=[52],i[t.AXIS_VIEW_TOP]=[53],i[t.AXIS_VIEW_BOTTOM]=[54];break;case"azerty":i[t.PAN_LEFT]=[81],i[t.PAN_RIGHT]=[68],i[t.PAN_UP]=[87],i[t.PAN_DOWN]=[88],i[t.PAN_BACKWARDS]=[],i[t.PAN_FORWARDS]=[],i[t.DOLLY_FORWARDS]=[90,107],i[t.DOLLY_BACKWARDS]=[83,109],i[t.ROTATE_X_POS]=[40],i[t.ROTATE_X_NEG]=[38],i[t.ROTATE_Y_POS]=[65,37],i[t.ROTATE_Y_NEG]=[69,39],i[t.AXIS_VIEW_RIGHT]=[49],i[t.AXIS_VIEW_BACK]=[50],i[t.AXIS_VIEW_LEFT]=[51],i[t.AXIS_VIEW_FRONT]=[52],i[t.AXIS_VIEW_TOP]=[53],i[t.AXIS_VIEW_BOTTOM]=[54]}f(this,Ib)[Ib].keyMap=i}else{var r=e;f(this,Ib)[Ib].keyMap=r}}},{key:"pivotElement",set:function(e){f(this,Mb)[Mb].pivotController.setPivotElement(e)}},{key:"active",get:function(){return f(this,Ib)[Ib].active},set:function(e){f(this,Ib)[Ib].active=!1!==e}},{key:"navMode",get:function(){return f(this,Ib)[Ib].navMode},set:function(e){"firstPerson"!==(e=e||"orbit")&&"orbit"!==e&&"planView"!==e&&(this.error("Unsupported value for navMode: "+e+" - supported values are 'orbit', 'firstPerson' and 'planView' - defaulting to 'orbit'"),e="orbit"),f(this,Ib)[Ib].firstPerson="firstPerson"===e,f(this,Ib)[Ib].planView="planView"===e,(f(this,Ib)[Ib].firstPerson||f(this,Ib)[Ib].planView)&&(f(this,Mb)[Mb].pivotController.hidePivot(),f(this,Mb)[Mb].pivotController.endPivot()),f(this,Ib)[Ib].navMode=e}},{key:"pointerEnabled",get:function(){return f(this,Ib)[Ib].pointerEnabled},set:function(e){f(this,Rb)[Rb](),f(this,Ib)[Ib].pointerEnabled=!!e}},{key:"followPointer",get:function(){return f(this,Ib)[Ib].followPointer},set:function(e){f(this,Ib)[Ib].followPointer=!1!==e}},{key:"pivotPos",get:function(){return f(this,Mb)[Mb].pivotController.getPivotPos()},set:function(e){f(this,Mb)[Mb].pivotController.setPivotPos(e)}},{key:"dollyToPointer",get:function(){return this.warn("dollyToPointer property is deprecated - replaced with followPointer"),this.followPointer},set:function(e){this.warn("dollyToPointer property is deprecated - replaced with followPointer"),this.followPointer=e}},{key:"panToPointer",get:function(){return this.warn("panToPointer property is deprecated - replaced with followPointer"),!1},set:function(e){this.warn("panToPointer property is deprecated - replaced with followPointer")}},{key:"planView",get:function(){return this.warn("planView property is deprecated - replaced with navMode"),f(this,Ib)[Ib].planView},set:function(e){f(this,Ib)[Ib].planView=!!e,f(this,Ib)[Ib].firstPerson=!1,f(this,Ib)[Ib].planView&&(f(this,Mb)[Mb].pivotController.hidePivot(),f(this,Mb)[Mb].pivotController.endPivot()),this.warn("planView property is deprecated - replaced with navMode")}},{key:"firstPerson",get:function(){return this.warn("firstPerson property is deprecated - replaced with navMode"),f(this,Ib)[Ib].firstPerson},set:function(e){this.warn("firstPerson property is deprecated - replaced with navMode"),f(this,Ib)[Ib].firstPerson=!!e,f(this,Ib)[Ib].planView=!1,f(this,Ib)[Ib].firstPerson&&(f(this,Mb)[Mb].pivotController.hidePivot(),f(this,Mb)[Mb].pivotController.endPivot())}},{key:"constrainVertical",get:function(){return f(this,Ib)[Ib].constrainVertical},set:function(e){f(this,Ib)[Ib].constrainVertical=!!e}},{key:"doublePickFlyTo",get:function(){return f(this,Ib)[Ib].doublePickFlyTo},set:function(e){f(this,Ib)[Ib].doublePickFlyTo=!1!==e}},{key:"panRightClick",get:function(){return f(this,Ib)[Ib].panRightClick},set:function(e){f(this,Ib)[Ib].panRightClick=!1!==e}},{key:"rotationInertia",get:function(){return f(this,Ib)[Ib].rotationInertia},set:function(e){f(this,Ib)[Ib].rotationInertia=null!=e?e:0}},{key:"touchPanRate",get:function(){return f(this,Ib)[Ib].touchPanRate},set:function(e){f(this,Ib)[Ib].touchPanRate=null!=e?e:1}},{key:"keyboardPanRate",get:function(){return f(this,Ib)[Ib].keyboardPanRate},set:function(e){f(this,Ib)[Ib].keyboardPanRate=null!=e?e:5}},{key:"keyboardRotationRate",get:function(){return f(this,Ib)[Ib].keyboardRotationRate},set:function(e){f(this,Ib)[Ib].keyboardRotationRate=null!=e?e:90}},{key:"dragRotationRate",get:function(){return f(this,Ib)[Ib].dragRotationRate},set:function(e){f(this,Ib)[Ib].dragRotationRate=null!=e?e:360}},{key:"keyboardDollyRate",get:function(){return f(this,Ib)[Ib].keyboardDollyRate},set:function(e){f(this,Ib)[Ib].keyboardDollyRate=null!=e?e:15}},{key:"touchDollyRate",get:function(){return f(this,Ib)[Ib].touchDollyRate},set:function(e){f(this,Ib)[Ib].touchDollyRate=null!=e?e:.2}},{key:"mouseWheelDollyRate",get:function(){return f(this,Ib)[Ib].mouseWheelDollyRate},set:function(e){f(this,Ib)[Ib].mouseWheelDollyRate=null!=e?e:100}},{key:"dollyInertia",get:function(){return f(this,Ib)[Ib].dollyInertia},set:function(e){f(this,Ib)[Ib].dollyInertia=null!=e?e:0}},{key:"dollyProximityThreshold",get:function(){return f(this,Ib)[Ib].dollyProximityThreshold},set:function(e){f(this,Ib)[Ib].dollyProximityThreshold=null!=e?e:35}},{key:"dollyMinSpeed",get:function(){return f(this,Ib)[Ib].dollyMinSpeed},set:function(e){f(this,Ib)[Ib].dollyMinSpeed=null!=e?e:.04}},{key:"panInertia",get:function(){return f(this,Ib)[Ib].panInertia},set:function(e){f(this,Ib)[Ib].panInertia=null!=e?e:.5}},{key:"keyboardLayout",get:function(){return f(this,Ib)[Ib].keyboardLayout},set:function(e){"qwerty"!==(e=e||"qwerty")&&"azerty"!==e&&(this.error("Unsupported value for keyboardLayout - defaulting to 'qwerty'"),e="qwerty"),f(this,Ib)[Ib].keyboardLayout=e,this.keyMap=f(this,Ib)[Ib].keyboardLayout}},{key:"smartPivot",get:function(){return f(this,Ib)[Ib].smartPivot},set:function(e){f(this,Ib)[Ib].smartPivot=!1!==e}},{key:"keyboardEnabled",get:function(){return f(this,Ib)[Ib].keyboardEnabled},set:function(e){f(this,Ib)[Ib].keyboardEnabled=!1!==e}}]),t}(ae);function kb(){for(var e=0,t=f(this,Ob)[Ob].length;e<t;e++){var i=f(this,Ob)[Ob][e];i.reset&&i.reset()}f(this,Sb)[Sb].panDeltaX=0,f(this,Sb)[Sb].panDeltaY=0,f(this,Sb)[Sb].rotateDeltaX=0,f(this,Sb)[Sb].rotateDeltaY=0,f(this,Sb)[Sb].dollyDelta=0}function Bb(){for(var e=0,t=f(this,Ob)[Ob].length;e<t;e++){var i=f(this,Ob)[Ob][e];i.destroy&&i.destroy()}}function Lb(){for(var e in f(this,Mb)[Mb]){var t=f(this,Mb)[Mb][e];t.destroy&&t.destroy()}}Cb.PAN_LEFT=0,Cb.PAN_RIGHT=1,Cb.PAN_UP=2,Cb.PAN_DOWN=3,Cb.PAN_FORWARDS=4,Cb.PAN_BACKWARDS=5,Cb.ROTATE_X_POS=6,Cb.ROTATE_X_NEG=7,Cb.ROTATE_Y_POS=8,Cb.ROTATE_Y_NEG=9,Cb.DOLLY_FORWARDS=10,Cb.DOLLY_BACKWARDS=11,Cb.AXIS_VIEW_RIGHT=12,Cb.AXIS_VIEW_BACK=13,Cb.AXIS_VIEW_LEFT=14,Cb.AXIS_VIEW_FRONT=15,Cb.AXIS_VIEW_TOP=16,Cb.AXIS_VIEW_BOTTOM=17;var Fb={__proto__:null,keycodes:{__proto__:null,KEY_BACKSPACE:8,KEY_TAB:9,KEY_ENTER:13,KEY_SHIFT:16,KEY_CTRL:17,KEY_ALT:18,KEY_PAUSE_BREAK:19,KEY_CAPS_LOCK:20,KEY_ESCAPE:27,KEY_PAGE_UP:33,KEY_PAGE_DOWN:34,KEY_END:35,KEY_HOME:36,KEY_LEFT_ARROW:37,KEY_UP_ARROW:38,KEY_RIGHT_ARROW:39,KEY_DOWN_ARROW:40,KEY_INSERT:45,KEY_DELETE:46,KEY_NUM_0:48,KEY_NUM_1:49,KEY_NUM_2:50,KEY_NUM_3:51,KEY_NUM_4:52,KEY_NUM_5:53,KEY_NUM_6:54,KEY_NUM_7:55,KEY_NUM_8:56,KEY_NUM_9:57,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,KEY_LEFT_WINDOW:91,KEY_RIGHT_WINDOW:92,KEY_SELECT_KEY:93,KEY_NUMPAD_0:96,KEY_NUMPAD_1:97,KEY_NUMPAD_2:98,KEY_NUMPAD_3:99,KEY_NUMPAD_4:100,KEY_NUMPAD_5:101,KEY_NUMPAD_6:102,KEY_NUMPAD_7:103,KEY_NUMPAD_8:104,KEY_NUMPAD_9:105,KEY_MULTIPLY:106,KEY_ADD:107,KEY_SUBTRACT:109,KEY_DECIMAL_POINT:110,KEY_DIVIDE:111,KEY_F1:112,KEY_F2:113,KEY_F3:114,KEY_F4:115,KEY_F5:116,KEY_F6:117,KEY_F7:118,KEY_F8:119,KEY_F9:120,KEY_F10:121,KEY_F11:122,KEY_F12:123,KEY_NUM_LOCK:144,KEY_SCROLL_LOCK:145,KEY_SEMI_COLON:186,KEY_EQUAL_SIGN:187,KEY_COMMA:188,KEY_DASH:189,KEY_PERIOD:190,KEY_FORWARD_SLASH:191,KEY_GRAVE_ACCENT:192,KEY_OPEN_BRACKET:219,KEY_BACK_SLASH:220,KEY_CLOSE_BRACKET:221,KEY_SINGLE_QUOTE:222,KEY_SPACE:32},CameraControl:Cb},Ub=/*#__PURE__*/d("linkType"),Nb=/*#__PURE__*/d("groupTypes"),Vb=/*#__PURE__*/d("containerElement"),Gb=/*#__PURE__*/d("hierarchy"),Hb=/*#__PURE__*/d("dataModels"),Xb=/*#__PURE__*/d("autoAddModels"),Wb=/*#__PURE__*/d("autoExpandDepth"),Yb=/*#__PURE__*/d("sortNodes"),Kb=/*#__PURE__*/d("pruneEmptyNodes"),zb=/*#__PURE__*/d("viewer"),qb=/*#__PURE__*/d("rootElement"),Zb=/*#__PURE__*/d("muteSceneEvents"),Qb=/*#__PURE__*/d("muteTreeEvents"),Jb=/*#__PURE__*/d("rootNodes"),$b=/*#__PURE__*/d("objectNodes"),eg=/*#__PURE__*/d("rootName"),tg=/*#__PURE__*/d("showListItemElementId"),ig=/*#__PURE__*/d("spatialSortFunc"),rg=/*#__PURE__*/d("switchExpandHandler"),ng=/*#__PURE__*/d("switchCollapseHandler"),og=/*#__PURE__*/d("checkboxChangeHandler"),sg=/*#__PURE__*/d("destroyed"),ag=/*#__PURE__*/d("onViewObjectVisibility"),cg=/*#__PURE__*/d("onViewObjectXRayed"),lg=/*#__PURE__*/d("dataObjectSceneObjectCounts"),hg=/*#__PURE__*/d("addModel"),ug=/*#__PURE__*/d("removeModel"),dg=/*#__PURE__*/d("rebuildNodes"),fg=/*#__PURE__*/d("validate"),vg=/*#__PURE__*/d("validateMetaModelForStoreysHierarchy"),pg=/*#__PURE__*/d("createEnabledNodes"),yg=/*#__PURE__*/d("createDisabledNodes"),mg=/*#__PURE__*/d("findEmptyNodes"),bg=/*#__PURE__*/d("findEmptyNodes2"),gg=/*#__PURE__*/d("buildGroupsNodes"),wg=/*#__PURE__*/d("buildGroupsNodes2"),Pg=/*#__PURE__*/d("buildTypesNodes"),Eg=/*#__PURE__*/d("buildTypesNodes2"),Tg=/*#__PURE__*/d("buildAggregationNodes"),_g=/*#__PURE__*/d("buildAggregationNodes2"),Ig=/*#__PURE__*/d("doSortNodes"),xg=/*#__PURE__*/d("sortChildNodes"),Sg=/*#__PURE__*/d("getSpatialSortFunc"),Mg=/*#__PURE__*/d("alphaSortFunc"),Og=/*#__PURE__*/d("synchNodesToEntities"),jg=/*#__PURE__*/d("withNodeTree"),Rg=/*#__PURE__*/d("createNodeElements"),Dg=/*#__PURE__*/d("createNodeElement"),Ag=/*#__PURE__*/d("expandSwitchElement"),Cg=/*#__PURE__*/d("collapseNode"),kg=/*#__PURE__*/d("collapseSwitchElement"),Bg=/*#__PURE__*/function(e){function t(i){var r;if(r=e.call(this,null)||this,Object.defineProperty(c(r),kg,{value:cw}),Object.defineProperty(c(r),Cg,{value:aw}),Object.defineProperty(c(r),Ag,{value:sw}),Object.defineProperty(c(r),Dg,{value:ow}),Object.defineProperty(c(r),Rg,{value:nw}),Object.defineProperty(c(r),jg,{value:rw}),Object.defineProperty(c(r),Og,{value:iw}),Object.defineProperty(c(r),Mg,{value:tw}),Object.defineProperty(c(r),Sg,{value:ew}),Object.defineProperty(c(r),xg,{value:$g}),Object.defineProperty(c(r),Ig,{value:Jg}),Object.defineProperty(c(r),_g,{value:Qg}),Object.defineProperty(c(r),Tg,{value:Zg}),Object.defineProperty(c(r),Eg,{value:qg}),Object.defineProperty(c(r),Pg,{value:zg}),Object.defineProperty(c(r),wg,{value:Kg}),Object.defineProperty(c(r),gg,{value:Yg}),Object.defineProperty(c(r),bg,{value:Wg}),Object.defineProperty(c(r),mg,{value:Xg}),Object.defineProperty(c(r),yg,{value:Hg}),Object.defineProperty(c(r),pg,{value:Gg}),Object.defineProperty(c(r),vg,{value:Vg}),Object.defineProperty(c(r),fg,{value:Ng}),Object.defineProperty(c(r),dg,{value:Ug}),Object.defineProperty(c(r),ug,{value:Fg}),Object.defineProperty(c(r),hg,{value:Lg}),r.data=void 0,r.view=void 0,r.onNodeTitleClicked=void 0,r.onContextMenu=void 0,Object.defineProperty(c(r),Ub,{writable:!0,value:void 0}),Object.defineProperty(c(r),Nb,{writable:!0,value:void 0}),Object.defineProperty(c(r),Vb,{writable:!0,value:void 0}),Object.defineProperty(c(r),Gb,{writable:!0,value:void 0}),Object.defineProperty(c(r),Hb,{writable:!0,value:void 0}),Object.defineProperty(c(r),Xb,{writable:!0,value:void 0}),Object.defineProperty(c(r),Wb,{writable:!0,value:void 0}),Object.defineProperty(c(r),Yb,{writable:!0,value:void 0}),Object.defineProperty(c(r),Kb,{writable:!0,value:void 0}),Object.defineProperty(c(r),zb,{writable:!0,value:void 0}),Object.defineProperty(c(r),qb,{writable:!0,value:void 0}),Object.defineProperty(c(r),Zb,{writable:!0,value:void 0}),Object.defineProperty(c(r),Qb,{writable:!0,value:void 0}),Object.defineProperty(c(r),Jb,{writable:!0,value:void 0}),Object.defineProperty(c(r),$b,{writable:!0,value:void 0}),Object.defineProperty(c(r),eg,{writable:!0,value:void 0}),Object.defineProperty(c(r),tg,{writable:!0,value:void 0}),Object.defineProperty(c(r),ig,{writable:!0,value:void 0}),Object.defineProperty(c(r),rg,{writable:!0,value:void 0}),Object.defineProperty(c(r),ng,{writable:!0,value:void 0}),Object.defineProperty(c(r),og,{writable:!0,value:void 0}),Object.defineProperty(c(r),sg,{writable:!0,value:void 0}),Object.defineProperty(c(r),ag,{writable:!0,value:void 0}),Object.defineProperty(c(r),cg,{writable:!0,value:void 0}),Object.defineProperty(c(r),lg,{writable:!0,value:void 0}),!i.containerElement)throw new Error("Config expected: containerElement");if(!i.data)throw new Error("Config expected: data");if(!i.view)throw new Error("Config expected: view");r.data=i.data,r.view=i.view,f(c(r),zb)[zb]=i.view.viewer,f(c(r),Ub)[Ub]=i.linkType,f(c(r),Nb)[Nb]=i.groupTypes,f(c(r),Gb)[Gb]=t.AggregationHierarchy,f(c(r),Vb)[Vb]=i.containerElement,f(c(r),Hb)[Hb]={},f(c(r),Wb)[Wb]=i.autoExpandDepth||0,f(c(r),Yb)[Yb]=!1!==i.sortNodes,f(c(r),Kb)[Kb]=!1!==i.pruneEmptyNodes,f(c(r),qb)[qb]=null,f(c(r),Zb)[Zb]=!1,f(c(r),Qb)[Qb]=!1,f(c(r),Jb)[Jb]=[],f(c(r),$b)[$b]={},f(c(r),eg)[eg]=i.rootName,f(c(r),Yb)[Yb]=i.sortNodes,f(c(r),Kb)[Kb]=i.pruneEmptyNodes,f(c(r),tg)[tg]=null,f(c(r),sg)[sg]=!1,r.onNodeTitleClicked=new p(new te.EventDispatcher),r.onContextMenu=new p(new te.EventDispatcher),r.onDestroyed=new p(new te.EventDispatcher),f(c(r),Vb)[Vb].oncontextmenu=function(e){e.preventDefault()},f(c(r),ag)[ag]=r.view.onObjectVisibility.subscribe(function(e,t){if(!f(c(r),Zb)[Zb]){var i=t.id,n=f(c(r),$b)[$b][i];if(n){var o=t.visible;if(o!==n.checked){f(c(r),Qb)[Qb]=!0,n.checked=o,o?n.numVisibleViewObjects++:n.numVisibleViewObjects--;var s=document.getElementById(n.nodeId);s&&(s.checked=o);for(var a=n.parentNode;a;){a.checked=o,o?a.numVisibleViewObjects++:a.numVisibleViewObjects--;var l=document.getElementById(a.nodeId);if(l){var h=a.numVisibleViewObjects>0;h!==l.checked&&(l.checked=h)}a=a.parentNode}f(c(r),Qb)[Qb]=!1}}}}),f(c(r),cg)[cg]=r.view.onObjectXRayed.subscribe(function(e,t){if(!f(c(r),Zb)[Zb]){var i=t.id,n=f(c(r),$b)[$b][i];if(n){f(c(r),Qb)[Qb]=!0;var o=t.xrayed;if(o!==n.xrayed){n.xrayed=o;var s=document.getElementById("node-"+n.nodeId);null!==s&&(o?s.classList.add("xrayed-node"):s.classList.remove("xrayed-node")),f(c(r),Qb)[Qb]=!1}}}}),f(c(r),rg)[rg]=function(e){e.preventDefault(),e.stopPropagation();var t=e.target;f(c(r),Ag)[Ag](t)},f(c(r),ng)[ng]=function(e){e.preventDefault(),e.stopPropagation();var t=e.target;f(c(r),kg)[kg](t)},f(c(r),og)[og]=function(e){if(!f(c(r),Qb)[Qb]){f(c(r),Zb)[Zb]=!0;var t=e.target,i=t.checked,n=t.id,o=f(c(r),$b)[$b][n],s=r.view.objects,a=0;f(c(r),jg)[jg](o,function(e){var t=e.nodeId,r=s[e.objectId],n=0===e.childNodes.length;e.numVisibleViewObjects=i?e.numViewObjects:0,n&&i!==e.checked&&a++,e.checked=i;var o=document.getElementById(t);o&&(o.checked=i),r&&(r.visible=i)});for(var l=o.parentNode;l;){l.checked=i;var h=document.getElementById(l.nodeId);i?l.numVisibleViewObjects+=a:l.numVisibleViewObjects-=a;var u=l.numVisibleViewObjects>0;u!==h.checked&&(h.checked=u),l=l.parentNode}f(c(r),Zb)[Zb]=!1}},r.hierarchy=i.hierarchy;for(var n=Object.keys(r.data.models),o=0,s=n.length;o<s;o++){var a=n[o];f(c(r),hg)[hg](a)}return f(c(r),zb)[zb].scene.onModelCreated.subscribe(function(e,t){r.data.models[t.id]&&f(c(r),hg)[hg](t.id)}),r}r(t,e);var n=t.prototype;return n.showNode=function(e){f(this,tg)[tg]&&this.unShowNode();var t=f(this,$b)[$b][e];if(t){var i=t.nodeId,r=document.getElementById("switch-"+i);if(r)return f(this,Ag)[Ag](r),void r.scrollIntoView();var n=[];n.unshift(t);for(var o=t.parentNode;o;)n.unshift(o),o=o.parentNode;for(var s=0,a=n.length;s<a;s++){var c=document.getElementById("switch-"+n[s].nodeId);c&&f(this,Ag)[Ag](c)}var l="node-"+i,h=document.getElementById(l);h.scrollIntoView({block:"center"}),h.classList.add("highlighted-node"),f(this,tg)[tg]=l}},n.unShowNode=function(){if(f(this,tg)[tg]){var e=document.getElementById(f(this,tg)[tg]);e?(e.classList.remove("highlighted-node"),f(this,tg)[tg]=null):f(this,tg)[tg]=null}},n.expandToDepth=function(e){var t=this;this.collapse();for(var i=function i(r,n){if(n!==e){var o=document.getElementById("switch-"+r.nodeId);if(o){f(t,Ag)[Ag](o);for(var s=r.childNodes,a=0,c=s.length;a<c;a++)i(s[a],n+1)}}},r=0,n=f(this,Jb)[Jb].length;r<n;r++)i(f(this,Jb)[Jb][r],0)},n.collapse=function(){for(var e=0,t=f(this,Jb)[Jb].length;e<t;e++){var i=f(this,Jb)[Jb][e].objectId;f(this,Cg)[Cg](i)}},n.destroy=function(){f(this,Vb)[Vb]&&(f(this,Hb)[Hb]={},f(this,qb)[qb]&&!f(this,sg)[sg]&&(f(this,qb)[qb].parentNode.removeChild(f(this,qb)[qb]),this.view.onObjectVisibility.unsubscribe(f(this,ag)[ag]),this.view.onObjectXRayed.unsubscribe(f(this,cg)[cg]),f(this,sg)[sg]=!0),e.prototype.destroy.call(this))},i(t,[{key:"hierarchy",get:function(){return f(this,Gb)[Gb]},set:function(e){(e=null!=e?e:t.AggregationHierarchy)!==t.AggregationHierarchy&&e!==t.GroupsHierarchy&&e!==t.TypesHierarchy&&(this.error("Unsupported value for `hierarchy' - defaulting to TreeView.AggregationHierarchy "),e=t.AggregationHierarchy),f(this,Gb)[Gb]!==e&&(f(this,Gb)[Gb]=e,f(this,dg)[dg]())}},{key:"linkType",get:function(){return f(this,Ub)[Ub]},set:function(e){f(this,Ub)[Ub]!==e&&(f(this,Ub)[Ub]=e,f(this,dg)[dg]())}},{key:"groupTypes",get:function(){return f(this,Nb)[Nb]},set:function(e){f(this,Nb)[Nb]!==e&&(f(this,Nb)[Nb]=e,f(this,Gb)[Gb]===t.GroupsHierarchy&&f(this,dg)[dg]())}}]),t}(ae);function Lg(e,t){var i=this;if(f(this,Vb)[Vb]){var r=f(this,zb)[zb].scene.models[e];if(r){var n=this.data.models[e];n?f(this,Hb)[Hb][e]?this.error("Model already added: "+e):(f(this,Hb)[Hb][e]=n,r.onDestroyed.one(function(){f(i,ug)[ug](r.id)}),f(this,dg)[dg]()):this.error("DataModel not found: "+e)}else this.error("SceneModel not found: "+e)}}function Fg(e){f(this,Vb)[Vb]&&f(this,Hb)[Hb][e]&&(delete f(this,Hb)[Hb][e],f(this,dg)[dg]())}function Ug(){f(this,qb)[qb]&&(f(this,qb)[qb].parentNode.removeChild(f(this,qb)[qb]),f(this,qb)[qb]=null),f(this,Jb)[Jb]=[],f(this,$b)[$b]={},f(this,fg)[fg]()?f(this,pg)[pg]():f(this,yg)[yg]()}function Ng(){return f(this,Gb),f(this,Jb)[Jb].length>0}function Vg(e,t,i){return!0}function Gg(){switch(f(this,Kb)[Kb]&&f(this,mg)[mg](),f(this,Gb)[Gb]){case Bg.GroupsHierarchy:f(this,gg)[gg](),0===f(this,Jb)[Jb].length&&this.error("Failed to build hierarchy TreeView.GroupsHierarchy");break;case Bg.TypesHierarchy:f(this,Pg)[Pg]();break;default:f(this,Tg)[Tg]()}f(this,Yb)[Yb]&&f(this,Ig)[Ig](),f(this,Og)[Og](),f(this,Rg)[Rg](),this.expandToDepth(f(this,Wb)[Wb])}function Hg(){var e=this.data.rootObjects;for(var t in e){var i=e[t],r=i.name,n=r&&""!==r&&"Undefined"!==r&&"Default"!==r?r:""+i.type,o=document.createElement("ul"),s=document.createElement("li");o.appendChild(s),f(this,Vb)[Vb].appendChild(o),f(this,qb)[qb]=o;var a=document.createElement("a");a.href="#",a.textContent="!",a.classList.add("warn"),a.classList.add("warning"),s.appendChild(a);var c=document.createElement("span");c.textContent=n,s.appendChild(c)}}function Xg(){var e=this.data.rootObjects;for(var t in e)f(this,bg)[bg](e[t])}function Wg(e){var t=f(this,zb)[zb].scene,i=e.related[f(this,Ub)[Ub]],r=0;if(t.objects[e.id]&&r++,i)for(var n=0,o=i.length;n<o;n++){var s=i[n].relatedObject,a=f(this,bg)[bg](s);f(this,lg)[lg][s.id]=a,r+=a}return f(this,lg)[lg][e.id]=r,r}function Yg(){var e=this.data.rootObjects;for(var t in e)f(this,wg)[wg](e[t],[],null,null,null)}function Kg(e,t,i,r,n){if(!f(this,Kb)[Kb]||f(this,lg)[lg][e.id]){var o=e.id,s=e.type,a=e.name,c=e.related[f(this,Ub)[Ub]];if(t.length<f(this,Nb)[Nb].length){var l=f(this,Nb)[Nb][t.length];if(0===t.length){if(s===l){var h={nodeId:o,objectId:o,title:f(this,eg)[eg]||(a&&""!==a&&"Undefined"!==a&&"Default"!==a?a:s),type:s,parentNode:null,numViewObjects:0,numVisibleViewObjects:0,checked:!1,xrayed:!1,childNodes:[]};t.push(h),f(this,Jb)[Jb].push(h),f(this,$b)[$b][h.objectId]=h}}else if(s===l){var u=t[t.length-1],d={nodeId:o,objectId:o,title:a&&""!==a&&"Undefined"!==a&&"Default"!==a?a:""+s,type:s,parentNode:u,numViewObjects:0,numVisibleViewObjects:0,checked:!1,xrayed:!1,childNodes:[]};u.childNodes.push(d),t.push(d),f(this,$b)[$b][d.objectId]=d}}else{var v=t[t.length-1];if(this.view.objects[o]){var p=(n=n||{})[s];if(!p){var y=v.objectId+"."+s;v.childNodes.push(p={nodeId:y,objectId:y,title:""+s,type:s,parentNode:v,numViewObjects:0,numVisibleViewObjects:0,checked:!1,xrayed:!1,childNodes:[]}),f(this,$b)[$b][y]=p,n[s]=p}var m={nodeId:o,objectId:o,title:a&&""!==a&&"Undefined"!==a&&"Default"!==a?a:""+s,type:s,parentNode:p,numViewObjects:0,numVisibleViewObjects:0,checked:!1,xrayed:!1,childNodes:[]};p.childNodes.push(m),f(this,$b)[$b][m.objectId]=m}}if(c)for(var b=0,g=c.length;b<g;b++){var w=c[b].relatedObject;f(this,wg)[wg](w,t,i,r,n)}}}function zg(){var e=this.data.rootObjects;for(var t in e)f(this,Eg)[Eg](e[t],null,null)}function qg(e,t,i){if(!f(this,Kb)[Kb]||f(this,lg)[lg][e.id]){var r=e.related[f(this,Ub)[Ub]];if(r)for(var n=0,o=r.length;n<o;n++){var s=r[n].relatedObject;f(this,Eg)[Eg](s,t,i)}}}function Zg(){var e=this.data.rootObjects;for(var t in e)f(this,_g)[_g](e[t],null)}function Qg(e,t){if(!f(this,Kb)[Kb]||f(this,lg)[lg][e.id]){var i=e.id,r=e.type,n=e.name||r,o=e.related[f(this,Ub)[Ub]],s={nodeId:i,objectId:i,title:t?n&&""!==n&&"Undefined"!==n&&"Default"!==n?n:r:f(this,eg)[eg]||n,type:r,parentNode:t,numViewObjects:0,numVisibleViewObjects:0,checked:!1,xrayed:!1,childNodes:[]};if(t?t.childNodes.push(s):f(this,Jb)[Jb].push(s),f(this,$b)[$b][s.objectId]=s,o)for(var a=0,c=o.length;a<c;a++){var l=o[a].relatedObject;f(this,_g)[_g](l,s)}}}function Jg(){for(var e=0,t=f(this,Jb)[Jb].length;e<t;e++){var i=f(this,Jb)[Jb][e];f(this,xg)[xg](i)}}function $g(e){}function ew(){}function tw(e,t){var i=e.title.toUpperCase(),r=t.title.toUpperCase();return i<r?-1:i>r?1:0}function iw(){for(var e=Object.keys(this.data.objects),t=this.data.objects,i=this.view.objects,r=0,n=e.length;r<n;r++){var o=e[r];if(t[o]){var s=f(this,$b)[$b][o];if(s){var a=i[o];if(a){var c=a.visible;s.numViewObjects=1,s.xrayed=a.xrayed,c?(s.numVisibleViewObjects=1,s.checked=!0):(s.numVisibleViewObjects=0,s.checked=!1);for(var l=s.parentNode;l;)l.numViewObjects++,c&&(l.numVisibleViewObjects++,l.checked=!0),l=l.parentNode}}}}}function rw(e,t){t(e);var i=e.childNodes;if(i)for(var r=0,n=i.length;r<n;r++)f(this,jg)[jg](i[r],t)}function nw(){var e=this;if(0!==f(this,Jb)[Jb].length){var t=f(this,Jb)[Jb].map(function(t){return f(e,Dg)[Dg](t)}),i=document.createElement("ul");t.forEach(function(e){i.appendChild(e)}),f(this,Vb)[Vb].appendChild(i),f(this,qb)[qb]=i}}function ow(e){var t=this,i=document.createElement("li"),r=e.nodeId;if(e.xrayed&&i.classList.add("xrayed-node"),i.id="node-"+r,e.childNodes.length>0){var n="switch-"+r,o=document.createElement("a");o.href="#",o.id=n,o.textContent="+",o.classList.add("plus"),o.addEventListener("click",f(this,rg)[rg]),i.appendChild(o)}var s=document.createElement("input");s.id=r,s.type="checkbox",s.checked=e.checked,s.style["pointer-events"]="all",s.addEventListener("change",f(this,og)[og]),i.appendChild(s);var a=document.createElement("span");return a.textContent=e.title,i.appendChild(a),a.oncontextmenu=function(i){t.onContextMenu.dispatch(t,{event:i,treeView:t,treeViewNode:e}),i.preventDefault()},a.onclick=function(i){t.onNodeTitleClicked.dispatch(t,{event:i,treeView:t,treeViewNode:e}),i.preventDefault()},i}function sw(e){var t=this,i=e.parentElement;if(i&&!i.getElementsByTagName("li")[0]){var r=i.id.replace("node-",""),n=f(this,$b)[$b][r].childNodes.map(function(e){return f(t,Dg)[Dg](e)}),o=document.createElement("ul");n.forEach(function(e){o.appendChild(e)}),i.appendChild(o),e.classList.remove("plus"),e.classList.add("minus"),e.textContent="-",e.removeEventListener("click",f(this,rg)[rg]),e.addEventListener("click",f(this,ng)[ng])}}function aw(e){var t=document.getElementById("switch-"+e);t&&f(this,kg)[kg](t)}function cw(e){if(e){var t=e.parentElement;if(t){var i=t.querySelector("ul");i&&(t.removeChild(i),e.classList.remove("minus"),e.classList.add("plus"),e.textContent="+",e.removeEventListener("click",f(this,ng)[ng]),e.addEventListener("click",f(this,rg)[rg]))}}}Bg.AggregationHierarchy=void 0,Bg.TypesHierarchy=void 0,Bg.GroupsHierarchy=void 0;var lw={__proto__:null,TreeView:Bg};exports.basictypes=Yo,exports.bcf={__proto__:null,loadBCFViewpoint:function(e){},saveBCFViewpoint:function(e){return{}}},exports.boundaries=Wr,exports.cameracontrol=Fb,exports.cityjson=Us,exports.cityjsontypes=Qo,exports.compression=br,exports.constants=nt,exports.core=ue,exports.curves={__proto__:null,"tangentQuadraticBézier":function(e,t,i,r){return 2*(1-e)*(i-t)+2*e*(r-i)},"tangentQuadraticBézier3":function(e,t,i,r,n){return-3*t*(1-e)*(1-e)+3*i*(1-e)*(1-e)-6*e*i*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*n},tangentSpline:function(e){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},catmullRomInterpolate:function(e,t,i,r,n){var o=.5*(i-e),s=.5*(r-t),a=n*n;return(2*t-2*i+o+s)*(n*a)+(-3*t+3*i-2*o-s)*a+o*n+t},b2p0:function(e,t){var i=1-e;return i*i*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,i,r){return this.b2p0(e,t)+this.b2p1(e,i)+this.b2p2(e,r)},b3p0:function(e,t){var i=1-e;return i*i*i*t},b3p1:function(e,t){var i=1-e;return 3*i*i*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,i,r,n){return this.b3p0(e,t)+this.b3p1(e,i)+this.b3p2(e,r)+this.b3p3(e,n)}},exports.data=yn,exports.dotbim=Ns,exports.ifctypes={__proto__:null,IfcActionRequest:1e3,IfcActor:1001,IfcActorRole:1002,IfcActuator:1003,IfcActuatorType:1004,IfcAddress:1005,IfcAdvancedBrep:1006,IfcAdvancedBrepWithVoids:1007,IfcAdvancedFace:1008,IfcAirTerminal:1009,IfcAirTerminalBox:1010,IfcAirTerminalBoxType:1011,IfcAirTerminalType:1012,IfcAirToAirHeatRecovery:1013,IfcAirToAirHeatRecoveryType:1014,IfcAlarm:1015,IfcAlarmType:1016,IfcAnnotation:1017,IfcAnnotationFillArea:1018,IfcApplication:1019,IfcAppliedValue:1020,IfcApproval:1021,IfcApprovalRelationship:1022,IfcArbitraryClosedProfileDef:1023,IfcArbitraryOpenProfileDef:1024,IfcArbitraryProfileDefWithVoids:1025,IfcAsset:1026,IfcAsymmetricIShapeProfileDef:1027,IfcAudioVisualAppliance:1028,IfcAudioVisualApplianceType:1029,IfcAxis1Placement:1030,IfcAxis2Placement2D:1031,IfcAxis2Placement3D:1032,IfcBeam:1033,IfcBeamStandardCase:1034,IfcBeamType:1035,IfcBlobTexture:1036,IfcBlock:1037,IfcBoiler:1038,IfcBoilerType:1039,IfcBooleanClippingResult:1040,IfcBooleanResult:1041,IfcBoundaryCondition:1042,IfcBoundaryCurve:1043,IfcBoundaryEdgeCondition:1044,IfcBoundaryFaceCondition:1045,IfcBoundaryNodeCondition:1046,IfcBoundaryNodeConditionWarping:1047,IfcBoundedCurve:1048,IfcBoundedSurface:1049,IfcBoundingBox:1050,IfcBoxedHalfSpace:1051,IfcBSplineCurve:1052,IfcBSplineCurveWithKnots:1053,IfcBSplineSurface:1054,IfcBSplineSurfaceWithKnots:1055,IfcBuilding:1056,IfcBuildingElementPart:1057,IfcBuildingElementPartType:1058,IfcBuildingElementProxy:1059,IfcBuildingElementProxyType:1060,IfcBuildingStorey:1061,IfcBuildingSystem:1062,IfcBurner:1063,IfcBurnerType:1064,IfcCableCarrierFitting:1065,IfcCableCarrierFittingType:1066,IfcCableCarrierSegment:1067,IfcCableCarrierSegmentType:1068,IfcCableFitting:1069,IfcCableFittingType:1070,IfcCableSegment:1071,IfcCableSegmentType:1072,IfcCartesianPoint:1073,IfcCartesianPointList:1074,IfcCartesianPointList2D:1075,IfcCartesianPointList3D:1076,IfcCartesianTransformationOperator:1077,IfcCartesianTransformationOperator2D:1078,IfcCartesianTransformationOperator2DnonUniform:1079,IfcCartesianTransformationOperator3D:1080,IfcCartesianTransformationOperator3DnonUniform:1081,IfcCenterLineProfileDef:1082,IfcChiller:1083,IfcChillerType:1084,IfcChimney:1085,IfcChimneyType:1086,IfcCircle:1087,IfcCircleHollowProfileDef:1088,IfcCircleProfileDef:1089,IfcCivilElement:1090,IfcCivilElementType:1091,IfcClassification:1092,IfcClassificationReference:1093,IfcClosedShell:1094,IfcCoil:1095,IfcCoilType:1096,IfcColourRgb:1097,IfcColourRgbList:1098,IfcColourSpecification:1099,IfcColumn:1100,IfcColumnStandardCase:1101,IfcColumnType:1102,IfcCommunicationsAppliance:1103,IfcCommunicationsApplianceType:1104,IfcComplexProperty:1105,IfcComplexPropertyTemplate:1106,IfcCompositeCurve:1107,IfcCompositeCurveOnSurface:1108,IfcCompositeCurveSegment:1109,IfcCompositeProfileDef:1110,IfcCompressor:1111,IfcCompressorType:1112,IfcCondenser:1113,IfcCondenserType:1114,IfcConic:1115,IfcConnectedFaceSet:1116,IfcConnectionCurveGeometry:1117,IfcConnectionGeometry:1118,IfcConnectionPointEccentricity:1119,IfcConnectionPointGeometry:1120,IfcConnectionSurfaceGeometry:1121,IfcConnectionVolumeGeometry:1122,IfcConstraint:1123,IfcConstructionEquipmentResource:1124,IfcConstructionEquipmentResourceType:1125,IfcConstructionMaterialResource:1126,IfcConstructionMaterialResourceType:1127,IfcConstructionProductResource:1128,IfcConstructionProductResourceType:1129,IfcConstructionResource:1130,IfcConstructionResourceType:1131,IfcContext:1132,IfcContextDependentUnit:1133,IfcControl:1134,IfcController:1135,IfcControllerType:1136,IfcConversionBasedUnit:1137,IfcConversionBasedUnitWithOffset:1138,IfcCooledBeam:1139,IfcCooledBeamType:1140,IfcCoolingTower:1141,IfcCoolingTowerType:1142,IfcCoordinateOperation:1143,IfcCoordinateReferenceSystem:1144,IfcCostItem:1145,IfcCostSchedule:1146,IfcCostValue:1147,IfcCovering:1148,IfcCoveringType:1149,IfcCrewResource:1150,IfcCrewResourceType:1151,IfcCsgPrimitive3D:1152,IfcCsgSolid:1153,IfcCShapeProfileDef:1154,IfcCurrencyRelationship:1155,IfcCurtainWall:1156,IfcCurtainWallType:1157,IfcCurve:1158,IfcCurveBoundedPlane:1159,IfcCurveBoundedSurface:1160,IfcCurveStyle:1161,IfcCurveStyleFont:1162,IfcCurveStyleFontAndScaling:1163,IfcCurveStyleFontPattern:1164,IfcCylindricalSurface:1165,IfcDamper:1166,IfcDamperType:1167,IfcDerivedProfileDef:1168,IfcDerivedUnit:1169,IfcDerivedUnitElement:1170,IfcDimensionalExponents:1171,IfcDirection:1172,IfcDiscreteAccessory:1173,IfcDiscreteAccessoryType:1174,IfcDistributionChamberElement:1175,IfcDistributionChamberElementType:1176,IfcDistributionCircuit:1177,IfcDistributionControlElement:1178,IfcDistributionControlElementType:1179,IfcDistributionElement:1180,IfcDistributionElementType:1181,IfcDistributionFlowElement:1182,IfcDistributionFlowElementType:1183,IfcDistributionPort:1184,IfcDistributionSystem:1185,IfcDocumentInformation:1186,IfcDocumentInformationRelationship:1187,IfcDocumentReference:1188,IfcDoor:1189,IfcDoorLiningProperties:1190,IfcDoorPanelProperties:1191,IfcDoorStandardCase:1192,IfcDoorStyle:1193,IfcDoorType:1194,IfcDraughtingPreDefinedColour:1195,IfcDraughtingPreDefinedCurveFont:1196,IfcDuctFitting:1197,IfcDuctFittingType:1198,IfcDuctSegment:1199,IfcDuctSegmentType:1200,IfcDuctSilencer:1201,IfcDuctSilencerType:1202,IfcEdge:1203,IfcEdgeCurve:1204,IfcEdgeLoop:1205,IfcElectricAppliance:1206,IfcElectricApplianceType:1207,IfcElectricDistributionBoard:1208,IfcElectricDistributionBoardType:1209,IfcElectricFlowStorageDevice:1210,IfcElectricFlowStorageDeviceType:1211,IfcElectricGenerator:1212,IfcElectricGeneratorType:1213,IfcElectricMotor:1214,IfcElectricMotorType:1215,IfcElectricTimeControl:1216,IfcElectricTimeControlType:1217,IfcElement:1218,IfcElementarySurface:1219,IfcElementAssembly:1220,IfcElementAssemblyType:1221,IfcElementComponent:1222,IfcElementComponentType:1223,IfcElementQuantity:1224,IfcElementType:1225,IfcEllipse:1226,IfcEllipseProfileDef:1227,IfcEnergyConversionDevice:1228,IfcEnergyConversionDeviceType:1229,IfcEngine:1230,IfcEngineType:1231,IfcEvaporativeCooler:1232,IfcEvaporativeCoolerType:1233,IfcEvaporator:1234,IfcEvaporatorType:1235,IfcEvent:1236,IfcEventTime:1237,IfcEventType:1238,IfcExtendedProperties:1239,IfcExternalInformation:1240,IfcExternallyDefinedHatchStyle:1241,IfcExternallyDefinedSurfaceStyle:1242,IfcExternallyDefinedTextFont:1243,IfcExternalReference:1244,IfcExternalReferenceRelationship:1245,IfcExternalSpatialElement:1246,IfcExternalSpatialStructureElement:1247,IfcExtrudedAreaSolid:1248,IfcExtrudedAreaSolidTapered:1249,IfcFace:1250,IfcFaceBasedSurfaceModel:1251,IfcFaceBound:1252,IfcFaceOuterBound:1253,IfcFaceSurface:1254,IfcFacetedBrep:1255,IfcFacetedBrepWithVoids:1256,IfcFailureConnectionCondition:1257,IfcFan:1258,IfcFanType:1259,IfcFastener:1260,IfcFastenerType:1261,IfcFeatureElement:1262,IfcFeatureElementAddition:1263,IfcFeatureElementSubtraction:1264,IfcFillAreaStyle:1265,IfcFillAreaStyleHatching:1266,IfcFillAreaStyleTiles:1267,IfcFilter:1268,IfcFilterType:1269,IfcFireSuppressionTerminal:1270,IfcFireSuppressionTerminalType:1271,IfcFixedReferenceSweptAreaSolid:1272,IfcFlowController:1273,IfcFlowControllerType:1274,IfcFlowFitting:1275,IfcFlowFittingType:1276,IfcFlowInstrument:1277,IfcFlowInstrumentType:1278,IfcFlowMeter:1279,IfcFlowMeterType:1280,IfcFlowMovingDevice:1281,IfcFlowMovingDeviceType:1282,IfcFlowSegment:1283,IfcFlowSegmentType:1284,IfcFlowStorageDevice:1285,IfcFlowStorageDeviceType:1286,IfcFlowTerminal:1287,IfcFlowTerminalType:1288,IfcFlowTreatmentDevice:1289,IfcFlowTreatmentDeviceType:1290,IfcFooting:1291,IfcFootingType:1292,IfcFurnishingElement:1293,IfcFurnishingElementType:1294,IfcFurniture:1295,IfcFurnitureType:1296,IfcGeographicElement:1297,IfcGeographicElementType:1298,IfcGeometricCurveSet:1299,IfcGeometricRepresentationContext:1300,IfcGeometricRepresentationItem:1301,IfcGeometricRepresentationSubContext:1302,IfcGeometricSet:1303,IfcGrid:1304,IfcGridAxis:1305,IfcGridPlacement:1306,IfcGroup:1307,IfcHalfSpaceSolid:1308,IfcHeatExchanger:1309,IfcHeatExchangerType:1310,IfcHumidifier:1311,IfcHumidifierType:1312,IfcImageTexture:1313,IfcIndexedColourMap:1314,IfcIndexedPolyCurve:1315,IfcIndexedPolygonalFace:1316,IfcIndexedPolygonalFaceWithVoids:1317,IfcIndexedTextureMap:1318,IfcIndexedTriangleTextureMap:1319,IfcInterceptor:1320,IfcInterceptorType:1321,IfcIntersectionCurve:1322,IfcInventory:1323,IfcIrregularTimeSeries:1324,IfcIrregularTimeSeriesValue:1325,IfcIShapeProfileDef:1326,IfcJunctionBox:1327,IfcJunctionBoxType:1328,IfcLaborResource:1329,IfcLaborResourceType:1330,IfcLagTime:1331,IfcLamp:1332,IfcLampType:1333,IfcLibraryInformation:1334,IfcLibraryReference:1335,IfcLightDistributionData:1336,IfcLightFixture:1337,IfcLightFixtureType:1338,IfcLightIntensityDistribution:1339,IfcLightSource:1340,IfcLightSourceAmbient:1341,IfcLightSourceDirectional:1342,IfcLightSourceGoniometric:1343,IfcLightSourcePositional:1344,IfcLightSourceSpot:1345,IfcLine:1346,IfcLocalPlacement:1347,IfcLoop:1348,IfcLShapeProfileDef:1349,IfcManifoldSolidBrep:1350,IfcMapConversion:1351,IfcMappedItem:1352,IfcMaterial:1353,IfcMaterialClassificationRelationship:1354,IfcMaterialConstituent:1355,IfcMaterialConstituentSet:1356,IfcMaterialDefinition:1357,IfcMaterialDefinitionRepresentation:1358,IfcMaterialLayer:1359,IfcMaterialLayerSet:1360,IfcMaterialLayerSetUsage:1361,IfcMaterialLayerWithOffsets:1362,IfcMaterialList:1363,IfcMaterialProfile:1364,IfcMaterialProfileSet:1365,IfcMaterialProfileSetUsage:1366,IfcMaterialProfileSetUsageTapering:1367,IfcMaterialProfileWithOffsets:1368,IfcMaterialProperties:1369,IfcMaterialRelationship:1370,IfcMaterialUsageDefinition:1371,IfcMeasureWithUnit:1372,IfcMechanicalFastener:1373,IfcMechanicalFastenerType:1374,IfcMedicalDevice:1375,IfcMedicalDeviceType:1376,IfcMember:1377,IfcMemberStandardCase:1378,IfcMemberType:1379,IfcMetric:1380,IfcMirroredProfileDef:1381,IfcMonetaryUnit:1382,IfcMotorConnection:1383,IfcMotorConnectionType:1384,IfcNamedUnit:1385,IfcObject:1386,IfcObjectDefinition:1387,IfcObjective:1388,IfcObjectPlacement:1389,IfcOccupant:1390,IfcOffsetCurve2D:1391,IfcOffsetCurve3D:1392,IfcOpeningElement:1393,IfcOpeningStandardCase:1394,IfcOpenShell:1395,IfcOrganization:1396,IfcOrganizationRelationship:1397,IfcOrientedEdge:1398,IfcOuterBoundaryCurve:1399,IfcOutlet:1400,IfcOutletType:1401,IfcOwnerHistory:1402,IfcParameterizedProfileDef:1403,IfcPath:1404,IfcPcurve:1405,IfcPerformanceHistory:1406,IfcPermeableCoveringProperties:1407,IfcPermit:1408,IfcPerson:1409,IfcPersonAndOrganization:1410,IfcPhysicalComplexQuantity:1411,IfcPhysicalQuantity:1412,IfcPhysicalSimpleQuantity:1413,IfcPile:1414,IfcPileType:1415,IfcPipeFitting:1416,IfcPipeFittingType:1417,IfcPipeSegment:1418,IfcPipeSegmentType:1419,IfcPixelTexture:1420,IfcPlacement:1421,IfcPlanarBox:1422,IfcPlanarExtent:1423,IfcPlane:1424,IfcPlate:1425,IfcPlateStandardCase:1426,IfcPlateType:1427,IfcPoint:1428,IfcPointOnCurve:1429,IfcPointOnSurface:1430,IfcPolygonalBoundedHalfSpace:1431,IfcPolygonalFaceSet:1432,IfcPolyline:1433,IfcPolyLoop:1434,IfcPort:1435,IfcPostalAddress:1436,IfcPreDefinedColour:1437,IfcPreDefinedCurveFont:1438,IfcPreDefinedItem:1439,IfcPreDefinedProperties:1440,IfcPreDefinedPropertySet:1441,IfcPreDefinedTextFont:1442,IfcPresentationItem:1443,IfcPresentationLayerAssignment:1444,IfcPresentationLayerWithStyle:1445,IfcPresentationStyle:1446,IfcPresentationStyleAssignment:1447,IfcProcedure:1448,IfcProcedureType:1449,IfcProcess:1450,IfcProduct:1451,IfcProductDefinitionShape:1452,IfcProductRepresentation:1453,IfcProfileDef:1454,IfcProfileProperties:1455,IfcProject:1456,IfcProjectedCRS:1457,IfcProjectionElement:1458,IfcProjectLibrary:1459,IfcProjectOrder:1460,IfcProperty:1461,IfcPropertyAbstraction:1462,IfcPropertyBoundedValue:1463,IfcPropertyDefinition:1464,IfcPropertyDependencyRelationship:1465,IfcPropertyEnumeratedValue:1466,IfcPropertyEnumeration:1467,IfcPropertyListValue:1468,IfcPropertyReferenceValue:1469,IfcPropertySet:1470,IfcPropertySetDefinition:1471,IfcPropertySetTemplate:1472,IfcPropertySingleValue:1473,IfcPropertyTableValue:1474,IfcPropertyTemplate:1475,IfcPropertyTemplateDefinition:1476,IfcProtectiveDevice:1477,IfcProtectiveDeviceTrippingUnit:1478,IfcProtectiveDeviceTrippingUnitType:1479,IfcProtectiveDeviceType:1480,IfcProxy:1481,IfcPump:1482,IfcPumpType:1483,IfcQuantityArea:1484,IfcQuantityCount:1485,IfcQuantityLength:1486,IfcQuantitySet:1487,IfcQuantityTime:1488,IfcQuantityVolume:1489,IfcQuantityWeight:1490,IfcRailing:1491,IfcRailingType:1492,IfcRamp:1493,IfcRampFlight:1494,IfcRampFlightType:1495,IfcRampType:1496,IfcRationalBSplineCurveWithKnots:1497,IfcRationalBSplineSurfaceWithKnots:1498,IfcRectangleHollowProfileDef:1499,IfcRectangleProfileDef:1500,IfcRectangularPyramid:1501,IfcRectangularTrimmedSurface:1502,IfcRecurrencePattern:1503,IfcReference:1504,IfcRegularTimeSeries:1505,IfcReinforcementBarProperties:1506,IfcReinforcementDefinitionProperties:1507,IfcReinforcingBar:1508,IfcReinforcingBarType:1509,IfcReinforcingElement:1510,IfcReinforcingElementType:1511,IfcReinforcingMesh:1512,IfcReinforcingMeshType:1513,IfcRelAggregates:1514,IfcRelAssigns:1515,IfcRelAssignsToActor:1516,IfcRelAssignsToControl:1517,IfcRelAssignsToGroup:1518,IfcRelAssignsToGroupByFactor:1519,IfcRelAssignsToProcess:1520,IfcRelAssignsToProduct:1521,IfcRelAssignsToResource:1522,IfcRelAssociates:1523,IfcRelAssociatesApproval:1524,IfcRelAssociatesClassification:1525,IfcRelAssociatesConstraint:1526,IfcRelAssociatesDocument:1527,IfcRelAssociatesLibrary:1528,IfcRelAssociatesMaterial:1529,IfcRelationship:1530,IfcRelConnects:1531,IfcRelConnectsElements:1532,IfcRelConnectsPathElements:1533,IfcRelConnectsPorts:1534,IfcRelConnectsPortToElement:1535,IfcRelConnectsStructuralActivity:1536,IfcRelConnectsStructuralMember:1537,IfcRelConnectsWithEccentricity:1538,IfcRelConnectsWithRealizingElements:1539,IfcRelContainedInSpatialStructure:1540,IfcRelCoversBldgElements:1541,IfcRelCoversSpaces:1542,IfcRelDeclares:1543,IfcRelDecomposes:1544,IfcRelDefines:1545,IfcRelDefinesByObject:1546,IfcRelDefinesByProperties:1547,IfcRelDefinesByTemplate:1548,IfcRelDefinesByType:1549,IfcRelFillsElement:1550,IfcRelFlowControlElements:1551,IfcRelInterferesElements:1552,IfcRelNests:1553,IfcRelProjectsElement:1554,IfcRelReferencedInSpatialStructure:1555,IfcRelSequence:1556,IfcRelServicesBuildings:1557,IfcRelSpaceBoundary:1558,IfcRelSpaceBoundary1stLevel:1559,IfcRelSpaceBoundary2ndLevel:1560,IfcRelVoidsElement:1561,IfcReparametrisedCompositeCurveSegment:1562,IfcRepresentation:1563,IfcRepresentationContext:1564,IfcRepresentationItem:1565,IfcRepresentationMap:1566,IfcResource:1567,IfcResourceApprovalRelationship:1568,IfcResourceConstraintRelationship:1569,IfcResourceLevelRelationship:1570,IfcResourceTime:1571,IfcRevolvedAreaSolid:1572,IfcRevolvedAreaSolidTapered:1573,IfcRightCircularCone:1574,IfcRightCircularCylinder:1575,IfcRoof:1576,IfcRoofType:1577,IfcRoot:1578,IfcRoundedRectangleProfileDef:1579,IfcSanitaryTerminal:1580,IfcSanitaryTerminalType:1581,IfcSchedulingTime:1582,IfcSeamCurve:1583,IfcSectionedSpine:1584,IfcSectionProperties:1585,IfcSectionReinforcementProperties:1586,IfcSensor:1587,IfcSensorType:1588,IfcShadingDevice:1589,IfcShadingDeviceType:1590,IfcShapeAspect:1591,IfcShapeModel:1592,IfcShapeRepresentation:1593,IfcShellBasedSurfaceModel:1594,IfcSimpleProperty:1595,IfcSimplePropertyTemplate:1596,IfcSite:1597,IfcSIUnit:1598,IfcSlab:1599,IfcSlabElementedCase:1600,IfcSlabStandardCase:1601,IfcSlabType:1602,IfcSlippageConnectionCondition:1603,IfcSolarDevice:1604,IfcSolarDeviceType:1605,IfcSolidModel:1606,IfcSpace:1607,IfcSpaceHeater:1608,IfcSpaceHeaterType:1609,IfcSpaceType:1610,IfcSpatialElement:1611,IfcSpatialElementType:1612,IfcSpatialStructureElement:1613,IfcSpatialStructureElementType:1614,IfcSpatialZone:1615,IfcSpatialZoneType:1616,IfcSphere:1617,IfcSphericalSurface:1618,IfcStackTerminal:1619,IfcStackTerminalType:1620,IfcStair:1621,IfcStairFlight:1622,IfcStairFlightType:1623,IfcStairType:1624,IfcStructuralAction:1625,IfcStructuralActivity:1626,IfcStructuralAnalysisModel:1627,IfcStructuralConnection:1628,IfcStructuralConnectionCondition:1629,IfcStructuralCurveAction:1630,IfcStructuralCurveConnection:1631,IfcStructuralCurveMember:1632,IfcStructuralCurveMemberVarying:1633,IfcStructuralCurveReaction:1634,IfcStructuralItem:1635,IfcStructuralLinearAction:1636,IfcStructuralLoad:1637,IfcStructuralLoadCase:1638,IfcStructuralLoadConfiguration:1639,IfcStructuralLoadGroup:1640,IfcStructuralLoadLinearForce:1641,IfcStructuralLoadOrResult:1642,IfcStructuralLoadPlanarForce:1643,IfcStructuralLoadSingleDisplacement:1644,IfcStructuralLoadSingleDisplacementDistortion:1645,IfcStructuralLoadSingleForce:1646,IfcStructuralLoadSingleForceWarping:1647,IfcStructuralLoadStatic:1648,IfcStructuralLoadTemperature:1649,IfcStructuralMember:1650,IfcStructuralPlanarAction:1651,IfcStructuralPointAction:1652,IfcStructuralPointConnection:1653,IfcStructuralPointReaction:1654,IfcStructuralReaction:1655,IfcStructuralResultGroup:1656,IfcStructuralSurfaceAction:1657,IfcStructuralSurfaceConnection:1658,IfcStructuralSurfaceMember:1659,IfcStructuralSurfaceMemberVarying:1660,IfcStructuralSurfaceReaction:1661,IfcStyledItem:1662,IfcStyledRepresentation:1663,IfcStyleModel:1664,IfcSubContractResource:1665,IfcSubContractResourceType:1666,IfcSubedge:1667,IfcSurface:1668,IfcSurfaceCurve:1669,IfcSurfaceCurveSweptAreaSolid:1670,IfcSurfaceFeature:1671,IfcSurfaceOfLinearExtrusion:1672,IfcSurfaceOfRevolution:1673,IfcSurfaceReinforcementArea:1674,IfcSurfaceStyle:1675,IfcSurfaceStyleLighting:1676,IfcSurfaceStyleRefraction:1677,IfcSurfaceStyleRendering:1678,IfcSurfaceStyleShading:1679,IfcSurfaceStyleWithTextures:1680,IfcSurfaceTexture:1681,IfcSweptAreaSolid:1682,IfcSweptDiskSolid:1683,IfcSweptDiskSolidPolygonal:1684,IfcSweptSurface:1685,IfcSwitchingDevice:1686,IfcSwitchingDeviceType:1687,IfcSystem:1688,IfcSystemFurnitureElement:1689,IfcSystemFurnitureElementType:1690,IfcTable:1691,IfcTableColumn:1692,IfcTableRow:1693,IfcTank:1694,IfcTankType:1695,IfcTask:1696,IfcTaskTime:1697,IfcTaskTimeRecurring:1698,IfcTaskType:1699,IfcTelecomAddress:1700,IfcTendon:1701,IfcTendonAnchor:1702,IfcTendonAnchorType:1703,IfcTendonType:1704,IfcTessellatedFaceSet:1705,IfcTessellatedItem:1706,IfcTextLiteral:1707,IfcTextLiteralWithExtent:1708,IfcTextStyle:1709,IfcTextStyleFontModel:1710,IfcTextStyleForDefinedFont:1711,IfcTextStyleTextModel:1712,IfcTextureCoordinate:1713,IfcTextureCoordinateGenerator:1714,IfcTextureMap:1715,IfcTextureVertex:1716,IfcTextureVertexList:1717,IfcTimePeriod:1718,IfcTimeSeries:1719,IfcTimeSeriesValue:1720,IfcTopologicalRepresentationItem:1721,IfcTopologyRepresentation:1722,IfcToroidalSurface:1723,IfcTransformer:1724,IfcTransformerType:1725,IfcTransportElement:1726,IfcTransportElementType:1727,IfcTrapeziumProfileDef:1728,IfcTriangulatedFaceSet:1729,IfcTrimmedCurve:1730,IfcTShapeProfileDef:1731,IfcTubeBundle:1732,IfcTubeBundleType:1733,IfcTypeObject:1734,IfcTypeProcess:1735,IfcTypeProduct:1736,IfcTypeResource:1737,IfcUnitaryControlElement:1738,IfcUnitaryControlElementType:1739,IfcUnitaryEquipment:1740,IfcUnitaryEquipmentType:1741,IfcUnitAssignment:1742,IfcUShapeProfileDef:1743,IfcValve:1744,IfcValveType:1745,IfcVector:1746,IfcVertex:1747,IfcVertexLoop:1748,IfcVertexPoint:1749,IfcVibrationIsolator:1750,IfcVibrationIsolatorType:1751,IfcVirtualElement:1752,IfcVirtualGridIntersection:1753,IfcVoidingFeature:1754,IfcWall:1755,IfcWallElementedCase:1756,IfcWallStandardCase:1757,IfcWallType:1758,IfcWasteTerminal:1759,IfcWasteTerminalType:1760,IfcWindow:1761,IfcWindowLiningProperties:1762,IfcWindowPanelProperties:1763,IfcWindowStandardCase:1764,IfcWindowStyle:1765,IfcWindowType:1766,IfcWorkCalendar:1767,IfcWorkControl:1768,IfcWorkPlan:1769,IfcWorkSchedule:1770,IfcWorkTime:1771,IfcZone:1772,IfcZShapeProfileDef:1773,typeNames:{},typeCodes:{}},exports.kdtree2=Io,exports.kdtree3=Ho,exports.ktx2=Ah,exports.locale=on,exports.math=ht,exports.matrix=Ui,exports.rtc=Jr,exports.scene=wo,exports.treeview=lw,exports.utils=sr,exports.viewer=yh,exports.webglrenderer=Oy;
//# sourceMappingURL=xeokit-bundle.cjs.map
