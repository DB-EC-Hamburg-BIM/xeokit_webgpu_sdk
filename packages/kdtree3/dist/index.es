import{expandAABB3 as t,containsAABB3 as e,collapseAABB3 as r,expandAABB3Points3 as i,createAABB3Int16 as n,OUTSIDE as a,intersectAABB3s as o,INTERSECT as f,intersectFrustum3AABB3 as h}from"@xeokit/boundaries";import{getSceneObjectGeometry as u}from"@xeokit/scene";import{LinesPrimitive as s,TrianglesPrimitive as c,PointsPrimitive as m}from"@xeokit/constants";function b(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,v(t,e)}function v(t,e){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},v(t,e)}var l=0;function p(t){return"__private_"+l+++"_"+t}function g(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var y=new Float32Array(3),d=/*#__PURE__*/p("root"),M=/*#__PURE__*/p("maxDepth"),x=/*#__PURE__*/p("numNodes"),w=/*#__PURE__*/p("numObjects"),O=/*#__PURE__*/p("insertItem"),j=/*#__PURE__*/function(){function t(t){Object.defineProperty(this,O,{value:k}),Object.defineProperty(this,d,{writable:!0,value:void 0}),Object.defineProperty(this,M,{writable:!0,value:void 0}),Object.defineProperty(this,x,{writable:!0,value:void 0}),Object.defineProperty(this,w,{writable:!0,value:void 0}),g(this,M)[M]=(null==t?void 0:t.maxDepth)||10,g(this,d)[d]={index:0,aabb:t.aabb.slice()},g(this,x)[x]=0}var e,r;return t.prototype.insertItem=function(t,e){g(this,O)[O](g(this,d)[d],{index:g(this,w)[w]++,item:t},e,1)},e=t,(r=[{key:"root",get:function(){return g(this,d)[d]}}])&&function(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,"symbol"==typeof(n=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(i.key))?n:String(n),i)}var n}(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function k(r,i,n,a){if(a>=g(this,M)[M])return r.items=r.items||[],r.items.push(i),void t(r.aabb,n);if(r.left&&e(r.left.aabb,n))g(this,O)[O](r.left,i,n,a+1);else if(r.right&&e(r.right.aabb,n))g(this,O)[O](r.right,i,n,a+1);else{var o=r.aabb;y[0]=o[3]-o[0],y[1]=o[4]-o[1],y[2]=o[5]-o[2];var f=0;if(y[1]>y[f]&&(f=1),y[2]>y[f]&&(f=2),!r.left){var h=o.slice();if(h[f+3]=(o[f]+o[f+3])/2,r.left={index:g(this,x)[x]++,aabb:h},e(h,n))return void g(this,O)[O](r.left,i,n,a+1)}if(!r.right){var u=o.slice();if(u[f]=(o[f]+o[f+3])/2,r.right={index:g(this,x)[x]++,aabb:u},e(u,n))return void g(this,O)[O](r.right,i,n,a+1)}r.items=r.items||[],r.items.push(i),t(r.aabb,n)}}var P=/*#__PURE__*/function(t){function e(){return t.apply(this,arguments)||this}return b(e,t),e}(j);function I(e){for(var i=r(),n=0,a=e.length;n<a;n++)t(i,e[n].aabb);for(var o=new P({aabb:i}),f=0,h=e.length;f<h;f++){var u=e[f];o.insertItem(u,u.aabb)}return o}var _=/*#__PURE__*/function(t){function e(){return t.apply(this,arguments)||this}return b(e,t),e}(j);function T(e){var i=new Int16Array(6);function n(t,e,r,n,a){var o=r[3*n+1],f=r[3*n+2],h=i;h[0]=h[3]=r[3*n],h[1]=h[4]=o,h[2]=h[5]=f,a.insertItem({sceneObject:t,geometryBucket:e,prim:{a:n}},h)}function a(t,e,r,n,a,o){var f=r[3*n],h=r[3*n+1],u=r[3*n+2],s=r[3*a],c=r[3*a+1],m=r[3*a+2],b=i;b[0]=Math.min(f,s),b[1]=Math.min(h,c),b[2]=Math.min(u,m),b[3]=Math.max(f,s),b[4]=Math.max(h,c),b[5]=Math.max(u,m),o.insertItem({sceneObject:t,geometryBucket:e,prim:{a:n,b:a}},b)}function o(t,e,r,n,a,o,f){var h=r[3*n],u=r[3*n+1],s=r[3*n+2],c=r[3*a],m=r[3*a+1],b=r[3*a+2],v=r[3*o],l=r[3*o+1],p=r[3*o+2],g=i;g[0]=Math.min(h,c,v),g[1]=Math.min(u,m,l),g[2]=Math.min(s,b,p),g[3]=Math.max(h,c,v),g[4]=Math.max(u,m,l),g[5]=Math.max(s,b,p),f.insertItem({sceneObject:t,geometryBucket:e,prim:{a:n,b:a,c:o}},g)}for(var f=r(),h=0,b=e.length;h<b;h++)t(f,e[h].aabb);for(var v=new _({aabb:f}),l=function(){var t=e[p];u(t,function(e){var r=e.geometryBucket,i=e.positionsWorld,f=r.indices;switch(e.geometry.primitive){case m:for(var h=0,u=i.length/3;h<u;h++)n(t,r,i,h,v);break;case c:if(f)for(var b=0,l=f.length;b<l;b+=3)o(t,r,i,f[b],f[b+1],f[b+2],v);break;case s:if(f)for(var p=0,g=f.length;p<g;p+=2)a(t,r,i,f[p],f[p+1],v)}return!0})},p=0,g=e.length;p<g;p++)l();return v}var B=/*#__PURE__*/function(t){function e(){return t.apply(this,arguments)||this}return b(e,t),e}(j),A=new Int16Array(6);function S(t,e,r){var a=new B({aabb:i(n(),e)});switch(t){case m:for(var o=0,f=e.length/3;o<f;o++)D(e,o,a);break;case c:if(r)for(var h=0,u=r.length;h<u;h+=3)F(e,r[h],r[h+1],r[h+2],a);break;case s:if(r)for(var b=0,v=r.length;b<v;b+=2)E(e,r[b],r[b+1],a)}return a}function D(t,e,r){var i=t[3*e+1],n=t[3*e+2],a=A;a[0]=a[3]=t[3*e],a[1]=a[4]=i,a[2]=a[5]=n,r.insertItem({a:e},a)}function E(t,e,r,i){var n=t[3*e],a=t[3*e+1],o=t[3*e+2],f=t[3*r],h=t[3*r+1],u=t[3*r+2],s=A;s[0]=Math.min(n,f),s[1]=Math.min(a,h),s[2]=Math.min(o,u),s[3]=Math.max(n,f),s[4]=Math.max(a,h),s[5]=Math.max(o,u),i.insertItem({a:e,b:r},s)}function F(t,e,r,i,n){var a=t[3*e],o=t[3*e+1],f=t[3*e+2],h=t[3*r],u=t[3*r+1],s=t[3*r+2],c=t[3*i],m=t[3*i+1],b=t[3*i+2],v=A;v[0]=Math.min(a,h,c),v[1]=Math.min(o,u,m),v[2]=Math.min(f,s,b),v[3]=Math.max(a,h,c),v[4]=Math.max(o,u,m),v[5]=Math.max(f,s,b),n.insertItem({a:e,b:r,c:i},v)}function N(t){var e=t.aabb,r=[];return function t(i,n){if(n!==a&&(n=o(e,i.aabb))!==a){var f=i.items;if(f&&f.length>0)for(var h=0,u=f.length;h<u;h++)r.push(f[h].item);i.left&&t(i.left,n),i.right&&t(i.right,n)}}(t.kdTree.root,f),r}function W(t){var e=t.frustum,r=[];return function t(i,n){if(n!==a&&(n=h(e,i.aabb))!==a){var o=i.items;if(o&&o.length>0)for(var f=0,u=o.length;f<u;f++)r.push(o[f].item);i.left&&t(i.left,n),i.right&&t(i.right,n)}}(t.kdTree.root,f),r}function q(t){var e=[];return function t(r,i){if(i!==a&&(i=0)!==a){var n=r.items;if(n&&n.length>0)for(var o=0,f=n.length;o<f;o++)e.push(n[o].item);r.left&&t(r.left,i),r.right&&t(r.right,i)}}(t.kdTree.root,f),e}export{j as KdTree3,B as PrimsKdTree3,P as SceneObjectsKdTree3,_ as SceneObjectsPrimsKdTree3,S as createPrimsKdTree3,T as createSceneObjectPrimsKdTree3,I as createSceneObjectsKdTree3,N as searchKdTree3WithAABB,W as searchKdTree3WithFrustum,q as searchKdTree3WithRay};
//# sourceMappingURL=index.es.map
