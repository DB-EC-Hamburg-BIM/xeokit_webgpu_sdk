var t=require("@xeokit/boundaries"),e=require("@xeokit/scene"),r=require("@xeokit/constants");function i(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,n(t,e)}function n(t,e){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},n(t,e)}var a=0;function o(t){return"__private_"+a+++"_"+t}function s(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var c=new Float32Array(3),f=/*#__PURE__*/o("root"),u=/*#__PURE__*/o("maxDepth"),h=/*#__PURE__*/o("numNodes"),m=/*#__PURE__*/o("numObjects"),b=/*#__PURE__*/o("insertItem"),l=/*#__PURE__*/function(){function t(t){Object.defineProperty(this,b,{value:v}),Object.defineProperty(this,f,{writable:!0,value:void 0}),Object.defineProperty(this,u,{writable:!0,value:void 0}),Object.defineProperty(this,h,{writable:!0,value:void 0}),Object.defineProperty(this,m,{writable:!0,value:void 0}),s(this,u)[u]=(null==t?void 0:t.maxDepth)||10,s(this,f)[f]={index:0,aabb:t.aabb.slice()},s(this,h)[h]=0}var e,r;return t.prototype.insertItem=function(t,e){s(this,b)[b](s(this,f)[f],{index:s(this,m)[m]++,item:t},e,1)},e=t,(r=[{key:"root",get:function(){return s(this,f)[f]}}])&&function(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,"symbol"==typeof(n=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(i.key))?n:String(n),i)}var n}(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function v(e,r,i,n){if(n>=s(this,u)[u])return e.items=e.items||[],e.items.push(r),void t.expandAABB3(e.aabb,i);if(e.left&&t.containsAABB3(e.left.aabb,i))s(this,b)[b](e.left,r,i,n+1);else if(e.right&&t.containsAABB3(e.right.aabb,i))s(this,b)[b](e.right,r,i,n+1);else{var a=e.aabb;c[0]=a[3]-a[0],c[1]=a[4]-a[1],c[2]=a[5]-a[2];var o=0;if(c[1]>c[o]&&(o=1),c[2]>c[o]&&(o=2),!e.left){var f=a.slice();if(f[o+3]=(a[o]+a[o+3])/2,e.left={index:s(this,h)[h]++,aabb:f},t.containsAABB3(f,i))return void s(this,b)[b](e.left,r,i,n+1)}if(!e.right){var m=a.slice();if(m[o]=(a[o]+a[o+3])/2,e.right={index:s(this,h)[h]++,aabb:m},t.containsAABB3(m,i))return void s(this,b)[b](e.right,r,i,n+1)}e.items=e.items||[],e.items.push(r),t.expandAABB3(e.aabb,i)}}var p=/*#__PURE__*/function(t){function e(){return t.apply(this,arguments)||this}return i(e,t),e}(l),d=/*#__PURE__*/function(t){function e(){return t.apply(this,arguments)||this}return i(e,t),e}(l),g=/*#__PURE__*/function(t){function e(){return t.apply(this,arguments)||this}return i(e,t),e}(l),y=new Int16Array(6);function x(t,e,r){var i=t[3*e+1],n=t[3*e+2],a=y;a[0]=a[3]=t[3*e],a[1]=a[4]=i,a[2]=a[5]=n,r.insertItem({a:e},a)}function B(t,e,r,i){var n=t[3*e],a=t[3*e+1],o=t[3*e+2],s=t[3*r],c=t[3*r+1],f=t[3*r+2],u=y;u[0]=Math.min(n,s),u[1]=Math.min(a,c),u[2]=Math.min(o,f),u[3]=Math.max(n,s),u[4]=Math.max(a,c),u[5]=Math.max(o,f),i.insertItem({a:e,b:r},u)}function A(t,e,r,i,n){var a=t[3*e],o=t[3*e+1],s=t[3*e+2],c=t[3*r],f=t[3*r+1],u=t[3*r+2],h=t[3*i],m=t[3*i+1],b=t[3*i+2],l=y;l[0]=Math.min(a,c,h),l[1]=Math.min(o,f,m),l[2]=Math.min(s,u,b),l[3]=Math.max(a,c,h),l[4]=Math.max(o,f,m),l[5]=Math.max(s,u,b),n.insertItem({a:e,b:r,c:i},l)}exports.KdTree3=l,exports.PrimsKdTree3=g,exports.SceneObjectsKdTree3=p,exports.SceneObjectsPrimsKdTree3=d,exports.createPrimsKdTree3=function(e,i,n){var a=new g({aabb:t.expandAABB3Points3(t.createAABB3Int16(),i)});switch(e){case r.PointsPrimitive:for(var o=0,s=i.length/3;o<s;o++)x(i,o,a);break;case r.TrianglesPrimitive:if(n)for(var c=0,f=n.length;c<f;c+=3)A(i,n[c],n[c+1],n[c+2],a);break;case r.LinesPrimitive:if(n)for(var u=0,h=n.length;u<h;u+=2)B(i,n[u],n[u+1],a)}return a},exports.createSceneObjectPrimsKdTree3=function(i){var n=new Int16Array(6);function a(t,e,r,i,a){var o=r[3*i+1],s=r[3*i+2],c=n;c[0]=c[3]=r[3*i],c[1]=c[4]=o,c[2]=c[5]=s,a.insertItem({sceneObject:t,geometryBucket:e,prim:{a:i}},c)}function o(t,e,r,i,a,o){var s=r[3*i],c=r[3*i+1],f=r[3*i+2],u=r[3*a],h=r[3*a+1],m=r[3*a+2],b=n;b[0]=Math.min(s,u),b[1]=Math.min(c,h),b[2]=Math.min(f,m),b[3]=Math.max(s,u),b[4]=Math.max(c,h),b[5]=Math.max(f,m),o.insertItem({sceneObject:t,geometryBucket:e,prim:{a:i,b:a}},b)}function s(t,e,r,i,a,o,s){var c=r[3*i],f=r[3*i+1],u=r[3*i+2],h=r[3*a],m=r[3*a+1],b=r[3*a+2],l=r[3*o],v=r[3*o+1],p=r[3*o+2],d=n;d[0]=Math.min(c,h,l),d[1]=Math.min(f,m,v),d[2]=Math.min(u,b,p),d[3]=Math.max(c,h,l),d[4]=Math.max(f,m,v),d[5]=Math.max(u,b,p),s.insertItem({sceneObject:t,geometryBucket:e,prim:{a:i,b:a,c:o}},d)}for(var c=t.collapseAABB3(),f=0,u=i.length;f<u;f++)t.expandAABB3(c,i[f].aabb);for(var h=new d({aabb:c}),m=function(){var t=i[b];e.getSceneObjectGeometry(t,function(e){var i=e.geometryBucket,n=e.positionsWorld,c=i.indices;switch(e.geometry.primitive){case r.PointsPrimitive:for(var f=0,u=n.length/3;f<u;f++)a(t,i,n,f,h);break;case r.TrianglesPrimitive:if(c)for(var m=0,b=c.length;m<b;m+=3)s(t,i,n,c[m],c[m+1],c[m+2],h);break;case r.LinesPrimitive:if(c)for(var l=0,v=c.length;l<v;l+=2)o(t,i,n,c[l],c[l+1],h)}return!0})},b=0,l=i.length;b<l;b++)m();return h},exports.createSceneObjectsKdTree3=function(e){for(var r=t.collapseAABB3(),i=0,n=e.length;i<n;i++)t.expandAABB3(r,e[i].aabb);for(var a=new p({aabb:r}),o=0,s=e.length;o<s;o++){var c=e[o];a.insertItem(c,c.aabb)}return a},exports.searchKdTree3WithAABB=function(e){var r=e.aabb,i=[];return function e(n,a){if(a!==t.OUTSIDE&&(a=t.intersectAABB3s(r,n.aabb))!==t.OUTSIDE){var o=n.items;if(o&&o.length>0)for(var s=0,c=o.length;s<c;s++)i.push(o[s].item);n.left&&e(n.left,a),n.right&&e(n.right,a)}}(e.kdTree.root,t.INTERSECT),i},exports.searchKdTree3WithFrustum=function(e){var r=e.frustum,i=[];return function e(n,a){if(a!==t.OUTSIDE&&(a=t.intersectFrustum3AABB3(r,n.aabb))!==t.OUTSIDE){var o=n.items;if(o&&o.length>0)for(var s=0,c=o.length;s<c;s++)i.push(o[s].item);n.left&&e(n.left,a),n.right&&e(n.right,a)}}(e.kdTree.root,t.INTERSECT),i},exports.searchKdTree3WithRay=function(e){var r=[];return function e(i,n){if(n!==t.OUTSIDE&&(n=0)!==t.OUTSIDE){var a=i.items;if(a&&a.length>0)for(var o=0,s=a.length;o<s;o++)r.push(a[o].item);i.left&&e(i.left,n),i.right&&e(i.right,n)}}(e.kdTree.root,t.INTERSECT),r};
//# sourceMappingURL=index.js.map
