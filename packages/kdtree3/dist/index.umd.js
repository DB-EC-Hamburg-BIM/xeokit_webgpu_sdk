!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@xeokit/boundaries"),require("@xeokit/scene"),require("@xeokit/constants")):"function"==typeof define&&define.amd?define(["exports","@xeokit/boundaries","@xeokit/scene","@xeokit/constants"],t):t((e||self).kdtree3={},e.boundaries,e.scene,e.constants)}(this,function(e,t,r,i){function n(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,a(e,t)}function a(e,t){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},a(e,t)}var o=0;function s(e){return"__private_"+o+++"_"+e}function c(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var f=new Float32Array(3),u=/*#__PURE__*/s("root"),h=/*#__PURE__*/s("maxDepth"),b=/*#__PURE__*/s("numNodes"),m=/*#__PURE__*/s("numObjects"),l=/*#__PURE__*/s("insertItem"),v=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,l,{value:p}),Object.defineProperty(this,u,{writable:!0,value:void 0}),Object.defineProperty(this,h,{writable:!0,value:void 0}),Object.defineProperty(this,b,{writable:!0,value:void 0}),Object.defineProperty(this,m,{writable:!0,value:void 0}),c(this,h)[h]=(null==e?void 0:e.maxDepth)||10,c(this,u)[u]={index:0,aabb:e.aabb.slice()},c(this,b)[b]=0}var t,r;return e.prototype.insertItem=function(e,t){c(this,l)[l](c(this,u)[u],{index:c(this,m)[m]++,item:e},t,1)},t=e,(r=[{key:"root",get:function(){return c(this,u)[u]}}])&&function(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,"symbol"==typeof(n=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key))?n:String(n),i)}var n}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function p(e,r,i,n){if(n>=c(this,h)[h])return e.items=e.items||[],e.items.push(r),void t.expandAABB3(e.aabb,i);if(e.left&&t.containsAABB3(e.left.aabb,i))c(this,l)[l](e.left,r,i,n+1);else if(e.right&&t.containsAABB3(e.right.aabb,i))c(this,l)[l](e.right,r,i,n+1);else{var a=e.aabb;f[0]=a[3]-a[0],f[1]=a[4]-a[1],f[2]=a[5]-a[2];var o=0;if(f[1]>f[o]&&(o=1),f[2]>f[o]&&(o=2),!e.left){var s=a.slice();if(s[o+3]=(a[o]+a[o+3])/2,e.left={index:c(this,b)[b]++,aabb:s},t.containsAABB3(s,i))return void c(this,l)[l](e.left,r,i,n+1)}if(!e.right){var u=a.slice();if(u[o]=(a[o]+a[o+3])/2,e.right={index:c(this,b)[b]++,aabb:u},t.containsAABB3(u,i))return void c(this,l)[l](e.right,r,i,n+1)}e.items=e.items||[],e.items.push(r),t.expandAABB3(e.aabb,i)}}var d=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return n(t,e),t}(v),g=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return n(t,e),t}(v),y=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return n(t,e),t}(v),B=new Int16Array(6);function A(e,t,r){var i=e[3*t+1],n=e[3*t+2],a=B;a[0]=a[3]=e[3*t],a[1]=a[4]=i,a[2]=a[5]=n,r.insertItem({a:t},a)}function x(e,t,r,i){var n=e[3*t],a=e[3*t+1],o=e[3*t+2],s=e[3*r],c=e[3*r+1],f=e[3*r+2],u=B;u[0]=Math.min(n,s),u[1]=Math.min(a,c),u[2]=Math.min(o,f),u[3]=Math.max(n,s),u[4]=Math.max(a,c),u[5]=Math.max(o,f),i.insertItem({a:t,b:r},u)}function T(e,t,r,i,n){var a=e[3*t],o=e[3*t+1],s=e[3*t+2],c=e[3*r],f=e[3*r+1],u=e[3*r+2],h=e[3*i],b=e[3*i+1],m=e[3*i+2],l=B;l[0]=Math.min(a,c,h),l[1]=Math.min(o,f,b),l[2]=Math.min(s,u,m),l[3]=Math.max(a,c,h),l[4]=Math.max(o,f,b),l[5]=Math.max(s,u,m),n.insertItem({a:t,b:r,c:i},l)}e.KdTree3=v,e.PrimsKdTree3=y,e.SceneObjectsKdTree3=d,e.SceneObjectsPrimsKdTree3=g,e.createPrimsKdTree3=function(e,r,n){var a=new y({aabb:t.expandAABB3Points3(t.createAABB3Int16(),r)});switch(e){case i.PointsPrimitive:for(var o=0,s=r.length/3;o<s;o++)A(r,o,a);break;case i.TrianglesPrimitive:if(n)for(var c=0,f=n.length;c<f;c+=3)T(r,n[c],n[c+1],n[c+2],a);break;case i.LinesPrimitive:if(n)for(var u=0,h=n.length;u<h;u+=2)x(r,n[u],n[u+1],a)}return a},e.createSceneObjectPrimsKdTree3=function(e){var n=new Int16Array(6);function a(e,t,r,i,a){var o=r[3*i+1],s=r[3*i+2],c=n;c[0]=c[3]=r[3*i],c[1]=c[4]=o,c[2]=c[5]=s,a.insertItem({sceneObject:e,geometryBucket:t,prim:{a:i}},c)}function o(e,t,r,i,a,o){var s=r[3*i],c=r[3*i+1],f=r[3*i+2],u=r[3*a],h=r[3*a+1],b=r[3*a+2],m=n;m[0]=Math.min(s,u),m[1]=Math.min(c,h),m[2]=Math.min(f,b),m[3]=Math.max(s,u),m[4]=Math.max(c,h),m[5]=Math.max(f,b),o.insertItem({sceneObject:e,geometryBucket:t,prim:{a:i,b:a}},m)}function s(e,t,r,i,a,o,s){var c=r[3*i],f=r[3*i+1],u=r[3*i+2],h=r[3*a],b=r[3*a+1],m=r[3*a+2],l=r[3*o],v=r[3*o+1],p=r[3*o+2],d=n;d[0]=Math.min(c,h,l),d[1]=Math.min(f,b,v),d[2]=Math.min(u,m,p),d[3]=Math.max(c,h,l),d[4]=Math.max(f,b,v),d[5]=Math.max(u,m,p),s.insertItem({sceneObject:e,geometryBucket:t,prim:{a:i,b:a,c:o}},d)}for(var c=t.collapseAABB3(),f=0,u=e.length;f<u;f++)t.expandAABB3(c,e[f].aabb);for(var h=new g({aabb:c}),b=function(){var t=e[m];r.getSceneObjectGeometry(t,function(e){var r=e.geometryBucket,n=e.positionsWorld,c=r.indices;switch(e.geometry.primitive){case i.PointsPrimitive:for(var f=0,u=n.length/3;f<u;f++)a(t,r,n,f,h);break;case i.TrianglesPrimitive:if(c)for(var b=0,m=c.length;b<m;b+=3)s(t,r,n,c[b],c[b+1],c[b+2],h);break;case i.LinesPrimitive:if(c)for(var l=0,v=c.length;l<v;l+=2)o(t,r,n,c[l],c[l+1],h)}return!0})},m=0,l=e.length;m<l;m++)b();return h},e.createSceneObjectsKdTree3=function(e){for(var r=t.collapseAABB3(),i=0,n=e.length;i<n;i++)t.expandAABB3(r,e[i].aabb);for(var a=new d({aabb:r}),o=0,s=e.length;o<s;o++){var c=e[o];a.insertItem(c,c.aabb)}return a},e.searchKdTree3WithAABB=function(e){var r=e.aabb,i=[];return function e(n,a){if(a!==t.OUTSIDE&&(a=t.intersectAABB3s(r,n.aabb))!==t.OUTSIDE){var o=n.items;if(o&&o.length>0)for(var s=0,c=o.length;s<c;s++)i.push(o[s].item);n.left&&e(n.left,a),n.right&&e(n.right,a)}}(e.kdTree.root,t.INTERSECT),i},e.searchKdTree3WithFrustum=function(e){var r=e.frustum,i=[];return function e(n,a){if(a!==t.OUTSIDE&&(a=t.intersectFrustum3AABB3(r,n.aabb))!==t.OUTSIDE){var o=n.items;if(o&&o.length>0)for(var s=0,c=o.length;s<c;s++)i.push(o[s].item);n.left&&e(n.left,a),n.right&&e(n.right,a)}}(e.kdTree.root,t.INTERSECT),i},e.searchKdTree3WithRay=function(e){var r=[];return function e(i,n){if(n!==t.OUTSIDE&&(n=0)!==t.OUTSIDE){var a=i.items;if(a&&a.length>0)for(var o=0,s=a.length;o<s;o++)r.push(a[o].item);i.left&&e(i.left,n),i.right&&e(i.right,n)}}(e.kdTree.root,t.INTERSECT),r}});
//# sourceMappingURL=index.umd.js.map
