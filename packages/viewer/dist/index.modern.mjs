import{Component as t,EventEmitter as e,SDKError as i}from"@xeokit/core";import{EventDispatcher as s}from"strongly-typed-events";import{Scene as r}from"@xeokit/scene";import{newFloatArray as h,MAX_DOUBLE as o,MIN_DOUBLE as n,DEGTORAD as a}from"@xeokit/math";import{decompressPoint3 as l}from"@xeokit/compression";var d=0;function c(t){return"__private_"+d+++"_"+t}function u(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var v=0;function b(t){return"__private_"+v+++"_"+t}function p(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var w=/*#__PURE__*/b("items"),y=/*#__PURE__*/b("lastUniqueId"),j=/*#__PURE__*/function(){function t(t,e){Object.defineProperty(this,w,{writable:!0,value:void 0}),Object.defineProperty(this,y,{writable:!0,value:void 0}),p(this,w)[w]=t||[],p(this,y)[y]=(e||0)+1}var e=t.prototype;return e.addItem=function(){var t;if(2===arguments.length){var e=arguments[0];if(t=arguments[1],p(this,w)[w][e])throw"ID clash: '"+e+"'";return p(this,w)[w][e]=t,e}for(t=arguments[0]||{};;){var i=p(this,y)[y]++;if(!p(this,w)[w][i])return p(this,w)[w][i]=t,i}},e.removeItem=function(t){var e=p(this,w)[w][t];return delete p(this,w)[w][t],e},t}(),g=/*#__PURE__*/function(){function t(){this._head=void 0,this._headLength=void 0,this._tail=void 0,this._index=void 0,this._length=void 0,this._head=[],this._headLength=0,this._tail=[],this._index=0,this._length=0}var e,i,s=t.prototype;return s.shift=function(){if(this._index>=this._headLength){var t=this._head;if(t.length=0,this._head=this._tail,this._tail=t,this._index=0,this._headLength=this._head.length,!this._headLength)return}var e=this._head[this._index];return this._index<0?delete this._head[this._index++]:this._head[this._index++]=void 0,this._length--,e},s.push=function(t){return this._length++,this._tail.push(t),this},s.unshift=function(t){return this._head[--this._index]=t,this._length++,this},s.clear=function(){this._head=[],this._headLength=0,this._tail=[],this._index=0,this._length=0},e=t,(i=[{key:"length",get:function(){return this._length}}])&&function(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,"symbol"==typeof(r=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(s.key))?r:String(r),s)}var r}(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();function f(t){return function(t){return!isNaN(parseFloat(t))&&isFinite(t)}(t)?""+t:"'"+t+"'"}[["0",10],["A",26],["a",26],["_",1],["$",1]].map(function(t){for(var e=[],i=t[0].charCodeAt(0),s=i+t[1],r=i;r<s;++r)e.push(r);return String.fromCharCode.apply(null,e)}).join("");var O=function(){for(var t=[],e=0;e<256;e++)t[e]=(e<16?"0":"")+e.toString(16);return function(){var e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,s=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&i]+t[i>>8&255]+"-"+t[i>>16&15|64]+t[i>>24&255]+"-"+t[63&s|128]+t[s>>8&255]+"-"+t[s>>16&255]+t[s>>24&255]+t[255&r]+t[r>>8&255]+t[r>>16&255]+t[r>>24&255]}}(),P=3e4,m=4e5,x=5e5,M=500001,k=500002,I=500003;function A(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function S(t){return new Float64Array(t||3)}function D(t){return new FloatArrayClass(t||4)}function C(t,e,i){return i||(i=t),i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i}function V(t,e,i){return i||(i=t),i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i}function L(t,e,i){return i||(i=t),i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i}function U(t,e,i){i||(i=t);var s=t[0],r=t[1],h=t[2],o=e[0],n=e[1],a=e[2];return i[0]=r*a-h*n,i[1]=h*o-s*a,i[2]=s*n-r*o,i}function z(t){return Math.sqrt(function(t){return A(t,t)}(t))}function T(t,e,i,s,r,h){var o=h||S(),n=(t-e)/(i-e);return o[0]=s[0]+n*(r[0]-s[0]),o[1]=s[1]+n*(r[1]-s[1]),o[2]=s[2]+n*(r[2]-s[2]),o}function F(t,e){return C(t,1/z(t),e)}function R(t){return h(t||16)}D(),D(),new FloatArrayClass(2);var _=R(),W=R();function E(t){return t||(t=R()),t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function H(t,e,i){i||(i=R());var s,r,h,o,n,a,l=function(t,e){return function(t,e,i){return i||(i=t),i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i[3]=t[3]*e,i}(t,1/function(t){return Math.sqrt(function(t){return function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}(t,t)}(t))}(t),[])}([e[0],e[1],e[2],0]),d=Math.sin(t),c=Math.cos(t),u=1-c,v=l[0],b=l[1],p=l[2];return s=v*b,r=b*p,h=p*v,o=v*d,n=b*d,a=p*d,i[0]=u*v*v+c,i[1]=u*s+a,i[2]=u*h-n,i[3]=0,i[4]=u*s-a,i[5]=u*b*b+c,i[6]=u*r+o,i[7]=0,i[8]=u*h+n,i[9]=u*r-o,i[10]=u*p*p+c,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function q(t,e,i,s){s||(s=R());var r,h,o,n,a,l,d,c,u,v,b=t[0],p=t[1],w=t[2],y=i[0],j=i[1],g=i[2],f=e[0],O=e[1],P=e[2];return b===f&&p===O&&w===P?E():(r=b-f,h=p-O,o=w-P,n=j*(o*=v=1/Math.sqrt(r*r+h*h+o*o))-g*(h*=v),a=g*(r*=v)-y*o,l=y*h-j*r,(v=Math.sqrt(n*n+a*a+l*l))?(n*=v=1/v,a*=v,l*=v):(n=0,a=0,l=0),d=h*l-o*a,c=o*n-r*l,u=r*a-h*n,(v=Math.sqrt(d*d+c*c+u*u))?(d*=v=1/v,c*=v,u*=v):(d=0,c=0,u=0),s[0]=n,s[1]=d,s[2]=r,s[3]=0,s[4]=a,s[5]=c,s[6]=h,s[7]=0,s[8]=l,s[9]=u,s[10]=o,s[11]=0,s[12]=-(n*b+a*p+l*w),s[13]=-(d*b+c*p+u*w),s[14]=-(r*b+h*p+o*w),s[15]=1,s)}function $(t,e){e||(e=t);var i=t[0],s=t[1],r=t[2],h=t[3],o=t[4],n=t[5],a=t[6],l=t[7],d=t[8],c=t[9],u=t[10],v=t[11],b=t[12],p=t[13],w=t[14],y=t[15],j=i*n-s*o,g=i*a-r*o,f=i*l-h*o,O=s*a-r*n,P=s*l-h*n,m=r*l-h*a,x=d*p-c*b,M=d*w-u*b,k=d*y-v*b,I=c*w-u*p,A=c*y-v*p,S=u*y-v*w,D=1/(j*S-g*A+f*I+O*k-P*M+m*x);return e[0]=(n*S-a*A+l*I)*D,e[1]=(-s*S+r*A-h*I)*D,e[2]=(p*m-w*P+y*O)*D,e[3]=(-c*m+u*P-v*O)*D,e[4]=(-o*S+a*k-l*M)*D,e[5]=(i*S-r*k+h*M)*D,e[6]=(-b*m+w*f-y*g)*D,e[7]=(d*m-u*f+v*g)*D,e[8]=(o*A-n*k+l*x)*D,e[9]=(-i*A+s*k-h*x)*D,e[10]=(b*P-p*f+y*j)*D,e[11]=(-d*P+c*f-v*j)*D,e[12]=(-o*I+n*M-a*x)*D,e[13]=(i*I-s*M+r*x)*D,e[14]=(-b*O+p*g-w*j)*D,e[15]=(d*O-c*g+u*j)*D,e}function X(t,e){var i=t[4],s=t[14],r=t[8],h=t[13],o=t[12],n=t[9];if(!e||t===e){var a=t[1],l=t[2],d=t[3],c=t[6],u=t[7],v=t[11];return t[1]=i,t[2]=r,t[3]=o,t[4]=a,t[6]=n,t[7]=h,t[8]=l,t[9]=c,t[11]=s,t[12]=d,t[13]=u,t[14]=v,t}return e[0]=t[0],e[1]=i,e[2]=r,e[3]=o,e[4]=t[1],e[5]=t[5],e[6]=n,e[7]=h,e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=s,e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15],e}function B(t,e,i){i||(i=t);var s=e[0],r=e[1],h=e[2],o=e[3];return i[0]=t[0]*s+t[4]*r+t[8]*h+t[12]*o,i[1]=t[1]*s+t[5]*r+t[9]*h+t[13]*o,i[2]=t[2]*s+t[6]*r+t[10]*h+t[14]*o,i[3]=t[3]*s+t[7]*r+t[11]*h+t[15]*o,i}function N(t,e,i){i||(i=t);var s=t[0],r=t[1],h=t[2],o=t[3],n=t[4],a=t[5],l=t[6],d=t[7],c=t[8],u=t[9],v=t[10],b=t[11],p=t[12],w=t[13],y=t[14],j=t[15],g=e[0],f=e[1],O=e[2],P=e[3],m=e[4],x=e[5],M=e[6],k=e[7],I=e[8],A=e[9],S=e[10],D=e[11],C=e[12],V=e[13],L=e[14],U=e[15];return i[0]=g*s+f*n+O*c+P*p,i[1]=g*r+f*a+O*u+P*w,i[2]=g*h+f*l+O*v+P*y,i[3]=g*o+f*d+O*b+P*j,i[4]=m*s+x*n+M*c+k*p,i[5]=m*r+x*a+M*u+k*w,i[6]=m*h+x*l+M*v+k*y,i[7]=m*o+x*d+M*b+k*j,i[8]=I*s+A*n+S*c+D*p,i[9]=I*r+A*a+S*u+D*w,i[10]=I*h+A*l+S*v+D*y,i[11]=I*o+A*d+S*b+D*j,i[12]=C*s+V*n+L*c+U*p,i[13]=C*r+V*a+L*u+U*w,i[14]=C*h+V*l+L*v+U*y,i[15]=C*o+V*d+L*b+U*j,i}function G(t,e,i){i||(i=e);var s=e[0],r=e[1],h=e[2];return i[0]=t[0]*s+t[4]*r+t[8]*h+t[12],i[1]=t[1]*s+t[5]*r+t[9]*h+t[13],i[2]=t[2]*s+t[6]*r+t[10]*h+t[14],i}h(3),S(),R(),h(3);var Q=/*#__PURE__*/c("rendererViewObject"),Y=/*#__PURE__*/c("state");class J{constructor(t,e,i){this.id=void 0,this.layer=void 0,this.sceneObject=void 0,Object.defineProperty(this,Q,{writable:!0,value:void 0}),Object.defineProperty(this,Y,{writable:!0,value:void 0}),this.id=e.id,this.layer=t,this.sceneObject=e,u(this,Q)[Q]=i,u(this,Y)[Y]={visible:!0,culled:!1,pickable:!0,clippable:!0,collidable:!0,xrayed:!1,selected:!1,highlighted:!1,edges:!1,colorize:new Float32Array(4),colorized:!1,opacityUpdated:!1},u(this,Q)[Q].setVisible(this.layer.view.viewIndex,u(this,Y)[Y].visible),this.layer.objectVisibilityUpdated(this,u(this,Y)[Y].visible,!0)}get aabb(){return this.sceneObject.aabb}get visible(){return u(this,Y)[Y].visible}set visible(t){t!==u(this,Y)[Y].visible&&(u(this,Y)[Y].visible=t,u(this,Q)[Q].setVisible(this.layer.view.viewIndex,t),this.layer.objectVisibilityUpdated(this,t,!0),this.layer.redraw())}get xrayed(){return u(this,Y)[Y].xrayed}set xrayed(t){u(this,Y)[Y].xrayed!==t&&(u(this,Y)[Y].xrayed=t,u(this,Q)[Q].setXRayed(this.layer.view.viewIndex,t),this.layer.objectXRayedUpdated(this,t),this.layer.redraw())}get edges(){return u(this,Y)[Y].edges}set edges(t){u(this,Y)[Y].edges!==t&&(u(this,Y)[Y].edges=t,u(this,Q)[Q].setEdges(this.layer.view.viewIndex,t),this.layer.redraw())}get highlighted(){return u(this,Y)[Y].highlighted}set highlighted(t){t!==u(this,Y)[Y].highlighted&&(u(this,Y)[Y].highlighted=t,u(this,Q)[Q].setHighlighted(this.layer.view.viewIndex,t),this.layer.objectHighlightedUpdated(this,t),this.layer.redraw())}get selected(){return u(this,Y)[Y].selected}set selected(t){t!==u(this,Y)[Y].selected&&(u(this,Y)[Y].selected=t,u(this,Q)[Q].setSelected(this.layer.view.viewIndex,t),this.layer.objectSelectedUpdated(this,t),this.layer.redraw())}get culled(){return u(this,Y)[Y].culled}set culled(t){t!==u(this,Y)[Y].culled&&(u(this,Y)[Y].culled=t,this.layer.redraw())}get clippable(){return u(this,Y)[Y].clippable}set clippable(t){t!==u(this,Y)[Y].clippable&&(u(this,Y)[Y].clippable=t,this.layer.redraw())}get collidable(){return u(this,Y)[Y].collidable}set collidable(t){t!==u(this,Y)[Y].collidable&&(u(this,Y)[Y].collidable=t)}get pickable(){return u(this,Y)[Y].pickable}set pickable(t){u(this,Y)[Y].pickable!==t&&(u(this,Y)[Y].pickable=t)}get colorize(){return u(this,Y)[Y].colorize}set colorize(t){let e=u(this,Y)[Y].colorize;t?(e[0]=t[0],e[1]=t[1],e[2]=t[2]):(e[0]=1,e[1]=1,e[2]=1),u(this,Y)[Y].colorized=!!t,this.layer.objectColorizeUpdated(this,u(this,Y)[Y].colorized),this.layer.redraw()}get opacity(){return u(this,Y)[Y].colorize[3]}set opacity(t){let e=u(this,Y)[Y].colorize;u(this,Y)[Y].opacityUpdated=null!=t,e[3]=u(this,Y)[Y].opacityUpdated?t:1,this.layer.objectOpacityUpdated(this,u(this,Y)[Y].opacityUpdated),this.layer.redraw()}_destroy(){u(this,Y)[Y].visible&&this.layer.objectVisibilityUpdated(this,!1,!1),u(this,Y)[Y].xrayed&&this.layer.objectXRayedUpdated(this,!1),u(this,Y)[Y].selected&&this.layer.objectSelectedUpdated(this,!1),u(this,Y)[Y].highlighted&&this.layer.objectHighlightedUpdated(this,!1),u(this,Y)[Y].colorized&&this.layer.objectColorizeUpdated(this,!1),u(this,Y)[Y].opacityUpdated&&this.layer.objectOpacityUpdated(this,!1),this.layer.redraw()}}var K=/*#__PURE__*/c("state");class Z extends t{constructor(t,i={}){super(t,i),this.view=void 0,this.onPos=void 0,this.onDir=void 0,this.onActive=void 0,Object.defineProperty(this,K,{writable:!0,value:void 0}),this.view=t,u(this,K)[K]={active:!1!==i.active,pos:new Float64Array(i.pos||[0,0,0]),dir:new Float32Array(i.pos||[0,0,-1]),dist:0},this.onPos=new e(new s),this.onDir=new e(new s),this.onActive=new e(new s)}get active(){return u(this,K)[K].active}set active(t){u(this,K)[K].active!==t&&(u(this,K)[K].active=t,this.view.redraw(),this.onActive.dispatch(this,u(this,K)[K].active))}get pos(){return u(this,K)[K].pos}set pos(t){u(this,K)[K].pos.set(t),u(this,K)[K].dist=-A(u(this,K)[K].pos,u(this,K)[K].dir),this.onPos.dispatch(this,u(this,K)[K].pos)}get dir(){return u(this,K)[K].dir}set dir(t){u(this,K)[K].dir.set(t),u(this,K)[K].dist=-A(u(this,K)[K].pos,u(this,K)[K].dir),this.view.redraw(),this.onDir.dispatch(this,u(this,K)[K].dir)}get dist(){return u(this,K)[K].dist}flipDir(){const t=u(this,K)[K].dir;t[0]*=-1,t[1]*=-1,t[2]*=-1,u(this,K)[K].dist=-A(u(this,K)[K].pos,u(this,K)[K].dir),this.onDir.dispatch(this,u(this,K)[K].dir),this.view.redraw()}destroy(){this.onPos.clear(),this.onDir.clear(),super.destroy()}}const tt={[m]:{abbrev:"m"},400001:{abbrev:"cm"},400002:{abbrev:"mm"},400003:{abbrev:"yd"},400004:{abbrev:"ft"},400005:{abbrev:"in"}};var et=/*#__PURE__*/c("units"),it=/*#__PURE__*/c("scale"),st=/*#__PURE__*/c("origin");class rt extends t{constructor(t,i={units:m,scale:1,origin:[1,1,1]}){super(t,i),Object.defineProperty(this,et,{writable:!0,value:void 0}),Object.defineProperty(this,it,{writable:!0,value:void 0}),Object.defineProperty(this,st,{writable:!0,value:void 0}),this.onUnits=void 0,this.onScale=void 0,this.onOrigin=void 0,this.onUnits=new e(new s),this.onScale=new e(new s),this.onOrigin=new e(new s),u(this,et)[et]=m,u(this,it)[it]=1,u(this,st)[st]=S([0,0,0]),this.units=i.units,this.scale=i.scale,this.origin=i.origin}get unitsInfo(){return tt}get units(){return u(this,et)[et]}set units(t){t||(t=m),tt[t]||(this.error("Unsupported value for 'units': "+t+" defaulting to MetersUnit"),t=m),u(this,et)[et]=t,this.onUnits.dispatch(this,u(this,et)[et])}get scale(){return u(this,it)[it]}set scale(t){(t=t||1)<=0?this.error("scale value should be larger than zero"):(u(this,it)[it]=t,this.onScale.dispatch(this,u(this,it)[it]))}get origin(){return u(this,st)[st]}set origin(t){if(!t)return u(this,st)[st][0]=0,u(this,st)[st][1]=0,void(u(this,st)[st][2]=0);u(this,st)[st][0]=t[0],u(this,st)[st][1]=t[1],u(this,st)[st][2]=t[2],this.onOrigin.dispatch(this,u(this,st)[st])}worldToRealPos(t,e=S()){return e[0]=u(this,st)[st][0]+u(this,it)[it]*t[0],e[1]=u(this,st)[st][1]+u(this,it)[it]*t[1],e[2]=u(this,st)[st][2]+u(this,it)[it]*t[2],e}realToWorldPos(t,e=S()){return e[0]=(t[0]-u(this,st)[st][0])/u(this,it)[it],e[1]=(t[1]-u(this,st)[st][1])/u(this,it)[it],e[2]=(t[2]-u(this,st)[st][2])/u(this,it)[it],e}destroy(){super.destroy(),this.onUnits.clear(),this.onScale.clear(),this.onOrigin.clear()}}var ht=/*#__PURE__*/c("state");class ot extends t{constructor(t,e){super(t,e),this.view=void 0,Object.defineProperty(this,ht,{writable:!0,value:void 0}),this.view=t,u(this,ht)[ht]={renderModes:[P],enabled:!1!==e.enabled,kernelRadius:e.kernelRadius||100,intensity:void 0!==e.intensity?e.intensity:.15,bias:void 0!==e.bias?e.bias:.5,scale:void 0!==e.scale?e.scale:1,minResolution:void 0!==e.minResolution?e.minResolution:0,numSamples:void 0!==e.numSamples?e.numSamples:10,blur:!!e.blur,blendCutoff:void 0!==e.blendCutff?e.blendCutoff:.3,blendFactor:void 0!==e.blendFactor?e.blendFactor:1}}get renderModes(){return u(this,ht)[ht].renderModes}set renderModes(t){u(this,ht)[ht].renderModes=t,this.view.redraw()}get supported(){return this.view.viewer.renderer.getSAOSupported()}get enabled(){return u(this,ht)[ht].enabled}set enabled(t){t=!!t,u(this,ht)[ht].enabled!==t&&(u(this,ht)[ht].enabled=t,this.view.redraw())}get possible(){if(!this.supported)return!1;if(!u(this,ht)[ht].enabled)return!1;const t=this.view.camera.projectionType;return t!==I&&t!==k}get kernelRadius(){return u(this,ht)[ht].kernelRadius}set kernelRadius(t){null==t&&(t=100),u(this,ht)[ht].kernelRadius!==t&&(u(this,ht)[ht].kernelRadius=t,this.view.redraw())}get intensity(){return u(this,ht)[ht].intensity}set intensity(t){null==t&&(t=.15),u(this,ht)[ht].intensity!==t&&(u(this,ht)[ht].intensity=t,this.view.redraw())}get bias(){return u(this,ht)[ht].bias}set bias(t){null==t&&(t=.5),u(this,ht)[ht].bias!==t&&(u(this,ht)[ht].bias=t,this.view.redraw())}get scale(){return u(this,ht)[ht].scale}set scale(t){null==t&&(t=1),u(this,ht)[ht].scale!==t&&(u(this,ht)[ht].scale=t,this.view.redraw())}get minResolution(){return u(this,ht)[ht].minResolution}set minResolution(t){null==t&&(t=0),u(this,ht)[ht].minResolution!==t&&(u(this,ht)[ht].minResolution=t,this.view.redraw())}get numSamples(){return u(this,ht)[ht].numSamples}set numSamples(t){null==t&&(t=10),u(this,ht)[ht].numSamples!==t&&(u(this,ht)[ht].numSamples=t,this.view.redraw())}get blur(){return u(this,ht)[ht].blur}set blur(t){t=!1!==t,u(this,ht)[ht].blur!==t&&(u(this,ht)[ht].blur=t,this.view.redraw())}get blendCutoff(){return u(this,ht)[ht].blendCutoff}set blendCutoff(t){null==t&&(t=.3),u(this,ht)[ht].blendCutoff!==t&&(u(this,ht)[ht].blendCutoff=t,this.view.redraw())}get blendFactor(){return u(this,ht)[ht].blendFactor}set blendFactor(t){null==t&&(t=1),u(this,ht)[ht].blendFactor!==t&&(u(this,ht)[ht].blendFactor=t,this.view.redraw())}destroy(){super.destroy()}}var nt=/*#__PURE__*/c("state");class at extends t{constructor(t,e={lineWidth:1}){super(t,e),this.view=void 0,Object.defineProperty(this,nt,{writable:!0,value:void 0}),this.view=t,u(this,nt)[nt]={lineWidth:null!=e.lineWidth?e.lineWidth:1}}set lineWidth(t){u(this,nt)[nt].lineWidth=t||1,this.view.redraw()}get lineWidth(){return u(this,nt)[nt].lineWidth}}var lt=/*#__PURE__*/c("numObjects"),dt=/*#__PURE__*/c("objectIds"),ct=/*#__PURE__*/c("numVisibleObjects"),ut=/*#__PURE__*/c("visibleObjectIds"),vt=/*#__PURE__*/c("numXRayedObjects"),bt=/*#__PURE__*/c("xrayedObjectIds"),pt=/*#__PURE__*/c("numHighlightedObjects"),wt=/*#__PURE__*/c("highlightedObjectIds"),yt=/*#__PURE__*/c("numSelectedObjects"),jt=/*#__PURE__*/c("selectedObjectIds"),gt=/*#__PURE__*/c("numColorizedObjects"),ft=/*#__PURE__*/c("colorizedObjectIds"),Ot=/*#__PURE__*/c("numOpacityObjects"),Pt=/*#__PURE__*/c("opacityObjectIds"),mt=/*#__PURE__*/c("qualityRender"),xt=/*#__PURE__*/c("initObjects"),Mt=/*#__PURE__*/c("createObjects"),kt=/*#__PURE__*/c("destroyObjects");class It extends t{constructor(t){super(t.view,t),Object.defineProperty(this,kt,{value:Dt}),Object.defineProperty(this,Mt,{value:St}),Object.defineProperty(this,xt,{value:At}),this.objects=void 0,this.visibleObjects=void 0,this.xrayedObjects=void 0,this.highlightedObjects=void 0,this.selectedObjects=void 0,this.colorizedObjects=void 0,this.opacityObjects=void 0,this.autoDestroy=void 0,this.onObjectVisibility=void 0,Object.defineProperty(this,lt,{writable:!0,value:void 0}),Object.defineProperty(this,dt,{writable:!0,value:void 0}),Object.defineProperty(this,ct,{writable:!0,value:void 0}),Object.defineProperty(this,ut,{writable:!0,value:void 0}),Object.defineProperty(this,vt,{writable:!0,value:void 0}),Object.defineProperty(this,bt,{writable:!0,value:void 0}),Object.defineProperty(this,pt,{writable:!0,value:void 0}),Object.defineProperty(this,wt,{writable:!0,value:void 0}),Object.defineProperty(this,yt,{writable:!0,value:void 0}),Object.defineProperty(this,jt,{writable:!0,value:void 0}),Object.defineProperty(this,gt,{writable:!0,value:void 0}),Object.defineProperty(this,ft,{writable:!0,value:void 0}),Object.defineProperty(this,Ot,{writable:!0,value:void 0}),Object.defineProperty(this,Pt,{writable:!0,value:void 0}),Object.defineProperty(this,mt,{writable:!0,value:void 0}),this.gammaOutput=void 0,this.id=t.id,this.viewer=t.viewer,this.view=t.view,this.objects={},this.visibleObjects={},this.xrayedObjects={},this.highlightedObjects={},this.selectedObjects={},this.colorizedObjects={},this.opacityObjects={},this.autoDestroy=!1!==t.autoDestroy,u(this,lt)[lt]=0,u(this,ct)[ct]=0,u(this,vt)[vt]=0,u(this,pt)[pt]=0,u(this,yt)[yt]=0,u(this,gt)[gt]=0,u(this,Ot)[Ot]=0,u(this,mt)[mt]=!!t.qualityRender,this.onObjectVisibility=new e(new s),u(this,xt)[xt]()}get gammaFactor(){return 1}set qualityRender(t){u(this,mt)[mt]!==t&&(u(this,mt)[mt]=t,this.redraw())}get qualityRender(){return u(this,mt)[mt]}get numObjects(){return u(this,lt)[lt]}get objectIds(){return u(this,dt)[dt]||(u(this,dt)[dt]=Object.keys(this.objects)),u(this,dt)[dt]}get numVisibleObjects(){return u(this,ct)[ct]}get visibleObjectIds(){return u(this,ut)[ut]||(u(this,ut)[ut]=Object.keys(this.visibleObjects)),u(this,ut)[ut]}get numXRayedObjects(){return u(this,vt)[vt]}get xrayedObjectIds(){return u(this,bt)[bt]||(u(this,bt)[bt]=Object.keys(this.xrayedObjects)),u(this,bt)[bt]}get numHighlightedObjects(){return u(this,pt)[pt]}get highlightedObjectIds(){return u(this,wt)[wt]||(u(this,wt)[wt]=Object.keys(this.highlightedObjects)),u(this,wt)[wt]}get numSelectedObjects(){return u(this,yt)[yt]}get selectedObjectIds(){return u(this,jt)[jt]||(u(this,jt)[jt]=Object.keys(this.selectedObjects)),u(this,jt)[jt]}get numColorizedObjects(){return u(this,gt)[gt]}get colorizedObjectIds(){return u(this,ft)[ft]||(u(this,ft)[ft]=Object.keys(this.colorizedObjects)),u(this,ft)[ft]}get opacityObjectIds(){return u(this,Pt)[Pt]||(u(this,Pt)[Pt]=Object.keys(this.opacityObjects)),u(this,Pt)[Pt]}get numOpacityObjects(){return u(this,Ot)[Ot]}registerViewObject(t){this.objects[t.id]=t,u(this,lt)[lt]++,u(this,dt)[dt]=null}deregisterViewObject(t){delete this.objects[t.id],delete this.visibleObjects[t.id],delete this.xrayedObjects[t.id],delete this.highlightedObjects[t.id],delete this.selectedObjects[t.id],delete this.colorizedObjects[t.id],delete this.opacityObjects[t.id],u(this,lt)[lt]--,u(this,dt)[dt]=null}redraw(){this.viewer.renderer.setImageDirty(this.view.viewIndex)}objectVisibilityUpdated(t,e,i=!0){e?(this.visibleObjects[t.id]=t,u(this,ct)[ct]++):(delete this.visibleObjects[t.id],u(this,ct)[ct]--),u(this,ut)[ut]=null,i&&this.onObjectVisibility.dispatch(this,t),this.view.objectVisibilityUpdated(t,e,i)}objectXRayedUpdated(t,e){e?(this.xrayedObjects[t.id]=t,u(this,vt)[vt]++):(delete this.xrayedObjects[t.id],u(this,vt)[vt]--),u(this,bt)[bt]=null,this.view.objectXRayedUpdated(t,e)}objectHighlightedUpdated(t,e){e?(this.highlightedObjects[t.id]=t,u(this,pt)[pt]++):(delete this.highlightedObjects[t.id],u(this,pt)[pt]--),u(this,wt)[wt]=null,this.view.objectHighlightedUpdated(t,e)}objectSelectedUpdated(t,e){e?(this.selectedObjects[t.id]=t,u(this,yt)[yt]++):(delete this.selectedObjects[t.id],u(this,yt)[yt]--),u(this,jt)[jt]=null,this.view.objectSelectedUpdated(t,e)}objectColorizeUpdated(t,e){e?(this.colorizedObjects[t.id]=t,u(this,gt)[gt]++):(delete this.colorizedObjects[t.id],u(this,gt)[gt]--),u(this,ft)[ft]=null,this.view.objectColorizeUpdated(t,e)}objectOpacityUpdated(t,e){e?(this.opacityObjects[t.id]=t,u(this,Ot)[Ot]++):(delete this.opacityObjects[t.id],u(this,Ot)[Ot]--),u(this,Pt)[Pt]=null,this.view.objectOpacityUpdated(t,e)}setObjectsVisible(t,e){return this.withObjects(t,t=>{const i=t.visible!==e;return t.visible=e,i})}setObjectsCollidable(t,e){return this.withObjects(t,t=>{const i=t.collidable!==e;return t.collidable=e,i})}setObjectsCulled(t,e){return this.withObjects(t,t=>{const i=t.culled!==e;return t.culled=e,i})}setObjectsSelected(t,e){return this.withObjects(t,t=>{const i=t.selected!==e;return t.selected=e,i})}setObjectsHighlighted(t,e){return this.withObjects(t,t=>{const i=t.highlighted!==e;return t.highlighted=e,i})}setObjectsXRayed(t,e){return this.withObjects(t,t=>{const i=t.xrayed!==e;return i&&(t.xrayed=e),i})}setObjectsColorized(t,e){return this.withObjects(t,t=>{t.colorize=e})}setObjectsOpacity(t,e){return this.withObjects(t,t=>{const i=t.opacity!==e;return i&&(t.opacity=e),i})}setObjectsPickable(t,e){return this.withObjects(t,t=>{const i=t.pickable!==e;return i&&(t.pickable=e),i})}setObjectsClippable(t,e){return this.withObjects(t,t=>{const i=t.clippable!==e;return i&&(t.clippable=e),i})}withObjects(t,e){let i=!1;for(let s=0,r=t.length;s<r;s++){let r=this.objects[t[s]];r&&(i=e(r)||i)}return i}destroy(){super.destroy()}}function At(){const t=this.viewer.scene.models;for(const e in t){const i=t[e];u(this,Mt)[Mt](i)}this.viewer.scene.onModelCreated.subscribe((t,e)=>{u(this,Mt)[Mt](e)}),this.viewer.scene.onModelDestroyed.subscribe((t,e)=>{u(this,kt)[kt](e)})}function St(t){const e=t.objects;for(let t in e){const i=this.viewer.renderer.rendererViewObjects[t];if(i.layerId==this.id){const s=new J(this,e[t],i);this.objects[s.id]=s,u(this,lt)[lt]++,u(this,dt)[dt]=null}}}function Dt(t){const e=t.objects;for(let t in e)this.objects[e[t].id]._destroy(),u(this,lt)[lt]--,u(this,dt)[dt]=null}var Ct=/*#__PURE__*/c("state");class Vt extends t{constructor(t,e={}){super(t,e),this.view=void 0,Object.defineProperty(this,Ct,{writable:!0,value:void 0}),this.view=t,u(this,Ct)[Ct]={fill:!!e.fill,fillColor:new Float32Array(e.fillColor||[.4,.4,.4]),fillAlpha:null!=e.fillAlpha?e.fillAlpha:.2,edges:!1!==e.edges,edgeColor:new Float32Array(e.edgeColor||[.2,.2,.2]),edgeAlpha:null!=e.edgeAlpha?e.edgeAlpha:.5,edgeWidth:null!=e.edgeWidth?e.edgeWidth:1,backfaces:!!e.backfaces}}set fill(t){u(this,Ct)[Ct].fill!==t&&(u(this,Ct)[Ct].fill=t,this.view.redraw())}get fill(){return u(this,Ct)[Ct].fill}set fillColor(t){const e=u(this,Ct)[Ct].fillColor;e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]||(e[0]=.4,e[1]=.4,e[2]=.4,this.view.redraw())}get fillColor(){return u(this,Ct)[Ct].fillColor}set fillAlpha(t){u(this,Ct)[Ct].fillAlpha!==t&&(u(this,Ct)[Ct].fillAlpha=t,this.view.redraw())}get fillAlpha(){return u(this,Ct)[Ct].fillAlpha}set edges(t){u(this,Ct)[Ct].edges!==t&&(u(this,Ct)[Ct].edges=t,this.view.redraw())}get edges(){return u(this,Ct)[Ct].edges}set edgeColor(t){let e=u(this,Ct)[Ct].edgeColor;e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]||(e[0]=.2,e[1]=.2,e[2]=.2,this.view.redraw())}get edgeColor(){return u(this,Ct)[Ct].edgeColor}set edgeAlpha(t){u(this,Ct)[Ct].edgeAlpha!==t&&(u(this,Ct)[Ct].edgeAlpha=t,this.view.redraw())}get edgeAlpha(){return u(this,Ct)[Ct].edgeAlpha}set edgeWidth(t){u(this,Ct)[Ct].edgeWidth=t,this.view.redraw()}get edgeWidth(){return u(this,Ct)[Ct].edgeWidth}set backfaces(t){u(this,Ct)[Ct].backfaces!==t&&(u(this,Ct)[Ct].backfaces=t,this.view.redraw())}get backfaces(){return u(this,Ct)[Ct].backfaces}get hash(){return""}destroy(){super.destroy()}}var Lt=/*#__PURE__*/c("state");class Ut extends t{constructor(t,e={}){super(t,e),this.view=void 0,Object.defineProperty(this,Lt,{writable:!0,value:void 0}),this.view=t,u(this,Lt)[Lt]={renderModes:e.renderModes||[P],edges:!1!==e.edges,edgeColor:new Float32Array(e.edgeColor||[.2,.2,.2]),edgeAlpha:null!=e.edgeAlpha?e.edgeAlpha:.5,edgeWidth:null!=e.edgeWidth?e.edgeWidth:1}}set renderModes(t){u(this,Lt)[Lt].renderModes=t,this.view.redraw()}get renderModes(){return u(this,Lt)[Lt].renderModes}set edges(t){u(this,Lt)[Lt].edges!==t&&(u(this,Lt)[Lt].edges=t,this.view.redraw())}get edges(){return u(this,Lt)[Lt].edges}set edgeColor(t){let e=u(this,Lt)[Lt].edgeColor;t&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]||(e[0]=.2,e[1]=.2,e[2]=.2,this.view.redraw())}get edgeColor(){return u(this,Lt)[Lt].edgeColor}set edgeAlpha(t){u(this,Lt)[Lt].edgeAlpha!==t&&(u(this,Lt)[Lt].edgeAlpha=t,this.view.redraw())}get edgeAlpha(){return u(this,Lt)[Lt].edgeAlpha}set edgeWidth(t){u(this,Lt)[Lt].edgeWidth!==t&&(u(this,Lt)[Lt].edgeWidth=t,this.view.redraw())}get edgeWidth(){return u(this,Lt)[Lt].edgeWidth}destroy(){super.destroy()}}var zt=/*#__PURE__*/c("state");class Tt extends t{constructor(t,e={}){super(t,e),this.view=void 0,Object.defineProperty(this,zt,{writable:!0,value:void 0}),this.view=t,u(this,zt)[zt]={pointSize:null!=e.pointSize?e.pointSize:1,roundPoints:!1!==e.roundPoints,perspectivePoints:!1!==e.perspectivePoints,minPerspectivePointSize:null!=e.minPerspectivePointSize?e.minPerspectivePointSize:1,maxPerspectivePointSize:null!=e.maxPerspectivePointSize?e.maxPerspectivePointSize:6,filterIntensity:!!e.filterIntensity,minIntensity:null!=e.minIntensity?e.minIntensity:0,maxIntensity:null!=e.maxIntensity?e.maxIntensity:1}}set pointSize(t){u(this,zt)[zt].pointSize=t,this.view.redraw()}get pointSize(){return u(this,zt)[zt].pointSize}set roundPoints(t){u(this,zt)[zt].roundPoints!==t&&(u(this,zt)[zt].roundPoints=t,this.view.rebuild())}get roundPoints(){return u(this,zt)[zt].roundPoints}set perspectivePoints(t){u(this,zt)[zt].perspectivePoints!==t&&(u(this,zt)[zt].perspectivePoints=t,this.view.rebuild())}get perspectivePoints(){return u(this,zt)[zt].perspectivePoints}set minPerspectivePointSize(t){u(this,zt)[zt].minPerspectivePointSize!==t&&(u(this,zt)[zt].minPerspectivePointSize=t,this.view.rebuild())}get minPerspectivePointSize(){return u(this,zt)[zt].minPerspectivePointSize}set maxPerspectivePointSize(t){u(this,zt)[zt].maxPerspectivePointSize!==t&&(u(this,zt)[zt].maxPerspectivePointSize=t,this.view.rebuild())}get maxPerspectivePointSize(){return u(this,zt)[zt].maxPerspectivePointSize}set filterIntensity(t){u(this,zt)[zt].filterIntensity!==t&&(u(this,zt)[zt].filterIntensity=t,this.view.rebuild())}get filterIntensity(){return u(this,zt)[zt].filterIntensity}set minIntensity(t){u(this,zt)[zt].minIntensity!==t&&(u(this,zt)[zt].minIntensity=t,this.view.redraw())}get minIntensity(){return u(this,zt)[zt].minIntensity}set maxIntensity(t){u(this,zt)[zt].maxIntensity!==t&&(u(this,zt)[zt].maxIntensity=t,this.view.redraw())}get maxIntensity(){return u(this,zt)[zt].maxIntensity}get hash(){const t=u(this,zt)[zt];return`${t.pointSize};\n        ${t.roundPoints};\n        ${t.perspectivePoints};\n        ${t.minPerspectivePointSize};\n        ${t.maxPerspectivePointSize};\n        ${t.filterIntensity}`}destroy(){super.destroy()}}var Ft=/*#__PURE__*/c("state"),Rt=/*#__PURE__*/c("inverseMatrixDirty"),_t=/*#__PURE__*/c("transposedProjMatrixDirty"),Wt=/*#__PURE__*/c("onViewBoundary");class Et extends t{constructor(t,i={}){super(t,i),this.camera=void 0,this.onProjMatrix=void 0,Object.defineProperty(this,Ft,{writable:!0,value:void 0}),Object.defineProperty(this,Rt,{writable:!0,value:void 0}),Object.defineProperty(this,_t,{writable:!0,value:void 0}),Object.defineProperty(this,Wt,{writable:!0,value:void 0}),this.camera=t,u(this,Ft)[Ft]={near:i.near||.1,far:i.far||2e3,fov:i.fov||60,fovAxis:i.fovAxis||"min",projMatrix:R(),inverseProjMatrix:R(),transposedProjMatrix:R()},u(this,Rt)[Rt]=!0,u(this,_t)[_t]=!0,u(this,Wt)[Wt]=this.camera.view.onBoundary.subscribe(()=>{this.setDirty()}),this.onProjMatrix=new e(new s)}get fov(){return u(this,Ft)[Ft].fov}set fov(t){t!==u(this,Ft)[Ft].fov&&(u(this,Ft)[Ft].fov=t,this.setDirty())}get fovAxis(){return u(this,Ft)[Ft].fovAxis}set fovAxis(t){t=t||"min",u(this,Ft)[Ft].fovAxis!==t&&("x"!==t&&"y"!==t&&"min"!==t&&(this.error("Unsupported value for 'fovAxis': "+t+" - defaulting to 'min'"),t="min"),u(this,Ft)[Ft].fovAxis=t,this.setDirty())}get near(){return u(this,Ft)[Ft].near}set near(t){u(this,Ft)[Ft].near!==t&&(u(this,Ft)[Ft].near=t,this.setDirty())}get far(){return u(this,Ft)[Ft].far}set far(t){u(this,Ft)[Ft].far!==t&&(u(this,Ft)[Ft].far=t,this.setDirty())}get projMatrix(){return this.dirty&&this.cleanIfDirty(),u(this,Ft)[Ft].projMatrix}get inverseProjMatrix(){return this.dirty&&this.cleanIfDirty(),u(this,Rt)[Rt]&&($(u(this,Ft)[Ft].projMatrix,u(this,Ft)[Ft].inverseProjMatrix),u(this,Rt)[Rt]=!1),u(this,Ft)[Ft].inverseProjMatrix}get transposedProjMatrix(){return this.dirty&&this.cleanIfDirty(),u(this,_t)[_t]&&(X(u(this,Ft)[Ft].projMatrix,u(this,Ft)[Ft].transposedProjMatrix),u(this,_t)[_t]=!1),u(this,Ft)[Ft].transposedProjMatrix}clean(){const t=this.camera.view.boundary,e=t[2]/t[3],i=u(this,Ft)[Ft].fovAxis;let s=u(this,Ft)[Ft].fov;("x"===i||"min"===i&&e<1||"max"===i&&e>1)&&(s/=e),s=Math.min(s,120),function(t,e,i,s,r){var h=[],o=[];h[2]=i,o[2]=s,o[1]=h[2]*Math.tan(t/2),h[1]=-o[1],o[0]=o[1]*e,h[0]=-o[0],function(t,e,i){i||(i=R());var s=[t[0],t[1],t[2],0],r=[e[0],e[1],e[2],0];(function(t,e,i){i||(i=t),i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i[3]=t[3]+e[3]})(r,s,_),function(t,e,i){i||(i=t),i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i[3]=t[3]-e[3]}(r,s,W);var h=2*s[2],o=W[0],n=W[1],a=W[2];i[0]=h/o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=h/n,i[6]=0,i[7]=0,i[8]=_[0]/o,i[9]=_[1]/n,i[10]=-_[2]/a,i[11]=-1,i[12]=0,i[13]=0,i[14]=-h*r[2]/a,i[15]=0}(h,o,r)}(s*(Math.PI/180),e,u(this,Ft)[Ft].near,u(this,Ft)[Ft].far,u(this,Ft)[Ft].projMatrix),u(this,Rt)[Rt]=!0,u(this,_t)[_t]=!0,this.camera.view.redraw(),this.onProjMatrix.dispatch(this,u(this,Ft)[Ft].projMatrix)}unproject(t,e,i,s,r){const h=this.camera.view.canvasElement,o=h.offsetWidth/2,n=h.offsetHeight/2;return i[0]=(t[0]-o)/o,i[1]=(t[1]-n)/n,i[2]=e,i[3]=1,B(this.inverseProjMatrix,i,s),C(s,1/s[3]),s[3]=1,s[1]*=-1,B(this.camera.inverseViewMatrix,s,r),r}destroy(){super.destroy(),this.camera.view.onBoundary.unsubscribe(u(this,Wt)[Wt]),this.onProjMatrix.clear()}}Et.type=x;var Ht=/*#__PURE__*/c("state"),qt=/*#__PURE__*/c("inverseMatrixDirty"),$t=/*#__PURE__*/c("transposedProjMatrixDirty"),Xt=/*#__PURE__*/c("onViewBoundary");class Bt extends t{constructor(t,i={}){super(t,i),this.camera=void 0,this.onProjMatrix=void 0,Object.defineProperty(this,Ht,{writable:!0,value:void 0}),Object.defineProperty(this,qt,{writable:!0,value:void 0}),Object.defineProperty(this,$t,{writable:!0,value:void 0}),Object.defineProperty(this,Xt,{writable:!0,value:void 0}),this.camera=t,u(this,Ht)[Ht]={near:i.near||.1,far:i.far||2e3,scale:i.scale||1,projMatrix:R(),inverseProjMatrix:R(),transposedProjMatrix:R()},this.onProjMatrix=new e(new s),u(this,qt)[qt]=!0,u(this,$t)[$t]=!0,u(this,Xt)[Xt]=this.camera.view.onBoundary.subscribe(()=>{this.setDirty()})}get scale(){return u(this,Ht)[Ht].scale}set scale(t){t<=0&&(t=.01),u(this,Ht)[Ht].scale=t,this.setDirty()}get near(){return u(this,Ht)[Ht].near}set near(t){u(this,Ht)[Ht].near!==t&&(u(this,Ht)[Ht].near=t,this.setDirty())}get far(){return u(this,Ht)[Ht].far}set far(t){u(this,Ht)[Ht].far!==t&&(u(this,Ht)[Ht].far=t,this.setDirty())}get projMatrix(){return this.dirty&&this.cleanIfDirty(),u(this,Ht)[Ht].projMatrix}get inverseProjMatrix(){return this.dirty&&this.cleanIfDirty(),u(this,qt)[qt]&&($(u(this,Ht)[Ht].projMatrix,u(this,Ht)[Ht].inverseProjMatrix),u(this,qt)[qt]=!1),u(this,Ht)[Ht].inverseProjMatrix}get transposedProjMatrix(){return this.dirty&&this.cleanIfDirty(),u(this,$t)[$t]&&(X(u(this,Ht)[Ht].projMatrix,u(this,Ht)[Ht].transposedProjMatrix),u(this,$t)[$t]=!1),u(this,Ht)[Ht].transposedProjMatrix}clean(){const t=this.camera.view,e=.5*u(this,Ht)[Ht].scale,i=t.boundary,s=i[2],r=i[3],h=s/r;let o,n,a,l;s>r?(o=-e,n=e,a=e/h,l=-e/h):(o=-e*h,n=e*h,a=e,l=-e),function(t,e,i,s,r,h,o){o||(o=R());var n=e-t,a=s-i,l=h-r;o[0]=2/n,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2/a,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=-2/l,o[11]=0,o[12]=-(t+e)/n,o[13]=-(s+i)/a,o[14]=-(h+r)/l,o[15]=1}(o,n,l,a,u(this,Ht)[Ht].near,u(this,Ht)[Ht].far,u(this,Ht)[Ht].projMatrix),u(this,qt)[qt]=!0,u(this,$t)[$t]=!0,this.camera.view.redraw(),this.onProjMatrix.dispatch(this,u(this,Ht)[Ht].projMatrix)}unproject(t,e,i,s,r){const h=this.camera.view.canvasElement,o=h.offsetWidth/2,n=h.offsetHeight/2;return i[0]=(t[0]-o)/o,i[1]=(t[1]-n)/n,i[2]=e,i[3]=1,B(this.inverseProjMatrix,i,s),C(s,1/s[3]),s[3]=1,s[1]*=-1,B(this.camera.inverseViewMatrix,s,r),r}destroy(){super.destroy(),this.camera.view.onBoundary.unsubscribe(u(this,Xt)[Xt]),this.onProjMatrix.clear()}}Bt.type=M;var Nt=/*#__PURE__*/c("state"),Gt=/*#__PURE__*/c("inverseProjMatrixDirty"),Qt=/*#__PURE__*/c("transposedProjMatrixDirty");class Yt extends t{constructor(t,i={}){super(t,i),this.camera=void 0,this.onProjMatrix=void 0,Object.defineProperty(this,Nt,{writable:!0,value:void 0}),Object.defineProperty(this,Gt,{writable:!0,value:void 0}),Object.defineProperty(this,Qt,{writable:!0,value:void 0}),this.camera=t,u(this,Nt)[Nt]={projMatrix:R(i.projMatrix||E()),inverseProjMatrix:R(),transposedProjMatrix:R()},this.onProjMatrix=new e(new s),u(this,Gt)[Gt]=!0,u(this,Qt)[Qt]=!1}get projMatrix(){return u(this,Nt)[Nt].projMatrix}set projMatrix(t){u(this,Nt)[Nt].projMatrix.set(t),u(this,Gt)[Gt]=!0,u(this,Qt)[Qt]=!0,this.setDirty(),this.camera.view.redraw(),this.onProjMatrix.dispatch(this,u(this,Nt)[Nt].projMatrix)}get inverseProjMatrix(){return this.dirty&&this.cleanIfDirty(),u(this,Gt)[Gt]&&($(u(this,Nt)[Nt].projMatrix,u(this,Nt)[Nt].inverseProjMatrix),u(this,Gt)[Gt]=!1),u(this,Nt)[Nt].inverseProjMatrix}get transposedProjMatrix(){return this.dirty&&this.cleanIfDirty(),u(this,Qt)[Qt]&&(X(u(this,Nt)[Nt].projMatrix,u(this,Nt)[Nt].transposedProjMatrix),u(this,Qt)[Qt]=!1),u(this,Nt)[Nt].transposedProjMatrix}unproject(t,e,i,s,r){const h=this.camera.view.canvasElement,o=h.offsetWidth/2,n=h.offsetHeight/2;return i[0]=(t[0]-o)/o,i[1]=(t[1]-n)/n,i[2]=e,i[3]=1,B(this.inverseProjMatrix,i,s),C(s,1/s[3]),s[3]=1,s[1]*=-1,B(this.camera.inverseViewMatrix,s,r),r}destroy(){super.destroy(),this.onProjMatrix.clear()}}Yt.type=I;var Jt,Kt,Zt,te=R(),ee=(Jt=h(3),Kt=h(3),Zt=h(3),function(t){return Jt[0]=t[0],Jt[1]=t[1],Jt[2]=t[2],Kt[0]=t[3],Kt[1]=t[4],Kt[2]=t[5],L(Kt,Jt,Zt),Math.abs(z(Zt))}),ie=function(){var t=h(3),e=h(3),i=h(3);return function(s,r){t[0]=s[0],t[1]=s[1],t[2]=s[2],e[0]=s[3],e[1]=s[4],e[2]=s[5];var h=L(e,t,i),o=r[0]-s[0],n=s[3]-r[0],a=r[1]-s[1],l=s[4]-r[1],d=r[2]-s[2],c=s[5]-r[2];return h[0]+=o>n?o:n,h[1]+=a>l?a:l,h[2]+=d>c?d:c,Math.abs(z(h))}}();function se(t,e){return void 0===e&&(e=S()),e[0]=(t[0]+t[3])/2,e[1]=(t[1]+t[4])/2,e[2]=(t[2]+t[5])/2,e}h(3);var re=/*#__PURE__*/function(){function t(){this.testVertex=void 0,this.offset=void 0,this.normal=void 0,this.normal=S(),this.offset=0,this.testVertex=S()}return t.prototype.set=function(t,e,i,s){var r=1/Math.sqrt(t*t+e*e+i*i);this.normal[0]=t*r,this.normal[1]=e*r,this.normal[2]=i*r,this.offset=s*r,this.testVertex[0]=this.normal[0]>=0?1:0,this.testVertex[1]=this.normal[1]>=0?1:0,this.testVertex[2]=this.normal[2]>=0?1:0},t}(),he=function(){this.planes=void 0,this.planes=[new re,new re,new re,new re,new re,new re]};const oe=S(),ne=S(),ae=S(),le=S(),de=S(),ce=S(),ue=R(),ve=R(),be=S(),pe=S(),we=S(),ye=S();var je=/*#__PURE__*/c("state"),ge=/*#__PURE__*/c("frustum"),fe=/*#__PURE__*/c("activeProjection");class Oe extends t{constructor(t,i={}){super(t,i),this.view=void 0,this.perspectiveProjection=void 0,this.orthoProjection=void 0,this.frustumProjection=void 0,this.customProjection=void 0,this.onProjectionType=void 0,this.onViewMatrix=void 0,this.onProjMatrix=void 0,this.onWorldAxis=void 0,this.onFrustum=void 0,Object.defineProperty(this,je,{writable:!0,value:void 0}),Object.defineProperty(this,ge,{writable:!0,value:void 0}),Object.defineProperty(this,fe,{writable:!0,value:void 0}),this.onProjectionType=new e(new s),this.onViewMatrix=new e(new s),this.onProjMatrix=new e(new s),this.onWorldAxis=new e(new s),this.onFrustum=new e(new s),this.view=t,u(this,je)[je]={eye:S(i.eye||[0,0,10]),look:S(i.look||[0,0,0]),up:S(i.up||[0,1,0]),worldUp:S([0,1,0]),worldRight:S([1,0,0]),worldForward:S([0,0,-1]),worldAxis:new Float32Array(i.worldAxis||[1,0,0,0,1,0,0,0,1]),gimbalLock:!1!==i.gimbalLock,constrainPitch:!0===i.constrainPitch,projectionType:i.projectionType||x,deviceMatrix:i.deviceMatrix?R(i.deviceMatrix):E(),hasDeviceMatrix:!!i.deviceMatrix,viewMatrix:R(),viewNormalMatrix:R(),inverseViewMatrix:R()},u(this,ge)[ge]=new he,this.perspectiveProjection=new Et(this),this.orthoProjection=new Bt(this),this.customProjection=new Yt(this),u(this,fe)[fe]=this.perspectiveProjection,this.perspectiveProjection.onProjMatrix.subscribe(()=>{u(this,je)[je].projectionType===x&&this.onProjMatrix.dispatch(this,this.perspectiveProjection.projMatrix)}),this.orthoProjection.onProjMatrix.subscribe(()=>{u(this,je)[je].projectionType===M&&this.onProjMatrix.dispatch(this,this.orthoProjection.projMatrix)}),this.frustumProjection.onProjMatrix.subscribe(()=>{u(this,je)[je].projectionType===k&&this.onProjMatrix.dispatch(this,this.frustumProjection.projMatrix)}),this.customProjection.onProjMatrix.subscribe(()=>{u(this,je)[je].projectionType===I&&this.onProjMatrix.dispatch(this,this.customProjection.projMatrix)})}get project(){return u(this,fe)[fe]}get eye(){return u(this,je)[je].eye}set eye(t){u(this,je)[je].eye.set(t),this.setDirty()}get look(){return u(this,je)[je].look}set look(t){u(this,je)[je].look.set(t),this.setDirty()}get up(){return u(this,je)[je].up}set up(t){u(this,je)[je].up.set(t),this.setDirty()}get worldUp(){return u(this,je)[je].worldUp}get worldRight(){return u(this,je)[je].worldRight}get worldForward(){return u(this,je)[je].worldForward}get constrainPitch(){return u(this,je)[je].constrainPitch}set constrainPitch(t){u(this,je)[je].constrainPitch=t}get gimbalLock(){return u(this,je)[je].gimbalLock}set gimbalLock(t){u(this,je)[je].gimbalLock=t}get worldAxis(){return u(this,je)[je].worldAxis}set worldAxis(t){const e=u(this,je)[je];e.worldAxis.set(t),e.worldRight[0]=e.worldAxis[0],e.worldRight[1]=e.worldAxis[1],e.worldRight[2]=e.worldAxis[2],e.worldUp[0]=e.worldAxis[3],e.worldUp[1]=e.worldAxis[4],e.worldUp[2]=e.worldAxis[5],e.worldForward[0]=e.worldAxis[6],e.worldForward[1]=e.worldAxis[7],e.worldForward[2]=e.worldAxis[8],this.onWorldAxis.dispatch(this,e.worldAxis)}get deviceMatrix(){return u(this,je)[je].deviceMatrix}set deviceMatrix(t){u(this,je)[je].deviceMatrix.set(t||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),u(this,je)[je].hasDeviceMatrix=!!t,this.setDirty()}get xUp(){return u(this,je)[je].worldUp[0]>u(this,je)[je].worldUp[1]&&u(this,je)[je].worldUp[0]>u(this,je)[je].worldUp[2]}get yUp(){return u(this,je)[je].worldUp[1]>u(this,je)[je].worldUp[0]&&u(this,je)[je].worldUp[1]>u(this,je)[je].worldUp[2]}get zUp(){return u(this,je)[je].worldUp[2]>u(this,je)[je].worldUp[0]&&u(this,je)[je].worldUp[2]>u(this,je)[je].worldUp[1]}get eyeLookDist(){return z(L(u(this,je)[je].look,u(this,je)[je].eye,oe))}get viewMatrix(){return this.dirty&&this.cleanIfDirty(),u(this,je)[je].viewMatrix}get inverseViewMatrix(){return this.dirty&&this.cleanIfDirty(),u(this,je)[je].inverseViewMatrix}get projMatrix(){return u(this,fe)[fe].projMatrix}get frustum(){return this.dirty&&this.cleanIfDirty(),u(this,ge)[ge]}get projectionType(){return u(this,je)[je].projectionType}set projectionType(t){t=t||x,u(this,je)[je].projectionType!==t&&(t===x?u(this,fe)[fe]=this.perspectiveProjection:t===M?u(this,fe)[fe]=this.orthoProjection:t===k?u(this,fe)[fe]=this.frustumProjection:t===I?u(this,fe)[fe]=this.customProjection:(this.error("Unsupported value for 'projection': "+t+" defaulting to PerspectiveProjectionType"),u(this,fe)[fe]=this.perspectiveProjection,t=x),u(this,fe)[fe].clean(),u(this,je)[je].projectionType=t,this.clean(),this.onProjectionType.dispatch(this,u(this,je)[je].projectionType),this.onProjMatrix.dispatch(this,u(this,fe)[fe].projMatrix))}clean(){const t=u(this,je)[je];let e;this.projectionType===M?(L(u(this,je)[je].eye,u(this,je)[je].look,be),F(be,pe),C(pe,1e3,we),V(u(this,je)[je].look,we,ye),e=ye):e=u(this,je)[je].eye,t.hasDeviceMatrix?(q(e,u(this,je)[je].look,u(this,je)[je].up,ve),N(t.deviceMatrix,ve,t.viewMatrix)):q(e,u(this,je)[je].look,u(this,je)[je].up,t.viewMatrix),$(u(this,je)[je].viewMatrix,u(this,je)[je].inverseViewMatrix),X(u(this,je)[je].inverseViewMatrix,u(this,je)[je].viewNormalMatrix),this.view.redraw(),function(t,e,i){var s=N(e,t,te),r=s[0],h=s[1],o=s[2],n=s[3],a=s[4],l=s[5],d=s[6],c=s[7],u=s[8],v=s[9],b=s[10],p=s[11],w=s[12],y=s[13],j=s[14],g=s[15];(i=i||new he).planes[0].set(n-r,c-a,p-u,g-w),i.planes[1].set(n+r,c+a,p+u,g+w),i.planes[2].set(n-h,c-l,p-v,g-y),i.planes[3].set(n+h,c+l,p+v,g+y),i.planes[4].set(n-o,c-d,p-b,g-j),i.planes[5].set(n+o,c+d,p+b,g+j)}(u(this,je)[je].viewMatrix,u(this,fe)[fe].projMatrix,u(this,ge)[ge]),this.onViewMatrix.dispatch(this,u(this,je)[je].viewMatrix),this.onFrustum.dispatch(this,u(this,ge)[ge])}orbitYaw(t){let e=L(u(this,je)[je].eye,u(this,je)[je].look,oe);H(.0174532925*t,u(this,je)[je].gimbalLock?u(this,je)[je].worldUp:u(this,je)[je].up,ue),e=G(ue,e,ne),this.eye=V(u(this,je)[je].look,e,ae),this.up=G(ue,u(this,je)[je].up,le)}orbitPitch(t){if(u(this,je)[je].constrainPitch&&(t=A(u(this,je)[je].up,u(this,je)[je].worldUp)/a)<1)return;let e=L(u(this,je)[je].eye,u(this,je)[je].look,oe);H(.0174532925*t,U(F(e,ne),F(u(this,je)[je].up,ae)),ue),e=G(ue,e,le),this.up=G(ue,u(this,je)[je].up,de),this.eye=V(e,u(this,je)[je].look,ce)}yaw(t){let e=L(u(this,je)[je].look,u(this,je)[je].eye,oe);H(.0174532925*t,u(this,je)[je].gimbalLock?u(this,je)[je].worldUp:u(this,je)[je].up,ue),e=G(ue,e,ne),this.look=V(e,u(this,je)[je].eye,ae),u(this,je)[je].gimbalLock&&(this.up=G(ue,u(this,je)[je].up,le))}pitch(t){if(u(this,je)[je].constrainPitch&&(t=A(u(this,je)[je].up,u(this,je)[je].worldUp)/a)<1)return;let e=L(u(this,je)[je].look,u(this,je)[je].eye,oe);H(.0174532925*t,U(F(e,ne),F(u(this,je)[je].up,ae)),ue),this.up=G(ue,u(this,je)[je].up,ce),e=G(ue,e,le),this.look=V(e,u(this,je)[je].eye,de)}pan(t){const e=L(u(this,je)[je].eye,u(this,je)[je].look,oe),i=[0,0,0];let s;0!==t[0]&&(s=C(U(F(e,[]),F(u(this,je)[je].up,ne)),t[0]),i[0]+=s[0],i[1]+=s[1],i[2]+=s[2]),0!==t[1]&&(s=C(F(u(this,je)[je].up,ae),t[1]),i[0]+=s[0],i[1]+=s[1],i[2]+=s[2]),0!==t[2]&&(s=C(F(e,le),t[2]),i[0]+=s[0],i[1]+=s[1],i[2]+=s[2]),this.eye=V(u(this,je)[je].eye,i,de),this.look=V(u(this,je)[je].look,i,ce)}zoom(t){const e=L(u(this,je)[je].eye,u(this,je)[je].look,oe),i=Math.abs(z(e)),s=Math.abs(i+t);if(s<.5)return;const r=F(e,ae);this.eye=V(u(this,je)[je].look,C(r,s),le)}destroy(){super.destroy(),this.onProjectionType.clear(),this.onViewMatrix.clear(),this.onProjMatrix.clear(),this.onWorldAxis.clear()}}const Pe={viewerId:"",time:0,startTime:0,prevTime:0,deltaTime:0};var me=/*#__PURE__*/c("viewersRenderInfo"),xe=/*#__PURE__*/c("viewerIDMap"),Me=/*#__PURE__*/c("taskQueue"),ke=/*#__PURE__*/c("taskBudget"),Ie=/*#__PURE__*/c("lastTime"),Ae=/*#__PURE__*/c("elapsedTime"),Se=/*#__PURE__*/c("runTasks"),De=/*#__PURE__*/c("runTasksUntil"),Ce=/*#__PURE__*/c("fireTickEvents"),Ve=/*#__PURE__*/c("renderViewers");function Le(t){u(this,De)[De](t+u(this,ke)[ke]),this.getNumTasks(),u(this,ke)}function Ue(t=-1){let e=(new Date).getTime(),i=0;for(;u(this,Me)[Me].length>0&&(t<0||e<t);){const t=u(this,Me)[Me].shift(),s=u(this,Me)[Me].shift();s?t.call(s):t(),e=(new Date).getTime(),i++}return i}function ze(t){Pe.time=t;for(let t in Fe.viewers)if(this.viewers.hasOwnProperty(t)){const e=this.viewers[t];Pe.viewerId=t,Pe.startTime=e.startTime,Pe.deltaTime=null!=Pe.prevTime?Pe.time-Pe.prevTime:0,e.onTick.dispatch(e,Pe)}Pe.prevTime=t}function Te(){for(let t in this.viewers)if(this.viewers.hasOwnProperty(t)){const e=this.viewers[t];let i=u(this,me)[me][t];i||(i=u(this,me)[me][t]={}),e.render({})}}const Fe=new class{constructor(){Object.defineProperty(this,Ve,{value:Te}),Object.defineProperty(this,Ce,{value:ze}),Object.defineProperty(this,De,{value:Ue}),Object.defineProperty(this,Se,{value:Le}),this.viewers=void 0,Object.defineProperty(this,me,{writable:!0,value:{}}),Object.defineProperty(this,xe,{writable:!0,value:new j}),Object.defineProperty(this,Me,{writable:!0,value:new g}),Object.defineProperty(this,ke,{writable:!0,value:10}),Object.defineProperty(this,Ie,{writable:!0,value:0}),Object.defineProperty(this,Ae,{writable:!0,value:0}),this.viewers={};const t=()=>{const e=Date.now();u(this,Ie)[Ie]>0&&(u(this,Ae)[Ae]=e-u(this,Ie)[Ie]),u(this,Se)[Se](e),u(this,Ce)[Ce](e),u(this,Ve)[Ve](),u(this,Ie)[Ie]=e,requestAnimationFrame(t)};requestAnimationFrame(t)}registerViewer(t){if(t.id){if(this.viewers[t.id])return void console.error(`[ERROR] Viewer ${f(t.id)} already exists`)}else t.id=u(this,xe)[xe].addItem({});this.viewers[t.id]=t,u(this,me)[me][t.id]={}}deregisterViewer(t){this.viewers[t.id]&&(u(this,xe)[xe].removeItem(t.id),delete this.viewers[t.id],delete u(this,me)[me][t.id])}scheduleTask(t,e){u(this,Me)[Me].push(t),u(this,Me)[Me].push(e)}getNumTasks(){return u(this,Me)[Me].length}},Re=S(),_e=S(),We=S(),Ee=S(),He=S();var qe=/*#__PURE__*/c("duration"),$e=/*#__PURE__*/c("look1"),Xe=/*#__PURE__*/c("eye1"),Be=/*#__PURE__*/c("up1"),Ne=/*#__PURE__*/c("look2"),Ge=/*#__PURE__*/c("eye2"),Qe=/*#__PURE__*/c("up2"),Ye=/*#__PURE__*/c("orthoScale1"),Je=/*#__PURE__*/c("orthoScale2"),Ke=/*#__PURE__*/c("fit"),Ze=/*#__PURE__*/c("trail"),ti=/*#__PURE__*/c("flying"),ei=/*#__PURE__*/c("flyEyeLookUp"),ii=/*#__PURE__*/c("flyingEye"),si=/*#__PURE__*/c("flyingLook"),ri=/*#__PURE__*/c("callback"),hi=/*#__PURE__*/c("callbackScope"),oi=/*#__PURE__*/c("time1"),ni=/*#__PURE__*/c("time2"),ai=/*#__PURE__*/c("flyingEyeLookUp"),li=/*#__PURE__*/c("fitFOV"),di=/*#__PURE__*/c("projection2"),ci=/*#__PURE__*/c("projMatrix1"),ui=/*#__PURE__*/c("projMatrix2"),vi=/*#__PURE__*/c("jumpTo"),bi=/*#__PURE__*/c("update"),pi=/*#__PURE__*/c("ease"),wi=/*#__PURE__*/c("easeInCubic"),yi=/*#__PURE__*/c("easeOutExpo");class ji extends t{constructor(t,i){super(t,i),Object.defineProperty(this,bi,{value:fi}),Object.defineProperty(this,vi,{value:gi}),this.view=void 0,this.camera=void 0,Object.defineProperty(this,qe,{writable:!0,value:void 0}),Object.defineProperty(this,$e,{writable:!0,value:void 0}),Object.defineProperty(this,Xe,{writable:!0,value:void 0}),Object.defineProperty(this,Be,{writable:!0,value:void 0}),Object.defineProperty(this,Ne,{writable:!0,value:void 0}),Object.defineProperty(this,Ge,{writable:!0,value:void 0}),Object.defineProperty(this,Qe,{writable:!0,value:void 0}),Object.defineProperty(this,Ye,{writable:!0,value:void 0}),Object.defineProperty(this,Je,{writable:!0,value:void 0}),Object.defineProperty(this,Ke,{writable:!0,value:void 0}),Object.defineProperty(this,Ze,{writable:!0,value:void 0}),Object.defineProperty(this,ti,{writable:!0,value:void 0}),Object.defineProperty(this,ei,{writable:!0,value:void 0}),Object.defineProperty(this,ii,{writable:!0,value:void 0}),Object.defineProperty(this,si,{writable:!0,value:void 0}),Object.defineProperty(this,ri,{writable:!0,value:void 0}),Object.defineProperty(this,hi,{writable:!0,value:void 0}),Object.defineProperty(this,oi,{writable:!0,value:void 0}),Object.defineProperty(this,ni,{writable:!0,value:void 0}),this.easing=void 0,Object.defineProperty(this,ai,{writable:!0,value:void 0}),Object.defineProperty(this,li,{writable:!0,value:void 0}),Object.defineProperty(this,di,{writable:!0,value:void 0}),Object.defineProperty(this,ci,{writable:!0,value:void 0}),Object.defineProperty(this,ui,{writable:!0,value:void 0}),this.onStarted=void 0,this.onStopped=void 0,this.onCancelled=void 0,this.view=t,this.camera=t.camera,u(this,$e)[$e]=S(),u(this,Xe)[Xe]=S(),u(this,Be)[Be]=S(),u(this,Ne)[Ne]=S(),u(this,Ge)[Ge]=S(),u(this,Qe)[Qe]=S(),u(this,Ye)[Ye]=1,u(this,Je)[Je]=1,u(this,ti)[ti]=!1,u(this,ei)[ei]=!1,u(this,ii)[ii]=!1,u(this,si)[si]=!1,u(this,ri)[ri]=null,u(this,hi)[hi]=null,u(this,oi)[oi]=null,u(this,ni)[ni]=null,this.easing=!0,u(this,Ze)[Ze]=!1,u(this,Ke)[Ke]=!0,u(this,qe)[qe]=500,this.onStarted=new e(new s),this.onStopped=new e(new s),this.onCancelled=new e(new s)}flyTo(t={},e){u(this,ti)[ti]&&this.stop(),u(this,ti)[ti]=!1,u(this,ii)[ii]=!1,u(this,si)[si]=!1,u(this,ai)[ai]=!1,u(this,ri)[ri]=e;const i=this.camera,s=!!t.projection&&t.projection!==i.projectionType;let r,h,o,n;u(this,Xe)[Xe][0]=i.eye[0],u(this,Xe)[Xe][1]=i.eye[1],u(this,Xe)[Xe][2]=i.eye[2],u(this,$e)[$e][0]=i.look[0],u(this,$e)[$e][1]=i.look[1],u(this,$e)[$e][2]=i.look[2],u(this,Be)[Be][0]=i.up[0],u(this,Be)[Be][1]=i.up[1],u(this,Be)[Be][2]=i.up[2],u(this,Ye)[Ye]=i.orthoProjection.scale,u(this,Je)[Je]=t.orthoScale||u(this,Ye)[Ye],t.aabb?r=t.aabb:t.eye&&t.look||t.up?(h=t.eye,o=t.look,n=t.up):t.eye?h=t.eye:t.look?o=t.look:s||(r=this.view.aabb);const l=t.poi;if(r){if(r[3]<r[0]||r[4]<r[1]||r[5]<r[2])return;if(r[3]===r[0]&&r[4]===r[1]&&r[5]===r[2])return;r=r.slice();const e=se(r);u(this,Ne)[Ne]=l||e;const i=F(L(u(this,Xe)[Xe],u(this,$e)[$e],Re)),s=l?ie(r,l):ee(r),h=t.fitFOV||u(this,li)[li],o=Math.abs(s/Math.tan(h*a));u(this,Je)[Je]=1.1*s,u(this,Ge)[Ge][0]=u(this,Ne)[Ne][0]+i[0]*o,u(this,Ge)[Ge][1]=u(this,Ne)[Ne][1]+i[1]*o,u(this,Ge)[Ge][2]=u(this,Ne)[Ne][2]+i[2]*o,u(this,Qe)[Qe][0]=u(this,Be)[Be][0],u(this,Qe)[Qe][1]=u(this,Be)[Be][1],u(this,Qe)[Qe][2]=u(this,Be)[Be][2],u(this,ai)[ai]=!0}else(h||o||n)&&(u(this,ai)[ai]=!!h&&!!o&&!!n,u(this,ii)[ii]=!!h&&!o,u(this,si)[si]=!!o&&!h,h&&(u(this,Ge)[Ge][0]=h[0],u(this,Ge)[Ge][1]=h[1],u(this,Ge)[Ge][2]=h[2]),o&&(u(this,Ne)[Ne][0]=o[0],u(this,Ne)[Ne][1]=o[1],u(this,Ne)[Ne][2]=o[2]),n&&(u(this,Qe)[Qe][0]=n[0],u(this,Qe)[Qe][1]=n[1],u(this,Qe)[Qe][2]=n[2]));s?(t.projection===M&&i.projectionType!==M&&(u(this,di)[di]=M,u(this,ci)[ci]=i.projMatrix.slice(),u(this,ui)[ui]=i.orthoProjection.projMatrix.slice(),i.projectionType=I),t.projection===x&&i.projectionType!==x&&(u(this,di)[di]=x,u(this,ci)[ci]=i.projMatrix.slice(),u(this,ui)[ui]=i.perspectiveProjection.projMatrix.slice(),i.projectionType=I)):u(this,di)[di]=null,this.onStarted.dispatch(this,null),u(this,oi)[oi]=Date.now(),u(this,ni)[ni]=u(this,oi)[oi]+(t.duration?1e3*t.duration:u(this,qe)[qe]),u(this,ti)[ti]=!0,Fe.scheduleTask(u(this,bi)[bi],this)}jumpTo(t){u(this,vi)[vi](t)}stop(){if(!u(this,ti)[ti])return;u(this,ti)[ti]=!1,u(this,oi)[oi]=null,u(this,ni)[ni]=null,u(this,di)[di]&&(this.camera.projectionType=u(this,di)[di]);const t=u(this,ri)[ri];t&&(u(this,ri)[ri]=null,t()),this.onStopped.dispatch(this,null)}cancel(){u(this,ti)[ti]&&(u(this,ti)[ti]=!1,u(this,oi)[oi]=null,u(this,ni)[ni]=null,u(this,ri)[ri]&&(u(this,ri)[ri]=null),this.onCancelled.dispatch(this,null))}set duration(t){u(this,qe)[qe]=t?1e3*t:500,this.stop()}get duration(){return u(this,qe)[qe]/1e3}set fit(t){u(this,Ke)[Ke]=t}get fit(){return u(this,Ke)[Ke]}set fitFOV(t){u(this,li)[li]=t}get fitFOV(){return u(this,li)[li]}set trail(t){u(this,Ze)[Ze]=t}get trail(){return u(this,Ze)[Ze]}destroy(){this.stop(),super.destroy(),this.onStarted.clear(),this.onStopped.clear(),this.onCancelled.clear()}}function gi(t){u(this,ti)[ti]&&this.stop();const e=this.camera;let i,s,r,h;t.aabb?i=t.aabb:t.eye||t.look||t.up?(s=t.eye,r=t.look,h=t.up):i=this.view.aabb;const o=t.poi;if(i){if(i[3]<=i[0]||i[4]<=i[1]||i[5]<=i[2])return;const s=o?ie(i,o):ee(i);let h;r=o||se(i,r),u(this,Ze)[Ze]?L(e.look,r,He):L(e.eye,e.look,He),F(He),h=(void 0!==t.fit?t.fit:u(this,Ke)[Ke])?Math.abs(s/Math.tan((t.fitFOV||u(this,li)[li])*a)):z(L(e.eye,e.look,Re)),C(He,h),e.eye=V(r,He,Re),e.look=r,this.camera.orthoProjection.scale=1.1*s}else(s||r||h)&&(s&&(e.eye=s),r&&(e.look=r),h&&(e.up=h));t.projection&&(e.projectionType=t.projection)}function fi(){if(!u(this,ti)[ti])return;let t=(Date.now()-u(this,oi)[oi])/(u(this,ni)[ni]-u(this,oi)[oi]);const e=t>=1;t>1&&(t=1);const i=this.easing?u(ji,pi)[pi](t,0,1,1):t,s=this.camera;if(u(this,ii)[ii]||u(this,si)[si]?u(this,ii)[ii]?(L(s.eye,s.look,He),s.eye=T(i,0,1,u(this,Xe)[Xe],u(this,Ge)[Ge],We),s.look=L(We,He,_e)):u(this,si)[si]&&(s.look=T(i,0,1,u(this,$e)[$e],u(this,Ne)[Ne],_e),s.up=T(i,0,1,u(this,Be)[Be],u(this,Qe)[Qe],Ee)):u(this,ai)[ai]&&(s.eye=T(i,0,1,u(this,Xe)[Xe],u(this,Ge)[Ge],We),s.look=T(i,0,1,u(this,$e)[$e],u(this,Ne)[Ne],_e),s.up=T(i,0,1,u(this,Be)[Be],u(this,Qe)[Qe],Ee)),u(this,di)[di]){const e=u(this,di)[di]===M?u(ji,yi)[yi](t,0,1,1):u(ji,wi)[wi](t,0,1,1);s.customProjection.projMatrix=function(t,e,i,s,r,h){var o=R(),n=(t-0)/1;return o[0]=s[0]+n*(r[0]-s[0]),o[1]=s[1]+n*(r[1]-s[1]),o[2]=s[2]+n*(r[2]-s[2]),o[3]=s[3]+n*(r[3]-s[3]),o[4]=s[4]+n*(r[4]-s[4]),o[5]=s[5]+n*(r[5]-s[5]),o[6]=s[6]+n*(r[6]-s[6]),o[7]=s[7]+n*(r[7]-s[7]),o[8]=s[8]+n*(r[8]-s[8]),o[9]=s[9]+n*(r[9]-s[9]),o[10]=s[10]+n*(r[10]-s[10]),o[11]=s[11]+n*(r[11]-s[11]),o[12]=s[12]+n*(r[12]-s[12]),o[13]=s[13]+n*(r[13]-s[13]),o[14]=s[14]+n*(r[14]-s[14]),o[15]=s[15]+n*(r[15]-s[15]),o}(e,0,0,u(this,ci)[ci],u(this,ui)[ui])}else s.orthoProjection.scale=u(this,Ye)[Ye]+t*(u(this,Je)[Je]-u(this,Ye)[Ye]);if(e)return s.orthoProjection.scale=u(this,Je)[Je],void this.stop();Fe.scheduleTask(u(this,bi)[bi],this)}Object.defineProperty(ji,yi,{value:function(t,e,i,s){return i*(1-Math.pow(2,-10*t/s))+e}}),Object.defineProperty(ji,wi,{value:function(t,e,i,s){return i*(t/=s)*t*t+e}}),Object.defineProperty(ji,pi,{value:function(t,e,i,s){return-i*(t/=s)*(t-2)+e}});var Oi=/*#__PURE__*/c("onTick"),Pi=/*#__PURE__*/c("backgroundColor"),mi=/*#__PURE__*/c("backgroundColorFromAmbientLight"),xi=/*#__PURE__*/c("resolutionScale"),Mi=/*#__PURE__*/c("numObjects"),ki=/*#__PURE__*/c("objectIds"),Ii=/*#__PURE__*/c("numVisibleObjects"),Ai=/*#__PURE__*/c("visibleObjectIds"),Si=/*#__PURE__*/c("numXRayedObjects"),Di=/*#__PURE__*/c("xrayedObjectIds"),Ci=/*#__PURE__*/c("numHighlightedObjects"),Vi=/*#__PURE__*/c("highlightedObjectIds"),Li=/*#__PURE__*/c("numSelectedObjects"),Ui=/*#__PURE__*/c("selectedObjectIds"),zi=/*#__PURE__*/c("numColorizedObjects"),Ti=/*#__PURE__*/c("colorizedObjectIds"),Fi=/*#__PURE__*/c("numOpacityObjects"),Ri=/*#__PURE__*/c("opacityObjectIds"),_i=/*#__PURE__*/c("qualityRender"),Wi=/*#__PURE__*/c("lightsHash"),Ei=/*#__PURE__*/c("sectionPlanesHash"),Hi=/*#__PURE__*/c("registerSectionPlane"),qi=/*#__PURE__*/c("deregisterSectionPlane"),$i=/*#__PURE__*/c("initObjects"),Xi=/*#__PURE__*/c("createObjects"),Bi=/*#__PURE__*/c("destroyObjects");class Ni extends t{constructor(t){if(super(null,t),Object.defineProperty(this,Bi,{value:Ki}),Object.defineProperty(this,Xi,{value:Ji}),Object.defineProperty(this,$i,{value:Yi}),Object.defineProperty(this,qi,{value:Qi}),Object.defineProperty(this,Hi,{value:Gi}),this.viewIndex=void 0,this.camera=void 0,this.canvasElement=void 0,this.transparent=void 0,this.boundary=void 0,this.logarithmicDepthBufferEnabled=void 0,this.sao=void 0,this.cameraFlight=void 0,this.metrics=void 0,this.xrayMaterial=void 0,this.highlightMaterial=void 0,this.selectedMaterial=void 0,this.edgeMaterial=void 0,this.pointsMaterial=void 0,this.linesMaterial=void 0,this.objects=void 0,this.visibleObjects=void 0,this.xrayedObjects=void 0,this.highlightedObjects=void 0,this.selectedObjects=void 0,this.colorizedObjects=void 0,this.opacityObjects=void 0,this.sectionPlanes=void 0,this.sectionPlanesList=[],this.lights=void 0,this.lightsList=[],this.gammaOutput=void 0,this.layers=void 0,this.autoLayers=void 0,this.onBoundary=void 0,this.onObjectVisibility=void 0,this.onObjectXRayed=void 0,this.onLayerCreated=void 0,this.onLayerDestroyed=void 0,this.onSectionPlaneCreated=void 0,this.onSectionPlaneDestroyed=void 0,Object.defineProperty(this,Oi,{writable:!0,value:void 0}),Object.defineProperty(this,Pi,{writable:!0,value:void 0}),Object.defineProperty(this,mi,{writable:!0,value:void 0}),Object.defineProperty(this,xi,{writable:!0,value:void 0}),Object.defineProperty(this,Mi,{writable:!0,value:void 0}),Object.defineProperty(this,ki,{writable:!0,value:void 0}),Object.defineProperty(this,Ii,{writable:!0,value:void 0}),Object.defineProperty(this,Ai,{writable:!0,value:void 0}),Object.defineProperty(this,Si,{writable:!0,value:void 0}),Object.defineProperty(this,Di,{writable:!0,value:void 0}),Object.defineProperty(this,Ci,{writable:!0,value:void 0}),Object.defineProperty(this,Vi,{writable:!0,value:void 0}),Object.defineProperty(this,Li,{writable:!0,value:void 0}),Object.defineProperty(this,Ui,{writable:!0,value:void 0}),Object.defineProperty(this,zi,{writable:!0,value:void 0}),Object.defineProperty(this,Ti,{writable:!0,value:void 0}),Object.defineProperty(this,Fi,{writable:!0,value:void 0}),Object.defineProperty(this,Ri,{writable:!0,value:void 0}),Object.defineProperty(this,_i,{writable:!0,value:void 0}),Object.defineProperty(this,Wi,{writable:!0,value:null}),Object.defineProperty(this,Ei,{writable:!0,value:null}),this.viewer=t.viewer,!((t.canvasElement||document.getElementById(t.canvasId))instanceof HTMLCanvasElement))throw"Mandatory View config expected: valid canvasId or canvasElement";this.viewIndex=0,this.objects={},this.visibleObjects={},this.xrayedObjects={},this.highlightedObjects={},this.selectedObjects={},this.colorizedObjects={},this.opacityObjects={},this.sectionPlanes={},this.sectionPlanesList=[],this.lights={},this.lightsList=[],this.layers={},u(this,Mi)[Mi]=0,u(this,ki)[ki]=null,u(this,Ii)[Ii]=0,u(this,Ai)[Ai]=null,u(this,Si)[Si]=0,u(this,Di)[Di]=null,u(this,Ci)[Ci]=0,u(this,Vi)[Vi]=null,u(this,Li)[Li]=0,u(this,Ui)[Ui]=null,u(this,zi)[zi]=0,u(this,Ti)[Ti]=null,u(this,Fi)[Fi]=0,u(this,Ri)[Ri]=null,u(this,_i)[_i]=!!t.qualityRender,this.gammaOutput=!0,u(this,Ei)[Ei]=null,u(this,Wi)[Wi]=null,this.onBoundary=new e(new s),u(this,xi)[xi]=1,u(this,Pi)[Pi]=S([t.backgroundColor?t.backgroundColor[0]:1,t.backgroundColor?t.backgroundColor[1]:1,t.backgroundColor?t.backgroundColor[2]:1]),u(this,mi)[mi]=!!t.backgroundColorFromAmbientLight,this.canvasElement=t.canvasElement,this.transparent=!!t.transparent,this.canvasElement.width=this.canvasElement.clientWidth,this.canvasElement.height=this.canvasElement.clientHeight,this.boundary=[this.canvasElement.offsetLeft,this.canvasElement.offsetTop,this.canvasElement.clientWidth,this.canvasElement.clientHeight];let i=0,r=0,h=0,o=0,n=0,a=0,l=null,d=null;u(this,Oi)[Oi]=this.viewer.onTick.subscribe(()=>{const t=this.canvasElement,e=u(this,xi)[xi]!==d,s=window.innerWidth!==i||window.innerHeight!==r,c=t.clientWidth!==h||t.clientHeight!==o,v=t.offsetLeft!==n||t.offsetTop!==a,b=t.parentElement;if(e||s||c||v||b!==l){if(e||c||v){const i=t.clientWidth,s=t.clientHeight;(e||c)&&(t.width=Math.round(t.clientWidth*u(this,xi)[xi]),t.height=Math.round(t.clientHeight*u(this,xi)[xi]));const r=this.boundary;r[0]=t.offsetLeft,r[1]=t.offsetTop,r[2]=i,r[3]=s,e&&!c||this.onBoundary.dispatch(this,r),h=i,o=s}e&&(d=u(this,xi)[xi]),s&&(i=window.innerWidth,r=window.innerHeight),v&&(n=t.offsetLeft,a=t.offsetTop),l=b}}),this.camera=new Oe(this),this.sao=new ot(this,{}),this.cameraFlight=new ji(this,{duration:.5}),this.metrics=new rt(this,{units:t.units,scale:t.scale,origin:t.origin}),this.xrayMaterial=new Vt(this,{fill:!0,fillColor:[.9,.7,.6],fillAlpha:.4,edges:!0,edgeColor:[.5,.4,.4],edgeAlpha:1,edgeWidth:1}),this.highlightMaterial=new Vt(this,{fill:!0,fillColor:[1,1,0],fillAlpha:.5,edges:!0,edgeColor:[.5,.4,.4],edgeAlpha:1,edgeWidth:1}),this.selectedMaterial=new Vt(this,{fill:!0,fillColor:[0,1,0],fillAlpha:.5,edges:!0,edgeColor:[.4,.5,.4],edgeAlpha:1,edgeWidth:1}),this.edgeMaterial=new Ut(this,{edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1,edges:!0,renderModes:[P]}),this.pointsMaterial=new Tt(this,{pointSize:1,roundPoints:!0,perspectivePoints:!0,minPerspectivePointSize:1,maxPerspectivePointSize:6,filterIntensity:!1,minIntensity:0,maxIntensity:1}),this.linesMaterial=new at(this,{lineWidth:1}),this.lights={},u(this,_i)[_i]=!!t.qualityRender,this.autoLayers=!1!==t.autoLayers,this.logarithmicDepthBufferEnabled=!!t.logarithmicDepthBufferEnabled,this.onObjectVisibility=new e(new s),this.onObjectXRayed=new e(new s),this.onLayerCreated=new e(new s),this.onLayerDestroyed=new e(new s),this.onSectionPlaneCreated=new e(new s),this.onSectionPlaneDestroyed=new e(new s),u(this,$i)[$i]()}get aabb(){return this.viewer.scene.aabb}get backgroundColor(){return u(this,Pi)[Pi]}set backgroundColor(t){t?(u(this,Pi)[Pi][0]=t[0],u(this,Pi)[Pi][1]=t[1],u(this,Pi)[Pi][2]=t[2]):(u(this,Pi)[Pi][0]=1,u(this,Pi)[Pi][1]=1,u(this,Pi)[Pi][2]=1),this.redraw()}get backgroundColorFromAmbientLight(){return u(this,mi)[mi]}set backgroundColorFromAmbientLight(t){u(this,mi)[mi]=!1!==t}get resolutionScale(){return u(this,xi)[xi]}set resolutionScale(t){if((t=t||1)===u(this,xi)[xi])return;u(this,xi)[xi]=t;const e=this.canvasElement;e.width=Math.round(e.clientWidth*u(this,xi)[xi]),e.height=Math.round(e.clientHeight*u(this,xi)[xi]),this.redraw()}get gammaFactor(){return 1}get qualityRender(){return u(this,_i)[_i]}set qualityRender(t){u(this,_i)[_i]!==t&&(u(this,_i)[_i]=t,this.redraw())}get numObjects(){return u(this,Mi)[Mi]}get objectIds(){return u(this,ki)[ki]||(u(this,ki)[ki]=Object.keys(this.objects)),u(this,ki)[ki]}get numVisibleObjects(){return u(this,Ii)[Ii]}get visibleObjectIds(){return u(this,Ai)[Ai]||(u(this,Ai)[Ai]=Object.keys(this.visibleObjects)),u(this,Ai)[Ai]}get numXRayedObjects(){return u(this,Si)[Si]}get xrayedObjectIds(){return u(this,Di)[Di]||(u(this,Di)[Di]=Object.keys(this.xrayedObjects)),u(this,Di)[Di]}get numHighlightedObjects(){return u(this,Ci)[Ci]}get highlightedObjectIds(){return u(this,Vi)[Vi]||(u(this,Vi)[Vi]=Object.keys(this.highlightedObjects)),u(this,Vi)[Vi]}get numSelectedObjects(){return u(this,Li)[Li]}get selectedObjectIds(){return u(this,Ui)[Ui]||(u(this,Ui)[Ui]=Object.keys(this.selectedObjects)),u(this,Ui)[Ui]}get numColorizedObjects(){return u(this,zi)[zi]}get colorizedObjectIds(){return u(this,Ti)[Ti]||(u(this,Ti)[Ti]=Object.keys(this.colorizedObjects)),u(this,Ti)[Ti]}get opacityObjectIds(){return u(this,Ri)[Ri]||(u(this,Ri)[Ri]=Object.keys(this.opacityObjects)),u(this,Ri)[Ri]}get numOpacityObjects(){return u(this,Fi)[Fi]}registerViewObject(t){this.objects[t.id]=t,u(this,Mi)[Mi]++,u(this,ki)[ki]=null}deregisterViewObject(t){delete this.objects[t.id],delete this.visibleObjects[t.id],delete this.xrayedObjects[t.id],delete this.highlightedObjects[t.id],delete this.selectedObjects[t.id],delete this.colorizedObjects[t.id],delete this.opacityObjects[t.id],u(this,Mi)[Mi]--,u(this,ki)[ki]=null}objectVisibilityUpdated(t,e,i=!0){e?(this.visibleObjects[t.id]=t,u(this,Ii)[Ii]++):(delete this.visibleObjects[t.id],u(this,Ii)[Ii]--),u(this,Ai)[Ai]=null,i&&this.onObjectVisibility.dispatch(this,t)}objectXRayedUpdated(t,e,i=!0){e?(this.xrayedObjects[t.id]=t,u(this,Si)[Si]++):(delete this.xrayedObjects[t.id],u(this,Si)[Si]--),u(this,Di)[Di]=null,i&&this.onObjectXRayed.dispatch(this,t)}objectHighlightedUpdated(t,e){e?(this.highlightedObjects[t.id]=t,u(this,Ci)[Ci]++):(delete this.highlightedObjects[t.id],u(this,Ci)[Ci]--),u(this,Vi)[Vi]=null}objectSelectedUpdated(t,e){e?(this.selectedObjects[t.id]=t,u(this,Li)[Li]++):(delete this.selectedObjects[t.id],u(this,Li)[Li]--),u(this,Ui)[Ui]=null}objectColorizeUpdated(t,e){e?(this.colorizedObjects[t.id]=t,u(this,zi)[zi]++):(delete this.colorizedObjects[t.id],u(this,zi)[zi]--),u(this,Ti)[Ti]=null}objectOpacityUpdated(t,e){e?(this.opacityObjects[t.id]=t,u(this,Fi)[Fi]++):(delete this.opacityObjects[t.id],u(this,Fi)[Fi]--),u(this,Ri)[Ri]=null}createSectionPlane(t){let e=t.id||O();this.sectionPlanes[e]&&(this.error(`SectionPlane with ID "${e}" already exists - will randomly-generate ID`),e=O());const i=new Z(this,t);return u(this,Hi)[Hi](i),i.onDestroyed.one(()=>{u(this,qi)[qi](i)}),i}clearSectionPlanes(){const t=Object.keys(this.sectionPlanes);for(let e=0,i=t.length;e<i;e++)this.sectionPlanes[t[e]].destroy();this.sectionPlanesList.length=0,u(this,Ei)[Ei]=null}getSectionPlanesHash(){if(u(this,Ei)[Ei])return u(this,Ei)[Ei];if(0===this.sectionPlanesList.length)return u(this,Ei)[Ei]=";";const t=[];for(let e=0,i=this.sectionPlanesList.length;e<i;e++)t.push("cp");return t.push(";"),u(this,Ei)[Ei]=t.join(""),u(this,Ei)[Ei]}registerLight(t){this.lightsList.push(t),this.lights[t.id]=t,u(this,Wi)[Wi]=null,this.rebuild()}deregisterLight(t){for(let e=0,i=this.lightsList.length;e<i;e++)if(this.lightsList[e].id===t.id)return this.lightsList.splice(e,1),u(this,Wi)[Wi]=null,delete this.lights[t.id],void this.rebuild()}clearLights(){const t=Object.keys(this.lights);for(let e=0,i=t.length;e<i;e++)this.lights[t[e]].destroy()}getLightsHash(){if(u(this,Wi)[Wi])return u(this,Wi)[Wi];if(0===this.lightsList.length)return u(this,Wi)[Wi]=";";const t=[],e=this.lightsList;for(let i=0,s=e.length;i<s;i++){const s=e[i];t.push("/"),t.push(s.type),t.push("world"===s.space?"w":"v"),s.castsShadow&&t.push("sh")}return t.push(";"),u(this,Wi)[Wi]=t.join(""),u(this,Wi)[Wi]}rebuild(){this.viewer.renderer.needsRebuild(this.viewIndex)}redraw(){this.viewer.renderer.setImageDirty(this.viewIndex)}destroy(){this.viewer.onTick.unsubscribe(u(this,Oi)[Oi]),super.destroy(),this.onObjectVisibility.clear(),this.onObjectXRayed.clear(),this.onLayerCreated.clear(),this.onLayerDestroyed.clear(),this.onSectionPlaneCreated.clear(),this.onSectionPlaneDestroyed.clear()}getAmbientColorAndIntensity(){return[0,0,0,1]}setObjectsVisible(t,e){return this.withObjects(t,t=>{const i=t.visible!==e;return t.visible=e,i})}setObjectsCollidable(t,e){return this.withObjects(t,t=>{const i=t.collidable!==e;return t.collidable=e,i})}setObjectsCulled(t,e){return this.withObjects(t,t=>{const i=t.culled!==e;return t.culled=e,i})}setObjectsSelected(t,e){return this.withObjects(t,t=>{const i=t.selected!==e;return t.selected=e,i})}setObjectsHighlighted(t,e){return this.withObjects(t,t=>{const i=t.highlighted!==e;return t.highlighted=e,i})}setObjectsXRayed(t,e){return this.withObjects(t,t=>{const i=t.xrayed!==e;return i&&(t.xrayed=e),i})}setObjectsColorized(t,e){return this.withObjects(t,t=>{t.colorize=e})}setObjectsOpacity(t,e){return this.withObjects(t,t=>{const i=t.opacity!==e;return i&&(t.opacity=e),i})}setObjectsPickable(t,e){return this.withObjects(t,t=>{const i=t.pickable!==e;return i&&(t.pickable=e),i})}setObjectsClippable(t,e){return this.withObjects(t,t=>{const i=t.clippable!==e;return i&&(t.clippable=e),i})}withObjects(t,e){let i=!1;for(let s=0,r=t.length;s<r;s++){let r=this.objects[t[s]];r&&(i=e(r)||i)}return i}createLayer(t){let e=this.layers[t.id];return e||(e=new It({id:t.id,view:this,viewer:this.viewer}),this.layers[t.id]=e,this.onLayerCreated.dispatch(this,e),e.onDestroyed.one(()=>{delete this.layers[e.id],this.onLayerDestroyed.dispatch(this,e)})),e.autoDestroy=!1,e}}function Gi(t){this.sectionPlanesList.push(t),this.sectionPlanes[t.id]=t,u(this,Ei)[Ei]=null,this.rebuild(),this.onSectionPlaneCreated.dispatch(this,t)}function Qi(t){for(let e=0,i=this.sectionPlanesList.length;e<i;e++)if(this.sectionPlanesList[e].id===t.id)return this.sectionPlanesList.splice(e,1),u(this,Ei)[Ei]=null,delete this.sectionPlanes[t.id],this.rebuild(),void this.onSectionPlaneDestroyed.dispatch(this,t)}function Yi(){for(const t in this.viewer.scene.models)u(this,Xi)[Xi](this.viewer.scene.models[t]);this.viewer.scene.onModelCreated.subscribe((t,e)=>{u(this,Xi)[Xi](e)}),this.viewer.scene.onModelDestroyed.subscribe((t,e)=>{u(this,Bi)[Bi](e)})}function Ji(t){const e=t.objects,i=this.viewer.renderer.rendererViewObjects;for(let t in e){const s=e[t],r=i[t],h="default";let o=this.layers[h];if(!o){if(!this.autoLayers)continue;o=new It({id:h,view:this,viewer:this.viewer}),this.layers[h]=o,o.onDestroyed.one(()=>{delete this.layers[o.id],this.onLayerDestroyed.dispatch(this,o)}),this.onLayerCreated.dispatch(this,o)}const n=new J(o,s,r);o.registerViewObject(n),this.registerViewObject(n)}}function Ki(t){const e=t.objects;for(let t in e){let i=this.layers.default;const s=this.objects[e[t].id];this.deregisterViewObject(s),i&&(i.deregisterViewObject(s),i.autoDestroy&&0===i.numObjects&&i.destroy())}}var Zi=/*#__PURE__*/c("prefixMessageWithID"),ts=/*#__PURE__*/c("registerView"),es=/*#__PURE__*/c("deregisterView");class is extends t{constructor(t){super(null,{}),Object.defineProperty(this,es,{value:hs}),Object.defineProperty(this,ts,{value:rs}),Object.defineProperty(this,Zi,{value:ss}),this.capabilities=void 0,this.onTick=void 0,this.onViewCreated=void 0,this.onViewDestroyed=void 0,this.scene=void 0,this.views=void 0,this.viewList=void 0,this.numViews=void 0,this.startTime=(new Date).getTime(),this.renderer=void 0,this.onTick=new e(new s),this.onViewCreated=new e(new s),this.onViewDestroyed=new e(new s),this.id=t.id||O(),this.viewList=[],this.numViews=0,this.views={},this.destroyed=!1,this.capabilities={maxViews:0,astcSupported:!1,etc1Supported:!1,etc2Supported:!1,dxtSupported:!1,bptcSupported:!1,pvrtcSupported:!1},this.scene=t.scene||new r,this.renderer=t.renderer,this.renderer.getCapabilities(this.capabilities),this.renderer.init(this),Fe.registerViewer(this)}createView(t){if(this.viewList.length>=this.capabilities.maxViews)return new i(`Attempted to create too many Views with View.createView() - maximum of ${this.capabilities.maxViews} is allowed`);let e=t.id||O();if(this.views[e])return new i(`View with ID "${e}" already exists`);if(!((t.canvasElement||document.getElementById(t.canvasId))instanceof HTMLCanvasElement))return new i("Mandatory View config expected: valid canvasId or canvasElement");const s=new Ni(function(t,e){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}({viewId:e,viewer:this},t));return u(this,ts)[ts](s),s.viewIndex=this.renderer.registerView(s),s.onDestroyed.one(()=>{u(this,es)[es](s),this.renderer.deregisterView(s.viewIndex),this.onViewDestroyed.dispatch(this,s)}),this.onViewCreated.dispatch(this,s),this.log(`View created: ${s.viewId}`),s}redraw(){for(let t in this.views)this.views[t].redraw()}log(t){t=`[LOG] ${u(this,Zi)[Zi](t)}`,window.console.log(t)}warn(t){t=`[WARN] ${u(this,Zi)[Zi](t)}`,window.console.warn(t)}error(t){t=`[ERROR] ${u(this,Zi)[Zi](t)}`,window.console.error(t)}destroy(){if(!this.destroyed){Fe.deregisterViewer(this);for(let t in this.views)this.views[t].destroy();this.onTick.clear(),this.onViewCreated.clear(),this.onViewDestroyed.clear()}}render(t){for(let t=0;t<this.viewList.length;t++)this.renderer.render(t,{force:!0})}}function ss(t){return` [${this.constructor.name} "${f(this.id)}"]: ${t}`}function rs(t){if(!this.views[t.id]){this.views[t.id]=t;for(let e=0;;e++)if(!this.viewList[e])return this.viewList[e]=t,this.numViews++,void(t.viewIndex=e)}}function hs(t){this.views[t.id]&&(delete this.views[t.id],delete this.viewList[t.viewIndex],this.numViews--)}var os=/*#__PURE__*/c("state"),ns=/*#__PURE__*/c("inverseMatrixDirty"),as=/*#__PURE__*/c("transposedProjMatrixDirty");class ls extends t{constructor(t,i={}){super(t,i),this.camera=void 0,this.onProjMatrix=void 0,Object.defineProperty(this,os,{writable:!0,value:void 0}),Object.defineProperty(this,ns,{writable:!0,value:void 0}),Object.defineProperty(this,as,{writable:!0,value:void 0}),this.camera=t,u(this,os)[os]={projMatrix:R(),inverseProjMatrix:R(),transposedProjMatrix:R(),near:.1,far:1e4,left:null!=i.left?i.left:-1,right:null!=i.right?i.right:1,bottom:null!=i.bottom?i.bottom:-1,top:null!=i.top?i.top:1},this.onProjMatrix=new e(new s),u(this,ns)[ns]=!0,u(this,as)[as]=!0}get left(){return u(this,os)[os].left}set left(t){u(this,os)[os].left=t,this.setDirty()}get right(){return u(this,os)[os].right}set right(t){u(this,os)[os].right=t,this.setDirty()}get top(){return u(this,os)[os].top}set top(t){u(this,os)[os].top=t,this.setDirty()}get bottom(){return u(this,os)[os].bottom}set bottom(t){u(this,os)[os].bottom=t,this.setDirty()}get near(){return u(this,os)[os].near}set near(t){u(this,os)[os].near=t,this.setDirty()}get far(){return u(this,os)[os].far}set far(t){u(this,os)[os].far=t,this.setDirty()}get projMatrix(){return this.dirty&&this.cleanIfDirty(),u(this,os)[os].projMatrix}get inverseProjMatrix(){return this.dirty&&this.cleanIfDirty(),u(this,ns)[ns]&&($(u(this,os)[os].projMatrix,u(this,os)[os].inverseProjMatrix),u(this,ns)[ns]=!1),u(this,os)[os].inverseProjMatrix}get transposedProjMatrix(){return this.dirty&&this.cleanIfDirty(),u(this,as)[as]&&(X(u(this,os)[os].projMatrix,u(this,os)[os].transposedProjMatrix),u(this,as)[as]=!1),u(this,os)[os].transposedProjMatrix}clean(){!function(t,e,i,s,r,h,o){o||(o=R());var n=e-t,a=s-i,l=h-r;o[0]=2*r/n,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*r/a,o[6]=0,o[7]=0,o[8]=(e+t)/n,o[9]=(s+i)/a,o[10]=-(h+r)/l,o[11]=-1,o[12]=0,o[13]=0,o[14]=-h*r*2/l,o[15]=0}(u(this,os)[os].left,u(this,os)[os].right,u(this,os)[os].bottom,u(this,os)[os].top,u(this,os)[os].near,u(this,os)[os].far,u(this,os)[os].projMatrix),u(this,ns)[ns]=!0,u(this,as)[as]=!0,this.camera.view.redraw(),this.onProjMatrix.dispatch(this,u(this,os)[os].projMatrix)}unproject(t,e,i,s,r){const h=this.camera.view.canvasElement,o=h.offsetWidth/2,n=h.offsetHeight/2;return i[0]=(t[0]-o)/o,i[1]=(t[1]-n)/n,i[2]=e,i[3]=1,B(this.inverseProjMatrix,i,s),C(s,1/s[3]),s[3]=1,s[1]*=-1,B(this.camera.inverseViewMatrix,s,r),r}destroy(){super.destroy(),this.onProjMatrix.clear()}}ls.type=k;var ds=/*#__PURE__*/c("state");class cs extends t{constructor(t,e={}){super(t,e),this.view=void 0,Object.defineProperty(this,ds,{writable:!0,value:void 0}),this.view=t,u(this,ds)[ds]={type:"ambient",color:new Float32Array(e.color||[.7,.7,.7]),intensity:null!=e.intensity?e.intensity:1},this.view.registerLight(this)}set color(t){u(this,ds)[ds].color.set(t),this.view.redraw()}get color(){return u(this,ds)[ds].color}set intensity(t){u(this,ds)[ds].intensity=void 0!==t?t:1,this.view.redraw()}get intensity(){return u(this,ds)[ds].intensity}destroy(){super.destroy(),this.view.deregisterLight(this)}}var us=/*#__PURE__*/c("state");class vs extends t{constructor(t,e={}){super(t,e),this.view=void 0,Object.defineProperty(this,us,{writable:!0,value:void 0}),this.view=t,u(this,us)[us]={type:"dir",dir:new Float32Array(e.dir||[1,1,1]),color:new Float32Array(e.color||[.7,.7,.8]),intensity:null!=e.intensity?e.intensity:1,space:e.space||"view"},this.view.registerLight(this)}get dir(){return u(this,us)[us].dir}set dir(t){u(this,us)[us].dir.set(t),this.view.redraw()}get color(){return u(this,us)[us].color}set color(t){u(this,us)[us].color.set(t),this.view.redraw()}get intensity(){return u(this,us)[us].intensity}set intensity(t){u(this,us)[us].intensity=t,this.view.redraw()}destroy(){super.destroy(),this.view.deregisterLight(this),this.view.redraw()}}var bs=/*#__PURE__*/c("state");class ps extends t{constructor(t,e={}){super(t,e),this.view=void 0,Object.defineProperty(this,bs,{writable:!0,value:void 0}),this.view=t,u(this,bs)[bs]={type:"point",pos:new Float64Array(e.pos||[1,1,1]),color:new Float32Array(e.color||[.7,.7,.8]),intensity:1,attenuation:new Float32Array([e.constantAttenuation,e.linearAttenuation,e.quadraticAttenuation]),space:e.space||"view"},this.view.registerLight(this)}get pos(){return u(this,bs)[bs].pos}set pos(t){u(this,bs)[bs].pos.set(t||[1,1,1]),this.view.redraw()}get color(){return u(this,bs)[bs].color}set color(t){u(this,bs)[bs].color.set(t||[.7,.7,.8]),this.view.redraw()}get intensity(){return u(this,bs)[bs].intensity}set intensity(t){t!==u(this,bs)[bs].intensity&&(u(this,bs)[bs].intensity=t,this.view.redraw())}get constantAttenuation(){return u(this,bs)[bs].attenuation[0]}set constantAttenuation(t){u(this,bs)[bs].attenuation[0]=t,this.view.redraw()}get linearAttenuation(){return u(this,bs)[bs].attenuation[1]}set linearAttenuation(t){u(this,bs)[bs].attenuation[1]=t,this.view.redraw()}get quadraticAttenuation(){return u(this,bs)[bs].attenuation[2]}set quadraticAttenuation(t){u(this,bs)[bs].attenuation[2]=t,this.view.redraw()}destroy(){super.destroy(),this.view.deregisterLight(this),this.view.redraw()}}var ws=/*#__PURE__*/c("viewObject"),ys=/*#__PURE__*/c("gotCanvasPos"),js=/*#__PURE__*/c("gotOrigin"),gs=/*#__PURE__*/c("gotDirection"),fs=/*#__PURE__*/c("gotIndices"),Os=/*#__PURE__*/c("gotLocalPos"),Ps=/*#__PURE__*/c("gotWorldPos"),ms=/*#__PURE__*/c("gotViewPos"),xs=/*#__PURE__*/c("gotWorldNormal"),Ms=/*#__PURE__*/c("gotUV"),ks=/*#__PURE__*/c("canvasPos"),Is=/*#__PURE__*/c("origin"),As=/*#__PURE__*/c("direction"),Ss=/*#__PURE__*/c("indices"),Ds=/*#__PURE__*/c("localPos"),Cs=/*#__PURE__*/c("worldPos"),Vs=/*#__PURE__*/c("viewPos"),Ls=/*#__PURE__*/c("worldNormal"),Us=/*#__PURE__*/c("uv");class zs{constructor(){Object.defineProperty(this,ws,{writable:!0,value:void 0}),Object.defineProperty(this,ys,{writable:!0,value:void 0}),Object.defineProperty(this,js,{writable:!0,value:void 0}),Object.defineProperty(this,gs,{writable:!0,value:void 0}),Object.defineProperty(this,fs,{writable:!0,value:void 0}),Object.defineProperty(this,Os,{writable:!0,value:void 0}),Object.defineProperty(this,Ps,{writable:!0,value:void 0}),Object.defineProperty(this,ms,{writable:!0,value:void 0}),Object.defineProperty(this,xs,{writable:!0,value:void 0}),Object.defineProperty(this,Ms,{writable:!0,value:void 0}),Object.defineProperty(this,ks,{writable:!0,value:void 0}),Object.defineProperty(this,Is,{writable:!0,value:void 0}),Object.defineProperty(this,As,{writable:!0,value:void 0}),Object.defineProperty(this,Ss,{writable:!0,value:void 0}),Object.defineProperty(this,Ds,{writable:!0,value:void 0}),Object.defineProperty(this,Cs,{writable:!0,value:void 0}),Object.defineProperty(this,Vs,{writable:!0,value:void 0}),Object.defineProperty(this,Ls,{writable:!0,value:void 0}),Object.defineProperty(this,Us,{writable:!0,value:void 0}),u(this,ws)[ws]=null,u(this,ks)[ks]=new Int16Array([0,0]),u(this,Is)[Is]=new Float64Array([0,0,0]),u(this,As)[As]=new Float64Array([0,0,0]),u(this,Ss)[Ss]=new Int32Array(3),u(this,Ds)[Ds]=new Float64Array([0,0,0]),u(this,Cs)[Cs]=new Float64Array([0,0,0]),u(this,Vs)[Vs]=new Float64Array([0,0,0]),u(this,Ls)[Ls]=new Float64Array([0,0,0]),u(this,Us)[Us]=new Float64Array([0,0]),u(this,js)[js]=!1,u(this,gs)[gs]=!1,u(this,fs)[fs]=!1,u(this,ys)[ys]=!1,u(this,Os)[Os]=!1,u(this,Ps)[Ps]=!1,u(this,ms)[ms]=!1,u(this,xs)[xs]=!1,u(this,Ms)[Ms]=!1,this.reset()}get viewObject(){return u(this,ws)[ws]}set viewObject(t){u(this,ws)[ws]=t}get canvasPos(){return u(this,ys)[ys]?u(this,ks)[ks]:void 0}set canvasPos(t){t?(u(this,ks)[ks][0]=t[0],u(this,ks)[ks][1]=t[1],u(this,ys)[ys]=!0):u(this,ys)[ys]=!1}get origin(){return u(this,js)[js]?u(this,Is)[Is]:null}set origin(t){t?(u(this,Is)[Is][0]=t[0],u(this,Is)[Is][1]=t[1],u(this,Is)[Is][2]=t[2],u(this,js)[js]=!0):u(this,js)[js]=!1}get direction(){return u(this,gs)[gs]?u(this,As)[As]:null}set direction(t){t?(u(this,As)[As][0]=t[0],u(this,As)[As][1]=t[1],u(this,As)[As][2]=t[2],u(this,gs)[gs]=!0):u(this,gs)[gs]=!1}get indices(){return u(this,ws)[ws]&&u(this,fs)[fs]?u(this,Ss)[Ss]:null}set indices(t){t?(u(this,Ss)[Ss][0]=t[0],u(this,Ss)[Ss][1]=t[1],u(this,Ss)[Ss][2]=t[2],u(this,fs)[fs]=!0):u(this,fs)[fs]=!1}get localPos(){return u(this,ws)[ws]&&u(this,Os)[Os]?u(this,Ds)[Ds]:null}set localPos(t){t?(u(this,Ds)[Ds][0]=t[0],u(this,Ds)[Ds][1]=t[1],u(this,Ds)[Ds][2]=t[2],u(this,Os)[Os]=!0):u(this,Os)[Os]=!1}get worldPos(){return u(this,ws)[ws]&&u(this,Ps)[Ps]?u(this,Cs)[Cs]:null}set worldPos(t){t?(u(this,Cs)[Cs][0]=t[0],u(this,Cs)[Cs][1]=t[1],u(this,Cs)[Cs][2]=t[2],u(this,Ps)[Ps]=!0):u(this,Ps)[Ps]=!1}get viewPos(){return u(this,ws)[ws]&&u(this,ms)[ms]?u(this,Vs)[Vs]:null}set viewPos(t){t?(u(this,Vs)[Vs][0]=t[0],u(this,Vs)[Vs][1]=t[1],u(this,Vs)[Vs][2]=t[2],u(this,ms)[ms]=!0):u(this,ms)[ms]=!1}get worldNormal(){return u(this,ws)[ws]&&u(this,xs)[xs]?u(this,Ls)[Ls]:null}set worldNormal(t){t?(u(this,Ls)[Ls][0]=t[0],u(this,Ls)[Ls][1]=t[1],u(this,Ls)[Ls][2]=t[2],u(this,xs)[xs]=!0):u(this,xs)[xs]=!1}get uv(){return u(this,ws)[ws]&&u(this,Ms)[Ms]?u(this,Us)[Us]:null}set uv(t){t?(u(this,Us)[Us][0]=t[0],u(this,Us)[Us][1]=t[1],u(this,Ms)[Ms]=!0):u(this,Ms)[Ms]=!1}reset(){u(this,ws)[ws]=null,u(this,ys)[ys]=!1,u(this,js)[js]=!1,u(this,gs)[gs]=!1,u(this,fs)[fs]=!1,u(this,Os)[Os]=!1,u(this,Ps)[Ps]=!1,u(this,ms)[ms]=!1,u(this,xs)[xs]=!1,u(this,Ms)[Ms]=!1}}export{cs as AmbientLight,Oe as Camera,ji as CameraFlightAnimation,Yt as CustomProjection,vs as DirLight,Ut as EdgeMaterial,Vt as EmphasisMaterial,ls as FrustumProjection,rt as Metrics,Bt as OrthoProjection,Et as PerspectiveProjection,zs as PickResult,ps as PointLight,Tt as PointsMaterial,ot as SAO,Z as SectionPlane,Ni as View,It as ViewLayer,J as ViewObject,is as Viewer};
//# sourceMappingURL=index.modern.mjs.map
