!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@xeokit/core"),require("strongly-typed-events")):"function"==typeof define&&define.amd?define(["exports","@xeokit/core","strongly-typed-events"],e):e((t||self).data={},t.core,t.stronglyTypedEvents)}(this,function(t,e,r){function i(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,o(t,e)}function o(t,e){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},o(t,e)}function a(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var s=0;function d(t){return"__private_"+s+++"_"+t}function n(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var l=function(t,e){this.propertySet=void 0,this.name=void 0,this.value=void 0,this.type=void 0,this.valueType=void 0,this.description=void 0,this.propertySet=t,this.name=e.name,this.type=e.type,this.value=e.value,this.valueType=e.valueType,this.description=e.description},p=function(t,e){if(this.models=void 0,this.id=void 0,this.originalSystemId=void 0,this.name=void 0,this.type=void 0,this.properties=void 0,this.models=[t],this.id=e.id,this.name=e.name,this.type=e.type,this.properties=[],e.properties)for(var r=0,i=e.properties.length;r<i;r++){var o=new l(this,e.properties[r]);this.properties.push(o)}},h=function(t,e,r,i,o,a){this.data=void 0,this.models=void 0,this.id=void 0,this.name=void 0,this.type=void 0,this.propertySets=void 0,this.relating=void 0,this.related=void 0,this.data=t,this.models=[e],this.id=r,this.name=i,this.type=o,this.propertySets=a||[],this.related={},this.relating={}},c=function(t,e,r){this.type=void 0,this.relatingObject=void 0,this.relatedObject=void 0,this.type=t,this.relatingObject=e,this.relatedObject=r},y=/*#__PURE__*/d("destroyed"),u=/*#__PURE__*/d("removeObjectFromModels"),v=/*#__PURE__*/function(t){function o(i,o,s,d){var l;return l=t.call(this,i)||this,Object.defineProperty(a(l),u,{value:b}),l.data=void 0,l.projectId=void 0,l.revisionId=void 0,l.author=void 0,l.createdAt=void 0,l.creatingApplication=void 0,l.schema=void 0,l.propertySets=void 0,l.objects=void 0,l.rootObjects=void 0,l.objectsByType=void 0,l.relationships=void 0,l.typeCounts=void 0,l.onBuilt=void 0,l.built=void 0,Object.defineProperty(a(l),y,{writable:!0,value:void 0}),l.onBuilt=new e.EventEmitter(new r.EventDispatcher),l.data=i,l.id=o,l.projectId=s.projectId||"",l.revisionId=s.revisionId||"",l.author=s.author||"",l.createdAt=s.createdAt||"",l.creatingApplication=s.creatingApplication||"",l.schema=s.schema||"",l.propertySets={},l.objects={},l.objectsByType={},l.relationships=[],l.typeCounts={},l.rootObjects={},l.built=!1,n(a(l),y)[y]=!1,l.fromJSON(s),l}i(o,t);var s=o.prototype;return s.fromJSON=function(t){if(this.destroyed)return new e.SDKError("Failed to add components to DataModel - DataModel already destroyed");if(this.built)throw new e.SDKError("Failed to add components to DataModel - DataModel already built");if(t.propertySets)for(var r=0,i=t.propertySets.length;r<i;r++)this.createPropertySet(t.propertySets[r]);if(t.objects)for(var o=0,a=t.objects.length;o<a;o++)this.createObject(t.objects[o]);if(t.relationships)for(var s=0,d=t.relationships.length;s<d;s++)this.createRelationship(t.relationships[s])},s.createPropertySet=function(t){if(this.destroyed)return new e.SDKError("Failed to create PropertySet - DataModel already destroyed");if(this.built)return new e.SDKError("DataModel already built");if(this.propertySets[t.id])return new e.SDKError("Failed to create PropertySet - PropertySet with same ID already created in this DataModel. It's OK to have duplicates shared between DataModels, but they must be unique within each DataModel.");var r=this.data.propertySets[t.id];return r?(this.propertySets[t.id]=r,r.models.push(this),r):(r=new p(this,t),this.propertySets[t.id]=r,this.data.propertySets[t.id]=r,r)},s.createObject=function(t){if(this.destroyed)return new e.SDKError("Failed to create DataObject - DataModel already destroyed");if(this.built)return new e.SDKError("Failed to create DataObject - DataModel already built");var r=t.id;if(this.objects[r])return new e.SDKError("Failed to create DataObject - DataObject with same ID already created in this DataModel. It's OK to have duplicates shared between DataModels, but they must be unique within each DataModel.");var i=t.type,o=this.data.objects[r];if(o)this.objects[r]=o,this.data.objects[r]=o,this.objectsByType[i]||(this.objectsByType[i]={}),this.objectsByType[i][r]=o,this.typeCounts[i]=void 0===this.typeCounts[i]?1:this.typeCounts[i]+1,o.models.push(this);else{var a=[];if(t.propertySetIds)for(var s=0,d=t.propertySetIds.length;s<d;s++){var n=t.propertySetIds[s],l=this.propertySets[n];if(!l)return new e.SDKError('Failed to create DataObject - PropertySet not found: "'+n+'"');a.push(l)}o=new h(this.data,this,r,t.name,t.type,a),this.objects[r]=o,this.data.objects[r]=o,this.data.objectsByType[i]||(this.data.objectsByType[i]={}),this.data.objectsByType[i][r]=o,this.data.typeCounts[i]=void 0===this.data.typeCounts[i]?1:this.data.typeCounts[i]+1,o.models.push(this),this.data.onObjectCreated.dispatch(this.data,o)}return o},s.createRelationship=function(t){if(this.destroyed)return new e.SDKError("Failed to create Relationship - DataModel already destroyed");if(this.built)return new e.SDKError("Failed to create Relationship - DataModel already built");var r=this.data.objects[t.relatingObjectId];if(!r)return new e.SDKError("Failed to create Relationship - relating DataObject not found: "+t.relatingObjectId);var i=this.data.objects[t.relatedObjectId];if(!i)return new e.SDKError("Failed to create Relationship - related DataObject not found: "+t.relatedObjectId);var o=new c(t.type,r,i);return i.relating[t.type]||(i.relating[t.type]=[]),i.relating[t.type].push(o),r.related[t.type]||(r.related[t.type]=[]),r.related[t.type].push(o),this.relationships.push(o),o},s.build=function(){return this.destroyed?new e.SDKError("Failed to build DataModel - DataModel already destroyed"):this.built?new e.SDKError("Failed to build DataModel - DataModel already built"):(this.built=!0,void this.onBuilt.dispatch(this,null))},s.getJSON=function(){if(this.destroyed)return new e.SDKError("DataModel already destroyed");if(this.built)return new e.SDKError("DataModel already built");var t={id:this.id,propertySets:[],objects:[],relationships:[]};for(var r in this.propertySets){for(var i,o=this.propertySets[r],a={id:r,name:o.name,properties:[],type:o.type,originalSystemId:o.originalSystemId},s=0,d=o.properties.length;s<d;s++){var n=o.properties[s];a.properties.push({name:n.name,value:n.value,type:n.type,valueType:n.valueType,description:n.description})}null==(i=t.propertySets)||i.push(a)}for(var l in this.objects){var p,h=this.objects[l],c={id:l,type:h.type,name:h.name,propertySetIds:[]};if(h.propertySets)for(var y=0,u=h.propertySets.length;y<u;y++){var v;null==(v=c.propertySetIds)||v.push(h.propertySets[y].id)}null==(p=t.objects)||p.push(c)}for(var b=0,f=this.relationships.length;b<f;b++){var j,D=this.relationships[b];null==(j=t.relationships)||j.push({type:D.type,relatingObjectId:D.relatingObject.id,relatedObjectId:D.relatedObject.id})}return t},s.destroy=function(){if(this.destroyed)return new e.SDKError("Failed to destroy DataModel - DataModel already destroyed");for(var r in this.objects){var i=this.objects[r];if(i.models.length>1)n(this,u)[u](i);else{delete this.data.objects[r];var o=i.type;if(0==--this.data.typeCounts[o])for(var a in delete this.data.typeCounts[o],delete this.data.objectsByType[o],this.data.onObjectDestroyed.dispatch(this.data,i),i.relating)for(var s=i.relating[a],d=0,l=s.length;d<l;d++)for(var p=s[d].relatedObject.relating[a],h=0,c=p.length;h<c;h++)p[0].relatingObject===i&&(p[h]=p[h])}}n(this,y)[y]=!0,this.onBuilt.clear(),t.prototype.destroy.call(this)},o}(e.Component);function b(t){for(var e=0,r=t.models.length;e<r;e++)if(t.models[e]===this){t.models=t.models.splice(e,1);break}}var f=/*#__PURE__*/function(t){function o(){var i;return(i=t.call(this,null,{})||this).models=void 0,i.propertySets=void 0,i.objects=void 0,i.rootObjects=void 0,i.objectsByType=void 0,i.typeCounts=void 0,i.onModelCreated=void 0,i.onModelDestroyed=void 0,i.onObjectCreated=void 0,i.onObjectDestroyed=void 0,i.models={},i.propertySets={},i.objects={},i.rootObjects={},i.objectsByType={},i.typeCounts={},i.onModelCreated=new e.EventEmitter(new r.EventDispatcher),i.onModelDestroyed=new e.EventEmitter(new r.EventDispatcher),i.onObjectCreated=new e.EventEmitter(new r.EventDispatcher),i.onObjectDestroyed=new e.EventEmitter(new r.EventDispatcher),i}i(o,t);var a=o.prototype;return a.createModel=function(t,r){var i=this;if(this.destroyed)return new e.SDKError("Data already destroyed");var o=t.id;if(this.models[o])return new e.SDKError("DataModel already created in this Data: "+o);var a=new v(this,o,t,r);return this.models[a.id]=a,a.onDestroyed.one(function(){delete i.models[a.id],i.onModelDestroyed.dispatch(i,a)}),a.onBuilt.one(function(){i.onModelCreated.dispatch(i,a)}),a},a.getObjectIdsByType=function(t){if(this.destroyed)return new e.SDKError("Data already destroyed");var r=this.objectsByType[t];return r?Object.keys(r):[]},a.searchObjects=function(t){if(this.destroyed)return new e.SDKError("Data already destroyed");var r=t.includeObjects&&t.includeObjects.length>0?j(t.includeObjects):null,i=t.excludeObjects&&t.excludeObjects.length>0?j(t.excludeObjects):null,o=t.includeRelating&&t.includeRelating.length>0?j(t.includeRelating):null,a=t.excludeRelating&&t.excludeRelating.length>0?j(t.excludeRelating):null;function s(e,d){if(e){var n=!0;(i&&i[e.type]||r&&!r[e.type])&&(n=!1),0===d&&!1===t.includeStart&&(n=!1),n&&(t.resultObjectIds?t.resultObjectIds.push(e.id):t.resultObjects?t.resultObjects.push(e):t.resultCallback&&t.resultCallback(e));var l=e.related;for(var p in l){var h=l[p];if(h)for(var c=0,y=h.length;c<y;c++){var u=!0;(a&&a[e.type]||o&&!o[e.type])&&(u=!1),u&&s(h[c].relatedObject,d+1)}}}}if(t.startObjectId){var d=this.objects[t.startObjectId];if(!d)return new e.SDKError('Failed to search DataObjects - starting DataObject not found in Data: "'+t.startObjectId+'"');s(d,0)}else if(t.startObject){if(t.startObject.data!=this)return new e.SDKError('Failed to search DataObjects - starting DataObject not in same Data: "'+t.startObjectId+'"');s(t.startObject,1)}else for(var n in this.rootObjects)s(this.rootObjects[n],1)},a.clear=function(){if(this.destroyed)return new e.SDKError("Data already destroyed");for(var t in this.models)this.models[t].destroy()},a.destroy=function(){if(this.destroyed)return new e.SDKError("Data already destroyed");this.clear(),this.onModelCreated.clear(),this.onModelDestroyed.clear(),t.prototype.destroy.call(this)},o}(e.Component);function j(t){for(var e={},r=0,i=t.length;r<i;r++)e[t[r]]=!0;return e}t.Data=f,t.DataModel=v,t.DataObject=h,t.Property=l,t.PropertySet=p,t.Relationship=c});
//# sourceMappingURL=index.umd.js.map
