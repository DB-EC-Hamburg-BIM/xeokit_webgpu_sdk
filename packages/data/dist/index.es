import{SDKError as t,Component as e,EventEmitter as i}from"@xeokit/core";import{EventDispatcher as r}from"strongly-typed-events";function o(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,a(t,e)}function a(t,e){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},a(t,e)}function s(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var d=0;function n(t){return"__private_"+d+++"_"+t}function l(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var p=function(t,e){this.propertySet=void 0,this.name=void 0,this.value=void 0,this.type=void 0,this.valueType=void 0,this.description=void 0,this.propertySet=t,this.name=e.name,this.type=e.type,this.value=e.value,this.valueType=e.valueType,this.description=e.description},h=function(t,e){if(this.models=void 0,this.id=void 0,this.originalSystemId=void 0,this.name=void 0,this.type=void 0,this.properties=void 0,this.models=[t],this.id=e.id,this.name=e.name,this.type=e.type,this.properties=[],e.properties)for(var i=0,r=e.properties.length;i<r;i++){var o=new p(this,e.properties[i]);this.properties.push(o)}},c=function(t,e,i,r,o,a){this.data=void 0,this.models=void 0,this.id=void 0,this.name=void 0,this.type=void 0,this.propertySets=void 0,this.relating=void 0,this.related=void 0,this.data=t,this.models=[e],this.id=i,this.name=r,this.type=o,this.propertySets=a||[],this.related={},this.relating={}},y=function(t,e,i){this.type=void 0,this.relatingObject=void 0,this.relatedObject=void 0,this.type=t,this.relatingObject=e,this.relatedObject=i},u=/*#__PURE__*/n("destroyed"),b=/*#__PURE__*/n("removeObjectFromModels"),v=/*#__PURE__*/function(e){function a(t,o,a,d){var n;return n=e.call(this,t)||this,Object.defineProperty(s(n),b,{value:f}),n.data=void 0,n.projectId=void 0,n.revisionId=void 0,n.author=void 0,n.createdAt=void 0,n.creatingApplication=void 0,n.schema=void 0,n.propertySets=void 0,n.objects=void 0,n.rootObjects=void 0,n.objectsByType=void 0,n.relationships=void 0,n.typeCounts=void 0,n.onBuilt=void 0,n.built=void 0,Object.defineProperty(s(n),u,{writable:!0,value:void 0}),n.onBuilt=new i(new r),n.data=t,n.id=o,n.projectId=a.projectId||"",n.revisionId=a.revisionId||"",n.author=a.author||"",n.createdAt=a.createdAt||"",n.creatingApplication=a.creatingApplication||"",n.schema=a.schema||"",n.propertySets={},n.objects={},n.objectsByType={},n.relationships=[],n.typeCounts={},n.rootObjects={},n.built=!1,l(s(n),u)[u]=!1,n.fromJSON(a),n}o(a,e);var d=a.prototype;return d.fromJSON=function(e){if(this.destroyed)return new t("Failed to add components to DataModel - DataModel already destroyed");if(this.built)throw new t("Failed to add components to DataModel - DataModel already built");if(e.propertySets)for(var i=0,r=e.propertySets.length;i<r;i++)this.createPropertySet(e.propertySets[i]);if(e.objects)for(var o=0,a=e.objects.length;o<a;o++)this.createObject(e.objects[o]);if(e.relationships)for(var s=0,d=e.relationships.length;s<d;s++)this.createRelationship(e.relationships[s])},d.createPropertySet=function(e){if(this.destroyed)return new t("Failed to create PropertySet - DataModel already destroyed");if(this.built)return new t("DataModel already built");if(this.propertySets[e.id])return new t("Failed to create PropertySet - PropertySet with same ID already created in this DataModel. It's OK to have duplicates shared between DataModels, but they must be unique within each DataModel.");var i=this.data.propertySets[e.id];return i?(this.propertySets[e.id]=i,i.models.push(this),i):(i=new h(this,e),this.propertySets[e.id]=i,this.data.propertySets[e.id]=i,i)},d.createObject=function(e){if(this.destroyed)return new t("Failed to create DataObject - DataModel already destroyed");if(this.built)return new t("Failed to create DataObject - DataModel already built");var i=e.id;if(this.objects[i])return new t("Failed to create DataObject - DataObject with same ID already created in this DataModel. It's OK to have duplicates shared between DataModels, but they must be unique within each DataModel.");var r=e.type,o=this.data.objects[i];if(o)this.objects[i]=o,this.data.objects[i]=o,this.objectsByType[r]||(this.objectsByType[r]={}),this.objectsByType[r][i]=o,this.typeCounts[r]=void 0===this.typeCounts[r]?1:this.typeCounts[r]+1,o.models.push(this);else{var a=[];if(e.propertySetIds)for(var s=0,d=e.propertySetIds.length;s<d;s++){var n=e.propertySetIds[s],l=this.propertySets[n];if(!l)return new t('Failed to create DataObject - PropertySet not found: "'+n+'"');a.push(l)}o=new c(this.data,this,i,e.name,e.type,a),this.objects[i]=o,this.data.objects[i]=o,this.data.objectsByType[r]||(this.data.objectsByType[r]={}),this.data.objectsByType[r][i]=o,this.data.typeCounts[r]=void 0===this.data.typeCounts[r]?1:this.data.typeCounts[r]+1,o.models.push(this),this.data.onObjectCreated.dispatch(this.data,o)}return o},d.createRelationship=function(e){if(this.destroyed)return new t("Failed to create Relationship - DataModel already destroyed");if(this.built)return new t("Failed to create Relationship - DataModel already built");var i=this.data.objects[e.relatingObjectId];if(!i)return new t("Failed to create Relationship - relating DataObject not found: "+e.relatingObjectId);var r=this.data.objects[e.relatedObjectId];if(!r)return new t("Failed to create Relationship - related DataObject not found: "+e.relatedObjectId);var o=new y(e.type,i,r);return r.relating[e.type]||(r.relating[e.type]=[]),r.relating[e.type].push(o),i.related[e.type]||(i.related[e.type]=[]),i.related[e.type].push(o),this.relationships.push(o),o},d.build=function(){return this.destroyed?new t("Failed to build DataModel - DataModel already destroyed"):this.built?new t("Failed to build DataModel - DataModel already built"):(this.built=!0,void this.onBuilt.dispatch(this,null))},d.getJSON=function(){if(this.destroyed)return new t("DataModel already destroyed");if(this.built)return new t("DataModel already built");var e={id:this.id,propertySets:[],objects:[],relationships:[]};for(var i in this.propertySets){for(var r,o=this.propertySets[i],a={id:i,name:o.name,properties:[],type:o.type,originalSystemId:o.originalSystemId},s=0,d=o.properties.length;s<d;s++){var n=o.properties[s];a.properties.push({name:n.name,value:n.value,type:n.type,valueType:n.valueType,description:n.description})}null==(r=e.propertySets)||r.push(a)}for(var l in this.objects){var p,h=this.objects[l],c={id:l,type:h.type,name:h.name,propertySetIds:[]};if(h.propertySets)for(var y=0,u=h.propertySets.length;y<u;y++){var b;null==(b=c.propertySetIds)||b.push(h.propertySets[y].id)}null==(p=e.objects)||p.push(c)}for(var v=0,f=this.relationships.length;v<f;v++){var j,O=this.relationships[v];null==(j=e.relationships)||j.push({type:O.type,relatingObjectId:O.relatingObject.id,relatedObjectId:O.relatedObject.id})}return e},d.destroy=function(){if(this.destroyed)return new t("Failed to destroy DataModel - DataModel already destroyed");for(var i in this.objects){var r=this.objects[i];if(r.models.length>1)l(this,b)[b](r);else{delete this.data.objects[i];var o=r.type;if(0==--this.data.typeCounts[o])for(var a in delete this.data.typeCounts[o],delete this.data.objectsByType[o],this.data.onObjectDestroyed.dispatch(this.data,r),r.relating)for(var s=r.relating[a],d=0,n=s.length;d<n;d++)for(var p=s[d].relatedObject.relating[a],h=0,c=p.length;h<c;h++)p[0].relatingObject===r&&(p[h]=p[h])}}l(this,u)[u]=!0,this.onBuilt.clear(),e.prototype.destroy.call(this)},a}(e);function f(t){for(var e=0,i=t.models.length;e<i;e++)if(t.models[e]===this){t.models=t.models.splice(e,1);break}}var j=/*#__PURE__*/function(e){function a(){var t;return(t=e.call(this,null,{})||this).models=void 0,t.propertySets=void 0,t.objects=void 0,t.rootObjects=void 0,t.objectsByType=void 0,t.typeCounts=void 0,t.onModelCreated=void 0,t.onModelDestroyed=void 0,t.onObjectCreated=void 0,t.onObjectDestroyed=void 0,t.models={},t.propertySets={},t.objects={},t.rootObjects={},t.objectsByType={},t.typeCounts={},t.onModelCreated=new i(new r),t.onModelDestroyed=new i(new r),t.onObjectCreated=new i(new r),t.onObjectDestroyed=new i(new r),t}o(a,e);var s=a.prototype;return s.createModel=function(e,i){var r=this;if(this.destroyed)return new t("Data already destroyed");var o=e.id;if(this.models[o])return new t("DataModel already created in this Data: "+o);var a=new v(this,o,e,i);return this.models[a.id]=a,a.onDestroyed.one(function(){delete r.models[a.id],r.onModelDestroyed.dispatch(r,a)}),a.onBuilt.one(function(){r.onModelCreated.dispatch(r,a)}),a},s.getObjectIdsByType=function(e){if(this.destroyed)return new t("Data already destroyed");var i=this.objectsByType[e];return i?Object.keys(i):[]},s.searchObjects=function(e){if(this.destroyed)return new t("Data already destroyed");var i=e.includeObjects&&e.includeObjects.length>0?O(e.includeObjects):null,r=e.excludeObjects&&e.excludeObjects.length>0?O(e.excludeObjects):null,o=e.includeRelating&&e.includeRelating.length>0?O(e.includeRelating):null,a=e.excludeRelating&&e.excludeRelating.length>0?O(e.excludeRelating):null;function s(t,d){if(t){var n=!0;(r&&r[t.type]||i&&!i[t.type])&&(n=!1),0===d&&!1===e.includeStart&&(n=!1),n&&(e.resultObjectIds?e.resultObjectIds.push(t.id):e.resultObjects?e.resultObjects.push(t):e.resultCallback&&e.resultCallback(t));var l=t.related;for(var p in l){var h=l[p];if(h)for(var c=0,y=h.length;c<y;c++){var u=!0;(a&&a[t.type]||o&&!o[t.type])&&(u=!1),u&&s(h[c].relatedObject,d+1)}}}}if(e.startObjectId){var d=this.objects[e.startObjectId];if(!d)return new t('Failed to search DataObjects - starting DataObject not found in Data: "'+e.startObjectId+'"');s(d,0)}else if(e.startObject){if(e.startObject.data!=this)return new t('Failed to search DataObjects - starting DataObject not in same Data: "'+e.startObjectId+'"');s(e.startObject,1)}else for(var n in this.rootObjects)s(this.rootObjects[n],1)},s.clear=function(){if(this.destroyed)return new t("Data already destroyed");for(var e in this.models)this.models[e].destroy()},s.destroy=function(){if(this.destroyed)return new t("Data already destroyed");this.clear(),this.onModelCreated.clear(),this.onModelDestroyed.clear(),e.prototype.destroy.call(this)},a}(e);function O(t){for(var e={},i=0,r=t.length;i<r;i++)e[t[i]]=!0;return e}export{j as Data,v as DataModel,c as DataObject,p as Property,h as PropertySet,y as Relationship};
//# sourceMappingURL=index.es.map
