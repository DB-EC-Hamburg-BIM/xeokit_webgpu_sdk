var t=require("@xeokit/core"),e=require("strongly-typed-events");function r(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,i(t,e)}function i(t,e){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},i(t,e)}function o(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var a=0;function s(t){return"__private_"+a+++"_"+t}function d(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var n=function(t,e){this.propertySet=void 0,this.name=void 0,this.value=void 0,this.type=void 0,this.valueType=void 0,this.description=void 0,this.propertySet=t,this.name=e.name,this.type=e.type,this.value=e.value,this.valueType=e.valueType,this.description=e.description},l=function(t,e){if(this.models=void 0,this.id=void 0,this.originalSystemId=void 0,this.name=void 0,this.type=void 0,this.properties=void 0,this.models=[t],this.id=e.id,this.name=e.name,this.type=e.type,this.properties=[],e.properties)for(var r=0,i=e.properties.length;r<i;r++){var o=new n(this,e.properties[r]);this.properties.push(o)}},p=function(t,e,r,i,o,a){this.data=void 0,this.models=void 0,this.id=void 0,this.name=void 0,this.type=void 0,this.propertySets=void 0,this.relating=void 0,this.related=void 0,this.data=t,this.models=[e],this.id=r,this.name=i,this.type=o,this.propertySets=a||[],this.related={},this.relating={}},h=function(t,e,r){this.type=void 0,this.relatingObject=void 0,this.relatedObject=void 0,this.type=t,this.relatingObject=e,this.relatedObject=r},c=/*#__PURE__*/s("destroyed"),y=/*#__PURE__*/s("removeObjectFromModels"),u=/*#__PURE__*/function(i){function a(r,a,s,n){var l;return l=i.call(this,r)||this,Object.defineProperty(o(l),y,{value:v}),l.data=void 0,l.projectId=void 0,l.revisionId=void 0,l.author=void 0,l.createdAt=void 0,l.creatingApplication=void 0,l.schema=void 0,l.propertySets=void 0,l.objects=void 0,l.rootObjects=void 0,l.objectsByType=void 0,l.relationships=void 0,l.typeCounts=void 0,l.onBuilt=void 0,l.built=void 0,Object.defineProperty(o(l),c,{writable:!0,value:void 0}),l.onBuilt=new t.EventEmitter(new e.EventDispatcher),l.data=r,l.id=a,l.projectId=s.projectId||"",l.revisionId=s.revisionId||"",l.author=s.author||"",l.createdAt=s.createdAt||"",l.creatingApplication=s.creatingApplication||"",l.schema=s.schema||"",l.propertySets={},l.objects={},l.objectsByType={},l.relationships=[],l.typeCounts={},l.rootObjects={},l.built=!1,d(o(l),c)[c]=!1,l.fromJSON(s),l}r(a,i);var s=a.prototype;return s.fromJSON=function(e){if(this.destroyed)return new t.SDKError("Failed to add components to DataModel - DataModel already destroyed");if(this.built)throw new t.SDKError("Failed to add components to DataModel - DataModel already built");if(e.propertySets)for(var r=0,i=e.propertySets.length;r<i;r++)this.createPropertySet(e.propertySets[r]);if(e.objects)for(var o=0,a=e.objects.length;o<a;o++)this.createObject(e.objects[o]);if(e.relationships)for(var s=0,d=e.relationships.length;s<d;s++)this.createRelationship(e.relationships[s])},s.createPropertySet=function(e){if(this.destroyed)return new t.SDKError("Failed to create PropertySet - DataModel already destroyed");if(this.built)return new t.SDKError("DataModel already built");if(this.propertySets[e.id])return new t.SDKError("Failed to create PropertySet - PropertySet with same ID already created in this DataModel. It's OK to have duplicates shared between DataModels, but they must be unique within each DataModel.");var r=this.data.propertySets[e.id];return r?(this.propertySets[e.id]=r,r.models.push(this),r):(r=new l(this,e),this.propertySets[e.id]=r,this.data.propertySets[e.id]=r,r)},s.createObject=function(e){if(this.destroyed)return new t.SDKError("Failed to create DataObject - DataModel already destroyed");if(this.built)return new t.SDKError("Failed to create DataObject - DataModel already built");var r=e.id;if(this.objects[r])return new t.SDKError("Failed to create DataObject - DataObject with same ID already created in this DataModel. It's OK to have duplicates shared between DataModels, but they must be unique within each DataModel.");var i=e.type,o=this.data.objects[r];if(o)this.objects[r]=o,this.data.objects[r]=o,this.objectsByType[i]||(this.objectsByType[i]={}),this.objectsByType[i][r]=o,this.typeCounts[i]=void 0===this.typeCounts[i]?1:this.typeCounts[i]+1,o.models.push(this);else{var a=[];if(e.propertySetIds)for(var s=0,d=e.propertySetIds.length;s<d;s++){var n=e.propertySetIds[s],l=this.propertySets[n];if(!l)return new t.SDKError('Failed to create DataObject - PropertySet not found: "'+n+'"');a.push(l)}o=new p(this.data,this,r,e.name,e.type,a),this.objects[r]=o,this.data.objects[r]=o,this.data.objectsByType[i]||(this.data.objectsByType[i]={}),this.data.objectsByType[i][r]=o,this.data.typeCounts[i]=void 0===this.data.typeCounts[i]?1:this.data.typeCounts[i]+1,o.models.push(this),this.data.onObjectCreated.dispatch(this.data,o)}return o},s.createRelationship=function(e){if(this.destroyed)return new t.SDKError("Failed to create Relationship - DataModel already destroyed");if(this.built)return new t.SDKError("Failed to create Relationship - DataModel already built");var r=this.data.objects[e.relatingObjectId];if(!r)return new t.SDKError("Failed to create Relationship - relating DataObject not found: "+e.relatingObjectId);var i=this.data.objects[e.relatedObjectId];if(!i)return new t.SDKError("Failed to create Relationship - related DataObject not found: "+e.relatedObjectId);var o=new h(e.type,r,i);return i.relating[e.type]||(i.relating[e.type]=[]),i.relating[e.type].push(o),r.related[e.type]||(r.related[e.type]=[]),r.related[e.type].push(o),this.relationships.push(o),o},s.build=function(){return this.destroyed?new t.SDKError("Failed to build DataModel - DataModel already destroyed"):this.built?new t.SDKError("Failed to build DataModel - DataModel already built"):(this.built=!0,void this.onBuilt.dispatch(this,null))},s.getJSON=function(){if(this.destroyed)return new t.SDKError("DataModel already destroyed");if(this.built)return new t.SDKError("DataModel already built");var e={id:this.id,propertySets:[],objects:[],relationships:[]};for(var r in this.propertySets){for(var i,o=this.propertySets[r],a={id:r,name:o.name,properties:[],type:o.type,originalSystemId:o.originalSystemId},s=0,d=o.properties.length;s<d;s++){var n=o.properties[s];a.properties.push({name:n.name,value:n.value,type:n.type,valueType:n.valueType,description:n.description})}null==(i=e.propertySets)||i.push(a)}for(var l in this.objects){var p,h=this.objects[l],c={id:l,type:h.type,name:h.name,propertySetIds:[]};if(h.propertySets)for(var y=0,u=h.propertySets.length;y<u;y++){var v;null==(v=c.propertySetIds)||v.push(h.propertySets[y].id)}null==(p=e.objects)||p.push(c)}for(var b=0,j=this.relationships.length;b<j;b++){var f,D=this.relationships[b];null==(f=e.relationships)||f.push({type:D.type,relatingObjectId:D.relatingObject.id,relatedObjectId:D.relatedObject.id})}return e},s.destroy=function(){if(this.destroyed)return new t.SDKError("Failed to destroy DataModel - DataModel already destroyed");for(var e in this.objects){var r=this.objects[e];if(r.models.length>1)d(this,y)[y](r);else{delete this.data.objects[e];var o=r.type;if(0==--this.data.typeCounts[o])for(var a in delete this.data.typeCounts[o],delete this.data.objectsByType[o],this.data.onObjectDestroyed.dispatch(this.data,r),r.relating)for(var s=r.relating[a],n=0,l=s.length;n<l;n++)for(var p=s[n].relatedObject.relating[a],h=0,u=p.length;h<u;h++)p[0].relatingObject===r&&(p[h]=p[h])}}d(this,c)[c]=!0,this.onBuilt.clear(),i.prototype.destroy.call(this)},a}(t.Component);function v(t){for(var e=0,r=t.models.length;e<r;e++)if(t.models[e]===this){t.models=t.models.splice(e,1);break}}var b=/*#__PURE__*/function(i){function o(){var r;return(r=i.call(this,null,{})||this).models=void 0,r.propertySets=void 0,r.objects=void 0,r.rootObjects=void 0,r.objectsByType=void 0,r.typeCounts=void 0,r.onModelCreated=void 0,r.onModelDestroyed=void 0,r.onObjectCreated=void 0,r.onObjectDestroyed=void 0,r.models={},r.propertySets={},r.objects={},r.rootObjects={},r.objectsByType={},r.typeCounts={},r.onModelCreated=new t.EventEmitter(new e.EventDispatcher),r.onModelDestroyed=new t.EventEmitter(new e.EventDispatcher),r.onObjectCreated=new t.EventEmitter(new e.EventDispatcher),r.onObjectDestroyed=new t.EventEmitter(new e.EventDispatcher),r}r(o,i);var a=o.prototype;return a.createModel=function(e,r){var i=this;if(this.destroyed)return new t.SDKError("Data already destroyed");var o=e.id;if(this.models[o])return new t.SDKError("DataModel already created in this Data: "+o);var a=new u(this,o,e,r);return this.models[a.id]=a,a.onDestroyed.one(function(){delete i.models[a.id],i.onModelDestroyed.dispatch(i,a)}),a.onBuilt.one(function(){i.onModelCreated.dispatch(i,a)}),a},a.getObjectIdsByType=function(e){if(this.destroyed)return new t.SDKError("Data already destroyed");var r=this.objectsByType[e];return r?Object.keys(r):[]},a.searchObjects=function(e){if(this.destroyed)return new t.SDKError("Data already destroyed");var r=e.includeObjects&&e.includeObjects.length>0?j(e.includeObjects):null,i=e.excludeObjects&&e.excludeObjects.length>0?j(e.excludeObjects):null,o=e.includeRelating&&e.includeRelating.length>0?j(e.includeRelating):null,a=e.excludeRelating&&e.excludeRelating.length>0?j(e.excludeRelating):null;function s(t,d){if(t){var n=!0;(i&&i[t.type]||r&&!r[t.type])&&(n=!1),0===d&&!1===e.includeStart&&(n=!1),n&&(e.resultObjectIds?e.resultObjectIds.push(t.id):e.resultObjects?e.resultObjects.push(t):e.resultCallback&&e.resultCallback(t));var l=t.related;for(var p in l){var h=l[p];if(h)for(var c=0,y=h.length;c<y;c++){var u=!0;(a&&a[t.type]||o&&!o[t.type])&&(u=!1),u&&s(h[c].relatedObject,d+1)}}}}if(e.startObjectId){var d=this.objects[e.startObjectId];if(!d)return new t.SDKError('Failed to search DataObjects - starting DataObject not found in Data: "'+e.startObjectId+'"');s(d,0)}else if(e.startObject){if(e.startObject.data!=this)return new t.SDKError('Failed to search DataObjects - starting DataObject not in same Data: "'+e.startObjectId+'"');s(e.startObject,1)}else for(var n in this.rootObjects)s(this.rootObjects[n],1)},a.clear=function(){if(this.destroyed)return new t.SDKError("Data already destroyed");for(var e in this.models)this.models[e].destroy()},a.destroy=function(){if(this.destroyed)return new t.SDKError("Data already destroyed");this.clear(),this.onModelCreated.clear(),this.onModelDestroyed.clear(),i.prototype.destroy.call(this)},o}(t.Component);function j(t){for(var e={},r=0,i=t.length;r<i;r++)e[t[r]]=!0;return e}exports.Data=b,exports.DataModel=u,exports.DataObject=p,exports.Property=n,exports.PropertySet=l,exports.Relationship=h;
//# sourceMappingURL=index.js.map
