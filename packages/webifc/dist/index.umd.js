!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@xeokit/matrix"),require("web-ifc/web-ifc-api-node"),require("@xeokit/ifctypes"),require("@xeokit/rtc"),require("@xeokit/constants")):"function"==typeof define&&define.amd?define(["exports","@xeokit/matrix","web-ifc/web-ifc-api-node","@xeokit/ifctypes","@xeokit/rtc","@xeokit/constants"],t):t((e||self).webifc={},e.matrix,e.WebIFC,e.ifctypes,e.rtc,e.constants)}(this,function(e,t,r,i,a,o){function n(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(r){if("default"!==r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}}),t.default=e,t}var d=/*#__PURE__*/n(r);function l(e,t,r){!function(e,t,r){var a=t.GlobalId.value,o=t.__proto__.constructor.name;e.dataModel.createObject({id:a,name:t.Name&&""!==t.Name.value?t.Name.value:o,type:o}),r&&e.dataModel.createRelationship({type:i.IfcRelAggregates,relatingObjectId:r,relatedObjectId:a})}(e,t,r);var a=t.GlobalId.value;c(e,t.expressID,"RelatingObject","RelatedObjects",d.IFCRELAGGREGATES,a),c(e,t.expressID,"RelatingStructure","RelatedElements",d.IFCRELCONTAINEDINSPATIALSTRUCTURE,a)}function c(e,t,r,i,a,o){for(var n=e.ifcAPI.GetLineIDsWithType(e.modelId,a),d=0;d<n.size();d++){var c=n.get(d),s=e.ifcAPI.GetLine(e.modelId,c),f=s[r];if(Array.isArray(f)?f.map(function(e){return e.value}).includes(t):f.value===t){var I=s[i];if(Array.isArray(I))I.forEach(function(t){var r=e.ifcAPI.GetLine(e.modelId,t.value);l(e,r,o)});else{var u=e.ifcAPI.GetLine(e.modelId,I.value);l(e,u,o)}}}}e.loadWebIFC=function(e){if(!e.ifcAPI)throw new Error("Argument missing: ifcAPI");if(e.sceneModel.destroyed)throw new Error("SceneModel already destroyed");if(e.sceneModel.built)throw new Error("SceneModel already built");if(e.dataModel){if(e.dataModel.destroyed)throw new Error("DataModel already destroyed");if(e.dataModel.built)throw new Error("DataModel already built")}return new Promise(function(r,i){var n,c=new Uint8Array(e.data),s=e.ifcAPI.OpenModel(c),f=e.ifcAPI.GetLineIDsWithType(s,d.IFCPROJECT),I=f.get(0);(n={data:e.data,modelId:s,lines:f,ifcProjectId:I,ifcAPI:e.ifcAPI,sceneModel:e.sceneModel,dataModel:e.dataModel,nextId:0}).dataModel&&function(e){var t=e.ifcAPI.GetLineIDsWithType(e.modelId,d.IFCPROJECT).get(0),r=e.ifcAPI.GetLine(e.modelId,t);(function(e){for(var t=e.ifcAPI.GetLineIDsWithType(e.modelId,d.IFCRELDEFINESBYPROPERTIES),r=0;r<t.size();r++){var i=t.get(r),a=e.ifcAPI.GetLine(e.modelId,i,!0);if(a){var o=a.RelatingPropertyDefinition;if(!o)continue;var n=o.GlobalId.value,l=o.HasProperties;if(l&&l.length>0){for(var c=o.Name.value,s=[],f=0,I=l.length;f<I;f++){var u=l[f],p=u.Name,y=u.NominalValue;p&&y&&s.push({name:p.value,type:y.type,value:y.value,valueType:y.valueType,description:u.Description?u.Description.value:y.description?y.description:""})}e.dataModel.createPropertySet({id:n,type:"Default",name:c,properties:s});var v=a.RelatedObjects;if(!v||0===v.length)return;for(var m=0,A=v.length;m<A;m++){var P=e.dataObjects[v[m].GlobalId.value];P&&(P.propertySetIds||(P.propertySetIds=[]),P.propertySetIds.push(n))}}}}})(e),l(e,r)}(n),n.sceneModel&&function(e){e.ifcAPI.StreamAllMeshes(e.modelId,function(r){for(var i=r.geometries,n=[],d=e.ifcAPI.GetLine(e.modelId,r.expressID).GlobalId.value,l=t.createMat4(),c=t.createVec3(),s=0,f=i.size();s<f;s++){for(var I=i.get(s),u=e.ifcAPI.GetGeometry(e.modelId,I.geometryExpressID),p=e.ifcAPI.GetVertexArray(u.GetVertexData(),u.GetVertexDataSize()),y=e.ifcAPI.GetIndexArray(u.GetIndexData(),u.GetIndexDataSize()),v=new Float64Array(p.length/2),m=0,A=0,P=p.length/6;m<P;m++,A+=3)v[A+0]=p[6*m+0],v[A+1]=p[6*m+1],v[A+2]=p[6*m+2];l.set(I.flatTransformation),t.transformPositions3(l,v),a.worldToRTCPositions(v,v,c);var b=""+e.nextId++;e.sceneModel.createGeometry({id:b,primitive:o.TrianglesPrimitive,positions:v,indices:y});var g=""+e.nextId++;e.sceneModel.createMesh({id:g,geometryId:b,color:[I.color.x,I.color.y,I.color.z],opacity:I.color.w}),n.push(g)}e.sceneModel.createObject({id:d,meshIds:n})})}(n),r()})}});
//# sourceMappingURL=index.umd.js.map
