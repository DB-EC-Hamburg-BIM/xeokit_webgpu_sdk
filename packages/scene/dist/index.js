var e=require("@xeokit/core"),t=require("@xeokit/math"),r=require("strongly-typed-events"),n=require("@xeokit/matrix"),o=require("@xeokit/compression");function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,"symbol"==typeof(o=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key))?o:String(o),n)}var o}function s(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,c(e,t)}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var l=0;function d(e){return"__private_"+l+++"_"+e}function f(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}function h(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const p=Boolean("object"!=typeof process||"[object process]"!==String(process)||process.browser);function g(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}"undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);const m={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},y=m.global||m.self||m.window||{},v="object"!=typeof process||"[object process]"!==String(process)||process.browser,w="function"==typeof importScripts,b="undefined"!=typeof window&&void 0!==window.orientation;function x(e){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},x(e)}function S(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==x(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==x(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===x(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}"undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);class M{constructor(e,t){S(this,"name",void 0),S(this,"workerThread",void 0),S(this,"isRunning",!0),S(this,"result",void 0),S(this,"_resolve",()=>{}),S(this,"_reject",()=>{}),this.name=e,this.workerThread=t,this.result=new Promise((e,t)=>{this._resolve=e,this._reject=t})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){g(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){g(this.isRunning),this.isRunning=!1,this._reject(e)}}class E{terminate(){}}const T=new Map;function k(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function _(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0;const n=r||new Set;if(e)if(D(e))n.add(e);else if(D(e.buffer))n.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"==typeof e)for(const r in e)_(e[r],t,n);return void 0===r?Array.from(n):[]}function D(e){return!!e&&(e instanceof ArrayBuffer||"undefined"!=typeof MessagePort&&e instanceof MessagePort||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)}function A(e){if(null===e)return{};const t=Object.assign({},e);return Object.keys(t).forEach(r=>{t[r]="object"!=typeof e[r]||ArrayBuffer.isView(e[r])||e[r]instanceof Array?"function"==typeof t[r]||t[r]instanceof RegExp?{}:e[r]:A(e[r])}),t}const B=()=>{};class j{static isSupported(){return"undefined"!=typeof Worker&&v||void 0!==E&&!v}constructor(e){S(this,"name",void 0),S(this,"source",void 0),S(this,"url",void 0),S(this,"terminated",!1),S(this,"worker",void 0),S(this,"onMessage",void 0),S(this,"onError",void 0),S(this,"_loadableURL","");const{name:t,source:r,url:n}=e;g(r||n),this.name=t,this.source=r,this.url=n,this.onMessage=B,this.onError=e=>console.log(e),this.worker=v?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=B,this.onError=B,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||_(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(t+="".concat(e.message," in ")),e.lineno&&(t+=":".concat(e.lineno,":").concat(e.colno)),new Error(t)}_createBrowserWorker(){this._loadableURL=function(e){g(e.source&&!e.url||!e.source&&e.url);let t=T.get(e.source||e.url);return t||(e.url&&(t=(r=e.url).startsWith("http")?k("try {\n  importScripts('".concat(r,"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}")):r,T.set(e.url,t)),e.source&&(t=k(e.source),T.set(e.source,t))),g(t),t;var r}({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},e.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},e.onmessageerror=e=>console.error(e),e}_createNodeWorker(){let e;if(this.url){const t=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new E(t,{eval:!1})}else{if(!this.source)throw new Error("no worker");e=new E(this.source,{eval:!0})}return e.on("message",e=>{this.onMessage(e)}),e.on("error",e=>{this.onError(e)}),e.on("exit",e=>{}),e}}class I{static isSupported(){return j.isSupported()}constructor(e){S(this,"name","unnamed"),S(this,"source",void 0),S(this,"url",void 0),S(this,"maxConcurrency",1),S(this,"maxMobileConcurrency",1),S(this,"onDebug",()=>{}),S(this,"reuseWorkers",!0),S(this,"props",{}),S(this,"jobQueue",[]),S(this,"idleQueue",[]),S(this,"count",0),S(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}async startJob(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e,t,r)=>e.done(r),r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(e,t)=>e.error(t);const n=new Promise(n=>(this.jobQueue.push({name:e,onMessage:t,onError:r,onStart:n}),this));return this._startQueuedJob(),await n}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const r=new M(t.name,e);e.onMessage=e=>t.onMessage(r,e.type,e.payload),e.onError=e=>t.onError(r,e),t.onStart(r);try{await r.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new j({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return b?this.maxMobileConcurrency:this.maxConcurrency}}const P={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class L{static isSupported(){return j.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return L._workerFarm=L._workerFarm||new L({}),L._workerFarm.setProps(e),L._workerFarm}constructor(e){S(this,"props",void 0),S(this,"workerPools",new Map),this.props={...P},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:r,url:n}=e;let o=this.workerPools.get(t);return o||(o=new I({name:t,source:r,url:n}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}S(L,"_workerFarm",void 0);const O="latest",C="3.3.1";function U(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=t[e.id]||{},n="".concat(e.id,"-worker.js");let o=r.workerUrl;if(o||"compression"!==e.id||(o=t.workerUrl),"test"===t._workerType&&(o="modules/".concat(e.module,"/dist/").concat(n)),!o){let t=e.version;"latest"===t&&(t=O);const r=t?"@".concat(t):"";o="https://unpkg.com/@loaders.gl/".concat(e.module).concat(r,"/dist/").concat(n)}return g(o),o}async function F(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const o=function(e){const t=e.version!==C?" (worker-utils@".concat(C,")"):"";return"".concat(e.name,"@").concat(e.version).concat(t)}(e),i=L.getWorkerFarm(r),{source:s}=r,a={name:o,source:s};s||(a.url=U(e,r));const c=i.getWorkerPool(a),u=r.jobName||e.name,l=await c.startJob(u,R.bind(null,n)),d=A(r);return l.postMessage("process",{input:t,options:d}),(await l.result).result}async function R(e,t,r,n){switch(r){case"done":t.done(n);break;case"error":t.error(new Error(n.error));break;case"process":const{id:o,input:i,options:s}=n;try{if(!e.process)return void t.postMessage("error",{id:o,error:"Worker not set up to process on main thread"});const r=await e.process(i,s);t.postMessage("done",{id:o,result:r})}catch(e){const r=e instanceof Error?e.message:"unknown error";t.postMessage("error",{id:o,error:r})}break;default:console.warn("process-on-worker: unknown message ".concat(r))}}var G={__proto__:null,default:{}};const K={};async function W(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t&&(e=function(e,t,r){if(e.startsWith("http"))return e;const n=r.modules||{};return n[e]?n[e]:v?r.CDN?(g(r.CDN.startsWith("http")),"".concat(r.CDN,"/").concat(t,"@").concat("3.3.1","/dist/libs/").concat(e)):w?"../src/libs/".concat(e):"modules/".concat(t,"/src/libs/").concat(e):"modules/".concat(t,"/dist/libs/").concat(e)}(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})),K[e]=K[e]||async function(e){if(e.endsWith("wasm")){const t=await fetch(e);return await t.arrayBuffer()}if(!v)try{return G&&void 0}catch{return null}if(w)return importScripts(e);const t=await fetch(e);return function(e,t){if(!v)return;if(w)return eval.call(y,e),null;const r=document.createElement("script");r.id=t;try{r.appendChild(document.createTextNode(e))}catch(t){r.text=e}return document.body.appendChild(r),null}(await t.text(),e)}(e),await K[e]}async function N(e,t,r,n,o){const i=e.id,s=U(e,r),a=L.getWorkerFarm(r).getWorkerPool({name:i,url:s});r=JSON.parse(JSON.stringify(r)),n=JSON.parse(JSON.stringify(n||{}));const c=await a.startJob("process-on-worker",V.bind(null,o));c.postMessage("process",{input:t,options:r,context:n});const u=await c.result;return await u.result}async function V(e,t,r,n){switch(r){case"done":t.done(n);break;case"error":t.error(new Error(n.error));break;case"process":const{id:o,input:i,options:s}=n;try{const r=await e(i,s);t.postMessage("done",{id:o,result:r})}catch(e){const r=e instanceof Error?e.message:"unknown error";t.postMessage("error",{id:o,error:r})}break;default:console.warn("parse-with-worker unknown message ".concat(r))}}function H(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const n=t.map(e=>e instanceof ArrayBuffer?new Uint8Array(e):e),o=n.reduce((e,t)=>e+t.byteLength,0),i=new Uint8Array(o);let s=0;for(const e of n)i.set(e,s),s+=e.byteLength;return i.buffer}let Q="";const q={};function J(e){for(const t in q)e.startsWith(t)&&(e=e.replace(t,q[t]));return e.startsWith("http://")||e.startsWith("https://")||(e="".concat(Q).concat(e)),e}function z(e){if((t=e)&&"object"==typeof t&&t.isBuffer)return(void 0)(e);var t;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if("string"==typeof e){const t=e;return(new TextEncoder).encode(t).buffer}if(e&&"object"==typeof e&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}const X="3.3.1",Y="https://unpkg.com/@loaders.gl/textures@".concat(X,"/dist/libs/basis_encoder.wasm"),$="https://unpkg.com/@loaders.gl/textures@".concat(X,"/dist/libs/basis_encoder.js");let Z;const ee={name:"Basis Universal Supercompressed GPU Texture",id:"ktx2-basis-writer",module:"textures",version:"3.3.1",extensions:["ktx2"],options:{useSRGB:!1,qualityLevel:10,encodeUASTC:!1,mipmaps:!1},encode:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{useSRGB:r=!1,qualityLevel:n=10,encodeUASTC:o=!1,mipmaps:i=!1}=t,{BasisEncoder:s}=await async function(e){const t=e.modules||{};return t.basisEncoder?t.basisEncoder:(Z=Z||async function(e){let t=null,r=null;return[t,r]=await Promise.all([await W($,"textures",e),await W(Y,"textures",e)]),t=t||globalThis.BASIS,await function(e,t){const r={};return t&&(r.wasmBinary=t),new Promise(t=>{e(r).then(e=>{const{BasisFile:r,KTX2File:n,initializeBasis:o,BasisEncoder:i}=e;o(),t({BasisFile:r,KTX2File:n,BasisEncoder:i})})})}(t,r)}(e),await Z)}(t),a=new s;try{const t=new Uint8Array(e.width*e.height*4);a.setCreateKTX2File(!0),a.setKTX2UASTCSupercompression(!0),a.setKTX2SRGBTransferFunc(!0),a.setSliceSourceImage(0,e.data,e.width,e.height,!1),a.setPerceptual(r),a.setMipSRGB(r),a.setQualityLevel(n),a.setUASTC(o),a.setMipGen(i);const s=a.encode(t);return t.subarray(0,s).buffer}catch(e){throw console.error("Basis Universal Supercompressed GPU Texture encoder Error: ",e),e}finally{a.delete()}}},{_parseImageNode:te}=globalThis,re="undefined"!=typeof Image,ne="undefined"!=typeof ImageBitmap,oe=Boolean(te),ie=!!p||oe,se=/^data:image\/svg\+xml/,ae=/\.svg((\?|#).*)?$/;function ce(e){return e&&(se.test(e)||ae.test(e))}function ue(e,t){if(ce(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function le(e,t,r){const n=function(e,t){if(ce(t)){let t=(new TextDecoder).decode(e);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(t=unescape(encodeURIComponent(t)))}catch(e){throw new Error(e.message)}return"data:image/svg+xml;base64,".concat(btoa(t))}return ue(e,t)}(e,r),o=self.URL||self.webkitURL,i="string"!=typeof n&&o.createObjectURL(n);try{return await async function(e,t){const r=new Image;return r.src=e,t.image&&t.image.decode&&r.decode?(await r.decode(),r):await new Promise((t,n)=>{try{r.onload=()=>t(r),r.onerror=t=>n(new Error("Could not load image ".concat(e,": ").concat(t)))}catch(e){n(e)}})}(i||n,t)}finally{i&&o.revokeObjectURL(i)}}const de={};let fe=!0;const he=!1,pe=!0;function ge(e){const t=me(e);return function(e){const t=me(e);return t.byteLength>=24&&2303741511===t.getUint32(0,he)?{mimeType:"image/png",width:t.getUint32(16,he),height:t.getUint32(20,he)}:null}(t)||function(e){const t=me(e);if(!(t.byteLength>=3&&65496===t.getUint16(0,he)&&255===t.getUint8(2)))return null;const{tableMarkers:r,sofMarkers:n}=function(){const e=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)e.add(t);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}();let o=2;for(;o+9<t.byteLength;){const e=t.getUint16(o,he);if(n.has(e))return{mimeType:"image/jpeg",height:t.getUint16(o+5,he),width:t.getUint16(o+7,he)};if(!r.has(e))return null;o+=2,o+=t.getUint16(o,he)}return null}(t)||function(e){const t=me(e);return t.byteLength>=10&&1195984440===t.getUint32(0,he)?{mimeType:"image/gif",width:t.getUint16(6,pe),height:t.getUint16(8,pe)}:null}(t)||function(e){const t=me(e);return t.byteLength>=14&&16973===t.getUint16(0,he)&&t.getUint32(2,pe)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,pe),height:t.getUint32(22,pe)}:null}(t)}function me(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}const ye={id:"image",module:"images",name:"Images",version:"3.3.1",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg"],parse:async function(e,t,r){const n=((t=t||{}).image||{}).type||"auto",{url:o}=r||{};let i;switch(function(e){switch(e){case"auto":case"data":return function(){if(ne)return"imagebitmap";if(re)return"image";if(ie)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(e){switch(e){case"auto":return ne||re||ie;case"imagebitmap":return ne;case"image":return re;case"data":return ie;default:throw new Error("@loaders.gl/images: image ".concat(e," not supported in this environment"))}}(e),e}}(n)){case"imagebitmap":i=await async function(e,t,r){let n;n=ce(r)?await le(e,t,r):ue(e,r);const o=t&&t.imagebitmap;return await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!function(e){for(const t in e||de)return!1;return!0}(t)&&fe||(t=null),t)try{return await createImageBitmap(e,t)}catch(e){console.warn(e),fe=!1}return await createImageBitmap(e)}(n,o)}(e,t,o);break;case"image":i=await le(e,t,o);break;case"data":i=await async function(e,t){const{mimeType:r}=ge(e)||{},n=globalThis._parseImageNode;return h(n),await n(e,r)}(e);break;default:h(!1)}return"data"===n&&(i=function(e){switch(function(e){const t=function(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&e instanceof Image?"image":e&&"object"==typeof e&&e.data&&e.width&&e.height?"data":null}(e);if(!t)throw new Error("Not an image");return t}(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw new Error("getImageData");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}(i)),i},tests:[e=>Boolean(ge(new DataView(e)))],options:{image:{type:"auto",decode:!0}}};var ve=1e3,we=2e4,be=20001,xe=20002,Se=20003,Me=20004;function Ee(e){return new Float64Array(e||6)}function Te(e){return void 0===e&&(e=Ee()),e[0]=t.MAX_DOUBLE,e[1]=t.MAX_DOUBLE,e[2]=t.MAX_DOUBLE,e[3]=t.MIN_DOUBLE,e[4]=t.MIN_DOUBLE,e[5]=t.MIN_DOUBLE,e}function ke(e,t){for(var r,n,o,i=0,s=t.length;i<s;i+=3)n=t[i+1],o=t[i+2],e[0]>(r=t[i])&&(e[0]=r),e[1]>n&&(e[1]=n),e[2]>o&&(e[2]=o),e[3]<r&&(e[3]=r),e[4]<n&&(e[4]=n),e[5]<o&&(e[5]=o);return e}n.createVec3(),n.createVec3(),n.createMat4(),t.newFloatArray(3),t.newFloatArray(3),t.newFloatArray(3),t.newFloatArray(3),t.newFloatArray(3),t.newFloatArray(3),t.newFloatArray(3);var _e=function(e){this.positionsCompressed=void 0,this.uvsCompressed=void 0,this.colorsCompressed=void 0,this.indices=void 0,this.edgeIndices=void 0,this.positionsCompressed=e.positionsCompressed,this.uvsCompressed=e.uvsCompressed,this.colorsCompressed=e.colorsCompressed,this.indices=e.indices,this.edgeIndices=e.edgeIndices},De=function(e){this.id=void 0,this.primitive=void 0,this.positionsDecompressMatrix=void 0,this.aabb=void 0,this.uvsDecompressMatrix=void 0,this.geometryBuckets=void 0,this.rendererGeometry=void 0,this.geometryBuckets=[];for(var t=0,r=e.geometryBuckets.length;t<r;t++)this.geometryBuckets[t]=new _e(e.geometryBuckets[t]);this.id=e.id,this.positionsDecompressMatrix=e.positionsDecompressMatrix,this.primitive=e.primitive},Ae=/*#__PURE__*/d("positionsDecompressed"),Be=/*#__PURE__*/d("positionsWorld"),je=new(/*#__PURE__*/function(){function e(){this.object=void 0,this.mesh=void 0,this.meshIndex=void 0,this.geometry=void 0,this.geometryBucket=void 0,this.geometryBucketIndex=void 0,Object.defineProperty(this,Ae,{writable:!0,value:void 0}),Object.defineProperty(this,Be,{writable:!0,value:void 0}),this.object=null,this.mesh=null,this.meshIndex=0,this.geometry=null,this.geometryBucket=null,this.geometryBucketIndex=0,f(this,Ae)[Ae]=null,f(this,Be)[Be]=null}return e.prototype.reset=function(){f(this,Ae)[Ae]=null,f(this,Be)[Be]=null},s(e,[{key:"totalGeometryBuckets",get:function(){var e=0;if(this.object)for(var t=0,r=this.object.meshes.length;t<r;t++)e+=this.object.meshes[t].geometry.geometryBuckets.length;return e}},{key:"numPrimitives",get:function(){var e=this.geometry.primitive;return this.geometryBucket.indices.length/(e===xe?3:e===be?2:1)}},{key:"positionsDecompressed",get:function(){return f(this,Ae)[Ae]||(f(this,Ae)[Ae]=new Float32Array(this.geometryBucket.positionsCompressed.length),o.decompressPositions3(this.geometryBucket.positionsCompressed,this.geometry.positionsDecompressMatrix,f(this,Ae)[Ae])),f(this,Ae)[Ae]}},{key:"positionsWorld",get:function(){if(!f(this,Be)[Be]){var e=this.positionsDecompressed;f(this,Be)[Be]=new Float64Array(e.length),n.transformPositions3(e,this.mesh.matrix,f(this,Be)[Be])}return f(this,Be)[Be]}},{key:"uvsDecompressed",get:function(){return null}}]),e}());function Ie(e,t){je.reset(),je.object=e;for(var r=0,n=e.meshes.length;r<n;r++){var o=e.meshes[r];je.mesh=o,je.meshIndex=r;var i=o.geometry;je.geometry=i;for(var s=0,a=i.geometryBuckets.length;s<a;s++)if(je.geometryBucket=i.geometryBuckets[s],je.geometryBucketIndex=s,t(je))return!0}return!1}var Pe=/*#__PURE__*/d("aabb"),Le=/*#__PURE__*/d("aabbDirty"),Oe=/*#__PURE__*/function(){function e(e){this.model=void 0,this.id=void 0,this.meshes=void 0,this.layerId=void 0,this.rendererObject=void 0,Object.defineProperty(this,Pe,{writable:!0,value:void 0}),Object.defineProperty(this,Le,{writable:!0,value:void 0}),this.id=e.id,this.layerId=e.layerId,this.meshes=e.meshes,f(this,Pe)[Pe]=Ee(),f(this,Le)[Le]=!0,this.rendererObject=null}return e.prototype.setAABBDirty=function(){f(this,Le)[Le]=!0},s(e,[{key:"aabb",get:function(){var e=this;return f(this,Le)[Le]&&(Te(f(this,Pe)[Pe]),Ie(this,function(t){return ke(f(e,Pe)[Pe],t.positionsWorld),!1}),f(this,Le)[Le]=!1),f(this,Pe)[Pe]}}]),e}(),Ce=function(e,t){this.id=void 0,this.colorTexture=void 0,this.metallicRoughnessTexture=void 0,this.occlusionTexture=void 0,this.emissiveTexture=void 0,this.rendererTextureSet=void 0,this.id=e.id,this.colorTexture=t.colorTexture,this.metallicRoughnessTexture=t.metallicRoughnessTexture,this.occlusionTexture=t.occlusionTexture,this.emissiveTexture=t.emissiveTexture,this.rendererTextureSet=null},Ue=function(e){this.rendererTexture=void 0,this.id=void 0,this.src=void 0,this.imageData=void 0,this.buffers=void 0,this.image=void 0,this.height=void 0,this.width=void 0,this.compressed=void 0,this.mediaType=void 0,this.magFilter=void 0,this.minFilter=void 0,this.wrapS=void 0,this.wrapT=void 0,this.wrapR=void 0,this.flipY=void 0,this.encoding=void 0,this.preloadColor=void 0,this.channel=void 0,this.id=e.id,this.imageData=e.imageData,this.src=e.src,this.mediaType=e.mediaType,this.minFilter=e.minFilter||1007,this.magFilter=e.magFilter||1007,this.wrapS=e.wrapS||ve,this.wrapT=e.wrapT||ve,this.wrapR=e.wrapR||ve,this.encoding=e.encoding||3e3,this.preloadColor=n.createVec4(e.preloadColor||[1,1,1,1]),this.channel=0,this.rendererTexture=null},Fe=/*#__PURE__*/d("color"),Re=/*#__PURE__*/d("matrix"),Ge=/*#__PURE__*/d("metallic"),Ke=/*#__PURE__*/d("roughness"),We=/*#__PURE__*/d("opacity"),Ne=/*#__PURE__*/function(){function e(e){this.id=void 0,this.geometry=void 0,this.textureSet=void 0,this.rendererMesh=void 0,this.object=void 0,Object.defineProperty(this,Fe,{writable:!0,value:void 0}),Object.defineProperty(this,Re,{writable:!0,value:void 0}),Object.defineProperty(this,Ge,{writable:!0,value:void 0}),Object.defineProperty(this,Ke,{writable:!0,value:void 0}),Object.defineProperty(this,We,{writable:!0,value:void 0}),this.id=e.id,f(this,Re)[Re]=e.matrix?n.createMat4(e.matrix):n.identityMat4(),this.geometry=e.geometry,this.textureSet=e.textureSet,this.rendererMesh=null,this.color=e.color||n.createVec3([1,1,1]),this.metallic=null!=e.metallic?e.metallic:0,this.roughness=null!=e.roughness?e.roughness:1,this.opacity=null!=e.opacity?e.opacity:1}return s(e,[{key:"color",get:function(){return f(this,Fe)[Fe]},set:function(e){var t=f(this,Fe)[Fe];t||((t=f(this,Fe)[Fe]=new Float32Array(4))[3]=1),e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.rendererMesh&&this.rendererMesh.setColor(f(this,Fe)[Fe])}},{key:"matrix",get:function(){return f(this,Re)[Re]},set:function(e){e?f(this,Re)[Re].set(e):n.identityMat4(f(this,Re)[Re]),this.rendererMesh&&this.rendererMesh.setMatrix(f(this,Re)[Re]),this.object&&this.object.setAABBDirty()}},{key:"metallic",get:function(){return f(this,Ge)[Ge]},set:function(e){e=null!=e?e:1,f(this,Ge)[Ge]!==e&&(f(this,Ge)[Ge]=e,this.rendererMesh&&this.rendererMesh.setMetallic(f(this,Ge)[Ge]))}},{key:"roughness",get:function(){return f(this,Ke)[Ke]},set:function(e){e=null!=e?e:1,f(this,Ke)[Ke]!==e&&(f(this,Ke)[Ke]=e,this.rendererMesh&&this.rendererMesh.setRoughness(f(this,Ke)[Ke]))}},{key:"opacity",get:function(){return f(this,We)[We]},set:function(e){e=null!=e?e:1,f(this,We)[We]!==e&&(f(this,We)[We]=e)}}]),e}(),Ve=[],He=[],Qe=[],qe=[],Je=[],ze=0,Xe=new Uint16Array(3),Ye=new Uint16Array(3),$e=new Uint16Array(3),Ze=n.createVec3(),et=n.createVec3(),tt=n.createVec3(),rt=n.createVec3(),nt=n.createVec3(),ot=n.createVec3(),it=n.createVec3(),st=null;function at(e,t){for(var r,n=0;n<3;n++)if(0!=(r=st[3*e+n]-st[3*t+n]))return r;return 0}var ct=null,ut=null;function lt(e,t){var r,n,o,i,s,a,c=3*e,u=3*t,l=Math.min(r=ut[c],n=ut[c+1],o=ut[c+2]),d=Math.min(i=ut[u],s=ut[u+1],a=ut[u+2]);if(l!=d)return l-d;var f=Math.max(r,n,o),h=Math.max(i,s,a);return f!=h?f-h:0}function dt(e){var r=n.createMat4(),i=Te();ke(i,e.positions);var s,a=o.quantizePositions3(e.positions,i,r),c=e.primitive!==Se&&e.primitive!==Me&&e.primitive!==xe||!e.indices?null:function(e,r,i,s){!function(e,t){var r,n,o,i,s,a,c={},u=Math.pow(10,4),l=0;for(s=0,a=e.length;s<a;s+=3)r=e[s],n=e[s+1],o=e[s+2],void 0===c[i=Math.round(r*u)+"_"+Math.round(n*u)+"_"+Math.round(o*u)]&&(c[i]=l/3,Ve[l++]=r,Ve[l++]=n,Ve[l++]=o),He[s/3]=c[i];for(s=0,a=t.length;s<a;s++)qe[s]=He[t[s]],Qe[qe[s]]=t[s]}(e,r),function(e,t){ze=0;for(var r=0,i=e;r<i;r+=3){var s=3*qe[r],a=3*qe[r+1],c=3*qe[r+2];t?(Xe[0]=Ve[s],Xe[1]=Ve[s+1],Xe[2]=Ve[s+2],Ye[0]=Ve[a],Ye[1]=Ve[a+1],Ye[2]=Ve[a+2],$e[0]=Ve[c],$e[1]=Ve[c+1],$e[2]=Ve[c+2],o.decompressPoint3(Xe,t,Ze),o.decompressPoint3(Ye,t,et),o.decompressPoint3($e,t,tt)):(Ze[0]=Ve[s],Ze[1]=Ve[s+1],Ze[2]=Ve[s+2],et[0]=Ve[a],et[1]=Ve[a+1],et[2]=Ve[a+2],tt[0]=Ve[c],tt[1]=Ve[c+1],tt[2]=Ve[c+2]),n.subVec3(tt,et,rt),n.subVec3(Ze,et,nt),n.cross3Vec3(rt,nt,ot),n.normalizeVec3(ot,it);var u=Je[ze]||(Je[ze]={normal:n.createVec3()});u.normal[0]=it[0],u.normal[1]=it[1],u.normal[2]=it[2],ze++}}(r.length,i);for(var a,c,u,l,d,f,h,p,g=[],m=Math.cos(10*t.DEGTORAD),y={},v=!1,w=0,b=r.length;w<b;w+=3)for(var x=w/3,S=0;S<3;S++)a=qe[w+S],c=qe[w+(S+1)%3],void 0===y[d=(u=Math.min(a,c))+","+(l=Math.max(a,c))]?y[d]={index1:u,index2:l,face1:x,face2:void 0}:y[d].face2=x;for(d in y)void 0!==(f=y[d]).face2&&n.dotVec3(Je[f.face1].normal,Je[f.face2].normal)>m||(h=Qe[f.index1],p=Qe[f.index2],(!v&&h>65535||p>65535)&&(v=!0),g.push(h),g.push(p));return v?new Uint32Array(g):new Uint16Array(g)}(a,e.indices,r),u=function(e){var t=e.positionsCompressed,r=e.indices,n=e.edgeIndices;!function(e){if(!(null!==ct&&ct.length>=e)){ct=new Uint32Array(e);for(var t=0;t<e;t++)ct[t]=t}}(t.length/3);var o=ct.slice(0,t.length/3),i=ct.slice(0,t.length/3);st=t,o.sort(at);var s=0;i[o[0]]=0;for(var a=1,c=o.length;a<c;a++)0!=at(o[a],o[a-1])&&s++,i[o[a]]=s;var u=new Uint16Array(3*(s+1));u[3*(s=0)+0]=t[3*o[0]+0],u[3*s+1]=t[3*o[0]+1],u[3*s+2]=t[3*o[0]+2];for(var l=1,d=o.length;l<d;l++)0!==at(o[l],o[l-1])&&(u[3*++s+0]=t[3*o[l]+0],u[3*s+1]=t[3*o[l]+1],u[3*s+2]=t[3*o[l]+2]),i[o[l]]=s;st=null;for(var f,h=new Uint32Array(r.length),p=0,g=r.length;p<g;p++)h[p]=i[r[p]];if(n){f=new Uint32Array(n.length);for(var m=0,y=n.length;m<y;m++)f[m]=i[n[m]]}return[u,h,f]}({positionsCompressed:a,uvs:e.uvs,indices:e.indices,edgeIndices:c}),l=function(e,t,r){void 0===r&&(r=!1);var n=e.positionsCompressed||[],o=function(e,t){for(var r=new Int32Array(e.length/3),n=0,o=r.length;n<o;n++)r[n]=n;ut=new Int32Array(e.length);for(var i=0,s=e.length;i<s;i++)ut[i]=e[i]>>t;r.sort(lt);for(var a=new Int32Array(e.length),c=0,u=r.length;c<u;c++)a[3*c+0]=e[3*r[c]+0],a[3*c+1]=e[3*r[c]+1],a[3*c+2]=e[3*r[c]+2];return a}(e.indices||[],t),i=[];function s(e,t){if(e>t){var r=e;e=t,t=r}function n(r,n){return r!=e?e-r:n!=t?t-n:0}for(var o=0,s=(i.length>>1)-1;o<=s;){var a=s+o>>1,c=n(i[2*a],i[2*a+1]);if(c>0)o=a+1;else{if(!(c<0))return a;s=a-1}}return-o-1}var a=new Int32Array(i.length/2);a.fill(0);var c=n.length/3;if(c>8*(1<<t))return[e];var u=new Int32Array(c);u.fill(-1);var l=[];function d(){u.fill(-1);var e={positionsCompressed:[],indices:[],edgeIndices:[],maxNumPositions:(1<<t)-t,numPositions:0,bucketNumber:l.length};return l.push(e),e}for(var f=d(),h=0,p=o.length;h<p;h+=3){var g=0,m=o[h],y=o[h+1],v=o[h+2];if(-1==u[m]&&g++,-1==u[y]&&g++,-1==u[v]&&g++,g+f.numPositions>f.maxNumPositions&&(f=d()),f.bucketNumber>8)return[e];-1==u[m]&&(u[m]=f.numPositions++,f.positionsCompressed.push(n[3*m]),f.positionsCompressed.push(n[3*m+1]),f.positionsCompressed.push(n[3*m+2])),-1==u[y]&&(u[y]=f.numPositions++,f.positionsCompressed.push(n[3*y]),f.positionsCompressed.push(n[3*y+1]),f.positionsCompressed.push(n[3*y+2])),-1==u[v]&&(u[v]=f.numPositions++,f.positionsCompressed.push(n[3*v]),f.positionsCompressed.push(n[3*v+1]),f.positionsCompressed.push(n[3*v+2])),f.indices.push(u[m]),f.indices.push(u[y]),f.indices.push(u[v]);var w=void 0;(w=s(m,y))>=0&&0==a[w]&&(a[w]=1,f.edgeIndices.push(u[i[2*w]]),f.edgeIndices.push(u[i[2*w+1]])),(w=s(m,v))>=0&&0==a[w]&&(a[w]=1,f.edgeIndices.push(u[i[2*w]]),f.edgeIndices.push(u[i[2*w+1]])),(w=s(y,v))>=0&&0==a[w]&&(a[w]=1,f.edgeIndices.push(u[i[2*w]]),f.edgeIndices.push(u[i[2*w+1]]))}var b=t/8,x=2*n.length+(o.length+i.length)*(t/8*2),S=0;return l.forEach(function(e){S+=2*e.positionsCompressed.length+(e.indices.length+e.edgeIndices.length)*b}),S>x?[e]:(r&&function(e,t){var r={};e.forEach(function(e){for(var t=e.indices,n=e.edgeIndices,o=e.positionsCompressed,i=0,s=t.length;i<s;i+=3)r[o[3*t[i]]+"_"+o[3*t[i]+1]+"_"+o[3*t[i]+2]+"/"+o[3*t[i+1]]+"_"+o[3*t[i+1]+1]+"_"+o[3*t[i+1]+2]+"/"+o[3*t[i+2]]+"_"+o[3*t[i+2]+1]+"_"+o[3*t[i+2]+2]]=!0;for(i=0,s=n.length;i<s;i+=2);});for(var n=t.indices,o=t.positionsCompressed,i=0,s=n.length;i<s;i+=3){var a=o[3*n[i]]+"_"+o[3*n[i]+1]+"_"+o[3*n[i]+2]+"/"+o[3*n[i+1]]+"_"+o[3*n[i+1]+1]+"_"+o[3*n[i+1]+2]+"/"+o[3*n[i+2]]+"_"+o[3*n[i+2]+1]+"_"+o[3*n[i+2]+2];if(!(a in r))throw console.log("Not found "+a),"Ohhhh!"}}(l,e),l)}({positionsCompressed:s=u[0],indices:u[1],edgeIndices:u[2]},s.length/3>65536?16:8);return{id:e.id,primitive:e.primitive===Se&&l.length>1?xe:e.primitive,aabb:i,positionsDecompressMatrix:r,uvsDecompressMatrix:void 0,geometryBuckets:l}}const ft=e=>"function"==typeof e,ht=e=>null!==e&&"object"==typeof e,pt=e=>ht(e)&&e.constructor==={}.constructor,gt=e=>e&&"function"==typeof e[Symbol.iterator],mt=e=>e&&"function"==typeof e[Symbol.asyncIterator],yt=e=>"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,vt=e=>"undefined"!=typeof Blob&&e instanceof Blob,wt=e=>e&&"object"==typeof e&&e.isBuffer,bt=e=>(e=>"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||ht(e)&&ft(e.tee)&&ft(e.cancel)&&ft(e.getReader))(e)||(e=>ht(e)&&ft(e.read)&&ft(e.pipe)&&(e=>"boolean"==typeof e)(e.readable))(e),xt=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,St=/^([-\w.]+\/[-\w.+]+)/;function Mt(e){const t=St.exec(e);return t?t[1]:e}function Et(e){const t=xt.exec(e);return t?t[1]:""}const Tt=/\?.*/;function kt(e){if(yt(e)){const t=_t(e.url||"");return{url:t,type:Mt(e.headers.get("content-type")||"")||Et(t)}}return vt(e)?{url:_t(e.name||""),type:e.type||""}:"string"==typeof e?{url:_t(e),type:Et(e)}:{url:"",type:""}}function _t(e){return e.replace(Tt,"")}async function Dt(e){if(yt(e))return e;const t={},r=function(e){return yt(e)?e.headers["content-length"]||-1:vt(e)?e.size:"string"==typeof e?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}(e);r>=0&&(t["content-length"]=String(r));const{url:n,type:o}=kt(e);o&&(t["content-type"]=o);const i=await async function(e){if("string"==typeof e)return"data:,".concat(e.slice(0,5));if(e instanceof Blob){const t=e.slice(0,5);return await new Promise(e=>{const r=new FileReader;r.onload=t=>{var r;return e(null==t||null===(r=t.target)||void 0===r?void 0:r.result)},r.readAsDataURL(t)})}if(e instanceof ArrayBuffer){const t=function(e){let t="";const r=new Uint8Array(e);for(let e=0;e<r.byteLength;e++)t+=String.fromCharCode(r[e]);return btoa(t)}(e.slice(0,5));return"data:base64,".concat(t)}return null}(e);i&&(t["x-first-bytes"]=i),"string"==typeof e&&(e=(new TextEncoder).encode(e));const s=new Response(e,{headers:t});return Object.defineProperty(s,"url",{value:n}),s}async function At(e,t){if("string"==typeof e){e=J(e);let r=t;return null!=t&&t.fetch&&"function"!=typeof(null==t?void 0:t.fetch)&&(r=t.fetch),await fetch(e,r)}return await Dt(e)}function Bt(){return!("object"==typeof process&&"[object process]"===String(process)&&!process.browser)||function(e){if("undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"==typeof process.versions&&Boolean(process.versions.electron))return!0;const t="object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}()}const jt={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document,process:"object"==typeof process&&process},It=jt.window||jt.self||jt.global,Pt=jt.process||{},Lt="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source";Bt();class Ot{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";S(this,"storage",void 0),S(this,"id",void 0),S(this,"config",void 0),this.storage=function(e){try{const t=window[e],r="__storage_test__";return t.setItem(r,r),t.removeItem(r),t}catch(e){return null}}(r),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function Ct(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600;const o=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>n&&(r=Math.min(r,n/e.width));const i=e.width*r,s=e.height*r,a=["font-size:1px;","padding:".concat(Math.floor(s/2),"px ").concat(Math.floor(i/2),"px;"),"line-height:".concat(s,"px;"),"background:url(".concat(o,");"),"background-size:".concat(i,"px ").concat(s,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),a]}let Ut;function Ft(e){return"string"==typeof e?Ut[e.toUpperCase()]||Ut.WHITE:e}function Rt(e,t){if(!e)throw new Error(t||"Assertion failed")}function Gt(){let e;var t,r;if(Bt&&"performance"in It)e=null==It||null===(t=It.performance)||void 0===t||null===(r=t.now)||void 0===r?void 0:r.call(t);else if("hrtime"in Pt){var n;const t=null==Pt||null===(n=Pt.hrtime)||void 0===n?void 0:n.call(Pt);e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}!function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"}(Ut||(Ut={}));const Kt={debug:Bt&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Wt={enabled:!0,level:0};function Nt(){}const Vt={},Ht={once:!0};class Qt{constructor(){let{id:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:""};S(this,"id",void 0),S(this,"VERSION",Lt),S(this,"_startTs",Gt()),S(this,"_deltaTs",Gt()),S(this,"_storage",void 0),S(this,"userData",{}),S(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new Ot("__probe-".concat(this.id,"__"),Wt),this.timeStamp("".concat(this.id," started")),function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"];const r=Object.getPrototypeOf(e),n=Object.getOwnPropertyNames(r);for(const r of n)"function"==typeof e[r]&&(t.find(e=>r===e)||(e[r]=e[r].bind(e)))}(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Gt()-this._startTs).toPrecision(10))}getDelta(){return Number((Gt()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){return this._storage.setConfiguration({enabled:!(arguments.length>0&&void 0!==arguments[0])||arguments[0]}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){Rt(e,t)}warn(e){return this._getLogFunction(0,e,Kt.warn,arguments,Ht)}error(e){return this._getLogFunction(0,e,Kt.error,arguments)}deprecated(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}removed(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}probe(e,t){return this._getLogFunction(e,t,Kt.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Kt.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),o=2;o<r;o++)n[o-2]=arguments[o];return this._getLogFunction(e,t,Kt.debug||Kt.info,arguments,Ht)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||Nt,r&&[r],{tag:zt(t)}):Nt}image(e){let{logLevel:t,priority:r,image:n,message:o="",scale:i=1}=e;return this._shouldLog(t||r)?Bt?function(e){let{image:t,message:r="",scale:n=1}=e;if("string"==typeof t){const e=new Image;return e.onload=()=>{const t=Ct(e,r,n);console.log(...t)},e.src=t,Nt}const o=t.nodeName||"";if("img"===o.toLowerCase())return console.log(...Ct(t,r,n)),Nt;if("canvas"===o.toLowerCase()){const e=new Image;return e.onload=()=>console.log(...Ct(e,r,n)),e.src=t.toDataURL(),Nt}return Nt}({image:n,message:o,scale:i}):(console.warn("removed"),Nt):Nt}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Nt)}group(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1};const n=Jt({logLevel:e,message:t,opts:r}),{collapsed:o}=r;return n.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,t){return this.group(e,t,Object.assign({},arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Nt)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=qt(e)}_getLogFunction(e,t,r,n,o){if(this._shouldLog(e)){o=Jt({logLevel:e,message:t,args:n,opts:o}),Rt(r=r||o.method),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=Gt();const i=o.tag||o.message;if(o.once){if(Vt[i])return Nt;Vt[i]=Gt()}return t=function(e,t,r){if("string"==typeof t){const s=r.time?function(e){const t=Math.max((arguments.length>1&&void 0!==arguments[1]?arguments[1]:8)-e.length,0);return"".concat(" ".repeat(t)).concat(e)}(function(e){let t;return t=e<10?"".concat(e.toFixed(2),"ms"):e<100?"".concat(e.toFixed(1),"ms"):e<1e3?"".concat(e.toFixed(0),"ms"):"".concat((e/1e3).toFixed(2),"s"),t}(r.total)):"";n=t=r.time?"".concat(e,": ").concat(s,"  ").concat(t):"".concat(e,": ").concat(t),o=r.color,i=r.background,Bt||"string"!=typeof n||(o&&(o=Ft(o),n="[".concat(o,"m").concat(n,"[39m")),i&&(o=Ft(i),n="[".concat(i+10,"m").concat(n,"[49m"))),t=n}var n,o,i;return t}(this.id,o.message,o),r.bind(console,t,...o.args)}return Nt}}function qt(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return Rt(Number.isFinite(t)&&t>=0),t}function Jt(e){const{logLevel:t,message:r}=e;e.logLevel=qt(t);const n=e.args?Array.from(e.args):[];for(;n.length&&n.shift()!==r;);switch(typeof t){case"string":case"function":void 0!==r&&n.unshift(r),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());const o=typeof e.message;return Rt("string"===o||"object"===o),Object.assign(e,{args:n},e.opts)}function zt(e){for(const t in e)for(const r in e[t])return r||"untitled";return"empty"}S(Qt,"VERSION",Lt);const Xt=new Qt({id:"loaders.gl"});class Yt{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}const $t={fetch:null,mimeType:void 0,nothrow:!1,log:new class{constructor(){S(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.log.bind(this.console,...t)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.info.bind(this.console,...t)}warn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.warn.bind(this.console,...t)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.error.bind(this.console,...t)}},CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:p,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Zt={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function er(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state=e._state||{},e._state}const tr=()=>{const e=er();return e.globalOptions=e.globalOptions||{...$t},e.globalOptions};function rr(e,t){const r=tr(),n=e||r;return"function"==typeof n.fetch?n.fetch:ht(n.fetch)?e=>At(e,n):null!=t&&t.fetch?null==t?void 0:t.fetch:At}function nr(e,t,r,n,o){const i=t||"Top level",s=t?"".concat(t,"."):"";for(const a in e){const c=!t&&ht(e[a]);if(!(a in r)&&("baseUri"!==a||t)&&("workerUrl"!==a||!t))if(a in n)Xt.warn("".concat(i," loader option '").concat(s).concat(a,"' no longer supported, use '").concat(n[a],"'"))();else if(!c){const e=or(a,o);Xt.warn("".concat(i," loader option '").concat(s).concat(a,"' not recognized. ").concat(e))()}}}function or(e,t){const r=e.toLowerCase();let n="";for(const o of t)for(const t in o.options){if(e===t)return"Did you mean '".concat(o.id,".").concat(t,"'?");const i=t.toLowerCase();(r.startsWith(i)||i.startsWith(r))&&(n=n||"Did you mean '".concat(o.id,".").concat(t,"'?"))}return n}function ir(e,t){for(const r in t)r in t&&(e[r]=pt(t[r])&&pt(e[r])?{...e[r],...t[r]}:t[r])}function sr(e){var t;return!!e&&(Array.isArray(e)&&(e=e[0]),Array.isArray(null===(t=e)||void 0===t?void 0:t.extensions))}function ar(e){var t,r;let n;return h(e,"null loader"),h(sr(e),"invalid loader"),Array.isArray(e)&&(n=e[1],e=e[0],e={...e,options:{...e.options,...n}}),(null!==(t=e)&&void 0!==t&&t.parseTextSync||null!==(r=e)&&void 0!==r&&r.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}const cr=()=>{const e=er();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry},ur=new Qt({id:"loaders.gl"}),lr=/\.([^.]+)$/;function dr(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!fr(e))return null;if(t&&!Array.isArray(t))return ar(t);let o=[];t&&(o=o.concat(t)),null!=r&&r.ignoreRegisteredLoaders||o.push(...cr()),function(e){for(const t of e)ar(t)}(o);const i=function(e,t,r,n){const{url:o,type:i}=kt(e),s=o||(null==n?void 0:n.url);let a=null,c="";var u;return null!=r&&r.mimeType&&(a=pr(t,null==r?void 0:r.mimeType),c="match forced by supplied MIME type ".concat(null==r?void 0:r.mimeType)),a=a||function(e,t){const r=t&&lr.exec(t),n=r&&r[1];return n?function(e,t){t=t.toLowerCase();for(const r of e)for(const e of r.extensions)if(e.toLowerCase()===t)return r;return null}(e,n):null}(t,s),c=c||(a?"matched url ".concat(s):""),a=a||pr(t,i),c=c||(a?"matched MIME type ".concat(i):""),a=a||function(e,t){if(!t)return null;for(const r of e)if("string"==typeof t){if(gr(t,r))return r}else if(ArrayBuffer.isView(t)){if(mr(t.buffer,t.byteOffset,r))return r}else if(t instanceof ArrayBuffer&&mr(t,0,r))return r;return null}(t,e),c=c||(a?"matched initial data ".concat(yr(e)):""),a=a||pr(t,null==r?void 0:r.fallbackMimeType),c=c||(a?"matched fallback MIME type ".concat(i):""),c&&ur.log(1,"selectLoader selected ".concat(null===(u=a)||void 0===u?void 0:u.name,": ").concat(c,".")),a}(e,o,r,n);if(!(i||null!=r&&r.nothrow))throw new Error(hr(e));return i}function fr(e){return!(e instanceof Response&&204===e.status)}function hr(e){const{url:t,type:r}=kt(e);let n="No valid loader found (";n+=t?"".concat(function(e){const t=e&&e.lastIndexOf("/");return t>=0?e.substr(t+1):""}(t),", "):"no url provided, ",n+="MIME type: ".concat(r?'"'.concat(r,'"'):"not provided",", ");const o=e?yr(e):"";return n+=o?' first bytes: "'.concat(o,'"'):"first bytes: not available",n+=")",n}function pr(e,t){for(const r of e){if(r.mimeTypes&&r.mimeTypes.includes(t))return r;if(t==="application/x.".concat(r.id))return r}return null}function gr(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some(t=>e.startsWith(t))}function mr(e,t,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(n=>function(e,t,r,n){if(n instanceof ArrayBuffer)return function(e,t,r){if(e.byteLength<(r=r||e.byteLength)||t.byteLength<r)return!1;const n=new Uint8Array(e),o=new Uint8Array(t);for(let e=0;e<n.length;++e)if(n[e]!==o[e])return!1;return!0}(n,e,n.byteLength);switch(typeof n){case"function":return n(e,r);case"string":return n===vr(e,t,n.length);default:return!1}}(e,t,r,n))}function yr(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return"string"==typeof e?e.slice(0,t):ArrayBuffer.isView(e)?vr(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?vr(e,0,t):""}function vr(e,t,r){if(e.byteLength<t+r)return"";const n=new DataView(e);let o="";for(let e=0;e<r;e++)o+=String.fromCharCode(n.getUint8(t+e));return o}const wr=262144,br=262144,xr=1048576;function Sr(e,t){return p?async function*(e,t){const r=e.getReader();let n;try{for(;;){const e=n||r.read();null!=t&&t._streamReadAhead&&(n=r.read());const{done:o,value:i}=await e;if(o)return;yield z(i)}}catch(e){r.releaseLock()}}(e,t):async function*(e,t){for await(const t of e)yield z(t)}(e)}const Mr="Cannot convert supplied data type";async function Er(e,t,r,n){g(!n||"object"==typeof n),!t||Array.isArray(t)||sr(t)||(n=void 0,r=t,t=void 0),e=await e,r=r||{};const{url:o}=kt(e),i=function(e,t){if(!t&&e&&!Array.isArray(e))return e;let r;if(e&&(r=Array.isArray(e)?e:[e]),t&&t.loaders){const e=Array.isArray(t.loaders)?t.loaders:[t.loaders];r=r?[...r,...e]:e}return r&&r.length?r:null}(t,n),s=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!fr(e))return null;let o=dr(e,t,{...r,nothrow:!0},n);if(o)return o;if(vt(e)&&(o=dr(e=await e.slice(0,10).arrayBuffer(),t,r,n)),!(o||null!=r&&r.nothrow))throw new Error(hr(e));return o}(e,i,r);return s?(n=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(r)return r;const n={fetch:rr(t,e),...e};return Array.isArray(n.loaders)||(n.loaders=null),n}({url:o,parse:Er,loaders:i},r=function(e,t,r,n){return r=r||[],function(e,t){nr(e,null,$t,Zt,t);for(const r of t)nr(e&&e[r.id]||{},r.id,r.options&&r.options[r.id]||{},r.deprecatedOptions&&r.deprecatedOptions[r.id]||{},t)}(e,r=Array.isArray(r)?r:[r]),function(e,t,r){const n={...e.options||{}};return function(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}(n,r),null===n.log&&(n.log=new Yt),ir(n,tr()),ir(n,t),n}(t,e,n)}(r,s,i,o),n),await async function(e,t,r,n){if(g(e,"no worker provided"),yt(t)){const e=t,{ok:r,redirected:o,status:i,statusText:s,type:a,url:c}=e,u=Object.fromEntries(e.headers.entries());n.response={headers:u,ok:r,redirected:o,status:i,statusText:s,type:a,url:c}}if(t=await async function(e,t,r){const n=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||n)return function(e,t,r){if(t.text&&"string"==typeof e)return e;if(wt(e)&&(e=e.buffer),e instanceof ArrayBuffer){const r=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let r=e.buffer;const n=e.byteLength||e.length;return 0===e.byteOffset&&n===r.byteLength||(r=r.slice(e.byteOffset,e.byteOffset+n)),r}throw new Error(Mr)}(e,t);if(vt(e)&&(e=await Dt(e)),yt(e)){const r=e;return await async function(e){if(!e.ok){const t=await async function(e){let t="Failed to fetch resource ".concat(e.url," (").concat(e.status,"): ");try{const r=e.headers.get("Content-Type");let n=e.statusText;r.includes("application/json")&&(n+=" ".concat(await e.text())),t+=n,t=t.length>60?"".concat(t.slice(0,60),"..."):t}catch(e){}return t}(e);throw new Error(t)}}(r),t.binary?await r.arrayBuffer():await r.text()}if(bt(e)&&(e=function(e,t){if("string"==typeof e)return function*(e,t){const r=(null==t?void 0:t.chunkSize)||wr;let n=0;const o=new TextEncoder;for(;n<e.length;){const t=Math.min(e.length-n,r),i=e.slice(n,n+t);n+=t,yield o.encode(i)}}(e,t);if(e instanceof ArrayBuffer)return function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{chunkSize:r=br}=t;let n=0;for(;n<e.byteLength;){const t=Math.min(e.byteLength-n,r),o=new ArrayBuffer(t),i=new Uint8Array(e,n,t);new Uint8Array(o).set(i),n+=t,yield o}}(e,t);if(vt(e))return async function*(e,t){const r=(null==t?void 0:t.chunkSize)||xr;let n=0;for(;n<e.size;){const t=n+r,o=await e.slice(n,t).arrayBuffer();n=t,yield o}}(e,t);if(bt(e))return Sr(e,t);if(yt(e))return Sr(e.body,t);throw new Error("makeIterator")}(e,r)),gt(e)||mt(e))return async function(e){const t=[];for await(const r of e)t.push(r);return H(...t)}(e);throw new Error(Mr)}(t,e,r),e.parseTextSync&&"string"==typeof t)return r.dataType="text",e.parseTextSync(t,r,n,e);if(function(e,t){return!!L.isSupported()&&!!(v||null!=t&&t._nodeWorkers)&&e.worker&&(null==t?void 0:t.worker)}(e,r))return await N(e,t,r,n,Er);if(e.parseText&&"string"==typeof t)return await e.parseText(t,r,n,e);if(e.parse)return await e.parse(t,r,n,e);throw g(!e.parseSync),new Error("".concat(e.id," loader - no parser found and worker is disabled"))}(s,e,r,n)):null}async function Tr(e,t,r){if(function(e,t){return!!L.isSupported()&&!!(p||null!=t&&t._nodeWorkers)&&e.worker&&(null==t?void 0:t.worker)}(t,r={...tr(),...r}))return await F(t,e,r);if(t.encode)return await t.encode(e,r);if(t.encodeSync)return t.encodeSync(e,r);if(t.encodeText)return(new TextEncoder).encode(await t.encodeText(e,r));if(t.encodeInBatches){const n=function(e,t,r){if(t.encodeInBatches){const n=function(e){return[{table:e,start:0,end:e.length}]}(e);return t.encodeInBatches(n,r)}throw new Error("Writer could not encode data in batches")}(e,t,r),o=[];for await(const e of n)o.push(e);return H(...o)}if(!p&&t.encodeURLtoURL){const n=kr("input");await async function(e,t,r){e=J(e),p||await(void 0)(e,t,{flag:"w"}),h(!1)}(n,e);const o=kr("output"),i=await async function(e,t,r,n){if(e=J(e),t=J(t),p||!r.encodeURLtoURL)throw new Error;return await r.encodeURLtoURL(e,t,n)}(n,o,t,r);return(await At(i)).arrayBuffer()}throw new Error("Writer could not encode data")}function kr(e){return"/tmp/".concat(e)}var _r={0:{useSRGB:!0,qualityLevel:50,encodeUASTC:!0,mipmaps:!0},3:{useSRGB:!0,encodeUASTC:!0,qualityLevel:10,mipmaps:!1},1:{useSRGB:!1,encodeUASTC:!0,qualityLevel:50,mipmaps:!0},2:{useSRGB:!1,encodeUASTC:!0,qualityLevel:10,mipmaps:!1},4:{useSRGB:!1,encodeUASTC:!0,qualityLevel:10,mipmaps:!1}},Dr=/*#__PURE__*/d("texturesList"),Ar=/*#__PURE__*/d("numObjects"),Br=/*#__PURE__*/d("meshUsedByObject"),jr=/*#__PURE__*/d("removeUnusedTextures"),Ir=/*#__PURE__*/d("compressTextures"),Pr=/*#__PURE__*/function(t){function n(n,o){var i;return i=t.call(this,n,{id:o.id})||this,Object.defineProperty(u(i),Ir,{value:Or}),Object.defineProperty(u(i),jr,{value:Lr}),i.scene=void 0,i.layerId=void 0,i.built=void 0,i.edgeThreshold=void 0,i.geometries=void 0,i.textures=void 0,i.textureSets=void 0,i.meshes=void 0,i.objects=void 0,i.aabb=void 0,i.onBuilt=void 0,i.rendererModel=void 0,Object.defineProperty(u(i),Dr,{writable:!0,value:void 0}),Object.defineProperty(u(i),Ar,{writable:!0,value:void 0}),Object.defineProperty(u(i),Br,{writable:!0,value:void 0}),i.scene=n,i.onBuilt=new e.EventEmitter(new r.EventDispatcher),i.onDestroyed=new e.EventEmitter(new r.EventDispatcher),f(u(i),Ar)[Ar]=0,f(u(i),Br)[Br]={},i.id=o.id||"default",i.layerId=o.layerId,i.edgeThreshold=10,i.geometries={},i.textures={},f(u(i),Dr)[Dr]=[],i.textureSets={},i.meshes={},i.objects={},i.aabb=Ee(),i.built=!1,i.rendererModel=null,i.fromJSON(o),i}a(n,t);var o=n.prototype;return o.fromJSON=function(t){if(this.destroyed)return new e.SDKError("Failed to add components to SceneModel - SceneModel already destroyed");if(this.built)return new e.SDKError("Failed to add components to SceneModel - SceneModel already built");if(t.geometries)for(var r=0,n=t.geometries.length;r<n;r++)this.createGeometry(t.geometries[r]);if(t.textures)for(var o=0,i=t.textures.length;o<i;o++)this.createTexture(t.textures[o]);if(t.textureSets)for(var s=0,a=t.textureSets.length;s<a;s++)this.createTextureSet(t.textureSets[s]);if(t.meshes)for(var c=0,u=t.meshes.length;c<u;c++)this.createMesh(t.meshes[c]);if(t.objects)for(var l=0,d=t.objects.length;l<d;l++)this.createObject(t.objects[l])},o.createTransform=function(t){return this.destroyed?new e.SDKError("Failed to create Transform in SceneModel - SceneModel already destroyed"):this.built?new e.SDKError("Failed to create Transform in SceneModel - SceneModel already built"):void 0},o.createTexture=function(t){if(this.destroyed)return new e.SDKError("Failed to create Texture in SceneModel - SceneModel already destroyed");if(this.built)return new e.SDKError("Failed to create Texture in SceneModel - SceneModel already built");if(!t.imageData&&!t.src&&!t.buffers)return new e.SDKError("Failed to create Texture in SceneModel - Parameter expected: textureParams.imageData, textureParams.src or textureParams.buffers");if(this.textures[t.id])return new e.SDKError("Failed to create Texture in SceneModel - Texture already exists with this ID: "+t.id);t.src&&t.src.split(".").pop();var r=new Ue(t);return this.textures[t.id]=r,f(this,Dr)[Dr].push(r),r},o.createTextureSet=function(t){if(this.destroyed)return new e.SDKError("Failed to create TextureSet in SceneModel - SceneModel already destroyed");if(this.built)return new e.SDKError("Failed to create TextureSet in SceneModel - SceneModel already built");if(this.textureSets[t.id])return new e.SDKError("Failed to create TextureSet in SceneModel - TextureSet already exists with this ID: "+t.id);var r,n,o,i,s;if(null!=t.colorTextureId){if(!(r=this.textures[t.colorTextureId]))return new e.SDKError("Failed to create TextureSet in SceneModel - Texture not found: "+t.colorTextureId+" - ensure that you create it first with createTexture()");r.channel=0}if(null!=t.metallicRoughnessTextureId){if(!(n=this.textures[t.metallicRoughnessTextureId]))return new e.SDKError("Failed to create TextureSet in SceneModel - Texture not found: "+t.metallicRoughnessTextureId+" - ensure that you create it first with createTexture()");n.channel=1}if(null!=t.normalsTextureId){if(!(o=this.textures[t.normalsTextureId]))return new e.SDKError("Failed to create TextureSet in SceneModel - Texture not found: "+t.normalsTextureId+" - ensure that you create it first with createTexture()");o.channel=2}if(null!=t.emissiveTextureId){if(!(i=this.textures[t.emissiveTextureId]))return new e.SDKError("Failed to create TextureSet in SceneModel - Texture not found: "+t.emissiveTextureId+" - ensure that you create it first with createTexture()");i.channel=3}if(null!=t.occlusionTextureId){if(!(s=this.textures[t.occlusionTextureId]))return new e.SDKError("Failed to create TextureSet in SceneModel - Texture not found: "+t.occlusionTextureId+" - ensure that you create it first with createTexture()");s.channel=4}var a=new Ce(t,{emissiveTexture:i,occlusionTexture:s,metallicRoughnessTexture:n,colorTexture:r});return this.textureSets[t.id]=a,a},o.createGeometry=function(t){if(this.destroyed)return new e.SDKError("Failed to create Geometry in SceneModel - SceneModel already destroyed");if(this.built)return new e.SDKError("Failed to create Geometry in SceneModel - SceneModel already built");if(!t)return new e.SDKError("Failed to create Geometry in SceneModel - Parameters expected: geometryParams");if(null==t.id)return new e.SDKError("Failed to create Geometry in SceneModel - Parameter expected: geometryParams.id");var r=t.id;if(this.geometries[r])return new e.SDKError("Failed to create Geometry in SceneModel - Geometry with this ID already created: "+r);var n=t.primitive;if(n!==we&&n!==be&&n!==xe&&n!==Se&&n!==Me)return new e.SDKError("Failed to create Geometry in SceneModel - Unsupported value for geometryParams.primitive: '"+n+"' - supported values are PointsPrimitive, LinesPrimitive, TrianglesPrimitive, SolidPrimitive and SurfacePrimitive");if(!t.positions)return new e.SDKError("Failed to create Geometry in SceneModel - Param expected: geometryParams.positions");if(!t.indices&&n!==we)return new e.SDKError("Failed to create Geometry in SceneModel - Param expected: geometryParams.indices (required for primitive type)");if(t.uvs&&t.uvs.length/2!=t.positions.length/3)return new e.SDKError("Failed to create Geometry in SceneModel - mismatch between given quantities of vertex positions and UVs");if(t.indices)for(var o=t.positions.length/3,i=0,s=t.indices.length;i<s;i++){var a=t.indices[i];if(a<0||a>=o)return new e.SDKError("Failed to create Geometry in SceneModel - indices out of range of vertex positions");if(t.uvs&&(a<0||a>=t.uvs.length/2))return new e.SDKError("Failed to create Geometry in SceneModel - indices out of range of vertex UVs")}var c=new De(dt(t));return this.geometries[r]=c,c},o.createGeometryCompressed=function(t){if(this.destroyed)return new e.SDKError("Failed to add compressed Geometry to SceneModel - SceneModel already destroyed");if(this.built)return new e.SDKError("Failed to add compressed Geometry to SceneModel - SceneModel already built");if(!t)return new e.SDKError("Failed to add compressed Geometry to SceneModel - Parameters expected: geometryCompressedParams");var r=t.id;if(this.geometries[r])return new e.SDKError("Failed to add compressed Geometry to SceneModel - Geometry with this ID already created: "+r);var n=t.primitive;if(n!==we&&n!==be&&n!==xe&&n!==Se&&n!==Me)return new e.SDKError("Failed to add compressed Geometry to SceneModel - Unsupported value for geometryCompressedParams.primitive: '"+n+"' - supported values are PointsPrimitive, LinesPrimitive, TrianglesPrimitive, SolidPrimitive and SurfacePrimitive");var o=new De(t);return this.geometries[r]=o,o},o.createMesh=function(t){if(this.destroyed)return new e.SDKError("Failed to create Mesh in SceneModel - SceneModel already destroyed");if(this.built)return new e.SDKError("Failed to create Mesh in SceneModel - SceneModel already built");if(this.meshes[t.id])return new e.SDKError("Failed to create Mesh in SceneModel - Mesh already exists with this ID: "+t.id);var r=this.geometries[t.geometryId];if(!r)return new e.SDKError("Failed to create Mesh in SceneModel - Geometry not found: "+t.geometryId);var n=t.textureSetId?this.textureSets[t.textureSetId]:void 0;if(t.textureSetId&&!n)return new e.SDKError("Failed to create Mesh in SceneModel - TextureSet not found: "+t.textureSetId);var o=new Ne({id:t.id,geometry:r,textureSet:n,matrix:t.matrix,color:t.color,opacity:t.opacity,roughness:t.roughness,metallic:t.metallic});return this.meshes[t.id]=o,o},o.createObject=function(t){if(this.destroyed)return new e.SDKError("Failed to create SceneObject - SceneModel already destroyed");if(this.built)return new e.SDKError("Failed to create SceneObject SceneModel already built");if(0===t.meshIds.length)return new e.SDKError("Failed to create SceneObject - no meshes specified");if(this.scene.objects[t.id])return new e.SDKError("Failed to create SceneObject - SceneObject already exists in Scene: "+t.id);for(var r=t.meshIds,n=[],o=0,i=r.length;o<i;o++){var s=r[o],a=this.meshes[s];if(!a)return new e.SDKError("Failed to create SceneObject - Mesh not found: "+s);if(f(this,Br)[Br][s])return new e.SDKError("Failed to create SceneObject - Mesh "+s+" already belongs to another SceneObject");n.push(a),f(this,Br)[Br][a.id]=!0}for(var c=new Oe({id:t.id,layerId:t.layerId||this.layerId,model:this,meshes:n}),u=0,l=n.length;u<l;u++)n[u].object=c;return f(this,Ar)[Ar]++,this.objects[t.id]=c,c},o.build=function(){try{var t=this;return Promise.resolve(new Promise(function(r){if(t.destroyed)throw new e.SDKError("Failed to build SceneModel - SceneModel already destroyed");if(t.built)throw new e.SDKError("Failed to build SceneModel - SceneModel already built");f(t,jr)[jr](),f(t,Ir)[Ir]().then(function(){t.built=!0,t.onBuilt.dispatch(t,null),r(t)}).catch(function(e){throw e})}))}catch(e){return Promise.reject(e)}},n}(e.Component);function Lr(){}function Or(){var t=this,r=f(this,Dr)[Dr].length;return new Promise(function(n){if(0!==r)for(var o=function(){var o=f(t,Dr)[Dr][i],s=_r[o.channel]||{};if(o.src){var a=o.src;switch(a.split(".").pop()){case"jpeg":case"jpg":case"png":(async function(e,t,r,n){Array.isArray(t)||sr(t)||(r=t,t=void 0);const o=rr(r);let i=e;return"string"==typeof e&&(i=await o(e)),vt(e)&&(i=await o(e)),await Er(i,t,r)})(a,ye,{image:{type:"data"}}).then(function(t){o.compressed?Tr(t,ee,s).then(function(e){var t=new Uint8Array(e);o.imageData=t,--r<=0&&n()}).catch(function(t){return new e.SDKError("Failed to compress texture: "+t)}):(o.imageData=new Uint8Array(1),--r<=0&&n())}).catch(function(t){return new e.SDKError("Failed to load texture image: "+t)});break;default:--r<=0&&n()}}o.imageData&&(o.compressed?Tr(o.imageData,ee,s).then(function(e){o.imageData=new Uint8Array(e),--r<=0&&n()}).catch(function(t){return new e.SDKError("Failed to compress texture: "+t)}):(o.imageData=new Uint8Array(1),--r<=0&&n()))},i=0,s=f(t,Dr)[Dr].length;i<s;i++)o();else n()})}var Cr=/*#__PURE__*/d("onModelBuilts"),Ur=/*#__PURE__*/d("onModelDestroys"),Fr=/*#__PURE__*/d("center"),Rr=/*#__PURE__*/d("aabbDirty"),Gr=/*#__PURE__*/d("aabb"),Kr=/*#__PURE__*/d("registerObjects"),Wr=/*#__PURE__*/d("deregisterObjects"),Nr=/*#__PURE__*/function(n){function o(){var t;return t=n.call(this,null,{})||this,Object.defineProperty(u(t),Wr,{value:Hr}),Object.defineProperty(u(t),Kr,{value:Vr}),t.models=void 0,t.objects=void 0,t.onModelCreated=void 0,t.onModelDestroyed=void 0,Object.defineProperty(u(t),Cr,{writable:!0,value:void 0}),Object.defineProperty(u(t),Ur,{writable:!0,value:void 0}),Object.defineProperty(u(t),Fr,{writable:!0,value:void 0}),Object.defineProperty(u(t),Rr,{writable:!0,value:void 0}),Object.defineProperty(u(t),Gr,{writable:!0,value:void 0}),f(u(t),Gr)[Gr]=Ee(),f(u(t),Rr)[Rr]=!0,t.models={},t.objects={},f(u(t),Cr)[Cr]={},f(u(t),Ur)[Ur]={},t.onModelCreated=new e.EventEmitter(new r.EventDispatcher),t.onModelDestroyed=new e.EventEmitter(new r.EventDispatcher),t}a(o,n);var i=o.prototype;return i.createModel=function(t){var r=this;if(this.destroyed)return new e.SDKError("Scene already destroyed");var n=t.id;if(this.models[n])return new e.SDKError("SceneModel already created in this Scene: "+n);var o=new Pr(this,t);return this.models[n]=o,o.onDestroyed.one(function(){delete r.models[o.id],f(r,Wr)[Wr](o),r.onModelDestroyed.dispatch(r,o)}),o.onBuilt.one(function(){f(r,Kr)[Kr](o),r.onModelCreated.dispatch(r,o)}),o},i.setAABBDirty=function(){f(this,Rr)[Rr]||(f(this,Rr)[Rr]=!0)},i.clear=function(){if(this.destroyed)return new e.SDKError("Scene already destroyed");for(var t in this.models)this.models[t].destroy()},i.destroy=function(){this.clear(),this.onModelCreated.clear(),this.onModelDestroyed.clear(),n.prototype.destroy.call(this)},s(o,[{key:"center",get:function(){if(f(this,Rr)[Rr]){var e=this.aabb;f(this,Fr)[Fr][0]=(e[0]+e[3])/2,f(this,Fr)[Fr][1]=(e[1]+e[4])/2,f(this,Fr)[Fr][2]=(e[2]+e[5])/2}return f(this,Fr)[Fr]}},{key:"aabb",get:function(){if(f(this,Rr)[Rr]){var e,r=t.MAX_DOUBLE,n=t.MAX_DOUBLE,o=t.MAX_DOUBLE,i=t.MIN_DOUBLE,s=t.MIN_DOUBLE,a=t.MIN_DOUBLE,c=this.objects,u=!1;for(var l in c)c.hasOwnProperty(l)&&((e=c[l].aabb)[0]<r&&(r=e[0]),e[1]<n&&(n=e[1]),e[2]<o&&(o=e[2]),e[3]>i&&(i=e[3]),e[4]>s&&(s=e[4]),e[5]>a&&(a=e[5]),u=!0);u||(r=-100,n=-100,o=-100,i=100,s=100,a=100),f(this,Gr)[Gr][0]=r,f(this,Gr)[Gr][1]=n,f(this,Gr)[Gr][2]=o,f(this,Gr)[Gr][3]=i,f(this,Gr)[Gr][4]=s,f(this,Gr)[Gr][5]=a,f(this,Rr)[Rr]=!1}return f(this,Gr)[Gr]}}]),o}(e.Component);function Vr(e){var t=e.objects;for(var r in t){var n=t[r];this.objects[n.id]=n}f(this,Rr)[Rr]=!0}function Hr(e){var t=e.objects;for(var r in t)delete this.objects[t[r].id];f(this,Rr)[Rr]=!0}exports.Geometry=De,exports.GeometryBucket=_e,exports.Mesh=Ne,exports.Scene=Nr,exports.SceneModel=Pr,exports.SceneObject=Oe,exports.Texture=Ue,exports.TextureSet=Ce,exports.compressGeometryParams=dt,exports.getSceneObjectGeometry=Ie;
//# sourceMappingURL=index.js.map
