import{SDKError as e,EventEmitter as t,Component as r}from"@xeokit/core";import{newFloatArray as n,MAX_DOUBLE as o,MIN_DOUBLE as i,DEGTORAD as s}from"@xeokit/math";import{EventDispatcher as a}from"strongly-typed-events";import{createVec3 as c,createMat4 as u,subVec3 as l,lenVec3 as d,transformPositions3 as f,createVec4 as h,identityMat4 as p,dotVec3 as g,cross3Vec3 as m,normalizeVec3 as y}from"@xeokit/matrix";import{decompressPoint3 as v,decompressPositions3 as w,quantizePositions3 as b}from"@xeokit/compression";function x(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,"symbol"==typeof(o=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key))?o:String(o),n)}var o}function S(e,t,r){return t&&x(e.prototype,t),r&&x(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function T(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,M(e,t)}function M(e,t){return M=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},M(e,t)}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var _=0;function j(e){return"__private_"+_+++"_"+e}function A(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}function B(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const I=Boolean("object"!=typeof process||"[object process]"!==String(process)||process.browser);function E(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}"undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);const C={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},P=C.global||C.self||C.window||{},L="object"!=typeof process||"[object process]"!==String(process)||process.browser,O="function"==typeof importScripts,F="undefined"!=typeof window&&void 0!==window.orientation;function U(e){return U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},U(e)}function R(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==U(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==U(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===U(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}"undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);class D{constructor(e,t){R(this,"name",void 0),R(this,"workerThread",void 0),R(this,"isRunning",!0),R(this,"result",void 0),R(this,"_resolve",()=>{}),R(this,"_reject",()=>{}),this.name=e,this.workerThread=t,this.result=new Promise((e,t)=>{this._resolve=e,this._reject=t})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){E(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){E(this.isRunning),this.isRunning=!1,this._reject(e)}}class G{terminate(){}}const W=new Map;function N(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function H(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0;const n=r||new Set;if(e)if(V(e))n.add(e);else if(V(e.buffer))n.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"==typeof e)for(const r in e)H(e[r],t,n);return void 0===r?Array.from(n):[]}function V(e){return!!e&&(e instanceof ArrayBuffer||"undefined"!=typeof MessagePort&&e instanceof MessagePort||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)}function Q(e){if(null===e)return{};const t=Object.assign({},e);return Object.keys(t).forEach(r=>{t[r]="object"!=typeof e[r]||ArrayBuffer.isView(e[r])||e[r]instanceof Array?"function"==typeof t[r]||t[r]instanceof RegExp?{}:e[r]:Q(e[r])}),t}const J=()=>{};class z{static isSupported(){return"undefined"!=typeof Worker&&L||void 0!==G&&!L}constructor(e){R(this,"name",void 0),R(this,"source",void 0),R(this,"url",void 0),R(this,"terminated",!1),R(this,"worker",void 0),R(this,"onMessage",void 0),R(this,"onError",void 0),R(this,"_loadableURL","");const{name:t,source:r,url:n}=e;E(r||n),this.name=t,this.source=r,this.url=n,this.onMessage=J,this.onError=e=>console.log(e),this.worker=L?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=J,this.onError=J,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||H(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(t+="".concat(e.message," in ")),e.lineno&&(t+=":".concat(e.lineno,":").concat(e.colno)),new Error(t)}_createBrowserWorker(){this._loadableURL=function(e){E(e.source&&!e.url||!e.source&&e.url);let t=W.get(e.source||e.url);return t||(e.url&&(t=(r=e.url).startsWith("http")?N("try {\n  importScripts('".concat(r,"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}")):r,W.set(e.url,t)),e.source&&(t=N(e.source),W.set(e.source,t))),E(t),t;var r}({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},e.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},e.onmessageerror=e=>console.error(e),e}_createNodeWorker(){let e;if(this.url){const t=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new G(t,{eval:!1})}else{if(!this.source)throw new Error("no worker");e=new G(this.source,{eval:!0})}return e.on("message",e=>{this.onMessage(e)}),e.on("error",e=>{this.onError(e)}),e.on("exit",e=>{}),e}}class q{static isSupported(){return z.isSupported()}constructor(e){R(this,"name","unnamed"),R(this,"source",void 0),R(this,"url",void 0),R(this,"maxConcurrency",1),R(this,"maxMobileConcurrency",1),R(this,"onDebug",()=>{}),R(this,"reuseWorkers",!0),R(this,"props",{}),R(this,"jobQueue",[]),R(this,"idleQueue",[]),R(this,"count",0),R(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}async startJob(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e,t,r)=>e.done(r),r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(e,t)=>e.error(t);const n=new Promise(n=>(this.jobQueue.push({name:e,onMessage:t,onError:r,onStart:n}),this));return this._startQueuedJob(),await n}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const r=new D(t.name,e);e.onMessage=e=>t.onMessage(r,e.type,e.payload),e.onError=e=>t.onError(r,e),t.onStart(r);try{await r.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new z({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return F?this.maxMobileConcurrency:this.maxConcurrency}}const K={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Y{static isSupported(){return z.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Y._workerFarm=Y._workerFarm||new Y({}),Y._workerFarm.setProps(e),Y._workerFarm}constructor(e){R(this,"props",void 0),R(this,"workerPools",new Map),this.props={...K},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:r,url:n}=e;let o=this.workerPools.get(t);return o||(o=new q({name:t,source:r,url:n}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}R(Y,"_workerFarm",void 0);const X="latest",$="3.3.1";function Z(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=t[e.id]||{},n="".concat(e.id,"-worker.js");let o=r.workerUrl;if(o||"compression"!==e.id||(o=t.workerUrl),"test"===t._workerType&&(o="modules/".concat(e.module,"/dist/").concat(n)),!o){let t=e.version;"latest"===t&&(t=X);const r=t?"@".concat(t):"";o="https://unpkg.com/@loaders.gl/".concat(e.module).concat(r,"/dist/").concat(n)}return E(o),o}async function ee(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const o=function(e){const t=e.version!==$?" (worker-utils@".concat($,")"):"";return"".concat(e.name,"@").concat(e.version).concat(t)}(e),i=Y.getWorkerFarm(r),{source:s}=r,a={name:o,source:s};s||(a.url=Z(e,r));const c=i.getWorkerPool(a),u=r.jobName||e.name,l=await c.startJob(u,te.bind(null,n)),d=Q(r);return l.postMessage("process",{input:t,options:d}),(await l.result).result}async function te(e,t,r,n){switch(r){case"done":t.done(n);break;case"error":t.error(new Error(n.error));break;case"process":const{id:o,input:i,options:s}=n;try{if(!e.process)return void t.postMessage("error",{id:o,error:"Worker not set up to process on main thread"});const r=await e.process(i,s);t.postMessage("done",{id:o,result:r})}catch(e){const r=e instanceof Error?e.message:"unknown error";t.postMessage("error",{id:o,error:r})}break;default:console.warn("process-on-worker: unknown message ".concat(r))}}var re={__proto__:null,default:{}};const ne={};async function oe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t&&(e=function(e,t,r){if(e.startsWith("http"))return e;const n=r.modules||{};return n[e]?n[e]:L?r.CDN?(E(r.CDN.startsWith("http")),"".concat(r.CDN,"/").concat(t,"@").concat("3.3.1","/dist/libs/").concat(e)):O?"../src/libs/".concat(e):"modules/".concat(t,"/src/libs/").concat(e):"modules/".concat(t,"/dist/libs/").concat(e)}(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})),ne[e]=ne[e]||async function(e){if(e.endsWith("wasm")){const t=await fetch(e);return await t.arrayBuffer()}if(!L)try{return re&&void 0}catch{return null}if(O)return importScripts(e);const t=await fetch(e);return function(e,t){if(!L)return;if(O)return eval.call(P,e),null;const r=document.createElement("script");r.id=t;try{r.appendChild(document.createTextNode(e))}catch(t){r.text=e}return document.body.appendChild(r),null}(await t.text(),e)}(e),await ne[e]}async function ie(e,t,r,n,o){const i=e.id,s=Z(e,r),a=Y.getWorkerFarm(r).getWorkerPool({name:i,url:s});r=JSON.parse(JSON.stringify(r)),n=JSON.parse(JSON.stringify(n||{}));const c=await a.startJob("process-on-worker",se.bind(null,o));c.postMessage("process",{input:t,options:r,context:n});const u=await c.result;return await u.result}async function se(e,t,r,n){switch(r){case"done":t.done(n);break;case"error":t.error(new Error(n.error));break;case"process":const{id:o,input:i,options:s}=n;try{const r=await e(i,s);t.postMessage("done",{id:o,result:r})}catch(e){const r=e instanceof Error?e.message:"unknown error";t.postMessage("error",{id:o,error:r})}break;default:console.warn("parse-with-worker unknown message ".concat(r))}}function ae(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const n=t.map(e=>e instanceof ArrayBuffer?new Uint8Array(e):e),o=n.reduce((e,t)=>e+t.byteLength,0),i=new Uint8Array(o);let s=0;for(const e of n)i.set(e,s),s+=e.byteLength;return i.buffer}let ce="";const ue={};function le(e){for(const t in ue)e.startsWith(t)&&(e=e.replace(t,ue[t]));return e.startsWith("http://")||e.startsWith("https://")||(e="".concat(ce).concat(e)),e}function de(e){if((t=e)&&"object"==typeof t&&t.isBuffer)return(void 0)(e);var t;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if("string"==typeof e){const t=e;return(new TextEncoder).encode(t).buffer}if(e&&"object"==typeof e&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}const fe="3.3.1",he="https://unpkg.com/@loaders.gl/textures@".concat(fe,"/dist/libs/basis_encoder.wasm"),pe="https://unpkg.com/@loaders.gl/textures@".concat(fe,"/dist/libs/basis_encoder.js");let ge;const me={name:"Basis Universal Supercompressed GPU Texture",id:"ktx2-basis-writer",module:"textures",version:"3.3.1",extensions:["ktx2"],options:{useSRGB:!1,qualityLevel:10,encodeUASTC:!1,mipmaps:!1},encode:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{useSRGB:r=!1,qualityLevel:n=10,encodeUASTC:o=!1,mipmaps:i=!1}=t,{BasisEncoder:s}=await async function(e){const t=e.modules||{};return t.basisEncoder?t.basisEncoder:(ge=ge||async function(e){let t=null,r=null;return[t,r]=await Promise.all([await oe(pe,"textures",e),await oe(he,"textures",e)]),t=t||globalThis.BASIS,await function(e,t){const r={};return t&&(r.wasmBinary=t),new Promise(t=>{e(r).then(e=>{const{BasisFile:r,KTX2File:n,initializeBasis:o,BasisEncoder:i}=e;o(),t({BasisFile:r,KTX2File:n,BasisEncoder:i})})})}(t,r)}(e),await ge)}(t),a=new s;try{const t=new Uint8Array(e.width*e.height*4);a.setCreateKTX2File(!0),a.setKTX2UASTCSupercompression(!0),a.setKTX2SRGBTransferFunc(!0),a.setSliceSourceImage(0,e.data,e.width,e.height,!1),a.setPerceptual(r),a.setMipSRGB(r),a.setQualityLevel(n),a.setUASTC(o),a.setMipGen(i);const s=a.encode(t);return t.subarray(0,s).buffer}catch(e){throw console.error("Basis Universal Supercompressed GPU Texture encoder Error: ",e),e}finally{a.delete()}}},{_parseImageNode:ye}=globalThis,ve="undefined"!=typeof Image,we="undefined"!=typeof ImageBitmap,be=Boolean(ye),xe=!!I||be,Se=/^data:image\/svg\+xml/,Te=/\.svg((\?|#).*)?$/;function Me(e){return e&&(Se.test(e)||Te.test(e))}function ke(e,t){if(Me(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function _e(e,t,r){const n=function(e,t){if(Me(t)){let t=(new TextDecoder).decode(e);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(t=unescape(encodeURIComponent(t)))}catch(e){throw new Error(e.message)}return"data:image/svg+xml;base64,".concat(btoa(t))}return ke(e,t)}(e,r),o=self.URL||self.webkitURL,i="string"!=typeof n&&o.createObjectURL(n);try{return await async function(e,t){const r=new Image;return r.src=e,t.image&&t.image.decode&&r.decode?(await r.decode(),r):await new Promise((t,n)=>{try{r.onload=()=>t(r),r.onerror=t=>n(new Error("Could not load image ".concat(e,": ").concat(t)))}catch(e){n(e)}})}(i||n,t)}finally{i&&o.revokeObjectURL(i)}}const je={};let Ae=!0;const Be=!1,Ie=!0;function Ee(e){const t=Ce(e);return function(e){const t=Ce(e);return t.byteLength>=24&&2303741511===t.getUint32(0,Be)?{mimeType:"image/png",width:t.getUint32(16,Be),height:t.getUint32(20,Be)}:null}(t)||function(e){const t=Ce(e);if(!(t.byteLength>=3&&65496===t.getUint16(0,Be)&&255===t.getUint8(2)))return null;const{tableMarkers:r,sofMarkers:n}=function(){const e=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)e.add(t);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}();let o=2;for(;o+9<t.byteLength;){const e=t.getUint16(o,Be);if(n.has(e))return{mimeType:"image/jpeg",height:t.getUint16(o+5,Be),width:t.getUint16(o+7,Be)};if(!r.has(e))return null;o+=2,o+=t.getUint16(o,Be)}return null}(t)||function(e){const t=Ce(e);return t.byteLength>=10&&1195984440===t.getUint32(0,Be)?{mimeType:"image/gif",width:t.getUint16(6,Ie),height:t.getUint16(8,Ie)}:null}(t)||function(e){const t=Ce(e);return t.byteLength>=14&&16973===t.getUint16(0,Be)&&t.getUint32(2,Ie)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,Ie),height:t.getUint32(22,Ie)}:null}(t)}function Ce(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}const Pe={id:"image",module:"images",name:"Images",version:"3.3.1",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg"],parse:async function(e,t,r){const n=((t=t||{}).image||{}).type||"auto",{url:o}=r||{};let i;switch(function(e){switch(e){case"auto":case"data":return function(){if(we)return"imagebitmap";if(ve)return"image";if(xe)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(e){switch(e){case"auto":return we||ve||xe;case"imagebitmap":return we;case"image":return ve;case"data":return xe;default:throw new Error("@loaders.gl/images: image ".concat(e," not supported in this environment"))}}(e),e}}(n)){case"imagebitmap":i=await async function(e,t,r){let n;n=Me(r)?await _e(e,t,r):ke(e,r);const o=t&&t.imagebitmap;return await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!function(e){for(const t in e||je)return!1;return!0}(t)&&Ae||(t=null),t)try{return await createImageBitmap(e,t)}catch(e){console.warn(e),Ae=!1}return await createImageBitmap(e)}(n,o)}(e,t,o);break;case"image":i=await _e(e,t,o);break;case"data":i=await async function(e,t){const{mimeType:r}=Ee(e)||{},n=globalThis._parseImageNode;return B(n),await n(e,r)}(e);break;default:B(!1)}return"data"===n&&(i=function(e){switch(function(e){const t=function(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&e instanceof Image?"image":e&&"object"==typeof e&&e.data&&e.width&&e.height?"data":null}(e);if(!t)throw new Error("Not an image");return t}(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw new Error("getImageData");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}(i)),i},tests:[e=>Boolean(Ee(new DataView(e)))],options:{image:{type:"auto",decode:!0}}};var Le=1e3,Oe=2e4,Fe=20001,Ue=20002,Re=20003,De=20004;function Ge(e){return new Float64Array(e||6)}function We(e){return void 0===e&&(e=Ge()),e[0]=o,e[1]=o,e[2]=o,e[3]=i,e[4]=i,e[5]=i,e}function Ne(e,t){for(var r,n,o,i=0,s=t.length;i<s;i+=3)n=t[i+1],o=t[i+2],e[0]>(r=t[i])&&(e[0]=r),e[1]>n&&(e[1]=n),e[2]>o&&(e[2]=o),e[3]<r&&(e[3]=r),e[4]<n&&(e[4]=n),e[5]<o&&(e[5]=o);return e}c(),c(),u(),n(3),n(3),n(3),n(3),n(3),n(3),n(3);var He=function(e){this.positionsCompressed=void 0,this.uvsCompressed=void 0,this.colorsCompressed=void 0,this.indices=void 0,this.edgeIndices=void 0,this.positionsCompressed=e.positionsCompressed,this.uvsCompressed=e.uvsCompressed,this.colorsCompressed=e.colorsCompressed,this.indices=e.indices,this.edgeIndices=e.edgeIndices},Ve=function(e){this.id=void 0,this.primitive=void 0,this.positionsDecompressMatrix=void 0,this.aabb=void 0,this.uvsDecompressMatrix=void 0,this.geometryBuckets=void 0,this.rendererGeometry=void 0,this.geometryBuckets=[];for(var t=0,r=e.geometryBuckets.length;t<r;t++)this.geometryBuckets[t]=new He(e.geometryBuckets[t]);this.id=e.id,this.positionsDecompressMatrix=e.positionsDecompressMatrix,this.primitive=e.primitive},Qe=/*#__PURE__*/j("positionsDecompressed"),Je=/*#__PURE__*/j("positionsWorld"),ze=new(/*#__PURE__*/function(){function e(){this.object=void 0,this.mesh=void 0,this.meshIndex=void 0,this.geometry=void 0,this.geometryBucket=void 0,this.geometryBucketIndex=void 0,Object.defineProperty(this,Qe,{writable:!0,value:void 0}),Object.defineProperty(this,Je,{writable:!0,value:void 0}),this.object=null,this.mesh=null,this.meshIndex=0,this.geometry=null,this.geometryBucket=null,this.geometryBucketIndex=0,A(this,Qe)[Qe]=null,A(this,Je)[Je]=null}return e.prototype.reset=function(){A(this,Qe)[Qe]=null,A(this,Je)[Je]=null},S(e,[{key:"totalGeometryBuckets",get:function(){var e=0;if(this.object)for(var t=0,r=this.object.meshes.length;t<r;t++)e+=this.object.meshes[t].geometry.geometryBuckets.length;return e}},{key:"numPrimitives",get:function(){var e=this.geometry.primitive;return this.geometryBucket.indices.length/(e===Ue?3:e===Fe?2:1)}},{key:"positionsDecompressed",get:function(){return A(this,Qe)[Qe]||(A(this,Qe)[Qe]=new Float32Array(this.geometryBucket.positionsCompressed.length),w(this.geometryBucket.positionsCompressed,this.geometry.positionsDecompressMatrix,A(this,Qe)[Qe])),A(this,Qe)[Qe]}},{key:"positionsWorld",get:function(){if(!A(this,Je)[Je]){var e=this.positionsDecompressed;A(this,Je)[Je]=new Float64Array(e.length),f(e,this.mesh.matrix,A(this,Je)[Je])}return A(this,Je)[Je]}},{key:"uvsDecompressed",get:function(){return null}}]),e}());function qe(e,t){ze.reset(),ze.object=e;for(var r=0,n=e.meshes.length;r<n;r++){var o=e.meshes[r];ze.mesh=o,ze.meshIndex=r;var i=o.geometry;ze.geometry=i;for(var s=0,a=i.geometryBuckets.length;s<a;s++)if(ze.geometryBucket=i.geometryBuckets[s],ze.geometryBucketIndex=s,t(ze))return!0}return!1}var Ke=/*#__PURE__*/j("aabb"),Ye=/*#__PURE__*/j("aabbDirty"),Xe=/*#__PURE__*/function(){function e(e){this.model=void 0,this.id=void 0,this.meshes=void 0,this.layerId=void 0,this.rendererObject=void 0,Object.defineProperty(this,Ke,{writable:!0,value:void 0}),Object.defineProperty(this,Ye,{writable:!0,value:void 0}),this.id=e.id,this.layerId=e.layerId,this.meshes=e.meshes,A(this,Ke)[Ke]=Ge(),A(this,Ye)[Ye]=!0,this.rendererObject=null}return e.prototype.setAABBDirty=function(){A(this,Ye)[Ye]=!0},S(e,[{key:"aabb",get:function(){var e=this;return A(this,Ye)[Ye]&&(We(A(this,Ke)[Ke]),qe(this,function(t){return Ne(A(e,Ke)[Ke],t.positionsWorld),!1}),A(this,Ye)[Ye]=!1),A(this,Ke)[Ke]}}]),e}(),$e=function(e,t){this.id=void 0,this.colorTexture=void 0,this.metallicRoughnessTexture=void 0,this.occlusionTexture=void 0,this.emissiveTexture=void 0,this.rendererTextureSet=void 0,this.id=e.id,this.colorTexture=t.colorTexture,this.metallicRoughnessTexture=t.metallicRoughnessTexture,this.occlusionTexture=t.occlusionTexture,this.emissiveTexture=t.emissiveTexture,this.rendererTextureSet=null},Ze=function(e){this.rendererTexture=void 0,this.id=void 0,this.src=void 0,this.imageData=void 0,this.buffers=void 0,this.image=void 0,this.height=void 0,this.width=void 0,this.compressed=void 0,this.mediaType=void 0,this.magFilter=void 0,this.minFilter=void 0,this.wrapS=void 0,this.wrapT=void 0,this.wrapR=void 0,this.flipY=void 0,this.encoding=void 0,this.preloadColor=void 0,this.channel=void 0,this.id=e.id,this.imageData=e.imageData,this.src=e.src,this.mediaType=e.mediaType,this.minFilter=e.minFilter||1007,this.magFilter=e.magFilter||1007,this.wrapS=e.wrapS||Le,this.wrapT=e.wrapT||Le,this.wrapR=e.wrapR||Le,this.encoding=e.encoding||3e3,this.preloadColor=h(e.preloadColor||[1,1,1,1]),this.channel=0,this.rendererTexture=null},et=/*#__PURE__*/j("color"),tt=/*#__PURE__*/j("matrix"),rt=/*#__PURE__*/j("metallic"),nt=/*#__PURE__*/j("roughness"),ot=/*#__PURE__*/j("opacity"),it=/*#__PURE__*/function(){function e(e){this.id=void 0,this.geometry=void 0,this.textureSet=void 0,this.rendererMesh=void 0,this.object=void 0,Object.defineProperty(this,et,{writable:!0,value:void 0}),Object.defineProperty(this,tt,{writable:!0,value:void 0}),Object.defineProperty(this,rt,{writable:!0,value:void 0}),Object.defineProperty(this,nt,{writable:!0,value:void 0}),Object.defineProperty(this,ot,{writable:!0,value:void 0}),this.id=e.id,A(this,tt)[tt]=e.matrix?u(e.matrix):p(),this.geometry=e.geometry,this.textureSet=e.textureSet,this.rendererMesh=null,this.color=e.color||c([1,1,1]),this.metallic=null!=e.metallic?e.metallic:0,this.roughness=null!=e.roughness?e.roughness:1,this.opacity=null!=e.opacity?e.opacity:1}return S(e,[{key:"color",get:function(){return A(this,et)[et]},set:function(e){var t=A(this,et)[et];t||((t=A(this,et)[et]=new Float32Array(4))[3]=1),e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.rendererMesh&&this.rendererMesh.setColor(A(this,et)[et])}},{key:"matrix",get:function(){return A(this,tt)[tt]},set:function(e){e?A(this,tt)[tt].set(e):p(A(this,tt)[tt]),this.rendererMesh&&this.rendererMesh.setMatrix(A(this,tt)[tt]),this.object&&this.object.setAABBDirty()}},{key:"metallic",get:function(){return A(this,rt)[rt]},set:function(e){e=null!=e?e:1,A(this,rt)[rt]!==e&&(A(this,rt)[rt]=e,this.rendererMesh&&this.rendererMesh.setMetallic(A(this,rt)[rt]))}},{key:"roughness",get:function(){return A(this,nt)[nt]},set:function(e){e=null!=e?e:1,A(this,nt)[nt]!==e&&(A(this,nt)[nt]=e,this.rendererMesh&&this.rendererMesh.setRoughness(A(this,nt)[nt]))}},{key:"opacity",get:function(){return A(this,ot)[ot]},set:function(e){e=null!=e?e:1,A(this,ot)[ot]!==e&&(A(this,ot)[ot]=e)}}]),e}(),st=[],at=[],ct=[],ut=[],lt=[],dt=0,ft=new Uint16Array(3),ht=new Uint16Array(3),pt=new Uint16Array(3),gt=c(),mt=c(),yt=c(),vt=c(),wt=c(),bt=c(),xt=c(),St=null;function Tt(e,t){for(var r,n=0;n<3;n++)if(0!=(r=St[3*e+n]-St[3*t+n]))return r;return 0}var Mt=null,kt=null;function _t(e,t){var r,n,o,i,s,a,c=3*e,u=3*t,l=Math.min(r=kt[c],n=kt[c+1],o=kt[c+2]),d=Math.min(i=kt[u],s=kt[u+1],a=kt[u+2]);if(l!=d)return l-d;var f=Math.max(r,n,o),h=Math.max(i,s,a);return f!=h?f-h:0}function jt(e){var t=u(),r=We();Ne(r,e.positions);var n,o=b(e.positions,r,t),i=e.primitive!==Re&&e.primitive!==De&&e.primitive!==Ue||!e.indices?null:function(e,t,r,n){!function(e,t){var r,n,o,i,s,a,c={},u=Math.pow(10,4),l=0;for(s=0,a=e.length;s<a;s+=3)r=e[s],n=e[s+1],o=e[s+2],void 0===c[i=Math.round(r*u)+"_"+Math.round(n*u)+"_"+Math.round(o*u)]&&(c[i]=l/3,st[l++]=r,st[l++]=n,st[l++]=o),at[s/3]=c[i];for(s=0,a=t.length;s<a;s++)ut[s]=at[t[s]],ct[ut[s]]=t[s]}(e,t),function(e,t){dt=0;for(var r=0,n=e;r<n;r+=3){var o=3*ut[r],i=3*ut[r+1],s=3*ut[r+2];t?(ft[0]=st[o],ft[1]=st[o+1],ft[2]=st[o+2],ht[0]=st[i],ht[1]=st[i+1],ht[2]=st[i+2],pt[0]=st[s],pt[1]=st[s+1],pt[2]=st[s+2],v(ft,t,gt),v(ht,t,mt),v(pt,t,yt)):(gt[0]=st[o],gt[1]=st[o+1],gt[2]=st[o+2],mt[0]=st[i],mt[1]=st[i+1],mt[2]=st[i+2],yt[0]=st[s],yt[1]=st[s+1],yt[2]=st[s+2]),l(yt,mt,vt),l(gt,mt,wt),m(vt,wt,bt),y(bt,xt);var a=lt[dt]||(lt[dt]={normal:c()});a.normal[0]=xt[0],a.normal[1]=xt[1],a.normal[2]=xt[2],dt++}}(t.length,r);for(var o,i,a,u,d,f,h,p,w=[],b=Math.cos(10*s),x={},S=!1,T=0,M=t.length;T<M;T+=3)for(var k=T/3,_=0;_<3;_++)o=ut[T+_],i=ut[T+(_+1)%3],void 0===x[d=(a=Math.min(o,i))+","+(u=Math.max(o,i))]?x[d]={index1:a,index2:u,face1:k,face2:void 0}:x[d].face2=k;for(d in x)void 0!==(f=x[d]).face2&&g(lt[f.face1].normal,lt[f.face2].normal)>b||(h=ct[f.index1],p=ct[f.index2],(!S&&h>65535||p>65535)&&(S=!0),w.push(h),w.push(p));return S?new Uint32Array(w):new Uint16Array(w)}(o,e.indices,t),a=function(e){var t=e.positionsCompressed,r=e.indices,n=e.edgeIndices;!function(e){if(!(null!==Mt&&Mt.length>=e)){Mt=new Uint32Array(e);for(var t=0;t<e;t++)Mt[t]=t}}(t.length/3);var o=Mt.slice(0,t.length/3),i=Mt.slice(0,t.length/3);St=t,o.sort(Tt);var s=0;i[o[0]]=0;for(var a=1,c=o.length;a<c;a++)0!=Tt(o[a],o[a-1])&&s++,i[o[a]]=s;var u=new Uint16Array(3*(s+1));u[3*(s=0)+0]=t[3*o[0]+0],u[3*s+1]=t[3*o[0]+1],u[3*s+2]=t[3*o[0]+2];for(var l=1,d=o.length;l<d;l++)0!==Tt(o[l],o[l-1])&&(u[3*++s+0]=t[3*o[l]+0],u[3*s+1]=t[3*o[l]+1],u[3*s+2]=t[3*o[l]+2]),i[o[l]]=s;St=null;for(var f,h=new Uint32Array(r.length),p=0,g=r.length;p<g;p++)h[p]=i[r[p]];if(n){f=new Uint32Array(n.length);for(var m=0,y=n.length;m<y;m++)f[m]=i[n[m]]}return[u,h,f]}({positionsCompressed:o,uvs:e.uvs,indices:e.indices,edgeIndices:i}),d=function(e,t,r){void 0===r&&(r=!1);var n=e.positionsCompressed||[],o=function(e,t){for(var r=new Int32Array(e.length/3),n=0,o=r.length;n<o;n++)r[n]=n;kt=new Int32Array(e.length);for(var i=0,s=e.length;i<s;i++)kt[i]=e[i]>>t;r.sort(_t);for(var a=new Int32Array(e.length),c=0,u=r.length;c<u;c++)a[3*c+0]=e[3*r[c]+0],a[3*c+1]=e[3*r[c]+1],a[3*c+2]=e[3*r[c]+2];return a}(e.indices||[],t),i=[];function s(e,t){if(e>t){var r=e;e=t,t=r}function n(r,n){return r!=e?e-r:n!=t?t-n:0}for(var o=0,s=(i.length>>1)-1;o<=s;){var a=s+o>>1,c=n(i[2*a],i[2*a+1]);if(c>0)o=a+1;else{if(!(c<0))return a;s=a-1}}return-o-1}var a=new Int32Array(i.length/2);a.fill(0);var c=n.length/3;if(c>8*(1<<t))return[e];var u=new Int32Array(c);u.fill(-1);var l=[];function d(){u.fill(-1);var e={positionsCompressed:[],indices:[],edgeIndices:[],maxNumPositions:(1<<t)-t,numPositions:0,bucketNumber:l.length};return l.push(e),e}for(var f=d(),h=0,p=o.length;h<p;h+=3){var g=0,m=o[h],y=o[h+1],v=o[h+2];if(-1==u[m]&&g++,-1==u[y]&&g++,-1==u[v]&&g++,g+f.numPositions>f.maxNumPositions&&(f=d()),f.bucketNumber>8)return[e];-1==u[m]&&(u[m]=f.numPositions++,f.positionsCompressed.push(n[3*m]),f.positionsCompressed.push(n[3*m+1]),f.positionsCompressed.push(n[3*m+2])),-1==u[y]&&(u[y]=f.numPositions++,f.positionsCompressed.push(n[3*y]),f.positionsCompressed.push(n[3*y+1]),f.positionsCompressed.push(n[3*y+2])),-1==u[v]&&(u[v]=f.numPositions++,f.positionsCompressed.push(n[3*v]),f.positionsCompressed.push(n[3*v+1]),f.positionsCompressed.push(n[3*v+2])),f.indices.push(u[m]),f.indices.push(u[y]),f.indices.push(u[v]);var w=void 0;(w=s(m,y))>=0&&0==a[w]&&(a[w]=1,f.edgeIndices.push(u[i[2*w]]),f.edgeIndices.push(u[i[2*w+1]])),(w=s(m,v))>=0&&0==a[w]&&(a[w]=1,f.edgeIndices.push(u[i[2*w]]),f.edgeIndices.push(u[i[2*w+1]])),(w=s(y,v))>=0&&0==a[w]&&(a[w]=1,f.edgeIndices.push(u[i[2*w]]),f.edgeIndices.push(u[i[2*w+1]]))}var b=t/8,x=2*n.length+(o.length+i.length)*(t/8*2),S=0;return l.forEach(function(e){S+=2*e.positionsCompressed.length+(e.indices.length+e.edgeIndices.length)*b}),S>x?[e]:(r&&function(e,t){var r={};e.forEach(function(e){for(var t=e.indices,n=e.edgeIndices,o=e.positionsCompressed,i=0,s=t.length;i<s;i+=3)r[o[3*t[i]]+"_"+o[3*t[i]+1]+"_"+o[3*t[i]+2]+"/"+o[3*t[i+1]]+"_"+o[3*t[i+1]+1]+"_"+o[3*t[i+1]+2]+"/"+o[3*t[i+2]]+"_"+o[3*t[i+2]+1]+"_"+o[3*t[i+2]+2]]=!0;for(i=0,s=n.length;i<s;i+=2);});for(var n=t.indices,o=t.positionsCompressed,i=0,s=n.length;i<s;i+=3){var a=o[3*n[i]]+"_"+o[3*n[i]+1]+"_"+o[3*n[i]+2]+"/"+o[3*n[i+1]]+"_"+o[3*n[i+1]+1]+"_"+o[3*n[i+1]+2]+"/"+o[3*n[i+2]]+"_"+o[3*n[i+2]+1]+"_"+o[3*n[i+2]+2];if(!(a in r))throw console.log("Not found "+a),"Ohhhh!"}}(l,e),l)}({positionsCompressed:n=a[0],indices:a[1],edgeIndices:a[2]},n.length/3>65536?16:8);return{id:e.id,primitive:e.primitive===Re&&d.length>1?Ue:e.primitive,aabb:r,positionsDecompressMatrix:t,uvsDecompressMatrix:void 0,geometryBuckets:d}}const At=e=>"function"==typeof e,Bt=e=>null!==e&&"object"==typeof e,It=e=>Bt(e)&&e.constructor==={}.constructor,Et=e=>e&&"function"==typeof e[Symbol.iterator],Ct=e=>e&&"function"==typeof e[Symbol.asyncIterator],Pt=e=>"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,Lt=e=>"undefined"!=typeof Blob&&e instanceof Blob,Ot=e=>e&&"object"==typeof e&&e.isBuffer,Ft=e=>(e=>"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||Bt(e)&&At(e.tee)&&At(e.cancel)&&At(e.getReader))(e)||(e=>Bt(e)&&At(e.read)&&At(e.pipe)&&(e=>"boolean"==typeof e)(e.readable))(e),Ut=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Rt=/^([-\w.]+\/[-\w.+]+)/;function Dt(e){const t=Rt.exec(e);return t?t[1]:e}function Gt(e){const t=Ut.exec(e);return t?t[1]:""}const Wt=/\?.*/;function Nt(e){if(Pt(e)){const t=Ht(e.url||"");return{url:t,type:Dt(e.headers.get("content-type")||"")||Gt(t)}}return Lt(e)?{url:Ht(e.name||""),type:e.type||""}:"string"==typeof e?{url:Ht(e),type:Gt(e)}:{url:"",type:""}}function Ht(e){return e.replace(Wt,"")}async function Vt(e){if(Pt(e))return e;const t={},r=function(e){return Pt(e)?e.headers["content-length"]||-1:Lt(e)?e.size:"string"==typeof e?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}(e);r>=0&&(t["content-length"]=String(r));const{url:n,type:o}=Nt(e);o&&(t["content-type"]=o);const i=await async function(e){if("string"==typeof e)return"data:,".concat(e.slice(0,5));if(e instanceof Blob){const t=e.slice(0,5);return await new Promise(e=>{const r=new FileReader;r.onload=t=>{var r;return e(null==t||null===(r=t.target)||void 0===r?void 0:r.result)},r.readAsDataURL(t)})}if(e instanceof ArrayBuffer){const t=function(e){let t="";const r=new Uint8Array(e);for(let e=0;e<r.byteLength;e++)t+=String.fromCharCode(r[e]);return btoa(t)}(e.slice(0,5));return"data:base64,".concat(t)}return null}(e);i&&(t["x-first-bytes"]=i),"string"==typeof e&&(e=(new TextEncoder).encode(e));const s=new Response(e,{headers:t});return Object.defineProperty(s,"url",{value:n}),s}async function Qt(e,t){if("string"==typeof e){e=le(e);let r=t;return null!=t&&t.fetch&&"function"!=typeof(null==t?void 0:t.fetch)&&(r=t.fetch),await fetch(e,r)}return await Vt(e)}function Jt(){return!("object"==typeof process&&"[object process]"===String(process)&&!process.browser)||function(e){if("undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"==typeof process.versions&&Boolean(process.versions.electron))return!0;const t="object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}()}const zt={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document,process:"object"==typeof process&&process},qt=zt.window||zt.self||zt.global,Kt=zt.process||{},Yt="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source";Jt();class Xt{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";R(this,"storage",void 0),R(this,"id",void 0),R(this,"config",void 0),this.storage=function(e){try{const t=window[e],r="__storage_test__";return t.setItem(r,r),t.removeItem(r),t}catch(e){return null}}(r),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function $t(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600;const o=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>n&&(r=Math.min(r,n/e.width));const i=e.width*r,s=e.height*r,a=["font-size:1px;","padding:".concat(Math.floor(s/2),"px ").concat(Math.floor(i/2),"px;"),"line-height:".concat(s,"px;"),"background:url(".concat(o,");"),"background-size:".concat(i,"px ").concat(s,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),a]}let Zt;function er(e){return"string"==typeof e?Zt[e.toUpperCase()]||Zt.WHITE:e}function tr(e,t){if(!e)throw new Error(t||"Assertion failed")}function rr(){let e;var t,r;if(Jt&&"performance"in qt)e=null==qt||null===(t=qt.performance)||void 0===t||null===(r=t.now)||void 0===r?void 0:r.call(t);else if("hrtime"in Kt){var n;const t=null==Kt||null===(n=Kt.hrtime)||void 0===n?void 0:n.call(Kt);e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}!function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"}(Zt||(Zt={}));const nr={debug:Jt&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},or={enabled:!0,level:0};function ir(){}const sr={},ar={once:!0};class cr{constructor(){let{id:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:""};R(this,"id",void 0),R(this,"VERSION",Yt),R(this,"_startTs",rr()),R(this,"_deltaTs",rr()),R(this,"_storage",void 0),R(this,"userData",{}),R(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new Xt("__probe-".concat(this.id,"__"),or),this.timeStamp("".concat(this.id," started")),function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"];const r=Object.getPrototypeOf(e),n=Object.getOwnPropertyNames(r);for(const r of n)"function"==typeof e[r]&&(t.find(e=>r===e)||(e[r]=e[r].bind(e)))}(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((rr()-this._startTs).toPrecision(10))}getDelta(){return Number((rr()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){return this._storage.setConfiguration({enabled:!(arguments.length>0&&void 0!==arguments[0])||arguments[0]}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){tr(e,t)}warn(e){return this._getLogFunction(0,e,nr.warn,arguments,ar)}error(e){return this._getLogFunction(0,e,nr.error,arguments)}deprecated(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}removed(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}probe(e,t){return this._getLogFunction(e,t,nr.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,nr.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),o=2;o<r;o++)n[o-2]=arguments[o];return this._getLogFunction(e,t,nr.debug||nr.info,arguments,ar)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||ir,r&&[r],{tag:dr(t)}):ir}image(e){let{logLevel:t,priority:r,image:n,message:o="",scale:i=1}=e;return this._shouldLog(t||r)?Jt?function(e){let{image:t,message:r="",scale:n=1}=e;if("string"==typeof t){const e=new Image;return e.onload=()=>{const t=$t(e,r,n);console.log(...t)},e.src=t,ir}const o=t.nodeName||"";if("img"===o.toLowerCase())return console.log(...$t(t,r,n)),ir;if("canvas"===o.toLowerCase()){const e=new Image;return e.onload=()=>console.log(...$t(e,r,n)),e.src=t.toDataURL(),ir}return ir}({image:n,message:o,scale:i}):(console.warn("removed"),ir):ir}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||ir)}group(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1};const n=lr({logLevel:e,message:t,opts:r}),{collapsed:o}=r;return n.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,t){return this.group(e,t,Object.assign({},arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||ir)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=ur(e)}_getLogFunction(e,t,r,n,o){if(this._shouldLog(e)){o=lr({logLevel:e,message:t,args:n,opts:o}),tr(r=r||o.method),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=rr();const i=o.tag||o.message;if(o.once){if(sr[i])return ir;sr[i]=rr()}return t=function(e,t,r){if("string"==typeof t){const s=r.time?function(e){const t=Math.max((arguments.length>1&&void 0!==arguments[1]?arguments[1]:8)-e.length,0);return"".concat(" ".repeat(t)).concat(e)}(function(e){let t;return t=e<10?"".concat(e.toFixed(2),"ms"):e<100?"".concat(e.toFixed(1),"ms"):e<1e3?"".concat(e.toFixed(0),"ms"):"".concat((e/1e3).toFixed(2),"s"),t}(r.total)):"";n=t=r.time?"".concat(e,": ").concat(s,"  ").concat(t):"".concat(e,": ").concat(t),o=r.color,i=r.background,Jt||"string"!=typeof n||(o&&(o=er(o),n="[".concat(o,"m").concat(n,"[39m")),i&&(o=er(i),n="[".concat(i+10,"m").concat(n,"[49m"))),t=n}var n,o,i;return t}(this.id,o.message,o),r.bind(console,t,...o.args)}return ir}}function ur(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return tr(Number.isFinite(t)&&t>=0),t}function lr(e){const{logLevel:t,message:r}=e;e.logLevel=ur(t);const n=e.args?Array.from(e.args):[];for(;n.length&&n.shift()!==r;);switch(typeof t){case"string":case"function":void 0!==r&&n.unshift(r),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());const o=typeof e.message;return tr("string"===o||"object"===o),Object.assign(e,{args:n},e.opts)}function dr(e){for(const t in e)for(const r in e[t])return r||"untitled";return"empty"}R(cr,"VERSION",Yt);const fr=new cr({id:"loaders.gl"});class hr{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}const pr={fetch:null,mimeType:void 0,nothrow:!1,log:new class{constructor(){R(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.log.bind(this.console,...t)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.info.bind(this.console,...t)}warn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.warn.bind(this.console,...t)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.error.bind(this.console,...t)}},CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:I,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},gr={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function mr(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state=e._state||{},e._state}const yr=()=>{const e=mr();return e.globalOptions=e.globalOptions||{...pr},e.globalOptions};function vr(e,t){const r=yr(),n=e||r;return"function"==typeof n.fetch?n.fetch:Bt(n.fetch)?e=>Qt(e,n):null!=t&&t.fetch?null==t?void 0:t.fetch:Qt}function wr(e,t,r,n,o){const i=t||"Top level",s=t?"".concat(t,"."):"";for(const a in e){const c=!t&&Bt(e[a]);if(!(a in r)&&("baseUri"!==a||t)&&("workerUrl"!==a||!t))if(a in n)fr.warn("".concat(i," loader option '").concat(s).concat(a,"' no longer supported, use '").concat(n[a],"'"))();else if(!c){const e=br(a,o);fr.warn("".concat(i," loader option '").concat(s).concat(a,"' not recognized. ").concat(e))()}}}function br(e,t){const r=e.toLowerCase();let n="";for(const o of t)for(const t in o.options){if(e===t)return"Did you mean '".concat(o.id,".").concat(t,"'?");const i=t.toLowerCase();(r.startsWith(i)||i.startsWith(r))&&(n=n||"Did you mean '".concat(o.id,".").concat(t,"'?"))}return n}function xr(e,t){for(const r in t)r in t&&(e[r]=It(t[r])&&It(e[r])?{...e[r],...t[r]}:t[r])}function Sr(e){var t;return!!e&&(Array.isArray(e)&&(e=e[0]),Array.isArray(null===(t=e)||void 0===t?void 0:t.extensions))}function Tr(e){var t,r;let n;return B(e,"null loader"),B(Sr(e),"invalid loader"),Array.isArray(e)&&(n=e[1],e=e[0],e={...e,options:{...e.options,...n}}),(null!==(t=e)&&void 0!==t&&t.parseTextSync||null!==(r=e)&&void 0!==r&&r.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}const Mr=()=>{const e=mr();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry},kr=new cr({id:"loaders.gl"}),_r=/\.([^.]+)$/;function jr(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!Ar(e))return null;if(t&&!Array.isArray(t))return Tr(t);let o=[];t&&(o=o.concat(t)),null!=r&&r.ignoreRegisteredLoaders||o.push(...Mr()),function(e){for(const t of e)Tr(t)}(o);const i=function(e,t,r,n){const{url:o,type:i}=Nt(e),s=o||(null==n?void 0:n.url);let a=null,c="";var u;return null!=r&&r.mimeType&&(a=Ir(t,null==r?void 0:r.mimeType),c="match forced by supplied MIME type ".concat(null==r?void 0:r.mimeType)),a=a||function(e,t){const r=t&&_r.exec(t),n=r&&r[1];return n?function(e,t){t=t.toLowerCase();for(const r of e)for(const e of r.extensions)if(e.toLowerCase()===t)return r;return null}(e,n):null}(t,s),c=c||(a?"matched url ".concat(s):""),a=a||Ir(t,i),c=c||(a?"matched MIME type ".concat(i):""),a=a||function(e,t){if(!t)return null;for(const r of e)if("string"==typeof t){if(Er(t,r))return r}else if(ArrayBuffer.isView(t)){if(Cr(t.buffer,t.byteOffset,r))return r}else if(t instanceof ArrayBuffer&&Cr(t,0,r))return r;return null}(t,e),c=c||(a?"matched initial data ".concat(Pr(e)):""),a=a||Ir(t,null==r?void 0:r.fallbackMimeType),c=c||(a?"matched fallback MIME type ".concat(i):""),c&&kr.log(1,"selectLoader selected ".concat(null===(u=a)||void 0===u?void 0:u.name,": ").concat(c,".")),a}(e,o,r,n);if(!(i||null!=r&&r.nothrow))throw new Error(Br(e));return i}function Ar(e){return!(e instanceof Response&&204===e.status)}function Br(e){const{url:t,type:r}=Nt(e);let n="No valid loader found (";n+=t?"".concat(function(e){const t=e&&e.lastIndexOf("/");return t>=0?e.substr(t+1):""}(t),", "):"no url provided, ",n+="MIME type: ".concat(r?'"'.concat(r,'"'):"not provided",", ");const o=e?Pr(e):"";return n+=o?' first bytes: "'.concat(o,'"'):"first bytes: not available",n+=")",n}function Ir(e,t){for(const r of e){if(r.mimeTypes&&r.mimeTypes.includes(t))return r;if(t==="application/x.".concat(r.id))return r}return null}function Er(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some(t=>e.startsWith(t))}function Cr(e,t,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(n=>function(e,t,r,n){if(n instanceof ArrayBuffer)return function(e,t,r){if(e.byteLength<(r=r||e.byteLength)||t.byteLength<r)return!1;const n=new Uint8Array(e),o=new Uint8Array(t);for(let e=0;e<n.length;++e)if(n[e]!==o[e])return!1;return!0}(n,e,n.byteLength);switch(typeof n){case"function":return n(e,r);case"string":return n===Lr(e,t,n.length);default:return!1}}(e,t,r,n))}function Pr(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return"string"==typeof e?e.slice(0,t):ArrayBuffer.isView(e)?Lr(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?Lr(e,0,t):""}function Lr(e,t,r){if(e.byteLength<t+r)return"";const n=new DataView(e);let o="";for(let e=0;e<r;e++)o+=String.fromCharCode(n.getUint8(t+e));return o}const Or=262144,Fr=262144,Ur=1048576;function Rr(e,t){return I?async function*(e,t){const r=e.getReader();let n;try{for(;;){const e=n||r.read();null!=t&&t._streamReadAhead&&(n=r.read());const{done:o,value:i}=await e;if(o)return;yield de(i)}}catch(e){r.releaseLock()}}(e,t):async function*(e,t){for await(const t of e)yield de(t)}(e)}const Dr="Cannot convert supplied data type";async function Gr(e,t,r,n){E(!n||"object"==typeof n),!t||Array.isArray(t)||Sr(t)||(n=void 0,r=t,t=void 0),e=await e,r=r||{};const{url:o}=Nt(e),i=function(e,t){if(!t&&e&&!Array.isArray(e))return e;let r;if(e&&(r=Array.isArray(e)?e:[e]),t&&t.loaders){const e=Array.isArray(t.loaders)?t.loaders:[t.loaders];r=r?[...r,...e]:e}return r&&r.length?r:null}(t,n),s=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!Ar(e))return null;let o=jr(e,t,{...r,nothrow:!0},n);if(o)return o;if(Lt(e)&&(o=jr(e=await e.slice(0,10).arrayBuffer(),t,r,n)),!(o||null!=r&&r.nothrow))throw new Error(Br(e));return o}(e,i,r);return s?(n=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(r)return r;const n={fetch:vr(t,e),...e};return Array.isArray(n.loaders)||(n.loaders=null),n}({url:o,parse:Gr,loaders:i},r=function(e,t,r,n){return r=r||[],function(e,t){wr(e,null,pr,gr,t);for(const r of t)wr(e&&e[r.id]||{},r.id,r.options&&r.options[r.id]||{},r.deprecatedOptions&&r.deprecatedOptions[r.id]||{},t)}(e,r=Array.isArray(r)?r:[r]),function(e,t,r){const n={...e.options||{}};return function(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}(n,r),null===n.log&&(n.log=new hr),xr(n,yr()),xr(n,t),n}(t,e,n)}(r,s,i,o),n),await async function(e,t,r,n){if(E(e,"no worker provided"),Pt(t)){const e=t,{ok:r,redirected:o,status:i,statusText:s,type:a,url:c}=e,u=Object.fromEntries(e.headers.entries());n.response={headers:u,ok:r,redirected:o,status:i,statusText:s,type:a,url:c}}if(t=await async function(e,t,r){const n=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||n)return function(e,t,r){if(t.text&&"string"==typeof e)return e;if(Ot(e)&&(e=e.buffer),e instanceof ArrayBuffer){const r=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let r=e.buffer;const n=e.byteLength||e.length;return 0===e.byteOffset&&n===r.byteLength||(r=r.slice(e.byteOffset,e.byteOffset+n)),r}throw new Error(Dr)}(e,t);if(Lt(e)&&(e=await Vt(e)),Pt(e)){const r=e;return await async function(e){if(!e.ok){const t=await async function(e){let t="Failed to fetch resource ".concat(e.url," (").concat(e.status,"): ");try{const r=e.headers.get("Content-Type");let n=e.statusText;r.includes("application/json")&&(n+=" ".concat(await e.text())),t+=n,t=t.length>60?"".concat(t.slice(0,60),"..."):t}catch(e){}return t}(e);throw new Error(t)}}(r),t.binary?await r.arrayBuffer():await r.text()}if(Ft(e)&&(e=function(e,t){if("string"==typeof e)return function*(e,t){const r=(null==t?void 0:t.chunkSize)||Or;let n=0;const o=new TextEncoder;for(;n<e.length;){const t=Math.min(e.length-n,r),i=e.slice(n,n+t);n+=t,yield o.encode(i)}}(e,t);if(e instanceof ArrayBuffer)return function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{chunkSize:r=Fr}=t;let n=0;for(;n<e.byteLength;){const t=Math.min(e.byteLength-n,r),o=new ArrayBuffer(t),i=new Uint8Array(e,n,t);new Uint8Array(o).set(i),n+=t,yield o}}(e,t);if(Lt(e))return async function*(e,t){const r=(null==t?void 0:t.chunkSize)||Ur;let n=0;for(;n<e.size;){const t=n+r,o=await e.slice(n,t).arrayBuffer();n=t,yield o}}(e,t);if(Ft(e))return Rr(e,t);if(Pt(e))return Rr(e.body,t);throw new Error("makeIterator")}(e,r)),Et(e)||Ct(e))return async function(e){const t=[];for await(const r of e)t.push(r);return ae(...t)}(e);throw new Error(Dr)}(t,e,r),e.parseTextSync&&"string"==typeof t)return r.dataType="text",e.parseTextSync(t,r,n,e);if(function(e,t){return!!Y.isSupported()&&!!(L||null!=t&&t._nodeWorkers)&&e.worker&&(null==t?void 0:t.worker)}(e,r))return await ie(e,t,r,n,Gr);if(e.parseText&&"string"==typeof t)return await e.parseText(t,r,n,e);if(e.parse)return await e.parse(t,r,n,e);throw E(!e.parseSync),new Error("".concat(e.id," loader - no parser found and worker is disabled"))}(s,e,r,n)):null}async function Wr(e,t,r){if(function(e,t){return!!Y.isSupported()&&!!(I||null!=t&&t._nodeWorkers)&&e.worker&&(null==t?void 0:t.worker)}(t,r={...yr(),...r}))return await ee(t,e,r);if(t.encode)return await t.encode(e,r);if(t.encodeSync)return t.encodeSync(e,r);if(t.encodeText)return(new TextEncoder).encode(await t.encodeText(e,r));if(t.encodeInBatches){const n=function(e,t,r){if(t.encodeInBatches){const n=function(e){return[{table:e,start:0,end:e.length}]}(e);return t.encodeInBatches(n,r)}throw new Error("Writer could not encode data in batches")}(e,t,r),o=[];for await(const e of n)o.push(e);return ae(...o)}if(!I&&t.encodeURLtoURL){const n=Nr("input");await async function(e,t,r){e=le(e),I||await(void 0)(e,t,{flag:"w"}),B(!1)}(n,e);const o=Nr("output"),i=await async function(e,t,r,n){if(e=le(e),t=le(t),I||!r.encodeURLtoURL)throw new Error;return await r.encodeURLtoURL(e,t,n)}(n,o,t,r);return(await Qt(i)).arrayBuffer()}throw new Error("Writer could not encode data")}function Nr(e){return"/tmp/".concat(e)}var Hr={0:{useSRGB:!0,qualityLevel:50,encodeUASTC:!0,mipmaps:!0},3:{useSRGB:!0,encodeUASTC:!0,qualityLevel:10,mipmaps:!1},1:{useSRGB:!1,encodeUASTC:!0,qualityLevel:50,mipmaps:!0},2:{useSRGB:!1,encodeUASTC:!0,qualityLevel:10,mipmaps:!1},4:{useSRGB:!1,encodeUASTC:!0,qualityLevel:10,mipmaps:!1}},Vr=/*#__PURE__*/j("texturesList"),Qr=/*#__PURE__*/j("numObjects"),Jr=/*#__PURE__*/j("meshUsedByObject"),zr=/*#__PURE__*/j("removeUnusedTextures"),qr=/*#__PURE__*/j("compressTextures"),Kr=/*#__PURE__*/function(r){function n(e,n){var o;return o=r.call(this,e,{id:n.id})||this,Object.defineProperty(k(o),qr,{value:Xr}),Object.defineProperty(k(o),zr,{value:Yr}),o.scene=void 0,o.layerId=void 0,o.built=void 0,o.edgeThreshold=void 0,o.geometries=void 0,o.textures=void 0,o.textureSets=void 0,o.meshes=void 0,o.objects=void 0,o.aabb=void 0,o.onBuilt=void 0,o.rendererModel=void 0,Object.defineProperty(k(o),Vr,{writable:!0,value:void 0}),Object.defineProperty(k(o),Qr,{writable:!0,value:void 0}),Object.defineProperty(k(o),Jr,{writable:!0,value:void 0}),o.scene=e,o.onBuilt=new t(new a),o.onDestroyed=new t(new a),A(k(o),Qr)[Qr]=0,A(k(o),Jr)[Jr]={},o.id=n.id||"default",o.layerId=n.layerId,o.edgeThreshold=10,o.geometries={},o.textures={},A(k(o),Vr)[Vr]=[],o.textureSets={},o.meshes={},o.objects={},o.aabb=Ge(),o.built=!1,o.rendererModel=null,o.fromJSON(n),o}T(n,r);var o=n.prototype;return o.fromJSON=function(t){if(this.destroyed)return new e("Failed to add components to SceneModel - SceneModel already destroyed");if(this.built)return new e("Failed to add components to SceneModel - SceneModel already built");if(t.geometries)for(var r=0,n=t.geometries.length;r<n;r++)this.createGeometry(t.geometries[r]);if(t.textures)for(var o=0,i=t.textures.length;o<i;o++)this.createTexture(t.textures[o]);if(t.textureSets)for(var s=0,a=t.textureSets.length;s<a;s++)this.createTextureSet(t.textureSets[s]);if(t.meshes)for(var c=0,u=t.meshes.length;c<u;c++)this.createMesh(t.meshes[c]);if(t.objects)for(var l=0,d=t.objects.length;l<d;l++)this.createObject(t.objects[l])},o.createTransform=function(t){return this.destroyed?new e("Failed to create Transform in SceneModel - SceneModel already destroyed"):this.built?new e("Failed to create Transform in SceneModel - SceneModel already built"):void 0},o.createTexture=function(t){if(this.destroyed)return new e("Failed to create Texture in SceneModel - SceneModel already destroyed");if(this.built)return new e("Failed to create Texture in SceneModel - SceneModel already built");if(!t.imageData&&!t.src&&!t.buffers)return new e("Failed to create Texture in SceneModel - Parameter expected: textureParams.imageData, textureParams.src or textureParams.buffers");if(this.textures[t.id])return new e("Failed to create Texture in SceneModel - Texture already exists with this ID: "+t.id);t.src&&t.src.split(".").pop();var r=new Ze(t);return this.textures[t.id]=r,A(this,Vr)[Vr].push(r),r},o.createTextureSet=function(t){if(this.destroyed)return new e("Failed to create TextureSet in SceneModel - SceneModel already destroyed");if(this.built)return new e("Failed to create TextureSet in SceneModel - SceneModel already built");if(this.textureSets[t.id])return new e("Failed to create TextureSet in SceneModel - TextureSet already exists with this ID: "+t.id);var r,n,o,i,s;if(null!=t.colorTextureId){if(!(r=this.textures[t.colorTextureId]))return new e("Failed to create TextureSet in SceneModel - Texture not found: "+t.colorTextureId+" - ensure that you create it first with createTexture()");r.channel=0}if(null!=t.metallicRoughnessTextureId){if(!(n=this.textures[t.metallicRoughnessTextureId]))return new e("Failed to create TextureSet in SceneModel - Texture not found: "+t.metallicRoughnessTextureId+" - ensure that you create it first with createTexture()");n.channel=1}if(null!=t.normalsTextureId){if(!(o=this.textures[t.normalsTextureId]))return new e("Failed to create TextureSet in SceneModel - Texture not found: "+t.normalsTextureId+" - ensure that you create it first with createTexture()");o.channel=2}if(null!=t.emissiveTextureId){if(!(i=this.textures[t.emissiveTextureId]))return new e("Failed to create TextureSet in SceneModel - Texture not found: "+t.emissiveTextureId+" - ensure that you create it first with createTexture()");i.channel=3}if(null!=t.occlusionTextureId){if(!(s=this.textures[t.occlusionTextureId]))return new e("Failed to create TextureSet in SceneModel - Texture not found: "+t.occlusionTextureId+" - ensure that you create it first with createTexture()");s.channel=4}var a=new $e(t,{emissiveTexture:i,occlusionTexture:s,metallicRoughnessTexture:n,colorTexture:r});return this.textureSets[t.id]=a,a},o.createGeometry=function(t){if(this.destroyed)return new e("Failed to create Geometry in SceneModel - SceneModel already destroyed");if(this.built)return new e("Failed to create Geometry in SceneModel - SceneModel already built");if(!t)return new e("Failed to create Geometry in SceneModel - Parameters expected: geometryParams");if(null==t.id)return new e("Failed to create Geometry in SceneModel - Parameter expected: geometryParams.id");var r=t.id;if(this.geometries[r])return new e("Failed to create Geometry in SceneModel - Geometry with this ID already created: "+r);var n=t.primitive;if(n!==Oe&&n!==Fe&&n!==Ue&&n!==Re&&n!==De)return new e("Failed to create Geometry in SceneModel - Unsupported value for geometryParams.primitive: '"+n+"' - supported values are PointsPrimitive, LinesPrimitive, TrianglesPrimitive, SolidPrimitive and SurfacePrimitive");if(!t.positions)return new e("Failed to create Geometry in SceneModel - Param expected: geometryParams.positions");if(!t.indices&&n!==Oe)return new e("Failed to create Geometry in SceneModel - Param expected: geometryParams.indices (required for primitive type)");if(t.uvs&&t.uvs.length/2!=t.positions.length/3)return new e("Failed to create Geometry in SceneModel - mismatch between given quantities of vertex positions and UVs");if(t.indices)for(var o=t.positions.length/3,i=0,s=t.indices.length;i<s;i++){var a=t.indices[i];if(a<0||a>=o)return new e("Failed to create Geometry in SceneModel - indices out of range of vertex positions");if(t.uvs&&(a<0||a>=t.uvs.length/2))return new e("Failed to create Geometry in SceneModel - indices out of range of vertex UVs")}var c=new Ve(jt(t));return this.geometries[r]=c,c},o.createGeometryCompressed=function(t){if(this.destroyed)return new e("Failed to add compressed Geometry to SceneModel - SceneModel already destroyed");if(this.built)return new e("Failed to add compressed Geometry to SceneModel - SceneModel already built");if(!t)return new e("Failed to add compressed Geometry to SceneModel - Parameters expected: geometryCompressedParams");var r=t.id;if(this.geometries[r])return new e("Failed to add compressed Geometry to SceneModel - Geometry with this ID already created: "+r);var n=t.primitive;if(n!==Oe&&n!==Fe&&n!==Ue&&n!==Re&&n!==De)return new e("Failed to add compressed Geometry to SceneModel - Unsupported value for geometryCompressedParams.primitive: '"+n+"' - supported values are PointsPrimitive, LinesPrimitive, TrianglesPrimitive, SolidPrimitive and SurfacePrimitive");var o=new Ve(t);return this.geometries[r]=o,o},o.createMesh=function(t){if(this.destroyed)return new e("Failed to create Mesh in SceneModel - SceneModel already destroyed");if(this.built)return new e("Failed to create Mesh in SceneModel - SceneModel already built");if(this.meshes[t.id])return new e("Failed to create Mesh in SceneModel - Mesh already exists with this ID: "+t.id);var r=this.geometries[t.geometryId];if(!r)return new e("Failed to create Mesh in SceneModel - Geometry not found: "+t.geometryId);var n=t.textureSetId?this.textureSets[t.textureSetId]:void 0;if(t.textureSetId&&!n)return new e("Failed to create Mesh in SceneModel - TextureSet not found: "+t.textureSetId);var o=new it({id:t.id,geometry:r,textureSet:n,matrix:t.matrix,color:t.color,opacity:t.opacity,roughness:t.roughness,metallic:t.metallic});return this.meshes[t.id]=o,o},o.createObject=function(t){if(this.destroyed)return new e("Failed to create SceneObject - SceneModel already destroyed");if(this.built)return new e("Failed to create SceneObject SceneModel already built");if(0===t.meshIds.length)return new e("Failed to create SceneObject - no meshes specified");if(this.scene.objects[t.id])return new e("Failed to create SceneObject - SceneObject already exists in Scene: "+t.id);for(var r=t.meshIds,n=[],o=0,i=r.length;o<i;o++){var s=r[o],a=this.meshes[s];if(!a)return new e("Failed to create SceneObject - Mesh not found: "+s);if(A(this,Jr)[Jr][s])return new e("Failed to create SceneObject - Mesh "+s+" already belongs to another SceneObject");n.push(a),A(this,Jr)[Jr][a.id]=!0}for(var c=new Xe({id:t.id,layerId:t.layerId||this.layerId,model:this,meshes:n}),u=0,l=n.length;u<l;u++)n[u].object=c;return A(this,Qr)[Qr]++,this.objects[t.id]=c,c},o.build=function(){try{var t=this;return Promise.resolve(new Promise(function(r){if(t.destroyed)throw new e("Failed to build SceneModel - SceneModel already destroyed");if(t.built)throw new e("Failed to build SceneModel - SceneModel already built");A(t,zr)[zr](),A(t,qr)[qr]().then(function(){t.built=!0,t.onBuilt.dispatch(t,null),r(t)}).catch(function(e){throw e})}))}catch(e){return Promise.reject(e)}},n}(r);function Yr(){}function Xr(){var t=this,r=A(this,Vr)[Vr].length;return new Promise(function(n){if(0!==r)for(var o=function(){var o=A(t,Vr)[Vr][i],s=Hr[o.channel]||{};if(o.src){var a=o.src;switch(a.split(".").pop()){case"jpeg":case"jpg":case"png":(async function(e,t,r,n){Array.isArray(t)||Sr(t)||(r=t,t=void 0);const o=vr(r);let i=e;return"string"==typeof e&&(i=await o(e)),Lt(e)&&(i=await o(e)),await Gr(i,t,r)})(a,Pe,{image:{type:"data"}}).then(function(t){o.compressed?Wr(t,me,s).then(function(e){var t=new Uint8Array(e);o.imageData=t,--r<=0&&n()}).catch(function(t){return new e("Failed to compress texture: "+t)}):(o.imageData=new Uint8Array(1),--r<=0&&n())}).catch(function(t){return new e("Failed to load texture image: "+t)});break;default:--r<=0&&n()}}o.imageData&&(o.compressed?Wr(o.imageData,me,s).then(function(e){o.imageData=new Uint8Array(e),--r<=0&&n()}).catch(function(t){return new e("Failed to compress texture: "+t)}):(o.imageData=new Uint8Array(1),--r<=0&&n()))},i=0,s=A(t,Vr)[Vr].length;i<s;i++)o();else n()})}var $r=/*#__PURE__*/j("onModelBuilts"),Zr=/*#__PURE__*/j("onModelDestroys"),en=/*#__PURE__*/j("center"),tn=/*#__PURE__*/j("aabbDirty"),rn=/*#__PURE__*/j("aabb"),nn=/*#__PURE__*/j("registerObjects"),on=/*#__PURE__*/j("deregisterObjects"),sn=/*#__PURE__*/function(r){function n(){var e;return e=r.call(this,null,{})||this,Object.defineProperty(k(e),on,{value:cn}),Object.defineProperty(k(e),nn,{value:an}),e.models=void 0,e.objects=void 0,e.onModelCreated=void 0,e.onModelDestroyed=void 0,Object.defineProperty(k(e),$r,{writable:!0,value:void 0}),Object.defineProperty(k(e),Zr,{writable:!0,value:void 0}),Object.defineProperty(k(e),en,{writable:!0,value:void 0}),Object.defineProperty(k(e),tn,{writable:!0,value:void 0}),Object.defineProperty(k(e),rn,{writable:!0,value:void 0}),A(k(e),rn)[rn]=Ge(),A(k(e),tn)[tn]=!0,e.models={},e.objects={},A(k(e),$r)[$r]={},A(k(e),Zr)[Zr]={},e.onModelCreated=new t(new a),e.onModelDestroyed=new t(new a),e}T(n,r);var s=n.prototype;return s.createModel=function(t){var r=this;if(this.destroyed)return new e("Scene already destroyed");var n=t.id;if(this.models[n])return new e("SceneModel already created in this Scene: "+n);var o=new Kr(this,t);return this.models[n]=o,o.onDestroyed.one(function(){delete r.models[o.id],A(r,on)[on](o),r.onModelDestroyed.dispatch(r,o)}),o.onBuilt.one(function(){A(r,nn)[nn](o),r.onModelCreated.dispatch(r,o)}),o},s.setAABBDirty=function(){A(this,tn)[tn]||(A(this,tn)[tn]=!0)},s.clear=function(){if(this.destroyed)return new e("Scene already destroyed");for(var t in this.models)this.models[t].destroy()},s.destroy=function(){this.clear(),this.onModelCreated.clear(),this.onModelDestroyed.clear(),r.prototype.destroy.call(this)},S(n,[{key:"center",get:function(){if(A(this,tn)[tn]){var e=this.aabb;A(this,en)[en][0]=(e[0]+e[3])/2,A(this,en)[en][1]=(e[1]+e[4])/2,A(this,en)[en][2]=(e[2]+e[5])/2}return A(this,en)[en]}},{key:"aabb",get:function(){if(A(this,tn)[tn]){var e,t=o,r=o,n=o,s=i,a=i,c=i,u=this.objects,l=!1;for(var d in u)u.hasOwnProperty(d)&&((e=u[d].aabb)[0]<t&&(t=e[0]),e[1]<r&&(r=e[1]),e[2]<n&&(n=e[2]),e[3]>s&&(s=e[3]),e[4]>a&&(a=e[4]),e[5]>c&&(c=e[5]),l=!0);l||(t=-100,r=-100,n=-100,s=100,a=100,c=100),A(this,rn)[rn][0]=t,A(this,rn)[rn][1]=r,A(this,rn)[rn][2]=n,A(this,rn)[rn][3]=s,A(this,rn)[rn][4]=a,A(this,rn)[rn][5]=c,A(this,tn)[tn]=!1}return A(this,rn)[rn]}}]),n}(r);function an(e){var t=e.objects;for(var r in t){var n=t[r];this.objects[n.id]=n}A(this,tn)[tn]=!0}function cn(e){var t=e.objects;for(var r in t)delete this.objects[t[r].id];A(this,tn)[tn]=!0}export{Ve as Geometry,He as GeometryBucket,it as Mesh,sn as Scene,Kr as SceneModel,Xe as SceneObject,Ze as Texture,$e as TextureSet,jt as compressGeometryParams,qe as getSceneObjectGeometry};
//# sourceMappingURL=index.es.map
