!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@xeokit/core"),require("@xeokit/math"),require("strongly-typed-events"),require("@xeokit/matrix"),require("@xeokit/compression")):"function"==typeof define&&define.amd?define(["exports","@xeokit/core","@xeokit/math","strongly-typed-events","@xeokit/matrix","@xeokit/compression"],t):t((e||self).scene={},e.core,e.math,e.stronglyTypedEvents,e.matrix,e.compression)}(this,function(e,t,r,n,o,i){function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,"symbol"==typeof(o=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key))?o:String(o),n)}var o}function a(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function c(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,u(e,t)}function u(e,t){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},u(e,t)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var d=0;function f(e){return"__private_"+d+++"_"+e}function h(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}function p(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const g=Boolean("object"!=typeof process||"[object process]"!==String(process)||process.browser);function m(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}"undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);const y={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},v=y.global||y.self||y.window||{},w="object"!=typeof process||"[object process]"!==String(process)||process.browser,b="function"==typeof importScripts,x="undefined"!=typeof window&&void 0!==window.orientation;function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function M(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==S(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==S(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===S(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}"undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);class T{constructor(e,t){M(this,"name",void 0),M(this,"workerThread",void 0),M(this,"isRunning",!0),M(this,"result",void 0),M(this,"_resolve",()=>{}),M(this,"_reject",()=>{}),this.name=e,this.workerThread=t,this.result=new Promise((e,t)=>{this._resolve=e,this._reject=t})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){m(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){m(this.isRunning),this.isRunning=!1,this._reject(e)}}class E{terminate(){}}const k=new Map;function _(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function D(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0;const n=r||new Set;if(e)if(A(e))n.add(e);else if(A(e.buffer))n.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"==typeof e)for(const r in e)D(e[r],t,n);return void 0===r?Array.from(n):[]}function A(e){return!!e&&(e instanceof ArrayBuffer||"undefined"!=typeof MessagePort&&e instanceof MessagePort||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)}function B(e){if(null===e)return{};const t=Object.assign({},e);return Object.keys(t).forEach(r=>{t[r]="object"!=typeof e[r]||ArrayBuffer.isView(e[r])||e[r]instanceof Array?"function"==typeof t[r]||t[r]instanceof RegExp?{}:e[r]:B(e[r])}),t}const j=()=>{};class I{static isSupported(){return"undefined"!=typeof Worker&&w||void 0!==E&&!w}constructor(e){M(this,"name",void 0),M(this,"source",void 0),M(this,"url",void 0),M(this,"terminated",!1),M(this,"worker",void 0),M(this,"onMessage",void 0),M(this,"onError",void 0),M(this,"_loadableURL","");const{name:t,source:r,url:n}=e;m(r||n),this.name=t,this.source=r,this.url=n,this.onMessage=j,this.onError=e=>console.log(e),this.worker=w?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=j,this.onError=j,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||D(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(t+="".concat(e.message," in ")),e.lineno&&(t+=":".concat(e.lineno,":").concat(e.colno)),new Error(t)}_createBrowserWorker(){this._loadableURL=function(e){m(e.source&&!e.url||!e.source&&e.url);let t=k.get(e.source||e.url);return t||(e.url&&(t=(r=e.url).startsWith("http")?_("try {\n  importScripts('".concat(r,"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}")):r,k.set(e.url,t)),e.source&&(t=_(e.source),k.set(e.source,t))),m(t),t;var r}({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},e.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},e.onmessageerror=e=>console.error(e),e}_createNodeWorker(){let e;if(this.url){const t=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new E(t,{eval:!1})}else{if(!this.source)throw new Error("no worker");e=new E(this.source,{eval:!0})}return e.on("message",e=>{this.onMessage(e)}),e.on("error",e=>{this.onError(e)}),e.on("exit",e=>{}),e}}class P{static isSupported(){return I.isSupported()}constructor(e){M(this,"name","unnamed"),M(this,"source",void 0),M(this,"url",void 0),M(this,"maxConcurrency",1),M(this,"maxMobileConcurrency",1),M(this,"onDebug",()=>{}),M(this,"reuseWorkers",!0),M(this,"props",{}),M(this,"jobQueue",[]),M(this,"idleQueue",[]),M(this,"count",0),M(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}async startJob(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e,t,r)=>e.done(r),r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(e,t)=>e.error(t);const n=new Promise(n=>(this.jobQueue.push({name:e,onMessage:t,onError:r,onStart:n}),this));return this._startQueuedJob(),await n}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const r=new T(t.name,e);e.onMessage=e=>t.onMessage(r,e.type,e.payload),e.onError=e=>t.onError(r,e),t.onStart(r);try{await r.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new I({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return x?this.maxMobileConcurrency:this.maxConcurrency}}const L={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class O{static isSupported(){return I.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return O._workerFarm=O._workerFarm||new O({}),O._workerFarm.setProps(e),O._workerFarm}constructor(e){M(this,"props",void 0),M(this,"workerPools",new Map),this.props={...L},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:r,url:n}=e;let o=this.workerPools.get(t);return o||(o=new P({name:t,source:r,url:n}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}M(O,"_workerFarm",void 0);const C="latest",U="3.3.1";function F(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=t[e.id]||{},n="".concat(e.id,"-worker.js");let o=r.workerUrl;if(o||"compression"!==e.id||(o=t.workerUrl),"test"===t._workerType&&(o="modules/".concat(e.module,"/dist/").concat(n)),!o){let t=e.version;"latest"===t&&(t=C);const r=t?"@".concat(t):"";o="https://unpkg.com/@loaders.gl/".concat(e.module).concat(r,"/dist/").concat(n)}return m(o),o}async function R(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const o=function(e){const t=e.version!==U?" (worker-utils@".concat(U,")"):"";return"".concat(e.name,"@").concat(e.version).concat(t)}(e),i=O.getWorkerFarm(r),{source:s}=r,a={name:o,source:s};s||(a.url=F(e,r));const c=i.getWorkerPool(a),u=r.jobName||e.name,l=await c.startJob(u,G.bind(null,n)),d=B(r);return l.postMessage("process",{input:t,options:d}),(await l.result).result}async function G(e,t,r,n){switch(r){case"done":t.done(n);break;case"error":t.error(new Error(n.error));break;case"process":const{id:o,input:i,options:s}=n;try{if(!e.process)return void t.postMessage("error",{id:o,error:"Worker not set up to process on main thread"});const r=await e.process(i,s);t.postMessage("done",{id:o,result:r})}catch(e){const r=e instanceof Error?e.message:"unknown error";t.postMessage("error",{id:o,error:r})}break;default:console.warn("process-on-worker: unknown message ".concat(r))}}var K={__proto__:null,default:{}};const W={};async function N(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t&&(e=function(e,t,r){if(e.startsWith("http"))return e;const n=r.modules||{};return n[e]?n[e]:w?r.CDN?(m(r.CDN.startsWith("http")),"".concat(r.CDN,"/").concat(t,"@").concat("3.3.1","/dist/libs/").concat(e)):b?"../src/libs/".concat(e):"modules/".concat(t,"/src/libs/").concat(e):"modules/".concat(t,"/dist/libs/").concat(e)}(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})),W[e]=W[e]||async function(e){if(e.endsWith("wasm")){const t=await fetch(e);return await t.arrayBuffer()}if(!w)try{return K&&void 0}catch{return null}if(b)return importScripts(e);const t=await fetch(e);return function(e,t){if(!w)return;if(b)return eval.call(v,e),null;const r=document.createElement("script");r.id=t;try{r.appendChild(document.createTextNode(e))}catch(t){r.text=e}return document.body.appendChild(r),null}(await t.text(),e)}(e),await W[e]}async function V(e,t,r,n,o){const i=e.id,s=F(e,r),a=O.getWorkerFarm(r).getWorkerPool({name:i,url:s});r=JSON.parse(JSON.stringify(r)),n=JSON.parse(JSON.stringify(n||{}));const c=await a.startJob("process-on-worker",H.bind(null,o));c.postMessage("process",{input:t,options:r,context:n});const u=await c.result;return await u.result}async function H(e,t,r,n){switch(r){case"done":t.done(n);break;case"error":t.error(new Error(n.error));break;case"process":const{id:o,input:i,options:s}=n;try{const r=await e(i,s);t.postMessage("done",{id:o,result:r})}catch(e){const r=e instanceof Error?e.message:"unknown error";t.postMessage("error",{id:o,error:r})}break;default:console.warn("parse-with-worker unknown message ".concat(r))}}function Q(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const n=t.map(e=>e instanceof ArrayBuffer?new Uint8Array(e):e),o=n.reduce((e,t)=>e+t.byteLength,0),i=new Uint8Array(o);let s=0;for(const e of n)i.set(e,s),s+=e.byteLength;return i.buffer}let q="";const J={};function z(e){for(const t in J)e.startsWith(t)&&(e=e.replace(t,J[t]));return e.startsWith("http://")||e.startsWith("https://")||(e="".concat(q).concat(e)),e}function X(e){if((t=e)&&"object"==typeof t&&t.isBuffer)return(void 0)(e);var t;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if("string"==typeof e){const t=e;return(new TextEncoder).encode(t).buffer}if(e&&"object"==typeof e&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}const Y="3.3.1",$="https://unpkg.com/@loaders.gl/textures@".concat(Y,"/dist/libs/basis_encoder.wasm"),Z="https://unpkg.com/@loaders.gl/textures@".concat(Y,"/dist/libs/basis_encoder.js");let ee;const te={name:"Basis Universal Supercompressed GPU Texture",id:"ktx2-basis-writer",module:"textures",version:"3.3.1",extensions:["ktx2"],options:{useSRGB:!1,qualityLevel:10,encodeUASTC:!1,mipmaps:!1},encode:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{useSRGB:r=!1,qualityLevel:n=10,encodeUASTC:o=!1,mipmaps:i=!1}=t,{BasisEncoder:s}=await async function(e){const t=e.modules||{};return t.basisEncoder?t.basisEncoder:(ee=ee||async function(e){let t=null,r=null;return[t,r]=await Promise.all([await N(Z,"textures",e),await N($,"textures",e)]),t=t||globalThis.BASIS,await function(e,t){const r={};return t&&(r.wasmBinary=t),new Promise(t=>{e(r).then(e=>{const{BasisFile:r,KTX2File:n,initializeBasis:o,BasisEncoder:i}=e;o(),t({BasisFile:r,KTX2File:n,BasisEncoder:i})})})}(t,r)}(e),await ee)}(t),a=new s;try{const t=new Uint8Array(e.width*e.height*4);a.setCreateKTX2File(!0),a.setKTX2UASTCSupercompression(!0),a.setKTX2SRGBTransferFunc(!0),a.setSliceSourceImage(0,e.data,e.width,e.height,!1),a.setPerceptual(r),a.setMipSRGB(r),a.setQualityLevel(n),a.setUASTC(o),a.setMipGen(i);const s=a.encode(t);return t.subarray(0,s).buffer}catch(e){throw console.error("Basis Universal Supercompressed GPU Texture encoder Error: ",e),e}finally{a.delete()}}},{_parseImageNode:re}=globalThis,ne="undefined"!=typeof Image,oe="undefined"!=typeof ImageBitmap,ie=Boolean(re),se=!!g||ie,ae=/^data:image\/svg\+xml/,ce=/\.svg((\?|#).*)?$/;function ue(e){return e&&(ae.test(e)||ce.test(e))}function le(e,t){if(ue(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function de(e,t,r){const n=function(e,t){if(ue(t)){let t=(new TextDecoder).decode(e);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(t=unescape(encodeURIComponent(t)))}catch(e){throw new Error(e.message)}return"data:image/svg+xml;base64,".concat(btoa(t))}return le(e,t)}(e,r),o=self.URL||self.webkitURL,i="string"!=typeof n&&o.createObjectURL(n);try{return await async function(e,t){const r=new Image;return r.src=e,t.image&&t.image.decode&&r.decode?(await r.decode(),r):await new Promise((t,n)=>{try{r.onload=()=>t(r),r.onerror=t=>n(new Error("Could not load image ".concat(e,": ").concat(t)))}catch(e){n(e)}})}(i||n,t)}finally{i&&o.revokeObjectURL(i)}}const fe={};let he=!0;const pe=!1,ge=!0;function me(e){const t=ye(e);return function(e){const t=ye(e);return t.byteLength>=24&&2303741511===t.getUint32(0,pe)?{mimeType:"image/png",width:t.getUint32(16,pe),height:t.getUint32(20,pe)}:null}(t)||function(e){const t=ye(e);if(!(t.byteLength>=3&&65496===t.getUint16(0,pe)&&255===t.getUint8(2)))return null;const{tableMarkers:r,sofMarkers:n}=function(){const e=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)e.add(t);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}();let o=2;for(;o+9<t.byteLength;){const e=t.getUint16(o,pe);if(n.has(e))return{mimeType:"image/jpeg",height:t.getUint16(o+5,pe),width:t.getUint16(o+7,pe)};if(!r.has(e))return null;o+=2,o+=t.getUint16(o,pe)}return null}(t)||function(e){const t=ye(e);return t.byteLength>=10&&1195984440===t.getUint32(0,pe)?{mimeType:"image/gif",width:t.getUint16(6,ge),height:t.getUint16(8,ge)}:null}(t)||function(e){const t=ye(e);return t.byteLength>=14&&16973===t.getUint16(0,pe)&&t.getUint32(2,ge)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,ge),height:t.getUint32(22,ge)}:null}(t)}function ye(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}const ve={id:"image",module:"images",name:"Images",version:"3.3.1",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg"],parse:async function(e,t,r){const n=((t=t||{}).image||{}).type||"auto",{url:o}=r||{};let i;switch(function(e){switch(e){case"auto":case"data":return function(){if(oe)return"imagebitmap";if(ne)return"image";if(se)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(e){switch(e){case"auto":return oe||ne||se;case"imagebitmap":return oe;case"image":return ne;case"data":return se;default:throw new Error("@loaders.gl/images: image ".concat(e," not supported in this environment"))}}(e),e}}(n)){case"imagebitmap":i=await async function(e,t,r){let n;n=ue(r)?await de(e,t,r):le(e,r);const o=t&&t.imagebitmap;return await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!function(e){for(const t in e||fe)return!1;return!0}(t)&&he||(t=null),t)try{return await createImageBitmap(e,t)}catch(e){console.warn(e),he=!1}return await createImageBitmap(e)}(n,o)}(e,t,o);break;case"image":i=await de(e,t,o);break;case"data":i=await async function(e,t){const{mimeType:r}=me(e)||{},n=globalThis._parseImageNode;return p(n),await n(e,r)}(e);break;default:p(!1)}return"data"===n&&(i=function(e){switch(function(e){const t=function(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&e instanceof Image?"image":e&&"object"==typeof e&&e.data&&e.width&&e.height?"data":null}(e);if(!t)throw new Error("Not an image");return t}(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw new Error("getImageData");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}(i)),i},tests:[e=>Boolean(me(new DataView(e)))],options:{image:{type:"auto",decode:!0}}};var we=1e3,be=2e4,xe=20001,Se=20002,Me=20003,Te=20004;function Ee(e){return new Float64Array(e||6)}function ke(e){return void 0===e&&(e=Ee()),e[0]=r.MAX_DOUBLE,e[1]=r.MAX_DOUBLE,e[2]=r.MAX_DOUBLE,e[3]=r.MIN_DOUBLE,e[4]=r.MIN_DOUBLE,e[5]=r.MIN_DOUBLE,e}function _e(e,t){for(var r,n,o,i=0,s=t.length;i<s;i+=3)n=t[i+1],o=t[i+2],e[0]>(r=t[i])&&(e[0]=r),e[1]>n&&(e[1]=n),e[2]>o&&(e[2]=o),e[3]<r&&(e[3]=r),e[4]<n&&(e[4]=n),e[5]<o&&(e[5]=o);return e}o.createVec3(),o.createVec3(),o.createMat4(),r.newFloatArray(3),r.newFloatArray(3),r.newFloatArray(3),r.newFloatArray(3),r.newFloatArray(3),r.newFloatArray(3),r.newFloatArray(3);var De=function(e){this.positionsCompressed=void 0,this.uvsCompressed=void 0,this.colorsCompressed=void 0,this.indices=void 0,this.edgeIndices=void 0,this.positionsCompressed=e.positionsCompressed,this.uvsCompressed=e.uvsCompressed,this.colorsCompressed=e.colorsCompressed,this.indices=e.indices,this.edgeIndices=e.edgeIndices},Ae=function(e){this.id=void 0,this.primitive=void 0,this.positionsDecompressMatrix=void 0,this.aabb=void 0,this.uvsDecompressMatrix=void 0,this.geometryBuckets=void 0,this.rendererGeometry=void 0,this.geometryBuckets=[];for(var t=0,r=e.geometryBuckets.length;t<r;t++)this.geometryBuckets[t]=new De(e.geometryBuckets[t]);this.id=e.id,this.positionsDecompressMatrix=e.positionsDecompressMatrix,this.primitive=e.primitive},Be=/*#__PURE__*/f("positionsDecompressed"),je=/*#__PURE__*/f("positionsWorld"),Ie=new(/*#__PURE__*/function(){function e(){this.object=void 0,this.mesh=void 0,this.meshIndex=void 0,this.geometry=void 0,this.geometryBucket=void 0,this.geometryBucketIndex=void 0,Object.defineProperty(this,Be,{writable:!0,value:void 0}),Object.defineProperty(this,je,{writable:!0,value:void 0}),this.object=null,this.mesh=null,this.meshIndex=0,this.geometry=null,this.geometryBucket=null,this.geometryBucketIndex=0,h(this,Be)[Be]=null,h(this,je)[je]=null}return e.prototype.reset=function(){h(this,Be)[Be]=null,h(this,je)[je]=null},a(e,[{key:"totalGeometryBuckets",get:function(){var e=0;if(this.object)for(var t=0,r=this.object.meshes.length;t<r;t++)e+=this.object.meshes[t].geometry.geometryBuckets.length;return e}},{key:"numPrimitives",get:function(){var e=this.geometry.primitive;return this.geometryBucket.indices.length/(e===Se?3:e===xe?2:1)}},{key:"positionsDecompressed",get:function(){return h(this,Be)[Be]||(h(this,Be)[Be]=new Float32Array(this.geometryBucket.positionsCompressed.length),i.decompressPositions3(this.geometryBucket.positionsCompressed,this.geometry.positionsDecompressMatrix,h(this,Be)[Be])),h(this,Be)[Be]}},{key:"positionsWorld",get:function(){if(!h(this,je)[je]){var e=this.positionsDecompressed;h(this,je)[je]=new Float64Array(e.length),o.transformPositions3(e,this.mesh.matrix,h(this,je)[je])}return h(this,je)[je]}},{key:"uvsDecompressed",get:function(){return null}}]),e}());function Pe(e,t){Ie.reset(),Ie.object=e;for(var r=0,n=e.meshes.length;r<n;r++){var o=e.meshes[r];Ie.mesh=o,Ie.meshIndex=r;var i=o.geometry;Ie.geometry=i;for(var s=0,a=i.geometryBuckets.length;s<a;s++)if(Ie.geometryBucket=i.geometryBuckets[s],Ie.geometryBucketIndex=s,t(Ie))return!0}return!1}var Le=/*#__PURE__*/f("aabb"),Oe=/*#__PURE__*/f("aabbDirty"),Ce=/*#__PURE__*/function(){function e(e){this.model=void 0,this.id=void 0,this.meshes=void 0,this.layerId=void 0,this.rendererObject=void 0,Object.defineProperty(this,Le,{writable:!0,value:void 0}),Object.defineProperty(this,Oe,{writable:!0,value:void 0}),this.id=e.id,this.layerId=e.layerId,this.meshes=e.meshes,h(this,Le)[Le]=Ee(),h(this,Oe)[Oe]=!0,this.rendererObject=null}return e.prototype.setAABBDirty=function(){h(this,Oe)[Oe]=!0},a(e,[{key:"aabb",get:function(){var e=this;return h(this,Oe)[Oe]&&(ke(h(this,Le)[Le]),Pe(this,function(t){return _e(h(e,Le)[Le],t.positionsWorld),!1}),h(this,Oe)[Oe]=!1),h(this,Le)[Le]}}]),e}(),Ue=function(e,t){this.id=void 0,this.colorTexture=void 0,this.metallicRoughnessTexture=void 0,this.occlusionTexture=void 0,this.emissiveTexture=void 0,this.rendererTextureSet=void 0,this.id=e.id,this.colorTexture=t.colorTexture,this.metallicRoughnessTexture=t.metallicRoughnessTexture,this.occlusionTexture=t.occlusionTexture,this.emissiveTexture=t.emissiveTexture,this.rendererTextureSet=null},Fe=function(e){this.rendererTexture=void 0,this.id=void 0,this.src=void 0,this.imageData=void 0,this.buffers=void 0,this.image=void 0,this.height=void 0,this.width=void 0,this.compressed=void 0,this.mediaType=void 0,this.magFilter=void 0,this.minFilter=void 0,this.wrapS=void 0,this.wrapT=void 0,this.wrapR=void 0,this.flipY=void 0,this.encoding=void 0,this.preloadColor=void 0,this.channel=void 0,this.id=e.id,this.imageData=e.imageData,this.src=e.src,this.mediaType=e.mediaType,this.minFilter=e.minFilter||1007,this.magFilter=e.magFilter||1007,this.wrapS=e.wrapS||we,this.wrapT=e.wrapT||we,this.wrapR=e.wrapR||we,this.encoding=e.encoding||3e3,this.preloadColor=o.createVec4(e.preloadColor||[1,1,1,1]),this.channel=0,this.rendererTexture=null},Re=/*#__PURE__*/f("color"),Ge=/*#__PURE__*/f("matrix"),Ke=/*#__PURE__*/f("metallic"),We=/*#__PURE__*/f("roughness"),Ne=/*#__PURE__*/f("opacity"),Ve=/*#__PURE__*/function(){function e(e){this.id=void 0,this.geometry=void 0,this.textureSet=void 0,this.rendererMesh=void 0,this.object=void 0,Object.defineProperty(this,Re,{writable:!0,value:void 0}),Object.defineProperty(this,Ge,{writable:!0,value:void 0}),Object.defineProperty(this,Ke,{writable:!0,value:void 0}),Object.defineProperty(this,We,{writable:!0,value:void 0}),Object.defineProperty(this,Ne,{writable:!0,value:void 0}),this.id=e.id,h(this,Ge)[Ge]=e.matrix?o.createMat4(e.matrix):o.identityMat4(),this.geometry=e.geometry,this.textureSet=e.textureSet,this.rendererMesh=null,this.color=e.color||o.createVec3([1,1,1]),this.metallic=null!=e.metallic?e.metallic:0,this.roughness=null!=e.roughness?e.roughness:1,this.opacity=null!=e.opacity?e.opacity:1}return a(e,[{key:"color",get:function(){return h(this,Re)[Re]},set:function(e){var t=h(this,Re)[Re];t||((t=h(this,Re)[Re]=new Float32Array(4))[3]=1),e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.rendererMesh&&this.rendererMesh.setColor(h(this,Re)[Re])}},{key:"matrix",get:function(){return h(this,Ge)[Ge]},set:function(e){e?h(this,Ge)[Ge].set(e):o.identityMat4(h(this,Ge)[Ge]),this.rendererMesh&&this.rendererMesh.setMatrix(h(this,Ge)[Ge]),this.object&&this.object.setAABBDirty()}},{key:"metallic",get:function(){return h(this,Ke)[Ke]},set:function(e){e=null!=e?e:1,h(this,Ke)[Ke]!==e&&(h(this,Ke)[Ke]=e,this.rendererMesh&&this.rendererMesh.setMetallic(h(this,Ke)[Ke]))}},{key:"roughness",get:function(){return h(this,We)[We]},set:function(e){e=null!=e?e:1,h(this,We)[We]!==e&&(h(this,We)[We]=e,this.rendererMesh&&this.rendererMesh.setRoughness(h(this,We)[We]))}},{key:"opacity",get:function(){return h(this,Ne)[Ne]},set:function(e){e=null!=e?e:1,h(this,Ne)[Ne]!==e&&(h(this,Ne)[Ne]=e)}}]),e}(),He=[],Qe=[],qe=[],Je=[],ze=[],Xe=0,Ye=new Uint16Array(3),$e=new Uint16Array(3),Ze=new Uint16Array(3),et=o.createVec3(),tt=o.createVec3(),rt=o.createVec3(),nt=o.createVec3(),ot=o.createVec3(),it=o.createVec3(),st=o.createVec3(),at=null;function ct(e,t){for(var r,n=0;n<3;n++)if(0!=(r=at[3*e+n]-at[3*t+n]))return r;return 0}var ut=null,lt=null;function dt(e,t){var r,n,o,i,s,a,c=3*e,u=3*t,l=Math.min(r=lt[c],n=lt[c+1],o=lt[c+2]),d=Math.min(i=lt[u],s=lt[u+1],a=lt[u+2]);if(l!=d)return l-d;var f=Math.max(r,n,o),h=Math.max(i,s,a);return f!=h?f-h:0}function ft(e){var t=o.createMat4(),n=ke();_e(n,e.positions);var s,a=i.quantizePositions3(e.positions,n,t),c=e.primitive!==Me&&e.primitive!==Te&&e.primitive!==Se||!e.indices?null:function(e,t,n,s){!function(e,t){var r,n,o,i,s,a,c={},u=Math.pow(10,4),l=0;for(s=0,a=e.length;s<a;s+=3)r=e[s],n=e[s+1],o=e[s+2],void 0===c[i=Math.round(r*u)+"_"+Math.round(n*u)+"_"+Math.round(o*u)]&&(c[i]=l/3,He[l++]=r,He[l++]=n,He[l++]=o),Qe[s/3]=c[i];for(s=0,a=t.length;s<a;s++)Je[s]=Qe[t[s]],qe[Je[s]]=t[s]}(e,t),function(e,t){Xe=0;for(var r=0,n=e;r<n;r+=3){var s=3*Je[r],a=3*Je[r+1],c=3*Je[r+2];t?(Ye[0]=He[s],Ye[1]=He[s+1],Ye[2]=He[s+2],$e[0]=He[a],$e[1]=He[a+1],$e[2]=He[a+2],Ze[0]=He[c],Ze[1]=He[c+1],Ze[2]=He[c+2],i.decompressPoint3(Ye,t,et),i.decompressPoint3($e,t,tt),i.decompressPoint3(Ze,t,rt)):(et[0]=He[s],et[1]=He[s+1],et[2]=He[s+2],tt[0]=He[a],tt[1]=He[a+1],tt[2]=He[a+2],rt[0]=He[c],rt[1]=He[c+1],rt[2]=He[c+2]),o.subVec3(rt,tt,nt),o.subVec3(et,tt,ot),o.cross3Vec3(nt,ot,it),o.normalizeVec3(it,st);var u=ze[Xe]||(ze[Xe]={normal:o.createVec3()});u.normal[0]=st[0],u.normal[1]=st[1],u.normal[2]=st[2],Xe++}}(t.length,n);for(var a,c,u,l,d,f,h,p,g=[],m=Math.cos(10*r.DEGTORAD),y={},v=!1,w=0,b=t.length;w<b;w+=3)for(var x=w/3,S=0;S<3;S++)a=Je[w+S],c=Je[w+(S+1)%3],void 0===y[d=(u=Math.min(a,c))+","+(l=Math.max(a,c))]?y[d]={index1:u,index2:l,face1:x,face2:void 0}:y[d].face2=x;for(d in y)void 0!==(f=y[d]).face2&&o.dotVec3(ze[f.face1].normal,ze[f.face2].normal)>m||(h=qe[f.index1],p=qe[f.index2],(!v&&h>65535||p>65535)&&(v=!0),g.push(h),g.push(p));return v?new Uint32Array(g):new Uint16Array(g)}(a,e.indices,t),u=function(e){var t=e.positionsCompressed,r=e.indices,n=e.edgeIndices;!function(e){if(!(null!==ut&&ut.length>=e)){ut=new Uint32Array(e);for(var t=0;t<e;t++)ut[t]=t}}(t.length/3);var o=ut.slice(0,t.length/3),i=ut.slice(0,t.length/3);at=t,o.sort(ct);var s=0;i[o[0]]=0;for(var a=1,c=o.length;a<c;a++)0!=ct(o[a],o[a-1])&&s++,i[o[a]]=s;var u=new Uint16Array(3*(s+1));u[3*(s=0)+0]=t[3*o[0]+0],u[3*s+1]=t[3*o[0]+1],u[3*s+2]=t[3*o[0]+2];for(var l=1,d=o.length;l<d;l++)0!==ct(o[l],o[l-1])&&(u[3*++s+0]=t[3*o[l]+0],u[3*s+1]=t[3*o[l]+1],u[3*s+2]=t[3*o[l]+2]),i[o[l]]=s;at=null;for(var f,h=new Uint32Array(r.length),p=0,g=r.length;p<g;p++)h[p]=i[r[p]];if(n){f=new Uint32Array(n.length);for(var m=0,y=n.length;m<y;m++)f[m]=i[n[m]]}return[u,h,f]}({positionsCompressed:a,uvs:e.uvs,indices:e.indices,edgeIndices:c}),l=function(e,t,r){void 0===r&&(r=!1);var n=e.positionsCompressed||[],o=function(e,t){for(var r=new Int32Array(e.length/3),n=0,o=r.length;n<o;n++)r[n]=n;lt=new Int32Array(e.length);for(var i=0,s=e.length;i<s;i++)lt[i]=e[i]>>t;r.sort(dt);for(var a=new Int32Array(e.length),c=0,u=r.length;c<u;c++)a[3*c+0]=e[3*r[c]+0],a[3*c+1]=e[3*r[c]+1],a[3*c+2]=e[3*r[c]+2];return a}(e.indices||[],t),i=[];function s(e,t){if(e>t){var r=e;e=t,t=r}function n(r,n){return r!=e?e-r:n!=t?t-n:0}for(var o=0,s=(i.length>>1)-1;o<=s;){var a=s+o>>1,c=n(i[2*a],i[2*a+1]);if(c>0)o=a+1;else{if(!(c<0))return a;s=a-1}}return-o-1}var a=new Int32Array(i.length/2);a.fill(0);var c=n.length/3;if(c>8*(1<<t))return[e];var u=new Int32Array(c);u.fill(-1);var l=[];function d(){u.fill(-1);var e={positionsCompressed:[],indices:[],edgeIndices:[],maxNumPositions:(1<<t)-t,numPositions:0,bucketNumber:l.length};return l.push(e),e}for(var f=d(),h=0,p=o.length;h<p;h+=3){var g=0,m=o[h],y=o[h+1],v=o[h+2];if(-1==u[m]&&g++,-1==u[y]&&g++,-1==u[v]&&g++,g+f.numPositions>f.maxNumPositions&&(f=d()),f.bucketNumber>8)return[e];-1==u[m]&&(u[m]=f.numPositions++,f.positionsCompressed.push(n[3*m]),f.positionsCompressed.push(n[3*m+1]),f.positionsCompressed.push(n[3*m+2])),-1==u[y]&&(u[y]=f.numPositions++,f.positionsCompressed.push(n[3*y]),f.positionsCompressed.push(n[3*y+1]),f.positionsCompressed.push(n[3*y+2])),-1==u[v]&&(u[v]=f.numPositions++,f.positionsCompressed.push(n[3*v]),f.positionsCompressed.push(n[3*v+1]),f.positionsCompressed.push(n[3*v+2])),f.indices.push(u[m]),f.indices.push(u[y]),f.indices.push(u[v]);var w=void 0;(w=s(m,y))>=0&&0==a[w]&&(a[w]=1,f.edgeIndices.push(u[i[2*w]]),f.edgeIndices.push(u[i[2*w+1]])),(w=s(m,v))>=0&&0==a[w]&&(a[w]=1,f.edgeIndices.push(u[i[2*w]]),f.edgeIndices.push(u[i[2*w+1]])),(w=s(y,v))>=0&&0==a[w]&&(a[w]=1,f.edgeIndices.push(u[i[2*w]]),f.edgeIndices.push(u[i[2*w+1]]))}var b=t/8,x=2*n.length+(o.length+i.length)*(t/8*2),S=0;return l.forEach(function(e){S+=2*e.positionsCompressed.length+(e.indices.length+e.edgeIndices.length)*b}),S>x?[e]:(r&&function(e,t){var r={};e.forEach(function(e){for(var t=e.indices,n=e.edgeIndices,o=e.positionsCompressed,i=0,s=t.length;i<s;i+=3)r[o[3*t[i]]+"_"+o[3*t[i]+1]+"_"+o[3*t[i]+2]+"/"+o[3*t[i+1]]+"_"+o[3*t[i+1]+1]+"_"+o[3*t[i+1]+2]+"/"+o[3*t[i+2]]+"_"+o[3*t[i+2]+1]+"_"+o[3*t[i+2]+2]]=!0;for(i=0,s=n.length;i<s;i+=2);});for(var n=t.indices,o=t.positionsCompressed,i=0,s=n.length;i<s;i+=3){var a=o[3*n[i]]+"_"+o[3*n[i]+1]+"_"+o[3*n[i]+2]+"/"+o[3*n[i+1]]+"_"+o[3*n[i+1]+1]+"_"+o[3*n[i+1]+2]+"/"+o[3*n[i+2]]+"_"+o[3*n[i+2]+1]+"_"+o[3*n[i+2]+2];if(!(a in r))throw console.log("Not found "+a),"Ohhhh!"}}(l,e),l)}({positionsCompressed:s=u[0],indices:u[1],edgeIndices:u[2]},s.length/3>65536?16:8);return{id:e.id,primitive:e.primitive===Me&&l.length>1?Se:e.primitive,aabb:n,positionsDecompressMatrix:t,uvsDecompressMatrix:void 0,geometryBuckets:l}}const ht=e=>"function"==typeof e,pt=e=>null!==e&&"object"==typeof e,gt=e=>pt(e)&&e.constructor==={}.constructor,mt=e=>e&&"function"==typeof e[Symbol.iterator],yt=e=>e&&"function"==typeof e[Symbol.asyncIterator],vt=e=>"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,wt=e=>"undefined"!=typeof Blob&&e instanceof Blob,bt=e=>e&&"object"==typeof e&&e.isBuffer,xt=e=>(e=>"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||pt(e)&&ht(e.tee)&&ht(e.cancel)&&ht(e.getReader))(e)||(e=>pt(e)&&ht(e.read)&&ht(e.pipe)&&(e=>"boolean"==typeof e)(e.readable))(e),St=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Mt=/^([-\w.]+\/[-\w.+]+)/;function Tt(e){const t=Mt.exec(e);return t?t[1]:e}function Et(e){const t=St.exec(e);return t?t[1]:""}const kt=/\?.*/;function _t(e){if(vt(e)){const t=Dt(e.url||"");return{url:t,type:Tt(e.headers.get("content-type")||"")||Et(t)}}return wt(e)?{url:Dt(e.name||""),type:e.type||""}:"string"==typeof e?{url:Dt(e),type:Et(e)}:{url:"",type:""}}function Dt(e){return e.replace(kt,"")}async function At(e){if(vt(e))return e;const t={},r=function(e){return vt(e)?e.headers["content-length"]||-1:wt(e)?e.size:"string"==typeof e?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}(e);r>=0&&(t["content-length"]=String(r));const{url:n,type:o}=_t(e);o&&(t["content-type"]=o);const i=await async function(e){if("string"==typeof e)return"data:,".concat(e.slice(0,5));if(e instanceof Blob){const t=e.slice(0,5);return await new Promise(e=>{const r=new FileReader;r.onload=t=>{var r;return e(null==t||null===(r=t.target)||void 0===r?void 0:r.result)},r.readAsDataURL(t)})}if(e instanceof ArrayBuffer){const t=function(e){let t="";const r=new Uint8Array(e);for(let e=0;e<r.byteLength;e++)t+=String.fromCharCode(r[e]);return btoa(t)}(e.slice(0,5));return"data:base64,".concat(t)}return null}(e);i&&(t["x-first-bytes"]=i),"string"==typeof e&&(e=(new TextEncoder).encode(e));const s=new Response(e,{headers:t});return Object.defineProperty(s,"url",{value:n}),s}async function Bt(e,t){if("string"==typeof e){e=z(e);let r=t;return null!=t&&t.fetch&&"function"!=typeof(null==t?void 0:t.fetch)&&(r=t.fetch),await fetch(e,r)}return await At(e)}function jt(){return!("object"==typeof process&&"[object process]"===String(process)&&!process.browser)||function(e){if("undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"==typeof process.versions&&Boolean(process.versions.electron))return!0;const t="object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}()}const It={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document,process:"object"==typeof process&&process},Pt=It.window||It.self||It.global,Lt=It.process||{},Ot="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source";jt();class Ct{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";M(this,"storage",void 0),M(this,"id",void 0),M(this,"config",void 0),this.storage=function(e){try{const t=window[e],r="__storage_test__";return t.setItem(r,r),t.removeItem(r),t}catch(e){return null}}(r),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function Ut(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600;const o=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>n&&(r=Math.min(r,n/e.width));const i=e.width*r,s=e.height*r,a=["font-size:1px;","padding:".concat(Math.floor(s/2),"px ").concat(Math.floor(i/2),"px;"),"line-height:".concat(s,"px;"),"background:url(".concat(o,");"),"background-size:".concat(i,"px ").concat(s,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),a]}let Ft;function Rt(e){return"string"==typeof e?Ft[e.toUpperCase()]||Ft.WHITE:e}function Gt(e,t){if(!e)throw new Error(t||"Assertion failed")}function Kt(){let e;var t,r;if(jt&&"performance"in Pt)e=null==Pt||null===(t=Pt.performance)||void 0===t||null===(r=t.now)||void 0===r?void 0:r.call(t);else if("hrtime"in Lt){var n;const t=null==Lt||null===(n=Lt.hrtime)||void 0===n?void 0:n.call(Lt);e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}!function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"}(Ft||(Ft={}));const Wt={debug:jt&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Nt={enabled:!0,level:0};function Vt(){}const Ht={},Qt={once:!0};class qt{constructor(){let{id:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:""};M(this,"id",void 0),M(this,"VERSION",Ot),M(this,"_startTs",Kt()),M(this,"_deltaTs",Kt()),M(this,"_storage",void 0),M(this,"userData",{}),M(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new Ct("__probe-".concat(this.id,"__"),Nt),this.timeStamp("".concat(this.id," started")),function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"];const r=Object.getPrototypeOf(e),n=Object.getOwnPropertyNames(r);for(const r of n)"function"==typeof e[r]&&(t.find(e=>r===e)||(e[r]=e[r].bind(e)))}(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Kt()-this._startTs).toPrecision(10))}getDelta(){return Number((Kt()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){return this._storage.setConfiguration({enabled:!(arguments.length>0&&void 0!==arguments[0])||arguments[0]}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){Gt(e,t)}warn(e){return this._getLogFunction(0,e,Wt.warn,arguments,Qt)}error(e){return this._getLogFunction(0,e,Wt.error,arguments)}deprecated(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}removed(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}probe(e,t){return this._getLogFunction(e,t,Wt.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Wt.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),o=2;o<r;o++)n[o-2]=arguments[o];return this._getLogFunction(e,t,Wt.debug||Wt.info,arguments,Qt)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||Vt,r&&[r],{tag:Xt(t)}):Vt}image(e){let{logLevel:t,priority:r,image:n,message:o="",scale:i=1}=e;return this._shouldLog(t||r)?jt?function(e){let{image:t,message:r="",scale:n=1}=e;if("string"==typeof t){const e=new Image;return e.onload=()=>{const t=Ut(e,r,n);console.log(...t)},e.src=t,Vt}const o=t.nodeName||"";if("img"===o.toLowerCase())return console.log(...Ut(t,r,n)),Vt;if("canvas"===o.toLowerCase()){const e=new Image;return e.onload=()=>console.log(...Ut(e,r,n)),e.src=t.toDataURL(),Vt}return Vt}({image:n,message:o,scale:i}):(console.warn("removed"),Vt):Vt}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Vt)}group(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1};const n=zt({logLevel:e,message:t,opts:r}),{collapsed:o}=r;return n.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,t){return this.group(e,t,Object.assign({},arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Vt)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=Jt(e)}_getLogFunction(e,t,r,n,o){if(this._shouldLog(e)){o=zt({logLevel:e,message:t,args:n,opts:o}),Gt(r=r||o.method),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=Kt();const i=o.tag||o.message;if(o.once){if(Ht[i])return Vt;Ht[i]=Kt()}return t=function(e,t,r){if("string"==typeof t){const s=r.time?function(e){const t=Math.max((arguments.length>1&&void 0!==arguments[1]?arguments[1]:8)-e.length,0);return"".concat(" ".repeat(t)).concat(e)}(function(e){let t;return t=e<10?"".concat(e.toFixed(2),"ms"):e<100?"".concat(e.toFixed(1),"ms"):e<1e3?"".concat(e.toFixed(0),"ms"):"".concat((e/1e3).toFixed(2),"s"),t}(r.total)):"";n=t=r.time?"".concat(e,": ").concat(s,"  ").concat(t):"".concat(e,": ").concat(t),o=r.color,i=r.background,jt||"string"!=typeof n||(o&&(o=Rt(o),n="[".concat(o,"m").concat(n,"[39m")),i&&(o=Rt(i),n="[".concat(i+10,"m").concat(n,"[49m"))),t=n}var n,o,i;return t}(this.id,o.message,o),r.bind(console,t,...o.args)}return Vt}}function Jt(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return Gt(Number.isFinite(t)&&t>=0),t}function zt(e){const{logLevel:t,message:r}=e;e.logLevel=Jt(t);const n=e.args?Array.from(e.args):[];for(;n.length&&n.shift()!==r;);switch(typeof t){case"string":case"function":void 0!==r&&n.unshift(r),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());const o=typeof e.message;return Gt("string"===o||"object"===o),Object.assign(e,{args:n},e.opts)}function Xt(e){for(const t in e)for(const r in e[t])return r||"untitled";return"empty"}M(qt,"VERSION",Ot);const Yt=new qt({id:"loaders.gl"});class $t{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}const Zt={fetch:null,mimeType:void 0,nothrow:!1,log:new class{constructor(){M(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.log.bind(this.console,...t)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.info.bind(this.console,...t)}warn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.warn.bind(this.console,...t)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.error.bind(this.console,...t)}},CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:g,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},er={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function tr(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state=e._state||{},e._state}const rr=()=>{const e=tr();return e.globalOptions=e.globalOptions||{...Zt},e.globalOptions};function nr(e,t){const r=rr(),n=e||r;return"function"==typeof n.fetch?n.fetch:pt(n.fetch)?e=>Bt(e,n):null!=t&&t.fetch?null==t?void 0:t.fetch:Bt}function or(e,t,r,n,o){const i=t||"Top level",s=t?"".concat(t,"."):"";for(const a in e){const c=!t&&pt(e[a]);if(!(a in r)&&("baseUri"!==a||t)&&("workerUrl"!==a||!t))if(a in n)Yt.warn("".concat(i," loader option '").concat(s).concat(a,"' no longer supported, use '").concat(n[a],"'"))();else if(!c){const e=ir(a,o);Yt.warn("".concat(i," loader option '").concat(s).concat(a,"' not recognized. ").concat(e))()}}}function ir(e,t){const r=e.toLowerCase();let n="";for(const o of t)for(const t in o.options){if(e===t)return"Did you mean '".concat(o.id,".").concat(t,"'?");const i=t.toLowerCase();(r.startsWith(i)||i.startsWith(r))&&(n=n||"Did you mean '".concat(o.id,".").concat(t,"'?"))}return n}function sr(e,t){for(const r in t)r in t&&(e[r]=gt(t[r])&&gt(e[r])?{...e[r],...t[r]}:t[r])}function ar(e){var t;return!!e&&(Array.isArray(e)&&(e=e[0]),Array.isArray(null===(t=e)||void 0===t?void 0:t.extensions))}function cr(e){var t,r;let n;return p(e,"null loader"),p(ar(e),"invalid loader"),Array.isArray(e)&&(n=e[1],e=e[0],e={...e,options:{...e.options,...n}}),(null!==(t=e)&&void 0!==t&&t.parseTextSync||null!==(r=e)&&void 0!==r&&r.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}const ur=()=>{const e=tr();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry},lr=new qt({id:"loaders.gl"}),dr=/\.([^.]+)$/;function fr(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!hr(e))return null;if(t&&!Array.isArray(t))return cr(t);let o=[];t&&(o=o.concat(t)),null!=r&&r.ignoreRegisteredLoaders||o.push(...ur()),function(e){for(const t of e)cr(t)}(o);const i=function(e,t,r,n){const{url:o,type:i}=_t(e),s=o||(null==n?void 0:n.url);let a=null,c="";var u;return null!=r&&r.mimeType&&(a=gr(t,null==r?void 0:r.mimeType),c="match forced by supplied MIME type ".concat(null==r?void 0:r.mimeType)),a=a||function(e,t){const r=t&&dr.exec(t),n=r&&r[1];return n?function(e,t){t=t.toLowerCase();for(const r of e)for(const e of r.extensions)if(e.toLowerCase()===t)return r;return null}(e,n):null}(t,s),c=c||(a?"matched url ".concat(s):""),a=a||gr(t,i),c=c||(a?"matched MIME type ".concat(i):""),a=a||function(e,t){if(!t)return null;for(const r of e)if("string"==typeof t){if(mr(t,r))return r}else if(ArrayBuffer.isView(t)){if(yr(t.buffer,t.byteOffset,r))return r}else if(t instanceof ArrayBuffer&&yr(t,0,r))return r;return null}(t,e),c=c||(a?"matched initial data ".concat(vr(e)):""),a=a||gr(t,null==r?void 0:r.fallbackMimeType),c=c||(a?"matched fallback MIME type ".concat(i):""),c&&lr.log(1,"selectLoader selected ".concat(null===(u=a)||void 0===u?void 0:u.name,": ").concat(c,".")),a}(e,o,r,n);if(!(i||null!=r&&r.nothrow))throw new Error(pr(e));return i}function hr(e){return!(e instanceof Response&&204===e.status)}function pr(e){const{url:t,type:r}=_t(e);let n="No valid loader found (";n+=t?"".concat(function(e){const t=e&&e.lastIndexOf("/");return t>=0?e.substr(t+1):""}(t),", "):"no url provided, ",n+="MIME type: ".concat(r?'"'.concat(r,'"'):"not provided",", ");const o=e?vr(e):"";return n+=o?' first bytes: "'.concat(o,'"'):"first bytes: not available",n+=")",n}function gr(e,t){for(const r of e){if(r.mimeTypes&&r.mimeTypes.includes(t))return r;if(t==="application/x.".concat(r.id))return r}return null}function mr(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some(t=>e.startsWith(t))}function yr(e,t,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(n=>function(e,t,r,n){if(n instanceof ArrayBuffer)return function(e,t,r){if(e.byteLength<(r=r||e.byteLength)||t.byteLength<r)return!1;const n=new Uint8Array(e),o=new Uint8Array(t);for(let e=0;e<n.length;++e)if(n[e]!==o[e])return!1;return!0}(n,e,n.byteLength);switch(typeof n){case"function":return n(e,r);case"string":return n===wr(e,t,n.length);default:return!1}}(e,t,r,n))}function vr(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return"string"==typeof e?e.slice(0,t):ArrayBuffer.isView(e)?wr(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?wr(e,0,t):""}function wr(e,t,r){if(e.byteLength<t+r)return"";const n=new DataView(e);let o="";for(let e=0;e<r;e++)o+=String.fromCharCode(n.getUint8(t+e));return o}const br=262144,xr=262144,Sr=1048576;function Mr(e,t){return g?async function*(e,t){const r=e.getReader();let n;try{for(;;){const e=n||r.read();null!=t&&t._streamReadAhead&&(n=r.read());const{done:o,value:i}=await e;if(o)return;yield X(i)}}catch(e){r.releaseLock()}}(e,t):async function*(e,t){for await(const t of e)yield X(t)}(e)}const Tr="Cannot convert supplied data type";async function Er(e,t,r,n){m(!n||"object"==typeof n),!t||Array.isArray(t)||ar(t)||(n=void 0,r=t,t=void 0),e=await e,r=r||{};const{url:o}=_t(e),i=function(e,t){if(!t&&e&&!Array.isArray(e))return e;let r;if(e&&(r=Array.isArray(e)?e:[e]),t&&t.loaders){const e=Array.isArray(t.loaders)?t.loaders:[t.loaders];r=r?[...r,...e]:e}return r&&r.length?r:null}(t,n),s=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!hr(e))return null;let o=fr(e,t,{...r,nothrow:!0},n);if(o)return o;if(wt(e)&&(o=fr(e=await e.slice(0,10).arrayBuffer(),t,r,n)),!(o||null!=r&&r.nothrow))throw new Error(pr(e));return o}(e,i,r);return s?(n=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(r)return r;const n={fetch:nr(t,e),...e};return Array.isArray(n.loaders)||(n.loaders=null),n}({url:o,parse:Er,loaders:i},r=function(e,t,r,n){return r=r||[],function(e,t){or(e,null,Zt,er,t);for(const r of t)or(e&&e[r.id]||{},r.id,r.options&&r.options[r.id]||{},r.deprecatedOptions&&r.deprecatedOptions[r.id]||{},t)}(e,r=Array.isArray(r)?r:[r]),function(e,t,r){const n={...e.options||{}};return function(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}(n,r),null===n.log&&(n.log=new $t),sr(n,rr()),sr(n,t),n}(t,e,n)}(r,s,i,o),n),await async function(e,t,r,n){if(m(e,"no worker provided"),vt(t)){const e=t,{ok:r,redirected:o,status:i,statusText:s,type:a,url:c}=e,u=Object.fromEntries(e.headers.entries());n.response={headers:u,ok:r,redirected:o,status:i,statusText:s,type:a,url:c}}if(t=await async function(e,t,r){const n=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||n)return function(e,t,r){if(t.text&&"string"==typeof e)return e;if(bt(e)&&(e=e.buffer),e instanceof ArrayBuffer){const r=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let r=e.buffer;const n=e.byteLength||e.length;return 0===e.byteOffset&&n===r.byteLength||(r=r.slice(e.byteOffset,e.byteOffset+n)),r}throw new Error(Tr)}(e,t);if(wt(e)&&(e=await At(e)),vt(e)){const r=e;return await async function(e){if(!e.ok){const t=await async function(e){let t="Failed to fetch resource ".concat(e.url," (").concat(e.status,"): ");try{const r=e.headers.get("Content-Type");let n=e.statusText;r.includes("application/json")&&(n+=" ".concat(await e.text())),t+=n,t=t.length>60?"".concat(t.slice(0,60),"..."):t}catch(e){}return t}(e);throw new Error(t)}}(r),t.binary?await r.arrayBuffer():await r.text()}if(xt(e)&&(e=function(e,t){if("string"==typeof e)return function*(e,t){const r=(null==t?void 0:t.chunkSize)||br;let n=0;const o=new TextEncoder;for(;n<e.length;){const t=Math.min(e.length-n,r),i=e.slice(n,n+t);n+=t,yield o.encode(i)}}(e,t);if(e instanceof ArrayBuffer)return function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{chunkSize:r=xr}=t;let n=0;for(;n<e.byteLength;){const t=Math.min(e.byteLength-n,r),o=new ArrayBuffer(t),i=new Uint8Array(e,n,t);new Uint8Array(o).set(i),n+=t,yield o}}(e,t);if(wt(e))return async function*(e,t){const r=(null==t?void 0:t.chunkSize)||Sr;let n=0;for(;n<e.size;){const t=n+r,o=await e.slice(n,t).arrayBuffer();n=t,yield o}}(e,t);if(xt(e))return Mr(e,t);if(vt(e))return Mr(e.body,t);throw new Error("makeIterator")}(e,r)),mt(e)||yt(e))return async function(e){const t=[];for await(const r of e)t.push(r);return Q(...t)}(e);throw new Error(Tr)}(t,e,r),e.parseTextSync&&"string"==typeof t)return r.dataType="text",e.parseTextSync(t,r,n,e);if(function(e,t){return!!O.isSupported()&&!!(w||null!=t&&t._nodeWorkers)&&e.worker&&(null==t?void 0:t.worker)}(e,r))return await V(e,t,r,n,Er);if(e.parseText&&"string"==typeof t)return await e.parseText(t,r,n,e);if(e.parse)return await e.parse(t,r,n,e);throw m(!e.parseSync),new Error("".concat(e.id," loader - no parser found and worker is disabled"))}(s,e,r,n)):null}async function kr(e,t,r){if(function(e,t){return!!O.isSupported()&&!!(g||null!=t&&t._nodeWorkers)&&e.worker&&(null==t?void 0:t.worker)}(t,r={...rr(),...r}))return await R(t,e,r);if(t.encode)return await t.encode(e,r);if(t.encodeSync)return t.encodeSync(e,r);if(t.encodeText)return(new TextEncoder).encode(await t.encodeText(e,r));if(t.encodeInBatches){const n=function(e,t,r){if(t.encodeInBatches){const n=function(e){return[{table:e,start:0,end:e.length}]}(e);return t.encodeInBatches(n,r)}throw new Error("Writer could not encode data in batches")}(e,t,r),o=[];for await(const e of n)o.push(e);return Q(...o)}if(!g&&t.encodeURLtoURL){const n=_r("input");await async function(e,t,r){e=z(e),g||await(void 0)(e,t,{flag:"w"}),p(!1)}(n,e);const o=_r("output"),i=await async function(e,t,r,n){if(e=z(e),t=z(t),g||!r.encodeURLtoURL)throw new Error;return await r.encodeURLtoURL(e,t,n)}(n,o,t,r);return(await Bt(i)).arrayBuffer()}throw new Error("Writer could not encode data")}function _r(e){return"/tmp/".concat(e)}var Dr={0:{useSRGB:!0,qualityLevel:50,encodeUASTC:!0,mipmaps:!0},3:{useSRGB:!0,encodeUASTC:!0,qualityLevel:10,mipmaps:!1},1:{useSRGB:!1,encodeUASTC:!0,qualityLevel:50,mipmaps:!0},2:{useSRGB:!1,encodeUASTC:!0,qualityLevel:10,mipmaps:!1},4:{useSRGB:!1,encodeUASTC:!0,qualityLevel:10,mipmaps:!1}},Ar=/*#__PURE__*/f("texturesList"),Br=/*#__PURE__*/f("numObjects"),jr=/*#__PURE__*/f("meshUsedByObject"),Ir=/*#__PURE__*/f("removeUnusedTextures"),Pr=/*#__PURE__*/f("compressTextures"),Lr=/*#__PURE__*/function(e){function r(r,o){var i;return i=e.call(this,r,{id:o.id})||this,Object.defineProperty(l(i),Pr,{value:Cr}),Object.defineProperty(l(i),Ir,{value:Or}),i.scene=void 0,i.layerId=void 0,i.built=void 0,i.edgeThreshold=void 0,i.geometries=void 0,i.textures=void 0,i.textureSets=void 0,i.meshes=void 0,i.objects=void 0,i.aabb=void 0,i.onBuilt=void 0,i.rendererModel=void 0,Object.defineProperty(l(i),Ar,{writable:!0,value:void 0}),Object.defineProperty(l(i),Br,{writable:!0,value:void 0}),Object.defineProperty(l(i),jr,{writable:!0,value:void 0}),i.scene=r,i.onBuilt=new t.EventEmitter(new n.EventDispatcher),i.onDestroyed=new t.EventEmitter(new n.EventDispatcher),h(l(i),Br)[Br]=0,h(l(i),jr)[jr]={},i.id=o.id||"default",i.layerId=o.layerId,i.edgeThreshold=10,i.geometries={},i.textures={},h(l(i),Ar)[Ar]=[],i.textureSets={},i.meshes={},i.objects={},i.aabb=Ee(),i.built=!1,i.rendererModel=null,i.fromJSON(o),i}c(r,e);var o=r.prototype;return o.fromJSON=function(e){if(this.destroyed)return new t.SDKError("Failed to add components to SceneModel - SceneModel already destroyed");if(this.built)return new t.SDKError("Failed to add components to SceneModel - SceneModel already built");if(e.geometries)for(var r=0,n=e.geometries.length;r<n;r++)this.createGeometry(e.geometries[r]);if(e.textures)for(var o=0,i=e.textures.length;o<i;o++)this.createTexture(e.textures[o]);if(e.textureSets)for(var s=0,a=e.textureSets.length;s<a;s++)this.createTextureSet(e.textureSets[s]);if(e.meshes)for(var c=0,u=e.meshes.length;c<u;c++)this.createMesh(e.meshes[c]);if(e.objects)for(var l=0,d=e.objects.length;l<d;l++)this.createObject(e.objects[l])},o.createTransform=function(e){return this.destroyed?new t.SDKError("Failed to create Transform in SceneModel - SceneModel already destroyed"):this.built?new t.SDKError("Failed to create Transform in SceneModel - SceneModel already built"):void 0},o.createTexture=function(e){if(this.destroyed)return new t.SDKError("Failed to create Texture in SceneModel - SceneModel already destroyed");if(this.built)return new t.SDKError("Failed to create Texture in SceneModel - SceneModel already built");if(!e.imageData&&!e.src&&!e.buffers)return new t.SDKError("Failed to create Texture in SceneModel - Parameter expected: textureParams.imageData, textureParams.src or textureParams.buffers");if(this.textures[e.id])return new t.SDKError("Failed to create Texture in SceneModel - Texture already exists with this ID: "+e.id);e.src&&e.src.split(".").pop();var r=new Fe(e);return this.textures[e.id]=r,h(this,Ar)[Ar].push(r),r},o.createTextureSet=function(e){if(this.destroyed)return new t.SDKError("Failed to create TextureSet in SceneModel - SceneModel already destroyed");if(this.built)return new t.SDKError("Failed to create TextureSet in SceneModel - SceneModel already built");if(this.textureSets[e.id])return new t.SDKError("Failed to create TextureSet in SceneModel - TextureSet already exists with this ID: "+e.id);var r,n,o,i,s;if(null!=e.colorTextureId){if(!(r=this.textures[e.colorTextureId]))return new t.SDKError("Failed to create TextureSet in SceneModel - Texture not found: "+e.colorTextureId+" - ensure that you create it first with createTexture()");r.channel=0}if(null!=e.metallicRoughnessTextureId){if(!(n=this.textures[e.metallicRoughnessTextureId]))return new t.SDKError("Failed to create TextureSet in SceneModel - Texture not found: "+e.metallicRoughnessTextureId+" - ensure that you create it first with createTexture()");n.channel=1}if(null!=e.normalsTextureId){if(!(o=this.textures[e.normalsTextureId]))return new t.SDKError("Failed to create TextureSet in SceneModel - Texture not found: "+e.normalsTextureId+" - ensure that you create it first with createTexture()");o.channel=2}if(null!=e.emissiveTextureId){if(!(i=this.textures[e.emissiveTextureId]))return new t.SDKError("Failed to create TextureSet in SceneModel - Texture not found: "+e.emissiveTextureId+" - ensure that you create it first with createTexture()");i.channel=3}if(null!=e.occlusionTextureId){if(!(s=this.textures[e.occlusionTextureId]))return new t.SDKError("Failed to create TextureSet in SceneModel - Texture not found: "+e.occlusionTextureId+" - ensure that you create it first with createTexture()");s.channel=4}var a=new Ue(e,{emissiveTexture:i,occlusionTexture:s,metallicRoughnessTexture:n,colorTexture:r});return this.textureSets[e.id]=a,a},o.createGeometry=function(e){if(this.destroyed)return new t.SDKError("Failed to create Geometry in SceneModel - SceneModel already destroyed");if(this.built)return new t.SDKError("Failed to create Geometry in SceneModel - SceneModel already built");if(!e)return new t.SDKError("Failed to create Geometry in SceneModel - Parameters expected: geometryParams");if(null==e.id)return new t.SDKError("Failed to create Geometry in SceneModel - Parameter expected: geometryParams.id");var r=e.id;if(this.geometries[r])return new t.SDKError("Failed to create Geometry in SceneModel - Geometry with this ID already created: "+r);var n=e.primitive;if(n!==be&&n!==xe&&n!==Se&&n!==Me&&n!==Te)return new t.SDKError("Failed to create Geometry in SceneModel - Unsupported value for geometryParams.primitive: '"+n+"' - supported values are PointsPrimitive, LinesPrimitive, TrianglesPrimitive, SolidPrimitive and SurfacePrimitive");if(!e.positions)return new t.SDKError("Failed to create Geometry in SceneModel - Param expected: geometryParams.positions");if(!e.indices&&n!==be)return new t.SDKError("Failed to create Geometry in SceneModel - Param expected: geometryParams.indices (required for primitive type)");if(e.uvs&&e.uvs.length/2!=e.positions.length/3)return new t.SDKError("Failed to create Geometry in SceneModel - mismatch between given quantities of vertex positions and UVs");if(e.indices)for(var o=e.positions.length/3,i=0,s=e.indices.length;i<s;i++){var a=e.indices[i];if(a<0||a>=o)return new t.SDKError("Failed to create Geometry in SceneModel - indices out of range of vertex positions");if(e.uvs&&(a<0||a>=e.uvs.length/2))return new t.SDKError("Failed to create Geometry in SceneModel - indices out of range of vertex UVs")}var c=new Ae(ft(e));return this.geometries[r]=c,c},o.createGeometryCompressed=function(e){if(this.destroyed)return new t.SDKError("Failed to add compressed Geometry to SceneModel - SceneModel already destroyed");if(this.built)return new t.SDKError("Failed to add compressed Geometry to SceneModel - SceneModel already built");if(!e)return new t.SDKError("Failed to add compressed Geometry to SceneModel - Parameters expected: geometryCompressedParams");var r=e.id;if(this.geometries[r])return new t.SDKError("Failed to add compressed Geometry to SceneModel - Geometry with this ID already created: "+r);var n=e.primitive;if(n!==be&&n!==xe&&n!==Se&&n!==Me&&n!==Te)return new t.SDKError("Failed to add compressed Geometry to SceneModel - Unsupported value for geometryCompressedParams.primitive: '"+n+"' - supported values are PointsPrimitive, LinesPrimitive, TrianglesPrimitive, SolidPrimitive and SurfacePrimitive");var o=new Ae(e);return this.geometries[r]=o,o},o.createMesh=function(e){if(this.destroyed)return new t.SDKError("Failed to create Mesh in SceneModel - SceneModel already destroyed");if(this.built)return new t.SDKError("Failed to create Mesh in SceneModel - SceneModel already built");if(this.meshes[e.id])return new t.SDKError("Failed to create Mesh in SceneModel - Mesh already exists with this ID: "+e.id);var r=this.geometries[e.geometryId];if(!r)return new t.SDKError("Failed to create Mesh in SceneModel - Geometry not found: "+e.geometryId);var n=e.textureSetId?this.textureSets[e.textureSetId]:void 0;if(e.textureSetId&&!n)return new t.SDKError("Failed to create Mesh in SceneModel - TextureSet not found: "+e.textureSetId);var o=new Ve({id:e.id,geometry:r,textureSet:n,matrix:e.matrix,color:e.color,opacity:e.opacity,roughness:e.roughness,metallic:e.metallic});return this.meshes[e.id]=o,o},o.createObject=function(e){if(this.destroyed)return new t.SDKError("Failed to create SceneObject - SceneModel already destroyed");if(this.built)return new t.SDKError("Failed to create SceneObject SceneModel already built");if(0===e.meshIds.length)return new t.SDKError("Failed to create SceneObject - no meshes specified");if(this.scene.objects[e.id])return new t.SDKError("Failed to create SceneObject - SceneObject already exists in Scene: "+e.id);for(var r=e.meshIds,n=[],o=0,i=r.length;o<i;o++){var s=r[o],a=this.meshes[s];if(!a)return new t.SDKError("Failed to create SceneObject - Mesh not found: "+s);if(h(this,jr)[jr][s])return new t.SDKError("Failed to create SceneObject - Mesh "+s+" already belongs to another SceneObject");n.push(a),h(this,jr)[jr][a.id]=!0}for(var c=new Ce({id:e.id,layerId:e.layerId||this.layerId,model:this,meshes:n}),u=0,l=n.length;u<l;u++)n[u].object=c;return h(this,Br)[Br]++,this.objects[e.id]=c,c},o.build=function(){try{var e=this;return Promise.resolve(new Promise(function(r){if(e.destroyed)throw new t.SDKError("Failed to build SceneModel - SceneModel already destroyed");if(e.built)throw new t.SDKError("Failed to build SceneModel - SceneModel already built");h(e,Ir)[Ir](),h(e,Pr)[Pr]().then(function(){e.built=!0,e.onBuilt.dispatch(e,null),r(e)}).catch(function(e){throw e})}))}catch(e){return Promise.reject(e)}},r}(t.Component);function Or(){}function Cr(){var e=this,r=h(this,Ar)[Ar].length;return new Promise(function(n){if(0!==r)for(var o=function(){var o=h(e,Ar)[Ar][i],s=Dr[o.channel]||{};if(o.src){var a=o.src;switch(a.split(".").pop()){case"jpeg":case"jpg":case"png":(async function(e,t,r,n){Array.isArray(t)||ar(t)||(r=t,t=void 0);const o=nr(r);let i=e;return"string"==typeof e&&(i=await o(e)),wt(e)&&(i=await o(e)),await Er(i,t,r)})(a,ve,{image:{type:"data"}}).then(function(e){o.compressed?kr(e,te,s).then(function(e){var t=new Uint8Array(e);o.imageData=t,--r<=0&&n()}).catch(function(e){return new t.SDKError("Failed to compress texture: "+e)}):(o.imageData=new Uint8Array(1),--r<=0&&n())}).catch(function(e){return new t.SDKError("Failed to load texture image: "+e)});break;default:--r<=0&&n()}}o.imageData&&(o.compressed?kr(o.imageData,te,s).then(function(e){o.imageData=new Uint8Array(e),--r<=0&&n()}).catch(function(e){return new t.SDKError("Failed to compress texture: "+e)}):(o.imageData=new Uint8Array(1),--r<=0&&n()))},i=0,s=h(e,Ar)[Ar].length;i<s;i++)o();else n()})}var Ur=/*#__PURE__*/f("onModelBuilts"),Fr=/*#__PURE__*/f("onModelDestroys"),Rr=/*#__PURE__*/f("center"),Gr=/*#__PURE__*/f("aabbDirty"),Kr=/*#__PURE__*/f("aabb"),Wr=/*#__PURE__*/f("registerObjects"),Nr=/*#__PURE__*/f("deregisterObjects"),Vr=/*#__PURE__*/function(e){function o(){var r;return r=e.call(this,null,{})||this,Object.defineProperty(l(r),Nr,{value:Qr}),Object.defineProperty(l(r),Wr,{value:Hr}),r.models=void 0,r.objects=void 0,r.onModelCreated=void 0,r.onModelDestroyed=void 0,Object.defineProperty(l(r),Ur,{writable:!0,value:void 0}),Object.defineProperty(l(r),Fr,{writable:!0,value:void 0}),Object.defineProperty(l(r),Rr,{writable:!0,value:void 0}),Object.defineProperty(l(r),Gr,{writable:!0,value:void 0}),Object.defineProperty(l(r),Kr,{writable:!0,value:void 0}),h(l(r),Kr)[Kr]=Ee(),h(l(r),Gr)[Gr]=!0,r.models={},r.objects={},h(l(r),Ur)[Ur]={},h(l(r),Fr)[Fr]={},r.onModelCreated=new t.EventEmitter(new n.EventDispatcher),r.onModelDestroyed=new t.EventEmitter(new n.EventDispatcher),r}c(o,e);var i=o.prototype;return i.createModel=function(e){var r=this;if(this.destroyed)return new t.SDKError("Scene already destroyed");var n=e.id;if(this.models[n])return new t.SDKError("SceneModel already created in this Scene: "+n);var o=new Lr(this,e);return this.models[n]=o,o.onDestroyed.one(function(){delete r.models[o.id],h(r,Nr)[Nr](o),r.onModelDestroyed.dispatch(r,o)}),o.onBuilt.one(function(){h(r,Wr)[Wr](o),r.onModelCreated.dispatch(r,o)}),o},i.setAABBDirty=function(){h(this,Gr)[Gr]||(h(this,Gr)[Gr]=!0)},i.clear=function(){if(this.destroyed)return new t.SDKError("Scene already destroyed");for(var e in this.models)this.models[e].destroy()},i.destroy=function(){this.clear(),this.onModelCreated.clear(),this.onModelDestroyed.clear(),e.prototype.destroy.call(this)},a(o,[{key:"center",get:function(){if(h(this,Gr)[Gr]){var e=this.aabb;h(this,Rr)[Rr][0]=(e[0]+e[3])/2,h(this,Rr)[Rr][1]=(e[1]+e[4])/2,h(this,Rr)[Rr][2]=(e[2]+e[5])/2}return h(this,Rr)[Rr]}},{key:"aabb",get:function(){if(h(this,Gr)[Gr]){var e,t=r.MAX_DOUBLE,n=r.MAX_DOUBLE,o=r.MAX_DOUBLE,i=r.MIN_DOUBLE,s=r.MIN_DOUBLE,a=r.MIN_DOUBLE,c=this.objects,u=!1;for(var l in c)c.hasOwnProperty(l)&&((e=c[l].aabb)[0]<t&&(t=e[0]),e[1]<n&&(n=e[1]),e[2]<o&&(o=e[2]),e[3]>i&&(i=e[3]),e[4]>s&&(s=e[4]),e[5]>a&&(a=e[5]),u=!0);u||(t=-100,n=-100,o=-100,i=100,s=100,a=100),h(this,Kr)[Kr][0]=t,h(this,Kr)[Kr][1]=n,h(this,Kr)[Kr][2]=o,h(this,Kr)[Kr][3]=i,h(this,Kr)[Kr][4]=s,h(this,Kr)[Kr][5]=a,h(this,Gr)[Gr]=!1}return h(this,Kr)[Kr]}}]),o}(t.Component);function Hr(e){var t=e.objects;for(var r in t){var n=t[r];this.objects[n.id]=n}h(this,Gr)[Gr]=!0}function Qr(e){var t=e.objects;for(var r in t)delete this.objects[t[r].id];h(this,Gr)[Gr]=!0}e.Geometry=Ae,e.GeometryBucket=De,e.Mesh=Ve,e.Scene=Vr,e.SceneModel=Lr,e.SceneObject=Ce,e.Texture=Fe,e.TextureSet=Ue,e.compressGeometryParams=ft,e.getSceneObjectGeometry=Pe});
//# sourceMappingURL=index.umd.js.map
