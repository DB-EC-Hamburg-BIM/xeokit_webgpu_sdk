import{createVec4 as e,identityMat4 as t,transformPoint4 as i,createVec3 as r,createMat4 as s,transformPoint3 as n,mulMat4 as o,translationMat4c as h,identityQuat as a,eulerToQuat as l,composeMat4 as c,transformVec4 as d,setMat4Translation as u}from"@xeokit/matrix";import{OrthoProjectionType as f,PointsPrimitive as g,LinesPrimitive as p,SolidPrimitive as m,SurfacePrimitive as v,TrianglesPrimitive as E}from"@xeokit/constants";import{WEBGL_INFO as T,GLProgram as b,GLDataTexture as x,GLTexture as _,getExtension as w}from"@xeokit/webglutils";import{AmbientLight as M,DirLight as y,PointLight as P}from"@xeokit/viewer";import{EventDispatcher as C}from"strongly-typed-events";import{Component as I,EventEmitter as R}from"@xeokit/core";import{collapseAABB3 as S,AABB3ToOBB3 as D,expandAABB3Point3 as O,createAABB3 as B,expandAABB3 as A}from"@xeokit/boundaries";var L=0;function U(e){return"__private_"+L+++"_"+e}function F(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var j=0;function G(e){return"__private_"+j+++"_"+e}function N(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var H=/*#__PURE__*/G("items"),X=/*#__PURE__*/G("lastUniqueId"),k=/*#__PURE__*/function(){function e(e,t){Object.defineProperty(this,H,{writable:!0,value:void 0}),Object.defineProperty(this,X,{writable:!0,value:void 0}),N(this,H)[H]=e||[],N(this,X)[X]=(t||0)+1}var t=e.prototype;return t.addItem=function(){var e;if(2===arguments.length){var t=arguments[0];if(e=arguments[1],N(this,H)[H][t])throw"ID clash: '"+t+"'";return N(this,H)[H][t]=e,t}for(e=arguments[0]||{};;){var i=N(this,X)[X]++;if(!N(this,H)[H][i])return N(this,H)[H][i]=e,i}},t.removeItem=function(e){var t=N(this,H)[H][e];return delete N(this,H)[H][e],t},e}();[["0",10],["A",26],["a",26],["_",1],["$",1]].map(function(e){for(var t=[],i=e[0].charCodeAt(0),r=i+e[1],s=i;s<r;++s)t.push(s);return String.fromCharCode.apply(null,t)}).join("");var V=function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0,s=4294967295*Math.random()|0;return e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&i]+e[i>>8&255]+"-"+e[i>>16&15|64]+e[i>>24&255]+"-"+e[63&r|128]+e[r>>8&255]+"-"+e[r>>16&255]+e[r>>24&255]+e[255&s]+e[s>>8&255]+e[s>>16&255]+e[s>>24&255]}}(),W=0;function z(e){return"__private_"+W+++"_"+e}function $(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}function q(e,t){return q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},q(e,t)}var Y=/*#__PURE__*/function(){function e(e,t,i){this.isLoading=void 0,this.itemsLoaded=void 0,this.itemsTotal=void 0,this.urlModifier=void 0,this.handlers=void 0,this.onStart=void 0,this.onLoad=void 0,this.onProgress=void 0,this.onError=void 0,this.isLoading=!1,this.itemsLoaded=0,this.itemsTotal=0,this.urlModifier=void 0,this.handlers=[],this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i}var t=e.prototype;return t.itemStart=function(e){this.itemsTotal++,this.isLoading||void 0!==this.onStart&&this.onStart(e,this.itemsLoaded,this.itemsTotal),this.isLoading=!0},t.itemEnd=function(e){this.itemsLoaded++,void 0!==this.onProgress&&this.onProgress(e,this.itemsLoaded,this.itemsTotal),this.itemsLoaded===this.itemsTotal&&(this.isLoading=!1,void 0!==this.onLoad&&this.onLoad())},t.itemError=function(e){void 0!==this.onError&&this.onError(e)},t.resolveURL=function(e){return this.urlModifier?this.urlModifier(e):e},t.setURLModifier=function(e){return this.urlModifier=e,this},t.addHandler=function(e,t){return this.handlers.push(e,t),this},t.removeHandler=function(e){var t=this.handlers.indexOf(e);return-1!==t&&this.handlers.splice(t,2),this},t.getHandler=function(e){for(var t=0,i=this.handlers.length;t<i;t+=2){var r=this.handlers[t],s=this.handlers[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return s}return null},e}(),K=new Y,Z=/*#__PURE__*/function(){function e(e){this.manager=void 0,this.crossOrigin=void 0,this.withCredentials=void 0,this.path=void 0,this.resourcePath=void 0,this.requestHeader=void 0,this.manager=void 0!==e?e:K,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}var t=e.prototype;return t.load=function(e,t,i,r){},t.loadAsync=function(e,t){var i=this;return new Promise(function(r,s){i.load(e,r,t,s)})},t.parse=function(){},t.setCrossOrigin=function(e){return this.crossOrigin=e,this},t.setWithCredentials=function(e){return this.withCredentials=e,this},t.setPath=function(e){return this.path=e,this},t.setResourcePath=function(e){return this.resourcePath=e,this},t.setRequestHeader=function(e){return this.requestHeader=e,this},e}(),Q=/*#__PURE__*/function(){function e(e){void 0===e&&(e=4),this.pool=void 0,this.queue=void 0,this.workers=void 0,this.workersResolve=void 0,this.workerStatus=void 0,this.workerCreator=void 0,this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}var t=e.prototype;return t._initWorker=function(e){if(!this.workers[e]){var t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}},t._getIdleWorker=function(){for(var e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1},t._onMessage=function(e,t){var i=this.workersResolve[e];if(i&&i(t),this.queue.length){var r=this.queue.shift(),s=r.msg,n=r.transfer;this.workersResolve[e]=r.resolve,this.workers[e].postMessage(s,n)}else this.workerStatus^=1<<e},t.setWorkerCreator=function(e){this.workerCreator=e},t.setWorkerLimit=function(e){this.pool=e},t.postMessage=function(e,t){var i=this;return new Promise(function(r){var s=i._getIdleWorker();-1!==s?(i._initWorker(s),i.workerStatus|=1<<s,i.workersResolve[s]=r,i.workers[s].postMessage(e,t)):i.queue.push({resolve:r,msg:e,transfer:t})})},t.destroy=function(){this.workers.forEach(function(e){return e.terminate()}),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0},e}(),J={},ee=/*#__PURE__*/function(e){var t,i;function r(t){var i;return(i=e.call(this,t)||this).mimeType=void 0,i.responseType=void 0,i}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,q(t,i);var s=r.prototype;return s.load=function(e,t,i,r){var s=this;if(void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e),void 0===J[e]){J[e]=[],J[e].push({onLoad:t,onProgress:i,onError:r});var n=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,h=this.responseType;fetch(n).then(function(t){if(200===t.status||0===t.status){if(0===t.status&&console.warn("FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body.getReader)return t;var i=J[e],r=t.body.getReader(),s=t.headers.get("Content-Length"),n=s?parseInt(s):0,o=0!==n,h=0,a=new ReadableStream({start:function(e){!function t(){r.read().then(function(r){var s=r.value;if(r.done)e.close();else{for(var a=new ProgressEvent("progress",{lengthComputable:o,loaded:h+=s.byteLength,total:n}),l=0,c=i.length;l<c;l++){var d=i[l];d.onProgress&&d.onProgress(a)}e.enqueue(s),t()}})}()}});return new Response(a)}throw new Error('fetch for "'+t.url+'" responded with '+t.status+": "+t.statusText)}).then(function(e){switch(h){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(function(e){return(new DOMParser).parseFromString(e,o)});case"json":return e.json();default:if(void 0===o)return e.text();var t=/charset="?([^;"\s]*)"?/i.exec(o),i=t&&t[1]?t[1].toLowerCase():void 0,r=new TextDecoder(i);return e.arrayBuffer().then(function(e){return r.decode(e)})}}).then(function(t){var i=J[e];delete J[e];for(var r=0,s=i.length;r<s;r++){var n=i[r];n.onLoad&&n.onLoad(t)}}).catch(function(t){var i=J[e];if(void 0===i)throw s.manager.itemError(e),t;delete J[e];for(var r=0,n=i.length;r<n;r++){var o=i[r];o.onError&&o.onError(t)}s.manager.itemError(e)}).finally(function(){s.manager.itemEnd(e)}),this.manager.itemStart(e)}else J[e].push({onLoad:t,onProgress:i,onError:r})},s.setResponseType=function(e){return this.responseType=e,this},s.setMimeType=function(e){return this.mimeType=e,this},r}(Z);[["0",10],["A",26],["a",26],["_",1],["$",1]].map(function(e){for(var t=[],i=e[0].charCodeAt(0),r=i+e[1],s=i;s<r;++s)t.push(s);return String.fromCharCode.apply(null,t)}).join(""),function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16)}();var te=0,ie={ETC1S:0,UASTC_4x4:1},re={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},se={RGBAFormat:1023,RGBA_ASTC_4x4_Format:37808,RGBA_BPTC_Format:36492,RGBA_ETC2_EAC_Format:37496,RGBA_PVRTC_4BPPV1_Format:35842,RGBA_S3TC_DXT5_Format:33779,RGB_ETC1_Format:36196,RGB_ETC2_Format:37492,RGB_PVRTC_4BPPV1_Format:35840,RGB_S3TC_DXT1_Format:33776},ne=/*#__PURE__*/z("transcoderPath"),oe=/*#__PURE__*/z("transcoderBinary"),he=/*#__PURE__*/z("transcoderPending"),ae=/*#__PURE__*/z("workerPool"),le=/*#__PURE__*/z("workerSourceURL"),ce=/*#__PURE__*/z("workerConfig"),de=/*#__PURE__*/z("supportedFileTypes"),ue=/*#__PURE__*/z("withCredentials"),fe=/*#__PURE__*/z("initTranscoder"),ge=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,fe,{value:pe}),Object.defineProperty(this,ne,{writable:!0,value:void 0}),Object.defineProperty(this,oe,{writable:!0,value:void 0}),Object.defineProperty(this,he,{writable:!0,value:void 0}),Object.defineProperty(this,ae,{writable:!0,value:void 0}),Object.defineProperty(this,le,{writable:!0,value:void 0}),Object.defineProperty(this,ce,{writable:!0,value:void 0}),Object.defineProperty(this,de,{writable:!0,value:void 0}),Object.defineProperty(this,ue,{writable:!0,value:void 0}),$(this,ne)[ne]=e.transcoderPath||"https://cdn.jsdelivr.net/npm/@xeokit/sdk/dist/basis/",$(this,oe)[oe]=null,$(this,he)[he]=null,$(this,ae)[ae]=new Q,$(this,le)[le]="",e.workerLimit&&$(this,ae)[ae].setWorkerLimit(e.workerLimit),$(this,ce)[ce]=null,$(this,ue)[ue]=!1,$(this,de)[de]=["xkt2"]}var t=e.prototype;return t.init=function(e){$(this,ce)[ce]={astcSupported:e.astcSupported,etc1Supported:e.etc1Supported,etc2Supported:e.etc2Supported,dxtSupported:e.dxtSupported,bptcSupported:e.bptcSupported,pvrtcSupported:e.pvrtcSupported}},t.transcode=function(e,t){var i=this;return void 0===t&&(t={}),new Promise(function(r,s){var n=t;$(i,fe)[fe]().then(function(){return $(i,ae)[ae].postMessage({type:"transcode",buffers:e,taskConfig:n},e)}).then(function(e){var t=e.data,i=t.mipmaps,n=t.format,o=t.dfdTransferFn,h=t.dfdFlags;if("error"===t.type)return s(t.error);r({mipmaps:i,props:{format:n,minFilter:1===i.length?1006:1008,magFilter:1===i.length?1006:1008,encoding:2===o?3001:3e3,premultiplyAlpha:!!(1&h)}})})})},t.destroy=function(){URL.revokeObjectURL($(this,le)[le]),$(this,ae)[ae].destroy(),te--},e}();function pe(){var e=this;if(!$(this,he)[he]){var t=new ee;t.setPath($(this,ne)[ne]),t.setWithCredentials($(this,ue)[ue]);var i=t.loadAsync("basis_transcoder.js"),r=new ee;r.setPath($(this,ne)[ne]),r.setResponseType("arraybuffer"),r.setWithCredentials($(this,ue)[ue]);var s=r.loadAsync("basis_transcoder.wasm");$(this,he)[he]=Promise.all([i,s]).then(function(t){var i=t[0],r=t[1],s=me.toString(),n=["/* constants */","let _EngineFormat = "+JSON.stringify(se),"let _TranscoderFormat = "+JSON.stringify(re),"let _BasisFormat = "+JSON.stringify(ie),"/* basis_transcoder.js */",i,"/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join("\n");$(e,le)[le]=URL.createObjectURL(new Blob([n])),$(e,oe)[oe]=r,$(e,ae)[ae].setWorkerCreator(function(){var t=new Worker($(e,le)[le]),i=$(e,oe)[oe].slice(0);return t.postMessage({type:"init",config:$(e,ce)[ce],transcoderBinary:i},[i]),t})}),te>0&&console.warn("KTX2TextureTranscoder: Multiple active KTX2TextureTranscoder may cause performance issues. Use a single KTX2TextureTranscoder instance, or call .dispose() on old instances."),te++}return $(this,he)[he]}var me=function(){var e,t,i,r=_EngineFormat,s=_TranscoderFormat,n=_BasisFormat;self.addEventListener("message",function(o){var c,d=o.data;switch(d.type){case"init":e=d.config,c=d.transcoderBinary,t=new Promise(function(e){i={wasmBinary:c,onRuntimeInitialized:e},BASIS(i)}).then(function(){i.initializeBasis(),void 0===i.KTX2File&&console.warn("KTX2TextureTranscoder: Please update Basis Universal transcoder.")});break;case"transcode":t.then(function(){try{for(var t=function(t){var o=new i.KTX2File(new Uint8Array(t));function c(){o.close(),o.delete()}if(!o.isValid())throw c(),new Error("KTX2TextureTranscoder: Invalid or unsupported .ktx2 file");var d=o.isUASTC()?n.UASTC_4x4:n.ETC1S,u=o.getWidth(),f=o.getHeight(),g=o.getLevels(),p=o.getHasAlpha(),m=o.getDFDTransferFunc(),v=o.getDFDFlags(),E=function(t,i,o,c){for(var d=t===n.ETC1S?h:a,u=0;u<d.length;u++){var f=d[u];if(e[f.if]&&f.basisFormat.includes(t)&&!(c&&f.transcoderFormat.length<2)&&(!f.needsPowerOfTwo||l(i)&&l(o)))return{transcoderFormat:f.transcoderFormat[c?1:0],engineFormat:f.engineFormat[c?1:0]}}return console.warn("KTX2TextureTranscoder: No suitable compressed texture format found. Decoding to RGBA32."),{transcoderFormat:s.RGBA32,engineFormat:r.RGBAFormat}}(d,u,f,p),T=E.transcoderFormat,b=E.engineFormat;if(!u||!f||!g)throw c(),new Error("KTX2TextureTranscoder: Invalid texture");if(!o.startTranscoding())throw c(),new Error("KTX2TextureTranscoder: .startTranscoding failed");for(var x=[],_=0;_<g;_++){var w=o.getImageLevelInfo(_,0,0),M=w.origWidth,y=w.origHeight,P=new Uint8Array(o.getImageTranscodedSizeInBytes(_,0,0,T));if(!o.transcodeImage(P,_,0,0,T,0,-1,-1))throw c(),new Error("KTX2TextureTranscoder: .transcodeImage failed.");x.push({data:P,width:M,height:y})}return c(),{width:u,height:f,hasAlpha:p,mipmaps:x,format:b,dfdTransferFn:m,dfdFlags:v}}(d.buffers[0]),o=t.width,c=t.height,u=t.hasAlpha,f=t.mipmaps,g=t.format,p=t.dfdTransferFn,m=t.dfdFlags,v=[],E=0;E<f.length;++E)v.push(f[E].data.buffer);self.postMessage({type:"transcode",id:d.id,width:o,height:c,hasAlpha:u,mipmaps:f,format:g,dfdTransferFn:p,dfdFlags:m},v)}catch(e){console.error("[BasisWorker]: "+e),self.postMessage({type:"error",id:d.id,error:e.message})}})}});var o=[{if:"astcSupported",basisFormat:[n.UASTC_4x4],transcoderFormat:[s.ASTC_4x4,s.ASTC_4x4],engineFormat:[r.RGBA_ASTC_4x4_Format,r.RGBA_ASTC_4x4_Format],priorityETC1S:Infinity,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[n.ETC1S,n.UASTC_4x4],transcoderFormat:[s.BC7_M5,s.BC7_M5],engineFormat:[r.RGBA_BPTC_Format,r.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[n.ETC1S,n.UASTC_4x4],transcoderFormat:[s.BC1,s.BC3],engineFormat:[r.RGB_S3TC_DXT1_Format,r.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[n.ETC1S,n.UASTC_4x4],transcoderFormat:[s.ETC1,s.ETC2],engineFormat:[r.RGB_ETC2_Format,r.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[n.ETC1S,n.UASTC_4x4],transcoderFormat:[s.ETC1],engineFormat:[r.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[n.ETC1S,n.UASTC_4x4],transcoderFormat:[s.PVRTC1_4_RGB,s.PVRTC1_4_RGBA],engineFormat:[r.RGB_PVRTC_4BPPV1_Format,r.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],h=o.sort(function(e,t){return e.priorityETC1S-t.priorityETC1S}),a=o.sort(function(e,t){return e.priorityUASTC-t.priorityUASTC});function l(e){return e<=2||0==(e&e-1)&&0!==e}};class ve{constructor(e,t,i){this.viewer=void 0,this.view=void 0,this.gl=void 0,this.viewMatrixDataTexture=void 0,this.pbrEnabled=void 0,this.withSAO=void 0,this.backfaces=void 0,this.frontface=void 0,this.textureUnit=void 0,this.bindTexture=void 0,this.renderPass=void 0,this.shadowViewMatrix=void 0,this.shadowProjMatrix=void 0,this.pickViewMatrix=void 0,this.pickProjMatrix=void 0,this.pickZNear=void 0,this.pickZFar=void 0,this.pickInvisible=void 0,this.lineWidth=void 0,this.lastProgramId=void 0,this.occlusionTexture=void 0,this.viewer=e,this.view=t,this.gl=i,this.reset()}reset(){this.lastProgramId=-1,this.pbrEnabled=!1,this.withSAO=!1,this.backfaces=!1,this.frontface=!0,this.textureUnit=0,this.shadowViewMatrix=null,this.shadowProjMatrix=null,this.pickViewMatrix=null,this.pickProjMatrix=null,this.pickZNear=.01,this.pickZFar=5e3,this.pickInvisible=!1,this.lineWidth=1,this.occlusionTexture=null}get nextTextureUnit(){const e=this.textureUnit;return this.textureUnit=(this.textureUnit+1)%T.MAX_TEXTURE_UNITS,e}}const Ee={NOT_RENDERED:0,COLOR_OPAQUE:1,COLOR_TRANSPARENT:2,SILHOUETTE_HIGHLIGHTED:3,SILHOUETTE_SELECTED:4,SILHOUETTE_XRAYED:5,EDGES_COLOR_OPAQUE:6,EDGES_COLOR_TRANSPARENT:7,EDGES_HIGHLIGHTED:8,EDGES_SELECTED:9,EDGES_XRAYED:10,PICK:11},Te=e();var be=/*#__PURE__*/U("hash"),xe=/*#__PURE__*/U("program"),_e=/*#__PURE__*/U("needRebuild"),we=/*#__PURE__*/U("uniforms"),Me=/*#__PURE__*/U("samplers"),ye=/*#__PURE__*/U("build"),Pe=/*#__PURE__*/U("buildShader"),Ce=/*#__PURE__*/U("getValid"),Ie=/*#__PURE__*/U("bind");class Re{constructor(e){Object.defineProperty(this,Ie,{value:Be}),Object.defineProperty(this,Ce,{value:Oe}),Object.defineProperty(this,Pe,{value:De}),Object.defineProperty(this,ye,{value:Se}),this.errors=void 0,this.renderContext=void 0,Object.defineProperty(this,be,{writable:!0,value:void 0}),Object.defineProperty(this,xe,{writable:!0,value:void 0}),Object.defineProperty(this,_e,{writable:!0,value:void 0}),Object.defineProperty(this,we,{writable:!0,value:void 0}),Object.defineProperty(this,Me,{writable:!0,value:void 0}),this.renderContext=e,F(this,_e)[_e]=!0,F(this,ye)[ye]()}needRebuild(){F(this,_e)[_e]=!0}draw(e){if(F(this,xe)[xe]&&!F(this,Ce)[Ce]()&&(F(this,xe)[xe].destroy(),F(this,xe)[xe]=null),!F(this,xe)[xe]){if(F(this,ye)[ye](),this.errors)return;this.renderContext.lastProgramId=-1}const t=e.renderState,i=F(this,xe)[xe],r=this.renderContext,s=r.renderPass,n=this.renderContext.gl,o=this.renderContext.view,h=F(this,we)[we],a=F(this,Me)[Me];if(r.lastProgramId!==i.id&&(r.lastProgramId=i.id,F(this,Ie)[Ie]()),h.renderPass&&n.uniform1i(h.renderPass,s),h.projMatrix&&n.uniformMatrix4fv(h.projMatrix,!1,o.camera.projMatrix),h.worldMatrix&&n.uniformMatrix4fv(h.worldMatrix,!1,e.rendererModel.worldMatrix),h.color)if(s===Ee.SILHOUETTE_XRAYED){const e=o.xrayMaterial,t=e.fillColor;n.uniform4f(h.color,t[0],t[1],t[2],e.fillAlpha)}else if(s===Ee.SILHOUETTE_HIGHLIGHTED){const e=o.highlightMaterial,t=e.fillColor;n.uniform4f(h.color,t[0],t[1],t[2],e.fillAlpha)}else if(s===Ee.SILHOUETTE_SELECTED){const e=o.selectedMaterial,t=e.fillColor;n.uniform4f(h.color,t[0],t[1],t[2],e.fillAlpha)}else n.uniform4fv(h.color,new Float32Array([1,1,1]));a.viewMatrices&&t.dataTextureSet.viewMatrices.bindTexture(i,a.viewMatrices,r.nextTextureUnit),a.positions&&t.dataTextureSet.positions.bindTexture(i,a.positions,r.nextTextureUnit),a.eachMeshMatrices&&t.dataTextureSet.eachMeshMatrices.bindTexture(i,a.eachMeshMatrices,r.nextTextureUnit),a.eachMeshAttributes&&t.dataTextureSet.eachMeshAttributes.bindTexture(i,a.eachMeshAttributes,r.nextTextureUnit),a.eachPrimitiveMesh&&(t.numIndices8Bits>0&&(t.dataTextureSet.eachPrimitiveMesh_8Bits.bindTexture(i,a.eachPrimitiveMesh,r.nextTextureUnit),t.dataTextureSet.indices_8Bits.bindTexture(i,a.indices,r.nextTextureUnit),n.drawArrays(n.TRIANGLES,0,t.numIndices8Bits)),t.numIndices16Bits>0&&(t.dataTextureSet.eachPrimitiveMesh_16Bits.bindTexture(i,a.eachPrimitiveMesh,r.nextTextureUnit),t.dataTextureSet.indices_16Bits.bindTexture(i,a.indices,r.nextTextureUnit),n.drawArrays(n.TRIANGLES,0,t.numIndices16Bits)),t.numIndices32Bits>0&&(t.dataTextureSet.eachPrimitiveMesh_32Bits.bindTexture(i,a.eachPrimitiveMesh,r.nextTextureUnit),t.dataTextureSet.indices_32Bits.bindTexture(i,a.indices,r.nextTextureUnit),n.drawArrays(n.TRIANGLES,0,t.numIndices32Bits))),a.baseColorMap&&a.baseColorMap.bindTexture(t.materialTextureSet.colorTexture.texture2D,r.nextTextureUnit),a.metallicRoughMap&&a.metallicRoughMap.bindTexture(t.materialTextureSet.metallicRoughnessTexture.texture2D,r.nextTextureUnit),a.emissiveMap&&a.emissiveMap.bindTexture(t.materialTextureSet.emissiveTexture.texture2D,r.nextTextureUnit),a.occlusionMap&&a.occlusionMap.bindTexture(t.materialTextureSet.occlusionTexture.texture2D,r.nextTextureUnit)}get vertHeader(){return"#version 300 es\n                #ifdef GL_FRAGMENT_PRECISION_HIGH\n                precision highp float;\n                precision highp int;\n                precision highp usampler2D;\n                precision highp isampler2D;\n                precision highp sampler2D;\n                #else\n                precision mediump float;\n                precision mediump int;\n                precision mediump usampler2D;\n                precision mediump isampler2D;\n                precision mediump sampler2D;\n                uniform int renderPass;\n                #endif"}get vertDataTextureDefs(){return"uniform mediump sampler2D eachMeshMatrices;\n                uniform lowp usampler2D eachMeshAttributes;\n                uniform highp sampler2D eachMeshOffset;\n                uniform mediump usampler2D positions;\n                uniform highp usampler2D indices;\n                uniform mediump usampler2D eachPrimitiveMesh;\n                uniform highp sampler2D cameraMatrices;\n                uniform highp sampler2D sceneModelRendererMatrices;"}get vertLogDepthBufDefs(){return this.renderContext.view.logarithmicDepthBufferEnabled?"uniform float logDepthBufFC;\n                    out float fragDepth;\n                    bool isPerspectiveMatrix(mat4 m) {\n                        return (m[2][3] == - 1.0);\n                    }\n                    out float isPerspective;":""}get vertDataTextureSamples(){return""}get vertLogDepthBufOutputs(){return this.renderContext.view.logarithmicDepthBufferEnabled?"fragDepth = 1.0 + clipPos.w;\n                    isPerspective = float (isPerspectiveMatrix(projMatrix));":""}get fragmentShader(){return`${this.fragHeader}\n        ${this.fragGammaDefs}\n        ${this.fragSectionPlaneDefs}\n        ${this.fragLightDefs}\n        ${this.fragLogDepthBufDefs}\n        void main(void) {\n            ${this.fragSectionPlanesSlice}\n            ${this.fragLighting}\n            ${this.fragLogDepthBufOutput}\n        }`}get fragHeader(){return"#version 300 es\n        #ifdef GL_FRAGMENT_PRECISION_HIGH\n       precision highp float;\n        precision highp int;\n        #else\n        precision mediump float;\n        precision mediump int;\n        #endif"}get fragGammaDefs(){return'uniform float gammaFactor;\n        vec4 linearToLinear( in vec4 value ) {\n            return value;\n        }\n        vec4 sRGBToLinear( in vec4 value ) {\n            return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n        }\n        vec4 gammaToLinear( in vec4 value) {\n            return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n        }\n        vec4 linearToGamma( in vec4 value, in float gammaFactor ) {\n              return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );");\n        }'}get fragLightDefs(){const e=this.renderContext.view,t=[];t.push("uniform vec4 lightAmbient;");for(let i=0,r=e.lightsList.length;i<r;i++){const r=e.lightsList[i];"ambient"!==r.type&&(t.push("uniform vec4 lightColor"+i+";"),"dir"===r.type&&t.push("uniform vec3 lightDir"+i+";"),"point"===r.type&&t.push("uniform vec3 lightPos"+i+";"),"spot"===r.type&&(t.push("uniform vec3 lightPos"+i+";"),t.push("uniform vec3 lightDir"+i+";")))}return t.join("\n")}get fragLogDepthBufDefs(){return this.renderContext.view.logarithmicDepthBufferEnabled?"in float isPerspective;\n                    uniform float logDepthBufFC;\n                    in float fragDepth;":""}get fragLogDepthBufOutput(){return this.renderContext.view.logarithmicDepthBufferEnabled?"gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( fragDepth ) * logDepthBufFC * 0.5;":""}get fragLighting(){const e=[];e.push("vec4 viewPosition  = viewMatrix * worldPosition; "),e.push("vec4 modelNormal = vec4(octDecode(normal.xy), 0.0); "),e.push("vec4 worldNormal = worldNormalMatrix * vec4(dot(modelNormal, modelNormalMatrixCol0), dot(modelNormal, modelNormalMatrixCol1), dot(modelNormal, modelNormalMatrixCol2), 0.0);"),e.push("vec3 viewNormal = normalize(vec4(viewNormalMatrix * worldNormal).xyz);"),e.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),e.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),e.push("float lambertian = 1.0;");for(let t=0,i=this.renderContext.view.lightsList.length;t<i;t++){const i=this.renderContext.view.lightsList[t];if("ambient"!==i.type){if("dir"===i.type)e.push("view"===i.space?"viewLightDir = normalize(lightDir"+t+");":"viewLightDir = normalize((viewMatrix * vec4(lightDir"+t+", 0.0)).xyz);");else if("point"===i.type)e.push("view"===i.space?"viewLightDir = -normalize(lightPos"+t+" - viewPosition.xyz);":"viewLightDir = -normalize((viewMatrix * vec4(lightPos"+t+", 0.0)).xyz);");else{if("spot"!==i.type)continue;e.push("view"===i.space?"viewLightDir = normalize(lightDir"+t+");":"viewLightDir = normalize((viewMatrix * vec4(lightDir"+t+", 0.0)).xyz);")}e.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),e.push("reflectedColor += lambertian * (lightColor"+t+".rgb * lightColor"+t+".a);")}}return e.push("vec3 rgb = (vec3(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0));"),e.push("meshColor =  vec4((lightAmbient.rgb * lightAmbient.a * rgb) + (reflectedColor * rgb), float(color.a) / 255.0);"),e.join("\n")}get fragSAOOutput(){return this.renderContext.view.sao.enabled?"float viewportWidth     = uSAOParams[0];\n                    float viewportHeight    = uSAOParams[1];\n                    float blendCutoff       = uSAOParams[2];\n                    float blendFactor       = uSAOParams[3];\n                    vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);\n                    float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture(uOcclusionTexture, uv))) * blendFactor;\n                    outColor                = vec4(fragColor.rgb * ambient, 1.0);":"outColor            = fragColor;"}get fragOutput(){return"outColor            = fragColor;"}get fragSectionPlaneDefs(){const e=[];e.push("in vec4 worldPosition;\n                  in vec4 meshFlags2;");for(let t=0,i=this.renderContext.view.sectionPlanesList.length;t<i;t++)e.push(`uniform bool sectionPlaneActive${t};\n                      uniform vec3 sectionPlanePos${t};\n                      uniform vec3 sectionPlaneDir${t};`);return e.join("\n")}get fragLightSourceUniforms(){const e=[];e.push("uniform vec4 lightAmbient;");for(let t=0,i=this.renderContext.view.lightsList.length;t<i;t++){const i=this.renderContext.view.lightsList[t];i instanceof M||(e.push(`uniform vec4 lightColor${t};`),i instanceof y&&e.push(`uniform vec3 lightDir${t};`),i instanceof P&&e.push(`uniform vec3 lightPos${t};`))}return e.join("\n")}get fragSectionPlanesSlice(){const e=[];if(this.renderContext.view.sectionPlanesList.length>0){e.push("bool clippable = (float(meshFlags2.x) > 0.0);\n                      if (clippable) {\n                          float dist = 0.0;");for(let t=0,i=this.renderContext.view.sectionPlanesList.length;t<i;t++)e.push(`if (sectionPlaneActive${t}) {\n                              dist += clamp(dot(-sectionPlaneDir${t}.xyz, worldPosition.xyz - sectionPlanePos${t}.xyz), 0.0, 1000.0);\n                          }`);e.push("if (dist > 0.0) { \n                          discard;\n                      }\n                  }")}return e.join("\n")}get fragFlatShading(){const e=[];return e.push(""),e.join("\n")}destroy(){F(this,xe)[xe]&&F(this,xe)[xe].destroy(),F(this,xe)[xe]=null}}function Se(){const e=this.renderContext.view,t=this.renderContext.gl;if(F(this,xe)[xe]=new b(t,F(this,Pe)[Pe]()),F(this,xe)[xe].errors)return void(this.errors=F(this,xe)[xe].errors);const i=F(this,xe)[xe];F(this,we)[we]={renderPass:i.getLocation("renderPass"),viewMatrix:i.getLocation("viewMatrix"),projMatrix:i.getLocation("projMatrix"),worldMatrix:i.getLocation("worldMatrix"),sao:i.getLocation("sao"),logDepthBufFC:i.getLocation("logDepthBufFC"),gammaFactor:i.getLocation("gammaFactor"),pointSize:i.getLocation("pointSize"),nearPlaneHeight:i.getLocation("nearPlaneHeight"),pointCloudIntensityRange:i.getLocation("pointCloudIntensityRange"),pickZNear:i.getLocation("pickZNear"),pickZFar:i.getLocation("pickZFar"),pickInvisible:i.getLocation("pickInvisible"),color:i.getLocation("color"),lightAmbient:i.getLocation("lightAmbient"),lights:[],sectionPlanes:[]};const r=F(this,we)[we],s=e.lightsList;for(let e=0,t=s.length;e<t;e++)switch(s[e].type){case"dir":r.lights.push({color:i.getLocation("lightColor"+e),dir:i.getLocation("lightDir"+e)});break;case"point":r.lights.push({color:i.getLocation("lightColor"+e),pos:i.getLocation("lightPos"+e),attenuation:i.getLocation("lightAttenuation"+e)});break;case"spot":r.lights.push({color:i.getLocation("lightColor"+e),pos:i.getLocation("lightPos"+e),dir:i.getLocation("lightDir"+e),attenuation:i.getLocation("lightAttenuation"+e)})}for(let t=0,s=e.sectionPlanesList.length;t<s;t++)r.sectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});F(this,Me)[Me]={viewMatrices:i.getSampler("viewMatrices"),positions:i.getSampler("positions"),indices:i.getSampler("indices"),edgeIndices:i.getSampler("edgeIndices"),eachMeshAttributes:i.getSampler("eachMeshAttributes"),eachMeshMatrices:i.getSampler("eachMeshMatrices"),eachEdgeOffset:i.getSampler("eachMeshOffset"),eachPrimitiveMesh:i.getSampler("eachMeshTriangleMesh"),eachEdgeMesh:i.getSampler("eachEdgeMesh"),baseColorMap:i.getSampler("baseColorMap"),metallicRoughMap:i.getSampler("metallicRoughMap"),emissiveMap:i.getSampler("emissiveMap"),normalMap:i.getSampler("normalMap"),occlusionMap:i.getSampler("occlusionMap")},F(this,be)[be]=this.getHash()}function De(){return{vertex:this.buildVertexShader(),fragment:this.buildFragmentShader()}}function Oe(){return!F(this,_e)[_e]||(F(this,_e)[_e]=!1,F(this,be)[be]===this.getHash())}function Be(){const e=this.renderContext.view,t=this.renderContext.gl,i=F(this,we)[we],r=e.camera.project;F(this,xe)[xe].bind(),i.lightAmbient&&t.uniform4fv(i.lightAmbient,e.getAmbientColorAndIntensity());for(let r=0,s=i.lights.length;r<s;r++){const s=i.lights[r],n=e.lightsList[r];s.color&&t.uniform4f(s.color,n.color[0],n.color[1],n.color[2],n.intensity),s.dir&&t.uniform3f(s.dir,n.dir[0],n.dir[1],n.dir[2]),s.pos&&t.uniform3f(s.pos,n.pos[0],n.pos[1],n.pos[2]),s.attenuation&&t.uniform1f(s.attenuation,n.attenuation)}if(i.sao){const r=e.sao;if(r.possible){const e=t.drawingBufferHeight;Te[0]=t.drawingBufferWidth,Te[1]=e,Te[2]=r.blendCutoff,Te[3]=r.blendFactor,t.uniform4fv(i.sao,Te)}}if(i.gammaFactor&&t.uniform1f(i.gammaFactor,e.gammaFactor),i.pointSize&&t.uniform1f(i.pointSize,e.pointsMaterial.pointSize),i.nearPlaneHeight&&t.uniform1f(i.nearPlaneHeight,e.camera.projectionType===f?1:t.drawingBufferHeight/(2*Math.tan(.5*e.camera.perspectiveProjection.fov*Math.PI/180))),i.pickZNear&&(t.uniform1f(i.pickZNear,this.renderContext.pickZNear),t.uniform1f(i.pickZFar,this.renderContext.pickZFar)),i.pickInvisible&&t.uniform1i(i.pickInvisible,this.renderContext.pickInvisible?1:0),i.logDepthBufFC){const e=2/(Math.log(r.far+1)/Math.LN2);t.uniform1f(i.logDepthBufFC,e)}}class Ae extends Re{constructor(e){super(e)}getHash(){return`${this.renderContext.view.getSectionPlanesHash()}-${this.renderContext.view.getLightsHash()}`}buildVertexShader(){return`${this.vertHeader}   \n        \n                uniform int                 renderPass;   \n            \n                uniform highp   mat4        projMatrix;\n                uniform highp   mat4        worldMatrix;\n                      \n                uniform mediump sampler2D   viewMatrices;\n                           \n                uniform mediump usampler2D  eachPrimitiveMesh;\n                uniform lowp    usampler2D  eachMeshAttributes;\n                \n                uniform mediump sampler2D   eachMeshMatrices;\n                uniform mediump usampler2D  positions;\n                uniform highp   usampler2D  indices;\n                \n                uniform  float  logDepthBufFC;\n                 \n                out vec4        worldPosition;\n                flat out uint   meshFlags2r;                       \n                flat out uvec4  meshColor;\n                out float       fragDepth;\n                \n                bool isPerspectiveMatrix(mat4 m) {\n                    return (m[2][3] == - 1.0);\n                }\n                \n                out float isPerspective;\n                    \n                void main(void) {\n                                   \n                    int triangleIndex      = gl_VertexID / 3;\n                    \n                    int hPackedMeshIdIndex = (triangleIndex >> 3) & 1023;\n                    int vPackedMeshIdIndex = (triangleIndex >> 3) >> 10;\n                    \n                    int meshIndex          = int(texelFetch(eachPrimitiveMesh, ivec2(hPackedMeshIdIndex, vPackedMeshIdIndex), 0).r);                   \n                    uvec4 meshFlags        = texelFetch (eachMeshAttributes, ivec2(2, meshIndex), 0);\n\n                    if (int(meshFlags.x) != renderPass) {\n                        gl_Position = vec4(3.0, 3.0, 3.0, 1.0);\n                        return;\n                    } \n                 \n                    uvec4 meshFlags2 = texelFetch (eachMeshAttributes, ivec2(3, meshIndex), 0);\n\n                    ivec4 packedVertexBase = ivec4(texelFetch (eachMeshAttributes, ivec2(4, meshIndex), 0));\n                    ivec4 packedIndexBaseOffset = ivec4(texelFetch (eachMeshAttributes, ivec2(5, meshIndex), 0));\n                    int indexBaseOffset =   (packedIndexBaseOffset.r << 24) + \n                                            (packedIndexBaseOffset.g << 16) + \n                                            (packedIndexBaseOffset.b << 8) + \n                                            (packedIndexBaseOffset.a);\n\n                    int hIndex = (triangleIndex - indexBaseOffset) & 1023;\n                    int vIndex = (triangleIndex - indexBaseOffset) >> 10;\n\n                    ivec3 vertexIndices = ivec3(texelFetch(indices, ivec2(hIndex, vIndex), 0));\n                    ivec3 uniqueVertexIndexes = vertexIndices + (packedVertexBase.r << 24) + (packedVertexBase.g << 16) + (packedVertexBase.b << 8) + packedVertexBase.a;\n\n                    ivec3 indexPositionH = uniqueVertexIndexes & 1023;\n                    ivec3 indexPositionV = uniqueVertexIndexes >> 10;\n\n                    mat4 positionsDecompressMatrix = mat4 (\n                        texelFetch (eachMeshMatrices, ivec2(0, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(1, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(2, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(3, meshIndex), 0));\n                        \n                    mat4 meshMatrix = mat4 (\n                        texelFetch (eachMeshMatrices, ivec2(4, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(5, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(6, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(7, meshIndex), 0));\n\n                    ivec4 packedViewMatrixIndex = ivec4(texelFetch (eachMeshAttributes, ivec2(7, meshIndex), 0));\n                    int viewMatrixIndex = \n                            (packedViewMatrixIndex.r << 24) + \n                            (packedViewMatrixIndex.g << 16) + \n                            (packedViewMatrixIndex.b << 8) + \n                            (packedViewMatrixIndex.a);\n                   \n                    mat4 viewMatrix = mat4 (\n                        texelFetch (viewMatrices, ivec2(4, viewMatrixIndex), 0), \n                        texelFetch (viewMatrices, ivec2(5, viewMatrixIndex), 0), \n                        texelFetch (viewMatrices, ivec2(6, viewMatrixIndex), 0), \n                        texelFetch (viewMatrices, ivec2(7, viewMatrixIndex), 0));\n\n                    vec3 _positions[3];\n                   \n                    _positions[0] = vec3(texelFetch(positions, ivec2(indexPositionH.r, indexPositionV.r), 0));\n                    _positions[1] = vec3(texelFetch(positions, ivec2(indexPositionH.g, indexPositionV.g), 0));\n                    _positions[2] = vec3(texelFetch(positions, ivec2(indexPositionH.b, indexPositionV.b), 0));\n  \n                    vec3  position       = _positions[gl_VertexID % 3];\n                   \n                    vec4  _worldPosition = worldMatrix * ((meshMatrix * positionsDecompressMatrix) * vec4(position, 1.0)); \n                    vec4  viewPosition   = viewMatrix * _worldPosition;                   \n                    vec4  clipPosition   = projMatrix * viewPosition;\n\n                    meshFlags2r     = meshFlags2.r;                     \n                    meshColor       = texelFetch (eachMeshAttributes, ivec2(0, meshIndex), 0);                          \n                    fragDepth       = 1.0 + clipPosition.w;\n                    isPerspective   = float (isPerspectiveMatrix(projMatrix));\n                    worldPosition   = _worldPosition;                                               \n                    \n                    gl_Position     = clipPosition;\n                }`}buildFragmentShader(){return`${this.fragHeader}                        \n    \n             flat   in uvec4    meshColor;\n                in float        fragDepth;\n                in float        isPerspective;    \n                flat in uint    meshFlags2r;        \n                uniform float   logDepthBufFC;                        \n    \n                ${this.fragSectionPlaneDefs}                  \n                ${this.fragLightSourceUniforms}                                                             \n    \n                out vec4 outColor;        \n    \n                void main(void) {         \n                \n                // src.push("float lambertian = 1.0;");\n                // \n                //  vec3 xTangent = dFdx( vViewPosition.xyz );\n                //  vec3 yTangent = dFdy( vViewPosition.xyz );\n                // \n                //  vec3 viewNormal = normalize( cross( xTangent, yTangent ) );        \n    \n                    ${this.fragSectionPlanesSlice}                                    \n                    ${this.fragFlatShading}     \n          \n                    outColor = vec4(meshColor);                   \n                    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( fragDepth ) * logDepthBufFC * 0.5;                        \n                }`}}var Le=/*#__PURE__*/U("built");class Ue{constructor(){this.positions=void 0,this.indices_8Bits=void 0,this.indices_16Bits=void 0,this.indices_32Bits=void 0,this.edgeIndices_8Bits=void 0,this.edgeIndices_16Bits=void 0,this.edgeIndices_32Bits=void 0,this.indices=void 0,this.edgeIndices=void 0,this.eachMeshAttributes=void 0,this.eachMeshMatrices=void 0,this.eachEdgeOffset=void 0,this.eachPrimitiveMesh_8Bits=void 0,this.eachPrimitiveMesh_16Bits=void 0,this.eachPrimitiveMesh_32Bits=void 0,this.eachPrimitiveMesh=void 0,this.eachEdgeMesh_8Bits=void 0,this.eachEdgeMesh_16Bits=void 0,this.eachEdgeMesh_32Bits=void 0,this.eachEdgeMesh=void 0,Object.defineProperty(this,Le,{writable:!0,value:void 0}),this.positions=null,this.indices_8Bits=null,this.indices_16Bits=null,this.indices_32Bits=null,this.edgeIndices_8Bits=null,this.edgeIndices_16Bits=null,this.edgeIndices_32Bits=null,this.eachMeshAttributes=null,this.eachMeshMatrices=null,this.eachPrimitiveMesh_8Bits=null,this.eachPrimitiveMesh_16Bits=null,this.eachPrimitiveMesh_32Bits=null,this.eachEdgeMesh_8Bits=null,this.eachEdgeMesh_16Bits=null,this.eachEdgeMesh_32Bits=null,this.eachEdgeOffset=null,F(this,Le)[Le]=!1}build(){this.indices={8:this.indices_8Bits,16:this.indices_16Bits,32:this.indices_32Bits},this.eachPrimitiveMesh={8:this.eachPrimitiveMesh_8Bits,16:this.eachPrimitiveMesh_16Bits,32:this.eachPrimitiveMesh_32Bits},this.edgeIndices={8:this.edgeIndices_8Bits,16:this.edgeIndices_16Bits,32:this.edgeIndices_32Bits},this.eachEdgeMesh={8:this.eachEdgeMesh_8Bits,16:this.eachEdgeMesh_16Bits,32:this.eachEdgeMesh_32Bits},F(this,Le)[Le]=!0}destroy(){this.positions&&this.positions.destroy(),this.indices_8Bits&&this.indices_8Bits.destroy(),this.indices_16Bits&&this.indices_16Bits.destroy(),this.indices_32Bits&&this.indices_32Bits.destroy(),this.edgeIndices_8Bits&&this.edgeIndices_8Bits.destroy(),this.edgeIndices_16Bits&&this.edgeIndices_16Bits.destroy(),this.edgeIndices_32Bits&&this.edgeIndices_32Bits.destroy(),this.eachMeshMatrices&&this.eachMeshMatrices.destroy(),this.eachMeshAttributes&&this.eachMeshAttributes.destroy(),this.eachEdgeOffset&&this.eachEdgeOffset.destroy(),this.eachPrimitiveMesh_8Bits&&this.eachPrimitiveMesh_8Bits.destroy(),this.eachPrimitiveMesh_16Bits&&this.eachPrimitiveMesh_16Bits.destroy(),this.eachPrimitiveMesh_32Bits&&this.eachPrimitiveMesh_32Bits.destroy(),this.eachEdgeMesh_8Bits&&this.eachEdgeMesh_8Bits.destroy(),this.eachEdgeMesh_16Bits&&this.eachEdgeMesh_16Bits.destroy(),this.eachEdgeMesh_32Bits&&this.eachEdgeMesh_32Bits.destroy()}}class Fe{constructor(){this.numMeshes=void 0,this.numVisible=void 0,this.numTransparent=void 0,this.numEdges=void 0,this.numXRayed=void 0,this.numSelected=void 0,this.numHighlighted=void 0,this.numClippable=void 0,this.numPickable=void 0,this.numCulled=void 0,this.reset()}reset(){this.numMeshes=0,this.numVisible=0,this.numTransparent=0,this.numEdges=0,this.numXRayed=0,this.numSelected=0,this.numHighlighted=0,this.numClippable=0,this.numPickable=0,this.numCulled=0}}const je={VISIBLE:1,CULLED:4,PICKABLE:8,CLIPPABLE:16,COLLIDABLE:32,CAST_SHADOW:64,RECEIVE_SHADOW:128,XRAYED:256,HIGHLIGHTED:512,SELECTED:1024,EDGES:2048,BACKFACES:4096,TRANSPARENT:8192};function Ge(e){return(t,...i)=>He(e,t,i)}function Ne(e,t){return Ge(We(e,t).get)}const{apply:He,construct:Xe,defineProperty:ke,get:Ve,getOwnPropertyDescriptor:We,getPrototypeOf:ze,has:$e,ownKeys:qe,set:Ye,setPrototypeOf:Ke}=Reflect,Ze=Proxy,Qe=Number,{isFinite:Je,isNaN:et}=Qe,{iterator:tt,species:it,toStringTag:rt,for:st}=Symbol,nt=Object,{create:ot,defineProperty:ht,freeze:at,is:lt}=nt,ct=nt.prototype,dt=Ge(ct.isPrototypeOf),ut=nt.hasOwn||Ge(ct.hasOwnProperty),ft=Array,gt=ft.isArray,pt=ft.prototype,mt=Ge(pt.join),vt=Ge(pt.push),Et=Ge(pt.toLocaleString),Tt=pt[tt],bt=Ge(Tt),xt=Math.trunc,_t=ArrayBuffer,wt=_t.isView,Mt=Ge(_t.prototype.slice),yt=Ne(_t.prototype,"byteLength"),Pt="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:null,Ct=Pt&&Ne(Pt.prototype,"byteLength"),It=ze(Uint8Array),Rt=It.from,St=It.prototype,Dt=St[tt],Ot=Ge(St.keys),Bt=Ge(St.values),At=Ge(St.entries),Lt=Ge(St.set),Ut=Ge(St.reverse),Ft=Ge(St.fill),jt=Ge(St.copyWithin),Gt=Ge(St.sort),Nt=Ge(St.slice),Ht=Ge(St.subarray),Xt=Ne(St,"buffer"),kt=Ne(St,"byteOffset"),Vt=Ne(St,"length"),Wt=Ne(St,rt),zt=Uint16Array,$t=(...e)=>He(Rt,zt,e),qt=Uint32Array,Yt=Float32Array,Kt=ze([][tt]()),Zt=Ge(Kt.next),Qt=Ge(function*(){}().next),Jt=ze(Kt),ei=TypeError,ti=RangeError,ii=Set,ri=ii.prototype,si=Ge(ri.add),ni=Ge(ri.has),oi=WeakMap,hi=oi.prototype,ai=Ge(hi.get),li=Ge(hi.has),ci=Ge(hi.set),di=new _t(4),ui=new Yt(di),fi=new qt(di),gi=new qt(512),pi=new qt(512);for(let e=0;e<256;++e){const t=e-127;t<-27?(gi[e]=0,gi[256|e]=32768,pi[e]=24,pi[256|e]=24):t<-14?(gi[e]=1024>>-t-14,gi[256|e]=1024>>-t-14|32768,pi[e]=-t-1,pi[256|e]=-t-1):t<=15?(gi[e]=t+15<<10,gi[256|e]=t+15<<10|32768,pi[e]=13,pi[256|e]=13):t<128?(gi[e]=31744,gi[256|e]=64512,pi[e]=24,pi[256|e]=24):(gi[e]=31744,gi[256|e]=64512,pi[e]=13,pi[256|e]=13)}function mi(e){ui[0]=e;const t=fi[0],i=t>>23&511;return gi[i]+((8388607&t)>>pi[i])}const vi=new qt(2048),Ei=new qt(64),Ti=new qt(64);vi[0]=0;for(let e=1;e<1024;++e){let t=e<<13,i=0;for(;0==(8388608&t);)i-=8388608,t<<=1;t&=-8388609,i+=947912704,vi[e]=t|i}for(let e=1024;e<2048;++e)vi[e]=939524096+(e-1024<<13);Ei[0]=0;for(let e=1;e<31;++e)Ei[e]=e<<23;Ei[31]=1199570944,Ei[32]=2147483648;for(let e=33;e<63;++e)Ei[e]=2147483648+(e-32<<23);Ei[63]=3347054592,Ti[0]=0;for(let e=1;e<64;++e)Ti[e]=32===e?0:1024;function bi(e){const t=e>>10;return fi[0]=vi[Ti[t]+(1023&e)]+Ei[t],ui[0]}function xi(e){if(e[tt]===Tt)return e;const t=bt(e);return ot(null,{next:{value:function(){return Zt(t)}},[tt]:{value:function(){return this}}})}const _i=new oi,wi=ot(Jt,{next:{value:function(){const e=ai(_i,this);return Qt(e)},writable:!0,configurable:!0},[rt]:{value:"Array Iterator",configurable:!0}});function Mi(e){const t=ot(wi);return ci(_i,t,e),t}function yi(e){return null!==e&&"object"==typeof e||"function"==typeof e}function Pi(e){return null!==e&&"object"==typeof e}function Ci(e){return void 0!==Wt(e)}function Ii(e){const t=Wt(e);return"BigInt64Array"===t||"BigUint64Array"===t}function Ri(e){if(null===Pt)return!1;try{return Ct(e),!0}catch(e){return!1}}function Si(e){return!!gt(e)&&(e[tt]===Tt||"Array Iterator"===e[tt]()[rt])}function Di(e){if("string"!=typeof e)return!1;const t=Qe(e);return e===t+""&&!!Je(t)&&t===xt(t)}const Oi=Qe.MAX_SAFE_INTEGER;function Bi(e){if("bigint"==typeof e)throw ei("Cannot convert a BigInt value to a number");const t=Qe(e);return et(t)||0===t?0:xt(t)}function Ai(e){const t=Bi(e);return t<0?0:t<Oi?t:Oi}function Li(e,t){if(!yi(e))throw ei("This is not an object");const i=e.constructor;if(void 0===i)return t;if(!yi(i))throw ei("The constructor property value is not an object");const r=i[it];return null==r?t:r}function Ui(e){if(Ri(e))return!1;try{return Mt(e,0,0),!1}catch(e){}return!0}function Fi(e,t){const i=et(e),r=et(t);if(i&&r)return 0;if(i)return 1;if(r)return-1;if(e<t)return-1;if(e>t)return 1;if(0===e&&0===t){const i=lt(e,0),r=lt(t,0);if(!i&&r)return-1;if(i&&!r)return 1}return 0}const ji=st("__Float16Array__"),Gi=new oi;function Ni(e){return li(Gi,e)||!wt(e)&&function(e){if(!Pi(e))return!1;const t=ze(e);if(!Pi(t))return!1;const i=t.constructor;if(void 0===i)return!1;if(!yi(i))throw ei("The constructor property value is not an object");return $e(i,ji)}(e)}function Hi(e){if(!Ni(e))throw ei("This is not a Float16Array object")}function Xi(e,t){const i=Ni(e),r=Ci(e);if(!i&&!r)throw ei("Species constructor didn't return TypedArray object");if("number"==typeof t){let r;if(i){const t=ki(e);r=Vt(t)}else r=Vt(e);if(r<t)throw ei("Derived constructor created TypedArray object which was too small length")}if(Ii(e))throw ei("Cannot mix BigInt and other types, use explicit conversions")}function ki(e){const t=ai(Gi,e);if(void 0!==t){if(Ui(Xt(t)))throw ei("Attempting to access detached ArrayBuffer");return t}const i=e.buffer;if(Ui(i))throw ei("Attempting to access detached ArrayBuffer");const r=Xe($i,[i,e.byteOffset,e.length],e.constructor);return ai(Gi,r)}function Vi(e){const t=Vt(e),i=[];for(let r=0;r<t;++r)i[r]=bi(e[r]);return i}const Wi=new ii;for(const e of qe(St)){if(e===rt)continue;const t=We(St,e);ut(t,"get")&&si(Wi,e)}const zi=at({get:(e,t,i)=>Di(t)&&ut(e,t)?bi(Ve(e,t)):ni(Wi,t)&&dt(St,e)?Ve(e,t):Ve(e,t,i),set:(e,t,i,r)=>Di(t)&&ut(e,t)?Ye(e,t,mi(i)):Ye(e,t,i,r),getOwnPropertyDescriptor(e,t){if(Di(t)&&ut(e,t)){const i=We(e,t);return i.value=bi(i.value),i}return We(e,t)},defineProperty:(e,t,i)=>Di(t)&&ut(e,t)&&ut(i,"value")?(i.value=mi(i.value),ke(e,t,i)):ke(e,t,i)});class $i{constructor(e,t,i){let r;if(Ni(e))r=Xe(zt,[ki(e)],new.target);else if(yi(e)&&!function(e){try{return yt(e),!0}catch(e){return!1}}(e)){let t,i;if(Ci(e)){t=e,i=Vt(e);const s=Xt(e),n=Ri(s)?_t:Li(s,_t);if(Ui(s))throw ei("Attempting to access detached ArrayBuffer");if(Ii(e))throw ei("Cannot mix BigInt and other types, use explicit conversions");const o=new n(2*i);r=Xe(zt,[o],new.target)}else{const s=e[tt];if(null!=s&&"function"!=typeof s)throw ei("@@iterator property is not callable");null!=s?Si(e)?(t=e,i=e.length):(t=[...e],i=t.length):(t=e,i=Ai(t.length)),r=Xe(zt,[i],new.target)}for(let e=0;e<i;++e)r[e]=mi(t[e])}else r=Xe(zt,arguments,new.target);const s=new Ze(r,zi);return ci(Gi,s,r),s}static from(e,...t){const i=this;if(!$e(i,ji))throw ei("This constructor is not a subclass of Float16Array");if(i===$i){if(Ni(e)&&0===t.length){const t=ki(e),i=new zt(Xt(t),kt(t),Vt(t));return new $i(Xt(Nt(i)))}if(0===t.length)return new $i(Xt($t(e,mi)));const i=t[0];return new $i(Xt($t(e,(e,...t)=>mi(He(i,this,[e,...xi(t)])),t[1])))}let r,s;const n=e[tt];if(null!=n&&"function"!=typeof n)throw ei("@@iterator property is not callable");if(null!=n)Si(e)?(r=e,s=e.length):!Ci(o=e)||o[tt]!==Dt&&"Array Iterator"!==o[tt]()[rt]?(r=[...e],s=r.length):(r=e,s=Vt(e));else{if(null==e)throw ei("Cannot convert undefined or null to object");r=nt(e),s=Ai(r.length)}var o;const h=new i(s);if(0===t.length)for(let e=0;e<s;++e)h[e]=r[e];else{const e=t[0],i=t[1];for(let t=0;t<s;++t)h[t]=He(e,i,[r[t],t])}return h}static of(...e){const t=this;if(!$e(t,ji))throw ei("This constructor is not a subclass of Float16Array");const i=e.length;if(t===$i){const t=new $i(i),r=ki(t);for(let t=0;t<i;++t)r[t]=mi(e[t]);return t}const r=new t(i);for(let t=0;t<i;++t)r[t]=e[t];return r}keys(){Hi(this);const e=ki(this);return Ot(e)}values(){Hi(this);const e=ki(this);return Mi(function*(){for(const t of Bt(e))yield bi(t)}())}entries(){Hi(this);const e=ki(this);return Mi(function*(){for(const[t,i]of At(e))yield[t,bi(i)]}())}at(e){Hi(this);const t=ki(this),i=Vt(t),r=Bi(e),s=r>=0?r:i+r;if(!(s<0||s>=i))return bi(t[s])}map(e,...t){Hi(this);const i=ki(this),r=Vt(i),s=t[0],n=Li(i,$i);if(n===$i){const t=new $i(r),n=ki(t);for(let t=0;t<r;++t){const r=bi(i[t]);n[t]=mi(He(e,s,[r,t,this]))}return t}const o=new n(r);Xi(o,r);for(let t=0;t<r;++t){const r=bi(i[t]);o[t]=He(e,s,[r,t,this])}return o}filter(e,...t){Hi(this);const i=ki(this),r=Vt(i),s=t[0],n=[];for(let t=0;t<r;++t){const r=bi(i[t]);He(e,s,[r,t,this])&&vt(n,r)}const o=new(Li(i,$i))(n);return Xi(o),o}reduce(e,...t){Hi(this);const i=ki(this),r=Vt(i);if(0===r&&0===t.length)throw ei("Reduce of empty array with no initial value");let s,n;0===t.length?(s=bi(i[0]),n=1):(s=t[0],n=0);for(let t=n;t<r;++t)s=e(s,bi(i[t]),t,this);return s}reduceRight(e,...t){Hi(this);const i=ki(this),r=Vt(i);if(0===r&&0===t.length)throw ei("Reduce of empty array with no initial value");let s,n;0===t.length?(s=bi(i[r-1]),n=r-2):(s=t[0],n=r-1);for(let t=n;t>=0;--t)s=e(s,bi(i[t]),t,this);return s}forEach(e,...t){Hi(this);const i=ki(this),r=Vt(i),s=t[0];for(let t=0;t<r;++t)He(e,s,[bi(i[t]),t,this])}find(e,...t){Hi(this);const i=ki(this),r=Vt(i),s=t[0];for(let t=0;t<r;++t){const r=bi(i[t]);if(He(e,s,[r,t,this]))return r}}findIndex(e,...t){Hi(this);const i=ki(this),r=Vt(i),s=t[0];for(let t=0;t<r;++t){const r=bi(i[t]);if(He(e,s,[r,t,this]))return t}return-1}findLast(e,...t){Hi(this);const i=ki(this),r=Vt(i),s=t[0];for(let t=r-1;t>=0;--t){const r=bi(i[t]);if(He(e,s,[r,t,this]))return r}}findLastIndex(e,...t){Hi(this);const i=ki(this),r=Vt(i),s=t[0];for(let t=r-1;t>=0;--t){const r=bi(i[t]);if(He(e,s,[r,t,this]))return t}return-1}every(e,...t){Hi(this);const i=ki(this),r=Vt(i),s=t[0];for(let t=0;t<r;++t)if(!He(e,s,[bi(i[t]),t,this]))return!1;return!0}some(e,...t){Hi(this);const i=ki(this),r=Vt(i),s=t[0];for(let t=0;t<r;++t)if(He(e,s,[bi(i[t]),t,this]))return!0;return!1}set(e,...t){Hi(this);const i=ki(this),r=Bi(t[0]);if(r<0)throw ti("Offset is out of bounds");if(null==e)throw ei("Cannot convert undefined or null to object");if(Ii(e))throw ei("Cannot mix BigInt and other types, use explicit conversions");if(Ni(e))return Lt(ki(this),ki(e),r);if(Ci(e)&&Ui(Xt(e)))throw ei("Attempting to access detached ArrayBuffer");const s=Vt(i),n=nt(e),o=Ai(n.length);if(r===1/0||o+r>s)throw ti("Offset is out of bounds");for(let e=0;e<o;++e)i[e+r]=mi(n[e])}reverse(){Hi(this);const e=ki(this);return Ut(e),this}fill(e,...t){Hi(this);const i=ki(this);return Ft(i,mi(e),...xi(t)),this}copyWithin(e,t,...i){Hi(this);const r=ki(this);return jt(r,e,t,...xi(i)),this}sort(...e){Hi(this);const t=ki(this),i=void 0!==e[0]?e[0]:Fi;return Gt(t,(e,t)=>i(bi(e),bi(t))),this}slice(...e){Hi(this);const t=ki(this),i=Li(t,$i);if(i===$i){const i=new zt(Xt(t),kt(t),Vt(t));return new $i(Xt(Nt(i,...xi(e))))}const r=Vt(t),s=Bi(e[0]),n=void 0===e[1]?r:Bi(e[1]);let o,h;o=s===-1/0?0:s<0?r+s>0?r+s:0:r<s?r:s,h=n===-1/0?0:n<0?r+n>0?r+n:0:r<n?r:n;const a=h-o>0?h-o:0,l=new i(a);if(Xi(l,a),0===a)return l;if(Ui(Xt(t)))throw ei("Attempting to access detached ArrayBuffer");let c=0;for(;o<h;)l[c]=bi(t[o]),++o,++c;return l}subarray(...e){Hi(this);const t=ki(this),i=Li(t,$i),r=new zt(Xt(t),kt(t),Vt(t)),s=Ht(r,...xi(e)),n=new i(Xt(s),kt(s),Vt(s));return Xi(n),n}indexOf(e,...t){Hi(this);const i=ki(this),r=Vt(i);let s=Bi(t[0]);if(s===1/0)return-1;s<0&&(s+=r,s<0&&(s=0));for(let t=s;t<r;++t)if(ut(i,t)&&bi(i[t])===e)return t;return-1}lastIndexOf(e,...t){Hi(this);const i=ki(this),r=Vt(i);let s=t.length>=1?Bi(t[0]):r-1;if(s===-1/0)return-1;s>=0?s=s<r-1?s:r-1:s+=r;for(let t=s;t>=0;--t)if(ut(i,t)&&bi(i[t])===e)return t;return-1}includes(e,...t){Hi(this);const i=ki(this),r=Vt(i);let s=Bi(t[0]);if(s===1/0)return!1;s<0&&(s+=r,s<0&&(s=0));const n=et(e);for(let t=s;t<r;++t){const r=bi(i[t]);if(n&&et(r))return!0;if(r===e)return!0}return!1}join(...e){Hi(this);const t=Vi(ki(this));return mt(t,...xi(e))}toLocaleString(...e){Hi(this);const t=Vi(ki(this));return Et(t,...xi(e))}get[rt](){if(Ni(this))return"Float16Array"}}ht($i,"BYTES_PER_ELEMENT",{value:2}),ht($i,ji,{}),Ke($i,It);const qi=$i.prototype;ht(qi,"BYTES_PER_ELEMENT",{value:2}),ht(qi,tt,{value:qi.values,writable:!0,configurable:!0}),Ke(qi,St);const Yi=new x({textureWidth:0,textureHeight:0});function Ki(e){e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}class Zi{constructor(){this.positionsDecompressMatrices=void 0,this.positionsCompressed=void 0,this.indices_8Bits=void 0,this.indices_16Bits=void 0,this.indices_32Bits=void 0,this.edgeIndices_8Bits=void 0,this.edgeIndices_16Bits=void 0,this.edgeIndices_32Bits=void 0,this.eachPrimitiveMesh_8Bits=void 0,this.eachPrimitiveMesh_16Bits=void 0,this.eachPrimitiveMesh_32Bits=void 0,this.eachEdgeMesh_8Bits=void 0,this.eachEdgeMesh_16Bits=void 0,this.eachEdgeMesh_32Bits=void 0,this.eachMeshVertexPortionBase=void 0,this.eachMeshVertexPortionOffset=void 0,this.eachMeshEdgeIndicesOffset=void 0,this.eachMeshColor=void 0,this.eachMeshPickColor=void 0,this.eachMeshMatrices=void 0,this.eachMeshNormalMatrix=void 0,this.eachMeshPositionsDecompressMatrix=void 0,this.eachMeshFlags1=void 0,this.eachMeshFlags2=void 0,this.eachEdgeOffset=void 0,this.eachMeshParts=void 0,this.positionsDecompressMatrices=[],this.positionsCompressed=[],this.indices_8Bits=[],this.indices_16Bits=[],this.indices_32Bits=[],this.edgeIndices_8Bits=[],this.edgeIndices_16Bits=[],this.edgeIndices_32Bits=[],this.eachMeshVertexPortionBase=[],this.eachMeshVertexPortionOffset=[],this.eachMeshEdgeIndicesOffset=[],this.eachMeshColor=[],this.eachMeshPickColor=[],this.eachMeshMatrices=[],this.eachMeshNormalMatrix=[],this.eachMeshPositionsDecompressMatrix=[],this.eachMeshFlags1=[],this.eachMeshFlags2=[],this.eachPrimitiveMesh_32Bits=[],this.eachPrimitiveMesh_16Bits=[],this.eachPrimitiveMesh_8Bits=[],this.eachEdgeMesh_32Bits=[],this.eachEdgeMesh_16Bits=[],this.eachEdgeMesh_8Bits=[],this.eachEdgeOffset=[],this.eachMeshParts=[]}}const Qi=8,Ji=t(),er=e([0,0,0,1]),tr=e([0,0,0,1]);e([0,0,0,1]);const ir=new Uint8Array(4),rr=new Float32Array(3);var sr=/*#__PURE__*/U("gl"),nr=/*#__PURE__*/U("view"),or=/*#__PURE__*/U("dataTextureBuffer"),hr=/*#__PURE__*/U("geometryHandles"),ar=/*#__PURE__*/U("meshPartHandles"),lr=/*#__PURE__*/U("numMeshParts"),cr=/*#__PURE__*/U("deferredSetFlagsActive"),dr=/*#__PURE__*/U("deferredSetFlagsDirty"),ur=/*#__PURE__*/U("built"),fr=/*#__PURE__*/U("createGeometryBucket"),gr=/*#__PURE__*/U("createMeshPart"),pr=/*#__PURE__*/U("setMeshFlags"),mr=/*#__PURE__*/U("setMeshFlags2");class vr{constructor(e,t){Object.defineProperty(this,mr,{value:xr}),Object.defineProperty(this,pr,{value:br}),Object.defineProperty(this,gr,{value:Tr}),Object.defineProperty(this,fr,{value:Er}),this.rendererModel=void 0,this.layerIndex=void 0,this.meshCounts=void 0,this.renderState=void 0,Object.defineProperty(this,sr,{writable:!0,value:void 0}),Object.defineProperty(this,nr,{writable:!0,value:void 0}),Object.defineProperty(this,or,{writable:!0,value:void 0}),Object.defineProperty(this,hr,{writable:!0,value:void 0}),Object.defineProperty(this,ar,{writable:!0,value:void 0}),Object.defineProperty(this,lr,{writable:!0,value:void 0}),Object.defineProperty(this,cr,{writable:!0,value:void 0}),Object.defineProperty(this,dr,{writable:!0,value:void 0}),Object.defineProperty(this,ur,{writable:!0,value:void 0}),this.meshCounts=new Fe,this.layerIndex=e.layerIndex,this.rendererModel=e.rendererModel,this.renderState={primitive:e.primitive,dataTextureSet:new Ue,numIndices8Bits:0,numIndices16Bits:0,numIndices32Bits:0,numEdgeIndices8Bits:0,numEdgeIndices16Bits:0,numEdgeIndices32Bits:0,numVertices:0},F(this,sr)[sr]=e.gl,F(this,nr)[nr]=e.view,F(this,or)[or]=new Zi,F(this,lr)[lr]=0,F(this,hr)[hr]={},F(this,ar)[ar]=[],F(this,ur)[ur]=!1,this.beginDeferredFlags()}get hash(){return`layer-${this.renderState.primitive}`}canCreateMesh(e){if(F(this,ur)[ur])throw"Already built";const t=this.renderState,i=e.geometryBuckets.length;if(F(this,lr)[lr]+i>4096)return!1;let r=0,s=0;for(let t=0;t<i;t++){const i=e.geometryBuckets[t];r+=i.positionsCompressed.length,i.indices&&(s+=i.indices.length)}return t.numVertices+r/(e.primitive===g?1:e.primitive==p?2:3)<=2097152&&s/3+s<=2097152}hasGeometry(e){return F(this,hr)[hr][e]}createGeometryCompressed(e){if(F(this,ur)[ur])throw"Already built";const t=[];for(let i=0,r=e.geometryBuckets.length;i<r;i++)t.push(F(this,fr)[fr](e.geometryBuckets[i]));F(this,hr)[hr][e.id]={id:e.id,aabb:e.aabb,positionsDecompressMatrix:e.positionsDecompressMatrix,geometryBucketHandles:t}}createMesh(e){if(F(this,ur)[ur])throw new Error("Already built");const t=this.meshCounts.numMeshes;if(!e.geometryId)throw new Error("geometryId expected");const r=F(this,hr)[hr][e.geometryId];if(!r)throw new Error("Geometry not found");r.geometryBucketHandles.forEach(t=>{F(this,gr)[gr](e,r,t)});const s=S(),n=D(r.aabb);for(let t=0,r=n.length;t<r;t+=4)er[0]=n[t+0],er[1]=n[t+1],er[2]=n[t+2],e.matrix?(i(e.matrix,er,tr),O(s,tr)):O(s,tr);return this.meshCounts.numMeshes++,t}build(){if(F(this,ur)[ur])throw new Error("Already built");const e=F(this,sr)[sr],t=F(this,or)[or],i=this.renderState.dataTextureSet;i.positions=function(e,t){const i=1024,r=Math.ceil(t.length/3/i);if(0==r)throw"texture height == 0";const s=new Uint16Array(i*r*3);s.fill(0),s.set(t,0);const n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.texStorage2D(e.TEXTURE_2D,1,e.RGB16UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RGB_INTEGER,e.UNSIGNED_SHORT,s,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new x({gl:e,texture:n,textureWidth:i,textureHeight:r})}(e,t.positionsCompressed),i.indices_8Bits=function(e,t){if(0==t.length)return Yi;const i=1024,r=Math.ceil(t.length/3/i);if(0==r)throw"texture height == 0";const s=new Uint8Array(i*r*3);s.fill(0),s.set(t,0);const n=e.createTexture();return n?(e.bindTexture(e.TEXTURE_2D,n),e.texStorage2D(e.TEXTURE_2D,1,e.RGB8UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RGB_INTEGER,e.UNSIGNED_BYTE,s,0),Ki(e),e.bindTexture(e.TEXTURE_2D,null),new x({gl:e,texture:n,textureWidth:i,textureHeight:r})):Yi}(e,t.indices_8Bits),i.indices_16Bits=function(e,t){if(0==t.length)return Yi;const i=1024,r=Math.ceil(t.length/3/i);if(0==r)throw"texture height == 0";const s=new Uint16Array(i*r*3);s.fill(0),s.set(t,0);const n=e.createTexture();return n?(e.bindTexture(e.TEXTURE_2D,n),e.texStorage2D(e.TEXTURE_2D,1,e.RGB16UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RGB_INTEGER,e.UNSIGNED_SHORT,s,0),Ki(e),e.bindTexture(e.TEXTURE_2D,null),new x({gl:e,texture:n,textureWidth:i,textureHeight:r})):Yi}(e,t.indices_16Bits),i.indices_32Bits=function(e,t){if(0==t.length)return Yi;const i=1024,r=Math.ceil(t.length/3/i);if(0==r)throw"texture height == 0";const s=new Uint32Array(i*r*3);s.fill(0),s.set(t,0);const n=e.createTexture();return n?(e.bindTexture(e.TEXTURE_2D,n),e.texStorage2D(e.TEXTURE_2D,1,e.RGB32UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RGB_INTEGER,e.UNSIGNED_INT,s,0),Ki(e),e.bindTexture(e.TEXTURE_2D,null),new x({gl:e,texture:n,textureWidth:i,textureHeight:r})):Yi}(e,t.indices_32Bits),i.edgeIndices_8Bits=function(e,t){if(0==t.length)return Yi;const i=1024,r=Math.ceil(t.length/2/i);if(0==r)throw"texture height == 0";const s=new Uint8Array(i*r*2);s.fill(0),s.set(t,0);const n=e.createTexture();return n?(e.bindTexture(e.TEXTURE_2D,n),e.texStorage2D(e.TEXTURE_2D,1,e.RG8UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RG_INTEGER,e.UNSIGNED_BYTE,s,0),Ki(e),e.bindTexture(e.TEXTURE_2D,null),new x({gl:e,texture:n,textureWidth:i,textureHeight:r})):Yi}(e,t.edgeIndices_8Bits),i.edgeIndices_16Bits=function(e,t){if(0==t.length)return Yi;const i=1024,r=Math.ceil(t.length/2/i);if(0==r)throw"texture height == 0";const s=new Uint16Array(i*r*2);s.fill(0),s.set(t,0);const n=e.createTexture();return n?(e.bindTexture(e.TEXTURE_2D,n),e.texStorage2D(e.TEXTURE_2D,1,e.RG16UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RG_INTEGER,e.UNSIGNED_SHORT,s,0),Ki(e),e.bindTexture(e.TEXTURE_2D,null),new x({gl:e,texture:n,textureWidth:i,textureHeight:r})):Yi}(e,t.edgeIndices_16Bits),i.edgeIndices_32Bits=function(e,t){if(0==t.length)return Yi;const i=1024,r=Math.ceil(t.length/2/i);if(0==r)throw"texture height == 0";const s=new Uint32Array(i*r*2);s.fill(0),s.set(t,0);const n=e.createTexture();return n?(e.bindTexture(e.TEXTURE_2D,n),e.texStorage2D(e.TEXTURE_2D,1,e.RG32UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RG_INTEGER,e.UNSIGNED_INT,s,0),Ki(e),e.bindTexture(e.TEXTURE_2D,null),new x({gl:e,texture:n,textureWidth:i,textureHeight:r})):Yi}(e,t.edgeIndices_32Bits),i.eachMeshAttributes=function(e,t,i,r,s,n){const o=t.length;if(0==o)throw"texture height == 0";const h=new Uint8Array(32*o);for(let e=0;e<o;e++)h.set(t[e],28*e+0),h.set(i[e],28*e+4),h.set([0,0,0,0],28*e+8),h.set([0,0,0,0],28*e+12),h.set([r[e]>>24&255,r[e]>>16&255,r[e]>>8&255,255&r[e]],28*e+16),h.set([s[e]>>24&255,s[e]>>16&255,s[e]>>8&255,255&s[e]],28*e+20),h.set([n[e]>>24&255,n[e]>>16&255,n[e]>>8&255,255&n[e]],28*e+24);const a=e.createTexture();return a?(e.bindTexture(e.TEXTURE_2D,a),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA8UI,8,o),e.texSubImage2D(e.TEXTURE_2D,0,0,0,8,o,e.RGBA_INTEGER,e.UNSIGNED_BYTE,h,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new x({gl:e,texture:a,textureWidth:8,textureHeight:o,textureData:h})):Yi}(e,t.eachMeshColor,t.eachMeshPickColor,t.eachMeshVertexPortionBase,t.eachMeshVertexPortionOffset,t.eachMeshEdgeIndicesOffset),i.eachMeshMatrices=function(e,t,i){const r=t.length;if(0==r)throw"texture height == 0";const s=new $i(48*r);for(let e=0;e<t.length;e++)s.set(t[e],48*e),s.set(i[e],48*e+16);const n=e.createTexture();return n?(e.bindTexture(e.TEXTURE_2D,n),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA16F,12,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,12,r,e.RGBA,e.HALF_FLOAT,new Uint16Array(s.buffer),0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new x({gl:e,texture:n,textureWidth:12,textureHeight:r})):Yi}(e,t.eachMeshPositionsDecompressMatrix,t.eachMeshMatrices),i.eachEdgeOffset=function(e,t){const i=t.length;if(0==i)throw"texture height == 0";const r=new Float32Array(3*i);for(let e=0;e<t.length;e++)r.set(t[e],3*e);const s=e.createTexture();return s?(e.bindTexture(e.TEXTURE_2D,s),e.texStorage2D(e.TEXTURE_2D,1,e.RGB32F,1,i),e.texSubImage2D(e.TEXTURE_2D,0,0,0,1,i,e.RGB,e.FLOAT,r,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new x({gl:e,texture:s,textureWidth:1,textureHeight:i,textureData:r})):Yi}(e,t.eachEdgeOffset),i.build(),F(this,or)[or]=null,F(this,hr)[hr]={},F(this,ar)[ar]=[],F(this,ur)[ur]=!0}isEmpty(){return 0==this.meshCounts.numMeshes}initFlags(e,t,i){t&je.VISIBLE&&this.meshCounts.numVisible++,t&je.HIGHLIGHTED&&this.meshCounts.numHighlighted++,t&je.XRAYED&&this.meshCounts.numXRayed++,t&je.SELECTED&&this.meshCounts.numSelected++,t&je.CLIPPABLE&&this.meshCounts.numClippable++,t&je.EDGES&&this.meshCounts.numEdges++,t&je.PICKABLE&&this.meshCounts.numPickable++,t&je.CULLED&&this.meshCounts.numCulled++,i&&this.meshCounts.numTransparent++,F(this,pr)[pr](e,t,i),F(this,mr)[mr](e,t)}beginDeferredFlags(){F(this,cr)[cr]=!0}commitDeferredFlags(){if(F(this,cr)[cr]=!1,!F(this,dr)[dr])return;F(this,dr)[dr]=!1;const e=F(this,sr)[sr],t=this.renderState.dataTextureSet;e.bindTexture(e.TEXTURE_2D,t.eachMeshAttributes.texture),e.texSubImage2D(e.TEXTURE_2D,0,0,0,t.eachMeshAttributes.textureWidth,t.eachMeshAttributes.textureHeight,e.RGBA_INTEGER,e.UNSIGNED_BYTE,t.eachMeshAttributes.textureData),e.bindTexture(e.TEXTURE_2D,t.eachEdgeOffset.texture),e.texSubImage2D(e.TEXTURE_2D,0,0,0,t.eachEdgeOffset.textureWidth,t.eachEdgeOffset.textureHeight,e.RGB,e.FLOAT,t.eachEdgeOffset.textureData)}flushInitFlags(){this.commitDeferredFlags()}setMeshVisible(e,t,i){if(!F(this,ur)[ur])throw"Not built";t&je.VISIBLE?this.meshCounts.numVisible++:this.meshCounts.numVisible--,F(this,pr)[pr](e,t,i)}setMeshHighlighted(e,t,i){if(!F(this,ur)[ur])throw"Not built";t&je.HIGHLIGHTED?this.meshCounts.numHighlighted++:this.meshCounts.numHighlighted--,F(this,pr)[pr](e,t,i)}setMeshXRayed(e,t,i){if(!F(this,ur)[ur])throw"Not built";t&je.XRAYED?this.meshCounts.numXRayed++:this.meshCounts.numXRayed--,F(this,pr)[pr](e,t,i)}setMeshSelected(e,t,i){if(!F(this,ur)[ur])throw"Not built";t&je.SELECTED?this.meshCounts.numSelected++:this.meshCounts.numSelected--,F(this,pr)[pr](e,t,i)}setMeshEdges(e,t,i){if(!F(this,ur)[ur])throw"Not built";t&je.EDGES?this.meshCounts.numEdges++:this.meshCounts.numEdges--,F(this,pr)[pr](e,t,i)}setMeshClippable(e,t){if(!F(this,ur)[ur])throw"Not built";t&je.CLIPPABLE?this.meshCounts.numClippable++:this.meshCounts.numClippable--,F(this,mr)[mr](e,t)}setMeshCulled(e,t,i){if(!F(this,ur)[ur])throw"Not built";t&je.CULLED?this.meshCounts.numCulled++:this.meshCounts.numCulled--,F(this,pr)[pr](e,t,i)}setMeshCollidable(e,t){if(!F(this,ur)[ur])throw"Not built"}setMeshPickable(e,t,i){if(!F(this,ur)[ur])throw"Not built";t&je.PICKABLE?this.meshCounts.numPickable++:this.meshCounts.numPickable--,F(this,pr)[pr](e,t,i)}setMeshColor(e,t,i){if(!F(this,ur)[ur])throw"Not built";const r=this.renderState.dataTextureSet,s=F(this,sr)[sr];ir[0]=t[0],ir[1]=t[1],ir[2]=t[2],ir[3]=t[3],r.eachMeshAttributes.textureData.set(ir,28*e),F(this,cr)[cr]?F(this,dr)[dr]=!0:(s.bindTexture(s.TEXTURE_2D,r.eachMeshAttributes.texture),s.texSubImage2D(s.TEXTURE_2D,0,0,e,1,1,s.RGBA_INTEGER,s.UNSIGNED_BYTE,ir))}setMeshTransparent(e,t,i){if(!F(this,ur)[ur])throw"Not built";i?(this.meshCounts.numTransparent++,this.meshCounts.numTransparent++):(this.meshCounts.numTransparent--,this.meshCounts.numTransparent--),F(this,pr)[pr](e,t,i)}setMeshOffset(e,t){if(!F(this,ur)[ur])throw"Not built";const i=F(this,sr)[sr];rr[0]=t[0],rr[1]=t[1],rr[2]=t[2],F(this,cr)[cr]?F(this,dr)[dr]=!0:i.texSubImage2D(i.TEXTURE_2D,0,0,e,1,1,i.RGB,i.FLOAT,rr)}setMeshMatrix(e,t){if(!F(this,ur)[ur])throw"Not built";F(this,sr),F(this,cr)[cr]&&(F(this,dr)[dr]=!0)}setMeshViewMatrixIndex(e,t){if(!F(this,ur)[ur])throw"Not built";F(this,sr),F(this,cr)[cr]&&(F(this,dr)[dr]=!0)}destroy(){this.renderState.dataTextureSet.destroy()}}function Er(e){const t=this.renderState;if(e.indices){const t=this.renderState.primitive===g?1:this.renderState.primitive===p?2:3,i=Math.ceil(e.indices.length/t/Qi)*Qi*t,r=new Uint32Array(i);r.fill(0),r.set(e.indices),e.indices=r}if(e.edgeIndices){const t=Math.ceil(e.edgeIndices.length/2/Qi)*Qi*2,i=new Uint32Array(t);i.fill(0),i.set(e.edgeIndices),e.edgeIndices=i}const i=F(this,or)[or],r=e.positionsCompressed,s=e.indices,n=e.edgeIndices,o=i.positionsCompressed.length/3,h=r.length/3;for(let e=0,t=r.length;e<t;e++)i.positionsCompressed.push(r[e]);let a,l,c=0;if(s){let e;c=s.length/3,e=h<=256?i.indices_8Bits:h<=65536?i.indices_16Bits:i.indices_32Bits,a=e.length/3;for(let t=0,i=s.length;t<i;t++)e.push(s[t])}let d=0;if(n){let e;d=n.length/2,e=h<=256?i.edgeIndices_8Bits:h<=65536?i.edgeIndices_16Bits:i.edgeIndices_32Bits,l=e.length/2;for(let t=0,i=n.length;t<i;t++)e.push(n[t])}return t.numVertices+=h,{vertexBase:o,numVertices:h,numTriangles:c,numEdges:d,indicesBase:a,edgeIndicesBase:l}}function Tr(e,t,i){const r=F(this,or)[or],s=this.renderState,n=e.matrix||Ji,o=e.color||[255,255,255],h=r.positionsCompressed.length/3;let a,l;r.eachMeshPositionsDecompressMatrix.push(t.positionsDecompressMatrix),r.eachMeshMatrices.push(n),r.eachMeshColor.push([o[0],o[1],o[2],255]),r.eachMeshPickColor.push(e.pickColor),a=i.numVertices<=256?s.numIndices8Bits:i.numVertices<=65536?s.numIndices16Bits:s.numIndices32Bits,r.eachMeshVertexPortionBase.push(i.vertexBase),r.eachMeshVertexPortionOffset.push(a/3-i.indicesBase),l=i.numVertices<=256?s.numEdgeIndices8Bits:i.numVertices<=65536?s.numEdgeIndices16Bits:s.numEdgeIndices32Bits,r.eachMeshEdgeIndicesOffset.push(l/2-i.edgeIndicesBase);const c=F(this,ar)[ar].length;if(i.numTriangles>0){const e=3*i.numTriangles;let t;i.numVertices<=256?(t=r.eachPrimitiveMesh_8Bits,s.numIndices8Bits+=e):i.numVertices<=65536?(t=r.eachPrimitiveMesh_16Bits,s.numIndices16Bits+=e):(t=r.eachPrimitiveMesh_32Bits,s.numIndices32Bits+=e);for(let e=0;e<i.numTriangles;e+=Qi)t.push(c)}if(i.numEdges>0){let e,t=2*i.numEdges;i.numVertices<=256?(e=r.eachEdgeMesh_8Bits,s.numEdgeIndices8Bits+=t):i.numVertices<=65536?(e=r.eachEdgeMesh_16Bits,s.numEdgeIndices16Bits+=t):(e=r.eachEdgeMesh_32Bits,s.numEdgeIndices32Bits+=t);for(let t=0;t<i.numEdges;t+=Qi)e.push(c)}return r.eachEdgeOffset.push([0,0,0]),F(this,ar)[ar].push({vertsBase:h,numVerts:i.numTriangles}),F(this,lr)[lr]++,c}function br(e,t,i){if(!F(this,ur)[ur])throw"Not built";const r=!!(t&je.VISIBLE),s=!!(t&je.XRAYED),n=!!(t&je.HIGHLIGHTED),o=!!(t&je.SELECTED),h=!!(t&je.CULLED);let a,l;a=!r||h||s?Ee.NOT_RENDERED:i?Ee.COLOR_TRANSPARENT:Ee.COLOR_OPAQUE,l=!r||h?Ee.NOT_RENDERED:o?Ee.SILHOUETTE_SELECTED:n?Ee.SILHOUETTE_HIGHLIGHTED:s?Ee.SILHOUETTE_XRAYED:Ee.NOT_RENDERED;let c=0;c=!r||h?Ee.NOT_RENDERED:o?Ee.EDGES_SELECTED:n?Ee.EDGES_HIGHLIGHTED:s?Ee.EDGES_XRAYED:t&je.EDGES?i?Ee.EDGES_COLOR_TRANSPARENT:Ee.EDGES_COLOR_OPAQUE:Ee.NOT_RENDERED;let d=r&&!h&&t&je.PICKABLE?Ee.PICK:Ee.NOT_RENDERED;const u=this.renderState.dataTextureSet,f=F(this,sr)[sr];if(ir[0]=a,ir[1]=l,ir[2]=c,ir[3]=d,F(this,cr)[cr])return u.eachMeshAttributes.textureData.set(ir,28*e+8),void(F(this,dr)[dr]=!0);f.bindTexture(f.TEXTURE_2D,u.eachMeshAttributes.texture),f.texSubImage2D(f.TEXTURE_2D,0,2,e,1,1,f.RGBA_INTEGER,f.UNSIGNED_BYTE,ir)}function xr(e,t){if(!F(this,ur)[ur])throw"Not built";const i=t&je.CLIPPABLE?255:0,r=this.renderState.dataTextureSet,s=F(this,sr)[sr];if(ir[0]=i,ir[1]=0,ir[2]=1,ir[3]=2,F(this,cr)[cr])return r.eachMeshAttributes.textureData.set(ir,28*e+12),void(F(this,dr)[dr]=!0);s.bindTexture(s.TEXTURE_2D,r.eachMeshAttributes.texture),s.texSubImage2D(s.TEXTURE_2D,0,3,e,1,1,s.RGBA_INTEGER,s.UNSIGNED_BYTE,ir)}class _r{constructor(){}}class wr{constructor(e,t){this.texture=void 0,this.texture2D=void 0,this.texture=e,this.texture2D=t}destroy(){this.texture2D&&this.texture2D.destroy()}}const Mr=new Uint16Array([0,0,0]);var yr=/*#__PURE__*/U("flags"),Pr=/*#__PURE__*/U("aabb"),Cr=/*#__PURE__*/U("offsetAABB"),Ir=/*#__PURE__*/U("offset"),Rr=/*#__PURE__*/U("colorizeUpdated"),Sr=/*#__PURE__*/U("opacityUpdated");class Dr{constructor(e){this.id=void 0,this.model=void 0,this.sceneObject=void 0,this.layerId=void 0,this.rendererMeshes=void 0,Object.defineProperty(this,yr,{writable:!0,value:void 0}),Object.defineProperty(this,Pr,{writable:!0,value:void 0}),Object.defineProperty(this,Cr,{writable:!0,value:void 0}),Object.defineProperty(this,Ir,{writable:!0,value:void 0}),Object.defineProperty(this,Rr,{writable:!0,value:void 0}),Object.defineProperty(this,Sr,{writable:!0,value:void 0}),this.id=e.id,this.rendererMeshes=e.rendererMeshes||[],F(this,yr)[yr]=0,F(this,Pr)[Pr]=e.aabb,F(this,Cr)[Cr]=B(e.aabb),F(this,Ir)[Ir]=r(),F(this,Rr)[Rr]=!1,F(this,Sr)[Sr]=!1,this.layerId=e.layerId||null;for(let e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].setSceneObject(this)}get aabb(){return F(this,Cr)[Cr]}setVisible(e,t){if(!!(F(this,yr)[yr]&je.VISIBLE)!==t){F(this,yr)[yr]=t?F(this,yr)[yr]|je.VISIBLE:F(this,yr)[yr]&~je.VISIBLE;for(let e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].setVisible(F(this,yr)[yr])}}setHighlighted(e,t){if(!!(F(this,yr)[yr]&je.HIGHLIGHTED)!==t){F(this,yr)[yr]=t?F(this,yr)[yr]|je.HIGHLIGHTED:F(this,yr)[yr]&~je.HIGHLIGHTED;for(let e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].setHighlighted(F(this,yr)[yr])}}setXRayed(e,t){if(!!(F(this,yr)[yr]&je.XRAYED)!==t){F(this,yr)[yr]=t?F(this,yr)[yr]|je.XRAYED:F(this,yr)[yr]&~je.XRAYED;for(let e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].setXRayed(F(this,yr)[yr])}}setSelected(e,t){if(!!(F(this,yr)[yr]&je.SELECTED)!==t){F(this,yr)[yr]=t?F(this,yr)[yr]|je.SELECTED:F(this,yr)[yr]&~je.SELECTED;for(let e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].setSelected(F(this,yr)[yr])}}setEdges(e,t){if(!!(F(this,yr)[yr]&je.EDGES)!==t){F(this,yr)[yr]=t?F(this,yr)[yr]|je.EDGES:F(this,yr)[yr]&~je.EDGES;for(let e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].setEdges(F(this,yr)[yr])}}setCulled(e,t){if(!!(F(this,yr)[yr]&je.CULLED)!==t){F(this,yr)[yr]=t?F(this,yr)[yr]|je.CULLED:F(this,yr)[yr]&~je.CULLED;for(let e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].setCulled(F(this,yr)[yr])}}setClippable(e,t){if(!!(F(this,yr)[yr]&je.CLIPPABLE)!==t){F(this,yr)[yr]=t?F(this,yr)[yr]|je.CLIPPABLE:F(this,yr)[yr]&~je.CLIPPABLE;for(let e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].setClippable(F(this,yr)[yr])}}setCollidable(e,t){if(!!(F(this,yr)[yr]&je.COLLIDABLE)!==t){F(this,yr)[yr]=t?F(this,yr)[yr]|je.COLLIDABLE:F(this,yr)[yr]&~je.COLLIDABLE;for(let e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].setCollidable(F(this,yr)[yr])}}setPickable(e,t){if(!!(F(this,yr)[yr]&je.PICKABLE)!==t){F(this,yr)[yr]=t?F(this,yr)[yr]|je.PICKABLE:F(this,yr)[yr]&~je.PICKABLE;for(let e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].setPickable(F(this,yr)[yr])}}setColorize(e,t){if(t){Mr[0]=Math.floor(255*t[0]),Mr[1]=Math.floor(255*t[1]),Mr[2]=Math.floor(255*t[2]);for(let e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].setColorize(Mr)}else for(let e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].setColorize(null)}setOpacity(e,t){if(0===this.rendererMeshes.length)return;const i=this.rendererMeshes[0].colorize[3];let r=255;if(null!=t){if(t<0?t=0:t>1&&(t=1),r=Math.floor(255*t),i===r)return}else if(r=255,i===r)return;for(let e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].setOpacity(r,F(this,yr)[yr])}setOffset(e,t){}build(){for(let e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].build(F(this,yr)[yr])}finalize2(){for(let e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].finalize2()}destroy(){for(let e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].destroy()}}const Or=s(),Br=s();class Ar{constructor(e){this.id=void 0,this.color=void 0,this.rendererGeometry=void 0,this.rendererTextureSet=void 0,this.matrix=void 0,this.metallic=void 0,this.roughness=void 0,this.opacity=void 0,this.pickId=void 0,this.tileManager=void 0,this.tile=void 0,this.sceneObjectRenderer=void 0,this.aabb=void 0,this.layer=void 0,this.meshIndex=void 0,this.colorize=void 0,this.colorizing=void 0,this.transparent=void 0,this.sceneObjectRenderer=null,this.tileManager=e.tileManager,this.id=e.id,this.pickId=0,this.color=[e.color[0],e.color[1],e.color[2],e.opacity],this.colorize=[e.color[0],e.color[1],e.color[2],e.opacity],this.colorizing=!1,this.transparent=e.opacity<255,this.layer=e.layer,this.matrix=e.matrix,this.metallic=e.metallic,this.roughness=e.roughness,this.opacity=e.opacity,this.aabb=B(),this.rendererTextureSet=e.rendererTextureSet,this.rendererGeometry=e.rendererGeometry,this.meshIndex=e.meshIndex}delegatePickedEntity(){throw new Error("Method not implemented.")}setSceneObject(e){this.sceneObjectRenderer=e}build(e){this.layer.initFlags(this.meshIndex,e,this.transparent)}finalize2(){this.layer.flushInitFlags&&this.layer.flushInitFlags()}setVisible(e){this.layer.setMeshVisible(this.meshIndex,e,this.transparent)}setMatrix(e){const t=n(e,[0,0,0]),i=this.tile;this.tile=i?this.tileManager.updateTileCenter(i,t):this.tileManager.getTile(t);const r=!i||i.id!==this.tile.id,s=this.tile.center;this.layer.setMeshMatrix(this.meshIndex,0!==s[0]||0!==s[1]||0!==s[2]?o(e,h(-s[0],-s[1],-s[2],Or),Br):e),r&&this.layer.setMeshViewMatrixIndex(this.meshIndex,this.tile.index)}setMetallic(e){}setRoughness(e){}setColor(e){this.color[0]=e[0],this.color[1]=e[1],this.color[2]=e[2],this.colorizing||this.layer.setMeshColor(this.meshIndex,this.color)}setColorize(e){e?(this.colorize[0]=e[0],this.colorize[1]=e[1],this.colorize[2]=e[2],this.layer.setMeshColor(this.meshIndex,this.colorize,!1),this.colorizing=!0):(this.layer.setMeshColor(this.meshIndex,this.color,!1),this.colorizing=!1)}setOpacity(e,t){const i=e<255,r=this.transparent!==i;this.color[3]=e,this.colorize[3]=e,this.transparent=i,this.layer.setMeshColor(this.meshIndex,this.colorizing?this.colorize:this.color),r&&this.layer.setMeshTransparent(this.meshIndex,t,i)}setHighlighted(e){this.layer.setMeshHighlighted(this.meshIndex,e,this.transparent)}setXRayed(e){this.layer.setMeshXRayed(this.meshIndex,e,this.transparent)}setSelected(e){this.layer.setMeshSelected(this.meshIndex,e,this.transparent)}setEdges(e){this.layer.setMeshEdges(this.meshIndex,e,this.transparent)}setClippable(e){this.layer.setMeshClippable(this.meshIndex,e)}setCollidable(e){this.layer.setMeshCollidable(this.meshIndex,e)}setPickable(e){this.layer.setMeshPickable(this.meshIndex,e,this.transparent)}setCulled(e){this.layer.setMeshCulled(this.meshIndex,e,this.transparent)}canPickTriangle(){return!1}drawPickTriangles(e,t){}pickTriangleSurface(e){}canPickWorldPos(){return!0}drawPickNormals(e){}destroy(){this.tile&&this.tileManager&&this.tileManager.putTile(this.tile)}}class Lr{constructor(e){this.id=void 0,this.colorTexture=void 0,this.metallicRoughnessTexture=void 0,this.emissiveTexture=void 0,this.occlusionTexture=void 0,this.id=e.id,this.colorTexture=e.colorTexture,this.metallicRoughnessTexture=e.metallicRoughnessTexture,this.emissiveTexture=e.emissiveTexture,this.occlusionTexture=e.occlusionTexture}}r(),s(),r([1,1,1]),r([0,0,0]),r([0,0,0]),a();const Ur="defaultTextureSet";var Fr=/*#__PURE__*/U("view"),jr=/*#__PURE__*/U("webglRenderer"),Gr=/*#__PURE__*/U("renderContext"),Nr=/*#__PURE__*/U("position"),Hr=/*#__PURE__*/U("rotation"),Xr=/*#__PURE__*/U("quaternion"),kr=/*#__PURE__*/U("scale"),Vr=/*#__PURE__*/U("worldMatrix"),Wr=/*#__PURE__*/U("viewMatrix"),zr=/*#__PURE__*/U("colorTextureEnabled"),$r=/*#__PURE__*/U("backfaces"),qr=/*#__PURE__*/U("layers"),Yr=/*#__PURE__*/U("numGeometries"),Kr=/*#__PURE__*/U("numTriangles"),Zr=/*#__PURE__*/U("numLines"),Qr=/*#__PURE__*/U("numPoints"),Jr=/*#__PURE__*/U("numViewerObjects"),es=/*#__PURE__*/U("textureTranscoder"),ts=/*#__PURE__*/U("aabbDirty"),is=/*#__PURE__*/U("edgeThreshold"),rs=/*#__PURE__*/U("currentLayers"),ss=/*#__PURE__*/U("aabb"),ns=/*#__PURE__*/U("viewMatrixDirty"),os=/*#__PURE__*/U("worldMatrixNonIdentity"),hs=/*#__PURE__*/U("onCameraViewMatrix"),as=/*#__PURE__*/U("layerId"),ls=/*#__PURE__*/U("addModel"),cs=/*#__PURE__*/U("addTexture"),ds=/*#__PURE__*/U("addGeometry"),us=/*#__PURE__*/U("addMesh"),fs=/*#__PURE__*/U("addObject"),gs=/*#__PURE__*/U("removeModel"),ps=/*#__PURE__*/U("createDefaultTextureSetRenderer"),ms=/*#__PURE__*/U("getLayer"),vs=/*#__PURE__*/U("rebuildAABB");class Es extends I{constructor(t){super(t.view),Object.defineProperty(this,vs,{value:Cs}),Object.defineProperty(this,ms,{value:Ps}),Object.defineProperty(this,ps,{value:ys}),Object.defineProperty(this,gs,{value:Ms}),Object.defineProperty(this,fs,{value:ws}),Object.defineProperty(this,us,{value:_s}),Object.defineProperty(this,ds,{value:xs}),Object.defineProperty(this,cs,{value:bs}),Object.defineProperty(this,ls,{value:Ts}),this.qualityRender=void 0,this.sceneModel=void 0,this.rendererGeometries=void 0,this.rendererTextures=void 0,this.rendererTextureSets=void 0,this.rendererMeshes=void 0,this.rendererObjects=void 0,this.rendererObjectsList=void 0,this.rendererViewObjects=void 0,this.viewer=void 0,this.layerList=void 0,this.onBuilt=void 0,Object.defineProperty(this,Fr,{writable:!0,value:void 0}),Object.defineProperty(this,jr,{writable:!0,value:void 0}),Object.defineProperty(this,Gr,{writable:!0,value:void 0}),Object.defineProperty(this,Nr,{writable:!0,value:void 0}),Object.defineProperty(this,Hr,{writable:!0,value:void 0}),Object.defineProperty(this,Xr,{writable:!0,value:void 0}),Object.defineProperty(this,kr,{writable:!0,value:void 0}),Object.defineProperty(this,Vr,{writable:!0,value:void 0}),Object.defineProperty(this,Wr,{writable:!0,value:void 0}),Object.defineProperty(this,zr,{writable:!0,value:void 0}),Object.defineProperty(this,$r,{writable:!0,value:void 0}),Object.defineProperty(this,qr,{writable:!0,value:void 0}),Object.defineProperty(this,Yr,{writable:!0,value:void 0}),Object.defineProperty(this,Kr,{writable:!0,value:void 0}),Object.defineProperty(this,Zr,{writable:!0,value:void 0}),Object.defineProperty(this,Qr,{writable:!0,value:void 0}),Object.defineProperty(this,Jr,{writable:!0,value:void 0}),Object.defineProperty(this,es,{writable:!0,value:void 0}),Object.defineProperty(this,ts,{writable:!0,value:void 0}),Object.defineProperty(this,is,{writable:!0,value:void 0}),Object.defineProperty(this,rs,{writable:!0,value:void 0}),Object.defineProperty(this,ss,{writable:!0,value:void 0}),Object.defineProperty(this,ns,{writable:!0,value:void 0}),Object.defineProperty(this,os,{writable:!0,value:void 0}),Object.defineProperty(this,hs,{writable:!0,value:void 0}),Object.defineProperty(this,as,{writable:!0,value:void 0}),this.id=t.id,this.sceneModel=t.sceneModel,this.viewer=t.view.viewer,F(this,Fr)[Fr]=t.view,F(this,jr)[jr]=t.webglRenderer,F(this,Gr)[Gr]=t.renderContext,F(this,es)[es]=t.textureTranscoder,F(this,ss)[ss]=S(),F(this,ts)[ts]=!1,F(this,qr)[qr]={},this.layerList=[],F(this,rs)[rs]={},this.rendererGeometries={},this.rendererTextures={},this.rendererTextureSets={},this.rendererMeshes={},this.rendererObjects={},this.rendererObjectsList=[],this.rendererViewObjects={},F(this,Yr)[Yr]=0,F(this,Jr)[Jr]=0,F(this,Kr)[Kr]=0,F(this,Zr)[Zr]=0,F(this,Qr)[Qr]=0,F(this,is)[is]=t.edgeThreshold||10,this.built=!1,F(this,Nr)[Nr]=r(t.position||[0,0,0]),F(this,Hr)[Hr]=r(t.rotation||[0,0,0]),F(this,Xr)[Xr]=e(t.quaternion||[0,0,0,1]),t.rotation&&l(F(this,Hr)[Hr],"XYZ",F(this,Xr)[Xr]),F(this,kr)[kr]=r(t.scale||[1,1,1]),F(this,Vr)[Vr]=s(),c(F(this,Nr)[Nr],F(this,Xr)[Xr],F(this,kr)[kr],F(this,Vr)[Vr]),(t.matrix||t.position||t.rotation||t.scale||t.quaternion)&&(F(this,Wr)[Wr]=s(),F(this,ns)[ns]=!0,F(this,os)[os]=!0),this.qualityRender=!1!==t.qualityRender,F(this,as)[as]=t.layerId,F(this,hs)[hs]=F(this,Fr)[Fr].camera.onViewMatrix.subscribe((e,t)=>{F(this,ns)[ns]=!0}),F(this,ps)[ps](),this.onBuilt=new R(new C),F(this,ls)[ls](t.sceneModel);for(let e=0,t=this.layerList.length;e<t;e++)this.layerList[e].layerIndex=e;F(this,rs)[rs]={},this.built=!0,F(this,jr)[jr].setImageDirty(),this.onBuilt.dispatch(this,null)}get position(){return F(this,Nr)[Nr]}get rotation(){return F(this,Hr)[Hr]}get quaternion(){return F(this,Xr)[Xr]}get scale(){return F(this,kr)[kr]}get worldMatrix(){return F(this,Vr)[Vr]}get viewMatrix(){return F(this,Wr)[Wr]?(F(this,ns)[ns]&&(o(F(this,Fr)[Fr].camera.viewMatrix,F(this,Vr)[Vr],F(this,Wr)[Wr]),F(this,ns)[ns]=!1),F(this,Wr)[Wr]):F(this,Fr)[Fr].camera.viewMatrix}get colorTextureEnabled(){return F(this,zr)[zr]}get backfaces(){return F(this,$r)[$r]}set backfaces(e){e=!!e,F(this,$r)[$r]=e,F(this,jr)[jr].setImageDirty()}get matrix(){return F(this,Vr)[Vr]}get aabb(){return F(this,ts)[ts]&&F(this,vs)[vs](),F(this,ss)[ss]}get numTriangles(){return F(this,Kr)[Kr]}get numLines(){return F(this,Zr)[Zr]}get numPoints(){return F(this,Qr)[Qr]}setVisible(e,t){for(let i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setVisible(e,t);F(this,jr)[jr].setImageDirty(e)}setXRayed(e,t){for(let i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setXRayed(e,t);F(this,jr)[jr].setImageDirty(e)}setHighlighted(e,t){for(let i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setHighlighted(e,t);F(this,jr)[jr].setImageDirty(e)}setSelected(e,t){for(let i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setSelected(e,t);F(this,jr)[jr].setImageDirty(e)}setEdges(e,t){for(let i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setEdges(e,t);F(this,jr)[jr].setImageDirty(e)}setCulled(e,t){for(let i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setCulled(e,t);F(this,jr)[jr].setImageDirty(e)}setClippable(e,t){for(let i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setClippable(e,t);F(this,jr)[jr].setImageDirty(e)}setCollidable(e,t){for(let i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setCollidable(e,t)}setPickable(e,t){for(let i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setPickable(e,t)}setColorize(e,t){for(let i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setColorize(e,t)}setOpacity(e,t){for(let i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setOpacity(e,t)}destroy(){if(!this.destroyed){F(this,gs)[gs](),F(this,Fr)[Fr].camera.onViewMatrix.unsubscribe(F(this,hs)[hs]);for(let e in F(this,rs)[rs])F(this,rs)[rs].hasOwnProperty(e)&&F(this,rs)[rs][e].destroy();for(let e=0,t=this.layerList.length;e<t;e++)this.layerList[e].destroy();for(let e in this.rendererObjects)this.rendererObjects[e].destroy();F(this,rs)[rs]={},F(this,qr)[qr]={},this.layerList=[],this.rendererGeometries={},this.rendererTextures={},this.rendererTextureSets={},this.rendererMeshes={},this.rendererViewObjects={},this.onBuilt.clear(),super.destroy()}}}function Ts(e){const t=e.textures,i=e.geometries,r=e.meshes,s=e.objects;if(t)for(let e in t){const i=t[e];F(this,cs)[cs](i)}if(i)for(let e in i){const t=i[e];F(this,ds)[ds](t)}if(r)for(let e in r){const t=r[e];F(this,us)[us](t)}if(s)for(let e in s){const t=s[e];F(this,fs)[fs](t)}for(let e in F(this,rs)[rs])F(this,rs)[rs].hasOwnProperty(e)&&F(this,rs)[rs][e].build();for(let e=0,t=this.rendererObjectsList.length;e<t;e++)this.rendererObjectsList[e].build();for(let e=0,t=this.rendererObjectsList.length;e<t;e++)this.rendererObjectsList[e].finalize2()}function bs(e){const t=e.id;if(this.rendererTextures[t])throw new Error("RendererTexture already created: "+t);const i=new _({gl:F(this,Gr)[Gr].gl});if(e.preloadColor&&i.setPreloadColor(e.preloadColor),e.image){const t=e.image;t.crossOrigin="Anonymous",i.setImage(t,{minFilter:e.minFilter,magFilter:e.magFilter,wrapS:e.wrapS,wrapT:e.wrapT,wrapR:e.wrapR,flipY:e.flipY,encoding:e.encoding})}else if(e.src){const t=e.src.split(".").pop();switch(t){case"jpeg":case"jpg":case"png":case"gif":const r=new Image;r.onload=()=>{i.setImage(r,{minFilter:e.minFilter,magFilter:e.magFilter,wrapS:e.wrapS,wrapT:e.wrapT,wrapR:e.wrapR,flipY:e.flipY,encoding:e.encoding})},r.src=e.src;break;default:F(this,es)[es]?function(e,t,i){var r=function(e){};t=t||r,i=i||r;var s=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(s){var n=!!s[2],o=s[3];o=window.decodeURIComponent(o),n&&(o=window.atob(o));try{for(var h=new ArrayBuffer(o.length),a=new Uint8Array(h),l=0;l<o.length;l++)a[l]=o.charCodeAt(l);window.setTimeout(function(){t(h)},0)}catch(e){window.setTimeout(function(){i(e)},0)}}else{var c=new XMLHttpRequest;c.open("GET",e,!0),c.responseType="arraybuffer",c.onreadystatechange=function(){4===c.readyState&&(200===c.status?t(c.response):i("loadArrayBuffer error : "+c.response))},c.send(null)}}(e.src,e=>{e.byteLength?F(this,es)[es].transcode([e]).then(e=>{i.setCompressedData(e),F(this,jr)[jr].setImageDirty()}):this.error("Can't create texture from 'src': file data is zero length")},e=>{this.error(`Can't create texture from 'src': ${e}`)}):this.error(`Can't create texture from 'src' - rendererModel needs to be configured with a TextureTranscoder for this file type ('${t}')`)}}else e.buffers&&(F(this,es)[es]?F(this,es)[es].transcode(e.buffers).then(e=>{i.setCompressedData(e),F(this,jr)[jr].setImageDirty()}):this.error("Can't create texture from 'buffers' - rendererModel needs to be configured with a TextureTranscoder for this option"));const r=new wr(e,i);e.rendererTexture=r,this.rendererTextures[t]=r}function xs(e){const t=e.id;if(this.rendererGeometries[t])throw new Error(`GeometryRenderer already created: ${t}`);const i=new _r;this.rendererGeometries[t]=i,e.rendererGeometry=i,F(this,Yr)[Yr]++}function _s(e){const t=this.rendererGeometries[e.geometry.id];if(!t)throw new Error("RendererGeometry not found");const i=this.rendererTextureSets[e.textureSet.id];if(!i)throw new Error("rendererTextureSet not found");const r=F(this,ms)[ms](e.textureSet.id,e.geometry);if(!r)return;let s;r.hasGeometry(e.geometry.id)||r.createGeometryCompressed(e.geometry),F(this,os)[os]&&F(this,Vr),s=e.matrix;const n=e.color?new Uint8Array([Math.floor(255*e.color[0]),Math.floor(255*e.color[1]),Math.floor(255*e.color[2])]):[255,255,255],o=null!=e.opacity?Math.floor(255*e.opacity):255,h=null!=e.metallic?Math.floor(255*e.metallic):0,a=null!=e.roughness?Math.floor(255*e.roughness):255,l=new Ar({tileManager:F(this,jr)[jr].tileManager,id:e.id,layer:r,color:n,opacity:o,matrix:s,metallic:h,roughness:a,rendererTextureSet:i,rendererGeometry:t,meshIndex:0});l.pickId=F(this,jr)[jr].registerPickable(l);const c=new Uint8Array([255&l.pickId,l.pickId>>8&255,l.pickId>>16&255,l.pickId>>24&255]);S(l.aabb);const d=r.createMesh({id:e.id,geometryId:e.geometry.id,color:n,opacity:o,metallic:h,roughness:a,matrix:s,pickColor:c});F(this,Yr)[Yr]++,A(F(this,ss)[ss],l.aabb),l.layer=r,l.meshIndex=d,this.rendererMeshes[e.id]=l}function ws(e){let t=e.id;void 0===t?t=V():this.rendererObjects[t]&&(this.error("[createObject] rendererModel already has a ViewerObject with this ID: "+t+" - will assign random ID"),t=V());const i=e.meshes;if(void 0===i)throw new Error("[createObject] Param expected: meshes");const r=[];for(let e=0,t=i.length;e<t;e++)r.push(this.rendererMeshes[i[e].id]);const s=new Dr({id:t,rendererModel:this,rendererMeshes:r,aabb:e.aabb,layerId:F(this,as)[as]});this.rendererObjectsList.push(s),this.rendererObjects[t]=s,this.rendererViewObjects[t]=s,F(this,Jr)[Jr]++}function Ms(){const e=this.sceneModel;if(!e)return;const t=e.textures,i=e.geometries,r=e.meshes,s=e.objects;if(t)for(let e in t){const i=t[e];i.rendererTexture&&(i.rendererTexture=null)}if(i)for(let e in i){const t=i[e];t.rendererGeometry&&(t.rendererGeometry=null)}if(r)for(let e in r){const t=r[e];t.rendererMesh&&(t.rendererMesh=null)}if(s)for(let e in s){const t=s[e];t.rendererObject&&(t.rendererObject=null)}this.sceneModel=null}function ys(){const e=new wr(null,new _({gl:F(this,Gr)[Gr].gl,preloadColor:[1,1,1,1]})),t=new wr(null,new _({gl:F(this,Gr)[Gr].gl,preloadColor:[0,1,1,1]})),i=new wr(null,new _({gl:F(this,Gr)[Gr].gl,preloadColor:[0,0,0,0]})),r=new wr(null,new _({gl:F(this,Gr)[Gr].gl,preloadColor:[0,0,0,1]})),s=new wr(null,new _({gl:F(this,Gr)[Gr].gl,preloadColor:[1,1,1,1]}));this.rendererTextures.defaultColorTexture=e,this.rendererTextures.defaultMetalRoughTexture=t,this.rendererTextures.defaultNormalsTexture=i,this.rendererTextures.defaultEmissiveTexture=r,this.rendererTextures.defaultOcclusionTexture=s,this.rendererTextureSets[Ur]=new Lr({id:Ur,colorTexture:e,metallicRoughnessTexture:t,emissiveTexture:r,occlusionTexture:s})}function Ps(e,t){const i=`${e}_${t.primitive}`;let r,s=F(this,rs)[rs][i];if(s){if(s.canCreateMesh(t))return s;s.build(),delete F(this,rs)[rs][i]}if(!e||(r=this.rendererTextureSets[e],r))return s=new vr({gl:F(this,Gr)[Gr].gl,view:F(this,Fr)[Fr],rendererModel:this,primitive:t.primitive,textureSet:r,layerIndex:0}),F(this,qr)[qr][i]=s,this.layerList.push(s),F(this,rs)[rs][i]=s,s;this.error(`TextureSet not found: ${e} - ensure that you create it first with createTextureSet()`)}function Cs(){S(F(this,ss)[ss]);for(let e=0,t=this.rendererObjectsList.length;e<t;e++){const t=this.rendererObjectsList[e];A(F(this,ss)[ss],t.aabb)}F(this,ts)[ts]=!1}r();const Is=new Float32Array(16),Rs=new Float64Array(4),Ss=new Float64Array(4);function Ds(e,t,i=Is){return Rs[0]=t[0],Rs[1]=t[1],Rs[2]=t[2],Rs[3]=1,d(e,Rs,Ss),u(e,Ss,i),i}function Os(e,t,i=200){return t[0]=Math.round(e[0]/i)*i,t[1]=Math.round(e[1]/i)*i,t[2]=Math.round(e[2]/i)*i,t}const Bs=2e3;var As=/*#__PURE__*/U("gl"),Ls=/*#__PURE__*/U("indexesUsed"),Us=/*#__PURE__*/U("tiles"),Fs=/*#__PURE__*/U("dataTexture"),js=/*#__PURE__*/U("camera"),Gs=/*#__PURE__*/U("lastFreeIndex"),Ns=/*#__PURE__*/U("putFreeTile"),Hs=/*#__PURE__*/U("findFreeTile");class Xs{constructor(e){Object.defineProperty(this,Hs,{value:Vs}),Object.defineProperty(this,Ns,{value:ks}),Object.defineProperty(this,As,{writable:!0,value:void 0}),Object.defineProperty(this,Ls,{writable:!0,value:void 0}),Object.defineProperty(this,Us,{writable:!0,value:void 0}),Object.defineProperty(this,Fs,{writable:!0,value:void 0}),Object.defineProperty(this,js,{writable:!0,value:void 0}),Object.defineProperty(this,Gs,{writable:!0,value:void 0}),F(this,js)[js]=e.camera,F(this,As)[As]=e.gl,F(this,Ls)[Ls]=[],F(this,Gs)[Gs]=0,F(this,Us)[Us]={},F(this,Fs)[Fs]=function(e,t){const i=Bs;if(0==i)throw"texture height == 0";const r=new $i(48*i),s=e.createTexture();return s?(e.bindTexture(e.TEXTURE_2D,s),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA16F,12,i),e.texSubImage2D(e.TEXTURE_2D,0,0,0,12,i,e.RGBA,e.HALF_FLOAT,new Uint16Array(r.buffer),0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new x({gl:e,texture:s,textureWidth:12,textureHeight:i})):Yi}(F(this,As)[As])}getTile(e){const t=Os(e,r()),i=`${t[0]}-${t[1]}-${t[2]}`;let n=F(this,Us)[Us][i];return n||(n={id:i,index:F(this,Hs)[Hs](),useCount:0,center:r(),rtcViewMatrix:s()},F(this,Us)[Us][n.id]=n),n.useCount++,n}putTile(e){--e.useCount<=0&&(delete F(this,Us)[Us][e.id],F(this,Ns)[Ns](e.index))}updateTileCenter(e,t){const i=Os(t,r()),n=`${i[0]}-${i[1]}-${i[2]}`;if(n===e.id)return e;this.putTile(e);let o=F(this,Us)[Us][n];return o||(o={id:n,index:F(this,Hs)[Hs](),useCount:0,center:r(),rtcViewMatrix:s()},F(this,Us)[Us][o.id]=o),o.useCount++,o}refreshMatrices(){if(!F(this,Fs)[Fs].texture)return;const e=F(this,As)[As],t=F(this,js)[js].viewMatrix,i=Object.keys(F(this,Us)[Us]),r=new Float32Array(16*i.length);for(let e=0,s=i.length;e<s;e++){const s=i[e],n=F(this,Us)[Us][s];Ds(t,n.center,n.rtcViewMatrix),r.set(n.rtcViewMatrix,16*n.index)}e.bindTexture(e.TEXTURE_2D,F(this,Fs)[Fs].texture),e.texSubImage2D(e.TEXTURE_2D,0,0,0,1,1,e.RGBA,e.FLOAT,r),e.bindTexture(e.TEXTURE_2D,null)}}function ks(e){delete F(this,Ls)[Ls][e],F(this,Gs)[Gs]=e}function Vs(){for(let e=F(this,Gs)[Gs];;e=(e+1)%Bs)if(!F(this,Ls)[Ls][e])return F(this,Ls)[Ls][e]=!0,e}const Ws=navigator.userAgent.match(/(opera|chrome|safari|firefox|msie|mobile)\/?\s*(\.?\d+(\.\d+)*)/i),zs=Ws&&"safari"===Ws[1].toLowerCase();var $s=/*#__PURE__*/U("sceneModels"),qs=/*#__PURE__*/U("viewer"),Ys=/*#__PURE__*/U("view"),Ks=/*#__PURE__*/U("renderContext"),Zs=/*#__PURE__*/U("canvasTransparent"),Qs=/*#__PURE__*/U("transparentEnabled"),Js=/*#__PURE__*/U("edgesEnabled"),en=/*#__PURE__*/U("imageDirty"),tn=/*#__PURE__*/U("saoEnabled"),rn=/*#__PURE__*/U("pbrEnabled"),sn=/*#__PURE__*/U("backgroundColor"),nn=/*#__PURE__*/U("rendererModels"),on=/*#__PURE__*/U("layerList"),hn=/*#__PURE__*/U("layerListDirty"),an=/*#__PURE__*/U("stateSortDirty"),ln=/*#__PURE__*/U("pickIDs"),cn=/*#__PURE__*/U("saoDepthRenderBuffer"),dn=/*#__PURE__*/U("extensionHandles"),un=/*#__PURE__*/U("logarithmicDepthBufferEnabled"),fn=/*#__PURE__*/U("alphaDepthMask"),gn=/*#__PURE__*/U("occlusionTester"),pn=/*#__PURE__*/U("textureTranscoder"),mn=/*#__PURE__*/U("layerRenderers"),vn=/*#__PURE__*/U("viewMatrixDirty"),En=/*#__PURE__*/U("registerRendererViewObjects"),Tn=/*#__PURE__*/U("deregisterRendererViewObjects"),bn=/*#__PURE__*/U("updateLayerList"),xn=/*#__PURE__*/U("buildLayerList"),_n=/*#__PURE__*/U("draw"),wn=/*#__PURE__*/U("activateExtensions"),Mn=/*#__PURE__*/U("drawSAOBuffers"),yn=/*#__PURE__*/U("drawDepth"),Pn=/*#__PURE__*/U("drawColor"),Cn=/*#__PURE__*/U("drawLayer");class In{constructor(e){Object.defineProperty(this,Cn,{value:jn}),Object.defineProperty(this,Pn,{value:Fn}),Object.defineProperty(this,yn,{value:Un}),Object.defineProperty(this,Mn,{value:Ln}),Object.defineProperty(this,wn,{value:An}),Object.defineProperty(this,_n,{value:Bn}),Object.defineProperty(this,xn,{value:On}),Object.defineProperty(this,bn,{value:Dn}),Object.defineProperty(this,Tn,{value:Sn}),Object.defineProperty(this,En,{value:Rn}),this.rendererViewObjects=void 0,this.tileManager=void 0,Object.defineProperty(this,$s,{writable:!0,value:void 0}),Object.defineProperty(this,qs,{writable:!0,value:void 0}),Object.defineProperty(this,Ys,{writable:!0,value:void 0}),Object.defineProperty(this,Ks,{writable:!0,value:void 0}),Object.defineProperty(this,Zs,{writable:!0,value:void 0}),Object.defineProperty(this,Qs,{writable:!0,value:void 0}),Object.defineProperty(this,Js,{writable:!0,value:void 0}),Object.defineProperty(this,en,{writable:!0,value:void 0}),Object.defineProperty(this,tn,{writable:!0,value:void 0}),Object.defineProperty(this,rn,{writable:!0,value:void 0}),Object.defineProperty(this,sn,{writable:!0,value:void 0}),Object.defineProperty(this,nn,{writable:!0,value:void 0}),Object.defineProperty(this,on,{writable:!0,value:void 0}),Object.defineProperty(this,hn,{writable:!0,value:void 0}),Object.defineProperty(this,an,{writable:!0,value:void 0}),Object.defineProperty(this,ln,{writable:!0,value:new k({})}),Object.defineProperty(this,cn,{writable:!0,value:void 0}),Object.defineProperty(this,dn,{writable:!0,value:void 0}),Object.defineProperty(this,un,{writable:!0,value:void 0}),Object.defineProperty(this,fn,{writable:!0,value:void 0}),Object.defineProperty(this,gn,{writable:!0,value:void 0}),Object.defineProperty(this,pn,{writable:!0,value:void 0}),Object.defineProperty(this,mn,{writable:!0,value:void 0}),Object.defineProperty(this,vn,{writable:!0,value:void 0}),this.tileManager=null,F(this,$s)[$s]={},this.rendererViewObjects={},F(this,pn)[pn]=e.textureTranscoder||new ge({}),F(this,Zs)[Zs]=!1,F(this,fn)[fn]=!1,F(this,dn)[dn]={},F(this,ln)[ln]=new k({}),F(this,on)[on]=[],F(this,hn)[hn]=!0,F(this,an)[an]=!0,F(this,en)[en]=!0,F(this,Qs)[Qs]=!0,F(this,Js)[Js]=!0,F(this,tn)[tn]=!0,F(this,rn)[rn]=!0,F(this,sn)[sn]=r(),F(this,gn)[gn]=null,F(this,un)[un]=!1,F(this,nn)[nn]={},F(this,vn)[vn]=!0}init(e){F(this,qs)[qs]=e,F(this,pn)[pn].init(F(this,qs)[qs].capabilities)}getCapabilities(e){e.maxViews=1;const t=document.createElement("canvas");let i;try{i=t.getContext("webgl2")}catch(e){console.error("Failed to get a WebGL context")}i&&(e.astcSupported=!!w(i,"WEBGL_compressed_texture_astc"),e.etc1Supported=!0,e.etc2Supported=!!w(i,"WEBGL_compressed_texture_etc"),e.dxtSupported=!!w(i,"WEBGL_compressed_texture_s3tc"),e.bptcSupported=!!w(i,"EXT_texture_compression_bptc"),e.pvrtcSupported=!(!w(i,"WEBGL_compressed_texture_pvrtc")&&!w(i,"WEBKIT_WEBGL_compressed_texture_pvrtc")))}registerView(e){if(F(this,Ks)[Ks])throw"Only one View allowed with WebGLRenderer (see WebViewerCapabilities.maxViews)";F(this,Ys)[Ys]=e;const t=["webglutils"],i=e.canvasElement,r={};let s=null;for(let e=0;!s&&e<t.length;e++)try{s=i.getContext(t[e],r)}catch(e){}return s?(s&&s.hint(s.FRAGMENT_SHADER_DERIVATIVE_HINT,s.NICEST),F(this,Ks)[Ks]=new ve(F(this,qs)[qs],F(this,Ys)[Ys],s),this.tileManager=new Xs({camera:e.camera,gl:s}),F(this,mn)[mn]={colorTriangles:new Ae(F(this,Ks)[Ks])},e.camera.onViewMatrix.sub(()=>{F(this,vn)[vn]=!0}),0):(console.error("Failed to get a WebGL2 context"),0)}deregisterView(e){}addModel(e){if(!F(this,Ks)[Ks])throw new Error("Must register a View before you add a SceneModel");const t=new Es(function(e,t){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}({sceneModel:e.sceneModel,view:F(this,Ys)[Ys],textureTranscoder:F(this,pn)[pn],webglRenderer:this,renderContext:F(this,Ks)[Ks],layerId:e.layerId},e));F(this,nn)[nn][t.id]=t,F(this,En)[En](t),F(this,hn)[hn]=!0,t.onDestroyed.one(e=>{const t=F(this,nn)[nn][e.id];delete F(this,nn)[nn][e.id],F(this,Tn)[Tn](t),F(this,hn)[hn]=!0})}removeModel(e){if(F(this,$s)[$s][e]){const t=F(this,nn)[nn][e];delete F(this,nn)[nn][e],F(this,Tn)[Tn](t),F(this,hn)[hn]=!0}}registerPickable(e){return F(this,ln)[ln].addItem(e)}deregisterPickable(e){F(this,ln)[ln].removeItem(e)}setImageDirty(e){F(this,en)[en]=!0}setBackgroundColor(e,t){F(this,sn)[sn].set(t),F(this,en)[en]=!0}setEdgesEnabled(e,t){F(this,Js)[Js]=t,F(this,en)[en]=!0}setPBREnabled(e,t){F(this,rn)[rn]=t,F(this,en)[en]=!0}getSAOSupported(){return zs&&T.SUPPORTED_EXTENSIONS.OES_standard_derivatives}setSAOEnabled(e,t){F(this,tn)[tn]=t,F(this,en)[en]=!0}setTransparentEnabled(e,t){F(this,Qs)[Qs]=t,F(this,en)[en]=!0}clear(e){const t=F(this,Ks)[Ks].gl;t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),F(this,Zs)[Zs]?t.clearColor(1,1,1,1):t.clearColor(F(this,sn)[sn][0],F(this,sn)[sn][1],F(this,sn)[sn][2],1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}needsRebuild(e){for(let e in F(this,mn)[mn])F(this,mn)[mn][e].needRebuild()}needsRender(e){return F(this,en)[en]||F(this,hn)[hn]||F(this,an)[an]}render(e,t){(t=t||{}).force&&(F(this,en)[en]=!0),F(this,vn)[vn]&&(this.tileManager.refreshMatrices(),F(this,vn)[vn]=!1),F(this,bn)[bn](),F(this,en)[en]&&(F(this,_n)[_n]({clear:!0}),F(this,en)[en]=!1)}pickSceneObject(e,t){return null}}function Rn(e){const t=e.rendererViewObjects;for(let e in t)this.rendererViewObjects[e]=t[e]}function Sn(e){const t=e.rendererViewObjects;for(let e in t)delete this.rendererViewObjects[e]}function Dn(){F(this,hn)[hn]&&(F(this,xn)[xn](),F(this,hn)[hn]=!1,F(this,an)[an]=!0),F(this,an)[an]&&(F(this,an)[an]=!1,F(this,en)[en]=!0)}function On(){let e=0;for(let t in F(this,nn)[nn]){const i=F(this,nn)[nn][t];for(let t=0,r=i.layerList.length;t<r;t++)F(this,on)[on][e++]=i.layerList[t]}F(this,on)[on].length=e}function Bn(e){F(this,wn)[wn](),F(this,tn)[tn]&&F(this,Ys)[Ys].sao.possible&&F(this,Mn)[Mn](e),F(this,Pn)[Pn](e)}function An(){T.SUPPORTED_EXTENSIONS.OES_element_index_uint&&(F(this,dn)[dn].OES_element_index_uint=F(this,Ks)[Ks].gl.getExtension("OES_element_index_uint")),F(this,un)[un]&&T.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(F(this,dn)[dn].EXT_frag_depth=F(this,Ks)[Ks].gl.getExtension("EXT_frag_depth")),T.SUPPORTED_EXTENSIONS.WEBGL_depth_texture&&(F(this,dn)[dn].WEBGL_depth_texture=F(this,Ks)[Ks].gl.getExtension("WEBGL_depth_texture"))}function Ln(e){}function Un(e){F(this,Ks)[Ks].reset();const t=F(this,Ks)[Ks].gl;t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),t.clearColor(0,0,0,0),t.enable(t.DEPTH_TEST),t.frontFace(t.CCW),t.enable(t.CULL_FACE),t.depthMask(!0),!1!==e.clear&&t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}function Fn(e){const t=F(this,Ys)[Ys],i=F(this,Ks)[Ks],r=i.gl,s=[],n=[],o=[],h=[],a=[],l=[],c=[],d=[],u=[],f=[],g=[],p=[],m=[],v=[],E=[],b=[];i.reset(),i.withSAO=!1,i.pbrEnabled=F(this,rn)[rn]&&!!t.qualityRender,r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),F(this,Zs)[Zs]?r.clearColor(0,0,0,0):r.clearColor(F(this,sn)[sn][0],F(this,sn)[sn][1],F(this,sn)[sn][2],1),r.enable(r.DEPTH_TEST),r.frontFace(r.CCW),r.enable(r.CULL_FACE),r.depthMask(!0),r.lineWidth(1),i.lineWidth=1;const x=t.sao.possible;F(this,tn)[tn]&&x||(i.occlusionTexture=null),!1!==e.clear&&r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);let _=0,w=0,M=0,y=0,P=0,C=0,I=0,R=0,S=0,D=0,O=0,B=0,A=0,L=0,U=0,j=0;for(let e=0,i=F(this,on)[on].length;e<i;e++){const i=F(this,on)[on][e],r=i.meshCounts;r.numCulled!==r.numMeshes&&0!==r.numVisible&&(r.numTransparent<r.numMeshes&&(F(this,tn)[tn]&&x&&i.rendererModel.qualityRender?s[_++]=i:F(this,Cn)[Cn](i,Ee.COLOR_OPAQUE,i.rendererModel.qualityRender)),F(this,Qs)[Qs]&&r.numTransparent&&(o[M++]=i),r.numXRayed>0&&t.xrayMaterial.fill&&(t.xrayMaterial.fillAlpha<1?c[I++]=i:a[P++]=i),r.numHighlighted>0&&t.highlightMaterial.fill&&(t.highlightMaterial.fillAlpha<1?g[O++]=i:u[S++]=i),r.numSelected>0&&t.selectedMaterial.fill&&(t.selectedMaterial.fillAlpha<1?E[U++]=i:m[A++]=i),F(this,Js)[Js]&&F(this,Ys)[Ys].edgeMaterial.edges&&r.numEdges>0&&(r.numTransparent<r.numMeshes&&(n[w++]=i),r.numTransparent>0&&(h[y++]=i),t.selectedMaterial.edgeAlpha<1?b[j++]=i:v[L++]=i,t.xrayMaterial.edgeAlpha<1?d[R++]=i:l[C++]=i,t.highlightMaterial.edgeAlpha<1?p[B++]=i:f[D++]=i))}_>0&&(i.withSAO=!0);for(let e=0;e<w;e++)F(this,Cn)[Cn](n[e],Ee.EDGES_COLOR_OPAQUE);for(let e=0;e<P;e++)F(this,Cn)[Cn](a[e],Ee.SILHOUETTE_XRAYED);for(let e=0;e<C;e++)F(this,Cn)[Cn](l[e],Ee.EDGES_XRAYED);if(I>0||R>0||M>0||y>0){r.enable(r.CULL_FACE),r.enable(r.BLEND),F(this,Zs)[Zs]?(r.blendEquation(r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)):(r.blendEquation(r.FUNC_ADD),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA)),i.backfaces=!1,F(this,fn)[fn]||r.depthMask(!1);for(let e=0;e<R;e++)F(this,Cn)[Cn](d[e],Ee.EDGES_XRAYED);for(let e=0;e<I;e++)F(this,Cn)[Cn](c[e],Ee.SILHOUETTE_XRAYED);(M>0||y>0)&&r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);for(let e=0;e<y;e++)F(this,Cn)[Cn](h[e],Ee.EDGES_COLOR_TRANSPARENT);for(let e=0;e<M;e++)F(this,Cn)[Cn](o[e],Ee.COLOR_TRANSPARENT);r.disable(r.BLEND),F(this,fn)[fn]||r.depthMask(!0)}if(S>0||D>0){i.lastProgramId=-1,r.clear(r.DEPTH_BUFFER_BIT);for(let e=0;e<D;e++)F(this,Cn)[Cn](f[e],Ee.EDGES_HIGHLIGHTED);for(let e=0;e<S;e++)F(this,Cn)[Cn](u[e],Ee.SILHOUETTE_HIGHLIGHTED)}if(O>0||B>0||S>0){i.lastProgramId=-1,r.clear(r.DEPTH_BUFFER_BIT),r.enable(r.CULL_FACE),r.enable(r.BLEND),F(this,Zs)[Zs]?(r.blendEquation(r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)):r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);for(let e=0;e<B;e++)F(this,Cn)[Cn](p[e],Ee.EDGES_HIGHLIGHTED);for(let e=0;e<O;e++)F(this,Cn)[Cn](g[e],Ee.SILHOUETTE_HIGHLIGHTED);r.disable(r.BLEND)}if(A>0||L>0){i.lastProgramId=-1,r.clear(r.DEPTH_BUFFER_BIT);for(let e=0;e<L;e++)F(this,Cn)[Cn](v[e],Ee.EDGES_SELECTED);for(let e=0;e<A;e++)F(this,Cn)[Cn](m[e],Ee.SILHOUETTE_SELECTED)}if(U>0||j>0){i.lastProgramId=-1,r.clear(r.DEPTH_BUFFER_BIT),r.enable(r.CULL_FACE),r.enable(r.BLEND),F(this,Zs)[Zs]?(r.blendEquation(r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)):r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);for(let e=0;e<j;e++)F(this,Cn)[Cn](b[e],Ee.EDGES_SELECTED);for(let e=0;e<U;e++)F(this,Cn)[Cn](E[e],Ee.SILHOUETTE_SELECTED);r.disable(r.BLEND)}const G=T.MAX_TEXTURE_UNITS;for(let e=0;e<G;e++)r.activeTexture(r.TEXTURE0+e);r.bindTexture(r.TEXTURE_CUBE_MAP,null),r.bindTexture(r.TEXTURE_2D,null);const N=T.MAX_VERTEX_ATTRIBS;for(let e=0;e<N;e++)r.disableVertexAttribArray(e)}function jn(e,t,i=!0){switch(e.renderState.primitive){case E:case v:case m:switch(t){case Ee.COLOR_OPAQUE:if(e.meshCounts.numTransparent===e.meshCounts.numMeshes||e.meshCounts.numXRayed===e.meshCounts.numMeshes)return;i||F(this,mn)[mn].colorTriangles.draw(e);break;case Ee.COLOR_TRANSPARENT:if(0===e.meshCounts.numTransparent)return;i||F(this,mn)[mn].colorTriangles.draw(e)}}}export{In as WebGLRenderer};
//# sourceMappingURL=index.modern.mjs.map
