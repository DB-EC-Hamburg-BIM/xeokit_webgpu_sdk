import{createVec4 as e,createVec3 as t,createMat4 as i,subVec3 as r,lenVec3 as n,identityMat4 as s,transformPoint4 as o,transformPoint3 as a,mulMat4 as h,translationMat4c as u,identityQuat as c,eulerToQuat as l,composeMat4 as d,transformVec4 as f,setMat4Translation as v}from"@xeokit/matrix";import{WEBGL_INFO as p,GLProgram as g,GLDataTexture as m,GLTexture as E,getExtension as T}from"@xeokit/webglutils";import{Component as b,EventEmitter as y}from"@xeokit/core";import{EventDispatcher as w}from"strongly-typed-events";import"@xeokit/scene";import{newFloatArray as x,MAX_DOUBLE as _,MIN_DOUBLE as M}from"@xeokit/math";import{decompressPoint3 as P}from"@xeokit/compression";function O(){O=function(){return e};var e={},t=Object.prototype,i=t.hasOwnProperty,r=Object.defineProperty||function(e,t,i){e[t]=i.value},n="function"==typeof Symbol?Symbol:{},s=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function h(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{h({},"")}catch(e){h=function(e,t,i){return e[t]=i}}function u(e,t,i,n){var s=Object.create((t&&t.prototype instanceof d?t:d).prototype),o=new M(n||[]);return r(s,"_invoke",{value:y(e,i,o)}),s}function c(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var l={};function d(){}function f(){}function v(){}var p={};h(p,s,function(){return this});var g=Object.getPrototypeOf,m=g&&g(g(P([])));m&&m!==t&&i.call(m,s)&&(p=m);var E=v.prototype=d.prototype=Object.create(p);function T(e){["next","throw","return"].forEach(function(t){h(e,t,function(e){return this._invoke(t,e)})})}function b(e,t){function n(r,s,o,a){var h=c(e[r],e,s);if("throw"!==h.type){var u=h.arg,l=u.value;return l&&"object"==typeof l&&i.call(l,"__await")?t.resolve(l.__await).then(function(e){n("next",e,o,a)},function(e){n("throw",e,o,a)}):t.resolve(l).then(function(e){u.value=e,o(u)},function(e){return n("throw",e,o,a)})}a(h.arg)}var s;r(this,"_invoke",{value:function(e,i){function r(){return new t(function(t,r){n(e,i,t,r)})}return s=s?s.then(r,r):r()}})}function y(e,t,i){var r="suspendedStart";return function(n,s){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===n)throw s;return{value:void 0,done:!0}}for(i.method=n,i.arg=s;;){var o=i.delegate;if(o){var a=w(o,i);if(a){if(a===l)continue;return a}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===r)throw r="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r="executing";var h=c(e,t,i);if("normal"===h.type){if(r=i.done?"completed":"suspendedYield",h.arg===l)continue;return{value:h.arg,done:i.done}}"throw"===h.type&&(r="completed",i.method="throw",i.arg=h.arg)}}}function w(e,t){var i=t.method,r=e.iterator[i];if(void 0===r)return t.delegate=null,"throw"===i&&e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method)||"return"!==i&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+i+"' method")),l;var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var s=n.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function _(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function P(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:S}}function S(){return{value:void 0,done:!0}}return f.prototype=v,r(E,"constructor",{value:v,configurable:!0}),r(v,"constructor",{value:f,configurable:!0}),f.displayName=h(v,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,h(e,a,"GeneratorFunction")),e.prototype=Object.create(E),e},e.awrap=function(e){return{__await:e}},T(b.prototype),h(b.prototype,o,function(){return this}),e.AsyncIterator=b,e.async=function(t,i,r,n,s){void 0===s&&(s=Promise);var o=new b(u(t,i,r,n),s);return e.isGeneratorFunction(i)?o:o.next().then(function(e){return e.done?e.value:o.next()})},T(E),h(E,a,"Generator"),h(E,s,function(){return this}),h(E,"toString",function(){return"[object Generator]"}),e.keys=function(e){var t=Object(e),i=[];for(var r in t)i.push(r);return i.reverse(),function e(){for(;i.length;){var r=i.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=P,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(i,r){return o.type="throw",o.arg=e,t.next=i,r&&(t.method="next",t.arg=void 0),!!r}for(var n=this.tryEntries.length-1;n>=0;--n){var s=this.tryEntries[n],o=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var a=i.call(s,"catchLoc"),h=i.call(s,"finallyLoc");if(a&&h){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(a){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var s=n;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=e,o.arg=t,s?(this.method="next",this.next=s.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),_(i),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var r=i.completion;if("throw"===r.type){var n=r.arg;_(i)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:P(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=void 0),l}},e}function S(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,"symbol"==typeof(n=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key))?n:String(n),r)}var n}function C(e,t,i){return t&&S(e.prototype,t),i&&S(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function I(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,R(e,t)}function R(e,t){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},R(e,t)}function D(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function L(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return A(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?A(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var B=0;function j(e){return"__private_"+B+++"_"+e}function U(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var F=0;function k(e){return"__private_"+F+++"_"+e}function G(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var N=/*#__PURE__*/k("items"),H=/*#__PURE__*/k("lastUniqueId"),X=/*#__PURE__*/function(){function e(e,t){Object.defineProperty(this,N,{writable:!0,value:void 0}),Object.defineProperty(this,H,{writable:!0,value:void 0}),G(this,N)[N]=e||[],G(this,H)[H]=(t||0)+1}var t=e.prototype;return t.addItem=function(){var e;if(2===arguments.length){var t=arguments[0];if(e=arguments[1],G(this,N)[N][t])throw"ID clash: '"+t+"'";return G(this,N)[N][t]=e,t}for(e=arguments[0]||{};;){var i=G(this,H)[H]++;if(!G(this,N)[N][i])return G(this,N)[N][i]=e,i}},t.removeItem=function(e){var t=G(this,N)[N][e];return delete G(this,N)[N][e],t},e}();[["0",10],["A",26],["a",26],["_",1],["$",1]].map(function(e){for(var t=[],i=e[0].charCodeAt(0),r=i+e[1],n=i;n<r;++n)t.push(n);return String.fromCharCode.apply(null,t)}).join("");var V=function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&i]+e[i>>8&255]+"-"+e[i>>16&15|64]+e[i>>24&255]+"-"+e[63&r|128]+e[r>>8&255]+"-"+e[r>>16&255]+e[r>>24&255]+e[255&n]+e[n>>8&255]+e[n>>16&255]+e[n>>24&255]}}(),W=2e4,z=20001,q=0;function Y(e){return"__private_"+q+++"_"+e}function K(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}function Z(e,t){return Z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Z(e,t)}var Q=/*#__PURE__*/function(){function e(e,t,i){this.isLoading=void 0,this.itemsLoaded=void 0,this.itemsTotal=void 0,this.urlModifier=void 0,this.handlers=void 0,this.onStart=void 0,this.onLoad=void 0,this.onProgress=void 0,this.onError=void 0,this.isLoading=!1,this.itemsLoaded=0,this.itemsTotal=0,this.urlModifier=void 0,this.handlers=[],this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i}var t=e.prototype;return t.itemStart=function(e){this.itemsTotal++,this.isLoading||void 0!==this.onStart&&this.onStart(e,this.itemsLoaded,this.itemsTotal),this.isLoading=!0},t.itemEnd=function(e){this.itemsLoaded++,void 0!==this.onProgress&&this.onProgress(e,this.itemsLoaded,this.itemsTotal),this.itemsLoaded===this.itemsTotal&&(this.isLoading=!1,void 0!==this.onLoad&&this.onLoad())},t.itemError=function(e){void 0!==this.onError&&this.onError(e)},t.resolveURL=function(e){return this.urlModifier?this.urlModifier(e):e},t.setURLModifier=function(e){return this.urlModifier=e,this},t.addHandler=function(e,t){return this.handlers.push(e,t),this},t.removeHandler=function(e){var t=this.handlers.indexOf(e);return-1!==t&&this.handlers.splice(t,2),this},t.getHandler=function(e){for(var t=0,i=this.handlers.length;t<i;t+=2){var r=this.handlers[t],n=this.handlers[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return n}return null},e}(),$=new Q,J=/*#__PURE__*/function(){function e(e){this.manager=void 0,this.crossOrigin=void 0,this.withCredentials=void 0,this.path=void 0,this.resourcePath=void 0,this.requestHeader=void 0,this.manager=void 0!==e?e:$,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}var t=e.prototype;return t.load=function(e,t,i,r){},t.loadAsync=function(e,t){var i=this;return new Promise(function(r,n){i.load(e,r,t,n)})},t.parse=function(){},t.setCrossOrigin=function(e){return this.crossOrigin=e,this},t.setWithCredentials=function(e){return this.withCredentials=e,this},t.setPath=function(e){return this.path=e,this},t.setResourcePath=function(e){return this.resourcePath=e,this},t.setRequestHeader=function(e){return this.requestHeader=e,this},e}(),ee=/*#__PURE__*/function(){function e(e){void 0===e&&(e=4),this.pool=void 0,this.queue=void 0,this.workers=void 0,this.workersResolve=void 0,this.workerStatus=void 0,this.workerCreator=void 0,this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}var t=e.prototype;return t._initWorker=function(e){if(!this.workers[e]){var t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}},t._getIdleWorker=function(){for(var e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1},t._onMessage=function(e,t){var i=this.workersResolve[e];if(i&&i(t),this.queue.length){var r=this.queue.shift(),n=r.msg,s=r.transfer;this.workersResolve[e]=r.resolve,this.workers[e].postMessage(n,s)}else this.workerStatus^=1<<e},t.setWorkerCreator=function(e){this.workerCreator=e},t.setWorkerLimit=function(e){this.pool=e},t.postMessage=function(e,t){var i=this;return new Promise(function(r){var n=i._getIdleWorker();-1!==n?(i._initWorker(n),i.workerStatus|=1<<n,i.workersResolve[n]=r,i.workers[n].postMessage(e,t)):i.queue.push({resolve:r,msg:e,transfer:t})})},t.destroy=function(){this.workers.forEach(function(e){return e.terminate()}),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0},e}(),te={},ie=/*#__PURE__*/function(e){var t,i;function r(t){var i;return(i=e.call(this,t)||this).mimeType=void 0,i.responseType=void 0,i}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,Z(t,i);var n=r.prototype;return n.load=function(e,t,i,r){var n=this;if(void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e),void 0===te[e]){te[e]=[],te[e].push({onLoad:t,onProgress:i,onError:r});var s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,a=this.responseType;fetch(s).then(function(t){if(200===t.status||0===t.status){if(0===t.status&&console.warn("FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body.getReader)return t;var i=te[e],r=t.body.getReader(),n=t.headers.get("Content-Length"),s=n?parseInt(n):0,o=0!==s,a=0,h=new ReadableStream({start:function(e){!function t(){r.read().then(function(r){var n=r.value;if(r.done)e.close();else{for(var h=new ProgressEvent("progress",{lengthComputable:o,loaded:a+=n.byteLength,total:s}),u=0,c=i.length;u<c;u++){var l=i[u];l.onProgress&&l.onProgress(h)}e.enqueue(n),t()}})}()}});return new Response(h)}throw new Error('fetch for "'+t.url+'" responded with '+t.status+": "+t.statusText)}).then(function(e){switch(a){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(function(e){return(new DOMParser).parseFromString(e,o)});case"json":return e.json();default:if(void 0===o)return e.text();var t=/charset="?([^;"\s]*)"?/i.exec(o),i=t&&t[1]?t[1].toLowerCase():void 0,r=new TextDecoder(i);return e.arrayBuffer().then(function(e){return r.decode(e)})}}).then(function(t){var i=te[e];delete te[e];for(var r=0,n=i.length;r<n;r++){var s=i[r];s.onLoad&&s.onLoad(t)}}).catch(function(t){var i=te[e];if(void 0===i)throw n.manager.itemError(e),t;delete te[e];for(var r=0,s=i.length;r<s;r++){var o=i[r];o.onError&&o.onError(t)}n.manager.itemError(e)}).finally(function(){n.manager.itemEnd(e)}),this.manager.itemStart(e)}else te[e].push({onLoad:t,onProgress:i,onError:r})},n.setResponseType=function(e){return this.responseType=e,this},n.setMimeType=function(e){return this.mimeType=e,this},r}(J);[["0",10],["A",26],["a",26],["_",1],["$",1]].map(function(e){for(var t=[],i=e[0].charCodeAt(0),r=i+e[1],n=i;n<r;++n)t.push(n);return String.fromCharCode.apply(null,t)}).join(""),function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16)}();var re=0,ne={ETC1S:0,UASTC_4x4:1},se={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},oe={RGBAFormat:1023,RGBA_ASTC_4x4_Format:37808,RGBA_BPTC_Format:36492,RGBA_ETC2_EAC_Format:37496,RGBA_PVRTC_4BPPV1_Format:35842,RGBA_S3TC_DXT5_Format:33779,RGB_ETC1_Format:36196,RGB_ETC2_Format:37492,RGB_PVRTC_4BPPV1_Format:35840,RGB_S3TC_DXT1_Format:33776},ae=/*#__PURE__*/Y("transcoderPath"),he=/*#__PURE__*/Y("transcoderBinary"),ue=/*#__PURE__*/Y("transcoderPending"),ce=/*#__PURE__*/Y("workerPool"),le=/*#__PURE__*/Y("workerSourceURL"),de=/*#__PURE__*/Y("workerConfig"),fe=/*#__PURE__*/Y("supportedFileTypes"),ve=/*#__PURE__*/Y("withCredentials"),pe=/*#__PURE__*/Y("initTranscoder"),ge=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,pe,{value:me}),Object.defineProperty(this,ae,{writable:!0,value:void 0}),Object.defineProperty(this,he,{writable:!0,value:void 0}),Object.defineProperty(this,ue,{writable:!0,value:void 0}),Object.defineProperty(this,ce,{writable:!0,value:void 0}),Object.defineProperty(this,le,{writable:!0,value:void 0}),Object.defineProperty(this,de,{writable:!0,value:void 0}),Object.defineProperty(this,fe,{writable:!0,value:void 0}),Object.defineProperty(this,ve,{writable:!0,value:void 0}),K(this,ae)[ae]=e.transcoderPath||"https://cdn.jsdelivr.net/npm/@xeokit/sdk/dist/basis/",K(this,he)[he]=null,K(this,ue)[ue]=null,K(this,ce)[ce]=new ee,K(this,le)[le]="",e.workerLimit&&K(this,ce)[ce].setWorkerLimit(e.workerLimit),K(this,de)[de]=null,K(this,ve)[ve]=!1,K(this,fe)[fe]=["xkt2"]}var t=e.prototype;return t.init=function(e){K(this,de)[de]={astcSupported:e.astcSupported,etc1Supported:e.etc1Supported,etc2Supported:e.etc2Supported,dxtSupported:e.dxtSupported,bptcSupported:e.bptcSupported,pvrtcSupported:e.pvrtcSupported}},t.transcode=function(e,t){var i=this;return void 0===t&&(t={}),new Promise(function(r,n){var s=t;K(i,pe)[pe]().then(function(){return K(i,ce)[ce].postMessage({type:"transcode",buffers:e,taskConfig:s},e)}).then(function(e){var t=e.data,i=t.mipmaps,s=t.format,o=t.dfdTransferFn,a=t.dfdFlags;if("error"===t.type)return n(t.error);r({mipmaps:i,props:{format:s,minFilter:1===i.length?1006:1008,magFilter:1===i.length?1006:1008,encoding:2===o?3001:3e3,premultiplyAlpha:!!(1&a)}})})})},t.destroy=function(){URL.revokeObjectURL(K(this,le)[le]),K(this,ce)[ce].destroy(),re--},e}();function me(){var e=this;if(!K(this,ue)[ue]){var t=new ie;t.setPath(K(this,ae)[ae]),t.setWithCredentials(K(this,ve)[ve]);var i=t.loadAsync("basis_transcoder.js"),r=new ie;r.setPath(K(this,ae)[ae]),r.setResponseType("arraybuffer"),r.setWithCredentials(K(this,ve)[ve]);var n=r.loadAsync("basis_transcoder.wasm");K(this,ue)[ue]=Promise.all([i,n]).then(function(t){var i=t[0],r=t[1],n=Ee.toString(),s=["/* constants */","let _EngineFormat = "+JSON.stringify(oe),"let _TranscoderFormat = "+JSON.stringify(se),"let _BasisFormat = "+JSON.stringify(ne),"/* basis_transcoder.js */",i,"/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");K(e,le)[le]=URL.createObjectURL(new Blob([s])),K(e,he)[he]=r,K(e,ce)[ce].setWorkerCreator(function(){var t=new Worker(K(e,le)[le]),i=K(e,he)[he].slice(0);return t.postMessage({type:"init",config:K(e,de)[de],transcoderBinary:i},[i]),t})}),re>0&&console.warn("KTX2TextureTranscoder: Multiple active KTX2TextureTranscoder may cause performance issues. Use a single KTX2TextureTranscoder instance, or call .dispose() on old instances."),re++}return K(this,ue)[ue]}var Ee=function(){var e,t,i,r=_EngineFormat,n=_TranscoderFormat,s=_BasisFormat;self.addEventListener("message",function(o){var c,l=o.data;switch(l.type){case"init":e=l.config,c=l.transcoderBinary,t=new Promise(function(e){i={wasmBinary:c,onRuntimeInitialized:e},BASIS(i)}).then(function(){i.initializeBasis(),void 0===i.KTX2File&&console.warn("KTX2TextureTranscoder: Please update Basis Universal transcoder.")});break;case"transcode":t.then(function(){try{for(var t=function(t){var o=new i.KTX2File(new Uint8Array(t));function c(){o.close(),o.delete()}if(!o.isValid())throw c(),new Error("KTX2TextureTranscoder: Invalid or unsupported .ktx2 file");var l=o.isUASTC()?s.UASTC_4x4:s.ETC1S,d=o.getWidth(),f=o.getHeight(),v=o.getLevels(),p=o.getHasAlpha(),g=o.getDFDTransferFunc(),m=o.getDFDFlags(),E=function(t,i,o,c){for(var l=t===s.ETC1S?a:h,d=0;d<l.length;d++){var f=l[d];if(e[f.if]&&f.basisFormat.includes(t)&&!(c&&f.transcoderFormat.length<2)&&(!f.needsPowerOfTwo||u(i)&&u(o)))return{transcoderFormat:f.transcoderFormat[c?1:0],engineFormat:f.engineFormat[c?1:0]}}return console.warn("KTX2TextureTranscoder: No suitable compressed texture format found. Decoding to RGBA32."),{transcoderFormat:n.RGBA32,engineFormat:r.RGBAFormat}}(l,d,f,p),T=E.transcoderFormat,b=E.engineFormat;if(!d||!f||!v)throw c(),new Error("KTX2TextureTranscoder: Invalid texture");if(!o.startTranscoding())throw c(),new Error("KTX2TextureTranscoder: .startTranscoding failed");for(var y=[],w=0;w<v;w++){var x=o.getImageLevelInfo(w,0,0),_=x.origWidth,M=x.origHeight,P=new Uint8Array(o.getImageTranscodedSizeInBytes(w,0,0,T));if(!o.transcodeImage(P,w,0,0,T,0,-1,-1))throw c(),new Error("KTX2TextureTranscoder: .transcodeImage failed.");y.push({data:P,width:_,height:M})}return c(),{width:d,height:f,hasAlpha:p,mipmaps:y,format:b,dfdTransferFn:g,dfdFlags:m}}(l.buffers[0]),o=t.width,c=t.height,d=t.hasAlpha,f=t.mipmaps,v=t.format,p=t.dfdTransferFn,g=t.dfdFlags,m=[],E=0;E<f.length;++E)m.push(f[E].data.buffer);self.postMessage({type:"transcode",id:l.id,width:o,height:c,hasAlpha:d,mipmaps:f,format:v,dfdTransferFn:p,dfdFlags:g},m)}catch(e){console.error("[BasisWorker]: "+e),self.postMessage({type:"error",id:l.id,error:e.message})}})}});var o=[{if:"astcSupported",basisFormat:[s.UASTC_4x4],transcoderFormat:[n.ASTC_4x4,n.ASTC_4x4],engineFormat:[r.RGBA_ASTC_4x4_Format,r.RGBA_ASTC_4x4_Format],priorityETC1S:Infinity,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[n.BC7_M5,n.BC7_M5],engineFormat:[r.RGBA_BPTC_Format,r.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[n.BC1,n.BC3],engineFormat:[r.RGB_S3TC_DXT1_Format,r.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[n.ETC1,n.ETC2],engineFormat:[r.RGB_ETC2_Format,r.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[n.ETC1],engineFormat:[r.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[n.PVRTC1_4_RGB,n.PVRTC1_4_RGBA],engineFormat:[r.RGB_PVRTC_4BPPV1_Format,r.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],a=o.sort(function(e,t){return e.priorityETC1S-t.priorityETC1S}),h=o.sort(function(e,t){return e.priorityUASTC-t.priorityUASTC});function u(e){return e<=2||0==(e&e-1)&&0!==e}},Te=/*#__PURE__*/function(){function e(e,t,i){this.viewer=void 0,this.view=void 0,this.gl=void 0,this.viewMatrixDataTexture=void 0,this.pbrEnabled=void 0,this.withSAO=void 0,this.backfaces=void 0,this.frontface=void 0,this.textureUnit=void 0,this.bindTexture=void 0,this.renderPass=void 0,this.shadowViewMatrix=void 0,this.shadowProjMatrix=void 0,this.pickViewMatrix=void 0,this.pickProjMatrix=void 0,this.pickZNear=void 0,this.pickZFar=void 0,this.pickInvisible=void 0,this.lineWidth=void 0,this.lastProgramId=void 0,this.occlusionTexture=void 0,this.viewer=e,this.view=t,this.gl=i,this.reset()}return e.prototype.reset=function(){this.lastProgramId=-1,this.pbrEnabled=!1,this.withSAO=!1,this.backfaces=!1,this.frontface=!0,this.textureUnit=0,this.shadowViewMatrix=null,this.shadowProjMatrix=null,this.pickViewMatrix=null,this.pickProjMatrix=null,this.pickZNear=.01,this.pickZFar=5e3,this.pickInvisible=!1,this.lineWidth=1,this.occlusionTexture=null},C(e,[{key:"nextTextureUnit",get:function(){var e=this.textureUnit;return this.textureUnit=(this.textureUnit+1)%p.MAX_TEXTURE_UNITS,e}}]),e}();function be(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,"symbol"==typeof(n=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key))?n:String(n),r)}var n}function ye(e,t,i){return t&&be(e.prototype,t),i&&be(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function we(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,xe(e,t)}function xe(e,t){return xe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},xe(e,t)}function _e(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Me=0;function Pe(e){return"__private_"+Me+++"_"+e}function Oe(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var Se=0;function Ce(e){return"__private_"+Se+++"_"+e}function Ie(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var Re,De=/*#__PURE__*/Ce("items"),Ae=/*#__PURE__*/Ce("lastUniqueId"),Le=/*#__PURE__*/function(){function e(e,t){Object.defineProperty(this,De,{writable:!0,value:void 0}),Object.defineProperty(this,Ae,{writable:!0,value:void 0}),Ie(this,De)[De]=e||[],Ie(this,Ae)[Ae]=(t||0)+1}var t=e.prototype;return t.addItem=function(){var e;if(2===arguments.length){var t=arguments[0];if(e=arguments[1],Ie(this,De)[De][t])throw"ID clash: '"+t+"'";return Ie(this,De)[De][t]=e,t}for(e=arguments[0]||{};;){var i=Ie(this,Ae)[Ae]++;if(!Ie(this,De)[De][i])return Ie(this,De)[De][i]=e,i}},t.removeItem=function(e){var t=Ie(this,De)[De][e];return delete Ie(this,De)[De][e],t},e}(),Be=/*#__PURE__*/function(){function e(){this._head=void 0,this._headLength=void 0,this._tail=void 0,this._index=void 0,this._length=void 0,this._head=[],this._headLength=0,this._tail=[],this._index=0,this._length=0}var t,i,r=e.prototype;return r.shift=function(){if(this._index>=this._headLength){var e=this._head;if(e.length=0,this._head=this._tail,this._tail=e,this._index=0,this._headLength=this._head.length,!this._headLength)return}var t=this._head[this._index];return this._index<0?delete this._head[this._index++]:this._head[this._index++]=void 0,this._length--,t},r.push=function(e){return this._length++,this._tail.push(e),this},r.unshift=function(e){return this._head[--this._index]=e,this._length++,this},r.clear=function(){this._head=[],this._headLength=0,this._tail=[],this._index=0,this._length=0},t=e,(i=[{key:"length",get:function(){return this._length}}])&&function(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,"symbol"==typeof(n=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key))?n:String(n),r)}var n}(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function je(e){return new FloatArrayClass(e||4)}function Ue(e){return x(e||16)}[["0",10],["A",26],["a",26],["_",1],["$",1]].map(function(e){for(var t=[],i=e[0].charCodeAt(0),r=i+e[1],n=i;n<r;++n)t.push(n);return String.fromCharCode.apply(null,t)}).join(""),function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16)}(),je(),je(),new FloatArrayClass(2),Ue(),Ue(),x(3),Ue(),x(3),(Re={})[4e5]={abbrev:"m"},Re[400001]={abbrev:"cm"},Re[400002]={abbrev:"mm"},Re[400003]={abbrev:"yd"},Re[400004]={abbrev:"ft"},Re[400005]={abbrev:"in"},Ue(),x(3),x(3),x(3),x(3),x(3),x(3),x(3),Ue(),Ue();var Fe={viewerId:"",time:0,startTime:0,prevTime:0,deltaTime:0},ke=/*#__PURE__*/Pe("viewersRenderInfo"),Ge=/*#__PURE__*/Pe("viewerIDMap"),Ne=/*#__PURE__*/Pe("taskQueue"),He=/*#__PURE__*/Pe("taskBudget"),Xe=/*#__PURE__*/Pe("lastTime"),Ve=/*#__PURE__*/Pe("elapsedTime"),We=/*#__PURE__*/Pe("runTasks"),ze=/*#__PURE__*/Pe("runTasksUntil"),qe=/*#__PURE__*/Pe("fireTickEvents"),Ye=/*#__PURE__*/Pe("renderViewers");function Ke(e){Oe(this,ze)[ze](e+Oe(this,He)[He]),this.getNumTasks(),Oe(this,He)}function Ze(e){void 0===e&&(e=-1);for(var t=(new Date).getTime(),i=0;Oe(this,Ne)[Ne].length>0&&(e<0||t<e);){var r=Oe(this,Ne)[Ne].shift(),n=Oe(this,Ne)[Ne].shift();n?r.call(n):r(),t=(new Date).getTime(),i++}return i}function Qe(e){for(var t in Fe.time=e,Je.viewers)if(this.viewers.hasOwnProperty(t)){var i=this.viewers[t];Fe.viewerId=t,Fe.startTime=i.startTime,Fe.deltaTime=null!=Fe.prevTime?Fe.time-Fe.prevTime:0,i.onTick.dispatch(i,Fe)}Fe.prevTime=e}function $e(){for(var e in this.viewers)if(this.viewers.hasOwnProperty(e)){var t=this.viewers[e],i=Oe(this,ke)[ke][e];i||(i=Oe(this,ke)[ke][e]={}),t.render({})}}var Je=new(/*#__PURE__*/function(){function e(){var e=this;Object.defineProperty(this,Ye,{value:$e}),Object.defineProperty(this,qe,{value:Qe}),Object.defineProperty(this,ze,{value:Ze}),Object.defineProperty(this,We,{value:Ke}),this.viewers=void 0,Object.defineProperty(this,ke,{writable:!0,value:{}}),Object.defineProperty(this,Ge,{writable:!0,value:new Le}),Object.defineProperty(this,Ne,{writable:!0,value:new Be}),Object.defineProperty(this,He,{writable:!0,value:10}),Object.defineProperty(this,Xe,{writable:!0,value:0}),Object.defineProperty(this,Ve,{writable:!0,value:0}),this.viewers={},requestAnimationFrame(function t(){var i=Date.now();Oe(e,Xe)[Xe]>0&&(Oe(e,Ve)[Ve]=i-Oe(e,Xe)[Xe]),Oe(e,We)[We](i),Oe(e,qe)[qe](i),Oe(e,Ye)[Ye](),Oe(e,Xe)[Xe]=i,requestAnimationFrame(t)})}var t=e.prototype;return t.registerViewer=function(e){if(e.id){if(this.viewers[e.id])return void console.error("[ERROR] Viewer "+function(e){return function(e){return!isNaN(parseFloat(e))&&isFinite(e)}(e)?""+e:"'"+e+"'"}(e.id)+" already exists")}else e.id=Oe(this,Ge)[Ge].addItem({});this.viewers[e.id]=e,Oe(this,ke)[ke][e.id]={}},t.deregisterViewer=function(e){this.viewers[e.id]&&(Oe(this,Ge)[Ge].removeItem(e.id),delete this.viewers[e.id],delete Oe(this,ke)[ke][e.id])},t.scheduleTask=function(e,t){Oe(this,Ne)[Ne].push(e),Oe(this,Ne)[Ne].push(t)},t.getNumTasks=function(){return Oe(this,Ne)[Ne].length},e}()),et=/*#__PURE__*/Pe("state"),tt=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(_e(r),et,{writable:!0,value:void 0}),r.view=t,Oe(_e(r),et)[et]={type:"ambient",color:new Float32Array(i.color||[.7,.7,.7]),intensity:null!=i.intensity?i.intensity:1},r.view.registerLight(_e(r)),r}return we(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.view.deregisterLight(this)},ye(t,[{key:"color",get:function(){return Oe(this,et)[et].color},set:function(e){Oe(this,et)[et].color.set(e),this.view.redraw()}},{key:"intensity",get:function(){return Oe(this,et)[et].intensity},set:function(e){Oe(this,et)[et].intensity=void 0!==e?e:1,this.view.redraw()}}]),t}(b),it=/*#__PURE__*/Pe("state"),rt=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(_e(r),it,{writable:!0,value:void 0}),r.view=t,Oe(_e(r),it)[it]={type:"dir",dir:new Float32Array(i.dir||[1,1,1]),color:new Float32Array(i.color||[.7,.7,.8]),intensity:null!=i.intensity?i.intensity:1,space:i.space||"view"},r.view.registerLight(_e(r)),r}return we(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.view.deregisterLight(this),this.view.redraw()},ye(t,[{key:"dir",get:function(){return Oe(this,it)[it].dir},set:function(e){Oe(this,it)[it].dir.set(e),this.view.redraw()}},{key:"color",get:function(){return Oe(this,it)[it].color},set:function(e){Oe(this,it)[it].color.set(e),this.view.redraw()}},{key:"intensity",get:function(){return Oe(this,it)[it].intensity},set:function(e){Oe(this,it)[it].intensity=e,this.view.redraw()}}]),t}(b),nt=/*#__PURE__*/Pe("state"),st=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(_e(r),nt,{writable:!0,value:void 0}),r.view=t,Oe(_e(r),nt)[nt]={type:"point",pos:new Float64Array(i.pos||[1,1,1]),color:new Float32Array(i.color||[.7,.7,.8]),intensity:1,attenuation:new Float32Array([i.constantAttenuation,i.linearAttenuation,i.quadraticAttenuation]),space:i.space||"view"},r.view.registerLight(_e(r)),r}return we(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.view.deregisterLight(this),this.view.redraw()},ye(t,[{key:"pos",get:function(){return Oe(this,nt)[nt].pos},set:function(e){Oe(this,nt)[nt].pos.set(e||[1,1,1]),this.view.redraw()}},{key:"color",get:function(){return Oe(this,nt)[nt].color},set:function(e){Oe(this,nt)[nt].color.set(e||[.7,.7,.8]),this.view.redraw()}},{key:"intensity",get:function(){return Oe(this,nt)[nt].intensity},set:function(e){e!==Oe(this,nt)[nt].intensity&&(Oe(this,nt)[nt].intensity=e,this.view.redraw())}},{key:"constantAttenuation",get:function(){return Oe(this,nt)[nt].attenuation[0]},set:function(e){Oe(this,nt)[nt].attenuation[0]=e,this.view.redraw()}},{key:"linearAttenuation",get:function(){return Oe(this,nt)[nt].attenuation[1]},set:function(e){Oe(this,nt)[nt].attenuation[1]=e,this.view.redraw()}},{key:"quadraticAttenuation",get:function(){return Oe(this,nt)[nt].attenuation[2]},set:function(e){Oe(this,nt)[nt].attenuation[2]=e,this.view.redraw()}}]),t}(b),ot={NOT_RENDERED:0,COLOR_OPAQUE:1,COLOR_TRANSPARENT:2,SILHOUETTE_HIGHLIGHTED:3,SILHOUETTE_SELECTED:4,SILHOUETTE_XRAYED:5,EDGES_COLOR_OPAQUE:6,EDGES_COLOR_TRANSPARENT:7,EDGES_HIGHLIGHTED:8,EDGES_SELECTED:9,EDGES_XRAYED:10,PICK:11},at=e(),ht=/*#__PURE__*/j("hash"),ut=/*#__PURE__*/j("program"),ct=/*#__PURE__*/j("needRebuild"),lt=/*#__PURE__*/j("uniforms"),dt=/*#__PURE__*/j("samplers"),ft=/*#__PURE__*/j("build"),vt=/*#__PURE__*/j("buildShader"),pt=/*#__PURE__*/j("getValid"),gt=/*#__PURE__*/j("bind"),mt=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,gt,{value:yt}),Object.defineProperty(this,pt,{value:bt}),Object.defineProperty(this,vt,{value:Tt}),Object.defineProperty(this,ft,{value:Et}),this.errors=void 0,this.renderContext=void 0,Object.defineProperty(this,ht,{writable:!0,value:void 0}),Object.defineProperty(this,ut,{writable:!0,value:void 0}),Object.defineProperty(this,ct,{writable:!0,value:void 0}),Object.defineProperty(this,lt,{writable:!0,value:void 0}),Object.defineProperty(this,dt,{writable:!0,value:void 0}),this.renderContext=e,U(this,ct)[ct]=!0,U(this,ft)[ft]()}var t=e.prototype;return t.needRebuild=function(){U(this,ct)[ct]=!0},t.draw=function(e){if(U(this,ut)[ut]&&!U(this,pt)[pt]()&&(U(this,ut)[ut].destroy(),U(this,ut)[ut]=null),!U(this,ut)[ut]){if(U(this,ft)[ft](),this.errors)return;this.renderContext.lastProgramId=-1}var t=e.renderState,i=U(this,ut)[ut],r=this.renderContext,n=r.renderPass,s=this.renderContext.gl,o=this.renderContext.view,a=U(this,lt)[lt],h=U(this,dt)[dt];if(r.lastProgramId!==i.id&&(r.lastProgramId=i.id,U(this,gt)[gt]()),a.renderPass&&s.uniform1i(a.renderPass,n),a.projMatrix&&s.uniformMatrix4fv(a.projMatrix,!1,o.camera.projMatrix),a.worldMatrix&&s.uniformMatrix4fv(a.worldMatrix,!1,e.rendererModel.worldMatrix),a.color)if(n===ot.SILHOUETTE_XRAYED){var u=o.xrayMaterial,c=u.fillColor;s.uniform4f(a.color,c[0],c[1],c[2],u.fillAlpha)}else if(n===ot.SILHOUETTE_HIGHLIGHTED){var l=o.highlightMaterial,d=l.fillColor;s.uniform4f(a.color,d[0],d[1],d[2],l.fillAlpha)}else if(n===ot.SILHOUETTE_SELECTED){var f=o.selectedMaterial,v=f.fillColor;s.uniform4f(a.color,v[0],v[1],v[2],f.fillAlpha)}else s.uniform4fv(a.color,new Float32Array([1,1,1]));h.viewMatrices&&t.dataTextureSet.viewMatrices.bindTexture(i,h.viewMatrices,r.nextTextureUnit),h.positions&&t.dataTextureSet.positions.bindTexture(i,h.positions,r.nextTextureUnit),h.eachMeshMatrices&&t.dataTextureSet.eachMeshMatrices.bindTexture(i,h.eachMeshMatrices,r.nextTextureUnit),h.eachMeshAttributes&&t.dataTextureSet.eachMeshAttributes.bindTexture(i,h.eachMeshAttributes,r.nextTextureUnit),h.eachPrimitiveMesh&&(t.numIndices8Bits>0&&(t.dataTextureSet.eachPrimitiveMesh_8Bits.bindTexture(i,h.eachPrimitiveMesh,r.nextTextureUnit),t.dataTextureSet.indices_8Bits.bindTexture(i,h.indices,r.nextTextureUnit),s.drawArrays(s.TRIANGLES,0,t.numIndices8Bits)),t.numIndices16Bits>0&&(t.dataTextureSet.eachPrimitiveMesh_16Bits.bindTexture(i,h.eachPrimitiveMesh,r.nextTextureUnit),t.dataTextureSet.indices_16Bits.bindTexture(i,h.indices,r.nextTextureUnit),s.drawArrays(s.TRIANGLES,0,t.numIndices16Bits)),t.numIndices32Bits>0&&(t.dataTextureSet.eachPrimitiveMesh_32Bits.bindTexture(i,h.eachPrimitiveMesh,r.nextTextureUnit),t.dataTextureSet.indices_32Bits.bindTexture(i,h.indices,r.nextTextureUnit),s.drawArrays(s.TRIANGLES,0,t.numIndices32Bits))),h.baseColorMap&&h.baseColorMap.bindTexture(t.materialTextureSet.colorTexture.texture2D,r.nextTextureUnit),h.metallicRoughMap&&h.metallicRoughMap.bindTexture(t.materialTextureSet.metallicRoughnessTexture.texture2D,r.nextTextureUnit),h.emissiveMap&&h.emissiveMap.bindTexture(t.materialTextureSet.emissiveTexture.texture2D,r.nextTextureUnit),h.occlusionMap&&h.occlusionMap.bindTexture(t.materialTextureSet.occlusionTexture.texture2D,r.nextTextureUnit)},t.destroy=function(){U(this,ut)[ut]&&U(this,ut)[ut].destroy(),U(this,ut)[ut]=null},C(e,[{key:"vertHeader",get:function(){return"#version 300 es\n                #ifdef GL_FRAGMENT_PRECISION_HIGH\n                precision highp float;\n                precision highp int;\n                precision highp usampler2D;\n                precision highp isampler2D;\n                precision highp sampler2D;\n                #else\n                precision mediump float;\n                precision mediump int;\n                precision mediump usampler2D;\n                precision mediump isampler2D;\n                precision mediump sampler2D;\n                uniform int renderPass;\n                #endif"}},{key:"vertDataTextureDefs",get:function(){return"uniform mediump sampler2D eachMeshMatrices;\n                uniform lowp usampler2D eachMeshAttributes;\n                uniform highp sampler2D eachMeshOffset;\n                uniform mediump usampler2D positions;\n                uniform highp usampler2D indices;\n                uniform mediump usampler2D eachPrimitiveMesh;\n                uniform highp sampler2D cameraMatrices;\n                uniform highp sampler2D sceneModelRendererMatrices;"}},{key:"vertLogDepthBufDefs",get:function(){return this.renderContext.view.logarithmicDepthBufferEnabled?"uniform float logDepthBufFC;\n                    out float fragDepth;\n                    bool isPerspectiveMatrix(mat4 m) {\n                        return (m[2][3] == - 1.0);\n                    }\n                    out float isPerspective;":""}},{key:"vertDataTextureSamples",get:function(){return""}},{key:"vertLogDepthBufOutputs",get:function(){return this.renderContext.view.logarithmicDepthBufferEnabled?"fragDepth = 1.0 + clipPos.w;\n                    isPerspective = float (isPerspectiveMatrix(projMatrix));":""}},{key:"fragmentShader",get:function(){return this.fragHeader+"\n        "+this.fragGammaDefs+"\n        "+this.fragSectionPlaneDefs+"\n        "+this.fragLightDefs+"\n        "+this.fragLogDepthBufDefs+"\n        void main(void) {\n            "+this.fragSectionPlanesSlice+"\n            "+this.fragLighting+"\n            "+this.fragLogDepthBufOutput+"\n        }"}},{key:"fragHeader",get:function(){return"#version 300 es\n        #ifdef GL_FRAGMENT_PRECISION_HIGH\n       precision highp float;\n        precision highp int;\n        #else\n        precision mediump float;\n        precision mediump int;\n        #endif"}},{key:"fragGammaDefs",get:function(){return'uniform float gammaFactor;\n        vec4 linearToLinear( in vec4 value ) {\n            return value;\n        }\n        vec4 sRGBToLinear( in vec4 value ) {\n            return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n        }\n        vec4 gammaToLinear( in vec4 value) {\n            return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n        }\n        vec4 linearToGamma( in vec4 value, in float gammaFactor ) {\n              return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );");\n        }'}},{key:"fragLightDefs",get:function(){var e=this.renderContext.view,t=[];t.push("uniform vec4 lightAmbient;");for(var i=0,r=e.lightsList.length;i<r;i++){var n=e.lightsList[i];"ambient"!==n.type&&(t.push("uniform vec4 lightColor"+i+";"),"dir"===n.type&&t.push("uniform vec3 lightDir"+i+";"),"point"===n.type&&t.push("uniform vec3 lightPos"+i+";"),"spot"===n.type&&(t.push("uniform vec3 lightPos"+i+";"),t.push("uniform vec3 lightDir"+i+";")))}return t.join("\n")}},{key:"fragLogDepthBufDefs",get:function(){return this.renderContext.view.logarithmicDepthBufferEnabled?"in float isPerspective;\n                    uniform float logDepthBufFC;\n                    in float fragDepth;":""}},{key:"fragLogDepthBufOutput",get:function(){return this.renderContext.view.logarithmicDepthBufferEnabled?"gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( fragDepth ) * logDepthBufFC * 0.5;":""}},{key:"fragLighting",get:function(){var e=[];e.push("vec4 viewPosition  = viewMatrix * worldPosition; "),e.push("vec4 modelNormal = vec4(octDecode(normal.xy), 0.0); "),e.push("vec4 worldNormal = worldNormalMatrix * vec4(dot(modelNormal, modelNormalMatrixCol0), dot(modelNormal, modelNormalMatrixCol1), dot(modelNormal, modelNormalMatrixCol2), 0.0);"),e.push("vec3 viewNormal = normalize(vec4(viewNormalMatrix * worldNormal).xyz);"),e.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),e.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),e.push("float lambertian = 1.0;");for(var t=0,i=this.renderContext.view.lightsList.length;t<i;t++){var r=this.renderContext.view.lightsList[t];if("ambient"!==r.type){if("dir"===r.type)e.push("view"===r.space?"viewLightDir = normalize(lightDir"+t+");":"viewLightDir = normalize((viewMatrix * vec4(lightDir"+t+", 0.0)).xyz);");else if("point"===r.type)e.push("view"===r.space?"viewLightDir = -normalize(lightPos"+t+" - viewPosition.xyz);":"viewLightDir = -normalize((viewMatrix * vec4(lightPos"+t+", 0.0)).xyz);");else{if("spot"!==r.type)continue;e.push("view"===r.space?"viewLightDir = normalize(lightDir"+t+");":"viewLightDir = normalize((viewMatrix * vec4(lightDir"+t+", 0.0)).xyz);")}e.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),e.push("reflectedColor += lambertian * (lightColor"+t+".rgb * lightColor"+t+".a);")}}return e.push("vec3 rgb = (vec3(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0));"),e.push("meshColor =  vec4((lightAmbient.rgb * lightAmbient.a * rgb) + (reflectedColor * rgb), float(color.a) / 255.0);"),e.join("\n")}},{key:"fragSAOOutput",get:function(){return this.renderContext.view.sao.enabled?"float viewportWidth     = uSAOParams[0];\n                    float viewportHeight    = uSAOParams[1];\n                    float blendCutoff       = uSAOParams[2];\n                    float blendFactor       = uSAOParams[3];\n                    vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);\n                    float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture(uOcclusionTexture, uv))) * blendFactor;\n                    outColor                = vec4(fragColor.rgb * ambient, 1.0);":"outColor            = fragColor;"}},{key:"fragOutput",get:function(){return"outColor            = fragColor;"}},{key:"fragSectionPlaneDefs",get:function(){var e=[];e.push("in vec4 worldPosition;\n                  in vec4 meshFlags2;");for(var t=0,i=this.renderContext.view.sectionPlanesList.length;t<i;t++)e.push("uniform bool sectionPlaneActive"+t+";\n                      uniform vec3 sectionPlanePos"+t+";\n                      uniform vec3 sectionPlaneDir"+t+";");return e.join("\n")}},{key:"fragLightSourceUniforms",get:function(){var e=[];e.push("uniform vec4 lightAmbient;");for(var t=0,i=this.renderContext.view.lightsList.length;t<i;t++){var r=this.renderContext.view.lightsList[t];r instanceof tt||(e.push("uniform vec4 lightColor"+t+";"),r instanceof rt&&e.push("uniform vec3 lightDir"+t+";"),r instanceof st&&e.push("uniform vec3 lightPos"+t+";"))}return e.join("\n")}},{key:"fragSectionPlanesSlice",get:function(){var e=[];if(this.renderContext.view.sectionPlanesList.length>0){e.push("bool clippable = (float(meshFlags2.x) > 0.0);\n                      if (clippable) {\n                          float dist = 0.0;");for(var t=0,i=this.renderContext.view.sectionPlanesList.length;t<i;t++)e.push("if (sectionPlaneActive"+t+") {\n                              dist += clamp(dot(-sectionPlaneDir"+t+".xyz, worldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);\n                          }");e.push("if (dist > 0.0) { \n                          discard;\n                      }\n                  }")}return e.join("\n")}},{key:"fragFlatShading",get:function(){var e=[];return e.push(""),e.join("\n")}}]),e}();function Et(){var e=this.renderContext.view,t=this.renderContext.gl;if(U(this,ut)[ut]=new g(t,U(this,vt)[vt]()),U(this,ut)[ut].errors)this.errors=U(this,ut)[ut].errors;else{var i=U(this,ut)[ut];U(this,lt)[lt]={renderPass:i.getLocation("renderPass"),viewMatrix:i.getLocation("viewMatrix"),projMatrix:i.getLocation("projMatrix"),worldMatrix:i.getLocation("worldMatrix"),sao:i.getLocation("sao"),logDepthBufFC:i.getLocation("logDepthBufFC"),gammaFactor:i.getLocation("gammaFactor"),pointSize:i.getLocation("pointSize"),nearPlaneHeight:i.getLocation("nearPlaneHeight"),pointCloudIntensityRange:i.getLocation("pointCloudIntensityRange"),pickZNear:i.getLocation("pickZNear"),pickZFar:i.getLocation("pickZFar"),pickInvisible:i.getLocation("pickInvisible"),color:i.getLocation("color"),lightAmbient:i.getLocation("lightAmbient"),lights:[],sectionPlanes:[]};for(var r=U(this,lt)[lt],n=e.lightsList,s=0,o=n.length;s<o;s++)switch(n[s].type){case"dir":r.lights.push({color:i.getLocation("lightColor"+s),dir:i.getLocation("lightDir"+s)});break;case"point":r.lights.push({color:i.getLocation("lightColor"+s),pos:i.getLocation("lightPos"+s),attenuation:i.getLocation("lightAttenuation"+s)});break;case"spot":r.lights.push({color:i.getLocation("lightColor"+s),pos:i.getLocation("lightPos"+s),dir:i.getLocation("lightDir"+s),attenuation:i.getLocation("lightAttenuation"+s)})}for(var a=0,h=e.sectionPlanesList.length;a<h;a++)r.sectionPlanes.push({active:i.getLocation("sectionPlaneActive"+a),pos:i.getLocation("sectionPlanePos"+a),dir:i.getLocation("sectionPlaneDir"+a)});U(this,dt)[dt]={viewMatrices:i.getSampler("viewMatrices"),positions:i.getSampler("positions"),indices:i.getSampler("indices"),edgeIndices:i.getSampler("edgeIndices"),eachMeshAttributes:i.getSampler("eachMeshAttributes"),eachMeshMatrices:i.getSampler("eachMeshMatrices"),eachEdgeOffset:i.getSampler("eachMeshOffset"),eachPrimitiveMesh:i.getSampler("eachMeshTriangleMesh"),eachEdgeMesh:i.getSampler("eachEdgeMesh"),baseColorMap:i.getSampler("baseColorMap"),metallicRoughMap:i.getSampler("metallicRoughMap"),emissiveMap:i.getSampler("emissiveMap"),normalMap:i.getSampler("normalMap"),occlusionMap:i.getSampler("occlusionMap")},U(this,ht)[ht]=this.getHash()}}function Tt(){return{vertex:this.buildVertexShader(),fragment:this.buildFragmentShader()}}function bt(){return!U(this,ct)[ct]||(U(this,ct)[ct]=!1,U(this,ht)[ht]===this.getHash())}function yt(){var e=this.renderContext.view,t=this.renderContext.gl,i=U(this,lt)[lt],r=e.camera.project;U(this,ut)[ut].bind(),i.lightAmbient&&t.uniform4fv(i.lightAmbient,e.getAmbientColorAndIntensity());for(var n=0,s=i.lights.length;n<s;n++){var o=i.lights[n],a=e.lightsList[n];o.color&&t.uniform4f(o.color,a.color[0],a.color[1],a.color[2],a.intensity),o.dir&&t.uniform3f(o.dir,a.dir[0],a.dir[1],a.dir[2]),o.pos&&t.uniform3f(o.pos,a.pos[0],a.pos[1],a.pos[2]),o.attenuation&&t.uniform1f(o.attenuation,a.attenuation)}if(i.sao){var h=e.sao;if(h.possible){var u=t.drawingBufferHeight;at[0]=t.drawingBufferWidth,at[1]=u,at[2]=h.blendCutoff,at[3]=h.blendFactor,t.uniform4fv(i.sao,at)}}if(i.gammaFactor&&t.uniform1f(i.gammaFactor,e.gammaFactor),i.pointSize&&t.uniform1f(i.pointSize,e.pointsMaterial.pointSize),i.nearPlaneHeight&&t.uniform1f(i.nearPlaneHeight,500001===e.camera.projectionType?1:t.drawingBufferHeight/(2*Math.tan(.5*e.camera.perspectiveProjection.fov*Math.PI/180))),i.pickZNear&&(t.uniform1f(i.pickZNear,this.renderContext.pickZNear),t.uniform1f(i.pickZFar,this.renderContext.pickZFar)),i.pickInvisible&&t.uniform1i(i.pickInvisible,this.renderContext.pickInvisible?1:0),i.logDepthBufFC){var c=2/(Math.log(r.far+1)/Math.LN2);t.uniform1f(i.logDepthBufFC,c)}}var wt=/*#__PURE__*/function(e){function t(t){return e.call(this,t)||this}I(t,e);var i=t.prototype;return i.getHash=function(){return this.renderContext.view.getSectionPlanesHash()+"-"+this.renderContext.view.getLightsHash()},i.buildVertexShader=function(){return this.vertHeader+"   \n        \n                uniform int                 renderPass;   \n            \n                uniform highp   mat4        projMatrix;\n                uniform highp   mat4        worldMatrix;\n                      \n                uniform mediump sampler2D   viewMatrices;\n                           \n                uniform mediump usampler2D  eachPrimitiveMesh;\n                uniform lowp    usampler2D  eachMeshAttributes;\n                \n                uniform mediump sampler2D   eachMeshMatrices;\n                uniform mediump usampler2D  positions;\n                uniform highp   usampler2D  indices;\n                \n                uniform  float  logDepthBufFC;\n                 \n                out vec4        worldPosition;\n                flat out uint   meshFlags2r;                       \n                flat out uvec4  meshColor;\n                out float       fragDepth;\n                \n                bool isPerspectiveMatrix(mat4 m) {\n                    return (m[2][3] == - 1.0);\n                }\n                \n                out float isPerspective;\n                    \n                void main(void) {\n                                   \n                    int triangleIndex      = gl_VertexID / 3;\n                    \n                    int hPackedMeshIdIndex = (triangleIndex >> 3) & 1023;\n                    int vPackedMeshIdIndex = (triangleIndex >> 3) >> 10;\n                    \n                    int meshIndex          = int(texelFetch(eachPrimitiveMesh, ivec2(hPackedMeshIdIndex, vPackedMeshIdIndex), 0).r);                   \n                    uvec4 meshFlags        = texelFetch (eachMeshAttributes, ivec2(2, meshIndex), 0);\n\n                    if (int(meshFlags.x) != renderPass) {\n                        gl_Position = vec4(3.0, 3.0, 3.0, 1.0);\n                        return;\n                    } \n                 \n                    uvec4 meshFlags2 = texelFetch (eachMeshAttributes, ivec2(3, meshIndex), 0);\n\n                    ivec4 packedVertexBase = ivec4(texelFetch (eachMeshAttributes, ivec2(4, meshIndex), 0));\n                    ivec4 packedIndexBaseOffset = ivec4(texelFetch (eachMeshAttributes, ivec2(5, meshIndex), 0));\n                    int indexBaseOffset =   (packedIndexBaseOffset.r << 24) + \n                                            (packedIndexBaseOffset.g << 16) + \n                                            (packedIndexBaseOffset.b << 8) + \n                                            (packedIndexBaseOffset.a);\n\n                    int hIndex = (triangleIndex - indexBaseOffset) & 1023;\n                    int vIndex = (triangleIndex - indexBaseOffset) >> 10;\n\n                    ivec3 vertexIndices = ivec3(texelFetch(indices, ivec2(hIndex, vIndex), 0));\n                    ivec3 uniqueVertexIndexes = vertexIndices + (packedVertexBase.r << 24) + (packedVertexBase.g << 16) + (packedVertexBase.b << 8) + packedVertexBase.a;\n\n                    ivec3 indexPositionH = uniqueVertexIndexes & 1023;\n                    ivec3 indexPositionV = uniqueVertexIndexes >> 10;\n\n                    mat4 positionsDecompressMatrix = mat4 (\n                        texelFetch (eachMeshMatrices, ivec2(0, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(1, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(2, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(3, meshIndex), 0));\n                        \n                    mat4 meshMatrix = mat4 (\n                        texelFetch (eachMeshMatrices, ivec2(4, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(5, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(6, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(7, meshIndex), 0));\n\n                    ivec4 packedViewMatrixIndex = ivec4(texelFetch (eachMeshAttributes, ivec2(7, meshIndex), 0));\n                    int viewMatrixIndex = \n                            (packedViewMatrixIndex.r << 24) + \n                            (packedViewMatrixIndex.g << 16) + \n                            (packedViewMatrixIndex.b << 8) + \n                            (packedViewMatrixIndex.a);\n                   \n                    mat4 viewMatrix = mat4 (\n                        texelFetch (viewMatrices, ivec2(4, viewMatrixIndex), 0), \n                        texelFetch (viewMatrices, ivec2(5, viewMatrixIndex), 0), \n                        texelFetch (viewMatrices, ivec2(6, viewMatrixIndex), 0), \n                        texelFetch (viewMatrices, ivec2(7, viewMatrixIndex), 0));\n\n                    vec3 _positions[3];\n                   \n                    _positions[0] = vec3(texelFetch(positions, ivec2(indexPositionH.r, indexPositionV.r), 0));\n                    _positions[1] = vec3(texelFetch(positions, ivec2(indexPositionH.g, indexPositionV.g), 0));\n                    _positions[2] = vec3(texelFetch(positions, ivec2(indexPositionH.b, indexPositionV.b), 0));\n  \n                    vec3  position       = _positions[gl_VertexID % 3];\n                   \n                    vec4  _worldPosition = worldMatrix * ((meshMatrix * positionsDecompressMatrix) * vec4(position, 1.0)); \n                    vec4  viewPosition   = viewMatrix * _worldPosition;                   \n                    vec4  clipPosition   = projMatrix * viewPosition;\n\n                    meshFlags2r     = meshFlags2.r;                     \n                    meshColor       = texelFetch (eachMeshAttributes, ivec2(0, meshIndex), 0);                          \n                    fragDepth       = 1.0 + clipPosition.w;\n                    isPerspective   = float (isPerspectiveMatrix(projMatrix));\n                    worldPosition   = _worldPosition;                                               \n                    \n                    gl_Position     = clipPosition;\n                }"},i.buildFragmentShader=function(){return this.fragHeader+"                        \n    \n             flat   in uvec4    meshColor;\n                in float        fragDepth;\n                in float        isPerspective;    \n                flat in uint    meshFlags2r;        \n                uniform float   logDepthBufFC;                        \n    \n                "+this.fragSectionPlaneDefs+"                  \n                "+this.fragLightSourceUniforms+'                                                             \n    \n                out vec4 outColor;        \n    \n                void main(void) {         \n                \n                // src.push("float lambertian = 1.0;");\n                // \n                //  vec3 xTangent = dFdx( vViewPosition.xyz );\n                //  vec3 yTangent = dFdy( vViewPosition.xyz );\n                // \n                //  vec3 viewNormal = normalize( cross( xTangent, yTangent ) );        \n    \n                    '+this.fragSectionPlanesSlice+"                                    \n                    "+this.fragFlatShading+"     \n          \n                    outColor = vec4(meshColor);                   \n                    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( fragDepth ) * logDepthBufFC * 0.5;                        \n                }"},t}(mt);function xt(e){return new Float64Array(e||6)}function _t(e){return void 0===e&&(e=xt()),e[0]=_,e[1]=_,e[2]=_,e[3]=M,e[4]=M,e[5]=M,e}function Mt(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[3]&&(e[3]=t[3]),e[4]<t[4]&&(e[4]=t[4]),e[5]<t[5]&&(e[5]=t[5]),e}function Pt(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[0]&&(e[3]=t[0]),e[4]<t[1]&&(e[4]=t[1]),e[5]<t[2]&&(e[5]=t[2]),e}t(),t(),i(),x(3),x(3),x(3),x(3),x(3),x(3),x(3);var Ot,St=/*#__PURE__*/j("built"),Ct=/*#__PURE__*/function(){function e(){this.positions=void 0,this.indices_8Bits=void 0,this.indices_16Bits=void 0,this.indices_32Bits=void 0,this.edgeIndices_8Bits=void 0,this.edgeIndices_16Bits=void 0,this.edgeIndices_32Bits=void 0,this.indices=void 0,this.edgeIndices=void 0,this.eachMeshAttributes=void 0,this.eachMeshMatrices=void 0,this.eachEdgeOffset=void 0,this.eachPrimitiveMesh_8Bits=void 0,this.eachPrimitiveMesh_16Bits=void 0,this.eachPrimitiveMesh_32Bits=void 0,this.eachPrimitiveMesh=void 0,this.eachEdgeMesh_8Bits=void 0,this.eachEdgeMesh_16Bits=void 0,this.eachEdgeMesh_32Bits=void 0,this.eachEdgeMesh=void 0,Object.defineProperty(this,St,{writable:!0,value:void 0}),this.positions=null,this.indices_8Bits=null,this.indices_16Bits=null,this.indices_32Bits=null,this.edgeIndices_8Bits=null,this.edgeIndices_16Bits=null,this.edgeIndices_32Bits=null,this.eachMeshAttributes=null,this.eachMeshMatrices=null,this.eachPrimitiveMesh_8Bits=null,this.eachPrimitiveMesh_16Bits=null,this.eachPrimitiveMesh_32Bits=null,this.eachEdgeMesh_8Bits=null,this.eachEdgeMesh_16Bits=null,this.eachEdgeMesh_32Bits=null,this.eachEdgeOffset=null,U(this,St)[St]=!1}var t=e.prototype;return t.build=function(){this.indices={8:this.indices_8Bits,16:this.indices_16Bits,32:this.indices_32Bits},this.eachPrimitiveMesh={8:this.eachPrimitiveMesh_8Bits,16:this.eachPrimitiveMesh_16Bits,32:this.eachPrimitiveMesh_32Bits},this.edgeIndices={8:this.edgeIndices_8Bits,16:this.edgeIndices_16Bits,32:this.edgeIndices_32Bits},this.eachEdgeMesh={8:this.eachEdgeMesh_8Bits,16:this.eachEdgeMesh_16Bits,32:this.eachEdgeMesh_32Bits},U(this,St)[St]=!0},t.destroy=function(){this.positions&&this.positions.destroy(),this.indices_8Bits&&this.indices_8Bits.destroy(),this.indices_16Bits&&this.indices_16Bits.destroy(),this.indices_32Bits&&this.indices_32Bits.destroy(),this.edgeIndices_8Bits&&this.edgeIndices_8Bits.destroy(),this.edgeIndices_16Bits&&this.edgeIndices_16Bits.destroy(),this.edgeIndices_32Bits&&this.edgeIndices_32Bits.destroy(),this.eachMeshMatrices&&this.eachMeshMatrices.destroy(),this.eachMeshAttributes&&this.eachMeshAttributes.destroy(),this.eachEdgeOffset&&this.eachEdgeOffset.destroy(),this.eachPrimitiveMesh_8Bits&&this.eachPrimitiveMesh_8Bits.destroy(),this.eachPrimitiveMesh_16Bits&&this.eachPrimitiveMesh_16Bits.destroy(),this.eachPrimitiveMesh_32Bits&&this.eachPrimitiveMesh_32Bits.destroy(),this.eachEdgeMesh_8Bits&&this.eachEdgeMesh_8Bits.destroy(),this.eachEdgeMesh_16Bits&&this.eachEdgeMesh_16Bits.destroy(),this.eachEdgeMesh_32Bits&&this.eachEdgeMesh_32Bits.destroy()},e}(),It=/*#__PURE__*/function(){function e(){this.numMeshes=void 0,this.numVisible=void 0,this.numTransparent=void 0,this.numEdges=void 0,this.numXRayed=void 0,this.numSelected=void 0,this.numHighlighted=void 0,this.numClippable=void 0,this.numPickable=void 0,this.numCulled=void 0,this.reset()}return e.prototype.reset=function(){this.numMeshes=0,this.numVisible=0,this.numTransparent=0,this.numEdges=0,this.numXRayed=0,this.numSelected=0,this.numHighlighted=0,this.numClippable=0,this.numPickable=0,this.numCulled=0},e}(),Rt={VISIBLE:1,CULLED:4,PICKABLE:8,CLIPPABLE:16,COLLIDABLE:32,CAST_SHADOW:64,RECEIVE_SHADOW:128,XRAYED:256,HIGHLIGHTED:512,SELECTED:1024,EDGES:2048,BACKFACES:4096,TRANSPARENT:8192};function Dt(e){return function(t){return Lt(e,t,[].slice.call(arguments,1))}}function At(e,t){return Dt(Ft(e,t).get)}for(var Lt=Reflect.apply,Bt=Reflect.construct,jt=Reflect.defineProperty,Ut=Reflect.get,Ft=Reflect.getOwnPropertyDescriptor,kt=Reflect.getPrototypeOf,Gt=Reflect.has,Nt=Reflect.ownKeys,Ht=Reflect.set,Xt=Reflect.setPrototypeOf,Vt=Proxy,Wt=Number,zt=Wt.isFinite,qt=Wt.isNaN,Yt=Symbol.iterator,Kt=Symbol.species,Zt=Symbol.toStringTag,Qt=Symbol.for,$t=Object,Jt=$t.create,ei=$t.defineProperty,ti=$t.freeze,ii=$t.is,ri=$t.prototype,ni=Dt(ri.isPrototypeOf),si=$t.hasOwn||Dt(ri.hasOwnProperty),oi=Array,ai=oi.isArray,hi=oi.prototype,ui=Dt(hi.join),ci=Dt(hi.push),li=Dt(hi.toLocaleString),di=hi[Yt],fi=Dt(di),vi=Math.trunc,pi=ArrayBuffer,gi=pi.isView,mi=Dt(pi.prototype.slice),Ei=At(pi.prototype,"byteLength"),Ti="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:null,bi=Ti&&At(Ti.prototype,"byteLength"),yi=kt(Uint8Array),wi=yi.from,xi=yi.prototype,_i=xi[Yt],Mi=Dt(xi.keys),Pi=Dt(xi.values),Oi=Dt(xi.entries),Si=Dt(xi.set),Ci=Dt(xi.reverse),Ii=Dt(xi.fill),Ri=Dt(xi.copyWithin),Di=Dt(xi.sort),Ai=Dt(xi.slice),Li=Dt(xi.subarray),Bi=At(xi,"buffer"),ji=At(xi,"byteOffset"),Ui=At(xi,"length"),Fi=At(xi,Zt),ki=Uint16Array,Gi=function(){return Lt(wi,ki,[].slice.call(arguments))},Ni=Uint32Array,Hi=Float32Array,Xi=kt([][Yt]()),Vi=Dt(Xi.next),Wi=Dt(O().mark(function e(){return O().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})().next),zi=kt(Xi),qi=TypeError,Yi=RangeError,Ki=Set,Zi=Ki.prototype,Qi=Dt(Zi.add),$i=Dt(Zi.has),Ji=WeakMap,er=Ji.prototype,tr=Dt(er.get),ir=Dt(er.has),rr=Dt(er.set),nr=new pi(4),sr=new Hi(nr),or=new Ni(nr),ar=new Ni(512),hr=new Ni(512),ur=0;ur<256;++ur){var cr=ur-127;cr<-27?(ar[ur]=0,ar[256|ur]=32768,hr[ur]=24,hr[256|ur]=24):cr<-14?(ar[ur]=1024>>-cr-14,ar[256|ur]=1024>>-cr-14|32768,hr[ur]=-cr-1,hr[256|ur]=-cr-1):cr<=15?(ar[ur]=cr+15<<10,ar[256|ur]=cr+15<<10|32768,hr[ur]=13,hr[256|ur]=13):cr<128?(ar[ur]=31744,ar[256|ur]=64512,hr[ur]=24,hr[256|ur]=24):(ar[ur]=31744,ar[256|ur]=64512,hr[ur]=13,hr[256|ur]=13)}function lr(e){sr[0]=e;var t=or[0],i=t>>23&511;return ar[i]+((8388607&t)>>hr[i])}var dr=new Ni(2048),fr=new Ni(64),vr=new Ni(64);dr[0]=0;for(var pr=1;pr<1024;++pr){for(var gr=pr<<13,mr=0;0==(8388608&gr);)mr-=8388608,gr<<=1;dr[pr]=(gr&=-8388609)|(mr+=947912704)}for(var Er=1024;Er<2048;++Er)dr[Er]=939524096+(Er-1024<<13);fr[0]=0;for(var Tr=1;Tr<31;++Tr)fr[Tr]=Tr<<23;fr[31]=1199570944,fr[32]=2147483648;for(var br=33;br<63;++br)fr[br]=2147483648+(br-32<<23);fr[63]=3347054592,vr[0]=0;for(var yr=1;yr<64;++yr)vr[yr]=32===yr?0:1024;function wr(e){var t=e>>10;return or[0]=dr[vr[t]+(1023&e)]+fr[t],sr[0]}function xr(e){var t;if(e[Yt]===di)return e;var i=fi(e);return Jt(null,((t={next:{value:function(){return Vi(i)}}})[Yt]={value:function(){return this}},t))}var _r=new Ji,Mr=Jt(zi,(Ot={next:{value:function(){var e=tr(_r,this);return Wi(e)},writable:!0,configurable:!0}},Ot[Zt]={value:"Array Iterator",configurable:!0},Ot));function Pr(e){var t=Jt(Mr);return rr(_r,t,e),t}function Or(e){return null!==e&&"object"==typeof e||"function"==typeof e}function Sr(e){return null!==e&&"object"==typeof e}function Cr(e){return void 0!==Fi(e)}function Ir(e){var t=Fi(e);return"BigInt64Array"===t||"BigUint64Array"===t}function Rr(e){if(null===Ti)return!1;try{return bi(e),!0}catch(e){return!1}}function Dr(e){return!!ai(e)&&(e[Yt]===di||"Array Iterator"===e[Yt]()[Zt])}function Ar(e){if("string"!=typeof e)return!1;var t=Wt(e);return e===t+""&&!!zt(t)&&t===vi(t)}var Lr=Wt.MAX_SAFE_INTEGER;function Br(e){if("bigint"==typeof e)throw qi("Cannot convert a BigInt value to a number");var t=Wt(e);return qt(t)||0===t?0:vi(t)}function jr(e){var t=Br(e);return t<0?0:t<Lr?t:Lr}function Ur(e,t){if(!Or(e))throw qi("This is not an object");var i=e.constructor;if(void 0===i)return t;if(!Or(i))throw qi("The constructor property value is not an object");var r=i[Kt];return null==r?t:r}function Fr(e){if(Rr(e))return!1;try{return mi(e,0,0),!1}catch(e){}return!0}function kr(e,t){var i=qt(e),r=qt(t);if(i&&r)return 0;if(i)return 1;if(r)return-1;if(e<t)return-1;if(e>t)return 1;if(0===e&&0===t){var n=ii(e,0),s=ii(t,0);if(!n&&s)return-1;if(n&&!s)return 1}return 0}var Gr=Qt("__Float16Array__"),Nr=new Ji;function Hr(e){return ir(Nr,e)||!gi(e)&&function(e){if(!Sr(e))return!1;var t=kt(e);if(!Sr(t))return!1;var i=t.constructor;if(void 0===i)return!1;if(!Or(i))throw qi("The constructor property value is not an object");return Gt(i,Gr)}(e)}function Xr(e){if(!Hr(e))throw qi("This is not a Float16Array object")}function Vr(e,t){var i=Hr(e),r=Cr(e);if(!i&&!r)throw qi("Species constructor didn't return TypedArray object");if("number"==typeof t){var n;if(i){var s=Wr(e);n=Ui(s)}else n=Ui(e);if(n<t)throw qi("Derived constructor created TypedArray object which was too small length")}if(Ir(e))throw qi("Cannot mix BigInt and other types, use explicit conversions")}function Wr(e){var t=tr(Nr,e);if(void 0!==t){if(Fr(Bi(t)))throw qi("Attempting to access detached ArrayBuffer");return t}var i=e.buffer;if(Fr(i))throw qi("Attempting to access detached ArrayBuffer");var r=Bt(Jr,[i,e.byteOffset,e.length],e.constructor);return tr(Nr,r)}function zr(e){for(var t=Ui(e),i=[],r=0;r<t;++r)i[r]=wr(e[r]);return i}for(var qr,Yr=new Ki,Kr=L(Nt(xi));!(qr=Kr()).done;){var Zr=qr.value;if(Zr!==Zt){var Qr=Ft(xi,Zr);si(Qr,"get")&&Qi(Yr,Zr)}}var $r=ti({get:function(e,t,i){return Ar(t)&&si(e,t)?wr(Ut(e,t)):$i(Yr,t)&&ni(xi,e)?Ut(e,t):Ut(e,t,i)},set:function(e,t,i,r){return Ar(t)&&si(e,t)?Ht(e,t,lr(i)):Ht(e,t,i,r)},getOwnPropertyDescriptor:function(e,t){if(Ar(t)&&si(e,t)){var i=Ft(e,t);return i.value=wr(i.value),i}return Ft(e,t)},defineProperty:function(e,t,i){return Ar(t)&&si(e,t)&&si(i,"value")?(i.value=lr(i.value),jt(e,t,i)):jt(e,t,i)}}),Jr=/*#__PURE__*/function(){function e(t,i,r){var n;if(Hr(t))n=Bt(ki,[Wr(t)],this instanceof e?this.constructor:void 0);else if(Or(t)&&!function(e){try{return Ei(e),!0}catch(e){return!1}}(t)){var s,o;if(Cr(t)){s=t,o=Ui(t);var a=Bi(t),h=Rr(a)?pi:Ur(a,pi);if(Fr(a))throw qi("Attempting to access detached ArrayBuffer");if(Ir(t))throw qi("Cannot mix BigInt and other types, use explicit conversions");var u=new h(2*o);n=Bt(ki,[u],this instanceof e?this.constructor:void 0)}else{var c=t[Yt];if(null!=c&&"function"!=typeof c)throw qi("@@iterator property is not callable");null!=c?Dr(t)?(s=t,o=t.length):o=(s=[].concat(t)).length:o=jr((s=t).length),n=Bt(ki,[o],this instanceof e?this.constructor:void 0)}for(var l=0;l<o;++l)n[l]=lr(s[l])}else n=Bt(ki,arguments,this instanceof e?this.constructor:void 0);var d=new Vt(n,$r);return rr(Nr,d,n),d}e.from=function(t){var i,r,n=this,s=[].slice.call(arguments,1),o=this;if(!Gt(o,Gr))throw qi("This constructor is not a subclass of Float16Array");if(o===e){if(Hr(t)&&0===s.length){var a=Wr(t),h=new ki(Bi(a),ji(a),Ui(a));return new e(Bi(Ai(h)))}if(0===s.length)return new e(Bi(Gi(t,lr)));var u=s[0];return new e(Bi(Gi(t,function(e){return lr(Lt(u,n,[e].concat(xr([].slice.call(arguments,1)))))},s[1])))}var c,l=t[Yt];if(null!=l&&"function"!=typeof l)throw qi("@@iterator property is not callable");if(null!=l)Dr(t)?(i=t,r=t.length):!Cr(c=t)||c[Yt]!==_i&&"Array Iterator"!==c[Yt]()[Zt]?r=(i=[].concat(t)).length:(i=t,r=Ui(t));else{if(null==t)throw qi("Cannot convert undefined or null to object");r=jr((i=$t(t)).length)}var d=new o(r);if(0===s.length)for(var f=0;f<r;++f)d[f]=i[f];else for(var v=s[0],p=s[1],g=0;g<r;++g)d[g]=Lt(v,p,[i[g],g]);return d},e.of=function(){var t=[].slice.call(arguments),i=this;if(!Gt(i,Gr))throw qi("This constructor is not a subclass of Float16Array");var r=t.length;if(i===e){for(var n=new e(r),s=Wr(n),o=0;o<r;++o)s[o]=lr(t[o]);return n}for(var a=new i(r),h=0;h<r;++h)a[h]=t[h];return a};var t=e.prototype;return t.keys=function(){Xr(this);var e=Wr(this);return Mi(e)},t.values=function(){Xr(this);var e=Wr(this);return Pr(/*#__PURE__*/O().mark(function t(){var i,r,n;return O().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:i=L(Pi(e));case 1:if((r=i()).done){t.next=7;break}return n=r.value,t.next=5,wr(n);case 5:t.next=1;break;case 7:case"end":return t.stop()}},t)})())},t.entries=function(){Xr(this);var e=Wr(this);return Pr(/*#__PURE__*/O().mark(function t(){var i,r,n,s,o;return O().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:i=L(Oi(e));case 1:if((r=i()).done){t.next=7;break}return s=(n=r.value)[0],o=n[1],t.next=5,[s,wr(o)];case 5:t.next=1;break;case 7:case"end":return t.stop()}},t)})())},t.at=function(e){Xr(this);var t=Wr(this),i=Ui(t),r=Br(e),n=r>=0?r:i+r;if(!(n<0||n>=i))return wr(t[n])},t.map=function(t){Xr(this);var i=Wr(this),r=Ui(i),n=[].slice.call(arguments,1)[0],s=Ur(i,e);if(s===e){for(var o=new e(r),a=Wr(o),h=0;h<r;++h){var u=wr(i[h]);a[h]=lr(Lt(t,n,[u,h,this]))}return o}var c=new s(r);Vr(c,r);for(var l=0;l<r;++l){var d=wr(i[l]);c[l]=Lt(t,n,[d,l,this])}return c},t.filter=function(t){Xr(this);for(var i=Wr(this),r=Ui(i),n=[].slice.call(arguments,1)[0],s=[],o=0;o<r;++o){var a=wr(i[o]);Lt(t,n,[a,o,this])&&ci(s,a)}var h=new(Ur(i,e))(s);return Vr(h),h},t.reduce=function(e){var t=[].slice.call(arguments,1);Xr(this);var i,r,n=Wr(this),s=Ui(n);if(0===s&&0===t.length)throw qi("Reduce of empty array with no initial value");0===t.length?(i=wr(n[0]),r=1):(i=t[0],r=0);for(var o=r;o<s;++o)i=e(i,wr(n[o]),o,this);return i},t.reduceRight=function(e){var t=[].slice.call(arguments,1);Xr(this);var i,r,n=Wr(this),s=Ui(n);if(0===s&&0===t.length)throw qi("Reduce of empty array with no initial value");0===t.length?(i=wr(n[s-1]),r=s-2):(i=t[0],r=s-1);for(var o=r;o>=0;--o)i=e(i,wr(n[o]),o,this);return i},t.forEach=function(e){Xr(this);for(var t=Wr(this),i=Ui(t),r=[].slice.call(arguments,1)[0],n=0;n<i;++n)Lt(e,r,[wr(t[n]),n,this])},t.find=function(e){Xr(this);for(var t=Wr(this),i=Ui(t),r=[].slice.call(arguments,1)[0],n=0;n<i;++n){var s=wr(t[n]);if(Lt(e,r,[s,n,this]))return s}},t.findIndex=function(e){Xr(this);for(var t=Wr(this),i=Ui(t),r=[].slice.call(arguments,1)[0],n=0;n<i;++n){var s=wr(t[n]);if(Lt(e,r,[s,n,this]))return n}return-1},t.findLast=function(e){Xr(this);for(var t=Wr(this),i=Ui(t),r=[].slice.call(arguments,1)[0],n=i-1;n>=0;--n){var s=wr(t[n]);if(Lt(e,r,[s,n,this]))return s}},t.findLastIndex=function(e){Xr(this);for(var t=Wr(this),i=Ui(t),r=[].slice.call(arguments,1)[0],n=i-1;n>=0;--n){var s=wr(t[n]);if(Lt(e,r,[s,n,this]))return n}return-1},t.every=function(e){Xr(this);for(var t=Wr(this),i=Ui(t),r=[].slice.call(arguments,1)[0],n=0;n<i;++n)if(!Lt(e,r,[wr(t[n]),n,this]))return!1;return!0},t.some=function(e){Xr(this);for(var t=Wr(this),i=Ui(t),r=[].slice.call(arguments,1)[0],n=0;n<i;++n)if(Lt(e,r,[wr(t[n]),n,this]))return!0;return!1},t.set=function(e){Xr(this);var t=Wr(this),i=Br([].slice.call(arguments,1)[0]);if(i<0)throw Yi("Offset is out of bounds");if(null==e)throw qi("Cannot convert undefined or null to object");if(Ir(e))throw qi("Cannot mix BigInt and other types, use explicit conversions");if(Hr(e))return Si(Wr(this),Wr(e),i);if(Cr(e)&&Fr(Bi(e)))throw qi("Attempting to access detached ArrayBuffer");var r=Ui(t),n=$t(e),s=jr(n.length);if(i===1/0||s+i>r)throw Yi("Offset is out of bounds");for(var o=0;o<s;++o)t[o+i]=lr(n[o])},t.reverse=function(){Xr(this);var e=Wr(this);return Ci(e),this},t.fill=function(e){Xr(this);var t=Wr(this);return Ii.apply(void 0,[t,lr(e)].concat(xr([].slice.call(arguments,1)))),this},t.copyWithin=function(e,t){Xr(this);var i=Wr(this);return Ri.apply(void 0,[i,e,t].concat(xr([].slice.call(arguments,2)))),this},t.sort=function(){var e=[].slice.call(arguments);Xr(this);var t=Wr(this),i=void 0!==e[0]?e[0]:kr;return Di(t,function(e,t){return i(wr(e),wr(t))}),this},t.slice=function(){var t=[].slice.call(arguments);Xr(this);var i=Wr(this),r=Ur(i,e);if(r===e){var n=new ki(Bi(i),ji(i),Ui(i));return new e(Bi(Ai.apply(void 0,[n].concat(xr(t)))))}var s,o,a=Ui(i),h=Br(t[0]),u=void 0===t[1]?a:Br(t[1]),c=(o=u===-1/0?0:u<0?a+u>0?a+u:0:a<u?a:u)-(s=h===-1/0?0:h<0?a+h>0?a+h:0:a<h?a:h)>0?o-s:0,l=new r(c);if(Vr(l,c),0===c)return l;if(Fr(Bi(i)))throw qi("Attempting to access detached ArrayBuffer");for(var d=0;s<o;)l[d]=wr(i[s]),++s,++d;return l},t.subarray=function(){Xr(this);var t=Wr(this),i=Ur(t,e),r=new ki(Bi(t),ji(t),Ui(t)),n=Li.apply(void 0,[r].concat(xr([].slice.call(arguments)))),s=new i(Bi(n),ji(n),Ui(n));return Vr(s),s},t.indexOf=function(e){Xr(this);var t=Wr(this),i=Ui(t),r=Br([].slice.call(arguments,1)[0]);if(r===1/0)return-1;r<0&&(r+=i)<0&&(r=0);for(var n=r;n<i;++n)if(si(t,n)&&wr(t[n])===e)return n;return-1},t.lastIndexOf=function(e){var t=[].slice.call(arguments,1);Xr(this);var i=Wr(this),r=Ui(i),n=t.length>=1?Br(t[0]):r-1;if(n===-1/0)return-1;n>=0?n=n<r-1?n:r-1:n+=r;for(var s=n;s>=0;--s)if(si(i,s)&&wr(i[s])===e)return s;return-1},t.includes=function(e){Xr(this);var t=Wr(this),i=Ui(t),r=Br([].slice.call(arguments,1)[0]);if(r===1/0)return!1;r<0&&(r+=i)<0&&(r=0);for(var n=qt(e),s=r;s<i;++s){var o=wr(t[s]);if(n&&qt(o))return!0;if(o===e)return!0}return!1},t.join=function(){Xr(this);var e=zr(Wr(this));return ui.apply(void 0,[e].concat(xr([].slice.call(arguments))))},t.toLocaleString=function(){Xr(this);var e=zr(Wr(this));return li.apply(void 0,[e].concat(xr([].slice.call(arguments))))},C(e,[{key:Zt,get:function(){if(Hr(this))return"Float16Array"}}]),e}();ei(Jr,"BYTES_PER_ELEMENT",{value:2}),ei(Jr,Gr,{}),Xt(Jr,yi);var en=Jr.prototype;ei(en,"BYTES_PER_ELEMENT",{value:2}),ei(en,Yt,{value:en.values,writable:!0,configurable:!0}),Xt(en,xi);var tn=new m({textureWidth:0,textureHeight:0});function rn(e){e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}var nn=function(){this.positionsDecompressMatrices=void 0,this.positionsCompressed=void 0,this.indices_8Bits=void 0,this.indices_16Bits=void 0,this.indices_32Bits=void 0,this.edgeIndices_8Bits=void 0,this.edgeIndices_16Bits=void 0,this.edgeIndices_32Bits=void 0,this.eachPrimitiveMesh_8Bits=void 0,this.eachPrimitiveMesh_16Bits=void 0,this.eachPrimitiveMesh_32Bits=void 0,this.eachEdgeMesh_8Bits=void 0,this.eachEdgeMesh_16Bits=void 0,this.eachEdgeMesh_32Bits=void 0,this.eachMeshVertexPortionBase=void 0,this.eachMeshVertexPortionOffset=void 0,this.eachMeshEdgeIndicesOffset=void 0,this.eachMeshColor=void 0,this.eachMeshPickColor=void 0,this.eachMeshMatrices=void 0,this.eachMeshNormalMatrix=void 0,this.eachMeshPositionsDecompressMatrix=void 0,this.eachMeshFlags1=void 0,this.eachMeshFlags2=void 0,this.eachEdgeOffset=void 0,this.eachMeshParts=void 0,this.positionsDecompressMatrices=[],this.positionsCompressed=[],this.indices_8Bits=[],this.indices_16Bits=[],this.indices_32Bits=[],this.edgeIndices_8Bits=[],this.edgeIndices_16Bits=[],this.edgeIndices_32Bits=[],this.eachMeshVertexPortionBase=[],this.eachMeshVertexPortionOffset=[],this.eachMeshEdgeIndicesOffset=[],this.eachMeshColor=[],this.eachMeshPickColor=[],this.eachMeshMatrices=[],this.eachMeshNormalMatrix=[],this.eachMeshPositionsDecompressMatrix=[],this.eachMeshFlags1=[],this.eachMeshFlags2=[],this.eachPrimitiveMesh_32Bits=[],this.eachPrimitiveMesh_16Bits=[],this.eachPrimitiveMesh_8Bits=[],this.eachEdgeMesh_32Bits=[],this.eachEdgeMesh_16Bits=[],this.eachEdgeMesh_8Bits=[],this.eachEdgeOffset=[],this.eachMeshParts=[]},sn=8,on=s(),an=e([0,0,0,1]),hn=e([0,0,0,1]);e([0,0,0,1]);var un=new Uint8Array(4),cn=new Float32Array(3),ln=/*#__PURE__*/j("gl"),dn=/*#__PURE__*/j("view"),fn=/*#__PURE__*/j("dataTextureBuffer"),vn=/*#__PURE__*/j("geometryHandles"),pn=/*#__PURE__*/j("meshPartHandles"),gn=/*#__PURE__*/j("numMeshParts"),mn=/*#__PURE__*/j("deferredSetFlagsActive"),En=/*#__PURE__*/j("deferredSetFlagsDirty"),Tn=/*#__PURE__*/j("built"),bn=/*#__PURE__*/j("createGeometryBucket"),yn=/*#__PURE__*/j("createMeshPart"),wn=/*#__PURE__*/j("setMeshFlags"),xn=/*#__PURE__*/j("setMeshFlags2"),_n=/*#__PURE__*/function(){function e(e,t){Object.defineProperty(this,xn,{value:Sn}),Object.defineProperty(this,wn,{value:On}),Object.defineProperty(this,yn,{value:Pn}),Object.defineProperty(this,bn,{value:Mn}),this.rendererModel=void 0,this.layerIndex=void 0,this.meshCounts=void 0,this.renderState=void 0,Object.defineProperty(this,ln,{writable:!0,value:void 0}),Object.defineProperty(this,dn,{writable:!0,value:void 0}),Object.defineProperty(this,fn,{writable:!0,value:void 0}),Object.defineProperty(this,vn,{writable:!0,value:void 0}),Object.defineProperty(this,pn,{writable:!0,value:void 0}),Object.defineProperty(this,gn,{writable:!0,value:void 0}),Object.defineProperty(this,mn,{writable:!0,value:void 0}),Object.defineProperty(this,En,{writable:!0,value:void 0}),Object.defineProperty(this,Tn,{writable:!0,value:void 0}),this.meshCounts=new It,this.layerIndex=e.layerIndex,this.rendererModel=e.rendererModel,this.renderState={primitive:e.primitive,dataTextureSet:new Ct,numIndices8Bits:0,numIndices16Bits:0,numIndices32Bits:0,numEdgeIndices8Bits:0,numEdgeIndices16Bits:0,numEdgeIndices32Bits:0,numVertices:0},U(this,ln)[ln]=e.gl,U(this,dn)[dn]=e.view,U(this,fn)[fn]=new nn,U(this,gn)[gn]=0,U(this,vn)[vn]={},U(this,pn)[pn]=[],U(this,Tn)[Tn]=!1,this.beginDeferredFlags()}var t=e.prototype;return t.canCreateMesh=function(e){if(U(this,Tn)[Tn])throw"Already built";var t=this.renderState,i=e.geometryBuckets.length;if(U(this,gn)[gn]+i>4096)return!1;for(var r=0,n=0,s=0;s<i;s++){var o=e.geometryBuckets[s];r+=o.positionsCompressed.length,o.indices&&(n+=o.indices.length)}return t.numVertices+r/(e.primitive===W?1:e.primitive==z?2:3)<=2097152&&n/3+n<=2097152},t.hasGeometry=function(e){return U(this,vn)[vn][e]},t.createGeometryCompressed=function(e){if(U(this,Tn)[Tn])throw"Already built";for(var t=[],i=0,r=e.geometryBuckets.length;i<r;i++)t.push(U(this,bn)[bn](e.geometryBuckets[i]));U(this,vn)[vn][e.id]={id:e.id,aabb:e.aabb,positionsDecompressMatrix:e.positionsDecompressMatrix,geometryBucketHandles:t}},t.createMesh=function(e){var t=this;if(U(this,Tn)[Tn])throw new Error("Already built");var i=this.meshCounts.numMeshes;if(!e.geometryId)throw new Error("geometryId expected");var r=U(this,vn)[vn][e.geometryId];if(!r)throw new Error("Geometry not found");r.geometryBucketHandles.forEach(function(i){U(t,yn)[yn](e,r,i)});for(var n=_t(),s=function(e,t){return void 0===e&&(e=xt()),void 0===t&&(t=x(32)),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=1,t[4]=e[3],t[5]=e[1],t[6]=e[2],t[7]=1,t[8]=e[3],t[9]=e[4],t[10]=e[2],t[11]=1,t[12]=e[0],t[13]=e[4],t[14]=e[2],t[15]=1,t[16]=e[0],t[17]=e[1],t[18]=e[5],t[19]=1,t[20]=e[3],t[21]=e[1],t[22]=e[5],t[23]=1,t[24]=e[3],t[25]=e[4],t[26]=e[5],t[27]=1,t[28]=e[0],t[29]=e[4],t[30]=e[5],t[31]=1,t}(r.aabb),a=0,h=s.length;a<h;a+=4)an[0]=s[a+0],an[1]=s[a+1],an[2]=s[a+2],e.matrix?(o(e.matrix,an,hn),Pt(n,hn)):Pt(n,hn);return this.meshCounts.numMeshes++,i},t.build=function(){if(U(this,Tn)[Tn])throw new Error("Already built");var e=U(this,ln)[ln],t=U(this,fn)[fn],i=this.renderState.dataTextureSet;i.positions=function(e,t){var i=1024,r=Math.ceil(t.length/3/i);if(0==r)throw"texture height == 0";var n=new Uint16Array(i*r*3);n.fill(0),n.set(t,0);var s=e.createTexture();return e.bindTexture(e.TEXTURE_2D,s),e.texStorage2D(e.TEXTURE_2D,1,e.RGB16UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RGB_INTEGER,e.UNSIGNED_SHORT,n,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new m({gl:e,texture:s,textureWidth:i,textureHeight:r})}(e,t.positionsCompressed),i.indices_8Bits=function(e,t){if(0==t.length)return tn;var i=1024,r=Math.ceil(t.length/3/i);if(0==r)throw"texture height == 0";var n=new Uint8Array(i*r*3);n.fill(0),n.set(t,0);var s=e.createTexture();return s?(e.bindTexture(e.TEXTURE_2D,s),e.texStorage2D(e.TEXTURE_2D,1,e.RGB8UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RGB_INTEGER,e.UNSIGNED_BYTE,n,0),rn(e),e.bindTexture(e.TEXTURE_2D,null),new m({gl:e,texture:s,textureWidth:i,textureHeight:r})):tn}(e,t.indices_8Bits),i.indices_16Bits=function(e,t){if(0==t.length)return tn;var i=1024,r=Math.ceil(t.length/3/i);if(0==r)throw"texture height == 0";var n=new Uint16Array(i*r*3);n.fill(0),n.set(t,0);var s=e.createTexture();return s?(e.bindTexture(e.TEXTURE_2D,s),e.texStorage2D(e.TEXTURE_2D,1,e.RGB16UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RGB_INTEGER,e.UNSIGNED_SHORT,n,0),rn(e),e.bindTexture(e.TEXTURE_2D,null),new m({gl:e,texture:s,textureWidth:i,textureHeight:r})):tn}(e,t.indices_16Bits),i.indices_32Bits=function(e,t){if(0==t.length)return tn;var i=1024,r=Math.ceil(t.length/3/i);if(0==r)throw"texture height == 0";var n=new Uint32Array(i*r*3);n.fill(0),n.set(t,0);var s=e.createTexture();return s?(e.bindTexture(e.TEXTURE_2D,s),e.texStorage2D(e.TEXTURE_2D,1,e.RGB32UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RGB_INTEGER,e.UNSIGNED_INT,n,0),rn(e),e.bindTexture(e.TEXTURE_2D,null),new m({gl:e,texture:s,textureWidth:i,textureHeight:r})):tn}(e,t.indices_32Bits),i.edgeIndices_8Bits=function(e,t){if(0==t.length)return tn;var i=1024,r=Math.ceil(t.length/2/i);if(0==r)throw"texture height == 0";var n=new Uint8Array(i*r*2);n.fill(0),n.set(t,0);var s=e.createTexture();return s?(e.bindTexture(e.TEXTURE_2D,s),e.texStorage2D(e.TEXTURE_2D,1,e.RG8UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RG_INTEGER,e.UNSIGNED_BYTE,n,0),rn(e),e.bindTexture(e.TEXTURE_2D,null),new m({gl:e,texture:s,textureWidth:i,textureHeight:r})):tn}(e,t.edgeIndices_8Bits),i.edgeIndices_16Bits=function(e,t){if(0==t.length)return tn;var i=1024,r=Math.ceil(t.length/2/i);if(0==r)throw"texture height == 0";var n=new Uint16Array(i*r*2);n.fill(0),n.set(t,0);var s=e.createTexture();return s?(e.bindTexture(e.TEXTURE_2D,s),e.texStorage2D(e.TEXTURE_2D,1,e.RG16UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RG_INTEGER,e.UNSIGNED_SHORT,n,0),rn(e),e.bindTexture(e.TEXTURE_2D,null),new m({gl:e,texture:s,textureWidth:i,textureHeight:r})):tn}(e,t.edgeIndices_16Bits),i.edgeIndices_32Bits=function(e,t){if(0==t.length)return tn;var i=1024,r=Math.ceil(t.length/2/i);if(0==r)throw"texture height == 0";var n=new Uint32Array(i*r*2);n.fill(0),n.set(t,0);var s=e.createTexture();return s?(e.bindTexture(e.TEXTURE_2D,s),e.texStorage2D(e.TEXTURE_2D,1,e.RG32UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RG_INTEGER,e.UNSIGNED_INT,n,0),rn(e),e.bindTexture(e.TEXTURE_2D,null),new m({gl:e,texture:s,textureWidth:i,textureHeight:r})):tn}(e,t.edgeIndices_32Bits),i.eachMeshAttributes=function(e,t,i,r,n,s){var o=t.length;if(0==o)throw"texture height == 0";for(var a=new Uint8Array(32*o),h=0;h<o;h++)a.set(t[h],28*h+0),a.set(i[h],28*h+4),a.set([0,0,0,0],28*h+8),a.set([0,0,0,0],28*h+12),a.set([r[h]>>24&255,r[h]>>16&255,r[h]>>8&255,255&r[h]],28*h+16),a.set([n[h]>>24&255,n[h]>>16&255,n[h]>>8&255,255&n[h]],28*h+20),a.set([s[h]>>24&255,s[h]>>16&255,s[h]>>8&255,255&s[h]],28*h+24);var u=e.createTexture();return u?(e.bindTexture(e.TEXTURE_2D,u),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA8UI,8,o),e.texSubImage2D(e.TEXTURE_2D,0,0,0,8,o,e.RGBA_INTEGER,e.UNSIGNED_BYTE,a,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new m({gl:e,texture:u,textureWidth:8,textureHeight:o,textureData:a})):tn}(e,t.eachMeshColor,t.eachMeshPickColor,t.eachMeshVertexPortionBase,t.eachMeshVertexPortionOffset,t.eachMeshEdgeIndicesOffset),i.eachMeshMatrices=function(e,t,i){var r=t.length;if(0==r)throw"texture height == 0";for(var n=new Jr(48*r),s=0;s<t.length;s++)n.set(t[s],48*s),n.set(i[s],48*s+16);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA16F,12,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,12,r,e.RGBA,e.HALF_FLOAT,new Uint16Array(n.buffer),0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new m({gl:e,texture:o,textureWidth:12,textureHeight:r})):tn}(e,t.eachMeshPositionsDecompressMatrix,t.eachMeshMatrices),i.eachEdgeOffset=function(e,t){var i=t.length;if(0==i)throw"texture height == 0";for(var r=new Float32Array(3*i),n=0;n<t.length;n++)r.set(t[n],3*n);var s=e.createTexture();return s?(e.bindTexture(e.TEXTURE_2D,s),e.texStorage2D(e.TEXTURE_2D,1,e.RGB32F,1,i),e.texSubImage2D(e.TEXTURE_2D,0,0,0,1,i,e.RGB,e.FLOAT,r,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new m({gl:e,texture:s,textureWidth:1,textureHeight:i,textureData:r})):tn}(e,t.eachEdgeOffset),i.build(),U(this,fn)[fn]=null,U(this,vn)[vn]={},U(this,pn)[pn]=[],U(this,Tn)[Tn]=!0},t.isEmpty=function(){return 0==this.meshCounts.numMeshes},t.initFlags=function(e,t,i){t&Rt.VISIBLE&&this.meshCounts.numVisible++,t&Rt.HIGHLIGHTED&&this.meshCounts.numHighlighted++,t&Rt.XRAYED&&this.meshCounts.numXRayed++,t&Rt.SELECTED&&this.meshCounts.numSelected++,t&Rt.CLIPPABLE&&this.meshCounts.numClippable++,t&Rt.EDGES&&this.meshCounts.numEdges++,t&Rt.PICKABLE&&this.meshCounts.numPickable++,t&Rt.CULLED&&this.meshCounts.numCulled++,i&&this.meshCounts.numTransparent++,U(this,wn)[wn](e,t,i),U(this,xn)[xn](e,t)},t.beginDeferredFlags=function(){U(this,mn)[mn]=!0},t.commitDeferredFlags=function(){if(U(this,mn)[mn]=!1,U(this,En)[En]){U(this,En)[En]=!1;var e=U(this,ln)[ln],t=this.renderState.dataTextureSet;e.bindTexture(e.TEXTURE_2D,t.eachMeshAttributes.texture),e.texSubImage2D(e.TEXTURE_2D,0,0,0,t.eachMeshAttributes.textureWidth,t.eachMeshAttributes.textureHeight,e.RGBA_INTEGER,e.UNSIGNED_BYTE,t.eachMeshAttributes.textureData),e.bindTexture(e.TEXTURE_2D,t.eachEdgeOffset.texture),e.texSubImage2D(e.TEXTURE_2D,0,0,0,t.eachEdgeOffset.textureWidth,t.eachEdgeOffset.textureHeight,e.RGB,e.FLOAT,t.eachEdgeOffset.textureData)}},t.flushInitFlags=function(){this.commitDeferredFlags()},t.setMeshVisible=function(e,t,i){if(!U(this,Tn)[Tn])throw"Not built";t&Rt.VISIBLE?this.meshCounts.numVisible++:this.meshCounts.numVisible--,U(this,wn)[wn](e,t,i)},t.setMeshHighlighted=function(e,t,i){if(!U(this,Tn)[Tn])throw"Not built";t&Rt.HIGHLIGHTED?this.meshCounts.numHighlighted++:this.meshCounts.numHighlighted--,U(this,wn)[wn](e,t,i)},t.setMeshXRayed=function(e,t,i){if(!U(this,Tn)[Tn])throw"Not built";t&Rt.XRAYED?this.meshCounts.numXRayed++:this.meshCounts.numXRayed--,U(this,wn)[wn](e,t,i)},t.setMeshSelected=function(e,t,i){if(!U(this,Tn)[Tn])throw"Not built";t&Rt.SELECTED?this.meshCounts.numSelected++:this.meshCounts.numSelected--,U(this,wn)[wn](e,t,i)},t.setMeshEdges=function(e,t,i){if(!U(this,Tn)[Tn])throw"Not built";t&Rt.EDGES?this.meshCounts.numEdges++:this.meshCounts.numEdges--,U(this,wn)[wn](e,t,i)},t.setMeshClippable=function(e,t){if(!U(this,Tn)[Tn])throw"Not built";t&Rt.CLIPPABLE?this.meshCounts.numClippable++:this.meshCounts.numClippable--,U(this,xn)[xn](e,t)},t.setMeshCulled=function(e,t,i){if(!U(this,Tn)[Tn])throw"Not built";t&Rt.CULLED?this.meshCounts.numCulled++:this.meshCounts.numCulled--,U(this,wn)[wn](e,t,i)},t.setMeshCollidable=function(e,t){if(!U(this,Tn)[Tn])throw"Not built"},t.setMeshPickable=function(e,t,i){if(!U(this,Tn)[Tn])throw"Not built";t&Rt.PICKABLE?this.meshCounts.numPickable++:this.meshCounts.numPickable--,U(this,wn)[wn](e,t,i)},t.setMeshColor=function(e,t,i){if(!U(this,Tn)[Tn])throw"Not built";var r=this.renderState.dataTextureSet,n=U(this,ln)[ln];un[0]=t[0],un[1]=t[1],un[2]=t[2],un[3]=t[3],r.eachMeshAttributes.textureData.set(un,28*e),U(this,mn)[mn]?U(this,En)[En]=!0:(n.bindTexture(n.TEXTURE_2D,r.eachMeshAttributes.texture),n.texSubImage2D(n.TEXTURE_2D,0,0,e,1,1,n.RGBA_INTEGER,n.UNSIGNED_BYTE,un))},t.setMeshTransparent=function(e,t,i){if(!U(this,Tn)[Tn])throw"Not built";i?(this.meshCounts.numTransparent++,this.meshCounts.numTransparent++):(this.meshCounts.numTransparent--,this.meshCounts.numTransparent--),U(this,wn)[wn](e,t,i)},t.setMeshOffset=function(e,t){if(!U(this,Tn)[Tn])throw"Not built";var i=U(this,ln)[ln];cn[0]=t[0],cn[1]=t[1],cn[2]=t[2],U(this,mn)[mn]?U(this,En)[En]=!0:i.texSubImage2D(i.TEXTURE_2D,0,0,e,1,1,i.RGB,i.FLOAT,cn)},t.setMeshMatrix=function(e,t){if(!U(this,Tn)[Tn])throw"Not built";U(this,ln),U(this,mn)[mn]&&(U(this,En)[En]=!0)},t.setMeshViewMatrixIndex=function(e,t){if(!U(this,Tn)[Tn])throw"Not built";U(this,ln),U(this,mn)[mn]&&(U(this,En)[En]=!0)},t.destroy=function(){this.renderState.dataTextureSet.destroy()},C(e,[{key:"hash",get:function(){return"layer-"+this.renderState.primitive}}]),e}();function Mn(e){var t=this.renderState;if(e.indices){var i=this.renderState.primitive===W?1:this.renderState.primitive===z?2:3,r=Math.ceil(e.indices.length/i/sn)*sn*i,n=new Uint32Array(r);n.fill(0),n.set(e.indices),e.indices=n}if(e.edgeIndices){var s=Math.ceil(e.edgeIndices.length/2/sn)*sn*2,o=new Uint32Array(s);o.fill(0),o.set(e.edgeIndices),e.edgeIndices=o}for(var a,h=U(this,fn)[fn],u=e.positionsCompressed,c=e.indices,l=e.edgeIndices,d=h.positionsCompressed.length/3,f=u.length/3,v=0,p=u.length;v<p;v++)h.positionsCompressed.push(u[v]);var g,m=0;if(c){var E;m=c.length/3,a=(E=f<=256?h.indices_8Bits:f<=65536?h.indices_16Bits:h.indices_32Bits).length/3;for(var T=0,b=c.length;T<b;T++)E.push(c[T])}var y=0;if(l){var w;y=l.length/2,g=(w=f<=256?h.edgeIndices_8Bits:f<=65536?h.edgeIndices_16Bits:h.edgeIndices_32Bits).length/2;for(var x=0,_=l.length;x<_;x++)w.push(l[x])}return t.numVertices+=f,{vertexBase:d,numVertices:f,numTriangles:m,numEdges:y,indicesBase:a,edgeIndicesBase:g}}function Pn(e,t,i){var r,n=U(this,fn)[fn],s=this.renderState,o=e.matrix||on,a=e.color||[255,255,255],h=n.positionsCompressed.length/3;n.eachMeshPositionsDecompressMatrix.push(t.positionsDecompressMatrix),n.eachMeshMatrices.push(o),n.eachMeshColor.push([a[0],a[1],a[2],255]),n.eachMeshPickColor.push(e.pickColor),r=i.numVertices<=256?s.numIndices8Bits:i.numVertices<=65536?s.numIndices16Bits:s.numIndices32Bits,n.eachMeshVertexPortionBase.push(i.vertexBase),n.eachMeshVertexPortionOffset.push(r/3-i.indicesBase),n.eachMeshEdgeIndicesOffset.push((i.numVertices<=256?s.numEdgeIndices8Bits:i.numVertices<=65536?s.numEdgeIndices16Bits:s.numEdgeIndices32Bits)/2-i.edgeIndicesBase);var u=U(this,pn)[pn].length;if(i.numTriangles>0){var c,l=3*i.numTriangles;i.numVertices<=256?(c=n.eachPrimitiveMesh_8Bits,s.numIndices8Bits+=l):i.numVertices<=65536?(c=n.eachPrimitiveMesh_16Bits,s.numIndices16Bits+=l):(c=n.eachPrimitiveMesh_32Bits,s.numIndices32Bits+=l);for(var d=0;d<i.numTriangles;d+=sn)c.push(u)}if(i.numEdges>0){var f,v=2*i.numEdges;i.numVertices<=256?(f=n.eachEdgeMesh_8Bits,s.numEdgeIndices8Bits+=v):i.numVertices<=65536?(f=n.eachEdgeMesh_16Bits,s.numEdgeIndices16Bits+=v):(f=n.eachEdgeMesh_32Bits,s.numEdgeIndices32Bits+=v);for(var p=0;p<i.numEdges;p+=sn)f.push(u)}return n.eachEdgeOffset.push([0,0,0]),U(this,pn)[pn].push({vertsBase:h,numVerts:i.numTriangles}),U(this,gn)[gn]++,u}function On(e,t,i){if(!U(this,Tn)[Tn])throw"Not built";var r,n,s,o=!!(t&Rt.VISIBLE),a=!!(t&Rt.XRAYED),h=!!(t&Rt.HIGHLIGHTED),u=!!(t&Rt.SELECTED),c=!!(t&Rt.CULLED);r=!o||c||a?ot.NOT_RENDERED:i?ot.COLOR_TRANSPARENT:ot.COLOR_OPAQUE,n=!o||c?ot.NOT_RENDERED:u?ot.SILHOUETTE_SELECTED:h?ot.SILHOUETTE_HIGHLIGHTED:a?ot.SILHOUETTE_XRAYED:ot.NOT_RENDERED,s=!o||c?ot.NOT_RENDERED:u?ot.EDGES_SELECTED:h?ot.EDGES_HIGHLIGHTED:a?ot.EDGES_XRAYED:t&Rt.EDGES?i?ot.EDGES_COLOR_TRANSPARENT:ot.EDGES_COLOR_OPAQUE:ot.NOT_RENDERED;var l=o&&!c&&t&Rt.PICKABLE?ot.PICK:ot.NOT_RENDERED,d=this.renderState.dataTextureSet,f=U(this,ln)[ln];if(un[0]=r,un[1]=n,un[2]=s,un[3]=l,U(this,mn)[mn])return d.eachMeshAttributes.textureData.set(un,28*e+8),void(U(this,En)[En]=!0);f.bindTexture(f.TEXTURE_2D,d.eachMeshAttributes.texture),f.texSubImage2D(f.TEXTURE_2D,0,2,e,1,1,f.RGBA_INTEGER,f.UNSIGNED_BYTE,un)}function Sn(e,t){if(!U(this,Tn)[Tn])throw"Not built";var i=t&Rt.CLIPPABLE?255:0,r=this.renderState.dataTextureSet,n=U(this,ln)[ln];if(un[0]=i,un[1]=0,un[2]=1,un[3]=2,U(this,mn)[mn])return r.eachMeshAttributes.textureData.set(un,28*e+12),void(U(this,En)[En]=!0);n.bindTexture(n.TEXTURE_2D,r.eachMeshAttributes.texture),n.texSubImage2D(n.TEXTURE_2D,0,3,e,1,1,n.RGBA_INTEGER,n.UNSIGNED_BYTE,un)}var Cn=function(){},In=/*#__PURE__*/function(){function e(e,t){this.texture=void 0,this.texture2D=void 0,this.texture=e,this.texture2D=t}return e.prototype.destroy=function(){this.texture2D&&this.texture2D.destroy()},e}(),Rn=new Uint16Array([0,0,0]),Dn=/*#__PURE__*/j("flags"),An=/*#__PURE__*/j("aabb"),Ln=/*#__PURE__*/j("offsetAABB"),Bn=/*#__PURE__*/j("offset"),jn=/*#__PURE__*/j("colorizeUpdated"),Un=/*#__PURE__*/j("opacityUpdated"),Fn=/*#__PURE__*/function(){function e(e){this.id=void 0,this.model=void 0,this.sceneObject=void 0,this.layerId=void 0,this.rendererMeshes=void 0,Object.defineProperty(this,Dn,{writable:!0,value:void 0}),Object.defineProperty(this,An,{writable:!0,value:void 0}),Object.defineProperty(this,Ln,{writable:!0,value:void 0}),Object.defineProperty(this,Bn,{writable:!0,value:void 0}),Object.defineProperty(this,jn,{writable:!0,value:void 0}),Object.defineProperty(this,Un,{writable:!0,value:void 0}),this.id=e.id,this.rendererMeshes=e.rendererMeshes||[],U(this,Dn)[Dn]=0,U(this,An)[An]=e.aabb,U(this,Ln)[Ln]=xt(e.aabb),U(this,Bn)[Bn]=t(),U(this,jn)[jn]=!1,U(this,Un)[Un]=!1,this.layerId=e.layerId||null;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setSceneObject(this)}var i=e.prototype;return i.setVisible=function(e,t){if(!!(U(this,Dn)[Dn]&Rt.VISIBLE)!==t){U(this,Dn)[Dn]=t?U(this,Dn)[Dn]|Rt.VISIBLE:U(this,Dn)[Dn]&~Rt.VISIBLE;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setVisible(U(this,Dn)[Dn])}},i.setHighlighted=function(e,t){if(!!(U(this,Dn)[Dn]&Rt.HIGHLIGHTED)!==t){U(this,Dn)[Dn]=t?U(this,Dn)[Dn]|Rt.HIGHLIGHTED:U(this,Dn)[Dn]&~Rt.HIGHLIGHTED;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setHighlighted(U(this,Dn)[Dn])}},i.setXRayed=function(e,t){if(!!(U(this,Dn)[Dn]&Rt.XRAYED)!==t){U(this,Dn)[Dn]=t?U(this,Dn)[Dn]|Rt.XRAYED:U(this,Dn)[Dn]&~Rt.XRAYED;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setXRayed(U(this,Dn)[Dn])}},i.setSelected=function(e,t){if(!!(U(this,Dn)[Dn]&Rt.SELECTED)!==t){U(this,Dn)[Dn]=t?U(this,Dn)[Dn]|Rt.SELECTED:U(this,Dn)[Dn]&~Rt.SELECTED;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setSelected(U(this,Dn)[Dn])}},i.setEdges=function(e,t){if(!!(U(this,Dn)[Dn]&Rt.EDGES)!==t){U(this,Dn)[Dn]=t?U(this,Dn)[Dn]|Rt.EDGES:U(this,Dn)[Dn]&~Rt.EDGES;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setEdges(U(this,Dn)[Dn])}},i.setCulled=function(e,t){if(!!(U(this,Dn)[Dn]&Rt.CULLED)!==t){U(this,Dn)[Dn]=t?U(this,Dn)[Dn]|Rt.CULLED:U(this,Dn)[Dn]&~Rt.CULLED;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setCulled(U(this,Dn)[Dn])}},i.setClippable=function(e,t){if(!!(U(this,Dn)[Dn]&Rt.CLIPPABLE)!==t){U(this,Dn)[Dn]=t?U(this,Dn)[Dn]|Rt.CLIPPABLE:U(this,Dn)[Dn]&~Rt.CLIPPABLE;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setClippable(U(this,Dn)[Dn])}},i.setCollidable=function(e,t){if(!!(U(this,Dn)[Dn]&Rt.COLLIDABLE)!==t){U(this,Dn)[Dn]=t?U(this,Dn)[Dn]|Rt.COLLIDABLE:U(this,Dn)[Dn]&~Rt.COLLIDABLE;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setCollidable(U(this,Dn)[Dn])}},i.setPickable=function(e,t){if(!!(U(this,Dn)[Dn]&Rt.PICKABLE)!==t){U(this,Dn)[Dn]=t?U(this,Dn)[Dn]|Rt.PICKABLE:U(this,Dn)[Dn]&~Rt.PICKABLE;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setPickable(U(this,Dn)[Dn])}},i.setColorize=function(e,t){if(t){Rn[0]=Math.floor(255*t[0]),Rn[1]=Math.floor(255*t[1]),Rn[2]=Math.floor(255*t[2]);for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setColorize(Rn)}else for(var n=0,s=this.rendererMeshes.length;n<s;n++)this.rendererMeshes[n].setColorize(null)},i.setOpacity=function(e,t){if(0!==this.rendererMeshes.length){var i=this.rendererMeshes[0].colorize[3],r=255;if(null!=t){if(t<0?t=0:t>1&&(t=1),i===(r=Math.floor(255*t)))return}else if(i===(r=255))return;for(var n=0,s=this.rendererMeshes.length;n<s;n++)this.rendererMeshes[n].setOpacity(r,U(this,Dn)[Dn])}},i.setOffset=function(e,t){},i.build=function(){for(var e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].build(U(this,Dn)[Dn])},i.finalize2=function(){for(var e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].finalize2()},i.destroy=function(){for(var e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].destroy()},C(e,[{key:"aabb",get:function(){return U(this,Ln)[Ln]}}]),e}(),kn=i(),Gn=i(),Nn=/*#__PURE__*/function(){function e(e){this.id=void 0,this.color=void 0,this.rendererGeometry=void 0,this.rendererTextureSet=void 0,this.matrix=void 0,this.metallic=void 0,this.roughness=void 0,this.opacity=void 0,this.pickId=void 0,this.tileManager=void 0,this.tile=void 0,this.sceneObjectRenderer=void 0,this.aabb=void 0,this.layer=void 0,this.meshIndex=void 0,this.colorize=void 0,this.colorizing=void 0,this.transparent=void 0,this.sceneObjectRenderer=null,this.tileManager=e.tileManager,this.id=e.id,this.pickId=0,this.color=[e.color[0],e.color[1],e.color[2],e.opacity],this.colorize=[e.color[0],e.color[1],e.color[2],e.opacity],this.colorizing=!1,this.transparent=e.opacity<255,this.layer=e.layer,this.matrix=e.matrix,this.metallic=e.metallic,this.roughness=e.roughness,this.opacity=e.opacity,this.aabb=xt(),this.rendererTextureSet=e.rendererTextureSet,this.rendererGeometry=e.rendererGeometry,this.meshIndex=e.meshIndex}var t=e.prototype;return t.delegatePickedEntity=function(){throw new Error("Method not implemented.")},t.setSceneObject=function(e){this.sceneObjectRenderer=e},t.build=function(e){this.layer.initFlags(this.meshIndex,e,this.transparent)},t.finalize2=function(){this.layer.flushInitFlags&&this.layer.flushInitFlags()},t.setVisible=function(e){this.layer.setMeshVisible(this.meshIndex,e,this.transparent)},t.setMatrix=function(e){var t=a(e,[0,0,0]),i=this.tile;this.tile=i?this.tileManager.updateTileCenter(i,t):this.tileManager.getTile(t);var r=!i||i.id!==this.tile.id,n=this.tile.center;this.layer.setMeshMatrix(this.meshIndex,0!==n[0]||0!==n[1]||0!==n[2]?h(e,u(-n[0],-n[1],-n[2],kn),Gn):e),r&&this.layer.setMeshViewMatrixIndex(this.meshIndex,this.tile.index)},t.setMetallic=function(e){},t.setRoughness=function(e){},t.setColor=function(e){this.color[0]=e[0],this.color[1]=e[1],this.color[2]=e[2],this.colorizing||this.layer.setMeshColor(this.meshIndex,this.color)},t.setColorize=function(e){e?(this.colorize[0]=e[0],this.colorize[1]=e[1],this.colorize[2]=e[2],this.layer.setMeshColor(this.meshIndex,this.colorize,!1),this.colorizing=!0):(this.layer.setMeshColor(this.meshIndex,this.color,!1),this.colorizing=!1)},t.setOpacity=function(e,t){var i=e<255,r=this.transparent!==i;this.color[3]=e,this.colorize[3]=e,this.transparent=i,this.layer.setMeshColor(this.meshIndex,this.colorizing?this.colorize:this.color),r&&this.layer.setMeshTransparent(this.meshIndex,t,i)},t.setHighlighted=function(e){this.layer.setMeshHighlighted(this.meshIndex,e,this.transparent)},t.setXRayed=function(e){this.layer.setMeshXRayed(this.meshIndex,e,this.transparent)},t.setSelected=function(e){this.layer.setMeshSelected(this.meshIndex,e,this.transparent)},t.setEdges=function(e){this.layer.setMeshEdges(this.meshIndex,e,this.transparent)},t.setClippable=function(e){this.layer.setMeshClippable(this.meshIndex,e)},t.setCollidable=function(e){this.layer.setMeshCollidable(this.meshIndex,e)},t.setPickable=function(e){this.layer.setMeshPickable(this.meshIndex,e,this.transparent)},t.setCulled=function(e){this.layer.setMeshCulled(this.meshIndex,e,this.transparent)},t.canPickTriangle=function(){return!1},t.drawPickTriangles=function(e,t){},t.pickTriangleSurface=function(e){},t.canPickWorldPos=function(){return!0},t.drawPickNormals=function(e){},t.destroy=function(){this.tile&&this.tileManager&&this.tileManager.putTile(this.tile)},e}(),Hn=function(e){this.id=void 0,this.colorTexture=void 0,this.metallicRoughnessTexture=void 0,this.emissiveTexture=void 0,this.occlusionTexture=void 0,this.id=e.id,this.colorTexture=e.colorTexture,this.metallicRoughnessTexture=e.metallicRoughnessTexture,this.emissiveTexture=e.emissiveTexture,this.occlusionTexture=e.occlusionTexture};t(),i(),t([1,1,1]),t([0,0,0]),t([0,0,0]),c();var Xn="defaultTextureSet",Vn=/*#__PURE__*/j("view"),Wn=/*#__PURE__*/j("webglRenderer"),zn=/*#__PURE__*/j("renderContext"),qn=/*#__PURE__*/j("position"),Yn=/*#__PURE__*/j("rotation"),Kn=/*#__PURE__*/j("quaternion"),Zn=/*#__PURE__*/j("scale"),Qn=/*#__PURE__*/j("worldMatrix"),$n=/*#__PURE__*/j("viewMatrix"),Jn=/*#__PURE__*/j("colorTextureEnabled"),es=/*#__PURE__*/j("backfaces"),ts=/*#__PURE__*/j("layers"),is=/*#__PURE__*/j("numGeometries"),rs=/*#__PURE__*/j("numTriangles"),ns=/*#__PURE__*/j("numLines"),ss=/*#__PURE__*/j("numPoints"),os=/*#__PURE__*/j("numViewerObjects"),as=/*#__PURE__*/j("textureTranscoder"),hs=/*#__PURE__*/j("aabbDirty"),us=/*#__PURE__*/j("edgeThreshold"),cs=/*#__PURE__*/j("currentLayers"),ls=/*#__PURE__*/j("aabb"),ds=/*#__PURE__*/j("viewMatrixDirty"),fs=/*#__PURE__*/j("worldMatrixNonIdentity"),vs=/*#__PURE__*/j("onCameraViewMatrix"),ps=/*#__PURE__*/j("layerId"),gs=/*#__PURE__*/j("addModel"),ms=/*#__PURE__*/j("addTexture"),Es=/*#__PURE__*/j("addGeometry"),Ts=/*#__PURE__*/j("addMesh"),bs=/*#__PURE__*/j("addObject"),ys=/*#__PURE__*/j("removeModel"),ws=/*#__PURE__*/j("createDefaultTextureSetRenderer"),xs=/*#__PURE__*/j("getLayer"),_s=/*#__PURE__*/j("rebuildAABB"),Ms=/*#__PURE__*/function(r){function n(n){var s;s=r.call(this,n.view)||this,Object.defineProperty(D(s),_s,{value:Ls}),Object.defineProperty(D(s),xs,{value:As}),Object.defineProperty(D(s),ws,{value:Ds}),Object.defineProperty(D(s),ys,{value:Rs}),Object.defineProperty(D(s),bs,{value:Is}),Object.defineProperty(D(s),Ts,{value:Cs}),Object.defineProperty(D(s),Es,{value:Ss}),Object.defineProperty(D(s),ms,{value:Os}),Object.defineProperty(D(s),gs,{value:Ps}),s.qualityRender=void 0,s.sceneModel=void 0,s.rendererGeometries=void 0,s.rendererTextures=void 0,s.rendererTextureSets=void 0,s.rendererMeshes=void 0,s.rendererObjects=void 0,s.rendererObjectsList=void 0,s.rendererViewObjects=void 0,s.viewer=void 0,s.layerList=void 0,s.onBuilt=void 0,Object.defineProperty(D(s),Vn,{writable:!0,value:void 0}),Object.defineProperty(D(s),Wn,{writable:!0,value:void 0}),Object.defineProperty(D(s),zn,{writable:!0,value:void 0}),Object.defineProperty(D(s),qn,{writable:!0,value:void 0}),Object.defineProperty(D(s),Yn,{writable:!0,value:void 0}),Object.defineProperty(D(s),Kn,{writable:!0,value:void 0}),Object.defineProperty(D(s),Zn,{writable:!0,value:void 0}),Object.defineProperty(D(s),Qn,{writable:!0,value:void 0}),Object.defineProperty(D(s),$n,{writable:!0,value:void 0}),Object.defineProperty(D(s),Jn,{writable:!0,value:void 0}),Object.defineProperty(D(s),es,{writable:!0,value:void 0}),Object.defineProperty(D(s),ts,{writable:!0,value:void 0}),Object.defineProperty(D(s),is,{writable:!0,value:void 0}),Object.defineProperty(D(s),rs,{writable:!0,value:void 0}),Object.defineProperty(D(s),ns,{writable:!0,value:void 0}),Object.defineProperty(D(s),ss,{writable:!0,value:void 0}),Object.defineProperty(D(s),os,{writable:!0,value:void 0}),Object.defineProperty(D(s),as,{writable:!0,value:void 0}),Object.defineProperty(D(s),hs,{writable:!0,value:void 0}),Object.defineProperty(D(s),us,{writable:!0,value:void 0}),Object.defineProperty(D(s),cs,{writable:!0,value:void 0}),Object.defineProperty(D(s),ls,{writable:!0,value:void 0}),Object.defineProperty(D(s),ds,{writable:!0,value:void 0}),Object.defineProperty(D(s),fs,{writable:!0,value:void 0}),Object.defineProperty(D(s),vs,{writable:!0,value:void 0}),Object.defineProperty(D(s),ps,{writable:!0,value:void 0}),s.id=n.id,s.sceneModel=n.sceneModel,s.viewer=n.view.viewer,U(D(s),Vn)[Vn]=n.view,U(D(s),Wn)[Wn]=n.webglRenderer,U(D(s),zn)[zn]=n.renderContext,U(D(s),as)[as]=n.textureTranscoder,U(D(s),ls)[ls]=_t(),U(D(s),hs)[hs]=!1,U(D(s),ts)[ts]={},s.layerList=[],U(D(s),cs)[cs]={},s.rendererGeometries={},s.rendererTextures={},s.rendererTextureSets={},s.rendererMeshes={},s.rendererObjects={},s.rendererObjectsList=[],s.rendererViewObjects={},U(D(s),is)[is]=0,U(D(s),os)[os]=0,U(D(s),rs)[rs]=0,U(D(s),ns)[ns]=0,U(D(s),ss)[ss]=0,U(D(s),us)[us]=n.edgeThreshold||10,s.built=!1,U(D(s),qn)[qn]=t(n.position||[0,0,0]),U(D(s),Yn)[Yn]=t(n.rotation||[0,0,0]),U(D(s),Kn)[Kn]=e(n.quaternion||[0,0,0,1]),n.rotation&&l(U(D(s),Yn)[Yn],"XYZ",U(D(s),Kn)[Kn]),U(D(s),Zn)[Zn]=t(n.scale||[1,1,1]),U(D(s),Qn)[Qn]=i(),d(U(D(s),qn)[qn],U(D(s),Kn)[Kn],U(D(s),Zn)[Zn],U(D(s),Qn)[Qn]),(n.matrix||n.position||n.rotation||n.scale||n.quaternion)&&(U(D(s),$n)[$n]=i(),U(D(s),ds)[ds]=!0,U(D(s),fs)[fs]=!0),s.qualityRender=!1!==n.qualityRender,U(D(s),ps)[ps]=n.layerId,U(D(s),vs)[vs]=U(D(s),Vn)[Vn].camera.onViewMatrix.subscribe(function(e,t){U(D(s),ds)[ds]=!0}),U(D(s),ws)[ws](),s.onBuilt=new y(new w),U(D(s),gs)[gs](n.sceneModel);for(var o=0,a=s.layerList.length;o<a;o++)s.layerList[o].layerIndex=o;return U(D(s),cs)[cs]={},s.built=!0,U(D(s),Wn)[Wn].setImageDirty(),s.onBuilt.dispatch(D(s),null),s}I(n,r);var s=n.prototype;return s.setVisible=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setVisible(e,t);U(this,Wn)[Wn].setImageDirty(e)},s.setXRayed=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setXRayed(e,t);U(this,Wn)[Wn].setImageDirty(e)},s.setHighlighted=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setHighlighted(e,t);U(this,Wn)[Wn].setImageDirty(e)},s.setSelected=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setSelected(e,t);U(this,Wn)[Wn].setImageDirty(e)},s.setEdges=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setEdges(e,t);U(this,Wn)[Wn].setImageDirty(e)},s.setCulled=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setCulled(e,t);U(this,Wn)[Wn].setImageDirty(e)},s.setClippable=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setClippable(e,t);U(this,Wn)[Wn].setImageDirty(e)},s.setCollidable=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setCollidable(e,t)},s.setPickable=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setPickable(e,t)},s.setColorize=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setColorize(e,t)},s.setOpacity=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setOpacity(e,t)},s.destroy=function(){if(!this.destroyed){for(var e in U(this,ys)[ys](),U(this,Vn)[Vn].camera.onViewMatrix.unsubscribe(U(this,vs)[vs]),U(this,cs)[cs])U(this,cs)[cs].hasOwnProperty(e)&&U(this,cs)[cs][e].destroy();for(var t=0,i=this.layerList.length;t<i;t++)this.layerList[t].destroy();for(var n in this.rendererObjects)this.rendererObjects[n].destroy();U(this,cs)[cs]={},U(this,ts)[ts]={},this.layerList=[],this.rendererGeometries={},this.rendererTextures={},this.rendererTextureSets={},this.rendererMeshes={},this.rendererViewObjects={},this.onBuilt.clear(),r.prototype.destroy.call(this)}},C(n,[{key:"position",get:function(){return U(this,qn)[qn]}},{key:"rotation",get:function(){return U(this,Yn)[Yn]}},{key:"quaternion",get:function(){return U(this,Kn)[Kn]}},{key:"scale",get:function(){return U(this,Zn)[Zn]}},{key:"worldMatrix",get:function(){return U(this,Qn)[Qn]}},{key:"viewMatrix",get:function(){return U(this,$n)[$n]?(U(this,ds)[ds]&&(h(U(this,Vn)[Vn].camera.viewMatrix,U(this,Qn)[Qn],U(this,$n)[$n]),U(this,ds)[ds]=!1),U(this,$n)[$n]):U(this,Vn)[Vn].camera.viewMatrix}},{key:"colorTextureEnabled",get:function(){return U(this,Jn)[Jn]}},{key:"backfaces",get:function(){return U(this,es)[es]},set:function(e){e=!!e,U(this,es)[es]=e,U(this,Wn)[Wn].setImageDirty()}},{key:"matrix",get:function(){return U(this,Qn)[Qn]}},{key:"aabb",get:function(){return U(this,hs)[hs]&&U(this,_s)[_s](),U(this,ls)[ls]}},{key:"numTriangles",get:function(){return U(this,rs)[rs]}},{key:"numLines",get:function(){return U(this,ns)[ns]}},{key:"numPoints",get:function(){return U(this,ss)[ss]}}]),n}(b);function Ps(e){var t=e.textures,i=e.geometries,r=e.meshes,n=e.objects;if(t)for(var s in t){var o=t[s];U(this,ms)[ms](o)}if(i)for(var a in i){var h=i[a];U(this,Es)[Es](h)}if(r)for(var u in r){var c=r[u];U(this,Ts)[Ts](c)}if(n)for(var l in n){var d=n[l];U(this,bs)[bs](d)}for(var f in U(this,cs)[cs])U(this,cs)[cs].hasOwnProperty(f)&&U(this,cs)[cs][f].build();for(var v=0,p=this.rendererObjectsList.length;v<p;v++)this.rendererObjectsList[v].build();for(var g=0,m=this.rendererObjectsList.length;g<m;g++)this.rendererObjectsList[g].finalize2()}function Os(e){var t=this,i=e.id;if(this.rendererTextures[i])throw new Error("RendererTexture already created: "+i);var r=new E({gl:U(this,zn)[zn].gl});if(e.preloadColor&&r.setPreloadColor(e.preloadColor),e.image){var n=e.image;n.crossOrigin="Anonymous",r.setImage(n,{minFilter:e.minFilter,magFilter:e.magFilter,wrapS:e.wrapS,wrapT:e.wrapT,wrapR:e.wrapR,flipY:e.flipY,encoding:e.encoding})}else if(e.src){var s=e.src.split(".").pop();switch(s){case"jpeg":case"jpg":case"png":case"gif":var o=new Image;o.onload=function(){r.setImage(o,{minFilter:e.minFilter,magFilter:e.magFilter,wrapS:e.wrapS,wrapT:e.wrapT,wrapR:e.wrapR,flipY:e.flipY,encoding:e.encoding})},o.src=e.src;break;default:U(this,as)[as]?function(e,t,i){var r=function(e){};t=t||r,i=i||r;var n=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(n){var s=!!n[2],o=n[3];o=window.decodeURIComponent(o),s&&(o=window.atob(o));try{for(var a=new ArrayBuffer(o.length),h=new Uint8Array(a),u=0;u<o.length;u++)h[u]=o.charCodeAt(u);window.setTimeout(function(){t(a)},0)}catch(e){window.setTimeout(function(){i(e)},0)}}else{var c=new XMLHttpRequest;c.open("GET",e,!0),c.responseType="arraybuffer",c.onreadystatechange=function(){4===c.readyState&&(200===c.status?t(c.response):i("loadArrayBuffer error : "+c.response))},c.send(null)}}(e.src,function(e){e.byteLength?U(t,as)[as].transcode([e]).then(function(e){r.setCompressedData(e),U(t,Wn)[Wn].setImageDirty()}):t.error("Can't create texture from 'src': file data is zero length")},function(e){t.error("Can't create texture from 'src': "+e)}):this.error("Can't create texture from 'src' - rendererModel needs to be configured with a TextureTranscoder for this file type ('"+s+"')")}}else e.buffers&&(U(this,as)[as]?U(this,as)[as].transcode(e.buffers).then(function(e){r.setCompressedData(e),U(t,Wn)[Wn].setImageDirty()}):this.error("Can't create texture from 'buffers' - rendererModel needs to be configured with a TextureTranscoder for this option"));var a=new In(e,r);e.rendererTexture=a,this.rendererTextures[i]=a}function Ss(e){var t=e.id;if(this.rendererGeometries[t])throw new Error("GeometryRenderer already created: "+t);var i=new Cn;this.rendererGeometries[t]=i,e.rendererGeometry=i,U(this,is)[is]++}function Cs(e){var t=this.rendererGeometries[e.geometry.id];if(!t)throw new Error("RendererGeometry not found");var i=this.rendererTextureSets[e.textureSet.id];if(!i)throw new Error("rendererTextureSet not found");var r=U(this,xs)[xs](e.textureSet.id,e.geometry);if(r){var n;r.hasGeometry(e.geometry.id)||r.createGeometryCompressed(e.geometry),U(this,fs)[fs]&&U(this,Qn),n=e.matrix;var s=e.color?new Uint8Array([Math.floor(255*e.color[0]),Math.floor(255*e.color[1]),Math.floor(255*e.color[2])]):[255,255,255],o=null!=e.opacity?Math.floor(255*e.opacity):255,a=null!=e.metallic?Math.floor(255*e.metallic):0,h=null!=e.roughness?Math.floor(255*e.roughness):255,u=new Nn({tileManager:U(this,Wn)[Wn].tileManager,id:e.id,layer:r,color:s,opacity:o,matrix:n,metallic:a,roughness:h,rendererTextureSet:i,rendererGeometry:t,meshIndex:0});u.pickId=U(this,Wn)[Wn].registerPickable(u);var c=new Uint8Array([255&u.pickId,u.pickId>>8&255,u.pickId>>16&255,u.pickId>>24&255]);_t(u.aabb);var l=r.createMesh({id:e.id,geometryId:e.geometry.id,color:s,opacity:o,metallic:a,roughness:h,matrix:n,pickColor:c});U(this,is)[is]++,Mt(U(this,ls)[ls],u.aabb),u.layer=r,u.meshIndex=l,this.rendererMeshes[e.id]=u}}function Is(e){var t=e.id;void 0===t?t=V():this.rendererObjects[t]&&(this.error("[createObject] rendererModel already has a ViewerObject with this ID: "+t+" - will assign random ID"),t=V());var i=e.meshes;if(void 0===i)throw new Error("[createObject] Param expected: meshes");for(var r=[],n=0,s=i.length;n<s;n++)r.push(this.rendererMeshes[i[n].id]);var o=new Fn({id:t,rendererModel:this,rendererMeshes:r,aabb:e.aabb,layerId:U(this,ps)[ps]});this.rendererObjectsList.push(o),this.rendererObjects[t]=o,this.rendererViewObjects[t]=o,U(this,os)[os]++}function Rs(){var e=this.sceneModel;if(e){var t=e.textures,i=e.geometries,r=e.meshes,n=e.objects;if(t)for(var s in t){var o=t[s];o.rendererTexture&&(o.rendererTexture=null)}if(i)for(var a in i){var h=i[a];h.rendererGeometry&&(h.rendererGeometry=null)}if(r)for(var u in r){var c=r[u];c.rendererMesh&&(c.rendererMesh=null)}if(n)for(var l in n){var d=n[l];d.rendererObject&&(d.rendererObject=null)}this.sceneModel=null}}function Ds(){var e=new In(null,new E({gl:U(this,zn)[zn].gl,preloadColor:[1,1,1,1]})),t=new In(null,new E({gl:U(this,zn)[zn].gl,preloadColor:[0,1,1,1]})),i=new In(null,new E({gl:U(this,zn)[zn].gl,preloadColor:[0,0,0,0]})),r=new In(null,new E({gl:U(this,zn)[zn].gl,preloadColor:[0,0,0,1]})),n=new In(null,new E({gl:U(this,zn)[zn].gl,preloadColor:[1,1,1,1]}));this.rendererTextures.defaultColorTexture=e,this.rendererTextures.defaultMetalRoughTexture=t,this.rendererTextures.defaultNormalsTexture=i,this.rendererTextures.defaultEmissiveTexture=r,this.rendererTextures.defaultOcclusionTexture=n,this.rendererTextureSets[Xn]=new Hn({id:Xn,colorTexture:e,metallicRoughnessTexture:t,emissiveTexture:r,occlusionTexture:n})}function As(e,t){var i,r=e+"_"+t.primitive,n=U(this,cs)[cs][r];if(n){if(n.canCreateMesh(t))return n;n.build(),delete U(this,cs)[cs][r]}if(!e||(i=this.rendererTextureSets[e]))return n=new _n({gl:U(this,zn)[zn].gl,view:U(this,Vn)[Vn],rendererModel:this,primitive:t.primitive,textureSet:i,layerIndex:0}),U(this,ts)[ts][r]=n,this.layerList.push(n),U(this,cs)[cs][r]=n,n;this.error("TextureSet not found: "+e+" - ensure that you create it first with createTextureSet()")}function Ls(){_t(U(this,ls)[ls]);for(var e=0,t=this.rendererObjectsList.length;e<t;e++){var i=this.rendererObjectsList[e];Mt(U(this,ls)[ls],i.aabb)}U(this,hs)[hs]=!1}t();var Bs=new Float32Array(16),js=new Float64Array(4),Us=new Float64Array(4);function Fs(e,t,i){return void 0===i&&(i=200),t[0]=Math.round(e[0]/i)*i,t[1]=Math.round(e[1]/i)*i,t[2]=Math.round(e[2]/i)*i,t}var ks=2e3,Gs=/*#__PURE__*/j("gl"),Ns=/*#__PURE__*/j("indexesUsed"),Hs=/*#__PURE__*/j("tiles"),Xs=/*#__PURE__*/j("dataTexture"),Vs=/*#__PURE__*/j("camera"),Ws=/*#__PURE__*/j("lastFreeIndex"),zs=/*#__PURE__*/j("putFreeTile"),qs=/*#__PURE__*/j("findFreeTile"),Ys=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,qs,{value:Zs}),Object.defineProperty(this,zs,{value:Ks}),Object.defineProperty(this,Gs,{writable:!0,value:void 0}),Object.defineProperty(this,Ns,{writable:!0,value:void 0}),Object.defineProperty(this,Hs,{writable:!0,value:void 0}),Object.defineProperty(this,Xs,{writable:!0,value:void 0}),Object.defineProperty(this,Vs,{writable:!0,value:void 0}),Object.defineProperty(this,Ws,{writable:!0,value:void 0}),U(this,Vs)[Vs]=e.camera,U(this,Gs)[Gs]=e.gl,U(this,Ns)[Ns]=[],U(this,Ws)[Ws]=0,U(this,Hs)[Hs]={},U(this,Xs)[Xs]=function(e,t){var i=ks;if(0==i)throw"texture height == 0";var r=new Jr(48*i),n=e.createTexture();return n?(e.bindTexture(e.TEXTURE_2D,n),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA16F,12,i),e.texSubImage2D(e.TEXTURE_2D,0,0,0,12,i,e.RGBA,e.HALF_FLOAT,new Uint16Array(r.buffer),0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new m({gl:e,texture:n,textureWidth:12,textureHeight:i})):tn}(U(this,Gs)[Gs])}var r=e.prototype;return r.getTile=function(e){var r=Fs(e,t()),n=r[0]+"-"+r[1]+"-"+r[2],s=U(this,Hs)[Hs][n];return s||(s={id:n,index:U(this,qs)[qs](),useCount:0,center:t(),rtcViewMatrix:i()},U(this,Hs)[Hs][s.id]=s),s.useCount++,s},r.putTile=function(e){--e.useCount<=0&&(delete U(this,Hs)[Hs][e.id],U(this,zs)[zs](e.index))},r.updateTileCenter=function(e,r){var n=Fs(r,t()),s=n[0]+"-"+n[1]+"-"+n[2];if(s===e.id)return e;this.putTile(e);var o=U(this,Hs)[Hs][s];return o||(o={id:s,index:U(this,qs)[qs](),useCount:0,center:t(),rtcViewMatrix:i()},U(this,Hs)[Hs][o.id]=o),o.useCount++,o},r.refreshMatrices=function(){if(U(this,Xs)[Xs].texture){for(var e,t,i,r=U(this,Gs)[Gs],n=U(this,Vs)[Vs].viewMatrix,s=Object.keys(U(this,Hs)[Hs]),o=new Float32Array(16*s.length),a=0,h=s.length;a<h;a++){var u=s[a],c=U(this,Hs)[Hs][u];e=n,void 0===(i=c.rtcViewMatrix)&&(i=Bs),js[0]=(t=c.center)[0],js[1]=t[1],js[2]=t[2],js[3]=1,f(e,js,Us),v(e,Us,i),o.set(c.rtcViewMatrix,16*c.index)}r.bindTexture(r.TEXTURE_2D,U(this,Xs)[Xs].texture),r.texSubImage2D(r.TEXTURE_2D,0,0,0,1,1,r.RGBA,r.FLOAT,o),r.bindTexture(r.TEXTURE_2D,null)}},e}();function Ks(e){delete U(this,Ns)[Ns][e],U(this,Ws)[Ws]=e}function Zs(){for(var e=U(this,Ws)[Ws];;e=(e+1)%ks)if(!U(this,Ns)[Ns][e])return U(this,Ns)[Ns][e]=!0,e}var Qs=navigator.userAgent.match(/(opera|chrome|safari|firefox|msie|mobile)\/?\s*(\.?\d+(\.\d+)*)/i),$s=Qs&&"safari"===Qs[1].toLowerCase(),Js=/*#__PURE__*/j("sceneModels"),eo=/*#__PURE__*/j("viewer"),to=/*#__PURE__*/j("view"),io=/*#__PURE__*/j("renderContext"),ro=/*#__PURE__*/j("canvasTransparent"),no=/*#__PURE__*/j("transparentEnabled"),so=/*#__PURE__*/j("edgesEnabled"),oo=/*#__PURE__*/j("imageDirty"),ao=/*#__PURE__*/j("saoEnabled"),ho=/*#__PURE__*/j("pbrEnabled"),uo=/*#__PURE__*/j("backgroundColor"),co=/*#__PURE__*/j("rendererModels"),lo=/*#__PURE__*/j("layerList"),fo=/*#__PURE__*/j("layerListDirty"),vo=/*#__PURE__*/j("stateSortDirty"),po=/*#__PURE__*/j("pickIDs"),go=/*#__PURE__*/j("saoDepthRenderBuffer"),mo=/*#__PURE__*/j("renderBufferManager"),Eo=/*#__PURE__*/j("extensionHandles"),To=/*#__PURE__*/j("logarithmicDepthBufferEnabled"),bo=/*#__PURE__*/j("alphaDepthMask"),yo=/*#__PURE__*/j("occlusionTester"),wo=/*#__PURE__*/j("textureTranscoder"),xo=/*#__PURE__*/j("layerRenderers"),_o=/*#__PURE__*/j("viewMatrixDirty"),Mo=/*#__PURE__*/j("registerRendererViewObjects"),Po=/*#__PURE__*/j("deregisterRendererViewObjects"),Oo=/*#__PURE__*/j("updateLayerList"),So=/*#__PURE__*/j("buildLayerList"),Co=/*#__PURE__*/j("draw"),Io=/*#__PURE__*/j("activateExtensions"),Ro=/*#__PURE__*/j("drawSAOBuffers"),Do=/*#__PURE__*/j("drawDepth"),Ao=/*#__PURE__*/j("drawColor"),Lo=/*#__PURE__*/j("drawLayer"),Bo=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,Lo,{value:Wo}),Object.defineProperty(this,Ao,{value:Vo}),Object.defineProperty(this,Do,{value:Xo}),Object.defineProperty(this,Ro,{value:Ho}),Object.defineProperty(this,Io,{value:No}),Object.defineProperty(this,Co,{value:Go}),Object.defineProperty(this,So,{value:ko}),Object.defineProperty(this,Oo,{value:Fo}),Object.defineProperty(this,Po,{value:Uo}),Object.defineProperty(this,Mo,{value:jo}),this.rendererViewObjects=void 0,this.tileManager=void 0,Object.defineProperty(this,Js,{writable:!0,value:void 0}),Object.defineProperty(this,eo,{writable:!0,value:void 0}),Object.defineProperty(this,to,{writable:!0,value:void 0}),Object.defineProperty(this,io,{writable:!0,value:void 0}),Object.defineProperty(this,ro,{writable:!0,value:void 0}),Object.defineProperty(this,no,{writable:!0,value:void 0}),Object.defineProperty(this,so,{writable:!0,value:void 0}),Object.defineProperty(this,oo,{writable:!0,value:void 0}),Object.defineProperty(this,ao,{writable:!0,value:void 0}),Object.defineProperty(this,ho,{writable:!0,value:void 0}),Object.defineProperty(this,uo,{writable:!0,value:void 0}),Object.defineProperty(this,co,{writable:!0,value:void 0}),Object.defineProperty(this,lo,{writable:!0,value:void 0}),Object.defineProperty(this,fo,{writable:!0,value:void 0}),Object.defineProperty(this,vo,{writable:!0,value:void 0}),Object.defineProperty(this,po,{writable:!0,value:new X({})}),Object.defineProperty(this,go,{writable:!0,value:void 0}),Object.defineProperty(this,mo,{writable:!0,value:void 0}),Object.defineProperty(this,Eo,{writable:!0,value:void 0}),Object.defineProperty(this,To,{writable:!0,value:void 0}),Object.defineProperty(this,bo,{writable:!0,value:void 0}),Object.defineProperty(this,yo,{writable:!0,value:void 0}),Object.defineProperty(this,wo,{writable:!0,value:void 0}),Object.defineProperty(this,xo,{writable:!0,value:void 0}),Object.defineProperty(this,_o,{writable:!0,value:void 0}),this.tileManager=null,U(this,Js)[Js]={},this.rendererViewObjects={},U(this,wo)[wo]=e.textureTranscoder||new ge({}),U(this,ro)[ro]=!1,U(this,bo)[bo]=!1,U(this,Eo)[Eo]={},U(this,po)[po]=new X({}),U(this,lo)[lo]=[],U(this,fo)[fo]=!0,U(this,vo)[vo]=!0,U(this,oo)[oo]=!0,U(this,no)[no]=!0,U(this,so)[so]=!0,U(this,ao)[ao]=!0,U(this,ho)[ho]=!0,U(this,uo)[uo]=t(),U(this,yo)[yo]=null,U(this,To)[To]=!1,U(this,co)[co]={},U(this,_o)[_o]=!0}var i=e.prototype;return i.init=function(e){U(this,eo)[eo]=e,U(this,wo)[wo].init(U(this,eo)[eo].capabilities)},i.getCapabilities=function(e){e.maxViews=1;var t,i=document.createElement("canvas");try{t=i.getContext("webgl2")}catch(e){console.error("Failed to get a WebGL context")}t&&(e.astcSupported=!!T(t,"WEBGL_compressed_texture_astc"),e.etc1Supported=!0,e.etc2Supported=!!T(t,"WEBGL_compressed_texture_etc"),e.dxtSupported=!!T(t,"WEBGL_compressed_texture_s3tc"),e.bptcSupported=!!T(t,"EXT_texture_compression_bptc"),e.pvrtcSupported=!(!T(t,"WEBGL_compressed_texture_pvrtc")&&!T(t,"WEBKIT_WEBGL_compressed_texture_pvrtc")))},i.registerView=function(e){var t=this;if(U(this,io)[io])throw"Only one View allowed with WebGLRenderer (see WebViewerCapabilities.maxViews)";U(this,to)[to]=e;for(var i=["webglutils"],r=e.canvasElement,n={},s=null,o=0;!s&&o<i.length;o++)try{s=r.getContext(i[o],n)}catch(e){}return s?(s&&s.hint(s.FRAGMENT_SHADER_DERIVATIVE_HINT,s.NICEST),U(this,io)[io]=new Te(U(this,eo)[eo],U(this,to)[to],s),this.tileManager=new Ys({camera:e.camera,gl:s}),U(this,xo)[xo]={colorTriangles:new wt(U(this,io)[io])},e.camera.onViewMatrix.sub(function(){U(t,_o)[_o]=!0}),0):(console.error("Failed to get a WebGL2 context"),0)},i.deregisterView=function(e){},i.addModel=function(e){var t=this;if(!U(this,io)[io])throw new Error("Must register a View before you add a SceneModel");var i=new Ms(function(e,t){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}({sceneModel:e.sceneModel,view:U(this,to)[to],textureTranscoder:U(this,wo)[wo],webglRenderer:this,renderContext:U(this,io)[io],layerId:e.layerId},e));U(this,co)[co][i.id]=i,U(this,Mo)[Mo](i),U(this,fo)[fo]=!0,i.onDestroyed.one(function(e){var i=U(t,co)[co][e.id];delete U(t,co)[co][e.id],U(t,Po)[Po](i),U(t,fo)[fo]=!0})},i.removeModel=function(e){if(U(this,Js)[Js][e]){var t=U(this,co)[co][e];delete U(this,co)[co][e],U(this,Po)[Po](t),U(this,fo)[fo]=!0}},i.registerPickable=function(e){return U(this,po)[po].addItem(e)},i.deregisterPickable=function(e){U(this,po)[po].removeItem(e)},i.setImageDirty=function(e){U(this,oo)[oo]=!0},i.setBackgroundColor=function(e,t){U(this,uo)[uo].set(t),U(this,oo)[oo]=!0},i.setEdgesEnabled=function(e,t){U(this,so)[so]=t,U(this,oo)[oo]=!0},i.setPBREnabled=function(e,t){U(this,ho)[ho]=t,U(this,oo)[oo]=!0},i.getSAOSupported=function(){return $s&&p.SUPPORTED_EXTENSIONS.OES_standard_derivatives},i.setSAOEnabled=function(e,t){U(this,ao)[ao]=t,U(this,oo)[oo]=!0},i.setTransparentEnabled=function(e,t){U(this,no)[no]=t,U(this,oo)[oo]=!0},i.clear=function(e){var t=U(this,io)[io].gl;t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),U(this,ro)[ro]?t.clearColor(1,1,1,1):t.clearColor(U(this,uo)[uo][0],U(this,uo)[uo][1],U(this,uo)[uo][2],1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},i.needsRebuild=function(e){for(var t in U(this,xo)[xo])U(this,xo)[xo][t].needRebuild()},i.needsRender=function(e){return U(this,oo)[oo]||U(this,fo)[fo]||U(this,vo)[vo]},i.render=function(e,t){(t=t||{}).force&&(U(this,oo)[oo]=!0),U(this,_o)[_o]&&(this.tileManager.refreshMatrices(),U(this,_o)[_o]=!1),U(this,Oo)[Oo](),U(this,oo)[oo]&&(U(this,Co)[Co]({clear:!0}),U(this,oo)[oo]=!1)},i.pickSceneObject=function(e,t){return null},e}();function jo(e){var t=e.rendererViewObjects;for(var i in t)this.rendererViewObjects[i]=t[i]}function Uo(e){var t=e.rendererViewObjects;for(var i in t)delete this.rendererViewObjects[i]}function Fo(){U(this,fo)[fo]&&(U(this,So)[So](),U(this,fo)[fo]=!1,U(this,vo)[vo]=!0),U(this,vo)[vo]&&(U(this,vo)[vo]=!1,U(this,oo)[oo]=!0)}function ko(){var e=0;for(var t in U(this,co)[co])for(var i=U(this,co)[co][t],r=0,n=i.layerList.length;r<n;r++)U(this,lo)[lo][e++]=i.layerList[r];U(this,lo)[lo].length=e}function Go(e){U(this,Io)[Io](),U(this,ao)[ao]&&U(this,to)[to].sao.possible&&U(this,Ro)[Ro](e),U(this,Ao)[Ao](e)}function No(){p.SUPPORTED_EXTENSIONS.OES_element_index_uint&&(U(this,Eo)[Eo].OES_element_index_uint=U(this,io)[io].gl.getExtension("OES_element_index_uint")),U(this,To)[To]&&p.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(U(this,Eo)[Eo].EXT_frag_depth=U(this,io)[io].gl.getExtension("EXT_frag_depth")),p.SUPPORTED_EXTENSIONS.WEBGL_depth_texture&&(U(this,Eo)[Eo].WEBGL_depth_texture=U(this,io)[io].gl.getExtension("WEBGL_depth_texture"))}function Ho(e){}function Xo(e){U(this,io)[io].reset();var t=U(this,io)[io].gl;t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),t.clearColor(0,0,0,0),t.enable(t.DEPTH_TEST),t.frontFace(t.CCW),t.enable(t.CULL_FACE),t.depthMask(!0),!1!==e.clear&&t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}function Vo(e){var t=U(this,to)[to],i=U(this,io)[io],r=i.gl,n=[],s=[],o=[],a=[],h=[],u=[],c=[],l=[],d=[],f=[],v=[],g=[],m=[],E=[],T=[],b=[];i.reset(),i.withSAO=!1,i.pbrEnabled=U(this,ho)[ho]&&!!t.qualityRender,r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),U(this,ro)[ro]?r.clearColor(0,0,0,0):r.clearColor(U(this,uo)[uo][0],U(this,uo)[uo][1],U(this,uo)[uo][2],1),r.enable(r.DEPTH_TEST),r.frontFace(r.CCW),r.enable(r.CULL_FACE),r.depthMask(!0),r.lineWidth(1),i.lineWidth=1;var y=t.sao.possible;if(U(this,ao)[ao]&&y){var w=U(this,mo)[mo].getRenderBuffer("saoOcclusion",{depthTexture:!1,size:[r.drawingBufferWidth,r.drawingBufferHeight]});i.occlusionTexture=w?w.getTexture():null}else i.occlusionTexture=null;!1!==e.clear&&r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);for(var x=0,_=0,M=0,P=0,O=0,S=0,C=0,I=0,R=0,D=0,A=0,L=0,B=0,j=0,F=0,k=0,G=0,N=U(this,lo)[lo].length;G<N;G++){var H=U(this,lo)[lo][G],X=H.meshCounts;X.numCulled!==X.numMeshes&&0!==X.numVisible&&(X.numTransparent<X.numMeshes&&(U(this,ao)[ao]&&y&&H.rendererModel.qualityRender?n[x++]=H:U(this,Lo)[Lo](H,ot.COLOR_OPAQUE,H.rendererModel.qualityRender)),U(this,no)[no]&&X.numTransparent&&(o[M++]=H),X.numXRayed>0&&t.xrayMaterial.fill&&(t.xrayMaterial.fillAlpha<1?c[C++]=H:h[O++]=H),X.numHighlighted>0&&t.highlightMaterial.fill&&(t.highlightMaterial.fillAlpha<1?v[A++]=H:d[R++]=H),X.numSelected>0&&t.selectedMaterial.fill&&(t.selectedMaterial.fillAlpha<1?T[F++]=H:m[B++]=H),U(this,so)[so]&&U(this,to)[to].edgeMaterial.edges&&X.numEdges>0&&(X.numTransparent<X.numMeshes&&(s[_++]=H),X.numTransparent>0&&(a[P++]=H),t.selectedMaterial.edgeAlpha<1?b[k++]=H:E[j++]=H,t.xrayMaterial.edgeAlpha<1?l[I++]=H:u[S++]=H,t.highlightMaterial.edgeAlpha<1?g[L++]=H:f[D++]=H))}x>0&&(i.withSAO=!0);for(var V=0;V<_;V++)U(this,Lo)[Lo](s[V],ot.EDGES_COLOR_OPAQUE);for(var W=0;W<O;W++)U(this,Lo)[Lo](h[W],ot.SILHOUETTE_XRAYED);for(var z=0;z<S;z++)U(this,Lo)[Lo](u[z],ot.EDGES_XRAYED);if(C>0||I>0||M>0||P>0){r.enable(r.CULL_FACE),r.enable(r.BLEND),U(this,ro)[ro]?(r.blendEquation(r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)):(r.blendEquation(r.FUNC_ADD),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA)),i.backfaces=!1,U(this,bo)[bo]||r.depthMask(!1);for(var q=0;q<I;q++)U(this,Lo)[Lo](l[q],ot.EDGES_XRAYED);for(var Y=0;Y<C;Y++)U(this,Lo)[Lo](c[Y],ot.SILHOUETTE_XRAYED);(M>0||P>0)&&r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);for(var K=0;K<P;K++)U(this,Lo)[Lo](a[K],ot.EDGES_COLOR_TRANSPARENT);for(var Z=0;Z<M;Z++)U(this,Lo)[Lo](o[Z],ot.COLOR_TRANSPARENT);r.disable(r.BLEND),U(this,bo)[bo]||r.depthMask(!0)}if(R>0||D>0){i.lastProgramId=-1,r.clear(r.DEPTH_BUFFER_BIT);for(var Q=0;Q<D;Q++)U(this,Lo)[Lo](f[Q],ot.EDGES_HIGHLIGHTED);for(var $=0;$<R;$++)U(this,Lo)[Lo](d[$],ot.SILHOUETTE_HIGHLIGHTED)}if(A>0||L>0||R>0){i.lastProgramId=-1,r.clear(r.DEPTH_BUFFER_BIT),r.enable(r.CULL_FACE),r.enable(r.BLEND),U(this,ro)[ro]?(r.blendEquation(r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)):r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);for(var J=0;J<L;J++)U(this,Lo)[Lo](g[J],ot.EDGES_HIGHLIGHTED);for(var ee=0;ee<A;ee++)U(this,Lo)[Lo](v[ee],ot.SILHOUETTE_HIGHLIGHTED);r.disable(r.BLEND)}if(B>0||j>0){i.lastProgramId=-1,r.clear(r.DEPTH_BUFFER_BIT);for(var te=0;te<j;te++)U(this,Lo)[Lo](E[te],ot.EDGES_SELECTED);for(var ie=0;ie<B;ie++)U(this,Lo)[Lo](m[ie],ot.SILHOUETTE_SELECTED)}if(F>0||k>0){i.lastProgramId=-1,r.clear(r.DEPTH_BUFFER_BIT),r.enable(r.CULL_FACE),r.enable(r.BLEND),U(this,ro)[ro]?(r.blendEquation(r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)):r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);for(var re=0;re<k;re++)U(this,Lo)[Lo](b[re],ot.EDGES_SELECTED);for(var ne=0;ne<F;ne++)U(this,Lo)[Lo](T[ne],ot.SILHOUETTE_SELECTED);r.disable(r.BLEND)}for(var se=p.MAX_TEXTURE_UNITS,oe=0;oe<se;oe++)r.activeTexture(r.TEXTURE0+oe);r.bindTexture(r.TEXTURE_CUBE_MAP,null),r.bindTexture(r.TEXTURE_2D,null);for(var ae=p.MAX_VERTEX_ATTRIBS,he=0;he<ae;he++)r.disableVertexAttribArray(he)}function Wo(e,t,i){switch(void 0===i&&(i=!0),e.renderState.primitive){case 20002:case 20004:case 20003:switch(t){case ot.COLOR_OPAQUE:if(e.meshCounts.numTransparent===e.meshCounts.numMeshes||e.meshCounts.numXRayed===e.meshCounts.numMeshes)return;i||U(this,xo)[xo].colorTriangles.draw(e);break;case ot.COLOR_TRANSPARENT:if(0===e.meshCounts.numTransparent)return;i||U(this,xo)[xo].colorTriangles.draw(e)}}}export{Bo as WebGLRenderer};
//# sourceMappingURL=index.es.map
