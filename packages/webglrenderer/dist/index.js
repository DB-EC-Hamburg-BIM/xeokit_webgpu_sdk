var e=require("@xeokit/matrix"),t=require("@xeokit/constants"),i=require("@xeokit/webglutils"),r=require("@xeokit/viewer"),n=require("strongly-typed-events"),s=require("@xeokit/core"),o=require("@xeokit/boundaries");function a(){a=function(){return e};var e={},t=Object.prototype,i=t.hasOwnProperty,r=Object.defineProperty||function(e,t,i){e[t]=i.value},n="function"==typeof Symbol?Symbol:{},s=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",h=n.toStringTag||"@@toStringTag";function c(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,i){return e[t]=i}}function u(e,t,i,n){var s=Object.create((t&&t.prototype instanceof f?t:f).prototype),o=new P(n||[]);return r(s,"_invoke",{value:y(e,i,o)}),s}function l(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var d={};function f(){}function v(){}function p(){}var g={};c(g,s,function(){return this});var m=Object.getPrototypeOf,E=m&&m(m(C([])));E&&E!==t&&i.call(E,s)&&(g=E);var T=p.prototype=f.prototype=Object.create(g);function b(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function x(e,t){function n(r,s,o,a){var h=l(e[r],e,s);if("throw"!==h.type){var c=h.arg,u=c.value;return u&&"object"==typeof u&&i.call(u,"__await")?t.resolve(u.__await).then(function(e){n("next",e,o,a)},function(e){n("throw",e,o,a)}):t.resolve(u).then(function(e){c.value=e,o(c)},function(e){return n("throw",e,o,a)})}a(h.arg)}var s;r(this,"_invoke",{value:function(e,i){function r(){return new t(function(t,r){n(e,i,t,r)})}return s=s?s.then(r,r):r()}})}function y(e,t,i){var r="suspendedStart";return function(n,s){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===n)throw s;return{value:void 0,done:!0}}for(i.method=n,i.arg=s;;){var o=i.delegate;if(o){var a=w(o,i);if(a){if(a===d)continue;return a}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===r)throw r="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r="executing";var h=l(e,t,i);if("normal"===h.type){if(r=i.done?"completed":"suspendedYield",h.arg===d)continue;return{value:h.arg,done:i.done}}"throw"===h.type&&(r="completed",i.method="throw",i.arg=h.arg)}}}function w(e,t){var i=t.method,r=e.iterator[i];if(void 0===r)return t.delegate=null,"throw"===i&&e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method)||"return"!==i&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+i+"' method")),d;var n=l(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,d;var s=n.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function C(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:I}}function I(){return{value:void 0,done:!0}}return v.prototype=p,r(T,"constructor",{value:p,configurable:!0}),r(p,"constructor",{value:v,configurable:!0}),v.displayName=c(p,h,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,c(e,h,"GeneratorFunction")),e.prototype=Object.create(T),e},e.awrap=function(e){return{__await:e}},b(x.prototype),c(x.prototype,o,function(){return this}),e.AsyncIterator=x,e.async=function(t,i,r,n,s){void 0===s&&(s=Promise);var o=new x(u(t,i,r,n),s);return e.isGeneratorFunction(i)?o:o.next().then(function(e){return e.done?e.value:o.next()})},b(T),c(T,h,"Generator"),c(T,s,function(){return this}),c(T,"toString",function(){return"[object Generator]"}),e.keys=function(e){var t=Object(e),i=[];for(var r in t)i.push(r);return i.reverse(),function e(){for(;i.length;){var r=i.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=C,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(M),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(i,r){return o.type="throw",o.arg=e,t.next=i,r&&(t.method="next",t.arg=void 0),!!r}for(var n=this.tryEntries.length-1;n>=0;--n){var s=this.tryEntries[n],o=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var a=i.call(s,"catchLoc"),h=i.call(s,"finallyLoc");if(a&&h){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(a){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var s=n;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=e,o.arg=t,s?(this.method="next",this.next=s.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),M(i),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var r=i.completion;if("throw"===r.type){var n=r.arg;M(i)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:C(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=void 0),d}},e}function h(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,"symbol"==typeof(n=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key))?n:String(n),r)}var n}function c(e,t,i){return t&&h(e.prototype,t),i&&h(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function u(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,l(e,t)}function l(e,t){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},l(e,t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function v(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return f(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?f(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var p=0;function g(e){return"__private_"+p+++"_"+e}function m(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var E=0;function T(e){return"__private_"+E+++"_"+e}function b(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var x=/*#__PURE__*/T("items"),y=/*#__PURE__*/T("lastUniqueId"),w=/*#__PURE__*/function(){function e(e,t){Object.defineProperty(this,x,{writable:!0,value:void 0}),Object.defineProperty(this,y,{writable:!0,value:void 0}),b(this,x)[x]=e||[],b(this,y)[y]=(t||0)+1}var t=e.prototype;return t.addItem=function(){var e;if(2===arguments.length){var t=arguments[0];if(e=arguments[1],b(this,x)[x][t])throw"ID clash: '"+t+"'";return b(this,x)[x][t]=e,t}for(e=arguments[0]||{};;){var i=b(this,y)[y]++;if(!b(this,x)[x][i])return b(this,x)[x][i]=e,i}},t.removeItem=function(e){var t=b(this,x)[x][e];return delete b(this,x)[x][e],t},e}();[["0",10],["A",26],["a",26],["_",1],["$",1]].map(function(e){for(var t=[],i=e[0].charCodeAt(0),r=i+e[1],n=i;n<r;++n)t.push(n);return String.fromCharCode.apply(null,t)}).join("");var _=function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&i]+e[i>>8&255]+"-"+e[i>>16&15|64]+e[i>>24&255]+"-"+e[63&r|128]+e[r>>8&255]+"-"+e[r>>16&255]+e[r>>24&255]+e[255&n]+e[n>>8&255]+e[n>>16&255]+e[n>>24&255]}}(),M=0;function P(e){return"__private_"+M+++"_"+e}function C(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}function I(e,t){return I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},I(e,t)}var S=/*#__PURE__*/function(){function e(e,t,i){this.isLoading=void 0,this.itemsLoaded=void 0,this.itemsTotal=void 0,this.urlModifier=void 0,this.handlers=void 0,this.onStart=void 0,this.onLoad=void 0,this.onProgress=void 0,this.onError=void 0,this.isLoading=!1,this.itemsLoaded=0,this.itemsTotal=0,this.urlModifier=void 0,this.handlers=[],this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i}var t=e.prototype;return t.itemStart=function(e){this.itemsTotal++,this.isLoading||void 0!==this.onStart&&this.onStart(e,this.itemsLoaded,this.itemsTotal),this.isLoading=!0},t.itemEnd=function(e){this.itemsLoaded++,void 0!==this.onProgress&&this.onProgress(e,this.itemsLoaded,this.itemsTotal),this.itemsLoaded===this.itemsTotal&&(this.isLoading=!1,void 0!==this.onLoad&&this.onLoad())},t.itemError=function(e){void 0!==this.onError&&this.onError(e)},t.resolveURL=function(e){return this.urlModifier?this.urlModifier(e):e},t.setURLModifier=function(e){return this.urlModifier=e,this},t.addHandler=function(e,t){return this.handlers.push(e,t),this},t.removeHandler=function(e){var t=this.handlers.indexOf(e);return-1!==t&&this.handlers.splice(t,2),this},t.getHandler=function(e){for(var t=0,i=this.handlers.length;t<i;t+=2){var r=this.handlers[t],n=this.handlers[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return n}return null},e}(),R=new S,D=/*#__PURE__*/function(){function e(e){this.manager=void 0,this.crossOrigin=void 0,this.withCredentials=void 0,this.path=void 0,this.resourcePath=void 0,this.requestHeader=void 0,this.manager=void 0!==e?e:R,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}var t=e.prototype;return t.load=function(e,t,i,r){},t.loadAsync=function(e,t){var i=this;return new Promise(function(r,n){i.load(e,r,t,n)})},t.parse=function(){},t.setCrossOrigin=function(e){return this.crossOrigin=e,this},t.setWithCredentials=function(e){return this.withCredentials=e,this},t.setPath=function(e){return this.path=e,this},t.setResourcePath=function(e){return this.resourcePath=e,this},t.setRequestHeader=function(e){return this.requestHeader=e,this},e}(),O=/*#__PURE__*/function(){function e(e){void 0===e&&(e=4),this.pool=void 0,this.queue=void 0,this.workers=void 0,this.workersResolve=void 0,this.workerStatus=void 0,this.workerCreator=void 0,this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}var t=e.prototype;return t._initWorker=function(e){if(!this.workers[e]){var t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}},t._getIdleWorker=function(){for(var e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1},t._onMessage=function(e,t){var i=this.workersResolve[e];if(i&&i(t),this.queue.length){var r=this.queue.shift(),n=r.msg,s=r.transfer;this.workersResolve[e]=r.resolve,this.workers[e].postMessage(n,s)}else this.workerStatus^=1<<e},t.setWorkerCreator=function(e){this.workerCreator=e},t.setWorkerLimit=function(e){this.pool=e},t.postMessage=function(e,t){var i=this;return new Promise(function(r){var n=i._getIdleWorker();-1!==n?(i._initWorker(n),i.workerStatus|=1<<n,i.workersResolve[n]=r,i.workers[n].postMessage(e,t)):i.queue.push({resolve:r,msg:e,transfer:t})})},t.destroy=function(){this.workers.forEach(function(e){return e.terminate()}),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0},e}(),L={},B=/*#__PURE__*/function(e){var t,i;function r(t){var i;return(i=e.call(this,t)||this).mimeType=void 0,i.responseType=void 0,i}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,I(t,i);var n=r.prototype;return n.load=function(e,t,i,r){var n=this;if(void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e),void 0===L[e]){L[e]=[],L[e].push({onLoad:t,onProgress:i,onError:r});var s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,a=this.responseType;fetch(s).then(function(t){if(200===t.status||0===t.status){if(0===t.status&&console.warn("FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body.getReader)return t;var i=L[e],r=t.body.getReader(),n=t.headers.get("Content-Length"),s=n?parseInt(n):0,o=0!==s,a=0,h=new ReadableStream({start:function(e){!function t(){r.read().then(function(r){var n=r.value;if(r.done)e.close();else{for(var h=new ProgressEvent("progress",{lengthComputable:o,loaded:a+=n.byteLength,total:s}),c=0,u=i.length;c<u;c++){var l=i[c];l.onProgress&&l.onProgress(h)}e.enqueue(n),t()}})}()}});return new Response(h)}throw new Error('fetch for "'+t.url+'" responded with '+t.status+": "+t.statusText)}).then(function(e){switch(a){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(function(e){return(new DOMParser).parseFromString(e,o)});case"json":return e.json();default:if(void 0===o)return e.text();var t=/charset="?([^;"\s]*)"?/i.exec(o),i=t&&t[1]?t[1].toLowerCase():void 0,r=new TextDecoder(i);return e.arrayBuffer().then(function(e){return r.decode(e)})}}).then(function(t){var i=L[e];delete L[e];for(var r=0,n=i.length;r<n;r++){var s=i[r];s.onLoad&&s.onLoad(t)}}).catch(function(t){var i=L[e];if(void 0===i)throw n.manager.itemError(e),t;delete L[e];for(var r=0,s=i.length;r<s;r++){var o=i[r];o.onError&&o.onError(t)}n.manager.itemError(e)}).finally(function(){n.manager.itemEnd(e)}),this.manager.itemStart(e)}else L[e].push({onLoad:t,onProgress:i,onError:r})},n.setResponseType=function(e){return this.responseType=e,this},n.setMimeType=function(e){return this.mimeType=e,this},r}(D);[["0",10],["A",26],["a",26],["_",1],["$",1]].map(function(e){for(var t=[],i=e[0].charCodeAt(0),r=i+e[1],n=i;n<r;++n)t.push(n);return String.fromCharCode.apply(null,t)}).join(""),function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16)}();var A=0,U={ETC1S:0,UASTC_4x4:1},F={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},j={RGBAFormat:1023,RGBA_ASTC_4x4_Format:37808,RGBA_BPTC_Format:36492,RGBA_ETC2_EAC_Format:37496,RGBA_PVRTC_4BPPV1_Format:35842,RGBA_S3TC_DXT5_Format:33779,RGB_ETC1_Format:36196,RGB_ETC2_Format:37492,RGB_PVRTC_4BPPV1_Format:35840,RGB_S3TC_DXT1_Format:33776},G=/*#__PURE__*/P("transcoderPath"),k=/*#__PURE__*/P("transcoderBinary"),N=/*#__PURE__*/P("transcoderPending"),H=/*#__PURE__*/P("workerPool"),X=/*#__PURE__*/P("workerSourceURL"),V=/*#__PURE__*/P("workerConfig"),W=/*#__PURE__*/P("supportedFileTypes"),z=/*#__PURE__*/P("withCredentials"),q=/*#__PURE__*/P("initTranscoder"),Y=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,q,{value:K}),Object.defineProperty(this,G,{writable:!0,value:void 0}),Object.defineProperty(this,k,{writable:!0,value:void 0}),Object.defineProperty(this,N,{writable:!0,value:void 0}),Object.defineProperty(this,H,{writable:!0,value:void 0}),Object.defineProperty(this,X,{writable:!0,value:void 0}),Object.defineProperty(this,V,{writable:!0,value:void 0}),Object.defineProperty(this,W,{writable:!0,value:void 0}),Object.defineProperty(this,z,{writable:!0,value:void 0}),C(this,G)[G]=e.transcoderPath||"https://cdn.jsdelivr.net/npm/@xeokit/sdk/dist/basis/",C(this,k)[k]=null,C(this,N)[N]=null,C(this,H)[H]=new O,C(this,X)[X]="",e.workerLimit&&C(this,H)[H].setWorkerLimit(e.workerLimit),C(this,V)[V]=null,C(this,z)[z]=!1,C(this,W)[W]=["xkt2"]}var t=e.prototype;return t.init=function(e){C(this,V)[V]={astcSupported:e.astcSupported,etc1Supported:e.etc1Supported,etc2Supported:e.etc2Supported,dxtSupported:e.dxtSupported,bptcSupported:e.bptcSupported,pvrtcSupported:e.pvrtcSupported}},t.transcode=function(e,t){var i=this;return void 0===t&&(t={}),new Promise(function(r,n){var s=t;C(i,q)[q]().then(function(){return C(i,H)[H].postMessage({type:"transcode",buffers:e,taskConfig:s},e)}).then(function(e){var t=e.data,i=t.mipmaps,s=t.format,o=t.dfdTransferFn,a=t.dfdFlags;if("error"===t.type)return n(t.error);r({mipmaps:i,props:{format:s,minFilter:1===i.length?1006:1008,magFilter:1===i.length?1006:1008,encoding:2===o?3001:3e3,premultiplyAlpha:!!(1&a)}})})})},t.destroy=function(){URL.revokeObjectURL(C(this,X)[X]),C(this,H)[H].destroy(),A--},e}();function K(){var e=this;if(!C(this,N)[N]){var t=new B;t.setPath(C(this,G)[G]),t.setWithCredentials(C(this,z)[z]);var i=t.loadAsync("basis_transcoder.js"),r=new B;r.setPath(C(this,G)[G]),r.setResponseType("arraybuffer"),r.setWithCredentials(C(this,z)[z]);var n=r.loadAsync("basis_transcoder.wasm");C(this,N)[N]=Promise.all([i,n]).then(function(t){var i=t[0],r=t[1],n=Z.toString(),s=["/* constants */","let _EngineFormat = "+JSON.stringify(j),"let _TranscoderFormat = "+JSON.stringify(F),"let _BasisFormat = "+JSON.stringify(U),"/* basis_transcoder.js */",i,"/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");C(e,X)[X]=URL.createObjectURL(new Blob([s])),C(e,k)[k]=r,C(e,H)[H].setWorkerCreator(function(){var t=new Worker(C(e,X)[X]),i=C(e,k)[k].slice(0);return t.postMessage({type:"init",config:C(e,V)[V],transcoderBinary:i},[i]),t})}),A>0&&console.warn("KTX2TextureTranscoder: Multiple active KTX2TextureTranscoder may cause performance issues. Use a single KTX2TextureTranscoder instance, or call .dispose() on old instances."),A++}return C(this,N)[N]}var Z=function(){var e,t,i,r=_EngineFormat,n=_TranscoderFormat,s=_BasisFormat;self.addEventListener("message",function(o){var u,l=o.data;switch(l.type){case"init":e=l.config,u=l.transcoderBinary,t=new Promise(function(e){i={wasmBinary:u,onRuntimeInitialized:e},BASIS(i)}).then(function(){i.initializeBasis(),void 0===i.KTX2File&&console.warn("KTX2TextureTranscoder: Please update Basis Universal transcoder.")});break;case"transcode":t.then(function(){try{for(var t=function(t){var o=new i.KTX2File(new Uint8Array(t));function u(){o.close(),o.delete()}if(!o.isValid())throw u(),new Error("KTX2TextureTranscoder: Invalid or unsupported .ktx2 file");var l=o.isUASTC()?s.UASTC_4x4:s.ETC1S,d=o.getWidth(),f=o.getHeight(),v=o.getLevels(),p=o.getHasAlpha(),g=o.getDFDTransferFunc(),m=o.getDFDFlags(),E=function(t,i,o,u){for(var l=t===s.ETC1S?a:h,d=0;d<l.length;d++){var f=l[d];if(e[f.if]&&f.basisFormat.includes(t)&&!(u&&f.transcoderFormat.length<2)&&(!f.needsPowerOfTwo||c(i)&&c(o)))return{transcoderFormat:f.transcoderFormat[u?1:0],engineFormat:f.engineFormat[u?1:0]}}return console.warn("KTX2TextureTranscoder: No suitable compressed texture format found. Decoding to RGBA32."),{transcoderFormat:n.RGBA32,engineFormat:r.RGBAFormat}}(l,d,f,p),T=E.transcoderFormat,b=E.engineFormat;if(!d||!f||!v)throw u(),new Error("KTX2TextureTranscoder: Invalid texture");if(!o.startTranscoding())throw u(),new Error("KTX2TextureTranscoder: .startTranscoding failed");for(var x=[],y=0;y<v;y++){var w=o.getImageLevelInfo(y,0,0),_=w.origWidth,M=w.origHeight,P=new Uint8Array(o.getImageTranscodedSizeInBytes(y,0,0,T));if(!o.transcodeImage(P,y,0,0,T,0,-1,-1))throw u(),new Error("KTX2TextureTranscoder: .transcodeImage failed.");x.push({data:P,width:_,height:M})}return u(),{width:d,height:f,hasAlpha:p,mipmaps:x,format:b,dfdTransferFn:g,dfdFlags:m}}(l.buffers[0]),o=t.width,u=t.height,d=t.hasAlpha,f=t.mipmaps,v=t.format,p=t.dfdTransferFn,g=t.dfdFlags,m=[],E=0;E<f.length;++E)m.push(f[E].data.buffer);self.postMessage({type:"transcode",id:l.id,width:o,height:u,hasAlpha:d,mipmaps:f,format:v,dfdTransferFn:p,dfdFlags:g},m)}catch(e){console.error("[BasisWorker]: "+e),self.postMessage({type:"error",id:l.id,error:e.message})}})}});var o=[{if:"astcSupported",basisFormat:[s.UASTC_4x4],transcoderFormat:[n.ASTC_4x4,n.ASTC_4x4],engineFormat:[r.RGBA_ASTC_4x4_Format,r.RGBA_ASTC_4x4_Format],priorityETC1S:Infinity,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[n.BC7_M5,n.BC7_M5],engineFormat:[r.RGBA_BPTC_Format,r.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[n.BC1,n.BC3],engineFormat:[r.RGB_S3TC_DXT1_Format,r.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[n.ETC1,n.ETC2],engineFormat:[r.RGB_ETC2_Format,r.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[n.ETC1],engineFormat:[r.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[n.PVRTC1_4_RGB,n.PVRTC1_4_RGBA],engineFormat:[r.RGB_PVRTC_4BPPV1_Format,r.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],a=o.sort(function(e,t){return e.priorityETC1S-t.priorityETC1S}),h=o.sort(function(e,t){return e.priorityUASTC-t.priorityUASTC});function c(e){return e<=2||0==(e&e-1)&&0!==e}},Q=/*#__PURE__*/function(){function e(e,t,i){this.viewer=void 0,this.view=void 0,this.gl=void 0,this.viewMatrixDataTexture=void 0,this.pbrEnabled=void 0,this.withSAO=void 0,this.backfaces=void 0,this.frontface=void 0,this.textureUnit=void 0,this.bindTexture=void 0,this.renderPass=void 0,this.shadowViewMatrix=void 0,this.shadowProjMatrix=void 0,this.pickViewMatrix=void 0,this.pickProjMatrix=void 0,this.pickZNear=void 0,this.pickZFar=void 0,this.pickInvisible=void 0,this.lineWidth=void 0,this.lastProgramId=void 0,this.occlusionTexture=void 0,this.viewer=e,this.view=t,this.gl=i,this.reset()}return e.prototype.reset=function(){this.lastProgramId=-1,this.pbrEnabled=!1,this.withSAO=!1,this.backfaces=!1,this.frontface=!0,this.textureUnit=0,this.shadowViewMatrix=null,this.shadowProjMatrix=null,this.pickViewMatrix=null,this.pickProjMatrix=null,this.pickZNear=.01,this.pickZFar=5e3,this.pickInvisible=!1,this.lineWidth=1,this.occlusionTexture=null},c(e,[{key:"nextTextureUnit",get:function(){var e=this.textureUnit;return this.textureUnit=(this.textureUnit+1)%i.WEBGL_INFO.MAX_TEXTURE_UNITS,e}}]),e}(),$={NOT_RENDERED:0,COLOR_OPAQUE:1,COLOR_TRANSPARENT:2,SILHOUETTE_HIGHLIGHTED:3,SILHOUETTE_SELECTED:4,SILHOUETTE_XRAYED:5,EDGES_COLOR_OPAQUE:6,EDGES_COLOR_TRANSPARENT:7,EDGES_HIGHLIGHTED:8,EDGES_SELECTED:9,EDGES_XRAYED:10,PICK:11},J=e.createVec4(),ee=/*#__PURE__*/g("hash"),te=/*#__PURE__*/g("program"),ie=/*#__PURE__*/g("needRebuild"),re=/*#__PURE__*/g("uniforms"),ne=/*#__PURE__*/g("samplers"),se=/*#__PURE__*/g("build"),oe=/*#__PURE__*/g("buildShader"),ae=/*#__PURE__*/g("getValid"),he=/*#__PURE__*/g("bind"),ce=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,he,{value:fe}),Object.defineProperty(this,ae,{value:de}),Object.defineProperty(this,oe,{value:le}),Object.defineProperty(this,se,{value:ue}),this.errors=void 0,this.renderContext=void 0,Object.defineProperty(this,ee,{writable:!0,value:void 0}),Object.defineProperty(this,te,{writable:!0,value:void 0}),Object.defineProperty(this,ie,{writable:!0,value:void 0}),Object.defineProperty(this,re,{writable:!0,value:void 0}),Object.defineProperty(this,ne,{writable:!0,value:void 0}),this.renderContext=e,m(this,ie)[ie]=!0,m(this,se)[se]()}var t=e.prototype;return t.needRebuild=function(){m(this,ie)[ie]=!0},t.draw=function(e){if(m(this,te)[te]&&!m(this,ae)[ae]()&&(m(this,te)[te].destroy(),m(this,te)[te]=null),!m(this,te)[te]){if(m(this,se)[se](),this.errors)return;this.renderContext.lastProgramId=-1}var t=e.renderState,i=m(this,te)[te],r=this.renderContext,n=r.renderPass,s=this.renderContext.gl,o=this.renderContext.view,a=m(this,re)[re],h=m(this,ne)[ne];if(r.lastProgramId!==i.id&&(r.lastProgramId=i.id,m(this,he)[he]()),a.renderPass&&s.uniform1i(a.renderPass,n),a.projMatrix&&s.uniformMatrix4fv(a.projMatrix,!1,o.camera.projMatrix),a.worldMatrix&&s.uniformMatrix4fv(a.worldMatrix,!1,e.rendererModel.worldMatrix),a.color)if(n===$.SILHOUETTE_XRAYED){var c=o.xrayMaterial,u=c.fillColor;s.uniform4f(a.color,u[0],u[1],u[2],c.fillAlpha)}else if(n===$.SILHOUETTE_HIGHLIGHTED){var l=o.highlightMaterial,d=l.fillColor;s.uniform4f(a.color,d[0],d[1],d[2],l.fillAlpha)}else if(n===$.SILHOUETTE_SELECTED){var f=o.selectedMaterial,v=f.fillColor;s.uniform4f(a.color,v[0],v[1],v[2],f.fillAlpha)}else s.uniform4fv(a.color,new Float32Array([1,1,1]));h.viewMatrices&&t.dataTextureSet.viewMatrices.bindTexture(i,h.viewMatrices,r.nextTextureUnit),h.positions&&t.dataTextureSet.positions.bindTexture(i,h.positions,r.nextTextureUnit),h.eachMeshMatrices&&t.dataTextureSet.eachMeshMatrices.bindTexture(i,h.eachMeshMatrices,r.nextTextureUnit),h.eachMeshAttributes&&t.dataTextureSet.eachMeshAttributes.bindTexture(i,h.eachMeshAttributes,r.nextTextureUnit),h.eachPrimitiveMesh&&(t.numIndices8Bits>0&&(t.dataTextureSet.eachPrimitiveMesh_8Bits.bindTexture(i,h.eachPrimitiveMesh,r.nextTextureUnit),t.dataTextureSet.indices_8Bits.bindTexture(i,h.indices,r.nextTextureUnit),s.drawArrays(s.TRIANGLES,0,t.numIndices8Bits)),t.numIndices16Bits>0&&(t.dataTextureSet.eachPrimitiveMesh_16Bits.bindTexture(i,h.eachPrimitiveMesh,r.nextTextureUnit),t.dataTextureSet.indices_16Bits.bindTexture(i,h.indices,r.nextTextureUnit),s.drawArrays(s.TRIANGLES,0,t.numIndices16Bits)),t.numIndices32Bits>0&&(t.dataTextureSet.eachPrimitiveMesh_32Bits.bindTexture(i,h.eachPrimitiveMesh,r.nextTextureUnit),t.dataTextureSet.indices_32Bits.bindTexture(i,h.indices,r.nextTextureUnit),s.drawArrays(s.TRIANGLES,0,t.numIndices32Bits))),h.baseColorMap&&h.baseColorMap.bindTexture(t.materialTextureSet.colorTexture.texture2D,r.nextTextureUnit),h.metallicRoughMap&&h.metallicRoughMap.bindTexture(t.materialTextureSet.metallicRoughnessTexture.texture2D,r.nextTextureUnit),h.emissiveMap&&h.emissiveMap.bindTexture(t.materialTextureSet.emissiveTexture.texture2D,r.nextTextureUnit),h.occlusionMap&&h.occlusionMap.bindTexture(t.materialTextureSet.occlusionTexture.texture2D,r.nextTextureUnit)},t.destroy=function(){m(this,te)[te]&&m(this,te)[te].destroy(),m(this,te)[te]=null},c(e,[{key:"vertHeader",get:function(){return"#version 300 es\n                #ifdef GL_FRAGMENT_PRECISION_HIGH\n                precision highp float;\n                precision highp int;\n                precision highp usampler2D;\n                precision highp isampler2D;\n                precision highp sampler2D;\n                #else\n                precision mediump float;\n                precision mediump int;\n                precision mediump usampler2D;\n                precision mediump isampler2D;\n                precision mediump sampler2D;\n                uniform int renderPass;\n                #endif"}},{key:"vertDataTextureDefs",get:function(){return"uniform mediump sampler2D eachMeshMatrices;\n                uniform lowp usampler2D eachMeshAttributes;\n                uniform highp sampler2D eachMeshOffset;\n                uniform mediump usampler2D positions;\n                uniform highp usampler2D indices;\n                uniform mediump usampler2D eachPrimitiveMesh;\n                uniform highp sampler2D cameraMatrices;\n                uniform highp sampler2D sceneModelRendererMatrices;"}},{key:"vertLogDepthBufDefs",get:function(){return this.renderContext.view.logarithmicDepthBufferEnabled?"uniform float logDepthBufFC;\n                    out float fragDepth;\n                    bool isPerspectiveMatrix(mat4 m) {\n                        return (m[2][3] == - 1.0);\n                    }\n                    out float isPerspective;":""}},{key:"vertDataTextureSamples",get:function(){return""}},{key:"vertLogDepthBufOutputs",get:function(){return this.renderContext.view.logarithmicDepthBufferEnabled?"fragDepth = 1.0 + clipPos.w;\n                    isPerspective = float (isPerspectiveMatrix(projMatrix));":""}},{key:"fragmentShader",get:function(){return this.fragHeader+"\n        "+this.fragGammaDefs+"\n        "+this.fragSectionPlaneDefs+"\n        "+this.fragLightDefs+"\n        "+this.fragLogDepthBufDefs+"\n        void main(void) {\n            "+this.fragSectionPlanesSlice+"\n            "+this.fragLighting+"\n            "+this.fragLogDepthBufOutput+"\n        }"}},{key:"fragHeader",get:function(){return"#version 300 es\n        #ifdef GL_FRAGMENT_PRECISION_HIGH\n       precision highp float;\n        precision highp int;\n        #else\n        precision mediump float;\n        precision mediump int;\n        #endif"}},{key:"fragGammaDefs",get:function(){return'uniform float gammaFactor;\n        vec4 linearToLinear( in vec4 value ) {\n            return value;\n        }\n        vec4 sRGBToLinear( in vec4 value ) {\n            return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n        }\n        vec4 gammaToLinear( in vec4 value) {\n            return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n        }\n        vec4 linearToGamma( in vec4 value, in float gammaFactor ) {\n              return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );");\n        }'}},{key:"fragLightDefs",get:function(){var e=this.renderContext.view,t=[];t.push("uniform vec4 lightAmbient;");for(var i=0,r=e.lightsList.length;i<r;i++){var n=e.lightsList[i];"ambient"!==n.type&&(t.push("uniform vec4 lightColor"+i+";"),"dir"===n.type&&t.push("uniform vec3 lightDir"+i+";"),"point"===n.type&&t.push("uniform vec3 lightPos"+i+";"),"spot"===n.type&&(t.push("uniform vec3 lightPos"+i+";"),t.push("uniform vec3 lightDir"+i+";")))}return t.join("\n")}},{key:"fragLogDepthBufDefs",get:function(){return this.renderContext.view.logarithmicDepthBufferEnabled?"in float isPerspective;\n                    uniform float logDepthBufFC;\n                    in float fragDepth;":""}},{key:"fragLogDepthBufOutput",get:function(){return this.renderContext.view.logarithmicDepthBufferEnabled?"gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( fragDepth ) * logDepthBufFC * 0.5;":""}},{key:"fragLighting",get:function(){var e=[];e.push("vec4 viewPosition  = viewMatrix * worldPosition; "),e.push("vec4 modelNormal = vec4(octDecode(normal.xy), 0.0); "),e.push("vec4 worldNormal = worldNormalMatrix * vec4(dot(modelNormal, modelNormalMatrixCol0), dot(modelNormal, modelNormalMatrixCol1), dot(modelNormal, modelNormalMatrixCol2), 0.0);"),e.push("vec3 viewNormal = normalize(vec4(viewNormalMatrix * worldNormal).xyz);"),e.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),e.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),e.push("float lambertian = 1.0;");for(var t=0,i=this.renderContext.view.lightsList.length;t<i;t++){var r=this.renderContext.view.lightsList[t];if("ambient"!==r.type){if("dir"===r.type)e.push("view"===r.space?"viewLightDir = normalize(lightDir"+t+");":"viewLightDir = normalize((viewMatrix * vec4(lightDir"+t+", 0.0)).xyz);");else if("point"===r.type)e.push("view"===r.space?"viewLightDir = -normalize(lightPos"+t+" - viewPosition.xyz);":"viewLightDir = -normalize((viewMatrix * vec4(lightPos"+t+", 0.0)).xyz);");else{if("spot"!==r.type)continue;e.push("view"===r.space?"viewLightDir = normalize(lightDir"+t+");":"viewLightDir = normalize((viewMatrix * vec4(lightDir"+t+", 0.0)).xyz);")}e.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),e.push("reflectedColor += lambertian * (lightColor"+t+".rgb * lightColor"+t+".a);")}}return e.push("vec3 rgb = (vec3(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0));"),e.push("meshColor =  vec4((lightAmbient.rgb * lightAmbient.a * rgb) + (reflectedColor * rgb), float(color.a) / 255.0);"),e.join("\n")}},{key:"fragSAOOutput",get:function(){return this.renderContext.view.sao.enabled?"float viewportWidth     = uSAOParams[0];\n                    float viewportHeight    = uSAOParams[1];\n                    float blendCutoff       = uSAOParams[2];\n                    float blendFactor       = uSAOParams[3];\n                    vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);\n                    float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture(uOcclusionTexture, uv))) * blendFactor;\n                    outColor                = vec4(fragColor.rgb * ambient, 1.0);":"outColor            = fragColor;"}},{key:"fragOutput",get:function(){return"outColor            = fragColor;"}},{key:"fragSectionPlaneDefs",get:function(){var e=[];e.push("in vec4 worldPosition;\n                  in vec4 meshFlags2;");for(var t=0,i=this.renderContext.view.sectionPlanesList.length;t<i;t++)e.push("uniform bool sectionPlaneActive"+t+";\n                      uniform vec3 sectionPlanePos"+t+";\n                      uniform vec3 sectionPlaneDir"+t+";");return e.join("\n")}},{key:"fragLightSourceUniforms",get:function(){var e=[];e.push("uniform vec4 lightAmbient;");for(var t=0,i=this.renderContext.view.lightsList.length;t<i;t++){var n=this.renderContext.view.lightsList[t];n instanceof r.AmbientLight||(e.push("uniform vec4 lightColor"+t+";"),n instanceof r.DirLight&&e.push("uniform vec3 lightDir"+t+";"),n instanceof r.PointLight&&e.push("uniform vec3 lightPos"+t+";"))}return e.join("\n")}},{key:"fragSectionPlanesSlice",get:function(){var e=[];if(this.renderContext.view.sectionPlanesList.length>0){e.push("bool clippable = (float(meshFlags2.x) > 0.0);\n                      if (clippable) {\n                          float dist = 0.0;");for(var t=0,i=this.renderContext.view.sectionPlanesList.length;t<i;t++)e.push("if (sectionPlaneActive"+t+") {\n                              dist += clamp(dot(-sectionPlaneDir"+t+".xyz, worldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);\n                          }");e.push("if (dist > 0.0) { \n                          discard;\n                      }\n                  }")}return e.join("\n")}},{key:"fragFlatShading",get:function(){var e=[];return e.push(""),e.join("\n")}}]),e}();function ue(){var e=this.renderContext.view,t=this.renderContext.gl;if(m(this,te)[te]=new i.GLProgram(t,m(this,oe)[oe]()),m(this,te)[te].errors)this.errors=m(this,te)[te].errors;else{var r=m(this,te)[te];m(this,re)[re]={renderPass:r.getLocation("renderPass"),viewMatrix:r.getLocation("viewMatrix"),projMatrix:r.getLocation("projMatrix"),worldMatrix:r.getLocation("worldMatrix"),sao:r.getLocation("sao"),logDepthBufFC:r.getLocation("logDepthBufFC"),gammaFactor:r.getLocation("gammaFactor"),pointSize:r.getLocation("pointSize"),nearPlaneHeight:r.getLocation("nearPlaneHeight"),pointCloudIntensityRange:r.getLocation("pointCloudIntensityRange"),pickZNear:r.getLocation("pickZNear"),pickZFar:r.getLocation("pickZFar"),pickInvisible:r.getLocation("pickInvisible"),color:r.getLocation("color"),lightAmbient:r.getLocation("lightAmbient"),lights:[],sectionPlanes:[]};for(var n=m(this,re)[re],s=e.lightsList,o=0,a=s.length;o<a;o++)switch(s[o].type){case"dir":n.lights.push({color:r.getLocation("lightColor"+o),dir:r.getLocation("lightDir"+o)});break;case"point":n.lights.push({color:r.getLocation("lightColor"+o),pos:r.getLocation("lightPos"+o),attenuation:r.getLocation("lightAttenuation"+o)});break;case"spot":n.lights.push({color:r.getLocation("lightColor"+o),pos:r.getLocation("lightPos"+o),dir:r.getLocation("lightDir"+o),attenuation:r.getLocation("lightAttenuation"+o)})}for(var h=0,c=e.sectionPlanesList.length;h<c;h++)n.sectionPlanes.push({active:r.getLocation("sectionPlaneActive"+h),pos:r.getLocation("sectionPlanePos"+h),dir:r.getLocation("sectionPlaneDir"+h)});m(this,ne)[ne]={viewMatrices:r.getSampler("viewMatrices"),positions:r.getSampler("positions"),indices:r.getSampler("indices"),edgeIndices:r.getSampler("edgeIndices"),eachMeshAttributes:r.getSampler("eachMeshAttributes"),eachMeshMatrices:r.getSampler("eachMeshMatrices"),eachEdgeOffset:r.getSampler("eachMeshOffset"),eachPrimitiveMesh:r.getSampler("eachMeshTriangleMesh"),eachEdgeMesh:r.getSampler("eachEdgeMesh"),baseColorMap:r.getSampler("baseColorMap"),metallicRoughMap:r.getSampler("metallicRoughMap"),emissiveMap:r.getSampler("emissiveMap"),normalMap:r.getSampler("normalMap"),occlusionMap:r.getSampler("occlusionMap")},m(this,ee)[ee]=this.getHash()}}function le(){return{vertex:this.buildVertexShader(),fragment:this.buildFragmentShader()}}function de(){return!m(this,ie)[ie]||(m(this,ie)[ie]=!1,m(this,ee)[ee]===this.getHash())}function fe(){var e=this.renderContext.view,i=this.renderContext.gl,r=m(this,re)[re],n=e.camera.project;m(this,te)[te].bind(),r.lightAmbient&&i.uniform4fv(r.lightAmbient,e.getAmbientColorAndIntensity());for(var s=0,o=r.lights.length;s<o;s++){var a=r.lights[s],h=e.lightsList[s];a.color&&i.uniform4f(a.color,h.color[0],h.color[1],h.color[2],h.intensity),a.dir&&i.uniform3f(a.dir,h.dir[0],h.dir[1],h.dir[2]),a.pos&&i.uniform3f(a.pos,h.pos[0],h.pos[1],h.pos[2]),a.attenuation&&i.uniform1f(a.attenuation,h.attenuation)}if(r.sao){var c=e.sao;if(c.possible){var u=i.drawingBufferHeight;J[0]=i.drawingBufferWidth,J[1]=u,J[2]=c.blendCutoff,J[3]=c.blendFactor,i.uniform4fv(r.sao,J)}}if(r.gammaFactor&&i.uniform1f(r.gammaFactor,e.gammaFactor),r.pointSize&&i.uniform1f(r.pointSize,e.pointsMaterial.pointSize),r.nearPlaneHeight&&i.uniform1f(r.nearPlaneHeight,e.camera.projectionType===t.OrthoProjectionType?1:i.drawingBufferHeight/(2*Math.tan(.5*e.camera.perspectiveProjection.fov*Math.PI/180))),r.pickZNear&&(i.uniform1f(r.pickZNear,this.renderContext.pickZNear),i.uniform1f(r.pickZFar,this.renderContext.pickZFar)),r.pickInvisible&&i.uniform1i(r.pickInvisible,this.renderContext.pickInvisible?1:0),r.logDepthBufFC){var l=2/(Math.log(n.far+1)/Math.LN2);i.uniform1f(r.logDepthBufFC,l)}}var ve,pe=/*#__PURE__*/function(e){function t(t){return e.call(this,t)||this}u(t,e);var i=t.prototype;return i.getHash=function(){return this.renderContext.view.getSectionPlanesHash()+"-"+this.renderContext.view.getLightsHash()},i.buildVertexShader=function(){return this.vertHeader+"   \n        \n                uniform int                 renderPass;   \n            \n                uniform highp   mat4        projMatrix;\n                uniform highp   mat4        worldMatrix;\n                      \n                uniform mediump sampler2D   viewMatrices;\n                           \n                uniform mediump usampler2D  eachPrimitiveMesh;\n                uniform lowp    usampler2D  eachMeshAttributes;\n                \n                uniform mediump sampler2D   eachMeshMatrices;\n                uniform mediump usampler2D  positions;\n                uniform highp   usampler2D  indices;\n                \n                uniform  float  logDepthBufFC;\n                 \n                out vec4        worldPosition;\n                flat out uint   meshFlags2r;                       \n                flat out uvec4  meshColor;\n                out float       fragDepth;\n                \n                bool isPerspectiveMatrix(mat4 m) {\n                    return (m[2][3] == - 1.0);\n                }\n                \n                out float isPerspective;\n                    \n                void main(void) {\n                                   \n                    int triangleIndex      = gl_VertexID / 3;\n                    \n                    int hPackedMeshIdIndex = (triangleIndex >> 3) & 1023;\n                    int vPackedMeshIdIndex = (triangleIndex >> 3) >> 10;\n                    \n                    int meshIndex          = int(texelFetch(eachPrimitiveMesh, ivec2(hPackedMeshIdIndex, vPackedMeshIdIndex), 0).r);                   \n                    uvec4 meshFlags        = texelFetch (eachMeshAttributes, ivec2(2, meshIndex), 0);\n\n                    if (int(meshFlags.x) != renderPass) {\n                        gl_Position = vec4(3.0, 3.0, 3.0, 1.0);\n                        return;\n                    } \n                 \n                    uvec4 meshFlags2 = texelFetch (eachMeshAttributes, ivec2(3, meshIndex), 0);\n\n                    ivec4 packedVertexBase = ivec4(texelFetch (eachMeshAttributes, ivec2(4, meshIndex), 0));\n                    ivec4 packedIndexBaseOffset = ivec4(texelFetch (eachMeshAttributes, ivec2(5, meshIndex), 0));\n                    int indexBaseOffset =   (packedIndexBaseOffset.r << 24) + \n                                            (packedIndexBaseOffset.g << 16) + \n                                            (packedIndexBaseOffset.b << 8) + \n                                            (packedIndexBaseOffset.a);\n\n                    int hIndex = (triangleIndex - indexBaseOffset) & 1023;\n                    int vIndex = (triangleIndex - indexBaseOffset) >> 10;\n\n                    ivec3 vertexIndices = ivec3(texelFetch(indices, ivec2(hIndex, vIndex), 0));\n                    ivec3 uniqueVertexIndexes = vertexIndices + (packedVertexBase.r << 24) + (packedVertexBase.g << 16) + (packedVertexBase.b << 8) + packedVertexBase.a;\n\n                    ivec3 indexPositionH = uniqueVertexIndexes & 1023;\n                    ivec3 indexPositionV = uniqueVertexIndexes >> 10;\n\n                    mat4 positionsDecompressMatrix = mat4 (\n                        texelFetch (eachMeshMatrices, ivec2(0, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(1, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(2, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(3, meshIndex), 0));\n                        \n                    mat4 meshMatrix = mat4 (\n                        texelFetch (eachMeshMatrices, ivec2(4, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(5, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(6, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(7, meshIndex), 0));\n\n                    ivec4 packedViewMatrixIndex = ivec4(texelFetch (eachMeshAttributes, ivec2(7, meshIndex), 0));\n                    int viewMatrixIndex = \n                            (packedViewMatrixIndex.r << 24) + \n                            (packedViewMatrixIndex.g << 16) + \n                            (packedViewMatrixIndex.b << 8) + \n                            (packedViewMatrixIndex.a);\n                   \n                    mat4 viewMatrix = mat4 (\n                        texelFetch (viewMatrices, ivec2(4, viewMatrixIndex), 0), \n                        texelFetch (viewMatrices, ivec2(5, viewMatrixIndex), 0), \n                        texelFetch (viewMatrices, ivec2(6, viewMatrixIndex), 0), \n                        texelFetch (viewMatrices, ivec2(7, viewMatrixIndex), 0));\n\n                    vec3 _positions[3];\n                   \n                    _positions[0] = vec3(texelFetch(positions, ivec2(indexPositionH.r, indexPositionV.r), 0));\n                    _positions[1] = vec3(texelFetch(positions, ivec2(indexPositionH.g, indexPositionV.g), 0));\n                    _positions[2] = vec3(texelFetch(positions, ivec2(indexPositionH.b, indexPositionV.b), 0));\n  \n                    vec3  position       = _positions[gl_VertexID % 3];\n                   \n                    vec4  _worldPosition = worldMatrix * ((meshMatrix * positionsDecompressMatrix) * vec4(position, 1.0)); \n                    vec4  viewPosition   = viewMatrix * _worldPosition;                   \n                    vec4  clipPosition   = projMatrix * viewPosition;\n\n                    meshFlags2r     = meshFlags2.r;                     \n                    meshColor       = texelFetch (eachMeshAttributes, ivec2(0, meshIndex), 0);                          \n                    fragDepth       = 1.0 + clipPosition.w;\n                    isPerspective   = float (isPerspectiveMatrix(projMatrix));\n                    worldPosition   = _worldPosition;                                               \n                    \n                    gl_Position     = clipPosition;\n                }"},i.buildFragmentShader=function(){return this.fragHeader+"                        \n    \n             flat   in uvec4    meshColor;\n                in float        fragDepth;\n                in float        isPerspective;    \n                flat in uint    meshFlags2r;        \n                uniform float   logDepthBufFC;                        \n    \n                "+this.fragSectionPlaneDefs+"                  \n                "+this.fragLightSourceUniforms+'                                                             \n    \n                out vec4 outColor;        \n    \n                void main(void) {         \n                \n                // src.push("float lambertian = 1.0;");\n                // \n                //  vec3 xTangent = dFdx( vViewPosition.xyz );\n                //  vec3 yTangent = dFdy( vViewPosition.xyz );\n                // \n                //  vec3 viewNormal = normalize( cross( xTangent, yTangent ) );        \n    \n                    '+this.fragSectionPlanesSlice+"                                    \n                    "+this.fragFlatShading+"     \n          \n                    outColor = vec4(meshColor);                   \n                    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( fragDepth ) * logDepthBufFC * 0.5;                        \n                }"},t}(ce),ge=/*#__PURE__*/g("built"),me=/*#__PURE__*/function(){function e(){this.positions=void 0,this.indices_8Bits=void 0,this.indices_16Bits=void 0,this.indices_32Bits=void 0,this.edgeIndices_8Bits=void 0,this.edgeIndices_16Bits=void 0,this.edgeIndices_32Bits=void 0,this.indices=void 0,this.edgeIndices=void 0,this.eachMeshAttributes=void 0,this.eachMeshMatrices=void 0,this.eachEdgeOffset=void 0,this.eachPrimitiveMesh_8Bits=void 0,this.eachPrimitiveMesh_16Bits=void 0,this.eachPrimitiveMesh_32Bits=void 0,this.eachPrimitiveMesh=void 0,this.eachEdgeMesh_8Bits=void 0,this.eachEdgeMesh_16Bits=void 0,this.eachEdgeMesh_32Bits=void 0,this.eachEdgeMesh=void 0,Object.defineProperty(this,ge,{writable:!0,value:void 0}),this.positions=null,this.indices_8Bits=null,this.indices_16Bits=null,this.indices_32Bits=null,this.edgeIndices_8Bits=null,this.edgeIndices_16Bits=null,this.edgeIndices_32Bits=null,this.eachMeshAttributes=null,this.eachMeshMatrices=null,this.eachPrimitiveMesh_8Bits=null,this.eachPrimitiveMesh_16Bits=null,this.eachPrimitiveMesh_32Bits=null,this.eachEdgeMesh_8Bits=null,this.eachEdgeMesh_16Bits=null,this.eachEdgeMesh_32Bits=null,this.eachEdgeOffset=null,m(this,ge)[ge]=!1}var t=e.prototype;return t.build=function(){this.indices={8:this.indices_8Bits,16:this.indices_16Bits,32:this.indices_32Bits},this.eachPrimitiveMesh={8:this.eachPrimitiveMesh_8Bits,16:this.eachPrimitiveMesh_16Bits,32:this.eachPrimitiveMesh_32Bits},this.edgeIndices={8:this.edgeIndices_8Bits,16:this.edgeIndices_16Bits,32:this.edgeIndices_32Bits},this.eachEdgeMesh={8:this.eachEdgeMesh_8Bits,16:this.eachEdgeMesh_16Bits,32:this.eachEdgeMesh_32Bits},m(this,ge)[ge]=!0},t.destroy=function(){this.positions&&this.positions.destroy(),this.indices_8Bits&&this.indices_8Bits.destroy(),this.indices_16Bits&&this.indices_16Bits.destroy(),this.indices_32Bits&&this.indices_32Bits.destroy(),this.edgeIndices_8Bits&&this.edgeIndices_8Bits.destroy(),this.edgeIndices_16Bits&&this.edgeIndices_16Bits.destroy(),this.edgeIndices_32Bits&&this.edgeIndices_32Bits.destroy(),this.eachMeshMatrices&&this.eachMeshMatrices.destroy(),this.eachMeshAttributes&&this.eachMeshAttributes.destroy(),this.eachEdgeOffset&&this.eachEdgeOffset.destroy(),this.eachPrimitiveMesh_8Bits&&this.eachPrimitiveMesh_8Bits.destroy(),this.eachPrimitiveMesh_16Bits&&this.eachPrimitiveMesh_16Bits.destroy(),this.eachPrimitiveMesh_32Bits&&this.eachPrimitiveMesh_32Bits.destroy(),this.eachEdgeMesh_8Bits&&this.eachEdgeMesh_8Bits.destroy(),this.eachEdgeMesh_16Bits&&this.eachEdgeMesh_16Bits.destroy(),this.eachEdgeMesh_32Bits&&this.eachEdgeMesh_32Bits.destroy()},e}(),Ee=/*#__PURE__*/function(){function e(){this.numMeshes=void 0,this.numVisible=void 0,this.numTransparent=void 0,this.numEdges=void 0,this.numXRayed=void 0,this.numSelected=void 0,this.numHighlighted=void 0,this.numClippable=void 0,this.numPickable=void 0,this.numCulled=void 0,this.reset()}return e.prototype.reset=function(){this.numMeshes=0,this.numVisible=0,this.numTransparent=0,this.numEdges=0,this.numXRayed=0,this.numSelected=0,this.numHighlighted=0,this.numClippable=0,this.numPickable=0,this.numCulled=0},e}(),Te={VISIBLE:1,CULLED:4,PICKABLE:8,CLIPPABLE:16,COLLIDABLE:32,CAST_SHADOW:64,RECEIVE_SHADOW:128,XRAYED:256,HIGHLIGHTED:512,SELECTED:1024,EDGES:2048,BACKFACES:4096,TRANSPARENT:8192};function be(e){return function(t){return ye(e,t,[].slice.call(arguments,1))}}function xe(e,t){return be(Pe(e,t).get)}for(var ye=Reflect.apply,we=Reflect.construct,_e=Reflect.defineProperty,Me=Reflect.get,Pe=Reflect.getOwnPropertyDescriptor,Ce=Reflect.getPrototypeOf,Ie=Reflect.has,Se=Reflect.ownKeys,Re=Reflect.set,De=Reflect.setPrototypeOf,Oe=Proxy,Le=Number,Be=Le.isFinite,Ae=Le.isNaN,Ue=Symbol.iterator,Fe=Symbol.species,je=Symbol.toStringTag,Ge=Symbol.for,ke=Object,Ne=ke.create,He=ke.defineProperty,Xe=ke.freeze,Ve=ke.is,We=ke.prototype,ze=be(We.isPrototypeOf),qe=ke.hasOwn||be(We.hasOwnProperty),Ye=Array,Ke=Ye.isArray,Ze=Ye.prototype,Qe=be(Ze.join),$e=be(Ze.push),Je=be(Ze.toLocaleString),et=Ze[Ue],tt=be(et),it=Math.trunc,rt=ArrayBuffer,nt=rt.isView,st=be(rt.prototype.slice),ot=xe(rt.prototype,"byteLength"),at="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:null,ht=at&&xe(at.prototype,"byteLength"),ct=Ce(Uint8Array),ut=ct.from,lt=ct.prototype,dt=lt[Ue],ft=be(lt.keys),vt=be(lt.values),pt=be(lt.entries),gt=be(lt.set),mt=be(lt.reverse),Et=be(lt.fill),Tt=be(lt.copyWithin),bt=be(lt.sort),xt=be(lt.slice),yt=be(lt.subarray),wt=xe(lt,"buffer"),_t=xe(lt,"byteOffset"),Mt=xe(lt,"length"),Pt=xe(lt,je),Ct=Uint16Array,It=function(){return ye(ut,Ct,[].slice.call(arguments))},St=Uint32Array,Rt=Float32Array,Dt=Ce([][Ue]()),Ot=be(Dt.next),Lt=be(a().mark(function e(){return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})().next),Bt=Ce(Dt),At=TypeError,Ut=RangeError,Ft=Set,jt=Ft.prototype,Gt=be(jt.add),kt=be(jt.has),Nt=WeakMap,Ht=Nt.prototype,Xt=be(Ht.get),Vt=be(Ht.has),Wt=be(Ht.set),zt=new rt(4),qt=new Rt(zt),Yt=new St(zt),Kt=new St(512),Zt=new St(512),Qt=0;Qt<256;++Qt){var $t=Qt-127;$t<-27?(Kt[Qt]=0,Kt[256|Qt]=32768,Zt[Qt]=24,Zt[256|Qt]=24):$t<-14?(Kt[Qt]=1024>>-$t-14,Kt[256|Qt]=1024>>-$t-14|32768,Zt[Qt]=-$t-1,Zt[256|Qt]=-$t-1):$t<=15?(Kt[Qt]=$t+15<<10,Kt[256|Qt]=$t+15<<10|32768,Zt[Qt]=13,Zt[256|Qt]=13):$t<128?(Kt[Qt]=31744,Kt[256|Qt]=64512,Zt[Qt]=24,Zt[256|Qt]=24):(Kt[Qt]=31744,Kt[256|Qt]=64512,Zt[Qt]=13,Zt[256|Qt]=13)}function Jt(e){qt[0]=e;var t=Yt[0],i=t>>23&511;return Kt[i]+((8388607&t)>>Zt[i])}var ei=new St(2048),ti=new St(64),ii=new St(64);ei[0]=0;for(var ri=1;ri<1024;++ri){for(var ni=ri<<13,si=0;0==(8388608&ni);)si-=8388608,ni<<=1;ei[ri]=(ni&=-8388609)|(si+=947912704)}for(var oi=1024;oi<2048;++oi)ei[oi]=939524096+(oi-1024<<13);ti[0]=0;for(var ai=1;ai<31;++ai)ti[ai]=ai<<23;ti[31]=1199570944,ti[32]=2147483648;for(var hi=33;hi<63;++hi)ti[hi]=2147483648+(hi-32<<23);ti[63]=3347054592,ii[0]=0;for(var ci=1;ci<64;++ci)ii[ci]=32===ci?0:1024;function ui(e){var t=e>>10;return Yt[0]=ei[ii[t]+(1023&e)]+ti[t],qt[0]}function li(e){var t;if(e[Ue]===et)return e;var i=tt(e);return Ne(null,((t={next:{value:function(){return Ot(i)}}})[Ue]={value:function(){return this}},t))}var di=new Nt,fi=Ne(Bt,(ve={next:{value:function(){var e=Xt(di,this);return Lt(e)},writable:!0,configurable:!0}},ve[je]={value:"Array Iterator",configurable:!0},ve));function vi(e){var t=Ne(fi);return Wt(di,t,e),t}function pi(e){return null!==e&&"object"==typeof e||"function"==typeof e}function gi(e){return null!==e&&"object"==typeof e}function mi(e){return void 0!==Pt(e)}function Ei(e){var t=Pt(e);return"BigInt64Array"===t||"BigUint64Array"===t}function Ti(e){if(null===at)return!1;try{return ht(e),!0}catch(e){return!1}}function bi(e){return!!Ke(e)&&(e[Ue]===et||"Array Iterator"===e[Ue]()[je])}function xi(e){if("string"!=typeof e)return!1;var t=Le(e);return e===t+""&&!!Be(t)&&t===it(t)}var yi=Le.MAX_SAFE_INTEGER;function wi(e){if("bigint"==typeof e)throw At("Cannot convert a BigInt value to a number");var t=Le(e);return Ae(t)||0===t?0:it(t)}function _i(e){var t=wi(e);return t<0?0:t<yi?t:yi}function Mi(e,t){if(!pi(e))throw At("This is not an object");var i=e.constructor;if(void 0===i)return t;if(!pi(i))throw At("The constructor property value is not an object");var r=i[Fe];return null==r?t:r}function Pi(e){if(Ti(e))return!1;try{return st(e,0,0),!1}catch(e){}return!0}function Ci(e,t){var i=Ae(e),r=Ae(t);if(i&&r)return 0;if(i)return 1;if(r)return-1;if(e<t)return-1;if(e>t)return 1;if(0===e&&0===t){var n=Ve(e,0),s=Ve(t,0);if(!n&&s)return-1;if(n&&!s)return 1}return 0}var Ii=Ge("__Float16Array__"),Si=new Nt;function Ri(e){return Vt(Si,e)||!nt(e)&&function(e){if(!gi(e))return!1;var t=Ce(e);if(!gi(t))return!1;var i=t.constructor;if(void 0===i)return!1;if(!pi(i))throw At("The constructor property value is not an object");return Ie(i,Ii)}(e)}function Di(e){if(!Ri(e))throw At("This is not a Float16Array object")}function Oi(e,t){var i=Ri(e),r=mi(e);if(!i&&!r)throw At("Species constructor didn't return TypedArray object");if("number"==typeof t){var n;if(i){var s=Li(e);n=Mt(s)}else n=Mt(e);if(n<t)throw At("Derived constructor created TypedArray object which was too small length")}if(Ei(e))throw At("Cannot mix BigInt and other types, use explicit conversions")}function Li(e){var t=Xt(Si,e);if(void 0!==t){if(Pi(wt(t)))throw At("Attempting to access detached ArrayBuffer");return t}var i=e.buffer;if(Pi(i))throw At("Attempting to access detached ArrayBuffer");var r=we(Ni,[i,e.byteOffset,e.length],e.constructor);return Xt(Si,r)}function Bi(e){for(var t=Mt(e),i=[],r=0;r<t;++r)i[r]=ui(e[r]);return i}for(var Ai,Ui=new Ft,Fi=v(Se(lt));!(Ai=Fi()).done;){var ji=Ai.value;if(ji!==je){var Gi=Pe(lt,ji);qe(Gi,"get")&&Gt(Ui,ji)}}var ki=Xe({get:function(e,t,i){return xi(t)&&qe(e,t)?ui(Me(e,t)):kt(Ui,t)&&ze(lt,e)?Me(e,t):Me(e,t,i)},set:function(e,t,i,r){return xi(t)&&qe(e,t)?Re(e,t,Jt(i)):Re(e,t,i,r)},getOwnPropertyDescriptor:function(e,t){if(xi(t)&&qe(e,t)){var i=Pe(e,t);return i.value=ui(i.value),i}return Pe(e,t)},defineProperty:function(e,t,i){return xi(t)&&qe(e,t)&&qe(i,"value")?(i.value=Jt(i.value),_e(e,t,i)):_e(e,t,i)}}),Ni=/*#__PURE__*/function(){function e(t,i,r){var n;if(Ri(t))n=we(Ct,[Li(t)],this instanceof e?this.constructor:void 0);else if(pi(t)&&!function(e){try{return ot(e),!0}catch(e){return!1}}(t)){var s,o;if(mi(t)){s=t,o=Mt(t);var a=wt(t),h=Ti(a)?rt:Mi(a,rt);if(Pi(a))throw At("Attempting to access detached ArrayBuffer");if(Ei(t))throw At("Cannot mix BigInt and other types, use explicit conversions");var c=new h(2*o);n=we(Ct,[c],this instanceof e?this.constructor:void 0)}else{var u=t[Ue];if(null!=u&&"function"!=typeof u)throw At("@@iterator property is not callable");null!=u?bi(t)?(s=t,o=t.length):o=(s=[].concat(t)).length:o=_i((s=t).length),n=we(Ct,[o],this instanceof e?this.constructor:void 0)}for(var l=0;l<o;++l)n[l]=Jt(s[l])}else n=we(Ct,arguments,this instanceof e?this.constructor:void 0);var d=new Oe(n,ki);return Wt(Si,d,n),d}e.from=function(t){var i,r,n=this,s=[].slice.call(arguments,1),o=this;if(!Ie(o,Ii))throw At("This constructor is not a subclass of Float16Array");if(o===e){if(Ri(t)&&0===s.length){var a=Li(t),h=new Ct(wt(a),_t(a),Mt(a));return new e(wt(xt(h)))}if(0===s.length)return new e(wt(It(t,Jt)));var c=s[0];return new e(wt(It(t,function(e){return Jt(ye(c,n,[e].concat(li([].slice.call(arguments,1)))))},s[1])))}var u,l=t[Ue];if(null!=l&&"function"!=typeof l)throw At("@@iterator property is not callable");if(null!=l)bi(t)?(i=t,r=t.length):!mi(u=t)||u[Ue]!==dt&&"Array Iterator"!==u[Ue]()[je]?r=(i=[].concat(t)).length:(i=t,r=Mt(t));else{if(null==t)throw At("Cannot convert undefined or null to object");r=_i((i=ke(t)).length)}var d=new o(r);if(0===s.length)for(var f=0;f<r;++f)d[f]=i[f];else for(var v=s[0],p=s[1],g=0;g<r;++g)d[g]=ye(v,p,[i[g],g]);return d},e.of=function(){var t=[].slice.call(arguments),i=this;if(!Ie(i,Ii))throw At("This constructor is not a subclass of Float16Array");var r=t.length;if(i===e){for(var n=new e(r),s=Li(n),o=0;o<r;++o)s[o]=Jt(t[o]);return n}for(var a=new i(r),h=0;h<r;++h)a[h]=t[h];return a};var t=e.prototype;return t.keys=function(){Di(this);var e=Li(this);return ft(e)},t.values=function(){Di(this);var e=Li(this);return vi(/*#__PURE__*/a().mark(function t(){var i,r,n;return a().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:i=v(vt(e));case 1:if((r=i()).done){t.next=7;break}return n=r.value,t.next=5,ui(n);case 5:t.next=1;break;case 7:case"end":return t.stop()}},t)})())},t.entries=function(){Di(this);var e=Li(this);return vi(/*#__PURE__*/a().mark(function t(){var i,r,n,s,o;return a().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:i=v(pt(e));case 1:if((r=i()).done){t.next=7;break}return s=(n=r.value)[0],o=n[1],t.next=5,[s,ui(o)];case 5:t.next=1;break;case 7:case"end":return t.stop()}},t)})())},t.at=function(e){Di(this);var t=Li(this),i=Mt(t),r=wi(e),n=r>=0?r:i+r;if(!(n<0||n>=i))return ui(t[n])},t.map=function(t){Di(this);var i=Li(this),r=Mt(i),n=[].slice.call(arguments,1)[0],s=Mi(i,e);if(s===e){for(var o=new e(r),a=Li(o),h=0;h<r;++h){var c=ui(i[h]);a[h]=Jt(ye(t,n,[c,h,this]))}return o}var u=new s(r);Oi(u,r);for(var l=0;l<r;++l){var d=ui(i[l]);u[l]=ye(t,n,[d,l,this])}return u},t.filter=function(t){Di(this);for(var i=Li(this),r=Mt(i),n=[].slice.call(arguments,1)[0],s=[],o=0;o<r;++o){var a=ui(i[o]);ye(t,n,[a,o,this])&&$e(s,a)}var h=new(Mi(i,e))(s);return Oi(h),h},t.reduce=function(e){var t=[].slice.call(arguments,1);Di(this);var i,r,n=Li(this),s=Mt(n);if(0===s&&0===t.length)throw At("Reduce of empty array with no initial value");0===t.length?(i=ui(n[0]),r=1):(i=t[0],r=0);for(var o=r;o<s;++o)i=e(i,ui(n[o]),o,this);return i},t.reduceRight=function(e){var t=[].slice.call(arguments,1);Di(this);var i,r,n=Li(this),s=Mt(n);if(0===s&&0===t.length)throw At("Reduce of empty array with no initial value");0===t.length?(i=ui(n[s-1]),r=s-2):(i=t[0],r=s-1);for(var o=r;o>=0;--o)i=e(i,ui(n[o]),o,this);return i},t.forEach=function(e){Di(this);for(var t=Li(this),i=Mt(t),r=[].slice.call(arguments,1)[0],n=0;n<i;++n)ye(e,r,[ui(t[n]),n,this])},t.find=function(e){Di(this);for(var t=Li(this),i=Mt(t),r=[].slice.call(arguments,1)[0],n=0;n<i;++n){var s=ui(t[n]);if(ye(e,r,[s,n,this]))return s}},t.findIndex=function(e){Di(this);for(var t=Li(this),i=Mt(t),r=[].slice.call(arguments,1)[0],n=0;n<i;++n){var s=ui(t[n]);if(ye(e,r,[s,n,this]))return n}return-1},t.findLast=function(e){Di(this);for(var t=Li(this),i=Mt(t),r=[].slice.call(arguments,1)[0],n=i-1;n>=0;--n){var s=ui(t[n]);if(ye(e,r,[s,n,this]))return s}},t.findLastIndex=function(e){Di(this);for(var t=Li(this),i=Mt(t),r=[].slice.call(arguments,1)[0],n=i-1;n>=0;--n){var s=ui(t[n]);if(ye(e,r,[s,n,this]))return n}return-1},t.every=function(e){Di(this);for(var t=Li(this),i=Mt(t),r=[].slice.call(arguments,1)[0],n=0;n<i;++n)if(!ye(e,r,[ui(t[n]),n,this]))return!1;return!0},t.some=function(e){Di(this);for(var t=Li(this),i=Mt(t),r=[].slice.call(arguments,1)[0],n=0;n<i;++n)if(ye(e,r,[ui(t[n]),n,this]))return!0;return!1},t.set=function(e){Di(this);var t=Li(this),i=wi([].slice.call(arguments,1)[0]);if(i<0)throw Ut("Offset is out of bounds");if(null==e)throw At("Cannot convert undefined or null to object");if(Ei(e))throw At("Cannot mix BigInt and other types, use explicit conversions");if(Ri(e))return gt(Li(this),Li(e),i);if(mi(e)&&Pi(wt(e)))throw At("Attempting to access detached ArrayBuffer");var r=Mt(t),n=ke(e),s=_i(n.length);if(i===1/0||s+i>r)throw Ut("Offset is out of bounds");for(var o=0;o<s;++o)t[o+i]=Jt(n[o])},t.reverse=function(){Di(this);var e=Li(this);return mt(e),this},t.fill=function(e){Di(this);var t=Li(this);return Et.apply(void 0,[t,Jt(e)].concat(li([].slice.call(arguments,1)))),this},t.copyWithin=function(e,t){Di(this);var i=Li(this);return Tt.apply(void 0,[i,e,t].concat(li([].slice.call(arguments,2)))),this},t.sort=function(){var e=[].slice.call(arguments);Di(this);var t=Li(this),i=void 0!==e[0]?e[0]:Ci;return bt(t,function(e,t){return i(ui(e),ui(t))}),this},t.slice=function(){var t=[].slice.call(arguments);Di(this);var i=Li(this),r=Mi(i,e);if(r===e){var n=new Ct(wt(i),_t(i),Mt(i));return new e(wt(xt.apply(void 0,[n].concat(li(t)))))}var s,o,a=Mt(i),h=wi(t[0]),c=void 0===t[1]?a:wi(t[1]),u=(o=c===-1/0?0:c<0?a+c>0?a+c:0:a<c?a:c)-(s=h===-1/0?0:h<0?a+h>0?a+h:0:a<h?a:h)>0?o-s:0,l=new r(u);if(Oi(l,u),0===u)return l;if(Pi(wt(i)))throw At("Attempting to access detached ArrayBuffer");for(var d=0;s<o;)l[d]=ui(i[s]),++s,++d;return l},t.subarray=function(){Di(this);var t=Li(this),i=Mi(t,e),r=new Ct(wt(t),_t(t),Mt(t)),n=yt.apply(void 0,[r].concat(li([].slice.call(arguments)))),s=new i(wt(n),_t(n),Mt(n));return Oi(s),s},t.indexOf=function(e){Di(this);var t=Li(this),i=Mt(t),r=wi([].slice.call(arguments,1)[0]);if(r===1/0)return-1;r<0&&(r+=i)<0&&(r=0);for(var n=r;n<i;++n)if(qe(t,n)&&ui(t[n])===e)return n;return-1},t.lastIndexOf=function(e){var t=[].slice.call(arguments,1);Di(this);var i=Li(this),r=Mt(i),n=t.length>=1?wi(t[0]):r-1;if(n===-1/0)return-1;n>=0?n=n<r-1?n:r-1:n+=r;for(var s=n;s>=0;--s)if(qe(i,s)&&ui(i[s])===e)return s;return-1},t.includes=function(e){Di(this);var t=Li(this),i=Mt(t),r=wi([].slice.call(arguments,1)[0]);if(r===1/0)return!1;r<0&&(r+=i)<0&&(r=0);for(var n=Ae(e),s=r;s<i;++s){var o=ui(t[s]);if(n&&Ae(o))return!0;if(o===e)return!0}return!1},t.join=function(){Di(this);var e=Bi(Li(this));return Qe.apply(void 0,[e].concat(li([].slice.call(arguments))))},t.toLocaleString=function(){Di(this);var e=Bi(Li(this));return Je.apply(void 0,[e].concat(li([].slice.call(arguments))))},c(e,[{key:je,get:function(){if(Ri(this))return"Float16Array"}}]),e}();He(Ni,"BYTES_PER_ELEMENT",{value:2}),He(Ni,Ii,{}),De(Ni,ct);var Hi=Ni.prototype;He(Hi,"BYTES_PER_ELEMENT",{value:2}),He(Hi,Ue,{value:Hi.values,writable:!0,configurable:!0}),De(Hi,lt);var Xi=new i.GLDataTexture({textureWidth:0,textureHeight:0});function Vi(e){e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}var Wi=function(){this.positionsDecompressMatrices=void 0,this.positionsCompressed=void 0,this.indices_8Bits=void 0,this.indices_16Bits=void 0,this.indices_32Bits=void 0,this.edgeIndices_8Bits=void 0,this.edgeIndices_16Bits=void 0,this.edgeIndices_32Bits=void 0,this.eachPrimitiveMesh_8Bits=void 0,this.eachPrimitiveMesh_16Bits=void 0,this.eachPrimitiveMesh_32Bits=void 0,this.eachEdgeMesh_8Bits=void 0,this.eachEdgeMesh_16Bits=void 0,this.eachEdgeMesh_32Bits=void 0,this.eachMeshVertexPortionBase=void 0,this.eachMeshVertexPortionOffset=void 0,this.eachMeshEdgeIndicesOffset=void 0,this.eachMeshColor=void 0,this.eachMeshPickColor=void 0,this.eachMeshMatrices=void 0,this.eachMeshNormalMatrix=void 0,this.eachMeshPositionsDecompressMatrix=void 0,this.eachMeshFlags1=void 0,this.eachMeshFlags2=void 0,this.eachEdgeOffset=void 0,this.eachMeshParts=void 0,this.positionsDecompressMatrices=[],this.positionsCompressed=[],this.indices_8Bits=[],this.indices_16Bits=[],this.indices_32Bits=[],this.edgeIndices_8Bits=[],this.edgeIndices_16Bits=[],this.edgeIndices_32Bits=[],this.eachMeshVertexPortionBase=[],this.eachMeshVertexPortionOffset=[],this.eachMeshEdgeIndicesOffset=[],this.eachMeshColor=[],this.eachMeshPickColor=[],this.eachMeshMatrices=[],this.eachMeshNormalMatrix=[],this.eachMeshPositionsDecompressMatrix=[],this.eachMeshFlags1=[],this.eachMeshFlags2=[],this.eachPrimitiveMesh_32Bits=[],this.eachPrimitiveMesh_16Bits=[],this.eachPrimitiveMesh_8Bits=[],this.eachEdgeMesh_32Bits=[],this.eachEdgeMesh_16Bits=[],this.eachEdgeMesh_8Bits=[],this.eachEdgeOffset=[],this.eachMeshParts=[]},zi=8,qi=e.identityMat4(),Yi=e.createVec4([0,0,0,1]),Ki=e.createVec4([0,0,0,1]);e.createVec4([0,0,0,1]);var Zi=new Uint8Array(4),Qi=new Float32Array(3),$i=/*#__PURE__*/g("gl"),Ji=/*#__PURE__*/g("view"),er=/*#__PURE__*/g("dataTextureBuffer"),tr=/*#__PURE__*/g("geometryHandles"),ir=/*#__PURE__*/g("meshPartHandles"),rr=/*#__PURE__*/g("numMeshParts"),nr=/*#__PURE__*/g("deferredSetFlagsActive"),sr=/*#__PURE__*/g("deferredSetFlagsDirty"),or=/*#__PURE__*/g("built"),ar=/*#__PURE__*/g("createGeometryBucket"),hr=/*#__PURE__*/g("createMeshPart"),cr=/*#__PURE__*/g("setMeshFlags"),ur=/*#__PURE__*/g("setMeshFlags2"),lr=/*#__PURE__*/function(){function r(e,t){Object.defineProperty(this,ur,{value:pr}),Object.defineProperty(this,cr,{value:vr}),Object.defineProperty(this,hr,{value:fr}),Object.defineProperty(this,ar,{value:dr}),this.rendererModel=void 0,this.layerIndex=void 0,this.meshCounts=void 0,this.renderState=void 0,Object.defineProperty(this,$i,{writable:!0,value:void 0}),Object.defineProperty(this,Ji,{writable:!0,value:void 0}),Object.defineProperty(this,er,{writable:!0,value:void 0}),Object.defineProperty(this,tr,{writable:!0,value:void 0}),Object.defineProperty(this,ir,{writable:!0,value:void 0}),Object.defineProperty(this,rr,{writable:!0,value:void 0}),Object.defineProperty(this,nr,{writable:!0,value:void 0}),Object.defineProperty(this,sr,{writable:!0,value:void 0}),Object.defineProperty(this,or,{writable:!0,value:void 0}),this.meshCounts=new Ee,this.layerIndex=e.layerIndex,this.rendererModel=e.rendererModel,this.renderState={primitive:e.primitive,dataTextureSet:new me,numIndices8Bits:0,numIndices16Bits:0,numIndices32Bits:0,numEdgeIndices8Bits:0,numEdgeIndices16Bits:0,numEdgeIndices32Bits:0,numVertices:0},m(this,$i)[$i]=e.gl,m(this,Ji)[Ji]=e.view,m(this,er)[er]=new Wi,m(this,rr)[rr]=0,m(this,tr)[tr]={},m(this,ir)[ir]=[],m(this,or)[or]=!1,this.beginDeferredFlags()}var n=r.prototype;return n.canCreateMesh=function(e){if(m(this,or)[or])throw"Already built";var i=this.renderState,r=e.geometryBuckets.length;if(m(this,rr)[rr]+r>4096)return!1;for(var n=0,s=0,o=0;o<r;o++){var a=e.geometryBuckets[o];n+=a.positionsCompressed.length,a.indices&&(s+=a.indices.length)}return i.numVertices+n/(e.primitive===t.PointsPrimitive?1:e.primitive==t.LinesPrimitive?2:3)<=2097152&&s/3+s<=2097152},n.hasGeometry=function(e){return m(this,tr)[tr][e]},n.createGeometryCompressed=function(e){if(m(this,or)[or])throw"Already built";for(var t=[],i=0,r=e.geometryBuckets.length;i<r;i++)t.push(m(this,ar)[ar](e.geometryBuckets[i]));m(this,tr)[tr][e.id]={id:e.id,aabb:e.aabb,positionsDecompressMatrix:e.positionsDecompressMatrix,geometryBucketHandles:t}},n.createMesh=function(t){var i=this;if(m(this,or)[or])throw new Error("Already built");var r=this.meshCounts.numMeshes;if(!t.geometryId)throw new Error("geometryId expected");var n=m(this,tr)[tr][t.geometryId];if(!n)throw new Error("Geometry not found");n.geometryBucketHandles.forEach(function(e){m(i,hr)[hr](t,n,e)});for(var s=o.collapseAABB3(),a=o.AABB3ToOBB3(n.aabb),h=0,c=a.length;h<c;h+=4)Yi[0]=a[h+0],Yi[1]=a[h+1],Yi[2]=a[h+2],t.matrix?(e.transformPoint4(t.matrix,Yi,Ki),o.expandAABB3Point3(s,Ki)):o.expandAABB3Point3(s,Ki);return this.meshCounts.numMeshes++,r},n.build=function(){if(m(this,or)[or])throw new Error("Already built");var e=m(this,$i)[$i],t=m(this,er)[er],r=this.renderState.dataTextureSet;r.positions=function(e,t){var r=1024,n=Math.ceil(t.length/3/r);if(0==n)throw"texture height == 0";var s=new Uint16Array(r*n*3);s.fill(0),s.set(t,0);var o=e.createTexture();return e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGB16UI,r,n),e.texSubImage2D(e.TEXTURE_2D,0,0,0,r,n,e.RGB_INTEGER,e.UNSIGNED_SHORT,s,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new i.GLDataTexture({gl:e,texture:o,textureWidth:r,textureHeight:n})}(e,t.positionsCompressed),r.indices_8Bits=function(e,t){if(0==t.length)return Xi;var r=1024,n=Math.ceil(t.length/3/r);if(0==n)throw"texture height == 0";var s=new Uint8Array(r*n*3);s.fill(0),s.set(t,0);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGB8UI,r,n),e.texSubImage2D(e.TEXTURE_2D,0,0,0,r,n,e.RGB_INTEGER,e.UNSIGNED_BYTE,s,0),Vi(e),e.bindTexture(e.TEXTURE_2D,null),new i.GLDataTexture({gl:e,texture:o,textureWidth:r,textureHeight:n})):Xi}(e,t.indices_8Bits),r.indices_16Bits=function(e,t){if(0==t.length)return Xi;var r=1024,n=Math.ceil(t.length/3/r);if(0==n)throw"texture height == 0";var s=new Uint16Array(r*n*3);s.fill(0),s.set(t,0);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGB16UI,r,n),e.texSubImage2D(e.TEXTURE_2D,0,0,0,r,n,e.RGB_INTEGER,e.UNSIGNED_SHORT,s,0),Vi(e),e.bindTexture(e.TEXTURE_2D,null),new i.GLDataTexture({gl:e,texture:o,textureWidth:r,textureHeight:n})):Xi}(e,t.indices_16Bits),r.indices_32Bits=function(e,t){if(0==t.length)return Xi;var r=1024,n=Math.ceil(t.length/3/r);if(0==n)throw"texture height == 0";var s=new Uint32Array(r*n*3);s.fill(0),s.set(t,0);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGB32UI,r,n),e.texSubImage2D(e.TEXTURE_2D,0,0,0,r,n,e.RGB_INTEGER,e.UNSIGNED_INT,s,0),Vi(e),e.bindTexture(e.TEXTURE_2D,null),new i.GLDataTexture({gl:e,texture:o,textureWidth:r,textureHeight:n})):Xi}(e,t.indices_32Bits),r.edgeIndices_8Bits=function(e,t){if(0==t.length)return Xi;var r=1024,n=Math.ceil(t.length/2/r);if(0==n)throw"texture height == 0";var s=new Uint8Array(r*n*2);s.fill(0),s.set(t,0);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RG8UI,r,n),e.texSubImage2D(e.TEXTURE_2D,0,0,0,r,n,e.RG_INTEGER,e.UNSIGNED_BYTE,s,0),Vi(e),e.bindTexture(e.TEXTURE_2D,null),new i.GLDataTexture({gl:e,texture:o,textureWidth:r,textureHeight:n})):Xi}(e,t.edgeIndices_8Bits),r.edgeIndices_16Bits=function(e,t){if(0==t.length)return Xi;var r=1024,n=Math.ceil(t.length/2/r);if(0==n)throw"texture height == 0";var s=new Uint16Array(r*n*2);s.fill(0),s.set(t,0);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RG16UI,r,n),e.texSubImage2D(e.TEXTURE_2D,0,0,0,r,n,e.RG_INTEGER,e.UNSIGNED_SHORT,s,0),Vi(e),e.bindTexture(e.TEXTURE_2D,null),new i.GLDataTexture({gl:e,texture:o,textureWidth:r,textureHeight:n})):Xi}(e,t.edgeIndices_16Bits),r.edgeIndices_32Bits=function(e,t){if(0==t.length)return Xi;var r=1024,n=Math.ceil(t.length/2/r);if(0==n)throw"texture height == 0";var s=new Uint32Array(r*n*2);s.fill(0),s.set(t,0);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RG32UI,r,n),e.texSubImage2D(e.TEXTURE_2D,0,0,0,r,n,e.RG_INTEGER,e.UNSIGNED_INT,s,0),Vi(e),e.bindTexture(e.TEXTURE_2D,null),new i.GLDataTexture({gl:e,texture:o,textureWidth:r,textureHeight:n})):Xi}(e,t.edgeIndices_32Bits),r.eachMeshAttributes=function(e,t,r,n,s,o){var a=t.length;if(0==a)throw"texture height == 0";for(var h=new Uint8Array(32*a),c=0;c<a;c++)h.set(t[c],28*c+0),h.set(r[c],28*c+4),h.set([0,0,0,0],28*c+8),h.set([0,0,0,0],28*c+12),h.set([n[c]>>24&255,n[c]>>16&255,n[c]>>8&255,255&n[c]],28*c+16),h.set([s[c]>>24&255,s[c]>>16&255,s[c]>>8&255,255&s[c]],28*c+20),h.set([o[c]>>24&255,o[c]>>16&255,o[c]>>8&255,255&o[c]],28*c+24);var u=e.createTexture();return u?(e.bindTexture(e.TEXTURE_2D,u),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA8UI,8,a),e.texSubImage2D(e.TEXTURE_2D,0,0,0,8,a,e.RGBA_INTEGER,e.UNSIGNED_BYTE,h,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new i.GLDataTexture({gl:e,texture:u,textureWidth:8,textureHeight:a,textureData:h})):Xi}(e,t.eachMeshColor,t.eachMeshPickColor,t.eachMeshVertexPortionBase,t.eachMeshVertexPortionOffset,t.eachMeshEdgeIndicesOffset),r.eachMeshMatrices=function(e,t,r){var n=t.length;if(0==n)throw"texture height == 0";for(var s=new Ni(48*n),o=0;o<t.length;o++)s.set(t[o],48*o),s.set(r[o],48*o+16);var a=e.createTexture();return a?(e.bindTexture(e.TEXTURE_2D,a),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA16F,12,n),e.texSubImage2D(e.TEXTURE_2D,0,0,0,12,n,e.RGBA,e.HALF_FLOAT,new Uint16Array(s.buffer),0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new i.GLDataTexture({gl:e,texture:a,textureWidth:12,textureHeight:n})):Xi}(e,t.eachMeshPositionsDecompressMatrix,t.eachMeshMatrices),r.eachEdgeOffset=function(e,t){var r=t.length;if(0==r)throw"texture height == 0";for(var n=new Float32Array(3*r),s=0;s<t.length;s++)n.set(t[s],3*s);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGB32F,1,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,1,r,e.RGB,e.FLOAT,n,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new i.GLDataTexture({gl:e,texture:o,textureWidth:1,textureHeight:r,textureData:n})):Xi}(e,t.eachEdgeOffset),r.build(),m(this,er)[er]=null,m(this,tr)[tr]={},m(this,ir)[ir]=[],m(this,or)[or]=!0},n.isEmpty=function(){return 0==this.meshCounts.numMeshes},n.initFlags=function(e,t,i){t&Te.VISIBLE&&this.meshCounts.numVisible++,t&Te.HIGHLIGHTED&&this.meshCounts.numHighlighted++,t&Te.XRAYED&&this.meshCounts.numXRayed++,t&Te.SELECTED&&this.meshCounts.numSelected++,t&Te.CLIPPABLE&&this.meshCounts.numClippable++,t&Te.EDGES&&this.meshCounts.numEdges++,t&Te.PICKABLE&&this.meshCounts.numPickable++,t&Te.CULLED&&this.meshCounts.numCulled++,i&&this.meshCounts.numTransparent++,m(this,cr)[cr](e,t,i),m(this,ur)[ur](e,t)},n.beginDeferredFlags=function(){m(this,nr)[nr]=!0},n.commitDeferredFlags=function(){if(m(this,nr)[nr]=!1,m(this,sr)[sr]){m(this,sr)[sr]=!1;var e=m(this,$i)[$i],t=this.renderState.dataTextureSet;e.bindTexture(e.TEXTURE_2D,t.eachMeshAttributes.texture),e.texSubImage2D(e.TEXTURE_2D,0,0,0,t.eachMeshAttributes.textureWidth,t.eachMeshAttributes.textureHeight,e.RGBA_INTEGER,e.UNSIGNED_BYTE,t.eachMeshAttributes.textureData),e.bindTexture(e.TEXTURE_2D,t.eachEdgeOffset.texture),e.texSubImage2D(e.TEXTURE_2D,0,0,0,t.eachEdgeOffset.textureWidth,t.eachEdgeOffset.textureHeight,e.RGB,e.FLOAT,t.eachEdgeOffset.textureData)}},n.flushInitFlags=function(){this.commitDeferredFlags()},n.setMeshVisible=function(e,t,i){if(!m(this,or)[or])throw"Not built";t&Te.VISIBLE?this.meshCounts.numVisible++:this.meshCounts.numVisible--,m(this,cr)[cr](e,t,i)},n.setMeshHighlighted=function(e,t,i){if(!m(this,or)[or])throw"Not built";t&Te.HIGHLIGHTED?this.meshCounts.numHighlighted++:this.meshCounts.numHighlighted--,m(this,cr)[cr](e,t,i)},n.setMeshXRayed=function(e,t,i){if(!m(this,or)[or])throw"Not built";t&Te.XRAYED?this.meshCounts.numXRayed++:this.meshCounts.numXRayed--,m(this,cr)[cr](e,t,i)},n.setMeshSelected=function(e,t,i){if(!m(this,or)[or])throw"Not built";t&Te.SELECTED?this.meshCounts.numSelected++:this.meshCounts.numSelected--,m(this,cr)[cr](e,t,i)},n.setMeshEdges=function(e,t,i){if(!m(this,or)[or])throw"Not built";t&Te.EDGES?this.meshCounts.numEdges++:this.meshCounts.numEdges--,m(this,cr)[cr](e,t,i)},n.setMeshClippable=function(e,t){if(!m(this,or)[or])throw"Not built";t&Te.CLIPPABLE?this.meshCounts.numClippable++:this.meshCounts.numClippable--,m(this,ur)[ur](e,t)},n.setMeshCulled=function(e,t,i){if(!m(this,or)[or])throw"Not built";t&Te.CULLED?this.meshCounts.numCulled++:this.meshCounts.numCulled--,m(this,cr)[cr](e,t,i)},n.setMeshCollidable=function(e,t){if(!m(this,or)[or])throw"Not built"},n.setMeshPickable=function(e,t,i){if(!m(this,or)[or])throw"Not built";t&Te.PICKABLE?this.meshCounts.numPickable++:this.meshCounts.numPickable--,m(this,cr)[cr](e,t,i)},n.setMeshColor=function(e,t,i){if(!m(this,or)[or])throw"Not built";var r=this.renderState.dataTextureSet,n=m(this,$i)[$i];Zi[0]=t[0],Zi[1]=t[1],Zi[2]=t[2],Zi[3]=t[3],r.eachMeshAttributes.textureData.set(Zi,28*e),m(this,nr)[nr]?m(this,sr)[sr]=!0:(n.bindTexture(n.TEXTURE_2D,r.eachMeshAttributes.texture),n.texSubImage2D(n.TEXTURE_2D,0,0,e,1,1,n.RGBA_INTEGER,n.UNSIGNED_BYTE,Zi))},n.setMeshTransparent=function(e,t,i){if(!m(this,or)[or])throw"Not built";i?(this.meshCounts.numTransparent++,this.meshCounts.numTransparent++):(this.meshCounts.numTransparent--,this.meshCounts.numTransparent--),m(this,cr)[cr](e,t,i)},n.setMeshOffset=function(e,t){if(!m(this,or)[or])throw"Not built";var i=m(this,$i)[$i];Qi[0]=t[0],Qi[1]=t[1],Qi[2]=t[2],m(this,nr)[nr]?m(this,sr)[sr]=!0:i.texSubImage2D(i.TEXTURE_2D,0,0,e,1,1,i.RGB,i.FLOAT,Qi)},n.setMeshMatrix=function(e,t){if(!m(this,or)[or])throw"Not built";m(this,$i),m(this,nr)[nr]&&(m(this,sr)[sr]=!0)},n.setMeshViewMatrixIndex=function(e,t){if(!m(this,or)[or])throw"Not built";m(this,$i),m(this,nr)[nr]&&(m(this,sr)[sr]=!0)},n.destroy=function(){this.renderState.dataTextureSet.destroy()},c(r,[{key:"hash",get:function(){return"layer-"+this.renderState.primitive}}]),r}();function dr(e){var i=this.renderState;if(e.indices){var r=this.renderState.primitive===t.PointsPrimitive?1:this.renderState.primitive===t.LinesPrimitive?2:3,n=Math.ceil(e.indices.length/r/zi)*zi*r,s=new Uint32Array(n);s.fill(0),s.set(e.indices),e.indices=s}if(e.edgeIndices){var o=Math.ceil(e.edgeIndices.length/2/zi)*zi*2,a=new Uint32Array(o);a.fill(0),a.set(e.edgeIndices),e.edgeIndices=a}for(var h,c=m(this,er)[er],u=e.positionsCompressed,l=e.indices,d=e.edgeIndices,f=c.positionsCompressed.length/3,v=u.length/3,p=0,g=u.length;p<g;p++)c.positionsCompressed.push(u[p]);var E,T=0;if(l){var b;T=l.length/3,h=(b=v<=256?c.indices_8Bits:v<=65536?c.indices_16Bits:c.indices_32Bits).length/3;for(var x=0,y=l.length;x<y;x++)b.push(l[x])}var w=0;if(d){var _;w=d.length/2,E=(_=v<=256?c.edgeIndices_8Bits:v<=65536?c.edgeIndices_16Bits:c.edgeIndices_32Bits).length/2;for(var M=0,P=d.length;M<P;M++)_.push(d[M])}return i.numVertices+=v,{vertexBase:f,numVertices:v,numTriangles:T,numEdges:w,indicesBase:h,edgeIndicesBase:E}}function fr(e,t,i){var r,n=m(this,er)[er],s=this.renderState,o=e.matrix||qi,a=e.color||[255,255,255],h=n.positionsCompressed.length/3;n.eachMeshPositionsDecompressMatrix.push(t.positionsDecompressMatrix),n.eachMeshMatrices.push(o),n.eachMeshColor.push([a[0],a[1],a[2],255]),n.eachMeshPickColor.push(e.pickColor),r=i.numVertices<=256?s.numIndices8Bits:i.numVertices<=65536?s.numIndices16Bits:s.numIndices32Bits,n.eachMeshVertexPortionBase.push(i.vertexBase),n.eachMeshVertexPortionOffset.push(r/3-i.indicesBase),n.eachMeshEdgeIndicesOffset.push((i.numVertices<=256?s.numEdgeIndices8Bits:i.numVertices<=65536?s.numEdgeIndices16Bits:s.numEdgeIndices32Bits)/2-i.edgeIndicesBase);var c=m(this,ir)[ir].length;if(i.numTriangles>0){var u,l=3*i.numTriangles;i.numVertices<=256?(u=n.eachPrimitiveMesh_8Bits,s.numIndices8Bits+=l):i.numVertices<=65536?(u=n.eachPrimitiveMesh_16Bits,s.numIndices16Bits+=l):(u=n.eachPrimitiveMesh_32Bits,s.numIndices32Bits+=l);for(var d=0;d<i.numTriangles;d+=zi)u.push(c)}if(i.numEdges>0){var f,v=2*i.numEdges;i.numVertices<=256?(f=n.eachEdgeMesh_8Bits,s.numEdgeIndices8Bits+=v):i.numVertices<=65536?(f=n.eachEdgeMesh_16Bits,s.numEdgeIndices16Bits+=v):(f=n.eachEdgeMesh_32Bits,s.numEdgeIndices32Bits+=v);for(var p=0;p<i.numEdges;p+=zi)f.push(c)}return n.eachEdgeOffset.push([0,0,0]),m(this,ir)[ir].push({vertsBase:h,numVerts:i.numTriangles}),m(this,rr)[rr]++,c}function vr(e,t,i){if(!m(this,or)[or])throw"Not built";var r,n,s,o=!!(t&Te.VISIBLE),a=!!(t&Te.XRAYED),h=!!(t&Te.HIGHLIGHTED),c=!!(t&Te.SELECTED),u=!!(t&Te.CULLED);r=!o||u||a?$.NOT_RENDERED:i?$.COLOR_TRANSPARENT:$.COLOR_OPAQUE,n=!o||u?$.NOT_RENDERED:c?$.SILHOUETTE_SELECTED:h?$.SILHOUETTE_HIGHLIGHTED:a?$.SILHOUETTE_XRAYED:$.NOT_RENDERED,s=!o||u?$.NOT_RENDERED:c?$.EDGES_SELECTED:h?$.EDGES_HIGHLIGHTED:a?$.EDGES_XRAYED:t&Te.EDGES?i?$.EDGES_COLOR_TRANSPARENT:$.EDGES_COLOR_OPAQUE:$.NOT_RENDERED;var l=o&&!u&&t&Te.PICKABLE?$.PICK:$.NOT_RENDERED,d=this.renderState.dataTextureSet,f=m(this,$i)[$i];if(Zi[0]=r,Zi[1]=n,Zi[2]=s,Zi[3]=l,m(this,nr)[nr])return d.eachMeshAttributes.textureData.set(Zi,28*e+8),void(m(this,sr)[sr]=!0);f.bindTexture(f.TEXTURE_2D,d.eachMeshAttributes.texture),f.texSubImage2D(f.TEXTURE_2D,0,2,e,1,1,f.RGBA_INTEGER,f.UNSIGNED_BYTE,Zi)}function pr(e,t){if(!m(this,or)[or])throw"Not built";var i=t&Te.CLIPPABLE?255:0,r=this.renderState.dataTextureSet,n=m(this,$i)[$i];if(Zi[0]=i,Zi[1]=0,Zi[2]=1,Zi[3]=2,m(this,nr)[nr])return r.eachMeshAttributes.textureData.set(Zi,28*e+12),void(m(this,sr)[sr]=!0);n.bindTexture(n.TEXTURE_2D,r.eachMeshAttributes.texture),n.texSubImage2D(n.TEXTURE_2D,0,3,e,1,1,n.RGBA_INTEGER,n.UNSIGNED_BYTE,Zi)}var gr=function(){},mr=/*#__PURE__*/function(){function e(e,t){this.texture=void 0,this.texture2D=void 0,this.texture=e,this.texture2D=t}return e.prototype.destroy=function(){this.texture2D&&this.texture2D.destroy()},e}(),Er=new Uint16Array([0,0,0]),Tr=/*#__PURE__*/g("flags"),br=/*#__PURE__*/g("aabb"),xr=/*#__PURE__*/g("offsetAABB"),yr=/*#__PURE__*/g("offset"),wr=/*#__PURE__*/g("colorizeUpdated"),_r=/*#__PURE__*/g("opacityUpdated"),Mr=/*#__PURE__*/function(){function t(t){this.id=void 0,this.model=void 0,this.sceneObject=void 0,this.layerId=void 0,this.rendererMeshes=void 0,Object.defineProperty(this,Tr,{writable:!0,value:void 0}),Object.defineProperty(this,br,{writable:!0,value:void 0}),Object.defineProperty(this,xr,{writable:!0,value:void 0}),Object.defineProperty(this,yr,{writable:!0,value:void 0}),Object.defineProperty(this,wr,{writable:!0,value:void 0}),Object.defineProperty(this,_r,{writable:!0,value:void 0}),this.id=t.id,this.rendererMeshes=t.rendererMeshes||[],m(this,Tr)[Tr]=0,m(this,br)[br]=t.aabb,m(this,xr)[xr]=o.createAABB3(t.aabb),m(this,yr)[yr]=e.createVec3(),m(this,wr)[wr]=!1,m(this,_r)[_r]=!1,this.layerId=t.layerId||null;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setSceneObject(this)}var i=t.prototype;return i.setVisible=function(e,t){if(!!(m(this,Tr)[Tr]&Te.VISIBLE)!==t){m(this,Tr)[Tr]=t?m(this,Tr)[Tr]|Te.VISIBLE:m(this,Tr)[Tr]&~Te.VISIBLE;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setVisible(m(this,Tr)[Tr])}},i.setHighlighted=function(e,t){if(!!(m(this,Tr)[Tr]&Te.HIGHLIGHTED)!==t){m(this,Tr)[Tr]=t?m(this,Tr)[Tr]|Te.HIGHLIGHTED:m(this,Tr)[Tr]&~Te.HIGHLIGHTED;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setHighlighted(m(this,Tr)[Tr])}},i.setXRayed=function(e,t){if(!!(m(this,Tr)[Tr]&Te.XRAYED)!==t){m(this,Tr)[Tr]=t?m(this,Tr)[Tr]|Te.XRAYED:m(this,Tr)[Tr]&~Te.XRAYED;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setXRayed(m(this,Tr)[Tr])}},i.setSelected=function(e,t){if(!!(m(this,Tr)[Tr]&Te.SELECTED)!==t){m(this,Tr)[Tr]=t?m(this,Tr)[Tr]|Te.SELECTED:m(this,Tr)[Tr]&~Te.SELECTED;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setSelected(m(this,Tr)[Tr])}},i.setEdges=function(e,t){if(!!(m(this,Tr)[Tr]&Te.EDGES)!==t){m(this,Tr)[Tr]=t?m(this,Tr)[Tr]|Te.EDGES:m(this,Tr)[Tr]&~Te.EDGES;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setEdges(m(this,Tr)[Tr])}},i.setCulled=function(e,t){if(!!(m(this,Tr)[Tr]&Te.CULLED)!==t){m(this,Tr)[Tr]=t?m(this,Tr)[Tr]|Te.CULLED:m(this,Tr)[Tr]&~Te.CULLED;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setCulled(m(this,Tr)[Tr])}},i.setClippable=function(e,t){if(!!(m(this,Tr)[Tr]&Te.CLIPPABLE)!==t){m(this,Tr)[Tr]=t?m(this,Tr)[Tr]|Te.CLIPPABLE:m(this,Tr)[Tr]&~Te.CLIPPABLE;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setClippable(m(this,Tr)[Tr])}},i.setCollidable=function(e,t){if(!!(m(this,Tr)[Tr]&Te.COLLIDABLE)!==t){m(this,Tr)[Tr]=t?m(this,Tr)[Tr]|Te.COLLIDABLE:m(this,Tr)[Tr]&~Te.COLLIDABLE;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setCollidable(m(this,Tr)[Tr])}},i.setPickable=function(e,t){if(!!(m(this,Tr)[Tr]&Te.PICKABLE)!==t){m(this,Tr)[Tr]=t?m(this,Tr)[Tr]|Te.PICKABLE:m(this,Tr)[Tr]&~Te.PICKABLE;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setPickable(m(this,Tr)[Tr])}},i.setColorize=function(e,t){if(t){Er[0]=Math.floor(255*t[0]),Er[1]=Math.floor(255*t[1]),Er[2]=Math.floor(255*t[2]);for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setColorize(Er)}else for(var n=0,s=this.rendererMeshes.length;n<s;n++)this.rendererMeshes[n].setColorize(null)},i.setOpacity=function(e,t){if(0!==this.rendererMeshes.length){var i=this.rendererMeshes[0].colorize[3],r=255;if(null!=t){if(t<0?t=0:t>1&&(t=1),i===(r=Math.floor(255*t)))return}else if(i===(r=255))return;for(var n=0,s=this.rendererMeshes.length;n<s;n++)this.rendererMeshes[n].setOpacity(r,m(this,Tr)[Tr])}},i.setOffset=function(e,t){},i.build=function(){for(var e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].build(m(this,Tr)[Tr])},i.finalize2=function(){for(var e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].finalize2()},i.destroy=function(){for(var e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].destroy()},c(t,[{key:"aabb",get:function(){return m(this,xr)[xr]}}]),t}(),Pr=e.createMat4(),Cr=e.createMat4(),Ir=/*#__PURE__*/function(){function t(e){this.id=void 0,this.color=void 0,this.rendererGeometry=void 0,this.rendererTextureSet=void 0,this.matrix=void 0,this.metallic=void 0,this.roughness=void 0,this.opacity=void 0,this.pickId=void 0,this.tileManager=void 0,this.tile=void 0,this.sceneObjectRenderer=void 0,this.aabb=void 0,this.layer=void 0,this.meshIndex=void 0,this.colorize=void 0,this.colorizing=void 0,this.transparent=void 0,this.sceneObjectRenderer=null,this.tileManager=e.tileManager,this.id=e.id,this.pickId=0,this.color=[e.color[0],e.color[1],e.color[2],e.opacity],this.colorize=[e.color[0],e.color[1],e.color[2],e.opacity],this.colorizing=!1,this.transparent=e.opacity<255,this.layer=e.layer,this.matrix=e.matrix,this.metallic=e.metallic,this.roughness=e.roughness,this.opacity=e.opacity,this.aabb=o.createAABB3(),this.rendererTextureSet=e.rendererTextureSet,this.rendererGeometry=e.rendererGeometry,this.meshIndex=e.meshIndex}var i=t.prototype;return i.delegatePickedEntity=function(){throw new Error("Method not implemented.")},i.setSceneObject=function(e){this.sceneObjectRenderer=e},i.build=function(e){this.layer.initFlags(this.meshIndex,e,this.transparent)},i.finalize2=function(){this.layer.flushInitFlags&&this.layer.flushInitFlags()},i.setVisible=function(e){this.layer.setMeshVisible(this.meshIndex,e,this.transparent)},i.setMatrix=function(t){var i=e.transformPoint3(t,[0,0,0]),r=this.tile;this.tile=r?this.tileManager.updateTileCenter(r,i):this.tileManager.getTile(i);var n=!r||r.id!==this.tile.id,s=this.tile.center;this.layer.setMeshMatrix(this.meshIndex,0!==s[0]||0!==s[1]||0!==s[2]?e.mulMat4(t,e.translationMat4c(-s[0],-s[1],-s[2],Pr),Cr):t),n&&this.layer.setMeshViewMatrixIndex(this.meshIndex,this.tile.index)},i.setMetallic=function(e){},i.setRoughness=function(e){},i.setColor=function(e){this.color[0]=e[0],this.color[1]=e[1],this.color[2]=e[2],this.colorizing||this.layer.setMeshColor(this.meshIndex,this.color)},i.setColorize=function(e){e?(this.colorize[0]=e[0],this.colorize[1]=e[1],this.colorize[2]=e[2],this.layer.setMeshColor(this.meshIndex,this.colorize,!1),this.colorizing=!0):(this.layer.setMeshColor(this.meshIndex,this.color,!1),this.colorizing=!1)},i.setOpacity=function(e,t){var i=e<255,r=this.transparent!==i;this.color[3]=e,this.colorize[3]=e,this.transparent=i,this.layer.setMeshColor(this.meshIndex,this.colorizing?this.colorize:this.color),r&&this.layer.setMeshTransparent(this.meshIndex,t,i)},i.setHighlighted=function(e){this.layer.setMeshHighlighted(this.meshIndex,e,this.transparent)},i.setXRayed=function(e){this.layer.setMeshXRayed(this.meshIndex,e,this.transparent)},i.setSelected=function(e){this.layer.setMeshSelected(this.meshIndex,e,this.transparent)},i.setEdges=function(e){this.layer.setMeshEdges(this.meshIndex,e,this.transparent)},i.setClippable=function(e){this.layer.setMeshClippable(this.meshIndex,e)},i.setCollidable=function(e){this.layer.setMeshCollidable(this.meshIndex,e)},i.setPickable=function(e){this.layer.setMeshPickable(this.meshIndex,e,this.transparent)},i.setCulled=function(e){this.layer.setMeshCulled(this.meshIndex,e,this.transparent)},i.canPickTriangle=function(){return!1},i.drawPickTriangles=function(e,t){},i.pickTriangleSurface=function(e){},i.canPickWorldPos=function(){return!0},i.drawPickNormals=function(e){},i.destroy=function(){this.tile&&this.tileManager&&this.tileManager.putTile(this.tile)},t}(),Sr=function(e){this.id=void 0,this.colorTexture=void 0,this.metallicRoughnessTexture=void 0,this.emissiveTexture=void 0,this.occlusionTexture=void 0,this.id=e.id,this.colorTexture=e.colorTexture,this.metallicRoughnessTexture=e.metallicRoughnessTexture,this.emissiveTexture=e.emissiveTexture,this.occlusionTexture=e.occlusionTexture};e.createVec3(),e.createMat4(),e.createVec3([1,1,1]),e.createVec3([0,0,0]),e.createVec3([0,0,0]),e.identityQuat();var Rr="defaultTextureSet",Dr=/*#__PURE__*/g("view"),Or=/*#__PURE__*/g("webglRenderer"),Lr=/*#__PURE__*/g("renderContext"),Br=/*#__PURE__*/g("position"),Ar=/*#__PURE__*/g("rotation"),Ur=/*#__PURE__*/g("quaternion"),Fr=/*#__PURE__*/g("scale"),jr=/*#__PURE__*/g("worldMatrix"),Gr=/*#__PURE__*/g("viewMatrix"),kr=/*#__PURE__*/g("colorTextureEnabled"),Nr=/*#__PURE__*/g("backfaces"),Hr=/*#__PURE__*/g("layers"),Xr=/*#__PURE__*/g("numGeometries"),Vr=/*#__PURE__*/g("numTriangles"),Wr=/*#__PURE__*/g("numLines"),zr=/*#__PURE__*/g("numPoints"),qr=/*#__PURE__*/g("numViewerObjects"),Yr=/*#__PURE__*/g("textureTranscoder"),Kr=/*#__PURE__*/g("aabbDirty"),Zr=/*#__PURE__*/g("edgeThreshold"),Qr=/*#__PURE__*/g("currentLayers"),$r=/*#__PURE__*/g("aabb"),Jr=/*#__PURE__*/g("viewMatrixDirty"),en=/*#__PURE__*/g("worldMatrixNonIdentity"),tn=/*#__PURE__*/g("onCameraViewMatrix"),rn=/*#__PURE__*/g("layerId"),nn=/*#__PURE__*/g("addModel"),sn=/*#__PURE__*/g("addTexture"),on=/*#__PURE__*/g("addGeometry"),an=/*#__PURE__*/g("addMesh"),hn=/*#__PURE__*/g("addObject"),cn=/*#__PURE__*/g("removeModel"),un=/*#__PURE__*/g("createDefaultTextureSetRenderer"),ln=/*#__PURE__*/g("getLayer"),dn=/*#__PURE__*/g("rebuildAABB"),fn=/*#__PURE__*/function(t){function i(i){var r;r=t.call(this,i.view)||this,Object.defineProperty(d(r),dn,{value:yn}),Object.defineProperty(d(r),ln,{value:xn}),Object.defineProperty(d(r),un,{value:bn}),Object.defineProperty(d(r),cn,{value:Tn}),Object.defineProperty(d(r),hn,{value:En}),Object.defineProperty(d(r),an,{value:mn}),Object.defineProperty(d(r),on,{value:gn}),Object.defineProperty(d(r),sn,{value:pn}),Object.defineProperty(d(r),nn,{value:vn}),r.qualityRender=void 0,r.sceneModel=void 0,r.rendererGeometries=void 0,r.rendererTextures=void 0,r.rendererTextureSets=void 0,r.rendererMeshes=void 0,r.rendererObjects=void 0,r.rendererObjectsList=void 0,r.rendererViewObjects=void 0,r.viewer=void 0,r.layerList=void 0,r.onBuilt=void 0,Object.defineProperty(d(r),Dr,{writable:!0,value:void 0}),Object.defineProperty(d(r),Or,{writable:!0,value:void 0}),Object.defineProperty(d(r),Lr,{writable:!0,value:void 0}),Object.defineProperty(d(r),Br,{writable:!0,value:void 0}),Object.defineProperty(d(r),Ar,{writable:!0,value:void 0}),Object.defineProperty(d(r),Ur,{writable:!0,value:void 0}),Object.defineProperty(d(r),Fr,{writable:!0,value:void 0}),Object.defineProperty(d(r),jr,{writable:!0,value:void 0}),Object.defineProperty(d(r),Gr,{writable:!0,value:void 0}),Object.defineProperty(d(r),kr,{writable:!0,value:void 0}),Object.defineProperty(d(r),Nr,{writable:!0,value:void 0}),Object.defineProperty(d(r),Hr,{writable:!0,value:void 0}),Object.defineProperty(d(r),Xr,{writable:!0,value:void 0}),Object.defineProperty(d(r),Vr,{writable:!0,value:void 0}),Object.defineProperty(d(r),Wr,{writable:!0,value:void 0}),Object.defineProperty(d(r),zr,{writable:!0,value:void 0}),Object.defineProperty(d(r),qr,{writable:!0,value:void 0}),Object.defineProperty(d(r),Yr,{writable:!0,value:void 0}),Object.defineProperty(d(r),Kr,{writable:!0,value:void 0}),Object.defineProperty(d(r),Zr,{writable:!0,value:void 0}),Object.defineProperty(d(r),Qr,{writable:!0,value:void 0}),Object.defineProperty(d(r),$r,{writable:!0,value:void 0}),Object.defineProperty(d(r),Jr,{writable:!0,value:void 0}),Object.defineProperty(d(r),en,{writable:!0,value:void 0}),Object.defineProperty(d(r),tn,{writable:!0,value:void 0}),Object.defineProperty(d(r),rn,{writable:!0,value:void 0}),r.id=i.id,r.sceneModel=i.sceneModel,r.viewer=i.view.viewer,m(d(r),Dr)[Dr]=i.view,m(d(r),Or)[Or]=i.webglRenderer,m(d(r),Lr)[Lr]=i.renderContext,m(d(r),Yr)[Yr]=i.textureTranscoder,m(d(r),$r)[$r]=o.collapseAABB3(),m(d(r),Kr)[Kr]=!1,m(d(r),Hr)[Hr]={},r.layerList=[],m(d(r),Qr)[Qr]={},r.rendererGeometries={},r.rendererTextures={},r.rendererTextureSets={},r.rendererMeshes={},r.rendererObjects={},r.rendererObjectsList=[],r.rendererViewObjects={},m(d(r),Xr)[Xr]=0,m(d(r),qr)[qr]=0,m(d(r),Vr)[Vr]=0,m(d(r),Wr)[Wr]=0,m(d(r),zr)[zr]=0,m(d(r),Zr)[Zr]=i.edgeThreshold||10,r.built=!1,m(d(r),Br)[Br]=e.createVec3(i.position||[0,0,0]),m(d(r),Ar)[Ar]=e.createVec3(i.rotation||[0,0,0]),m(d(r),Ur)[Ur]=e.createVec4(i.quaternion||[0,0,0,1]),i.rotation&&e.eulerToQuat(m(d(r),Ar)[Ar],"XYZ",m(d(r),Ur)[Ur]),m(d(r),Fr)[Fr]=e.createVec3(i.scale||[1,1,1]),m(d(r),jr)[jr]=e.createMat4(),e.composeMat4(m(d(r),Br)[Br],m(d(r),Ur)[Ur],m(d(r),Fr)[Fr],m(d(r),jr)[jr]),(i.matrix||i.position||i.rotation||i.scale||i.quaternion)&&(m(d(r),Gr)[Gr]=e.createMat4(),m(d(r),Jr)[Jr]=!0,m(d(r),en)[en]=!0),r.qualityRender=!1!==i.qualityRender,m(d(r),rn)[rn]=i.layerId,m(d(r),tn)[tn]=m(d(r),Dr)[Dr].camera.onViewMatrix.subscribe(function(e,t){m(d(r),Jr)[Jr]=!0}),m(d(r),un)[un](),r.onBuilt=new s.EventEmitter(new n.EventDispatcher),m(d(r),nn)[nn](i.sceneModel);for(var a=0,h=r.layerList.length;a<h;a++)r.layerList[a].layerIndex=a;return m(d(r),Qr)[Qr]={},r.built=!0,m(d(r),Or)[Or].setImageDirty(),r.onBuilt.dispatch(d(r),null),r}u(i,t);var r=i.prototype;return r.setVisible=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setVisible(e,t);m(this,Or)[Or].setImageDirty(e)},r.setXRayed=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setXRayed(e,t);m(this,Or)[Or].setImageDirty(e)},r.setHighlighted=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setHighlighted(e,t);m(this,Or)[Or].setImageDirty(e)},r.setSelected=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setSelected(e,t);m(this,Or)[Or].setImageDirty(e)},r.setEdges=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setEdges(e,t);m(this,Or)[Or].setImageDirty(e)},r.setCulled=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setCulled(e,t);m(this,Or)[Or].setImageDirty(e)},r.setClippable=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setClippable(e,t);m(this,Or)[Or].setImageDirty(e)},r.setCollidable=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setCollidable(e,t)},r.setPickable=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setPickable(e,t)},r.setColorize=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setColorize(e,t)},r.setOpacity=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setOpacity(e,t)},r.destroy=function(){if(!this.destroyed){for(var e in m(this,cn)[cn](),m(this,Dr)[Dr].camera.onViewMatrix.unsubscribe(m(this,tn)[tn]),m(this,Qr)[Qr])m(this,Qr)[Qr].hasOwnProperty(e)&&m(this,Qr)[Qr][e].destroy();for(var i=0,r=this.layerList.length;i<r;i++)this.layerList[i].destroy();for(var n in this.rendererObjects)this.rendererObjects[n].destroy();m(this,Qr)[Qr]={},m(this,Hr)[Hr]={},this.layerList=[],this.rendererGeometries={},this.rendererTextures={},this.rendererTextureSets={},this.rendererMeshes={},this.rendererViewObjects={},this.onBuilt.clear(),t.prototype.destroy.call(this)}},c(i,[{key:"position",get:function(){return m(this,Br)[Br]}},{key:"rotation",get:function(){return m(this,Ar)[Ar]}},{key:"quaternion",get:function(){return m(this,Ur)[Ur]}},{key:"scale",get:function(){return m(this,Fr)[Fr]}},{key:"worldMatrix",get:function(){return m(this,jr)[jr]}},{key:"viewMatrix",get:function(){return m(this,Gr)[Gr]?(m(this,Jr)[Jr]&&(e.mulMat4(m(this,Dr)[Dr].camera.viewMatrix,m(this,jr)[jr],m(this,Gr)[Gr]),m(this,Jr)[Jr]=!1),m(this,Gr)[Gr]):m(this,Dr)[Dr].camera.viewMatrix}},{key:"colorTextureEnabled",get:function(){return m(this,kr)[kr]}},{key:"backfaces",get:function(){return m(this,Nr)[Nr]},set:function(e){e=!!e,m(this,Nr)[Nr]=e,m(this,Or)[Or].setImageDirty()}},{key:"matrix",get:function(){return m(this,jr)[jr]}},{key:"aabb",get:function(){return m(this,Kr)[Kr]&&m(this,dn)[dn](),m(this,$r)[$r]}},{key:"numTriangles",get:function(){return m(this,Vr)[Vr]}},{key:"numLines",get:function(){return m(this,Wr)[Wr]}},{key:"numPoints",get:function(){return m(this,zr)[zr]}}]),i}(s.Component);function vn(e){var t=e.textures,i=e.geometries,r=e.meshes,n=e.objects;if(t)for(var s in t){var o=t[s];m(this,sn)[sn](o)}if(i)for(var a in i){var h=i[a];m(this,on)[on](h)}if(r)for(var c in r){var u=r[c];m(this,an)[an](u)}if(n)for(var l in n){var d=n[l];m(this,hn)[hn](d)}for(var f in m(this,Qr)[Qr])m(this,Qr)[Qr].hasOwnProperty(f)&&m(this,Qr)[Qr][f].build();for(var v=0,p=this.rendererObjectsList.length;v<p;v++)this.rendererObjectsList[v].build();for(var g=0,E=this.rendererObjectsList.length;g<E;g++)this.rendererObjectsList[g].finalize2()}function pn(e){var t=this,r=e.id;if(this.rendererTextures[r])throw new Error("RendererTexture already created: "+r);var n=new i.GLTexture({gl:m(this,Lr)[Lr].gl});if(e.preloadColor&&n.setPreloadColor(e.preloadColor),e.image){var s=e.image;s.crossOrigin="Anonymous",n.setImage(s,{minFilter:e.minFilter,magFilter:e.magFilter,wrapS:e.wrapS,wrapT:e.wrapT,wrapR:e.wrapR,flipY:e.flipY,encoding:e.encoding})}else if(e.src){var o=e.src.split(".").pop();switch(o){case"jpeg":case"jpg":case"png":case"gif":var a=new Image;a.onload=function(){n.setImage(a,{minFilter:e.minFilter,magFilter:e.magFilter,wrapS:e.wrapS,wrapT:e.wrapT,wrapR:e.wrapR,flipY:e.flipY,encoding:e.encoding})},a.src=e.src;break;default:m(this,Yr)[Yr]?function(e,t,i){var r=function(e){};t=t||r,i=i||r;var n=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(n){var s=!!n[2],o=n[3];o=window.decodeURIComponent(o),s&&(o=window.atob(o));try{for(var a=new ArrayBuffer(o.length),h=new Uint8Array(a),c=0;c<o.length;c++)h[c]=o.charCodeAt(c);window.setTimeout(function(){t(a)},0)}catch(e){window.setTimeout(function(){i(e)},0)}}else{var u=new XMLHttpRequest;u.open("GET",e,!0),u.responseType="arraybuffer",u.onreadystatechange=function(){4===u.readyState&&(200===u.status?t(u.response):i("loadArrayBuffer error : "+u.response))},u.send(null)}}(e.src,function(e){e.byteLength?m(t,Yr)[Yr].transcode([e]).then(function(e){n.setCompressedData(e),m(t,Or)[Or].setImageDirty()}):t.error("Can't create texture from 'src': file data is zero length")},function(e){t.error("Can't create texture from 'src': "+e)}):this.error("Can't create texture from 'src' - rendererModel needs to be configured with a TextureTranscoder for this file type ('"+o+"')")}}else e.buffers&&(m(this,Yr)[Yr]?m(this,Yr)[Yr].transcode(e.buffers).then(function(e){n.setCompressedData(e),m(t,Or)[Or].setImageDirty()}):this.error("Can't create texture from 'buffers' - rendererModel needs to be configured with a TextureTranscoder for this option"));var h=new mr(e,n);e.rendererTexture=h,this.rendererTextures[r]=h}function gn(e){var t=e.id;if(this.rendererGeometries[t])throw new Error("GeometryRenderer already created: "+t);var i=new gr;this.rendererGeometries[t]=i,e.rendererGeometry=i,m(this,Xr)[Xr]++}function mn(e){var t=this.rendererGeometries[e.geometry.id];if(!t)throw new Error("RendererGeometry not found");var i=this.rendererTextureSets[e.textureSet.id];if(!i)throw new Error("rendererTextureSet not found");var r=m(this,ln)[ln](e.textureSet.id,e.geometry);if(r){var n;r.hasGeometry(e.geometry.id)||r.createGeometryCompressed(e.geometry),m(this,en)[en]&&m(this,jr),n=e.matrix;var s=e.color?new Uint8Array([Math.floor(255*e.color[0]),Math.floor(255*e.color[1]),Math.floor(255*e.color[2])]):[255,255,255],a=null!=e.opacity?Math.floor(255*e.opacity):255,h=null!=e.metallic?Math.floor(255*e.metallic):0,c=null!=e.roughness?Math.floor(255*e.roughness):255,u=new Ir({tileManager:m(this,Or)[Or].tileManager,id:e.id,layer:r,color:s,opacity:a,matrix:n,metallic:h,roughness:c,rendererTextureSet:i,rendererGeometry:t,meshIndex:0});u.pickId=m(this,Or)[Or].registerPickable(u);var l=new Uint8Array([255&u.pickId,u.pickId>>8&255,u.pickId>>16&255,u.pickId>>24&255]);o.collapseAABB3(u.aabb);var d=r.createMesh({id:e.id,geometryId:e.geometry.id,color:s,opacity:a,metallic:h,roughness:c,matrix:n,pickColor:l});m(this,Xr)[Xr]++,o.expandAABB3(m(this,$r)[$r],u.aabb),u.layer=r,u.meshIndex=d,this.rendererMeshes[e.id]=u}}function En(e){var t=e.id;void 0===t?t=_():this.rendererObjects[t]&&(this.error("[createObject] rendererModel already has a ViewerObject with this ID: "+t+" - will assign random ID"),t=_());var i=e.meshes;if(void 0===i)throw new Error("[createObject] Param expected: meshes");for(var r=[],n=0,s=i.length;n<s;n++)r.push(this.rendererMeshes[i[n].id]);var o=new Mr({id:t,rendererModel:this,rendererMeshes:r,aabb:e.aabb,layerId:m(this,rn)[rn]});this.rendererObjectsList.push(o),this.rendererObjects[t]=o,this.rendererViewObjects[t]=o,m(this,qr)[qr]++}function Tn(){var e=this.sceneModel;if(e){var t=e.textures,i=e.geometries,r=e.meshes,n=e.objects;if(t)for(var s in t){var o=t[s];o.rendererTexture&&(o.rendererTexture=null)}if(i)for(var a in i){var h=i[a];h.rendererGeometry&&(h.rendererGeometry=null)}if(r)for(var c in r){var u=r[c];u.rendererMesh&&(u.rendererMesh=null)}if(n)for(var l in n){var d=n[l];d.rendererObject&&(d.rendererObject=null)}this.sceneModel=null}}function bn(){var e=new mr(null,new i.GLTexture({gl:m(this,Lr)[Lr].gl,preloadColor:[1,1,1,1]})),t=new mr(null,new i.GLTexture({gl:m(this,Lr)[Lr].gl,preloadColor:[0,1,1,1]})),r=new mr(null,new i.GLTexture({gl:m(this,Lr)[Lr].gl,preloadColor:[0,0,0,0]})),n=new mr(null,new i.GLTexture({gl:m(this,Lr)[Lr].gl,preloadColor:[0,0,0,1]})),s=new mr(null,new i.GLTexture({gl:m(this,Lr)[Lr].gl,preloadColor:[1,1,1,1]}));this.rendererTextures.defaultColorTexture=e,this.rendererTextures.defaultMetalRoughTexture=t,this.rendererTextures.defaultNormalsTexture=r,this.rendererTextures.defaultEmissiveTexture=n,this.rendererTextures.defaultOcclusionTexture=s,this.rendererTextureSets[Rr]=new Sr({id:Rr,colorTexture:e,metallicRoughnessTexture:t,emissiveTexture:n,occlusionTexture:s})}function xn(e,t){var i,r=e+"_"+t.primitive,n=m(this,Qr)[Qr][r];if(n){if(n.canCreateMesh(t))return n;n.build(),delete m(this,Qr)[Qr][r]}if(!e||(i=this.rendererTextureSets[e]))return n=new lr({gl:m(this,Lr)[Lr].gl,view:m(this,Dr)[Dr],rendererModel:this,primitive:t.primitive,textureSet:i,layerIndex:0}),m(this,Hr)[Hr][r]=n,this.layerList.push(n),m(this,Qr)[Qr][r]=n,n;this.error("TextureSet not found: "+e+" - ensure that you create it first with createTextureSet()")}function yn(){o.collapseAABB3(m(this,$r)[$r]);for(var e=0,t=this.rendererObjectsList.length;e<t;e++){var i=this.rendererObjectsList[e];o.expandAABB3(m(this,$r)[$r],i.aabb)}m(this,Kr)[Kr]=!1}e.createVec3();var wn=new Float32Array(16),_n=new Float64Array(4),Mn=new Float64Array(4);function Pn(e,t,i){return void 0===i&&(i=200),t[0]=Math.round(e[0]/i)*i,t[1]=Math.round(e[1]/i)*i,t[2]=Math.round(e[2]/i)*i,t}var Cn=2e3,In=/*#__PURE__*/g("gl"),Sn=/*#__PURE__*/g("indexesUsed"),Rn=/*#__PURE__*/g("tiles"),Dn=/*#__PURE__*/g("dataTexture"),On=/*#__PURE__*/g("camera"),Ln=/*#__PURE__*/g("lastFreeIndex"),Bn=/*#__PURE__*/g("putFreeTile"),An=/*#__PURE__*/g("findFreeTile"),Un=/*#__PURE__*/function(){function t(e){Object.defineProperty(this,An,{value:jn}),Object.defineProperty(this,Bn,{value:Fn}),Object.defineProperty(this,In,{writable:!0,value:void 0}),Object.defineProperty(this,Sn,{writable:!0,value:void 0}),Object.defineProperty(this,Rn,{writable:!0,value:void 0}),Object.defineProperty(this,Dn,{writable:!0,value:void 0}),Object.defineProperty(this,On,{writable:!0,value:void 0}),Object.defineProperty(this,Ln,{writable:!0,value:void 0}),m(this,On)[On]=e.camera,m(this,In)[In]=e.gl,m(this,Sn)[Sn]=[],m(this,Ln)[Ln]=0,m(this,Rn)[Rn]={},m(this,Dn)[Dn]=function(e,t){var r=Cn;if(0==r)throw"texture height == 0";var n=new Ni(48*r),s=e.createTexture();return s?(e.bindTexture(e.TEXTURE_2D,s),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA16F,12,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,12,r,e.RGBA,e.HALF_FLOAT,new Uint16Array(n.buffer),0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new i.GLDataTexture({gl:e,texture:s,textureWidth:12,textureHeight:r})):Xi}(m(this,In)[In])}var r=t.prototype;return r.getTile=function(t){var i=Pn(t,e.createVec3()),r=i[0]+"-"+i[1]+"-"+i[2],n=m(this,Rn)[Rn][r];return n||(n={id:r,index:m(this,An)[An](),useCount:0,center:e.createVec3(),rtcViewMatrix:e.createMat4()},m(this,Rn)[Rn][n.id]=n),n.useCount++,n},r.putTile=function(e){--e.useCount<=0&&(delete m(this,Rn)[Rn][e.id],m(this,Bn)[Bn](e.index))},r.updateTileCenter=function(t,i){var r=Pn(i,e.createVec3()),n=r[0]+"-"+r[1]+"-"+r[2];if(n===t.id)return t;this.putTile(t);var s=m(this,Rn)[Rn][n];return s||(s={id:n,index:m(this,An)[An](),useCount:0,center:e.createVec3(),rtcViewMatrix:e.createMat4()},m(this,Rn)[Rn][s.id]=s),s.useCount++,s},r.refreshMatrices=function(){if(m(this,Dn)[Dn].texture){for(var t,i,r,n=m(this,In)[In],s=m(this,On)[On].viewMatrix,o=Object.keys(m(this,Rn)[Rn]),a=new Float32Array(16*o.length),h=0,c=o.length;h<c;h++){var u=o[h],l=m(this,Rn)[Rn][u];t=s,void 0===(r=l.rtcViewMatrix)&&(r=wn),_n[0]=(i=l.center)[0],_n[1]=i[1],_n[2]=i[2],_n[3]=1,e.transformVec4(t,_n,Mn),e.setMat4Translation(t,Mn,r),a.set(l.rtcViewMatrix,16*l.index)}n.bindTexture(n.TEXTURE_2D,m(this,Dn)[Dn].texture),n.texSubImage2D(n.TEXTURE_2D,0,0,0,1,1,n.RGBA,n.FLOAT,a),n.bindTexture(n.TEXTURE_2D,null)}},t}();function Fn(e){delete m(this,Sn)[Sn][e],m(this,Ln)[Ln]=e}function jn(){for(var e=m(this,Ln)[Ln];;e=(e+1)%Cn)if(!m(this,Sn)[Sn][e])return m(this,Sn)[Sn][e]=!0,e}var Gn=navigator.userAgent.match(/(opera|chrome|safari|firefox|msie|mobile)\/?\s*(\.?\d+(\.\d+)*)/i),kn=Gn&&"safari"===Gn[1].toLowerCase(),Nn=/*#__PURE__*/g("sceneModels"),Hn=/*#__PURE__*/g("viewer"),Xn=/*#__PURE__*/g("view"),Vn=/*#__PURE__*/g("renderContext"),Wn=/*#__PURE__*/g("canvasTransparent"),zn=/*#__PURE__*/g("transparentEnabled"),qn=/*#__PURE__*/g("edgesEnabled"),Yn=/*#__PURE__*/g("imageDirty"),Kn=/*#__PURE__*/g("saoEnabled"),Zn=/*#__PURE__*/g("pbrEnabled"),Qn=/*#__PURE__*/g("backgroundColor"),$n=/*#__PURE__*/g("rendererModels"),Jn=/*#__PURE__*/g("layerList"),es=/*#__PURE__*/g("layerListDirty"),ts=/*#__PURE__*/g("stateSortDirty"),is=/*#__PURE__*/g("pickIDs"),rs=/*#__PURE__*/g("saoDepthRenderBuffer"),ns=/*#__PURE__*/g("extensionHandles"),ss=/*#__PURE__*/g("logarithmicDepthBufferEnabled"),os=/*#__PURE__*/g("alphaDepthMask"),as=/*#__PURE__*/g("occlusionTester"),hs=/*#__PURE__*/g("textureTranscoder"),cs=/*#__PURE__*/g("layerRenderers"),us=/*#__PURE__*/g("viewMatrixDirty"),ls=/*#__PURE__*/g("registerRendererViewObjects"),ds=/*#__PURE__*/g("deregisterRendererViewObjects"),fs=/*#__PURE__*/g("updateLayerList"),vs=/*#__PURE__*/g("buildLayerList"),ps=/*#__PURE__*/g("draw"),gs=/*#__PURE__*/g("activateExtensions"),ms=/*#__PURE__*/g("drawSAOBuffers"),Es=/*#__PURE__*/g("drawDepth"),Ts=/*#__PURE__*/g("drawColor"),bs=/*#__PURE__*/g("drawLayer"),xs=/*#__PURE__*/function(){function t(t){Object.defineProperty(this,bs,{value:Ds}),Object.defineProperty(this,Ts,{value:Rs}),Object.defineProperty(this,Es,{value:Ss}),Object.defineProperty(this,ms,{value:Is}),Object.defineProperty(this,gs,{value:Cs}),Object.defineProperty(this,ps,{value:Ps}),Object.defineProperty(this,vs,{value:Ms}),Object.defineProperty(this,fs,{value:_s}),Object.defineProperty(this,ds,{value:ws}),Object.defineProperty(this,ls,{value:ys}),this.rendererViewObjects=void 0,this.tileManager=void 0,Object.defineProperty(this,Nn,{writable:!0,value:void 0}),Object.defineProperty(this,Hn,{writable:!0,value:void 0}),Object.defineProperty(this,Xn,{writable:!0,value:void 0}),Object.defineProperty(this,Vn,{writable:!0,value:void 0}),Object.defineProperty(this,Wn,{writable:!0,value:void 0}),Object.defineProperty(this,zn,{writable:!0,value:void 0}),Object.defineProperty(this,qn,{writable:!0,value:void 0}),Object.defineProperty(this,Yn,{writable:!0,value:void 0}),Object.defineProperty(this,Kn,{writable:!0,value:void 0}),Object.defineProperty(this,Zn,{writable:!0,value:void 0}),Object.defineProperty(this,Qn,{writable:!0,value:void 0}),Object.defineProperty(this,$n,{writable:!0,value:void 0}),Object.defineProperty(this,Jn,{writable:!0,value:void 0}),Object.defineProperty(this,es,{writable:!0,value:void 0}),Object.defineProperty(this,ts,{writable:!0,value:void 0}),Object.defineProperty(this,is,{writable:!0,value:new w({})}),Object.defineProperty(this,rs,{writable:!0,value:void 0}),Object.defineProperty(this,ns,{writable:!0,value:void 0}),Object.defineProperty(this,ss,{writable:!0,value:void 0}),Object.defineProperty(this,os,{writable:!0,value:void 0}),Object.defineProperty(this,as,{writable:!0,value:void 0}),Object.defineProperty(this,hs,{writable:!0,value:void 0}),Object.defineProperty(this,cs,{writable:!0,value:void 0}),Object.defineProperty(this,us,{writable:!0,value:void 0}),this.tileManager=null,m(this,Nn)[Nn]={},this.rendererViewObjects={},m(this,hs)[hs]=t.textureTranscoder||new Y({}),m(this,Wn)[Wn]=!1,m(this,os)[os]=!1,m(this,ns)[ns]={},m(this,is)[is]=new w({}),m(this,Jn)[Jn]=[],m(this,es)[es]=!0,m(this,ts)[ts]=!0,m(this,Yn)[Yn]=!0,m(this,zn)[zn]=!0,m(this,qn)[qn]=!0,m(this,Kn)[Kn]=!0,m(this,Zn)[Zn]=!0,m(this,Qn)[Qn]=e.createVec3(),m(this,as)[as]=null,m(this,ss)[ss]=!1,m(this,$n)[$n]={},m(this,us)[us]=!0}var r=t.prototype;return r.init=function(e){m(this,Hn)[Hn]=e,m(this,hs)[hs].init(m(this,Hn)[Hn].capabilities)},r.getCapabilities=function(e){e.maxViews=1;var t,r=document.createElement("canvas");try{t=r.getContext("webgl2")}catch(e){console.error("Failed to get a WebGL context")}t&&(e.astcSupported=!!i.getExtension(t,"WEBGL_compressed_texture_astc"),e.etc1Supported=!0,e.etc2Supported=!!i.getExtension(t,"WEBGL_compressed_texture_etc"),e.dxtSupported=!!i.getExtension(t,"WEBGL_compressed_texture_s3tc"),e.bptcSupported=!!i.getExtension(t,"EXT_texture_compression_bptc"),e.pvrtcSupported=!(!i.getExtension(t,"WEBGL_compressed_texture_pvrtc")&&!i.getExtension(t,"WEBKIT_WEBGL_compressed_texture_pvrtc")))},r.registerView=function(e){var t=this;if(m(this,Vn)[Vn])throw"Only one View allowed with WebGLRenderer (see WebViewerCapabilities.maxViews)";m(this,Xn)[Xn]=e;for(var i=["webglutils"],r=e.canvasElement,n={},s=null,o=0;!s&&o<i.length;o++)try{s=r.getContext(i[o],n)}catch(e){}return s?(s&&s.hint(s.FRAGMENT_SHADER_DERIVATIVE_HINT,s.NICEST),m(this,Vn)[Vn]=new Q(m(this,Hn)[Hn],m(this,Xn)[Xn],s),this.tileManager=new Un({camera:e.camera,gl:s}),m(this,cs)[cs]={colorTriangles:new pe(m(this,Vn)[Vn])},e.camera.onViewMatrix.sub(function(){m(t,us)[us]=!0}),0):(console.error("Failed to get a WebGL2 context"),0)},r.deregisterView=function(e){},r.addModel=function(e){var t=this;if(!m(this,Vn)[Vn])throw new Error("Must register a View before you add a SceneModel");var i=new fn(function(e,t){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}({sceneModel:e.sceneModel,view:m(this,Xn)[Xn],textureTranscoder:m(this,hs)[hs],webglRenderer:this,renderContext:m(this,Vn)[Vn],layerId:e.layerId},e));m(this,$n)[$n][i.id]=i,m(this,ls)[ls](i),m(this,es)[es]=!0,i.onDestroyed.one(function(e){var i=m(t,$n)[$n][e.id];delete m(t,$n)[$n][e.id],m(t,ds)[ds](i),m(t,es)[es]=!0})},r.removeModel=function(e){if(m(this,Nn)[Nn][e]){var t=m(this,$n)[$n][e];delete m(this,$n)[$n][e],m(this,ds)[ds](t),m(this,es)[es]=!0}},r.registerPickable=function(e){return m(this,is)[is].addItem(e)},r.deregisterPickable=function(e){m(this,is)[is].removeItem(e)},r.setImageDirty=function(e){m(this,Yn)[Yn]=!0},r.setBackgroundColor=function(e,t){m(this,Qn)[Qn].set(t),m(this,Yn)[Yn]=!0},r.setEdgesEnabled=function(e,t){m(this,qn)[qn]=t,m(this,Yn)[Yn]=!0},r.setPBREnabled=function(e,t){m(this,Zn)[Zn]=t,m(this,Yn)[Yn]=!0},r.getSAOSupported=function(){return kn&&i.WEBGL_INFO.SUPPORTED_EXTENSIONS.OES_standard_derivatives},r.setSAOEnabled=function(e,t){m(this,Kn)[Kn]=t,m(this,Yn)[Yn]=!0},r.setTransparentEnabled=function(e,t){m(this,zn)[zn]=t,m(this,Yn)[Yn]=!0},r.clear=function(e){var t=m(this,Vn)[Vn].gl;t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),m(this,Wn)[Wn]?t.clearColor(1,1,1,1):t.clearColor(m(this,Qn)[Qn][0],m(this,Qn)[Qn][1],m(this,Qn)[Qn][2],1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},r.needsRebuild=function(e){for(var t in m(this,cs)[cs])m(this,cs)[cs][t].needRebuild()},r.needsRender=function(e){return m(this,Yn)[Yn]||m(this,es)[es]||m(this,ts)[ts]},r.render=function(e,t){(t=t||{}).force&&(m(this,Yn)[Yn]=!0),m(this,us)[us]&&(this.tileManager.refreshMatrices(),m(this,us)[us]=!1),m(this,fs)[fs](),m(this,Yn)[Yn]&&(m(this,ps)[ps]({clear:!0}),m(this,Yn)[Yn]=!1)},r.pickSceneObject=function(e,t){return null},t}();function ys(e){var t=e.rendererViewObjects;for(var i in t)this.rendererViewObjects[i]=t[i]}function ws(e){var t=e.rendererViewObjects;for(var i in t)delete this.rendererViewObjects[i]}function _s(){m(this,es)[es]&&(m(this,vs)[vs](),m(this,es)[es]=!1,m(this,ts)[ts]=!0),m(this,ts)[ts]&&(m(this,ts)[ts]=!1,m(this,Yn)[Yn]=!0)}function Ms(){var e=0;for(var t in m(this,$n)[$n])for(var i=m(this,$n)[$n][t],r=0,n=i.layerList.length;r<n;r++)m(this,Jn)[Jn][e++]=i.layerList[r];m(this,Jn)[Jn].length=e}function Ps(e){m(this,gs)[gs](),m(this,Kn)[Kn]&&m(this,Xn)[Xn].sao.possible&&m(this,ms)[ms](e),m(this,Ts)[Ts](e)}function Cs(){i.WEBGL_INFO.SUPPORTED_EXTENSIONS.OES_element_index_uint&&(m(this,ns)[ns].OES_element_index_uint=m(this,Vn)[Vn].gl.getExtension("OES_element_index_uint")),m(this,ss)[ss]&&i.WEBGL_INFO.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(m(this,ns)[ns].EXT_frag_depth=m(this,Vn)[Vn].gl.getExtension("EXT_frag_depth")),i.WEBGL_INFO.SUPPORTED_EXTENSIONS.WEBGL_depth_texture&&(m(this,ns)[ns].WEBGL_depth_texture=m(this,Vn)[Vn].gl.getExtension("WEBGL_depth_texture"))}function Is(e){}function Ss(e){m(this,Vn)[Vn].reset();var t=m(this,Vn)[Vn].gl;t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),t.clearColor(0,0,0,0),t.enable(t.DEPTH_TEST),t.frontFace(t.CCW),t.enable(t.CULL_FACE),t.depthMask(!0),!1!==e.clear&&t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}function Rs(e){var t=m(this,Xn)[Xn],r=m(this,Vn)[Vn],n=r.gl,s=[],o=[],a=[],h=[],c=[],u=[],l=[],d=[],f=[],v=[],p=[],g=[],E=[],T=[],b=[],x=[];r.reset(),r.withSAO=!1,r.pbrEnabled=m(this,Zn)[Zn]&&!!t.qualityRender,n.viewport(0,0,n.drawingBufferWidth,n.drawingBufferHeight),m(this,Wn)[Wn]?n.clearColor(0,0,0,0):n.clearColor(m(this,Qn)[Qn][0],m(this,Qn)[Qn][1],m(this,Qn)[Qn][2],1),n.enable(n.DEPTH_TEST),n.frontFace(n.CCW),n.enable(n.CULL_FACE),n.depthMask(!0),n.lineWidth(1),r.lineWidth=1;var y=t.sao.possible;m(this,Kn)[Kn]&&y||(r.occlusionTexture=null),!1!==e.clear&&n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT);for(var w=0,_=0,M=0,P=0,C=0,I=0,S=0,R=0,D=0,O=0,L=0,B=0,A=0,U=0,F=0,j=0,G=0,k=m(this,Jn)[Jn].length;G<k;G++){var N=m(this,Jn)[Jn][G],H=N.meshCounts;H.numCulled!==H.numMeshes&&0!==H.numVisible&&(H.numTransparent<H.numMeshes&&(m(this,Kn)[Kn]&&y&&N.rendererModel.qualityRender?s[w++]=N:m(this,bs)[bs](N,$.COLOR_OPAQUE,N.rendererModel.qualityRender)),m(this,zn)[zn]&&H.numTransparent&&(a[M++]=N),H.numXRayed>0&&t.xrayMaterial.fill&&(t.xrayMaterial.fillAlpha<1?l[S++]=N:c[C++]=N),H.numHighlighted>0&&t.highlightMaterial.fill&&(t.highlightMaterial.fillAlpha<1?p[L++]=N:f[D++]=N),H.numSelected>0&&t.selectedMaterial.fill&&(t.selectedMaterial.fillAlpha<1?b[F++]=N:E[A++]=N),m(this,qn)[qn]&&m(this,Xn)[Xn].edgeMaterial.edges&&H.numEdges>0&&(H.numTransparent<H.numMeshes&&(o[_++]=N),H.numTransparent>0&&(h[P++]=N),t.selectedMaterial.edgeAlpha<1?x[j++]=N:T[U++]=N,t.xrayMaterial.edgeAlpha<1?d[R++]=N:u[I++]=N,t.highlightMaterial.edgeAlpha<1?g[B++]=N:v[O++]=N))}w>0&&(r.withSAO=!0);for(var X=0;X<_;X++)m(this,bs)[bs](o[X],$.EDGES_COLOR_OPAQUE);for(var V=0;V<C;V++)m(this,bs)[bs](c[V],$.SILHOUETTE_XRAYED);for(var W=0;W<I;W++)m(this,bs)[bs](u[W],$.EDGES_XRAYED);if(S>0||R>0||M>0||P>0){n.enable(n.CULL_FACE),n.enable(n.BLEND),m(this,Wn)[Wn]?(n.blendEquation(n.FUNC_ADD),n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA)):(n.blendEquation(n.FUNC_ADD),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA)),r.backfaces=!1,m(this,os)[os]||n.depthMask(!1);for(var z=0;z<R;z++)m(this,bs)[bs](d[z],$.EDGES_XRAYED);for(var q=0;q<S;q++)m(this,bs)[bs](l[q],$.SILHOUETTE_XRAYED);(M>0||P>0)&&n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA);for(var Y=0;Y<P;Y++)m(this,bs)[bs](h[Y],$.EDGES_COLOR_TRANSPARENT);for(var K=0;K<M;K++)m(this,bs)[bs](a[K],$.COLOR_TRANSPARENT);n.disable(n.BLEND),m(this,os)[os]||n.depthMask(!0)}if(D>0||O>0){r.lastProgramId=-1,n.clear(n.DEPTH_BUFFER_BIT);for(var Z=0;Z<O;Z++)m(this,bs)[bs](v[Z],$.EDGES_HIGHLIGHTED);for(var Q=0;Q<D;Q++)m(this,bs)[bs](f[Q],$.SILHOUETTE_HIGHLIGHTED)}if(L>0||B>0||D>0){r.lastProgramId=-1,n.clear(n.DEPTH_BUFFER_BIT),n.enable(n.CULL_FACE),n.enable(n.BLEND),m(this,Wn)[Wn]?(n.blendEquation(n.FUNC_ADD),n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA)):n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA);for(var J=0;J<B;J++)m(this,bs)[bs](g[J],$.EDGES_HIGHLIGHTED);for(var ee=0;ee<L;ee++)m(this,bs)[bs](p[ee],$.SILHOUETTE_HIGHLIGHTED);n.disable(n.BLEND)}if(A>0||U>0){r.lastProgramId=-1,n.clear(n.DEPTH_BUFFER_BIT);for(var te=0;te<U;te++)m(this,bs)[bs](T[te],$.EDGES_SELECTED);for(var ie=0;ie<A;ie++)m(this,bs)[bs](E[ie],$.SILHOUETTE_SELECTED)}if(F>0||j>0){r.lastProgramId=-1,n.clear(n.DEPTH_BUFFER_BIT),n.enable(n.CULL_FACE),n.enable(n.BLEND),m(this,Wn)[Wn]?(n.blendEquation(n.FUNC_ADD),n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA)):n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA);for(var re=0;re<j;re++)m(this,bs)[bs](x[re],$.EDGES_SELECTED);for(var ne=0;ne<F;ne++)m(this,bs)[bs](b[ne],$.SILHOUETTE_SELECTED);n.disable(n.BLEND)}for(var se=i.WEBGL_INFO.MAX_TEXTURE_UNITS,oe=0;oe<se;oe++)n.activeTexture(n.TEXTURE0+oe);n.bindTexture(n.TEXTURE_CUBE_MAP,null),n.bindTexture(n.TEXTURE_2D,null);for(var ae=i.WEBGL_INFO.MAX_VERTEX_ATTRIBS,he=0;he<ae;he++)n.disableVertexAttribArray(he)}function Ds(e,i,r){switch(void 0===r&&(r=!0),e.renderState.primitive){case t.TrianglesPrimitive:case t.SurfacePrimitive:case t.SolidPrimitive:switch(i){case $.COLOR_OPAQUE:if(e.meshCounts.numTransparent===e.meshCounts.numMeshes||e.meshCounts.numXRayed===e.meshCounts.numMeshes)return;r||m(this,cs)[cs].colorTriangles.draw(e);break;case $.COLOR_TRANSPARENT:if(0===e.meshCounts.numTransparent)return;r||m(this,cs)[cs].colorTriangles.draw(e)}}}exports.WebGLRenderer=xs;
//# sourceMappingURL=index.js.map
