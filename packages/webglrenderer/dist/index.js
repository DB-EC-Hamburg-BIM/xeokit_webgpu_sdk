var e=require("@xeokit/matrix"),t=require("@xeokit/webglutils"),r=require("@xeokit/core"),i=require("strongly-typed-events"),n=require("@xeokit/math"),s=require("@xeokit/compression");function o(){o=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},n="function"==typeof Symbol?Symbol:{},s=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",h=n.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var s=Object.create((t&&t.prototype instanceof f?t:f).prototype),o=new P(n||[]);return i(s,"_invoke",{value:T(e,r,o)}),s}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var d={};function f(){}function v(){}function p(){}var g={};c(g,s,function(){return this});var m=Object.getPrototypeOf,y=m&&m(m(O([])));y&&y!==t&&r.call(y,s)&&(g=y);var b=p.prototype=f.prototype=Object.create(g);function E(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function w(e,t){function n(i,s,o,a){var h=l(e[i],e,s);if("throw"!==h.type){var c=h.arg,u=c.value;return u&&"object"==typeof u&&r.call(u,"__await")?t.resolve(u.__await).then(function(e){n("next",e,o,a)},function(e){n("throw",e,o,a)}):t.resolve(u).then(function(e){c.value=e,o(c)},function(e){return n("throw",e,o,a)})}a(h.arg)}var s;i(this,"_invoke",{value:function(e,r){function i(){return new t(function(t,i){n(e,r,t,i)})}return s=s?s.then(i,i):i()}})}function T(e,t,r){var i="suspendedStart";return function(n,s){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===n)throw s;return{value:void 0,done:!0}}for(r.method=n,r.arg=s;;){var o=r.delegate;if(o){var a=x(o,r);if(a){if(a===d)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===i)throw i="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i="executing";var h=l(e,t,r);if("normal"===h.type){if(i=r.done?"completed":"suspendedYield",h.arg===d)continue;return{value:h.arg,done:r.done}}"throw"===h.type&&(i="completed",r.method="throw",r.arg=h.arg)}}}function x(e,t){var r=t.method,i=e.iterator[r];if(void 0===i)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,x(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),d;var n=l(i,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,d;var s=n.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function O(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,n=function t(){for(;++i<e.length;)if(r.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:C}}function C(){return{value:void 0,done:!0}}return v.prototype=p,i(b,"constructor",{value:p,configurable:!0}),i(p,"constructor",{value:v,configurable:!0}),v.displayName=c(p,h,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,c(e,h,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},E(w.prototype),c(w.prototype,a,function(){return this}),e.AsyncIterator=w,e.async=function(t,r,i,n,s){void 0===s&&(s=Promise);var o=new w(u(t,r,i,n),s);return e.isGeneratorFunction(r)?o:o.next().then(function(e){return e.done?e.value:o.next()})},E(b),c(b,h,"Generator"),c(b,s,function(){return this}),c(b,"toString",function(){return"[object Generator]"}),e.keys=function(e){var t=Object(e),r=[];for(var i in t)r.push(i);return r.reverse(),function e(){for(;r.length;){var i=r.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},e.values=O,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(M),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(r,i){return o.type="throw",o.arg=e,t.next=r,i&&(t.method="next",t.arg=void 0),!!i}for(var n=this.tryEntries.length-1;n>=0;--n){var s=this.tryEntries[n],o=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var a=r.call(s,"catchLoc"),h=r.call(s,"finallyLoc");if(a&&h){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(a){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&r.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var s=n;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=e,o.arg=t,s?(this.method="next",this.next=s.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),M(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var i=r.completion;if("throw"===i.type){var n=i.arg;M(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:O(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},e}function a(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,"symbol"==typeof(n=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key))?n:String(n),i)}var n}function h(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function c(){return c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},c.apply(this,arguments)}function u(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,l(e,t)}function l(e,t){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},l(e,t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function v(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return f(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var p=0;function g(e){return"__private_"+p+++"_"+e}function m(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var y=0;function b(e){return"__private_"+y+++"_"+e}function E(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var w=/*#__PURE__*/b("items"),T=/*#__PURE__*/b("lastUniqueId"),x=/*#__PURE__*/function(){function e(e,t){Object.defineProperty(this,w,{writable:!0,value:void 0}),Object.defineProperty(this,T,{writable:!0,value:void 0}),E(this,w)[w]=e||[],E(this,T)[T]=(t||0)+1}var t=e.prototype;return t.addItem=function(){var e;if(2===arguments.length){var t=arguments[0];if(e=arguments[1],E(this,w)[w][t])throw"ID clash: '"+t+"'";return E(this,w)[w][t]=e,t}for(e=arguments[0]||{};;){var r=E(this,T)[T]++;if(!E(this,w)[w][r])return E(this,w)[w][r]=e,r}},t.removeItem=function(e){var t=E(this,w)[w][e];return delete E(this,w)[w][e],t},e}();[["0",10],["A",26],["a",26],["_",1],["$",1]].map(function(e){for(var t=[],r=e[0].charCodeAt(0),i=r+e[1],n=r;n<i;++n)t.push(n);return String.fromCharCode.apply(null,t)}).join("");var _=function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&r]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[63&i|128]+e[i>>8&255]+"-"+e[i>>16&255]+e[i>>24&255]+e[255&n]+e[n>>8&255]+e[n>>16&255]+e[n>>24&255]}}(),M=2e4,P=20001,O=0;function C(e){return"__private_"+O+++"_"+e}function I(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}function L(e,t){return L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},L(e,t)}var R=/*#__PURE__*/function(){function e(e,t,r){this.isLoading=void 0,this.itemsLoaded=void 0,this.itemsTotal=void 0,this.urlModifier=void 0,this.handlers=void 0,this.onStart=void 0,this.onLoad=void 0,this.onProgress=void 0,this.onError=void 0,this.isLoading=!1,this.itemsLoaded=0,this.itemsTotal=0,this.urlModifier=void 0,this.handlers=[],this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r}var t=e.prototype;return t.itemStart=function(e){this.itemsTotal++,this.isLoading||void 0!==this.onStart&&this.onStart(e,this.itemsLoaded,this.itemsTotal),this.isLoading=!0},t.itemEnd=function(e){this.itemsLoaded++,void 0!==this.onProgress&&this.onProgress(e,this.itemsLoaded,this.itemsTotal),this.itemsLoaded===this.itemsTotal&&(this.isLoading=!1,void 0!==this.onLoad&&this.onLoad())},t.itemError=function(e){void 0!==this.onError&&this.onError(e)},t.resolveURL=function(e){return this.urlModifier?this.urlModifier(e):e},t.setURLModifier=function(e){return this.urlModifier=e,this},t.addHandler=function(e,t){return this.handlers.push(e,t),this},t.removeHandler=function(e){var t=this.handlers.indexOf(e);return-1!==t&&this.handlers.splice(t,2),this},t.getHandler=function(e){for(var t=0,r=this.handlers.length;t<r;t+=2){var i=this.handlers[t],n=this.handlers[t+1];if(i.global&&(i.lastIndex=0),i.test(e))return n}return null},e}(),S=new R,D=/*#__PURE__*/function(){function e(e){this.manager=void 0,this.crossOrigin=void 0,this.withCredentials=void 0,this.path=void 0,this.resourcePath=void 0,this.requestHeader=void 0,this.manager=void 0!==e?e:S,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}var t=e.prototype;return t.load=function(e,t,r,i){},t.loadAsync=function(e,t){var r=this;return new Promise(function(i,n){r.load(e,i,t,n)})},t.parse=function(){},t.setCrossOrigin=function(e){return this.crossOrigin=e,this},t.setWithCredentials=function(e){return this.withCredentials=e,this},t.setPath=function(e){return this.path=e,this},t.setResourcePath=function(e){return this.resourcePath=e,this},t.setRequestHeader=function(e){return this.requestHeader=e,this},e}(),A=/*#__PURE__*/function(){function e(e){void 0===e&&(e=4),this.pool=void 0,this.queue=void 0,this.workers=void 0,this.workersResolve=void 0,this.workerStatus=void 0,this.workerCreator=void 0,this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}var t=e.prototype;return t._initWorker=function(e){if(!this.workers[e]){var t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}},t._getIdleWorker=function(){for(var e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1},t._onMessage=function(e,t){var r=this.workersResolve[e];if(r&&r(t),this.queue.length){var i=this.queue.shift(),n=i.msg,s=i.transfer;this.workersResolve[e]=i.resolve,this.workers[e].postMessage(n,s)}else this.workerStatus^=1<<e},t.setWorkerCreator=function(e){this.workerCreator=e},t.setWorkerLimit=function(e){this.pool=e},t.postMessage=function(e,t){var r=this;return new Promise(function(i){var n=r._getIdleWorker();-1!==n?(r._initWorker(n),r.workerStatus|=1<<n,r.workersResolve[n]=i,r.workers[n].postMessage(e,t)):r.queue.push({resolve:i,msg:e,transfer:t})})},t.destroy=function(){this.workers.forEach(function(e){return e.terminate()}),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0},e}(),B={},j=/*#__PURE__*/function(e){var t,r;function i(t){var r;return(r=e.call(this,t)||this).mimeType=void 0,r.responseType=void 0,r}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,L(t,r);var n=i.prototype;return n.load=function(e,t,r,i){var n=this;if(void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e),void 0===B[e]){B[e]=[],B[e].push({onLoad:t,onProgress:r,onError:i});var s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,a=this.responseType;fetch(s).then(function(t){if(200===t.status||0===t.status){if(0===t.status&&console.warn("FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body.getReader)return t;var r=B[e],i=t.body.getReader(),n=t.headers.get("Content-Length"),s=n?parseInt(n):0,o=0!==s,a=0,h=new ReadableStream({start:function(e){!function t(){i.read().then(function(i){var n=i.value;if(i.done)e.close();else{for(var h=new ProgressEvent("progress",{lengthComputable:o,loaded:a+=n.byteLength,total:s}),c=0,u=r.length;c<u;c++){var l=r[c];l.onProgress&&l.onProgress(h)}e.enqueue(n),t()}})}()}});return new Response(h)}throw new Error('fetch for "'+t.url+'" responded with '+t.status+": "+t.statusText)}).then(function(e){switch(a){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(function(e){return(new DOMParser).parseFromString(e,o)});case"json":return e.json();default:if(void 0===o)return e.text();var t=/charset="?([^;"\s]*)"?/i.exec(o),r=t&&t[1]?t[1].toLowerCase():void 0,i=new TextDecoder(r);return e.arrayBuffer().then(function(e){return i.decode(e)})}}).then(function(t){var r=B[e];delete B[e];for(var i=0,n=r.length;i<n;i++){var s=r[i];s.onLoad&&s.onLoad(t)}}).catch(function(t){var r=B[e];if(void 0===r)throw n.manager.itemError(e),t;delete B[e];for(var i=0,s=r.length;i<s;i++){var o=r[i];o.onError&&o.onError(t)}n.manager.itemError(e)}).finally(function(){n.manager.itemEnd(e)}),this.manager.itemStart(e)}else B[e].push({onLoad:t,onProgress:r,onError:i})},n.setResponseType=function(e){return this.responseType=e,this},n.setMimeType=function(e){return this.mimeType=e,this},i}(D);[["0",10],["A",26],["a",26],["_",1],["$",1]].map(function(e){for(var t=[],r=e[0].charCodeAt(0),i=r+e[1],n=r;n<i;++n)t.push(n);return String.fromCharCode.apply(null,t)}).join(""),function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16)}();var F=0,k={ETC1S:0,UASTC_4x4:1},U={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},G={RGBAFormat:1023,RGBA_ASTC_4x4_Format:37808,RGBA_BPTC_Format:36492,RGBA_ETC2_EAC_Format:37496,RGBA_PVRTC_4BPPV1_Format:35842,RGBA_S3TC_DXT5_Format:33779,RGB_ETC1_Format:36196,RGB_ETC2_Format:37492,RGB_PVRTC_4BPPV1_Format:35840,RGB_S3TC_DXT1_Format:33776},N=/*#__PURE__*/C("transcoderPath"),H=/*#__PURE__*/C("transcoderBinary"),X=/*#__PURE__*/C("transcoderPending"),V=/*#__PURE__*/C("workerPool"),W=/*#__PURE__*/C("workerSourceURL"),z=/*#__PURE__*/C("workerConfig"),q=/*#__PURE__*/C("supportedFileTypes"),Y=/*#__PURE__*/C("withCredentials"),K=/*#__PURE__*/C("initTranscoder"),Q=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,K,{value:Z}),Object.defineProperty(this,N,{writable:!0,value:void 0}),Object.defineProperty(this,H,{writable:!0,value:void 0}),Object.defineProperty(this,X,{writable:!0,value:void 0}),Object.defineProperty(this,V,{writable:!0,value:void 0}),Object.defineProperty(this,W,{writable:!0,value:void 0}),Object.defineProperty(this,z,{writable:!0,value:void 0}),Object.defineProperty(this,q,{writable:!0,value:void 0}),Object.defineProperty(this,Y,{writable:!0,value:void 0}),I(this,N)[N]=e.transcoderPath||"https://cdn.jsdelivr.net/npm/@xeokit/sdk/dist/basis/",I(this,H)[H]=null,I(this,X)[X]=null,I(this,V)[V]=new A,I(this,W)[W]="",e.workerLimit&&I(this,V)[V].setWorkerLimit(e.workerLimit),I(this,z)[z]=null,I(this,Y)[Y]=!1,I(this,q)[q]=["xkt2"]}var t=e.prototype;return t.init=function(e){I(this,z)[z]={astcSupported:e.astcSupported,etc1Supported:e.etc1Supported,etc2Supported:e.etc2Supported,dxtSupported:e.dxtSupported,bptcSupported:e.bptcSupported,pvrtcSupported:e.pvrtcSupported}},t.transcode=function(e,t){var r=this;return void 0===t&&(t={}),new Promise(function(i,n){var s=t;I(r,K)[K]().then(function(){return I(r,V)[V].postMessage({type:"transcode",buffers:e,taskConfig:s},e)}).then(function(e){var t=e.data,r=t.mipmaps,s=t.format,o=t.dfdTransferFn,a=t.dfdFlags;if("error"===t.type)return n(t.error);i({mipmaps:r,props:{format:s,minFilter:1===r.length?1006:1008,magFilter:1===r.length?1006:1008,encoding:2===o?3001:3e3,premultiplyAlpha:!!(1&a)}})})})},t.destroy=function(){URL.revokeObjectURL(I(this,W)[W]),I(this,V)[V].destroy(),F--},e}();function Z(){var e=this;if(!I(this,X)[X]){var t=new j;t.setPath(I(this,N)[N]),t.setWithCredentials(I(this,Y)[Y]);var r=t.loadAsync("basis_transcoder.js"),i=new j;i.setPath(I(this,N)[N]),i.setResponseType("arraybuffer"),i.setWithCredentials(I(this,Y)[Y]);var n=i.loadAsync("basis_transcoder.wasm");I(this,X)[X]=Promise.all([r,n]).then(function(t){var r=t[0],i=t[1],n=J.toString(),s=["/* constants */","let _EngineFormat = "+JSON.stringify(G),"let _TranscoderFormat = "+JSON.stringify(U),"let _BasisFormat = "+JSON.stringify(k),"/* basis_transcoder.js */",r,"/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");I(e,W)[W]=URL.createObjectURL(new Blob([s])),I(e,H)[H]=i,I(e,V)[V].setWorkerCreator(function(){var t=new Worker(I(e,W)[W]),r=I(e,H)[H].slice(0);return t.postMessage({type:"init",config:I(e,z)[z],transcoderBinary:r},[r]),t})}),F>0&&console.warn("KTX2TextureTranscoder: Multiple active KTX2TextureTranscoder may cause performance issues. Use a single KTX2TextureTranscoder instance, or call .dispose() on old instances."),F++}return I(this,X)[X]}var J=function(){var e,t,r,i=_EngineFormat,n=_TranscoderFormat,s=_BasisFormat;self.addEventListener("message",function(o){var u,l=o.data;switch(l.type){case"init":e=l.config,u=l.transcoderBinary,t=new Promise(function(e){r={wasmBinary:u,onRuntimeInitialized:e},BASIS(r)}).then(function(){r.initializeBasis(),void 0===r.KTX2File&&console.warn("KTX2TextureTranscoder: Please update Basis Universal transcoder.")});break;case"transcode":t.then(function(){try{for(var t=function(t){var o=new r.KTX2File(new Uint8Array(t));function u(){o.close(),o.delete()}if(!o.isValid())throw u(),new Error("KTX2TextureTranscoder: Invalid or unsupported .ktx2 file");var l=o.isUASTC()?s.UASTC_4x4:s.ETC1S,d=o.getWidth(),f=o.getHeight(),v=o.getLevels(),p=o.getHasAlpha(),g=o.getDFDTransferFunc(),m=o.getDFDFlags(),y=function(t,r,o,u){for(var l=t===s.ETC1S?a:h,d=0;d<l.length;d++){var f=l[d];if(e[f.if]&&f.basisFormat.includes(t)&&!(u&&f.transcoderFormat.length<2)&&(!f.needsPowerOfTwo||c(r)&&c(o)))return{transcoderFormat:f.transcoderFormat[u?1:0],engineFormat:f.engineFormat[u?1:0]}}return console.warn("KTX2TextureTranscoder: No suitable compressed texture format found. Decoding to RGBA32."),{transcoderFormat:n.RGBA32,engineFormat:i.RGBAFormat}}(l,d,f,p),b=y.transcoderFormat,E=y.engineFormat;if(!d||!f||!v)throw u(),new Error("KTX2TextureTranscoder: Invalid texture");if(!o.startTranscoding())throw u(),new Error("KTX2TextureTranscoder: .startTranscoding failed");for(var w=[],T=0;T<v;T++){var x=o.getImageLevelInfo(T,0,0),_=x.origWidth,M=x.origHeight,P=new Uint8Array(o.getImageTranscodedSizeInBytes(T,0,0,b));if(!o.transcodeImage(P,T,0,0,b,0,-1,-1))throw u(),new Error("KTX2TextureTranscoder: .transcodeImage failed.");w.push({data:P,width:_,height:M})}return u(),{width:d,height:f,hasAlpha:p,mipmaps:w,format:E,dfdTransferFn:g,dfdFlags:m}}(l.buffers[0]),o=t.width,u=t.height,d=t.hasAlpha,f=t.mipmaps,v=t.format,p=t.dfdTransferFn,g=t.dfdFlags,m=[],y=0;y<f.length;++y)m.push(f[y].data.buffer);self.postMessage({type:"transcode",id:l.id,width:o,height:u,hasAlpha:d,mipmaps:f,format:v,dfdTransferFn:p,dfdFlags:g},m)}catch(e){console.error("[BasisWorker]: "+e),self.postMessage({type:"error",id:l.id,error:e.message})}})}});var o=[{if:"astcSupported",basisFormat:[s.UASTC_4x4],transcoderFormat:[n.ASTC_4x4,n.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],priorityETC1S:Infinity,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[n.BC7_M5,n.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[n.BC1,n.BC3],engineFormat:[i.RGB_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[n.ETC1,n.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[n.ETC1],engineFormat:[i.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[n.PVRTC1_4_RGB,n.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],a=o.sort(function(e,t){return e.priorityETC1S-t.priorityETC1S}),h=o.sort(function(e,t){return e.priorityUASTC-t.priorityUASTC});function c(e){return e<=2||0==(e&e-1)&&0!==e}},$=/*#__PURE__*/function(){function e(e,t,r){this.viewer=void 0,this.view=void 0,this.gl=void 0,this.viewMatrixDataTexture=void 0,this.pbrEnabled=void 0,this.withSAO=void 0,this.backfaces=void 0,this.frontface=void 0,this.textureUnit=void 0,this.bindTexture=void 0,this.renderPass=void 0,this.shadowViewMatrix=void 0,this.shadowProjMatrix=void 0,this.pickViewMatrix=void 0,this.pickProjMatrix=void 0,this.pickZNear=void 0,this.pickZFar=void 0,this.pickInvisible=void 0,this.lineWidth=void 0,this.lastProgramId=void 0,this.occlusionTexture=void 0,this.viewer=e,this.view=t,this.gl=r,this.reset()}return e.prototype.reset=function(){this.lastProgramId=-1,this.pbrEnabled=!1,this.withSAO=!1,this.backfaces=!1,this.frontface=!0,this.textureUnit=0,this.shadowViewMatrix=null,this.shadowProjMatrix=null,this.pickViewMatrix=null,this.pickProjMatrix=null,this.pickZNear=.01,this.pickZFar=5e3,this.pickInvisible=!1,this.lineWidth=1,this.occlusionTexture=null},h(e,[{key:"nextTextureUnit",get:function(){var e=this.textureUnit;return this.textureUnit=(this.textureUnit+1)%t.WEBGL_INFO.MAX_TEXTURE_UNITS,e}}]),e}(),ee=0;function te(e){return"__private_"+ee+++"_"+e}function re(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}function ie(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}Boolean("object"!=typeof process||"[object process]"!==String(process)||process.browser),"undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);var ne="object"!=typeof process||"[object process]"!==String(process)||process.browser,se="undefined"!=typeof window&&void 0!==window.orientation;function oe(e){return oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},oe(e)}function ae(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==oe(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!==oe(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===oe(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}"undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);var he=/*#__PURE__*/function(){function e(e,t){var r=this;ae(this,"name",void 0),ae(this,"workerThread",void 0),ae(this,"isRunning",!0),ae(this,"result",void 0),ae(this,"_resolve",function(){}),ae(this,"_reject",function(){}),this.name=e,this.workerThread=t,this.result=new Promise(function(e,t){r._resolve=e,r._reject=t})}var t=e.prototype;return t.postMessage=function(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})},t.done=function(e){ie(this.isRunning),this.isRunning=!1,this._resolve(e)},t.error=function(e){ie(this.isRunning),this.isRunning=!1,this._reject(e)},e}(),ce=/*#__PURE__*/function(){function e(){}return e.prototype.terminate=function(){},e}(),ue=new Map;function le(e){var t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function de(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,i=r||new Set;if(e)if(fe(e))i.add(e);else if(fe(e.buffer))i.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"==typeof e)for(var n in e)de(e[n],t,i);return void 0===r?Array.from(i):[]}function fe(e){return!!e&&(e instanceof ArrayBuffer||"undefined"!=typeof MessagePort&&e instanceof MessagePort||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)}var ve=function(){},pe=/*#__PURE__*/function(){function e(e){ae(this,"name",void 0),ae(this,"source",void 0),ae(this,"url",void 0),ae(this,"terminated",!1),ae(this,"worker",void 0),ae(this,"onMessage",void 0),ae(this,"onError",void 0),ae(this,"_loadableURL","");var t=e.name,r=e.source,i=e.url;ie(r||i),this.name=t,this.source=r,this.url=i,this.onMessage=ve,this.onError=function(e){return console.log(e)},this.worker=ne?this._createBrowserWorker():this._createNodeWorker()}e.isSupported=function(){return"undefined"!=typeof Worker&&ne||void 0!==ce&&!ne};var t=e.prototype;return t.destroy=function(){this.onMessage=ve,this.onError=ve,this.worker.terminate(),this.terminated=!0},t.postMessage=function(e,t){t=t||de(e),this.worker.postMessage(e,t)},t._getErrorFromErrorEvent=function(e){var t="Failed to load ";return t+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(t+="".concat(e.message," in ")),e.lineno&&(t+=":".concat(e.lineno,":").concat(e.colno)),new Error(t)},t._createBrowserWorker=function(){var e=this;this._loadableURL=function(e){ie(e.source&&!e.url||!e.source&&e.url);var t,r=ue.get(e.source||e.url);return r||(e.url&&(r=(t=e.url).startsWith("http")?le("try {\n  importScripts('".concat(t,"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}")):t,ue.set(e.url,r)),e.source&&(r=le(e.source),ue.set(e.source,r))),ie(r),r}({source:this.source,url:this.url});var t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=function(t){t.data?e.onMessage(t.data):e.onError(new Error("No data received"))},t.onerror=function(t){e.onError(e._getErrorFromErrorEvent(t)),e.terminated=!0},t.onmessageerror=function(e){return console.error(e)},t},t._createNodeWorker=function(){var e,t=this;if(this.url){var r=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new ce(r,{eval:!1})}else{if(!this.source)throw new Error("no worker");e=new ce(this.source,{eval:!0})}return e.on("message",function(e){t.onMessage(e)}),e.on("error",function(e){t.onError(e)}),e.on("exit",function(e){}),e},h(e,[{key:"isRunning",get:function(){return Boolean(this.onMessage)}}]),e}(),ge=/*#__PURE__*/function(){function e(e){ae(this,"name","unnamed"),ae(this,"source",void 0),ae(this,"url",void 0),ae(this,"maxConcurrency",1),ae(this,"maxMobileConcurrency",1),ae(this,"onDebug",function(){}),ae(this,"reuseWorkers",!0),ae(this,"props",{}),ae(this,"jobQueue",[]),ae(this,"idleQueue",[]),ae(this,"count",0),ae(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}e.isSupported=function(){return pe.isSupported()};var t=e.prototype;return t.destroy=function(){this.idleQueue.forEach(function(e){return e.destroy()}),this.isDestroyed=!0},t.setProps=function(e){this.props=c({},this.props,e),void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)},t.startJob=function(e){try{var t=arguments,r=this,i=t.length>1&&void 0!==t[1]?t[1]:function(e,t,r){return e.done(r)},n=t.length>2&&void 0!==t[2]?t[2]:function(e,t){return e.error(t)},s=new Promise(function(t){return r.jobQueue.push({name:e,onMessage:i,onError:n,onStart:t}),r});return r._startQueuedJob(),Promise.resolve(s)}catch(e){return Promise.reject(e)}},t._startQueuedJob=function(){try{var e=this;if(!e.jobQueue.length)return Promise.resolve();var t=e._getAvailableWorker();if(!t)return Promise.resolve();var r=e.jobQueue.shift(),i=function(){if(r){e.onDebug({message:"Starting job",name:r.name,workerThread:t,backlog:e.jobQueue.length});var i=new he(r.name,t);t.onMessage=function(e){return r.onMessage(i,e.type,e.payload)},t.onError=function(e){return r.onError(i,e)},r.onStart(i);var n=function(e,t){try{var r=Promise.resolve(i.result).then(function(){})}catch(e){return t(!0,e)}return r&&r.then?r.then(t.bind(null,!1),t.bind(null,!0)):t(!1,r)}(0,function(r,i){if(e.returnWorkerToQueue(t),r)throw i;return i});if(n&&n.then)return n.then(function(){})}}();return Promise.resolve(i&&i.then?i.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},t.returnWorkerToQueue=function(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()},t._getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;var e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new pe({name:e,source:this.source,url:this.url})}return null},t._getMaxConcurrency=function(){return se?this.maxMobileConcurrency:this.maxConcurrency},e}(),me={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:function(){}},ye=/*#__PURE__*/function(){function e(e){ae(this,"props",void 0),ae(this,"workerPools",new Map),this.props=c({},me),this.setProps(e),this.workerPools=new Map}e.isSupported=function(){return pe.isSupported()},e.getWorkerFarm=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(e._workerFarm=e._workerFarm||new e({})).setProps(t),e._workerFarm};var t=e.prototype;return t.destroy=function(){for(var e,t=v(this.workerPools.values());!(e=t()).done;)e.value.destroy();this.workerPools=new Map},t.setProps=function(e){this.props=c({},this.props,e);for(var t,r=v(this.workerPools.values());!(t=r()).done;)t.value.setProps(this._getWorkerPoolProps())},t.getWorkerPool=function(e){var t=e.name,r=e.source,i=e.url,n=this.workerPools.get(t);return n||((n=new ge({name:t,source:r,url:i})).setProps(this._getWorkerPoolProps()),this.workerPools.set(t,n)),n},t._getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},e}();ae(ye,"_workerFarm",void 0),e.createVec3(),e.createVec3(),e.createMat4(),n.newFloatArray(3),n.newFloatArray(3),n.newFloatArray(3),n.newFloatArray(3),n.newFloatArray(3),n.newFloatArray(3),n.newFloatArray(3);var be=/*#__PURE__*/te("positionsDecompressed"),Ee=/*#__PURE__*/te("positionsWorld");function we(){return!("object"==typeof process&&"[object process]"===String(process)&&!process.browser)||function(e){if("undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"==typeof process.versions&&Boolean(process.versions.electron))return!0;var t="object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}()}new(/*#__PURE__*/function(){function t(){this.object=void 0,this.mesh=void 0,this.meshIndex=void 0,this.geometry=void 0,this.geometryBucket=void 0,this.geometryBucketIndex=void 0,Object.defineProperty(this,be,{writable:!0,value:void 0}),Object.defineProperty(this,Ee,{writable:!0,value:void 0}),this.object=null,this.mesh=null,this.meshIndex=0,this.geometry=null,this.geometryBucket=null,this.geometryBucketIndex=0,re(this,be)[be]=null,re(this,Ee)[Ee]=null}return t.prototype.reset=function(){re(this,be)[be]=null,re(this,Ee)[Ee]=null},function(e,t,r){t&&function(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,"symbol"==typeof(n=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key))?n:String(n),i)}var n}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1})}(t,[{key:"totalGeometryBuckets",get:function(){var e=0;if(this.object)for(var t=0,r=this.object.meshes.length;t<r;t++)e+=this.object.meshes[t].geometry.geometryBuckets.length;return e}},{key:"numPrimitives",get:function(){var e=this.geometry.primitive;return this.geometryBucket.indices.length/(20002===e?3:20001===e?2:1)}},{key:"positionsDecompressed",get:function(){return re(this,be)[be]||(re(this,be)[be]=new Float32Array(this.geometryBucket.positionsCompressed.length),s.decompressPositions3(this.geometryBucket.positionsCompressed,this.geometry.positionsDecompressMatrix,re(this,be)[be])),re(this,be)[be]}},{key:"positionsWorld",get:function(){if(!re(this,Ee)[Ee]){var t=this.positionsDecompressed;re(this,Ee)[Ee]=new Float64Array(t.length),e.transformPositions3(t,this.mesh.matrix,re(this,Ee)[Ee])}return re(this,Ee)[Ee]}},{key:"uvsDecompressed",get:function(){return null}}]),t}()),e.createVec3(),e.createVec3(),e.createVec3(),e.createVec3(),e.createVec3(),e.createVec3(),e.createVec3();var Te={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document,process:"object"==typeof process&&process},xe=Te.window||Te.self||Te.global,_e=Te.process||{},Me="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source";we();var Pe,Oe=/*#__PURE__*/function(){function e(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";ae(this,"storage",void 0),ae(this,"id",void 0),ae(this,"config",void 0),this.storage=function(e){try{var t=window[e],r="__storage_test__";return t.setItem(r,r),t.removeItem(r),t}catch(e){return null}}(r),this.id=e,this.config=t,this._loadConfiguration()}var t=e.prototype;return t.getConfiguration=function(){return this.config},t.setConfiguration=function(e){if(Object.assign(this.config,e),this.storage){var t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}},t._loadConfiguration=function(){var e={};if(this.storage){var t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this},e}();function Ce(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600,n=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>i&&(r=Math.min(r,i/e.width));var s=e.width*r,o=e.height*r,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(n,");"),"background-size:".concat(s,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),a]}function Ie(e){return"string"==typeof e?Pe[e.toUpperCase()]||Pe.WHITE:e}function Le(e,t){if(!e)throw new Error(t||"Assertion failed")}function Re(){var e,t,r;if(we&&"performance"in xe)e=null==xe||null===(t=xe.performance)||void 0===t||null===(r=t.now)||void 0===r?void 0:r.call(t);else if("hrtime"in _e){var i,n=null==_e||null===(i=_e.hrtime)||void 0===i?void 0:i.call(_e);e=1e3*n[0]+n[1]/1e6}else e=Date.now();return e}!function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"}(Pe||(Pe={}));var Se={debug:we&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},De={enabled:!0,level:0};function Ae(){}var Be={},je={once:!0},Fe=/*#__PURE__*/function(){function e(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:""}).id;ae(this,"id",void 0),ae(this,"VERSION",Me),ae(this,"_startTs",Re()),ae(this,"_deltaTs",Re()),ae(this,"_storage",void 0),ae(this,"userData",{}),ae(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new Oe("__probe-".concat(this.id,"__"),De),this.timeStamp("".concat(this.id," started")),function(e){for(var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"],i=Object.getPrototypeOf(e),n=function(){var i=t.value;"function"==typeof e[i]&&(r.find(function(e){return i===e})||(e[i]=e[i].bind(e)))},s=v(Object.getOwnPropertyNames(i));!(t=s()).done;)n()}(this),Object.seal(this)}var t=e.prototype;return t.isEnabled=function(){return this._storage.config.enabled},t.getLevel=function(){return this._storage.config.level},t.getTotal=function(){return Number((Re()-this._startTs).toPrecision(10))},t.getDelta=function(){return Number((Re()-this._deltaTs).toPrecision(10))},t.getPriority=function(){return this.level},t.enable=function(){return this._storage.setConfiguration({enabled:!(arguments.length>0&&void 0!==arguments[0])||arguments[0]}),this},t.setLevel=function(e){return this._storage.setConfiguration({level:e}),this},t.get=function(e){return this._storage.config[e]},t.set=function(e,t){var r;this._storage.setConfiguration(((r={})[e]=t,r))},t.settings=function(){console.table?console.table(this._storage.config):console.log(this._storage.config)},t.assert=function(e,t){Le(e,t)},t.warn=function(e){return this._getLogFunction(0,e,Se.warn,arguments,je)},t.error=function(e){return this._getLogFunction(0,e,Se.error,arguments)},t.deprecated=function(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))},t.removed=function(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))},t.probe=function(e,t){return this._getLogFunction(e,t,Se.log,arguments,{time:!0,once:!0})},t.log=function(e,t){return this._getLogFunction(e,t,Se.debug,arguments)},t.info=function(e,t){return this._getLogFunction(e,t,console.info,arguments)},t.once=function(e,t){for(var r=arguments.length,i=new Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];return this._getLogFunction(e,t,Se.debug||Se.info,arguments,je)},t.table=function(e,t,r){return t?this._getLogFunction(e,t,console.table||Ae,r&&[r],{tag:Ge(t)}):Ae},t.image=function(e){var t=e.image,r=e.message,i=void 0===r?"":r,n=e.scale,s=void 0===n?1:n;return this._shouldLog(e.logLevel||e.priority)?we?function(e){var t,r=e.image,i=e.message,n=void 0===i?"":i,s=e.scale,o=void 0===s?1:s;if("string"==typeof r){var a=new Image;return a.onload=function(){var e,t=Ce(a,n,o);(e=console).log.apply(e,t)},a.src=r,Ae}var h=r.nodeName||"";if("img"===h.toLowerCase())return(t=console).log.apply(t,Ce(r,n,o)),Ae;if("canvas"===h.toLowerCase()){var c=new Image;return c.onload=function(){var e;return(e=console).log.apply(e,Ce(c,n,o))},c.src=r.toDataURL(),Ae}return Ae}({image:t,message:i,scale:s}):(console.warn("removed"),Ae):Ae},t.time=function(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)},t.timeEnd=function(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)},t.timeStamp=function(e,t){return this._getLogFunction(e,t,console.timeStamp||Ae)},t.group=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1},i=Ue({logLevel:e,message:t,opts:r});return i.method=(r.collapsed?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)},t.groupCollapsed=function(e,t){return this.group(e,t,Object.assign({},arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{collapsed:!0}))},t.groupEnd=function(e){return this._getLogFunction(e,"",console.groupEnd||Ae)},t.withGroup=function(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}},t.trace=function(){console.trace&&console.trace()},t._shouldLog=function(e){return this.isEnabled()&&this.getLevel()>=ke(e)},t._getLogFunction=function(e,t,r,i,n){if(this._shouldLog(e)){var s;n=Ue({logLevel:e,message:t,args:i,opts:n}),Le(r=r||n.method),n.total=this.getTotal(),n.delta=this.getDelta(),this._deltaTs=Re();var o=n.tag||n.message;if(n.once){if(Be[o])return Ae;Be[o]=Re()}return t=function(e,t,r){if("string"==typeof t){var i=r.time?function(e){var t=Math.max((arguments.length>1&&void 0!==arguments[1]?arguments[1]:8)-e.length,0);return"".concat(" ".repeat(t)).concat(e)}(function(e){return e<10?"".concat(e.toFixed(2),"ms"):e<100?"".concat(e.toFixed(1),"ms"):e<1e3?"".concat(e.toFixed(0),"ms"):"".concat((e/1e3).toFixed(2),"s")}(r.total)):"";n=t=r.time?"".concat(e,": ").concat(i,"  ").concat(t):"".concat(e,": ").concat(t),s=r.color,o=r.background,we||"string"!=typeof n||(s&&(s=Ie(s),n="[".concat(s,"m").concat(n,"[39m")),o&&(s=Ie(o),n="[".concat(o+10,"m").concat(n,"[49m"))),t=n}var n,s,o;return t}(this.id,n.message,n),(s=r).bind.apply(s,[console,t].concat(n.args))}return Ae},h(e,[{key:"level",get:function(){return this.getLevel()},set:function(e){this.setLevel(e)}},{key:"priority",get:function(){return this.level},set:function(e){this.level=e}}]),e}();function ke(e){if(!e)return 0;var t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return Le(Number.isFinite(t)&&t>=0),t}function Ue(e){var t=e.logLevel,r=e.message;e.logLevel=ke(t);for(var i=e.args?Array.from(e.args):[];i.length&&i.shift()!==r;);switch(typeof t){case"string":case"function":void 0!==r&&i.unshift(r),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());var n=typeof e.message;return Le("string"===n||"object"===n),Object.assign(e,{args:i},e.opts)}function Ge(e){for(var t in e)for(var r in e[t])return r||"untitled";return"empty"}function Ne(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,"symbol"==typeof(n=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key))?n:String(n),i)}var n}function He(e,t,r){return t&&Ne(e.prototype,t),r&&Ne(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Xe(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Ve(e,t)}function Ve(e,t){return Ve=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ve(e,t)}function We(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}ae(Fe,"VERSION",Me),new Fe({id:"loaders.gl"}),new(/*#__PURE__*/function(){function e(){ae(this,"console",void 0),this.console=console}var t=e.prototype;return t.log=function(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=this.console.log).bind.apply(e,[this.console].concat(r))},t.info=function(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=this.console.info).bind.apply(e,[this.console].concat(r))},t.warn=function(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=this.console.warn).bind.apply(e,[this.console].concat(r))},t.error=function(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=this.console.error).bind.apply(e,[this.console].concat(r))},e}()),new Fe({id:"loaders.gl"});var ze=0;function qe(e){return"__private_"+ze+++"_"+e}function Ye(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var Ke=0;function Qe(e){return"__private_"+Ke+++"_"+e}function Ze(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var Je,$e=/*#__PURE__*/Qe("items"),et=/*#__PURE__*/Qe("lastUniqueId"),tt=/*#__PURE__*/function(){function e(e,t){Object.defineProperty(this,$e,{writable:!0,value:void 0}),Object.defineProperty(this,et,{writable:!0,value:void 0}),Ze(this,$e)[$e]=e||[],Ze(this,et)[et]=(t||0)+1}var t=e.prototype;return t.addItem=function(){var e;if(2===arguments.length){var t=arguments[0];if(e=arguments[1],Ze(this,$e)[$e][t])throw"ID clash: '"+t+"'";return Ze(this,$e)[$e][t]=e,t}for(e=arguments[0]||{};;){var r=Ze(this,et)[et]++;if(!Ze(this,$e)[$e][r])return Ze(this,$e)[$e][r]=e,r}},t.removeItem=function(e){var t=Ze(this,$e)[$e][e];return delete Ze(this,$e)[$e][e],t},e}(),rt=/*#__PURE__*/function(){function e(){this._head=void 0,this._headLength=void 0,this._tail=void 0,this._index=void 0,this._length=void 0,this._head=[],this._headLength=0,this._tail=[],this._index=0,this._length=0}var t,r,i=e.prototype;return i.shift=function(){if(this._index>=this._headLength){var e=this._head;if(e.length=0,this._head=this._tail,this._tail=e,this._index=0,this._headLength=this._head.length,!this._headLength)return}var t=this._head[this._index];return this._index<0?delete this._head[this._index++]:this._head[this._index++]=void 0,this._length--,t},i.push=function(e){return this._length++,this._tail.push(e),this},i.unshift=function(e){return this._head[--this._index]=e,this._length++,this},i.clear=function(){this._head=[],this._headLength=0,this._tail=[],this._index=0,this._length=0},t=e,(r=[{key:"length",get:function(){return this._length}}])&&function(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,"symbol"==typeof(n=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key))?n:String(n),i)}var n}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function it(e){return new FloatArrayClass(e||4)}function nt(e){return n.newFloatArray(e||16)}[["0",10],["A",26],["a",26],["_",1],["$",1]].map(function(e){for(var t=[],r=e[0].charCodeAt(0),i=r+e[1],n=r;n<i;++n)t.push(n);return String.fromCharCode.apply(null,t)}).join(""),function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16)}(),it(),it(),new FloatArrayClass(2),nt(),nt(),n.newFloatArray(3),nt(),n.newFloatArray(3),(Je={})[4e5]={abbrev:"m"},Je[400001]={abbrev:"cm"},Je[400002]={abbrev:"mm"},Je[400003]={abbrev:"yd"},Je[400004]={abbrev:"ft"},Je[400005]={abbrev:"in"},nt(),n.newFloatArray(3),n.newFloatArray(3),n.newFloatArray(3),n.newFloatArray(3),n.newFloatArray(3),n.newFloatArray(3),n.newFloatArray(3),nt(),nt();var st={viewerId:"",time:0,startTime:0,prevTime:0,deltaTime:0},ot=/*#__PURE__*/qe("viewersRenderInfo"),at=/*#__PURE__*/qe("viewerIDMap"),ht=/*#__PURE__*/qe("taskQueue"),ct=/*#__PURE__*/qe("taskBudget"),ut=/*#__PURE__*/qe("lastTime"),lt=/*#__PURE__*/qe("elapsedTime"),dt=/*#__PURE__*/qe("runTasks"),ft=/*#__PURE__*/qe("runTasksUntil"),vt=/*#__PURE__*/qe("fireTickEvents"),pt=/*#__PURE__*/qe("renderViewers");function gt(e){Ye(this,ft)[ft](e+Ye(this,ct)[ct]),this.getNumTasks(),Ye(this,ct)}function mt(e){void 0===e&&(e=-1);for(var t=(new Date).getTime(),r=0;Ye(this,ht)[ht].length>0&&(e<0||t<e);){var i=Ye(this,ht)[ht].shift(),n=Ye(this,ht)[ht].shift();n?i.call(n):i(),t=(new Date).getTime(),r++}return r}function yt(e){for(var t in st.time=e,Et.viewers)if(this.viewers.hasOwnProperty(t)){var r=this.viewers[t];st.viewerId=t,st.startTime=r.startTime,st.deltaTime=null!=st.prevTime?st.time-st.prevTime:0,r.onTick.dispatch(r,st)}st.prevTime=e}function bt(){for(var e in this.viewers)if(this.viewers.hasOwnProperty(e)){var t=this.viewers[e],r=Ye(this,ot)[ot][e];r||(r=Ye(this,ot)[ot][e]={}),t.render({})}}var Et=new(/*#__PURE__*/function(){function e(){var e=this;Object.defineProperty(this,pt,{value:bt}),Object.defineProperty(this,vt,{value:yt}),Object.defineProperty(this,ft,{value:mt}),Object.defineProperty(this,dt,{value:gt}),this.viewers=void 0,Object.defineProperty(this,ot,{writable:!0,value:{}}),Object.defineProperty(this,at,{writable:!0,value:new tt}),Object.defineProperty(this,ht,{writable:!0,value:new rt}),Object.defineProperty(this,ct,{writable:!0,value:10}),Object.defineProperty(this,ut,{writable:!0,value:0}),Object.defineProperty(this,lt,{writable:!0,value:0}),this.viewers={},requestAnimationFrame(function t(){var r=Date.now();Ye(e,ut)[ut]>0&&(Ye(e,lt)[lt]=r-Ye(e,ut)[ut]),Ye(e,dt)[dt](r),Ye(e,vt)[vt](r),Ye(e,pt)[pt](),Ye(e,ut)[ut]=r,requestAnimationFrame(t)})}var t=e.prototype;return t.registerViewer=function(e){if(e.id){if(this.viewers[e.id])return void console.error("[ERROR] Viewer "+function(e){return function(e){return!isNaN(parseFloat(e))&&isFinite(e)}(e)?""+e:"'"+e+"'"}(e.id)+" already exists")}else e.id=Ye(this,at)[at].addItem({});this.viewers[e.id]=e,Ye(this,ot)[ot][e.id]={}},t.deregisterViewer=function(e){this.viewers[e.id]&&(Ye(this,at)[at].removeItem(e.id),delete this.viewers[e.id],delete Ye(this,ot)[ot][e.id])},t.scheduleTask=function(e,t){Ye(this,ht)[ht].push(e),Ye(this,ht)[ht].push(t)},t.getNumTasks=function(){return Ye(this,ht)[ht].length},e}()),wt=/*#__PURE__*/qe("state"),Tt=/*#__PURE__*/function(e){function t(t,r){var i;return void 0===r&&(r={}),(i=e.call(this,t,r)||this).view=void 0,Object.defineProperty(We(i),wt,{writable:!0,value:void 0}),i.view=t,Ye(We(i),wt)[wt]={type:"ambient",color:new Float32Array(r.color||[.7,.7,.7]),intensity:null!=r.intensity?r.intensity:1},i.view.registerLight(We(i)),i}return Xe(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.view.deregisterLight(this)},He(t,[{key:"color",get:function(){return Ye(this,wt)[wt].color},set:function(e){Ye(this,wt)[wt].color.set(e),this.view.redraw()}},{key:"intensity",get:function(){return Ye(this,wt)[wt].intensity},set:function(e){Ye(this,wt)[wt].intensity=void 0!==e?e:1,this.view.redraw()}}]),t}(r.Component),xt=/*#__PURE__*/qe("state"),_t=/*#__PURE__*/function(e){function t(t,r){var i;return void 0===r&&(r={}),(i=e.call(this,t,r)||this).view=void 0,Object.defineProperty(We(i),xt,{writable:!0,value:void 0}),i.view=t,Ye(We(i),xt)[xt]={type:"dir",dir:new Float32Array(r.dir||[1,1,1]),color:new Float32Array(r.color||[.7,.7,.8]),intensity:null!=r.intensity?r.intensity:1,space:r.space||"view"},i.view.registerLight(We(i)),i}return Xe(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.view.deregisterLight(this),this.view.redraw()},He(t,[{key:"dir",get:function(){return Ye(this,xt)[xt].dir},set:function(e){Ye(this,xt)[xt].dir.set(e),this.view.redraw()}},{key:"color",get:function(){return Ye(this,xt)[xt].color},set:function(e){Ye(this,xt)[xt].color.set(e),this.view.redraw()}},{key:"intensity",get:function(){return Ye(this,xt)[xt].intensity},set:function(e){Ye(this,xt)[xt].intensity=e,this.view.redraw()}}]),t}(r.Component),Mt=/*#__PURE__*/qe("state"),Pt=/*#__PURE__*/function(e){function t(t,r){var i;return void 0===r&&(r={}),(i=e.call(this,t,r)||this).view=void 0,Object.defineProperty(We(i),Mt,{writable:!0,value:void 0}),i.view=t,Ye(We(i),Mt)[Mt]={type:"point",pos:new Float64Array(r.pos||[1,1,1]),color:new Float32Array(r.color||[.7,.7,.8]),intensity:1,attenuation:new Float32Array([r.constantAttenuation,r.linearAttenuation,r.quadraticAttenuation]),space:r.space||"view"},i.view.registerLight(We(i)),i}return Xe(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.view.deregisterLight(this),this.view.redraw()},He(t,[{key:"pos",get:function(){return Ye(this,Mt)[Mt].pos},set:function(e){Ye(this,Mt)[Mt].pos.set(e||[1,1,1]),this.view.redraw()}},{key:"color",get:function(){return Ye(this,Mt)[Mt].color},set:function(e){Ye(this,Mt)[Mt].color.set(e||[.7,.7,.8]),this.view.redraw()}},{key:"intensity",get:function(){return Ye(this,Mt)[Mt].intensity},set:function(e){e!==Ye(this,Mt)[Mt].intensity&&(Ye(this,Mt)[Mt].intensity=e,this.view.redraw())}},{key:"constantAttenuation",get:function(){return Ye(this,Mt)[Mt].attenuation[0]},set:function(e){Ye(this,Mt)[Mt].attenuation[0]=e,this.view.redraw()}},{key:"linearAttenuation",get:function(){return Ye(this,Mt)[Mt].attenuation[1]},set:function(e){Ye(this,Mt)[Mt].attenuation[1]=e,this.view.redraw()}},{key:"quadraticAttenuation",get:function(){return Ye(this,Mt)[Mt].attenuation[2]},set:function(e){Ye(this,Mt)[Mt].attenuation[2]=e,this.view.redraw()}}]),t}(r.Component),Ot={NOT_RENDERED:0,COLOR_OPAQUE:1,COLOR_TRANSPARENT:2,SILHOUETTE_HIGHLIGHTED:3,SILHOUETTE_SELECTED:4,SILHOUETTE_XRAYED:5,EDGES_COLOR_OPAQUE:6,EDGES_COLOR_TRANSPARENT:7,EDGES_HIGHLIGHTED:8,EDGES_SELECTED:9,EDGES_XRAYED:10,PICK:11},Ct=e.createVec4(),It=/*#__PURE__*/g("hash"),Lt=/*#__PURE__*/g("program"),Rt=/*#__PURE__*/g("needRebuild"),St=/*#__PURE__*/g("uniforms"),Dt=/*#__PURE__*/g("samplers"),At=/*#__PURE__*/g("build"),Bt=/*#__PURE__*/g("buildShader"),jt=/*#__PURE__*/g("getValid"),Ft=/*#__PURE__*/g("bind"),kt=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,Ft,{value:Ht}),Object.defineProperty(this,jt,{value:Nt}),Object.defineProperty(this,Bt,{value:Gt}),Object.defineProperty(this,At,{value:Ut}),this.errors=void 0,this.renderContext=void 0,Object.defineProperty(this,It,{writable:!0,value:void 0}),Object.defineProperty(this,Lt,{writable:!0,value:void 0}),Object.defineProperty(this,Rt,{writable:!0,value:void 0}),Object.defineProperty(this,St,{writable:!0,value:void 0}),Object.defineProperty(this,Dt,{writable:!0,value:void 0}),this.renderContext=e,m(this,Rt)[Rt]=!0,m(this,At)[At]()}var t=e.prototype;return t.needRebuild=function(){m(this,Rt)[Rt]=!0},t.draw=function(e){if(m(this,Lt)[Lt]&&!m(this,jt)[jt]()&&(m(this,Lt)[Lt].destroy(),m(this,Lt)[Lt]=null),!m(this,Lt)[Lt]){if(m(this,At)[At](),this.errors)return;this.renderContext.lastProgramId=-1}var t=e.renderState,r=m(this,Lt)[Lt],i=this.renderContext,n=i.renderPass,s=this.renderContext.gl,o=this.renderContext.view,a=m(this,St)[St],h=m(this,Dt)[Dt];if(i.lastProgramId!==r.id&&(i.lastProgramId=r.id,m(this,Ft)[Ft]()),a.renderPass&&s.uniform1i(a.renderPass,n),a.projMatrix&&s.uniformMatrix4fv(a.projMatrix,!1,o.camera.projMatrix),a.worldMatrix&&s.uniformMatrix4fv(a.worldMatrix,!1,e.rendererModel.worldMatrix),a.color)if(n===Ot.SILHOUETTE_XRAYED){var c=o.xrayMaterial,u=c.fillColor;s.uniform4f(a.color,u[0],u[1],u[2],c.fillAlpha)}else if(n===Ot.SILHOUETTE_HIGHLIGHTED){var l=o.highlightMaterial,d=l.fillColor;s.uniform4f(a.color,d[0],d[1],d[2],l.fillAlpha)}else if(n===Ot.SILHOUETTE_SELECTED){var f=o.selectedMaterial,v=f.fillColor;s.uniform4f(a.color,v[0],v[1],v[2],f.fillAlpha)}else s.uniform4fv(a.color,new Float32Array([1,1,1]));h.viewMatrices&&t.dataTextureSet.viewMatrices.bindTexture(r,h.viewMatrices,i.nextTextureUnit),h.positions&&t.dataTextureSet.positions.bindTexture(r,h.positions,i.nextTextureUnit),h.eachMeshMatrices&&t.dataTextureSet.eachMeshMatrices.bindTexture(r,h.eachMeshMatrices,i.nextTextureUnit),h.eachMeshAttributes&&t.dataTextureSet.eachMeshAttributes.bindTexture(r,h.eachMeshAttributes,i.nextTextureUnit),h.eachPrimitiveMesh&&(t.numIndices8Bits>0&&(t.dataTextureSet.eachPrimitiveMesh_8Bits.bindTexture(r,h.eachPrimitiveMesh,i.nextTextureUnit),t.dataTextureSet.indices_8Bits.bindTexture(r,h.indices,i.nextTextureUnit),s.drawArrays(s.TRIANGLES,0,t.numIndices8Bits)),t.numIndices16Bits>0&&(t.dataTextureSet.eachPrimitiveMesh_16Bits.bindTexture(r,h.eachPrimitiveMesh,i.nextTextureUnit),t.dataTextureSet.indices_16Bits.bindTexture(r,h.indices,i.nextTextureUnit),s.drawArrays(s.TRIANGLES,0,t.numIndices16Bits)),t.numIndices32Bits>0&&(t.dataTextureSet.eachPrimitiveMesh_32Bits.bindTexture(r,h.eachPrimitiveMesh,i.nextTextureUnit),t.dataTextureSet.indices_32Bits.bindTexture(r,h.indices,i.nextTextureUnit),s.drawArrays(s.TRIANGLES,0,t.numIndices32Bits))),h.baseColorMap&&h.baseColorMap.bindTexture(t.materialTextureSet.colorTexture.texture2D,i.nextTextureUnit),h.metallicRoughMap&&h.metallicRoughMap.bindTexture(t.materialTextureSet.metallicRoughnessTexture.texture2D,i.nextTextureUnit),h.emissiveMap&&h.emissiveMap.bindTexture(t.materialTextureSet.emissiveTexture.texture2D,i.nextTextureUnit),h.occlusionMap&&h.occlusionMap.bindTexture(t.materialTextureSet.occlusionTexture.texture2D,i.nextTextureUnit)},t.destroy=function(){m(this,Lt)[Lt]&&m(this,Lt)[Lt].destroy(),m(this,Lt)[Lt]=null},h(e,[{key:"vertHeader",get:function(){return"#version 300 es\n                #ifdef GL_FRAGMENT_PRECISION_HIGH\n                precision highp float;\n                precision highp int;\n                precision highp usampler2D;\n                precision highp isampler2D;\n                precision highp sampler2D;\n                #else\n                precision mediump float;\n                precision mediump int;\n                precision mediump usampler2D;\n                precision mediump isampler2D;\n                precision mediump sampler2D;\n                uniform int renderPass;\n                #endif"}},{key:"vertDataTextureDefs",get:function(){return"uniform mediump sampler2D eachMeshMatrices;\n                uniform lowp usampler2D eachMeshAttributes;\n                uniform highp sampler2D eachMeshOffset;\n                uniform mediump usampler2D positions;\n                uniform highp usampler2D indices;\n                uniform mediump usampler2D eachPrimitiveMesh;\n                uniform highp sampler2D cameraMatrices;\n                uniform highp sampler2D sceneModelRendererMatrices;"}},{key:"vertLogDepthBufDefs",get:function(){return this.renderContext.view.logarithmicDepthBufferEnabled?"uniform float logDepthBufFC;\n                    out float fragDepth;\n                    bool isPerspectiveMatrix(mat4 m) {\n                        return (m[2][3] == - 1.0);\n                    }\n                    out float isPerspective;":""}},{key:"vertDataTextureSamples",get:function(){return""}},{key:"vertLogDepthBufOutputs",get:function(){return this.renderContext.view.logarithmicDepthBufferEnabled?"fragDepth = 1.0 + clipPos.w;\n                    isPerspective = float (isPerspectiveMatrix(projMatrix));":""}},{key:"fragmentShader",get:function(){return this.fragHeader+"\n        "+this.fragGammaDefs+"\n        "+this.fragSectionPlaneDefs+"\n        "+this.fragLightDefs+"\n        "+this.fragLogDepthBufDefs+"\n        void main(void) {\n            "+this.fragSectionPlanesSlice+"\n            "+this.fragLighting+"\n            "+this.fragLogDepthBufOutput+"\n        }"}},{key:"fragHeader",get:function(){return"#version 300 es\n        #ifdef GL_FRAGMENT_PRECISION_HIGH\n       precision highp float;\n        precision highp int;\n        #else\n        precision mediump float;\n        precision mediump int;\n        #endif"}},{key:"fragGammaDefs",get:function(){return'uniform float gammaFactor;\n        vec4 linearToLinear( in vec4 value ) {\n            return value;\n        }\n        vec4 sRGBToLinear( in vec4 value ) {\n            return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n        }\n        vec4 gammaToLinear( in vec4 value) {\n            return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n        }\n        vec4 linearToGamma( in vec4 value, in float gammaFactor ) {\n              return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );");\n        }'}},{key:"fragLightDefs",get:function(){var e=this.renderContext.view,t=[];t.push("uniform vec4 lightAmbient;");for(var r=0,i=e.lightsList.length;r<i;r++){var n=e.lightsList[r];"ambient"!==n.type&&(t.push("uniform vec4 lightColor"+r+";"),"dir"===n.type&&t.push("uniform vec3 lightDir"+r+";"),"point"===n.type&&t.push("uniform vec3 lightPos"+r+";"),"spot"===n.type&&(t.push("uniform vec3 lightPos"+r+";"),t.push("uniform vec3 lightDir"+r+";")))}return t.join("\n")}},{key:"fragLogDepthBufDefs",get:function(){return this.renderContext.view.logarithmicDepthBufferEnabled?"in float isPerspective;\n                    uniform float logDepthBufFC;\n                    in float fragDepth;":""}},{key:"fragLogDepthBufOutput",get:function(){return this.renderContext.view.logarithmicDepthBufferEnabled?"gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( fragDepth ) * logDepthBufFC * 0.5;":""}},{key:"fragLighting",get:function(){var e=[];e.push("vec4 viewPosition  = viewMatrix * worldPosition; "),e.push("vec4 modelNormal = vec4(octDecode(normal.xy), 0.0); "),e.push("vec4 worldNormal = worldNormalMatrix * vec4(dot(modelNormal, modelNormalMatrixCol0), dot(modelNormal, modelNormalMatrixCol1), dot(modelNormal, modelNormalMatrixCol2), 0.0);"),e.push("vec3 viewNormal = normalize(vec4(viewNormalMatrix * worldNormal).xyz);"),e.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),e.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),e.push("float lambertian = 1.0;");for(var t=0,r=this.renderContext.view.lightsList.length;t<r;t++){var i=this.renderContext.view.lightsList[t];if("ambient"!==i.type){if("dir"===i.type)e.push("view"===i.space?"viewLightDir = normalize(lightDir"+t+");":"viewLightDir = normalize((viewMatrix * vec4(lightDir"+t+", 0.0)).xyz);");else if("point"===i.type)e.push("view"===i.space?"viewLightDir = -normalize(lightPos"+t+" - viewPosition.xyz);":"viewLightDir = -normalize((viewMatrix * vec4(lightPos"+t+", 0.0)).xyz);");else{if("spot"!==i.type)continue;e.push("view"===i.space?"viewLightDir = normalize(lightDir"+t+");":"viewLightDir = normalize((viewMatrix * vec4(lightDir"+t+", 0.0)).xyz);")}e.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),e.push("reflectedColor += lambertian * (lightColor"+t+".rgb * lightColor"+t+".a);")}}return e.push("vec3 rgb = (vec3(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0));"),e.push("meshColor =  vec4((lightAmbient.rgb * lightAmbient.a * rgb) + (reflectedColor * rgb), float(color.a) / 255.0);"),e.join("\n")}},{key:"fragSAOOutput",get:function(){return this.renderContext.view.sao.enabled?"float viewportWidth     = uSAOParams[0];\n                    float viewportHeight    = uSAOParams[1];\n                    float blendCutoff       = uSAOParams[2];\n                    float blendFactor       = uSAOParams[3];\n                    vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);\n                    float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture(uOcclusionTexture, uv))) * blendFactor;\n                    outColor                = vec4(fragColor.rgb * ambient, 1.0);":"outColor            = fragColor;"}},{key:"fragOutput",get:function(){return"outColor            = fragColor;"}},{key:"fragSectionPlaneDefs",get:function(){var e=[];e.push("in vec4 worldPosition;\n                  in vec4 meshFlags2;");for(var t=0,r=this.renderContext.view.sectionPlanesList.length;t<r;t++)e.push("uniform bool sectionPlaneActive"+t+";\n                      uniform vec3 sectionPlanePos"+t+";\n                      uniform vec3 sectionPlaneDir"+t+";");return e.join("\n")}},{key:"fragLightSourceUniforms",get:function(){var e=[];e.push("uniform vec4 lightAmbient;");for(var t=0,r=this.renderContext.view.lightsList.length;t<r;t++){var i=this.renderContext.view.lightsList[t];i instanceof Tt||(e.push("uniform vec4 lightColor"+t+";"),i instanceof _t&&e.push("uniform vec3 lightDir"+t+";"),i instanceof Pt&&e.push("uniform vec3 lightPos"+t+";"))}return e.join("\n")}},{key:"fragSectionPlanesSlice",get:function(){var e=[];if(this.renderContext.view.sectionPlanesList.length>0){e.push("bool clippable = (float(meshFlags2.x) > 0.0);\n                      if (clippable) {\n                          float dist = 0.0;");for(var t=0,r=this.renderContext.view.sectionPlanesList.length;t<r;t++)e.push("if (sectionPlaneActive"+t+") {\n                              dist += clamp(dot(-sectionPlaneDir"+t+".xyz, worldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);\n                          }");e.push("if (dist > 0.0) { \n                          discard;\n                      }\n                  }")}return e.join("\n")}},{key:"fragFlatShading",get:function(){var e=[];return e.push(""),e.join("\n")}}]),e}();function Ut(){var e=this.renderContext.view,r=this.renderContext.gl;if(m(this,Lt)[Lt]=new t.GLProgram(r,m(this,Bt)[Bt]()),m(this,Lt)[Lt].errors)this.errors=m(this,Lt)[Lt].errors;else{var i=m(this,Lt)[Lt];m(this,St)[St]={renderPass:i.getLocation("renderPass"),viewMatrix:i.getLocation("viewMatrix"),projMatrix:i.getLocation("projMatrix"),worldMatrix:i.getLocation("worldMatrix"),sao:i.getLocation("sao"),logDepthBufFC:i.getLocation("logDepthBufFC"),gammaFactor:i.getLocation("gammaFactor"),pointSize:i.getLocation("pointSize"),nearPlaneHeight:i.getLocation("nearPlaneHeight"),pointCloudIntensityRange:i.getLocation("pointCloudIntensityRange"),pickZNear:i.getLocation("pickZNear"),pickZFar:i.getLocation("pickZFar"),pickInvisible:i.getLocation("pickInvisible"),color:i.getLocation("color"),lightAmbient:i.getLocation("lightAmbient"),lights:[],sectionPlanes:[]};for(var n=m(this,St)[St],s=e.lightsList,o=0,a=s.length;o<a;o++)switch(s[o].type){case"dir":n.lights.push({color:i.getLocation("lightColor"+o),dir:i.getLocation("lightDir"+o)});break;case"point":n.lights.push({color:i.getLocation("lightColor"+o),pos:i.getLocation("lightPos"+o),attenuation:i.getLocation("lightAttenuation"+o)});break;case"spot":n.lights.push({color:i.getLocation("lightColor"+o),pos:i.getLocation("lightPos"+o),dir:i.getLocation("lightDir"+o),attenuation:i.getLocation("lightAttenuation"+o)})}for(var h=0,c=e.sectionPlanesList.length;h<c;h++)n.sectionPlanes.push({active:i.getLocation("sectionPlaneActive"+h),pos:i.getLocation("sectionPlanePos"+h),dir:i.getLocation("sectionPlaneDir"+h)});m(this,Dt)[Dt]={viewMatrices:i.getSampler("viewMatrices"),positions:i.getSampler("positions"),indices:i.getSampler("indices"),edgeIndices:i.getSampler("edgeIndices"),eachMeshAttributes:i.getSampler("eachMeshAttributes"),eachMeshMatrices:i.getSampler("eachMeshMatrices"),eachEdgeOffset:i.getSampler("eachMeshOffset"),eachPrimitiveMesh:i.getSampler("eachMeshTriangleMesh"),eachEdgeMesh:i.getSampler("eachEdgeMesh"),baseColorMap:i.getSampler("baseColorMap"),metallicRoughMap:i.getSampler("metallicRoughMap"),emissiveMap:i.getSampler("emissiveMap"),normalMap:i.getSampler("normalMap"),occlusionMap:i.getSampler("occlusionMap")},m(this,It)[It]=this.getHash()}}function Gt(){return{vertex:this.buildVertexShader(),fragment:this.buildFragmentShader()}}function Nt(){return!m(this,Rt)[Rt]||(m(this,Rt)[Rt]=!1,m(this,It)[It]===this.getHash())}function Ht(){var e=this.renderContext.view,t=this.renderContext.gl,r=m(this,St)[St],i=e.camera.project;m(this,Lt)[Lt].bind(),r.lightAmbient&&t.uniform4fv(r.lightAmbient,e.getAmbientColorAndIntensity());for(var n=0,s=r.lights.length;n<s;n++){var o=r.lights[n],a=e.lightsList[n];o.color&&t.uniform4f(o.color,a.color[0],a.color[1],a.color[2],a.intensity),o.dir&&t.uniform3f(o.dir,a.dir[0],a.dir[1],a.dir[2]),o.pos&&t.uniform3f(o.pos,a.pos[0],a.pos[1],a.pos[2]),o.attenuation&&t.uniform1f(o.attenuation,a.attenuation)}if(r.sao){var h=e.sao;if(h.possible){var c=t.drawingBufferHeight;Ct[0]=t.drawingBufferWidth,Ct[1]=c,Ct[2]=h.blendCutoff,Ct[3]=h.blendFactor,t.uniform4fv(r.sao,Ct)}}if(r.gammaFactor&&t.uniform1f(r.gammaFactor,e.gammaFactor),r.pointSize&&t.uniform1f(r.pointSize,e.pointsMaterial.pointSize),r.nearPlaneHeight&&t.uniform1f(r.nearPlaneHeight,500001===e.camera.projectionType?1:t.drawingBufferHeight/(2*Math.tan(.5*e.camera.perspectiveProjection.fov*Math.PI/180))),r.pickZNear&&(t.uniform1f(r.pickZNear,this.renderContext.pickZNear),t.uniform1f(r.pickZFar,this.renderContext.pickZFar)),r.pickInvisible&&t.uniform1i(r.pickInvisible,this.renderContext.pickInvisible?1:0),r.logDepthBufFC){var u=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(r.logDepthBufFC,u)}}var Xt=/*#__PURE__*/function(e){function t(t){return e.call(this,t)||this}u(t,e);var r=t.prototype;return r.getHash=function(){return this.renderContext.view.getSectionPlanesHash()+"-"+this.renderContext.view.getLightsHash()},r.buildVertexShader=function(){return this.vertHeader+"   \n        \n                uniform int                 renderPass;   \n            \n                uniform highp   mat4        projMatrix;\n                uniform highp   mat4        worldMatrix;\n                      \n                uniform mediump sampler2D   viewMatrices;\n                           \n                uniform mediump usampler2D  eachPrimitiveMesh;\n                uniform lowp    usampler2D  eachMeshAttributes;\n                \n                uniform mediump sampler2D   eachMeshMatrices;\n                uniform mediump usampler2D  positions;\n                uniform highp   usampler2D  indices;\n                \n                uniform  float  logDepthBufFC;\n                 \n                out vec4        worldPosition;\n                flat out uint   meshFlags2r;                       \n                flat out uvec4  meshColor;\n                out float       fragDepth;\n                \n                bool isPerspectiveMatrix(mat4 m) {\n                    return (m[2][3] == - 1.0);\n                }\n                \n                out float isPerspective;\n                    \n                void main(void) {\n                                   \n                    int triangleIndex      = gl_VertexID / 3;\n                    \n                    int hPackedMeshIdIndex = (triangleIndex >> 3) & 1023;\n                    int vPackedMeshIdIndex = (triangleIndex >> 3) >> 10;\n                    \n                    int meshIndex          = int(texelFetch(eachPrimitiveMesh, ivec2(hPackedMeshIdIndex, vPackedMeshIdIndex), 0).r);                   \n                    uvec4 meshFlags        = texelFetch (eachMeshAttributes, ivec2(2, meshIndex), 0);\n\n                    if (int(meshFlags.x) != renderPass) {\n                        gl_Position = vec4(3.0, 3.0, 3.0, 1.0);\n                        return;\n                    } \n                 \n                    uvec4 meshFlags2 = texelFetch (eachMeshAttributes, ivec2(3, meshIndex), 0);\n\n                    ivec4 packedVertexBase = ivec4(texelFetch (eachMeshAttributes, ivec2(4, meshIndex), 0));\n                    ivec4 packedIndexBaseOffset = ivec4(texelFetch (eachMeshAttributes, ivec2(5, meshIndex), 0));\n                    int indexBaseOffset =   (packedIndexBaseOffset.r << 24) + \n                                            (packedIndexBaseOffset.g << 16) + \n                                            (packedIndexBaseOffset.b << 8) + \n                                            (packedIndexBaseOffset.a);\n\n                    int hIndex = (triangleIndex - indexBaseOffset) & 1023;\n                    int vIndex = (triangleIndex - indexBaseOffset) >> 10;\n\n                    ivec3 vertexIndices = ivec3(texelFetch(indices, ivec2(hIndex, vIndex), 0));\n                    ivec3 uniqueVertexIndexes = vertexIndices + (packedVertexBase.r << 24) + (packedVertexBase.g << 16) + (packedVertexBase.b << 8) + packedVertexBase.a;\n\n                    ivec3 indexPositionH = uniqueVertexIndexes & 1023;\n                    ivec3 indexPositionV = uniqueVertexIndexes >> 10;\n\n                    mat4 positionsDecompressMatrix = mat4 (\n                        texelFetch (eachMeshMatrices, ivec2(0, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(1, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(2, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(3, meshIndex), 0));\n                        \n                    mat4 meshMatrix = mat4 (\n                        texelFetch (eachMeshMatrices, ivec2(4, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(5, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(6, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(7, meshIndex), 0));\n\n                    ivec4 packedViewMatrixIndex = ivec4(texelFetch (eachMeshAttributes, ivec2(7, meshIndex), 0));\n                    int viewMatrixIndex = \n                            (packedViewMatrixIndex.r << 24) + \n                            (packedViewMatrixIndex.g << 16) + \n                            (packedViewMatrixIndex.b << 8) + \n                            (packedViewMatrixIndex.a);\n                   \n                    mat4 viewMatrix = mat4 (\n                        texelFetch (viewMatrices, ivec2(4, viewMatrixIndex), 0), \n                        texelFetch (viewMatrices, ivec2(5, viewMatrixIndex), 0), \n                        texelFetch (viewMatrices, ivec2(6, viewMatrixIndex), 0), \n                        texelFetch (viewMatrices, ivec2(7, viewMatrixIndex), 0));\n\n                    vec3 _positions[3];\n                   \n                    _positions[0] = vec3(texelFetch(positions, ivec2(indexPositionH.r, indexPositionV.r), 0));\n                    _positions[1] = vec3(texelFetch(positions, ivec2(indexPositionH.g, indexPositionV.g), 0));\n                    _positions[2] = vec3(texelFetch(positions, ivec2(indexPositionH.b, indexPositionV.b), 0));\n  \n                    vec3  position       = _positions[gl_VertexID % 3];\n                   \n                    vec4  _worldPosition = worldMatrix * ((meshMatrix * positionsDecompressMatrix) * vec4(position, 1.0)); \n                    vec4  viewPosition   = viewMatrix * _worldPosition;                   \n                    vec4  clipPosition   = projMatrix * viewPosition;\n\n                    meshFlags2r     = meshFlags2.r;                     \n                    meshColor       = texelFetch (eachMeshAttributes, ivec2(0, meshIndex), 0);                          \n                    fragDepth       = 1.0 + clipPosition.w;\n                    isPerspective   = float (isPerspectiveMatrix(projMatrix));\n                    worldPosition   = _worldPosition;                                               \n                    \n                    gl_Position     = clipPosition;\n                }"},r.buildFragmentShader=function(){return this.fragHeader+"                        \n    \n             flat   in uvec4    meshColor;\n                in float        fragDepth;\n                in float        isPerspective;    \n                flat in uint    meshFlags2r;        \n                uniform float   logDepthBufFC;                        \n    \n                "+this.fragSectionPlaneDefs+"                  \n                "+this.fragLightSourceUniforms+'                                                             \n    \n                out vec4 outColor;        \n    \n                void main(void) {         \n                \n                // src.push("float lambertian = 1.0;");\n                // \n                //  vec3 xTangent = dFdx( vViewPosition.xyz );\n                //  vec3 yTangent = dFdy( vViewPosition.xyz );\n                // \n                //  vec3 viewNormal = normalize( cross( xTangent, yTangent ) );        \n    \n                    '+this.fragSectionPlanesSlice+"                                    \n                    "+this.fragFlatShading+"     \n          \n                    outColor = vec4(meshColor);                   \n                    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( fragDepth ) * logDepthBufFC * 0.5;                        \n                }"},t}(kt);function Vt(e){return new Float64Array(e||6)}function Wt(e){return void 0===e&&(e=Vt()),e[0]=n.MAX_DOUBLE,e[1]=n.MAX_DOUBLE,e[2]=n.MAX_DOUBLE,e[3]=n.MIN_DOUBLE,e[4]=n.MIN_DOUBLE,e[5]=n.MIN_DOUBLE,e}function zt(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[3]&&(e[3]=t[3]),e[4]<t[4]&&(e[4]=t[4]),e[5]<t[5]&&(e[5]=t[5]),e}function qt(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[0]&&(e[3]=t[0]),e[4]<t[1]&&(e[4]=t[1]),e[5]<t[2]&&(e[5]=t[2]),e}e.createVec3(),e.createVec3(),e.createMat4(),n.newFloatArray(3),n.newFloatArray(3),n.newFloatArray(3),n.newFloatArray(3),n.newFloatArray(3),n.newFloatArray(3),n.newFloatArray(3);var Yt,Kt=/*#__PURE__*/g("built"),Qt=/*#__PURE__*/function(){function e(){this.positions=void 0,this.indices_8Bits=void 0,this.indices_16Bits=void 0,this.indices_32Bits=void 0,this.edgeIndices_8Bits=void 0,this.edgeIndices_16Bits=void 0,this.edgeIndices_32Bits=void 0,this.indices=void 0,this.edgeIndices=void 0,this.eachMeshAttributes=void 0,this.eachMeshMatrices=void 0,this.eachEdgeOffset=void 0,this.eachPrimitiveMesh_8Bits=void 0,this.eachPrimitiveMesh_16Bits=void 0,this.eachPrimitiveMesh_32Bits=void 0,this.eachPrimitiveMesh=void 0,this.eachEdgeMesh_8Bits=void 0,this.eachEdgeMesh_16Bits=void 0,this.eachEdgeMesh_32Bits=void 0,this.eachEdgeMesh=void 0,Object.defineProperty(this,Kt,{writable:!0,value:void 0}),this.positions=null,this.indices_8Bits=null,this.indices_16Bits=null,this.indices_32Bits=null,this.edgeIndices_8Bits=null,this.edgeIndices_16Bits=null,this.edgeIndices_32Bits=null,this.eachMeshAttributes=null,this.eachMeshMatrices=null,this.eachPrimitiveMesh_8Bits=null,this.eachPrimitiveMesh_16Bits=null,this.eachPrimitiveMesh_32Bits=null,this.eachEdgeMesh_8Bits=null,this.eachEdgeMesh_16Bits=null,this.eachEdgeMesh_32Bits=null,this.eachEdgeOffset=null,m(this,Kt)[Kt]=!1}var t=e.prototype;return t.build=function(){this.indices={8:this.indices_8Bits,16:this.indices_16Bits,32:this.indices_32Bits},this.eachPrimitiveMesh={8:this.eachPrimitiveMesh_8Bits,16:this.eachPrimitiveMesh_16Bits,32:this.eachPrimitiveMesh_32Bits},this.edgeIndices={8:this.edgeIndices_8Bits,16:this.edgeIndices_16Bits,32:this.edgeIndices_32Bits},this.eachEdgeMesh={8:this.eachEdgeMesh_8Bits,16:this.eachEdgeMesh_16Bits,32:this.eachEdgeMesh_32Bits},m(this,Kt)[Kt]=!0},t.destroy=function(){this.positions&&this.positions.destroy(),this.indices_8Bits&&this.indices_8Bits.destroy(),this.indices_16Bits&&this.indices_16Bits.destroy(),this.indices_32Bits&&this.indices_32Bits.destroy(),this.edgeIndices_8Bits&&this.edgeIndices_8Bits.destroy(),this.edgeIndices_16Bits&&this.edgeIndices_16Bits.destroy(),this.edgeIndices_32Bits&&this.edgeIndices_32Bits.destroy(),this.eachMeshMatrices&&this.eachMeshMatrices.destroy(),this.eachMeshAttributes&&this.eachMeshAttributes.destroy(),this.eachEdgeOffset&&this.eachEdgeOffset.destroy(),this.eachPrimitiveMesh_8Bits&&this.eachPrimitiveMesh_8Bits.destroy(),this.eachPrimitiveMesh_16Bits&&this.eachPrimitiveMesh_16Bits.destroy(),this.eachPrimitiveMesh_32Bits&&this.eachPrimitiveMesh_32Bits.destroy(),this.eachEdgeMesh_8Bits&&this.eachEdgeMesh_8Bits.destroy(),this.eachEdgeMesh_16Bits&&this.eachEdgeMesh_16Bits.destroy(),this.eachEdgeMesh_32Bits&&this.eachEdgeMesh_32Bits.destroy()},e}(),Zt=/*#__PURE__*/function(){function e(){this.numMeshes=void 0,this.numVisible=void 0,this.numTransparent=void 0,this.numEdges=void 0,this.numXRayed=void 0,this.numSelected=void 0,this.numHighlighted=void 0,this.numClippable=void 0,this.numPickable=void 0,this.numCulled=void 0,this.reset()}return e.prototype.reset=function(){this.numMeshes=0,this.numVisible=0,this.numTransparent=0,this.numEdges=0,this.numXRayed=0,this.numSelected=0,this.numHighlighted=0,this.numClippable=0,this.numPickable=0,this.numCulled=0},e}(),Jt={VISIBLE:1,CULLED:4,PICKABLE:8,CLIPPABLE:16,COLLIDABLE:32,CAST_SHADOW:64,RECEIVE_SHADOW:128,XRAYED:256,HIGHLIGHTED:512,SELECTED:1024,EDGES:2048,BACKFACES:4096,TRANSPARENT:8192};function $t(e){return function(t){return tr(e,t,[].slice.call(arguments,1))}}function er(e,t){return $t(sr(e,t).get)}for(var tr=Reflect.apply,rr=Reflect.construct,ir=Reflect.defineProperty,nr=Reflect.get,sr=Reflect.getOwnPropertyDescriptor,or=Reflect.getPrototypeOf,ar=Reflect.has,hr=Reflect.ownKeys,cr=Reflect.set,ur=Reflect.setPrototypeOf,lr=Proxy,dr=Number,fr=dr.isFinite,vr=dr.isNaN,pr=Symbol.iterator,gr=Symbol.species,mr=Symbol.toStringTag,yr=Symbol.for,br=Object,Er=br.create,wr=br.defineProperty,Tr=br.freeze,xr=br.is,_r=br.prototype,Mr=$t(_r.isPrototypeOf),Pr=br.hasOwn||$t(_r.hasOwnProperty),Or=Array,Cr=Or.isArray,Ir=Or.prototype,Lr=$t(Ir.join),Rr=$t(Ir.push),Sr=$t(Ir.toLocaleString),Dr=Ir[pr],Ar=$t(Dr),Br=Math.trunc,jr=ArrayBuffer,Fr=jr.isView,kr=$t(jr.prototype.slice),Ur=er(jr.prototype,"byteLength"),Gr="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:null,Nr=Gr&&er(Gr.prototype,"byteLength"),Hr=or(Uint8Array),Xr=Hr.from,Vr=Hr.prototype,Wr=Vr[pr],zr=$t(Vr.keys),qr=$t(Vr.values),Yr=$t(Vr.entries),Kr=$t(Vr.set),Qr=$t(Vr.reverse),Zr=$t(Vr.fill),Jr=$t(Vr.copyWithin),$r=$t(Vr.sort),ei=$t(Vr.slice),ti=$t(Vr.subarray),ri=er(Vr,"buffer"),ii=er(Vr,"byteOffset"),ni=er(Vr,"length"),si=er(Vr,mr),oi=Uint16Array,ai=function(){return tr(Xr,oi,[].slice.call(arguments))},hi=Uint32Array,ci=Float32Array,ui=or([][pr]()),li=$t(ui.next),di=$t(o().mark(function e(){return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})().next),fi=or(ui),vi=TypeError,pi=RangeError,gi=Set,mi=gi.prototype,yi=$t(mi.add),bi=$t(mi.has),Ei=WeakMap,wi=Ei.prototype,Ti=$t(wi.get),xi=$t(wi.has),_i=$t(wi.set),Mi=new jr(4),Pi=new ci(Mi),Oi=new hi(Mi),Ci=new hi(512),Ii=new hi(512),Li=0;Li<256;++Li){var Ri=Li-127;Ri<-27?(Ci[Li]=0,Ci[256|Li]=32768,Ii[Li]=24,Ii[256|Li]=24):Ri<-14?(Ci[Li]=1024>>-Ri-14,Ci[256|Li]=1024>>-Ri-14|32768,Ii[Li]=-Ri-1,Ii[256|Li]=-Ri-1):Ri<=15?(Ci[Li]=Ri+15<<10,Ci[256|Li]=Ri+15<<10|32768,Ii[Li]=13,Ii[256|Li]=13):Ri<128?(Ci[Li]=31744,Ci[256|Li]=64512,Ii[Li]=24,Ii[256|Li]=24):(Ci[Li]=31744,Ci[256|Li]=64512,Ii[Li]=13,Ii[256|Li]=13)}function Si(e){Pi[0]=e;var t=Oi[0],r=t>>23&511;return Ci[r]+((8388607&t)>>Ii[r])}var Di=new hi(2048),Ai=new hi(64),Bi=new hi(64);Di[0]=0;for(var ji=1;ji<1024;++ji){for(var Fi=ji<<13,ki=0;0==(8388608&Fi);)ki-=8388608,Fi<<=1;Di[ji]=(Fi&=-8388609)|(ki+=947912704)}for(var Ui=1024;Ui<2048;++Ui)Di[Ui]=939524096+(Ui-1024<<13);Ai[0]=0;for(var Gi=1;Gi<31;++Gi)Ai[Gi]=Gi<<23;Ai[31]=1199570944,Ai[32]=2147483648;for(var Ni=33;Ni<63;++Ni)Ai[Ni]=2147483648+(Ni-32<<23);Ai[63]=3347054592,Bi[0]=0;for(var Hi=1;Hi<64;++Hi)Bi[Hi]=32===Hi?0:1024;function Xi(e){var t=e>>10;return Oi[0]=Di[Bi[t]+(1023&e)]+Ai[t],Pi[0]}function Vi(e){var t;if(e[pr]===Dr)return e;var r=Ar(e);return Er(null,((t={next:{value:function(){return li(r)}}})[pr]={value:function(){return this}},t))}var Wi=new Ei,zi=Er(fi,(Yt={next:{value:function(){var e=Ti(Wi,this);return di(e)},writable:!0,configurable:!0}},Yt[mr]={value:"Array Iterator",configurable:!0},Yt));function qi(e){var t=Er(zi);return _i(Wi,t,e),t}function Yi(e){return null!==e&&"object"==typeof e||"function"==typeof e}function Ki(e){return null!==e&&"object"==typeof e}function Qi(e){return void 0!==si(e)}function Zi(e){var t=si(e);return"BigInt64Array"===t||"BigUint64Array"===t}function Ji(e){if(null===Gr)return!1;try{return Nr(e),!0}catch(e){return!1}}function $i(e){return!!Cr(e)&&(e[pr]===Dr||"Array Iterator"===e[pr]()[mr])}function en(e){if("string"!=typeof e)return!1;var t=dr(e);return e===t+""&&!!fr(t)&&t===Br(t)}var tn=dr.MAX_SAFE_INTEGER;function rn(e){if("bigint"==typeof e)throw vi("Cannot convert a BigInt value to a number");var t=dr(e);return vr(t)||0===t?0:Br(t)}function nn(e){var t=rn(e);return t<0?0:t<tn?t:tn}function sn(e,t){if(!Yi(e))throw vi("This is not an object");var r=e.constructor;if(void 0===r)return t;if(!Yi(r))throw vi("The constructor property value is not an object");var i=r[gr];return null==i?t:i}function on(e){if(Ji(e))return!1;try{return kr(e,0,0),!1}catch(e){}return!0}function an(e,t){var r=vr(e),i=vr(t);if(r&&i)return 0;if(r)return 1;if(i)return-1;if(e<t)return-1;if(e>t)return 1;if(0===e&&0===t){var n=xr(e,0),s=xr(t,0);if(!n&&s)return-1;if(n&&!s)return 1}return 0}var hn=yr("__Float16Array__"),cn=new Ei;function un(e){return xi(cn,e)||!Fr(e)&&function(e){if(!Ki(e))return!1;var t=or(e);if(!Ki(t))return!1;var r=t.constructor;if(void 0===r)return!1;if(!Yi(r))throw vi("The constructor property value is not an object");return ar(r,hn)}(e)}function ln(e){if(!un(e))throw vi("This is not a Float16Array object")}function dn(e,t){var r=un(e),i=Qi(e);if(!r&&!i)throw vi("Species constructor didn't return TypedArray object");if("number"==typeof t){var n;if(r){var s=fn(e);n=ni(s)}else n=ni(e);if(n<t)throw vi("Derived constructor created TypedArray object which was too small length")}if(Zi(e))throw vi("Cannot mix BigInt and other types, use explicit conversions")}function fn(e){var t=Ti(cn,e);if(void 0!==t){if(on(ri(t)))throw vi("Attempting to access detached ArrayBuffer");return t}var r=e.buffer;if(on(r))throw vi("Attempting to access detached ArrayBuffer");var i=rr(wn,[r,e.byteOffset,e.length],e.constructor);return Ti(cn,i)}function vn(e){for(var t=ni(e),r=[],i=0;i<t;++i)r[i]=Xi(e[i]);return r}for(var pn,gn=new gi,mn=v(hr(Vr));!(pn=mn()).done;){var yn=pn.value;if(yn!==mr){var bn=sr(Vr,yn);Pr(bn,"get")&&yi(gn,yn)}}var En=Tr({get:function(e,t,r){return en(t)&&Pr(e,t)?Xi(nr(e,t)):bi(gn,t)&&Mr(Vr,e)?nr(e,t):nr(e,t,r)},set:function(e,t,r,i){return en(t)&&Pr(e,t)?cr(e,t,Si(r)):cr(e,t,r,i)},getOwnPropertyDescriptor:function(e,t){if(en(t)&&Pr(e,t)){var r=sr(e,t);return r.value=Xi(r.value),r}return sr(e,t)},defineProperty:function(e,t,r){return en(t)&&Pr(e,t)&&Pr(r,"value")?(r.value=Si(r.value),ir(e,t,r)):ir(e,t,r)}}),wn=/*#__PURE__*/function(){function e(t,r,i){var n;if(un(t))n=rr(oi,[fn(t)],this instanceof e?this.constructor:void 0);else if(Yi(t)&&!function(e){try{return Ur(e),!0}catch(e){return!1}}(t)){var s,o;if(Qi(t)){s=t,o=ni(t);var a=ri(t),h=Ji(a)?jr:sn(a,jr);if(on(a))throw vi("Attempting to access detached ArrayBuffer");if(Zi(t))throw vi("Cannot mix BigInt and other types, use explicit conversions");var c=new h(2*o);n=rr(oi,[c],this instanceof e?this.constructor:void 0)}else{var u=t[pr];if(null!=u&&"function"!=typeof u)throw vi("@@iterator property is not callable");null!=u?$i(t)?(s=t,o=t.length):o=(s=[].concat(t)).length:o=nn((s=t).length),n=rr(oi,[o],this instanceof e?this.constructor:void 0)}for(var l=0;l<o;++l)n[l]=Si(s[l])}else n=rr(oi,arguments,this instanceof e?this.constructor:void 0);var d=new lr(n,En);return _i(cn,d,n),d}e.from=function(t){var r,i,n=this,s=[].slice.call(arguments,1),o=this;if(!ar(o,hn))throw vi("This constructor is not a subclass of Float16Array");if(o===e){if(un(t)&&0===s.length){var a=fn(t),h=new oi(ri(a),ii(a),ni(a));return new e(ri(ei(h)))}if(0===s.length)return new e(ri(ai(t,Si)));var c=s[0];return new e(ri(ai(t,function(e){return Si(tr(c,n,[e].concat(Vi([].slice.call(arguments,1)))))},s[1])))}var u,l=t[pr];if(null!=l&&"function"!=typeof l)throw vi("@@iterator property is not callable");if(null!=l)$i(t)?(r=t,i=t.length):!Qi(u=t)||u[pr]!==Wr&&"Array Iterator"!==u[pr]()[mr]?i=(r=[].concat(t)).length:(r=t,i=ni(t));else{if(null==t)throw vi("Cannot convert undefined or null to object");i=nn((r=br(t)).length)}var d=new o(i);if(0===s.length)for(var f=0;f<i;++f)d[f]=r[f];else for(var v=s[0],p=s[1],g=0;g<i;++g)d[g]=tr(v,p,[r[g],g]);return d},e.of=function(){var t=[].slice.call(arguments),r=this;if(!ar(r,hn))throw vi("This constructor is not a subclass of Float16Array");var i=t.length;if(r===e){for(var n=new e(i),s=fn(n),o=0;o<i;++o)s[o]=Si(t[o]);return n}for(var a=new r(i),h=0;h<i;++h)a[h]=t[h];return a};var t=e.prototype;return t.keys=function(){ln(this);var e=fn(this);return zr(e)},t.values=function(){ln(this);var e=fn(this);return qi(/*#__PURE__*/o().mark(function t(){var r,i,n;return o().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=v(qr(e));case 1:if((i=r()).done){t.next=7;break}return n=i.value,t.next=5,Xi(n);case 5:t.next=1;break;case 7:case"end":return t.stop()}},t)})())},t.entries=function(){ln(this);var e=fn(this);return qi(/*#__PURE__*/o().mark(function t(){var r,i,n,s,a;return o().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=v(Yr(e));case 1:if((i=r()).done){t.next=7;break}return s=(n=i.value)[0],a=n[1],t.next=5,[s,Xi(a)];case 5:t.next=1;break;case 7:case"end":return t.stop()}},t)})())},t.at=function(e){ln(this);var t=fn(this),r=ni(t),i=rn(e),n=i>=0?i:r+i;if(!(n<0||n>=r))return Xi(t[n])},t.map=function(t){ln(this);var r=fn(this),i=ni(r),n=[].slice.call(arguments,1)[0],s=sn(r,e);if(s===e){for(var o=new e(i),a=fn(o),h=0;h<i;++h){var c=Xi(r[h]);a[h]=Si(tr(t,n,[c,h,this]))}return o}var u=new s(i);dn(u,i);for(var l=0;l<i;++l){var d=Xi(r[l]);u[l]=tr(t,n,[d,l,this])}return u},t.filter=function(t){ln(this);for(var r=fn(this),i=ni(r),n=[].slice.call(arguments,1)[0],s=[],o=0;o<i;++o){var a=Xi(r[o]);tr(t,n,[a,o,this])&&Rr(s,a)}var h=new(sn(r,e))(s);return dn(h),h},t.reduce=function(e){var t=[].slice.call(arguments,1);ln(this);var r,i,n=fn(this),s=ni(n);if(0===s&&0===t.length)throw vi("Reduce of empty array with no initial value");0===t.length?(r=Xi(n[0]),i=1):(r=t[0],i=0);for(var o=i;o<s;++o)r=e(r,Xi(n[o]),o,this);return r},t.reduceRight=function(e){var t=[].slice.call(arguments,1);ln(this);var r,i,n=fn(this),s=ni(n);if(0===s&&0===t.length)throw vi("Reduce of empty array with no initial value");0===t.length?(r=Xi(n[s-1]),i=s-2):(r=t[0],i=s-1);for(var o=i;o>=0;--o)r=e(r,Xi(n[o]),o,this);return r},t.forEach=function(e){ln(this);for(var t=fn(this),r=ni(t),i=[].slice.call(arguments,1)[0],n=0;n<r;++n)tr(e,i,[Xi(t[n]),n,this])},t.find=function(e){ln(this);for(var t=fn(this),r=ni(t),i=[].slice.call(arguments,1)[0],n=0;n<r;++n){var s=Xi(t[n]);if(tr(e,i,[s,n,this]))return s}},t.findIndex=function(e){ln(this);for(var t=fn(this),r=ni(t),i=[].slice.call(arguments,1)[0],n=0;n<r;++n){var s=Xi(t[n]);if(tr(e,i,[s,n,this]))return n}return-1},t.findLast=function(e){ln(this);for(var t=fn(this),r=ni(t),i=[].slice.call(arguments,1)[0],n=r-1;n>=0;--n){var s=Xi(t[n]);if(tr(e,i,[s,n,this]))return s}},t.findLastIndex=function(e){ln(this);for(var t=fn(this),r=ni(t),i=[].slice.call(arguments,1)[0],n=r-1;n>=0;--n){var s=Xi(t[n]);if(tr(e,i,[s,n,this]))return n}return-1},t.every=function(e){ln(this);for(var t=fn(this),r=ni(t),i=[].slice.call(arguments,1)[0],n=0;n<r;++n)if(!tr(e,i,[Xi(t[n]),n,this]))return!1;return!0},t.some=function(e){ln(this);for(var t=fn(this),r=ni(t),i=[].slice.call(arguments,1)[0],n=0;n<r;++n)if(tr(e,i,[Xi(t[n]),n,this]))return!0;return!1},t.set=function(e){ln(this);var t=fn(this),r=rn([].slice.call(arguments,1)[0]);if(r<0)throw pi("Offset is out of bounds");if(null==e)throw vi("Cannot convert undefined or null to object");if(Zi(e))throw vi("Cannot mix BigInt and other types, use explicit conversions");if(un(e))return Kr(fn(this),fn(e),r);if(Qi(e)&&on(ri(e)))throw vi("Attempting to access detached ArrayBuffer");var i=ni(t),n=br(e),s=nn(n.length);if(r===1/0||s+r>i)throw pi("Offset is out of bounds");for(var o=0;o<s;++o)t[o+r]=Si(n[o])},t.reverse=function(){ln(this);var e=fn(this);return Qr(e),this},t.fill=function(e){ln(this);var t=fn(this);return Zr.apply(void 0,[t,Si(e)].concat(Vi([].slice.call(arguments,1)))),this},t.copyWithin=function(e,t){ln(this);var r=fn(this);return Jr.apply(void 0,[r,e,t].concat(Vi([].slice.call(arguments,2)))),this},t.sort=function(){var e=[].slice.call(arguments);ln(this);var t=fn(this),r=void 0!==e[0]?e[0]:an;return $r(t,function(e,t){return r(Xi(e),Xi(t))}),this},t.slice=function(){var t=[].slice.call(arguments);ln(this);var r=fn(this),i=sn(r,e);if(i===e){var n=new oi(ri(r),ii(r),ni(r));return new e(ri(ei.apply(void 0,[n].concat(Vi(t)))))}var s,o,a=ni(r),h=rn(t[0]),c=void 0===t[1]?a:rn(t[1]),u=(o=c===-1/0?0:c<0?a+c>0?a+c:0:a<c?a:c)-(s=h===-1/0?0:h<0?a+h>0?a+h:0:a<h?a:h)>0?o-s:0,l=new i(u);if(dn(l,u),0===u)return l;if(on(ri(r)))throw vi("Attempting to access detached ArrayBuffer");for(var d=0;s<o;)l[d]=Xi(r[s]),++s,++d;return l},t.subarray=function(){ln(this);var t=fn(this),r=sn(t,e),i=new oi(ri(t),ii(t),ni(t)),n=ti.apply(void 0,[i].concat(Vi([].slice.call(arguments)))),s=new r(ri(n),ii(n),ni(n));return dn(s),s},t.indexOf=function(e){ln(this);var t=fn(this),r=ni(t),i=rn([].slice.call(arguments,1)[0]);if(i===1/0)return-1;i<0&&(i+=r)<0&&(i=0);for(var n=i;n<r;++n)if(Pr(t,n)&&Xi(t[n])===e)return n;return-1},t.lastIndexOf=function(e){var t=[].slice.call(arguments,1);ln(this);var r=fn(this),i=ni(r),n=t.length>=1?rn(t[0]):i-1;if(n===-1/0)return-1;n>=0?n=n<i-1?n:i-1:n+=i;for(var s=n;s>=0;--s)if(Pr(r,s)&&Xi(r[s])===e)return s;return-1},t.includes=function(e){ln(this);var t=fn(this),r=ni(t),i=rn([].slice.call(arguments,1)[0]);if(i===1/0)return!1;i<0&&(i+=r)<0&&(i=0);for(var n=vr(e),s=i;s<r;++s){var o=Xi(t[s]);if(n&&vr(o))return!0;if(o===e)return!0}return!1},t.join=function(){ln(this);var e=vn(fn(this));return Lr.apply(void 0,[e].concat(Vi([].slice.call(arguments))))},t.toLocaleString=function(){ln(this);var e=vn(fn(this));return Sr.apply(void 0,[e].concat(Vi([].slice.call(arguments))))},h(e,[{key:mr,get:function(){if(un(this))return"Float16Array"}}]),e}();wr(wn,"BYTES_PER_ELEMENT",{value:2}),wr(wn,hn,{}),ur(wn,Hr);var Tn=wn.prototype;wr(Tn,"BYTES_PER_ELEMENT",{value:2}),wr(Tn,pr,{value:Tn.values,writable:!0,configurable:!0}),ur(Tn,Vr);var xn=new t.GLDataTexture({textureWidth:0,textureHeight:0});function _n(e){e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}var Mn=function(){this.positionsDecompressMatrices=void 0,this.positionsCompressed=void 0,this.indices_8Bits=void 0,this.indices_16Bits=void 0,this.indices_32Bits=void 0,this.edgeIndices_8Bits=void 0,this.edgeIndices_16Bits=void 0,this.edgeIndices_32Bits=void 0,this.eachPrimitiveMesh_8Bits=void 0,this.eachPrimitiveMesh_16Bits=void 0,this.eachPrimitiveMesh_32Bits=void 0,this.eachEdgeMesh_8Bits=void 0,this.eachEdgeMesh_16Bits=void 0,this.eachEdgeMesh_32Bits=void 0,this.eachMeshVertexPortionBase=void 0,this.eachMeshVertexPortionOffset=void 0,this.eachMeshEdgeIndicesOffset=void 0,this.eachMeshColor=void 0,this.eachMeshPickColor=void 0,this.eachMeshMatrices=void 0,this.eachMeshNormalMatrix=void 0,this.eachMeshPositionsDecompressMatrix=void 0,this.eachMeshFlags1=void 0,this.eachMeshFlags2=void 0,this.eachEdgeOffset=void 0,this.eachMeshParts=void 0,this.positionsDecompressMatrices=[],this.positionsCompressed=[],this.indices_8Bits=[],this.indices_16Bits=[],this.indices_32Bits=[],this.edgeIndices_8Bits=[],this.edgeIndices_16Bits=[],this.edgeIndices_32Bits=[],this.eachMeshVertexPortionBase=[],this.eachMeshVertexPortionOffset=[],this.eachMeshEdgeIndicesOffset=[],this.eachMeshColor=[],this.eachMeshPickColor=[],this.eachMeshMatrices=[],this.eachMeshNormalMatrix=[],this.eachMeshPositionsDecompressMatrix=[],this.eachMeshFlags1=[],this.eachMeshFlags2=[],this.eachPrimitiveMesh_32Bits=[],this.eachPrimitiveMesh_16Bits=[],this.eachPrimitiveMesh_8Bits=[],this.eachEdgeMesh_32Bits=[],this.eachEdgeMesh_16Bits=[],this.eachEdgeMesh_8Bits=[],this.eachEdgeOffset=[],this.eachMeshParts=[]},Pn=8,On=e.identityMat4(),Cn=e.createVec4([0,0,0,1]),In=e.createVec4([0,0,0,1]);e.createVec4([0,0,0,1]);var Ln=new Uint8Array(4),Rn=new Float32Array(3),Sn=/*#__PURE__*/g("gl"),Dn=/*#__PURE__*/g("view"),An=/*#__PURE__*/g("dataTextureBuffer"),Bn=/*#__PURE__*/g("geometryHandles"),jn=/*#__PURE__*/g("meshPartHandles"),Fn=/*#__PURE__*/g("numMeshParts"),kn=/*#__PURE__*/g("deferredSetFlagsActive"),Un=/*#__PURE__*/g("deferredSetFlagsDirty"),Gn=/*#__PURE__*/g("built"),Nn=/*#__PURE__*/g("createGeometryBucket"),Hn=/*#__PURE__*/g("createMeshPart"),Xn=/*#__PURE__*/g("setMeshFlags"),Vn=/*#__PURE__*/g("setMeshFlags2"),Wn=/*#__PURE__*/function(){function r(e,t){Object.defineProperty(this,Vn,{value:Kn}),Object.defineProperty(this,Xn,{value:Yn}),Object.defineProperty(this,Hn,{value:qn}),Object.defineProperty(this,Nn,{value:zn}),this.rendererModel=void 0,this.layerIndex=void 0,this.meshCounts=void 0,this.renderState=void 0,Object.defineProperty(this,Sn,{writable:!0,value:void 0}),Object.defineProperty(this,Dn,{writable:!0,value:void 0}),Object.defineProperty(this,An,{writable:!0,value:void 0}),Object.defineProperty(this,Bn,{writable:!0,value:void 0}),Object.defineProperty(this,jn,{writable:!0,value:void 0}),Object.defineProperty(this,Fn,{writable:!0,value:void 0}),Object.defineProperty(this,kn,{writable:!0,value:void 0}),Object.defineProperty(this,Un,{writable:!0,value:void 0}),Object.defineProperty(this,Gn,{writable:!0,value:void 0}),this.meshCounts=new Zt,this.layerIndex=e.layerIndex,this.rendererModel=e.rendererModel,this.renderState={primitive:e.primitive,dataTextureSet:new Qt,numIndices8Bits:0,numIndices16Bits:0,numIndices32Bits:0,numEdgeIndices8Bits:0,numEdgeIndices16Bits:0,numEdgeIndices32Bits:0,numVertices:0},m(this,Sn)[Sn]=e.gl,m(this,Dn)[Dn]=e.view,m(this,An)[An]=new Mn,m(this,Fn)[Fn]=0,m(this,Bn)[Bn]={},m(this,jn)[jn]=[],m(this,Gn)[Gn]=!1,this.beginDeferredFlags()}var i=r.prototype;return i.canCreateMesh=function(e){if(m(this,Gn)[Gn])throw"Already built";var t=this.renderState,r=e.geometryBuckets.length;if(m(this,Fn)[Fn]+r>4096)return!1;for(var i=0,n=0,s=0;s<r;s++){var o=e.geometryBuckets[s];i+=o.positionsCompressed.length,o.indices&&(n+=o.indices.length)}return t.numVertices+i/(e.primitive===M?1:e.primitive==P?2:3)<=2097152&&n/3+n<=2097152},i.hasGeometry=function(e){return m(this,Bn)[Bn][e]},i.createGeometryCompressed=function(e){if(m(this,Gn)[Gn])throw"Already built";for(var t=[],r=0,i=e.geometryBuckets.length;r<i;r++)t.push(m(this,Nn)[Nn](e.geometryBuckets[r]));m(this,Bn)[Bn][e.id]={id:e.id,aabb:e.aabb,positionsDecompressMatrix:e.positionsDecompressMatrix,geometryBucketHandles:t}},i.createMesh=function(t){var r=this;if(m(this,Gn)[Gn])throw new Error("Already built");var i=this.meshCounts.numMeshes;if(!t.geometryId)throw new Error("geometryId expected");var s=m(this,Bn)[Bn][t.geometryId];if(!s)throw new Error("Geometry not found");s.geometryBucketHandles.forEach(function(e){m(r,Hn)[Hn](t,s,e)});for(var o=Wt(),a=function(e,t){return void 0===e&&(e=Vt()),void 0===t&&(t=n.newFloatArray(32)),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=1,t[4]=e[3],t[5]=e[1],t[6]=e[2],t[7]=1,t[8]=e[3],t[9]=e[4],t[10]=e[2],t[11]=1,t[12]=e[0],t[13]=e[4],t[14]=e[2],t[15]=1,t[16]=e[0],t[17]=e[1],t[18]=e[5],t[19]=1,t[20]=e[3],t[21]=e[1],t[22]=e[5],t[23]=1,t[24]=e[3],t[25]=e[4],t[26]=e[5],t[27]=1,t[28]=e[0],t[29]=e[4],t[30]=e[5],t[31]=1,t}(s.aabb),h=0,c=a.length;h<c;h+=4)Cn[0]=a[h+0],Cn[1]=a[h+1],Cn[2]=a[h+2],t.matrix?(e.transformPoint4(t.matrix,Cn,In),qt(o,In)):qt(o,In);return this.meshCounts.numMeshes++,i},i.build=function(){if(m(this,Gn)[Gn])throw new Error("Already built");var e=m(this,Sn)[Sn],r=m(this,An)[An],i=this.renderState.dataTextureSet;i.positions=function(e,r){var i=1024,n=Math.ceil(r.length/3/i);if(0==n)throw"texture height == 0";var s=new Uint16Array(i*n*3);s.fill(0),s.set(r,0);var o=e.createTexture();return e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGB16UI,i,n),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,n,e.RGB_INTEGER,e.UNSIGNED_SHORT,s,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new t.GLDataTexture({gl:e,texture:o,textureWidth:i,textureHeight:n})}(e,r.positionsCompressed),i.indices_8Bits=function(e,r){if(0==r.length)return xn;var i=1024,n=Math.ceil(r.length/3/i);if(0==n)throw"texture height == 0";var s=new Uint8Array(i*n*3);s.fill(0),s.set(r,0);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGB8UI,i,n),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,n,e.RGB_INTEGER,e.UNSIGNED_BYTE,s,0),_n(e),e.bindTexture(e.TEXTURE_2D,null),new t.GLDataTexture({gl:e,texture:o,textureWidth:i,textureHeight:n})):xn}(e,r.indices_8Bits),i.indices_16Bits=function(e,r){if(0==r.length)return xn;var i=1024,n=Math.ceil(r.length/3/i);if(0==n)throw"texture height == 0";var s=new Uint16Array(i*n*3);s.fill(0),s.set(r,0);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGB16UI,i,n),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,n,e.RGB_INTEGER,e.UNSIGNED_SHORT,s,0),_n(e),e.bindTexture(e.TEXTURE_2D,null),new t.GLDataTexture({gl:e,texture:o,textureWidth:i,textureHeight:n})):xn}(e,r.indices_16Bits),i.indices_32Bits=function(e,r){if(0==r.length)return xn;var i=1024,n=Math.ceil(r.length/3/i);if(0==n)throw"texture height == 0";var s=new Uint32Array(i*n*3);s.fill(0),s.set(r,0);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGB32UI,i,n),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,n,e.RGB_INTEGER,e.UNSIGNED_INT,s,0),_n(e),e.bindTexture(e.TEXTURE_2D,null),new t.GLDataTexture({gl:e,texture:o,textureWidth:i,textureHeight:n})):xn}(e,r.indices_32Bits),i.edgeIndices_8Bits=function(e,r){if(0==r.length)return xn;var i=1024,n=Math.ceil(r.length/2/i);if(0==n)throw"texture height == 0";var s=new Uint8Array(i*n*2);s.fill(0),s.set(r,0);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RG8UI,i,n),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,n,e.RG_INTEGER,e.UNSIGNED_BYTE,s,0),_n(e),e.bindTexture(e.TEXTURE_2D,null),new t.GLDataTexture({gl:e,texture:o,textureWidth:i,textureHeight:n})):xn}(e,r.edgeIndices_8Bits),i.edgeIndices_16Bits=function(e,r){if(0==r.length)return xn;var i=1024,n=Math.ceil(r.length/2/i);if(0==n)throw"texture height == 0";var s=new Uint16Array(i*n*2);s.fill(0),s.set(r,0);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RG16UI,i,n),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,n,e.RG_INTEGER,e.UNSIGNED_SHORT,s,0),_n(e),e.bindTexture(e.TEXTURE_2D,null),new t.GLDataTexture({gl:e,texture:o,textureWidth:i,textureHeight:n})):xn}(e,r.edgeIndices_16Bits),i.edgeIndices_32Bits=function(e,r){if(0==r.length)return xn;var i=1024,n=Math.ceil(r.length/2/i);if(0==n)throw"texture height == 0";var s=new Uint32Array(i*n*2);s.fill(0),s.set(r,0);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RG32UI,i,n),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,n,e.RG_INTEGER,e.UNSIGNED_INT,s,0),_n(e),e.bindTexture(e.TEXTURE_2D,null),new t.GLDataTexture({gl:e,texture:o,textureWidth:i,textureHeight:n})):xn}(e,r.edgeIndices_32Bits),i.eachMeshAttributes=function(e,r,i,n,s,o){var a=r.length;if(0==a)throw"texture height == 0";for(var h=new Uint8Array(32*a),c=0;c<a;c++)h.set(r[c],28*c+0),h.set(i[c],28*c+4),h.set([0,0,0,0],28*c+8),h.set([0,0,0,0],28*c+12),h.set([n[c]>>24&255,n[c]>>16&255,n[c]>>8&255,255&n[c]],28*c+16),h.set([s[c]>>24&255,s[c]>>16&255,s[c]>>8&255,255&s[c]],28*c+20),h.set([o[c]>>24&255,o[c]>>16&255,o[c]>>8&255,255&o[c]],28*c+24);var u=e.createTexture();return u?(e.bindTexture(e.TEXTURE_2D,u),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA8UI,8,a),e.texSubImage2D(e.TEXTURE_2D,0,0,0,8,a,e.RGBA_INTEGER,e.UNSIGNED_BYTE,h,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new t.GLDataTexture({gl:e,texture:u,textureWidth:8,textureHeight:a,textureData:h})):xn}(e,r.eachMeshColor,r.eachMeshPickColor,r.eachMeshVertexPortionBase,r.eachMeshVertexPortionOffset,r.eachMeshEdgeIndicesOffset),i.eachMeshMatrices=function(e,r,i){var n=r.length;if(0==n)throw"texture height == 0";for(var s=new wn(48*n),o=0;o<r.length;o++)s.set(r[o],48*o),s.set(i[o],48*o+16);var a=e.createTexture();return a?(e.bindTexture(e.TEXTURE_2D,a),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA16F,12,n),e.texSubImage2D(e.TEXTURE_2D,0,0,0,12,n,e.RGBA,e.HALF_FLOAT,new Uint16Array(s.buffer),0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new t.GLDataTexture({gl:e,texture:a,textureWidth:12,textureHeight:n})):xn}(e,r.eachMeshPositionsDecompressMatrix,r.eachMeshMatrices),i.eachEdgeOffset=function(e,r){var i=r.length;if(0==i)throw"texture height == 0";for(var n=new Float32Array(3*i),s=0;s<r.length;s++)n.set(r[s],3*s);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGB32F,1,i),e.texSubImage2D(e.TEXTURE_2D,0,0,0,1,i,e.RGB,e.FLOAT,n,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new t.GLDataTexture({gl:e,texture:o,textureWidth:1,textureHeight:i,textureData:n})):xn}(e,r.eachEdgeOffset),i.build(),m(this,An)[An]=null,m(this,Bn)[Bn]={},m(this,jn)[jn]=[],m(this,Gn)[Gn]=!0},i.isEmpty=function(){return 0==this.meshCounts.numMeshes},i.initFlags=function(e,t,r){t&Jt.VISIBLE&&this.meshCounts.numVisible++,t&Jt.HIGHLIGHTED&&this.meshCounts.numHighlighted++,t&Jt.XRAYED&&this.meshCounts.numXRayed++,t&Jt.SELECTED&&this.meshCounts.numSelected++,t&Jt.CLIPPABLE&&this.meshCounts.numClippable++,t&Jt.EDGES&&this.meshCounts.numEdges++,t&Jt.PICKABLE&&this.meshCounts.numPickable++,t&Jt.CULLED&&this.meshCounts.numCulled++,r&&this.meshCounts.numTransparent++,m(this,Xn)[Xn](e,t,r),m(this,Vn)[Vn](e,t)},i.beginDeferredFlags=function(){m(this,kn)[kn]=!0},i.commitDeferredFlags=function(){if(m(this,kn)[kn]=!1,m(this,Un)[Un]){m(this,Un)[Un]=!1;var e=m(this,Sn)[Sn],t=this.renderState.dataTextureSet;e.bindTexture(e.TEXTURE_2D,t.eachMeshAttributes.texture),e.texSubImage2D(e.TEXTURE_2D,0,0,0,t.eachMeshAttributes.textureWidth,t.eachMeshAttributes.textureHeight,e.RGBA_INTEGER,e.UNSIGNED_BYTE,t.eachMeshAttributes.textureData),e.bindTexture(e.TEXTURE_2D,t.eachEdgeOffset.texture),e.texSubImage2D(e.TEXTURE_2D,0,0,0,t.eachEdgeOffset.textureWidth,t.eachEdgeOffset.textureHeight,e.RGB,e.FLOAT,t.eachEdgeOffset.textureData)}},i.flushInitFlags=function(){this.commitDeferredFlags()},i.setMeshVisible=function(e,t,r){if(!m(this,Gn)[Gn])throw"Not built";t&Jt.VISIBLE?this.meshCounts.numVisible++:this.meshCounts.numVisible--,m(this,Xn)[Xn](e,t,r)},i.setMeshHighlighted=function(e,t,r){if(!m(this,Gn)[Gn])throw"Not built";t&Jt.HIGHLIGHTED?this.meshCounts.numHighlighted++:this.meshCounts.numHighlighted--,m(this,Xn)[Xn](e,t,r)},i.setMeshXRayed=function(e,t,r){if(!m(this,Gn)[Gn])throw"Not built";t&Jt.XRAYED?this.meshCounts.numXRayed++:this.meshCounts.numXRayed--,m(this,Xn)[Xn](e,t,r)},i.setMeshSelected=function(e,t,r){if(!m(this,Gn)[Gn])throw"Not built";t&Jt.SELECTED?this.meshCounts.numSelected++:this.meshCounts.numSelected--,m(this,Xn)[Xn](e,t,r)},i.setMeshEdges=function(e,t,r){if(!m(this,Gn)[Gn])throw"Not built";t&Jt.EDGES?this.meshCounts.numEdges++:this.meshCounts.numEdges--,m(this,Xn)[Xn](e,t,r)},i.setMeshClippable=function(e,t){if(!m(this,Gn)[Gn])throw"Not built";t&Jt.CLIPPABLE?this.meshCounts.numClippable++:this.meshCounts.numClippable--,m(this,Vn)[Vn](e,t)},i.setMeshCulled=function(e,t,r){if(!m(this,Gn)[Gn])throw"Not built";t&Jt.CULLED?this.meshCounts.numCulled++:this.meshCounts.numCulled--,m(this,Xn)[Xn](e,t,r)},i.setMeshCollidable=function(e,t){if(!m(this,Gn)[Gn])throw"Not built"},i.setMeshPickable=function(e,t,r){if(!m(this,Gn)[Gn])throw"Not built";t&Jt.PICKABLE?this.meshCounts.numPickable++:this.meshCounts.numPickable--,m(this,Xn)[Xn](e,t,r)},i.setMeshColor=function(e,t,r){if(!m(this,Gn)[Gn])throw"Not built";var i=this.renderState.dataTextureSet,n=m(this,Sn)[Sn];Ln[0]=t[0],Ln[1]=t[1],Ln[2]=t[2],Ln[3]=t[3],i.eachMeshAttributes.textureData.set(Ln,28*e),m(this,kn)[kn]?m(this,Un)[Un]=!0:(n.bindTexture(n.TEXTURE_2D,i.eachMeshAttributes.texture),n.texSubImage2D(n.TEXTURE_2D,0,0,e,1,1,n.RGBA_INTEGER,n.UNSIGNED_BYTE,Ln))},i.setMeshTransparent=function(e,t,r){if(!m(this,Gn)[Gn])throw"Not built";r?(this.meshCounts.numTransparent++,this.meshCounts.numTransparent++):(this.meshCounts.numTransparent--,this.meshCounts.numTransparent--),m(this,Xn)[Xn](e,t,r)},i.setMeshOffset=function(e,t){if(!m(this,Gn)[Gn])throw"Not built";var r=m(this,Sn)[Sn];Rn[0]=t[0],Rn[1]=t[1],Rn[2]=t[2],m(this,kn)[kn]?m(this,Un)[Un]=!0:r.texSubImage2D(r.TEXTURE_2D,0,0,e,1,1,r.RGB,r.FLOAT,Rn)},i.setMeshMatrix=function(e,t){if(!m(this,Gn)[Gn])throw"Not built";m(this,Sn),m(this,kn)[kn]&&(m(this,Un)[Un]=!0)},i.setMeshViewMatrixIndex=function(e,t){if(!m(this,Gn)[Gn])throw"Not built";m(this,Sn),m(this,kn)[kn]&&(m(this,Un)[Un]=!0)},i.destroy=function(){this.renderState.dataTextureSet.destroy()},h(r,[{key:"hash",get:function(){return"layer-"+this.renderState.primitive}}]),r}();function zn(e){var t=this.renderState;if(e.indices){var r=this.renderState.primitive===M?1:this.renderState.primitive===P?2:3,i=Math.ceil(e.indices.length/r/Pn)*Pn*r,n=new Uint32Array(i);n.fill(0),n.set(e.indices),e.indices=n}if(e.edgeIndices){var s=Math.ceil(e.edgeIndices.length/2/Pn)*Pn*2,o=new Uint32Array(s);o.fill(0),o.set(e.edgeIndices),e.edgeIndices=o}for(var a,h=m(this,An)[An],c=e.positionsCompressed,u=e.indices,l=e.edgeIndices,d=h.positionsCompressed.length/3,f=c.length/3,v=0,p=c.length;v<p;v++)h.positionsCompressed.push(c[v]);var g,y=0;if(u){var b;y=u.length/3,a=(b=f<=256?h.indices_8Bits:f<=65536?h.indices_16Bits:h.indices_32Bits).length/3;for(var E=0,w=u.length;E<w;E++)b.push(u[E])}var T=0;if(l){var x;T=l.length/2,g=(x=f<=256?h.edgeIndices_8Bits:f<=65536?h.edgeIndices_16Bits:h.edgeIndices_32Bits).length/2;for(var _=0,O=l.length;_<O;_++)x.push(l[_])}return t.numVertices+=f,{vertexBase:d,numVertices:f,numTriangles:y,numEdges:T,indicesBase:a,edgeIndicesBase:g}}function qn(e,t,r){var i,n=m(this,An)[An],s=this.renderState,o=e.matrix||On,a=e.color||[255,255,255],h=n.positionsCompressed.length/3;n.eachMeshPositionsDecompressMatrix.push(t.positionsDecompressMatrix),n.eachMeshMatrices.push(o),n.eachMeshColor.push([a[0],a[1],a[2],255]),n.eachMeshPickColor.push(e.pickColor),i=r.numVertices<=256?s.numIndices8Bits:r.numVertices<=65536?s.numIndices16Bits:s.numIndices32Bits,n.eachMeshVertexPortionBase.push(r.vertexBase),n.eachMeshVertexPortionOffset.push(i/3-r.indicesBase),n.eachMeshEdgeIndicesOffset.push((r.numVertices<=256?s.numEdgeIndices8Bits:r.numVertices<=65536?s.numEdgeIndices16Bits:s.numEdgeIndices32Bits)/2-r.edgeIndicesBase);var c=m(this,jn)[jn].length;if(r.numTriangles>0){var u,l=3*r.numTriangles;r.numVertices<=256?(u=n.eachPrimitiveMesh_8Bits,s.numIndices8Bits+=l):r.numVertices<=65536?(u=n.eachPrimitiveMesh_16Bits,s.numIndices16Bits+=l):(u=n.eachPrimitiveMesh_32Bits,s.numIndices32Bits+=l);for(var d=0;d<r.numTriangles;d+=Pn)u.push(c)}if(r.numEdges>0){var f,v=2*r.numEdges;r.numVertices<=256?(f=n.eachEdgeMesh_8Bits,s.numEdgeIndices8Bits+=v):r.numVertices<=65536?(f=n.eachEdgeMesh_16Bits,s.numEdgeIndices16Bits+=v):(f=n.eachEdgeMesh_32Bits,s.numEdgeIndices32Bits+=v);for(var p=0;p<r.numEdges;p+=Pn)f.push(c)}return n.eachEdgeOffset.push([0,0,0]),m(this,jn)[jn].push({vertsBase:h,numVerts:r.numTriangles}),m(this,Fn)[Fn]++,c}function Yn(e,t,r){if(!m(this,Gn)[Gn])throw"Not built";var i,n,s,o=!!(t&Jt.VISIBLE),a=!!(t&Jt.XRAYED),h=!!(t&Jt.HIGHLIGHTED),c=!!(t&Jt.SELECTED),u=!!(t&Jt.CULLED);i=!o||u||a?Ot.NOT_RENDERED:r?Ot.COLOR_TRANSPARENT:Ot.COLOR_OPAQUE,n=!o||u?Ot.NOT_RENDERED:c?Ot.SILHOUETTE_SELECTED:h?Ot.SILHOUETTE_HIGHLIGHTED:a?Ot.SILHOUETTE_XRAYED:Ot.NOT_RENDERED,s=!o||u?Ot.NOT_RENDERED:c?Ot.EDGES_SELECTED:h?Ot.EDGES_HIGHLIGHTED:a?Ot.EDGES_XRAYED:t&Jt.EDGES?r?Ot.EDGES_COLOR_TRANSPARENT:Ot.EDGES_COLOR_OPAQUE:Ot.NOT_RENDERED;var l=o&&!u&&t&Jt.PICKABLE?Ot.PICK:Ot.NOT_RENDERED,d=this.renderState.dataTextureSet,f=m(this,Sn)[Sn];if(Ln[0]=i,Ln[1]=n,Ln[2]=s,Ln[3]=l,m(this,kn)[kn])return d.eachMeshAttributes.textureData.set(Ln,28*e+8),void(m(this,Un)[Un]=!0);f.bindTexture(f.TEXTURE_2D,d.eachMeshAttributes.texture),f.texSubImage2D(f.TEXTURE_2D,0,2,e,1,1,f.RGBA_INTEGER,f.UNSIGNED_BYTE,Ln)}function Kn(e,t){if(!m(this,Gn)[Gn])throw"Not built";var r=t&Jt.CLIPPABLE?255:0,i=this.renderState.dataTextureSet,n=m(this,Sn)[Sn];if(Ln[0]=r,Ln[1]=0,Ln[2]=1,Ln[3]=2,m(this,kn)[kn])return i.eachMeshAttributes.textureData.set(Ln,28*e+12),void(m(this,Un)[Un]=!0);n.bindTexture(n.TEXTURE_2D,i.eachMeshAttributes.texture),n.texSubImage2D(n.TEXTURE_2D,0,3,e,1,1,n.RGBA_INTEGER,n.UNSIGNED_BYTE,Ln)}var Qn=function(){},Zn=/*#__PURE__*/function(){function e(e,t){this.texture=void 0,this.texture2D=void 0,this.texture=e,this.texture2D=t}return e.prototype.destroy=function(){this.texture2D&&this.texture2D.destroy()},e}(),Jn=new Uint16Array([0,0,0]),$n=/*#__PURE__*/g("flags"),es=/*#__PURE__*/g("aabb"),ts=/*#__PURE__*/g("offsetAABB"),rs=/*#__PURE__*/g("offset"),is=/*#__PURE__*/g("colorizeUpdated"),ns=/*#__PURE__*/g("opacityUpdated"),ss=/*#__PURE__*/function(){function t(t){this.id=void 0,this.model=void 0,this.sceneObject=void 0,this.layerId=void 0,this.rendererMeshes=void 0,Object.defineProperty(this,$n,{writable:!0,value:void 0}),Object.defineProperty(this,es,{writable:!0,value:void 0}),Object.defineProperty(this,ts,{writable:!0,value:void 0}),Object.defineProperty(this,rs,{writable:!0,value:void 0}),Object.defineProperty(this,is,{writable:!0,value:void 0}),Object.defineProperty(this,ns,{writable:!0,value:void 0}),this.id=t.id,this.rendererMeshes=t.rendererMeshes||[],m(this,$n)[$n]=0,m(this,es)[es]=t.aabb,m(this,ts)[ts]=Vt(t.aabb),m(this,rs)[rs]=e.createVec3(),m(this,is)[is]=!1,m(this,ns)[ns]=!1,this.layerId=t.layerId||null;for(var r=0,i=this.rendererMeshes.length;r<i;r++)this.rendererMeshes[r].setSceneObject(this)}var r=t.prototype;return r.setVisible=function(e,t){if(!!(m(this,$n)[$n]&Jt.VISIBLE)!==t){m(this,$n)[$n]=t?m(this,$n)[$n]|Jt.VISIBLE:m(this,$n)[$n]&~Jt.VISIBLE;for(var r=0,i=this.rendererMeshes.length;r<i;r++)this.rendererMeshes[r].setVisible(m(this,$n)[$n])}},r.setHighlighted=function(e,t){if(!!(m(this,$n)[$n]&Jt.HIGHLIGHTED)!==t){m(this,$n)[$n]=t?m(this,$n)[$n]|Jt.HIGHLIGHTED:m(this,$n)[$n]&~Jt.HIGHLIGHTED;for(var r=0,i=this.rendererMeshes.length;r<i;r++)this.rendererMeshes[r].setHighlighted(m(this,$n)[$n])}},r.setXRayed=function(e,t){if(!!(m(this,$n)[$n]&Jt.XRAYED)!==t){m(this,$n)[$n]=t?m(this,$n)[$n]|Jt.XRAYED:m(this,$n)[$n]&~Jt.XRAYED;for(var r=0,i=this.rendererMeshes.length;r<i;r++)this.rendererMeshes[r].setXRayed(m(this,$n)[$n])}},r.setSelected=function(e,t){if(!!(m(this,$n)[$n]&Jt.SELECTED)!==t){m(this,$n)[$n]=t?m(this,$n)[$n]|Jt.SELECTED:m(this,$n)[$n]&~Jt.SELECTED;for(var r=0,i=this.rendererMeshes.length;r<i;r++)this.rendererMeshes[r].setSelected(m(this,$n)[$n])}},r.setEdges=function(e,t){if(!!(m(this,$n)[$n]&Jt.EDGES)!==t){m(this,$n)[$n]=t?m(this,$n)[$n]|Jt.EDGES:m(this,$n)[$n]&~Jt.EDGES;for(var r=0,i=this.rendererMeshes.length;r<i;r++)this.rendererMeshes[r].setEdges(m(this,$n)[$n])}},r.setCulled=function(e,t){if(!!(m(this,$n)[$n]&Jt.CULLED)!==t){m(this,$n)[$n]=t?m(this,$n)[$n]|Jt.CULLED:m(this,$n)[$n]&~Jt.CULLED;for(var r=0,i=this.rendererMeshes.length;r<i;r++)this.rendererMeshes[r].setCulled(m(this,$n)[$n])}},r.setClippable=function(e,t){if(!!(m(this,$n)[$n]&Jt.CLIPPABLE)!==t){m(this,$n)[$n]=t?m(this,$n)[$n]|Jt.CLIPPABLE:m(this,$n)[$n]&~Jt.CLIPPABLE;for(var r=0,i=this.rendererMeshes.length;r<i;r++)this.rendererMeshes[r].setClippable(m(this,$n)[$n])}},r.setCollidable=function(e,t){if(!!(m(this,$n)[$n]&Jt.COLLIDABLE)!==t){m(this,$n)[$n]=t?m(this,$n)[$n]|Jt.COLLIDABLE:m(this,$n)[$n]&~Jt.COLLIDABLE;for(var r=0,i=this.rendererMeshes.length;r<i;r++)this.rendererMeshes[r].setCollidable(m(this,$n)[$n])}},r.setPickable=function(e,t){if(!!(m(this,$n)[$n]&Jt.PICKABLE)!==t){m(this,$n)[$n]=t?m(this,$n)[$n]|Jt.PICKABLE:m(this,$n)[$n]&~Jt.PICKABLE;for(var r=0,i=this.rendererMeshes.length;r<i;r++)this.rendererMeshes[r].setPickable(m(this,$n)[$n])}},r.setColorize=function(e,t){if(t){Jn[0]=Math.floor(255*t[0]),Jn[1]=Math.floor(255*t[1]),Jn[2]=Math.floor(255*t[2]);for(var r=0,i=this.rendererMeshes.length;r<i;r++)this.rendererMeshes[r].setColorize(Jn)}else for(var n=0,s=this.rendererMeshes.length;n<s;n++)this.rendererMeshes[n].setColorize(null)},r.setOpacity=function(e,t){if(0!==this.rendererMeshes.length){var r=this.rendererMeshes[0].colorize[3],i=255;if(null!=t){if(t<0?t=0:t>1&&(t=1),r===(i=Math.floor(255*t)))return}else if(r===(i=255))return;for(var n=0,s=this.rendererMeshes.length;n<s;n++)this.rendererMeshes[n].setOpacity(i,m(this,$n)[$n])}},r.setOffset=function(e,t){},r.build=function(){for(var e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].build(m(this,$n)[$n])},r.finalize2=function(){for(var e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].finalize2()},r.destroy=function(){for(var e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].destroy()},h(t,[{key:"aabb",get:function(){return m(this,ts)[ts]}}]),t}(),os=e.createMat4(),as=e.createMat4(),hs=/*#__PURE__*/function(){function t(e){this.id=void 0,this.color=void 0,this.rendererGeometry=void 0,this.rendererTextureSet=void 0,this.matrix=void 0,this.metallic=void 0,this.roughness=void 0,this.opacity=void 0,this.pickId=void 0,this.tileManager=void 0,this.tile=void 0,this.sceneObjectRenderer=void 0,this.aabb=void 0,this.layer=void 0,this.meshIndex=void 0,this.colorize=void 0,this.colorizing=void 0,this.transparent=void 0,this.sceneObjectRenderer=null,this.tileManager=e.tileManager,this.id=e.id,this.pickId=0,this.color=[e.color[0],e.color[1],e.color[2],e.opacity],this.colorize=[e.color[0],e.color[1],e.color[2],e.opacity],this.colorizing=!1,this.transparent=e.opacity<255,this.layer=e.layer,this.matrix=e.matrix,this.metallic=e.metallic,this.roughness=e.roughness,this.opacity=e.opacity,this.aabb=Vt(),this.rendererTextureSet=e.rendererTextureSet,this.rendererGeometry=e.rendererGeometry,this.meshIndex=e.meshIndex}var r=t.prototype;return r.delegatePickedEntity=function(){throw new Error("Method not implemented.")},r.setSceneObject=function(e){this.sceneObjectRenderer=e},r.build=function(e){this.layer.initFlags(this.meshIndex,e,this.transparent)},r.finalize2=function(){this.layer.flushInitFlags&&this.layer.flushInitFlags()},r.setVisible=function(e){this.layer.setMeshVisible(this.meshIndex,e,this.transparent)},r.setMatrix=function(t){var r=e.transformPoint3(t,[0,0,0]),i=this.tile;this.tile=i?this.tileManager.updateTileCenter(i,r):this.tileManager.getTile(r);var n=!i||i.id!==this.tile.id,s=this.tile.center;this.layer.setMeshMatrix(this.meshIndex,0!==s[0]||0!==s[1]||0!==s[2]?e.mulMat4(t,e.translationMat4c(-s[0],-s[1],-s[2],os),as):t),n&&this.layer.setMeshViewMatrixIndex(this.meshIndex,this.tile.index)},r.setMetallic=function(e){},r.setRoughness=function(e){},r.setColor=function(e){this.color[0]=e[0],this.color[1]=e[1],this.color[2]=e[2],this.colorizing||this.layer.setMeshColor(this.meshIndex,this.color)},r.setColorize=function(e){e?(this.colorize[0]=e[0],this.colorize[1]=e[1],this.colorize[2]=e[2],this.layer.setMeshColor(this.meshIndex,this.colorize,!1),this.colorizing=!0):(this.layer.setMeshColor(this.meshIndex,this.color,!1),this.colorizing=!1)},r.setOpacity=function(e,t){var r=e<255,i=this.transparent!==r;this.color[3]=e,this.colorize[3]=e,this.transparent=r,this.layer.setMeshColor(this.meshIndex,this.colorizing?this.colorize:this.color),i&&this.layer.setMeshTransparent(this.meshIndex,t,r)},r.setHighlighted=function(e){this.layer.setMeshHighlighted(this.meshIndex,e,this.transparent)},r.setXRayed=function(e){this.layer.setMeshXRayed(this.meshIndex,e,this.transparent)},r.setSelected=function(e){this.layer.setMeshSelected(this.meshIndex,e,this.transparent)},r.setEdges=function(e){this.layer.setMeshEdges(this.meshIndex,e,this.transparent)},r.setClippable=function(e){this.layer.setMeshClippable(this.meshIndex,e)},r.setCollidable=function(e){this.layer.setMeshCollidable(this.meshIndex,e)},r.setPickable=function(e){this.layer.setMeshPickable(this.meshIndex,e,this.transparent)},r.setCulled=function(e){this.layer.setMeshCulled(this.meshIndex,e,this.transparent)},r.canPickTriangle=function(){return!1},r.drawPickTriangles=function(e,t){},r.pickTriangleSurface=function(e){},r.canPickWorldPos=function(){return!0},r.drawPickNormals=function(e){},r.destroy=function(){this.tile&&this.tileManager&&this.tileManager.putTile(this.tile)},t}(),cs=function(e){this.id=void 0,this.colorTexture=void 0,this.metallicRoughnessTexture=void 0,this.emissiveTexture=void 0,this.occlusionTexture=void 0,this.id=e.id,this.colorTexture=e.colorTexture,this.metallicRoughnessTexture=e.metallicRoughnessTexture,this.emissiveTexture=e.emissiveTexture,this.occlusionTexture=e.occlusionTexture};e.createVec3(),e.createMat4(),e.createVec3([1,1,1]),e.createVec3([0,0,0]),e.createVec3([0,0,0]),e.identityQuat();var us="defaultTextureSet",ls=/*#__PURE__*/g("view"),ds=/*#__PURE__*/g("webglRenderer"),fs=/*#__PURE__*/g("renderContext"),vs=/*#__PURE__*/g("position"),ps=/*#__PURE__*/g("rotation"),gs=/*#__PURE__*/g("quaternion"),ms=/*#__PURE__*/g("scale"),ys=/*#__PURE__*/g("worldMatrix"),bs=/*#__PURE__*/g("viewMatrix"),Es=/*#__PURE__*/g("colorTextureEnabled"),ws=/*#__PURE__*/g("backfaces"),Ts=/*#__PURE__*/g("layers"),xs=/*#__PURE__*/g("numGeometries"),_s=/*#__PURE__*/g("numTriangles"),Ms=/*#__PURE__*/g("numLines"),Ps=/*#__PURE__*/g("numPoints"),Os=/*#__PURE__*/g("numViewerObjects"),Cs=/*#__PURE__*/g("textureTranscoder"),Is=/*#__PURE__*/g("aabbDirty"),Ls=/*#__PURE__*/g("edgeThreshold"),Rs=/*#__PURE__*/g("currentLayers"),Ss=/*#__PURE__*/g("aabb"),Ds=/*#__PURE__*/g("viewMatrixDirty"),As=/*#__PURE__*/g("worldMatrixNonIdentity"),Bs=/*#__PURE__*/g("onCameraViewMatrix"),js=/*#__PURE__*/g("layerId"),Fs=/*#__PURE__*/g("addModel"),ks=/*#__PURE__*/g("addTexture"),Us=/*#__PURE__*/g("addGeometry"),Gs=/*#__PURE__*/g("addMesh"),Ns=/*#__PURE__*/g("addObject"),Hs=/*#__PURE__*/g("removeModel"),Xs=/*#__PURE__*/g("createDefaultTextureSetRenderer"),Vs=/*#__PURE__*/g("getLayer"),Ws=/*#__PURE__*/g("rebuildAABB"),zs=/*#__PURE__*/function(t){function n(n){var s;s=t.call(this,n.view)||this,Object.defineProperty(d(s),Ws,{value:to}),Object.defineProperty(d(s),Vs,{value:eo}),Object.defineProperty(d(s),Xs,{value:$s}),Object.defineProperty(d(s),Hs,{value:Js}),Object.defineProperty(d(s),Ns,{value:Zs}),Object.defineProperty(d(s),Gs,{value:Qs}),Object.defineProperty(d(s),Us,{value:Ks}),Object.defineProperty(d(s),ks,{value:Ys}),Object.defineProperty(d(s),Fs,{value:qs}),s.qualityRender=void 0,s.sceneModel=void 0,s.rendererGeometries=void 0,s.rendererTextures=void 0,s.rendererTextureSets=void 0,s.rendererMeshes=void 0,s.rendererObjects=void 0,s.rendererObjectsList=void 0,s.rendererViewObjects=void 0,s.viewer=void 0,s.layerList=void 0,s.onBuilt=void 0,Object.defineProperty(d(s),ls,{writable:!0,value:void 0}),Object.defineProperty(d(s),ds,{writable:!0,value:void 0}),Object.defineProperty(d(s),fs,{writable:!0,value:void 0}),Object.defineProperty(d(s),vs,{writable:!0,value:void 0}),Object.defineProperty(d(s),ps,{writable:!0,value:void 0}),Object.defineProperty(d(s),gs,{writable:!0,value:void 0}),Object.defineProperty(d(s),ms,{writable:!0,value:void 0}),Object.defineProperty(d(s),ys,{writable:!0,value:void 0}),Object.defineProperty(d(s),bs,{writable:!0,value:void 0}),Object.defineProperty(d(s),Es,{writable:!0,value:void 0}),Object.defineProperty(d(s),ws,{writable:!0,value:void 0}),Object.defineProperty(d(s),Ts,{writable:!0,value:void 0}),Object.defineProperty(d(s),xs,{writable:!0,value:void 0}),Object.defineProperty(d(s),_s,{writable:!0,value:void 0}),Object.defineProperty(d(s),Ms,{writable:!0,value:void 0}),Object.defineProperty(d(s),Ps,{writable:!0,value:void 0}),Object.defineProperty(d(s),Os,{writable:!0,value:void 0}),Object.defineProperty(d(s),Cs,{writable:!0,value:void 0}),Object.defineProperty(d(s),Is,{writable:!0,value:void 0}),Object.defineProperty(d(s),Ls,{writable:!0,value:void 0}),Object.defineProperty(d(s),Rs,{writable:!0,value:void 0}),Object.defineProperty(d(s),Ss,{writable:!0,value:void 0}),Object.defineProperty(d(s),Ds,{writable:!0,value:void 0}),Object.defineProperty(d(s),As,{writable:!0,value:void 0}),Object.defineProperty(d(s),Bs,{writable:!0,value:void 0}),Object.defineProperty(d(s),js,{writable:!0,value:void 0}),s.id=n.id,s.sceneModel=n.sceneModel,s.viewer=n.view.viewer,m(d(s),ls)[ls]=n.view,m(d(s),ds)[ds]=n.webglRenderer,m(d(s),fs)[fs]=n.renderContext,m(d(s),Cs)[Cs]=n.textureTranscoder,m(d(s),Ss)[Ss]=Wt(),m(d(s),Is)[Is]=!1,m(d(s),Ts)[Ts]={},s.layerList=[],m(d(s),Rs)[Rs]={},s.rendererGeometries={},s.rendererTextures={},s.rendererTextureSets={},s.rendererMeshes={},s.rendererObjects={},s.rendererObjectsList=[],s.rendererViewObjects={},m(d(s),xs)[xs]=0,m(d(s),Os)[Os]=0,m(d(s),_s)[_s]=0,m(d(s),Ms)[Ms]=0,m(d(s),Ps)[Ps]=0,m(d(s),Ls)[Ls]=n.edgeThreshold||10,s.built=!1,m(d(s),vs)[vs]=e.createVec3(n.position||[0,0,0]),m(d(s),ps)[ps]=e.createVec3(n.rotation||[0,0,0]),m(d(s),gs)[gs]=e.createVec4(n.quaternion||[0,0,0,1]),n.rotation&&e.eulerToQuat(m(d(s),ps)[ps],"XYZ",m(d(s),gs)[gs]),m(d(s),ms)[ms]=e.createVec3(n.scale||[1,1,1]),m(d(s),ys)[ys]=e.createMat4(),e.composeMat4(m(d(s),vs)[vs],m(d(s),gs)[gs],m(d(s),ms)[ms],m(d(s),ys)[ys]),(n.matrix||n.position||n.rotation||n.scale||n.quaternion)&&(m(d(s),bs)[bs]=e.createMat4(),m(d(s),Ds)[Ds]=!0,m(d(s),As)[As]=!0),s.qualityRender=!1!==n.qualityRender,m(d(s),js)[js]=n.layerId,m(d(s),Bs)[Bs]=m(d(s),ls)[ls].camera.onViewMatrix.subscribe(function(e,t){m(d(s),Ds)[Ds]=!0}),m(d(s),Xs)[Xs](),s.onBuilt=new r.EventEmitter(new i.EventDispatcher),m(d(s),Fs)[Fs](n.sceneModel);for(var o=0,a=s.layerList.length;o<a;o++)s.layerList[o].layerIndex=o;return m(d(s),Rs)[Rs]={},s.built=!0,m(d(s),ds)[ds].setImageDirty(),s.onBuilt.dispatch(d(s),null),s}u(n,t);var s=n.prototype;return s.setVisible=function(e,t){for(var r=0,i=this.rendererObjectsList.length;r<i;r++)this.rendererObjectsList[r].setVisible(e,t);m(this,ds)[ds].setImageDirty(e)},s.setXRayed=function(e,t){for(var r=0,i=this.rendererObjectsList.length;r<i;r++)this.rendererObjectsList[r].setXRayed(e,t);m(this,ds)[ds].setImageDirty(e)},s.setHighlighted=function(e,t){for(var r=0,i=this.rendererObjectsList.length;r<i;r++)this.rendererObjectsList[r].setHighlighted(e,t);m(this,ds)[ds].setImageDirty(e)},s.setSelected=function(e,t){for(var r=0,i=this.rendererObjectsList.length;r<i;r++)this.rendererObjectsList[r].setSelected(e,t);m(this,ds)[ds].setImageDirty(e)},s.setEdges=function(e,t){for(var r=0,i=this.rendererObjectsList.length;r<i;r++)this.rendererObjectsList[r].setEdges(e,t);m(this,ds)[ds].setImageDirty(e)},s.setCulled=function(e,t){for(var r=0,i=this.rendererObjectsList.length;r<i;r++)this.rendererObjectsList[r].setCulled(e,t);m(this,ds)[ds].setImageDirty(e)},s.setClippable=function(e,t){for(var r=0,i=this.rendererObjectsList.length;r<i;r++)this.rendererObjectsList[r].setClippable(e,t);m(this,ds)[ds].setImageDirty(e)},s.setCollidable=function(e,t){for(var r=0,i=this.rendererObjectsList.length;r<i;r++)this.rendererObjectsList[r].setCollidable(e,t)},s.setPickable=function(e,t){for(var r=0,i=this.rendererObjectsList.length;r<i;r++)this.rendererObjectsList[r].setPickable(e,t)},s.setColorize=function(e,t){for(var r=0,i=this.rendererObjectsList.length;r<i;r++)this.rendererObjectsList[r].setColorize(e,t)},s.setOpacity=function(e,t){for(var r=0,i=this.rendererObjectsList.length;r<i;r++)this.rendererObjectsList[r].setOpacity(e,t)},s.destroy=function(){if(!this.destroyed){for(var e in m(this,Hs)[Hs](),m(this,ls)[ls].camera.onViewMatrix.unsubscribe(m(this,Bs)[Bs]),m(this,Rs)[Rs])m(this,Rs)[Rs].hasOwnProperty(e)&&m(this,Rs)[Rs][e].destroy();for(var r=0,i=this.layerList.length;r<i;r++)this.layerList[r].destroy();for(var n in this.rendererObjects)this.rendererObjects[n].destroy();m(this,Rs)[Rs]={},m(this,Ts)[Ts]={},this.layerList=[],this.rendererGeometries={},this.rendererTextures={},this.rendererTextureSets={},this.rendererMeshes={},this.rendererViewObjects={},this.onBuilt.clear(),t.prototype.destroy.call(this)}},h(n,[{key:"position",get:function(){return m(this,vs)[vs]}},{key:"rotation",get:function(){return m(this,ps)[ps]}},{key:"quaternion",get:function(){return m(this,gs)[gs]}},{key:"scale",get:function(){return m(this,ms)[ms]}},{key:"worldMatrix",get:function(){return m(this,ys)[ys]}},{key:"viewMatrix",get:function(){return m(this,bs)[bs]?(m(this,Ds)[Ds]&&(e.mulMat4(m(this,ls)[ls].camera.viewMatrix,m(this,ys)[ys],m(this,bs)[bs]),m(this,Ds)[Ds]=!1),m(this,bs)[bs]):m(this,ls)[ls].camera.viewMatrix}},{key:"colorTextureEnabled",get:function(){return m(this,Es)[Es]}},{key:"backfaces",get:function(){return m(this,ws)[ws]},set:function(e){e=!!e,m(this,ws)[ws]=e,m(this,ds)[ds].setImageDirty()}},{key:"matrix",get:function(){return m(this,ys)[ys]}},{key:"aabb",get:function(){return m(this,Is)[Is]&&m(this,Ws)[Ws](),m(this,Ss)[Ss]}},{key:"numTriangles",get:function(){return m(this,_s)[_s]}},{key:"numLines",get:function(){return m(this,Ms)[Ms]}},{key:"numPoints",get:function(){return m(this,Ps)[Ps]}}]),n}(r.Component);function qs(e){var t=e.textures,r=e.geometries,i=e.meshes,n=e.objects;if(t)for(var s in t){var o=t[s];m(this,ks)[ks](o)}if(r)for(var a in r){var h=r[a];m(this,Us)[Us](h)}if(i)for(var c in i){var u=i[c];m(this,Gs)[Gs](u)}if(n)for(var l in n){var d=n[l];m(this,Ns)[Ns](d)}for(var f in m(this,Rs)[Rs])m(this,Rs)[Rs].hasOwnProperty(f)&&m(this,Rs)[Rs][f].build();for(var v=0,p=this.rendererObjectsList.length;v<p;v++)this.rendererObjectsList[v].build();for(var g=0,y=this.rendererObjectsList.length;g<y;g++)this.rendererObjectsList[g].finalize2()}function Ys(e){var r=this,i=e.id;if(this.rendererTextures[i])throw new Error("RendererTexture already created: "+i);var n=new t.GLTexture({gl:m(this,fs)[fs].gl});if(e.preloadColor&&n.setPreloadColor(e.preloadColor),e.image){var s=e.image;s.crossOrigin="Anonymous",n.setImage(s,{minFilter:e.minFilter,magFilter:e.magFilter,wrapS:e.wrapS,wrapT:e.wrapT,wrapR:e.wrapR,flipY:e.flipY,encoding:e.encoding})}else if(e.src){var o=e.src.split(".").pop();switch(o){case"jpeg":case"jpg":case"png":case"gif":var a=new Image;a.onload=function(){n.setImage(a,{minFilter:e.minFilter,magFilter:e.magFilter,wrapS:e.wrapS,wrapT:e.wrapT,wrapR:e.wrapR,flipY:e.flipY,encoding:e.encoding})},a.src=e.src;break;default:m(this,Cs)[Cs]?function(e,t,r){var i=function(e){};t=t||i,r=r||i;var n=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(n){var s=!!n[2],o=n[3];o=window.decodeURIComponent(o),s&&(o=window.atob(o));try{for(var a=new ArrayBuffer(o.length),h=new Uint8Array(a),c=0;c<o.length;c++)h[c]=o.charCodeAt(c);window.setTimeout(function(){t(a)},0)}catch(e){window.setTimeout(function(){r(e)},0)}}else{var u=new XMLHttpRequest;u.open("GET",e,!0),u.responseType="arraybuffer",u.onreadystatechange=function(){4===u.readyState&&(200===u.status?t(u.response):r("loadArrayBuffer error : "+u.response))},u.send(null)}}(e.src,function(e){e.byteLength?m(r,Cs)[Cs].transcode([e]).then(function(e){n.setCompressedData(e),m(r,ds)[ds].setImageDirty()}):r.error("Can't create texture from 'src': file data is zero length")},function(e){r.error("Can't create texture from 'src': "+e)}):this.error("Can't create texture from 'src' - rendererModel needs to be configured with a TextureTranscoder for this file type ('"+o+"')")}}else e.buffers&&(m(this,Cs)[Cs]?m(this,Cs)[Cs].transcode(e.buffers).then(function(e){n.setCompressedData(e),m(r,ds)[ds].setImageDirty()}):this.error("Can't create texture from 'buffers' - rendererModel needs to be configured with a TextureTranscoder for this option"));var h=new Zn(e,n);e.rendererTexture=h,this.rendererTextures[i]=h}function Ks(e){var t=e.id;if(this.rendererGeometries[t])throw new Error("GeometryRenderer already created: "+t);var r=new Qn;this.rendererGeometries[t]=r,e.rendererGeometry=r,m(this,xs)[xs]++}function Qs(e){var t=this.rendererGeometries[e.geometry.id];if(!t)throw new Error("RendererGeometry not found");var r=this.rendererTextureSets[e.textureSet.id];if(!r)throw new Error("rendererTextureSet not found");var i=m(this,Vs)[Vs](e.textureSet.id,e.geometry);if(i){var n;i.hasGeometry(e.geometry.id)||i.createGeometryCompressed(e.geometry),m(this,As)[As]&&m(this,ys),n=e.matrix;var s=e.color?new Uint8Array([Math.floor(255*e.color[0]),Math.floor(255*e.color[1]),Math.floor(255*e.color[2])]):[255,255,255],o=null!=e.opacity?Math.floor(255*e.opacity):255,a=null!=e.metallic?Math.floor(255*e.metallic):0,h=null!=e.roughness?Math.floor(255*e.roughness):255,c=new hs({tileManager:m(this,ds)[ds].tileManager,id:e.id,layer:i,color:s,opacity:o,matrix:n,metallic:a,roughness:h,rendererTextureSet:r,rendererGeometry:t,meshIndex:0});c.pickId=m(this,ds)[ds].registerPickable(c);var u=new Uint8Array([255&c.pickId,c.pickId>>8&255,c.pickId>>16&255,c.pickId>>24&255]);Wt(c.aabb);var l=i.createMesh({id:e.id,geometryId:e.geometry.id,color:s,opacity:o,metallic:a,roughness:h,matrix:n,pickColor:u});m(this,xs)[xs]++,zt(m(this,Ss)[Ss],c.aabb),c.layer=i,c.meshIndex=l,this.rendererMeshes[e.id]=c}}function Zs(e){var t=e.id;void 0===t?t=_():this.rendererObjects[t]&&(this.error("[createObject] rendererModel already has a ViewerObject with this ID: "+t+" - will assign random ID"),t=_());var r=e.meshes;if(void 0===r)throw new Error("[createObject] Param expected: meshes");for(var i=[],n=0,s=r.length;n<s;n++)i.push(this.rendererMeshes[r[n].id]);var o=new ss({id:t,rendererModel:this,rendererMeshes:i,aabb:e.aabb,layerId:m(this,js)[js]});this.rendererObjectsList.push(o),this.rendererObjects[t]=o,this.rendererViewObjects[t]=o,m(this,Os)[Os]++}function Js(){var e=this.sceneModel;if(e){var t=e.textures,r=e.geometries,i=e.meshes,n=e.objects;if(t)for(var s in t){var o=t[s];o.rendererTexture&&(o.rendererTexture=null)}if(r)for(var a in r){var h=r[a];h.rendererGeometry&&(h.rendererGeometry=null)}if(i)for(var c in i){var u=i[c];u.rendererMesh&&(u.rendererMesh=null)}if(n)for(var l in n){var d=n[l];d.rendererObject&&(d.rendererObject=null)}this.sceneModel=null}}function $s(){var e=new Zn(null,new t.GLTexture({gl:m(this,fs)[fs].gl,preloadColor:[1,1,1,1]})),r=new Zn(null,new t.GLTexture({gl:m(this,fs)[fs].gl,preloadColor:[0,1,1,1]})),i=new Zn(null,new t.GLTexture({gl:m(this,fs)[fs].gl,preloadColor:[0,0,0,0]})),n=new Zn(null,new t.GLTexture({gl:m(this,fs)[fs].gl,preloadColor:[0,0,0,1]})),s=new Zn(null,new t.GLTexture({gl:m(this,fs)[fs].gl,preloadColor:[1,1,1,1]}));this.rendererTextures.defaultColorTexture=e,this.rendererTextures.defaultMetalRoughTexture=r,this.rendererTextures.defaultNormalsTexture=i,this.rendererTextures.defaultEmissiveTexture=n,this.rendererTextures.defaultOcclusionTexture=s,this.rendererTextureSets[us]=new cs({id:us,colorTexture:e,metallicRoughnessTexture:r,emissiveTexture:n,occlusionTexture:s})}function eo(e,t){var r,i=e+"_"+t.primitive,n=m(this,Rs)[Rs][i];if(n){if(n.canCreateMesh(t))return n;n.build(),delete m(this,Rs)[Rs][i]}if(!e||(r=this.rendererTextureSets[e]))return n=new Wn({gl:m(this,fs)[fs].gl,view:m(this,ls)[ls],rendererModel:this,primitive:t.primitive,textureSet:r,layerIndex:0}),m(this,Ts)[Ts][i]=n,this.layerList.push(n),m(this,Rs)[Rs][i]=n,n;this.error("TextureSet not found: "+e+" - ensure that you create it first with createTextureSet()")}function to(){Wt(m(this,Ss)[Ss]);for(var e=0,t=this.rendererObjectsList.length;e<t;e++){var r=this.rendererObjectsList[e];zt(m(this,Ss)[Ss],r.aabb)}m(this,Is)[Is]=!1}e.createVec3();var ro=new Float32Array(16),io=new Float64Array(4),no=new Float64Array(4);function so(t,r,i){return void 0===i&&(i=ro),io[0]=r[0],io[1]=r[1],io[2]=r[2],io[3]=1,e.transformVec4(t,io,no),e.setMat4Translation(t,no,i),i}function oo(e,t,r){return void 0===r&&(r=200),t[0]=Math.round(e[0]/r)*r,t[1]=Math.round(e[1]/r)*r,t[2]=Math.round(e[2]/r)*r,t}var ao=2e3,ho=/*#__PURE__*/g("gl"),co=/*#__PURE__*/g("indexesUsed"),uo=/*#__PURE__*/g("tiles"),lo=/*#__PURE__*/g("dataTexture"),fo=/*#__PURE__*/g("camera"),vo=/*#__PURE__*/g("lastFreeIndex"),po=/*#__PURE__*/g("putFreeTile"),go=/*#__PURE__*/g("findFreeTile"),mo=/*#__PURE__*/function(){function r(e){Object.defineProperty(this,go,{value:bo}),Object.defineProperty(this,po,{value:yo}),Object.defineProperty(this,ho,{writable:!0,value:void 0}),Object.defineProperty(this,co,{writable:!0,value:void 0}),Object.defineProperty(this,uo,{writable:!0,value:void 0}),Object.defineProperty(this,lo,{writable:!0,value:void 0}),Object.defineProperty(this,fo,{writable:!0,value:void 0}),Object.defineProperty(this,vo,{writable:!0,value:void 0}),m(this,fo)[fo]=e.camera,m(this,ho)[ho]=e.gl,m(this,co)[co]=[],m(this,vo)[vo]=0,m(this,uo)[uo]={},m(this,lo)[lo]=function(e,r){var i=ao;if(0==i)throw"texture height == 0";var n=new wn(48*i),s=e.createTexture();return s?(e.bindTexture(e.TEXTURE_2D,s),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA16F,12,i),e.texSubImage2D(e.TEXTURE_2D,0,0,0,12,i,e.RGBA,e.HALF_FLOAT,new Uint16Array(n.buffer),0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new t.GLDataTexture({gl:e,texture:s,textureWidth:12,textureHeight:i})):xn}(m(this,ho)[ho])}var i=r.prototype;return i.getTile=function(t){var r=oo(t,e.createVec3()),i=r[0]+"-"+r[1]+"-"+r[2],n=m(this,uo)[uo][i];return n||(n={id:i,index:m(this,go)[go](),useCount:0,center:e.createVec3(),rtcViewMatrix:e.createMat4()},m(this,uo)[uo][n.id]=n),n.useCount++,n},i.putTile=function(e){--e.useCount<=0&&(delete m(this,uo)[uo][e.id],m(this,po)[po](e.index))},i.updateTileCenter=function(t,r){var i=oo(r,e.createVec3()),n=i[0]+"-"+i[1]+"-"+i[2];if(n===t.id)return t;this.putTile(t);var s=m(this,uo)[uo][n];return s||(s={id:n,index:m(this,go)[go](),useCount:0,center:e.createVec3(),rtcViewMatrix:e.createMat4()},m(this,uo)[uo][s.id]=s),s.useCount++,s},i.refreshMatrices=function(){if(m(this,lo)[lo].texture){for(var e=m(this,ho)[ho],t=m(this,fo)[fo].viewMatrix,r=Object.keys(m(this,uo)[uo]),i=new Float32Array(16*r.length),n=0,s=r.length;n<s;n++){var o=r[n],a=m(this,uo)[uo][o];so(t,a.center,a.rtcViewMatrix),i.set(a.rtcViewMatrix,16*a.index)}e.bindTexture(e.TEXTURE_2D,m(this,lo)[lo].texture),e.texSubImage2D(e.TEXTURE_2D,0,0,0,1,1,e.RGBA,e.FLOAT,i),e.bindTexture(e.TEXTURE_2D,null)}},r}();function yo(e){delete m(this,co)[co][e],m(this,vo)[vo]=e}function bo(){for(var e=m(this,vo)[vo];;e=(e+1)%ao)if(!m(this,co)[co][e])return m(this,co)[co][e]=!0,e}var Eo=navigator.userAgent.match(/(opera|chrome|safari|firefox|msie|mobile)\/?\s*(\.?\d+(\.\d+)*)/i),wo=Eo&&"safari"===Eo[1].toLowerCase(),To=/*#__PURE__*/g("sceneModels"),xo=/*#__PURE__*/g("viewer"),_o=/*#__PURE__*/g("view"),Mo=/*#__PURE__*/g("renderContext"),Po=/*#__PURE__*/g("canvasTransparent"),Oo=/*#__PURE__*/g("transparentEnabled"),Co=/*#__PURE__*/g("edgesEnabled"),Io=/*#__PURE__*/g("imageDirty"),Lo=/*#__PURE__*/g("saoEnabled"),Ro=/*#__PURE__*/g("pbrEnabled"),So=/*#__PURE__*/g("backgroundColor"),Do=/*#__PURE__*/g("rendererModels"),Ao=/*#__PURE__*/g("layerList"),Bo=/*#__PURE__*/g("layerListDirty"),jo=/*#__PURE__*/g("stateSortDirty"),Fo=/*#__PURE__*/g("pickIDs"),ko=/*#__PURE__*/g("saoDepthRenderBuffer"),Uo=/*#__PURE__*/g("renderBufferManager"),Go=/*#__PURE__*/g("extensionHandles"),No=/*#__PURE__*/g("logarithmicDepthBufferEnabled"),Ho=/*#__PURE__*/g("alphaDepthMask"),Xo=/*#__PURE__*/g("occlusionTester"),Vo=/*#__PURE__*/g("textureTranscoder"),Wo=/*#__PURE__*/g("layerRenderers"),zo=/*#__PURE__*/g("viewMatrixDirty"),qo=/*#__PURE__*/g("registerRendererViewObjects"),Yo=/*#__PURE__*/g("deregisterRendererViewObjects"),Ko=/*#__PURE__*/g("updateLayerList"),Qo=/*#__PURE__*/g("buildLayerList"),Zo=/*#__PURE__*/g("draw"),Jo=/*#__PURE__*/g("activateExtensions"),$o=/*#__PURE__*/g("drawSAOBuffers"),ea=/*#__PURE__*/g("drawDepth"),ta=/*#__PURE__*/g("drawColor"),ra=/*#__PURE__*/g("drawLayer"),ia=/*#__PURE__*/function(){function r(t){Object.defineProperty(this,ra,{value:fa}),Object.defineProperty(this,ta,{value:da}),Object.defineProperty(this,ea,{value:la}),Object.defineProperty(this,$o,{value:ua}),Object.defineProperty(this,Jo,{value:ca}),Object.defineProperty(this,Zo,{value:ha}),Object.defineProperty(this,Qo,{value:aa}),Object.defineProperty(this,Ko,{value:oa}),Object.defineProperty(this,Yo,{value:sa}),Object.defineProperty(this,qo,{value:na}),this.rendererViewObjects=void 0,this.tileManager=void 0,Object.defineProperty(this,To,{writable:!0,value:void 0}),Object.defineProperty(this,xo,{writable:!0,value:void 0}),Object.defineProperty(this,_o,{writable:!0,value:void 0}),Object.defineProperty(this,Mo,{writable:!0,value:void 0}),Object.defineProperty(this,Po,{writable:!0,value:void 0}),Object.defineProperty(this,Oo,{writable:!0,value:void 0}),Object.defineProperty(this,Co,{writable:!0,value:void 0}),Object.defineProperty(this,Io,{writable:!0,value:void 0}),Object.defineProperty(this,Lo,{writable:!0,value:void 0}),Object.defineProperty(this,Ro,{writable:!0,value:void 0}),Object.defineProperty(this,So,{writable:!0,value:void 0}),Object.defineProperty(this,Do,{writable:!0,value:void 0}),Object.defineProperty(this,Ao,{writable:!0,value:void 0}),Object.defineProperty(this,Bo,{writable:!0,value:void 0}),Object.defineProperty(this,jo,{writable:!0,value:void 0}),Object.defineProperty(this,Fo,{writable:!0,value:new x({})}),Object.defineProperty(this,ko,{writable:!0,value:void 0}),Object.defineProperty(this,Uo,{writable:!0,value:void 0}),Object.defineProperty(this,Go,{writable:!0,value:void 0}),Object.defineProperty(this,No,{writable:!0,value:void 0}),Object.defineProperty(this,Ho,{writable:!0,value:void 0}),Object.defineProperty(this,Xo,{writable:!0,value:void 0}),Object.defineProperty(this,Vo,{writable:!0,value:void 0}),Object.defineProperty(this,Wo,{writable:!0,value:void 0}),Object.defineProperty(this,zo,{writable:!0,value:void 0}),this.tileManager=null,m(this,To)[To]={},this.rendererViewObjects={},m(this,Vo)[Vo]=t.textureTranscoder||new Q({}),m(this,Po)[Po]=!1,m(this,Ho)[Ho]=!1,m(this,Go)[Go]={},m(this,Fo)[Fo]=new x({}),m(this,Ao)[Ao]=[],m(this,Bo)[Bo]=!0,m(this,jo)[jo]=!0,m(this,Io)[Io]=!0,m(this,Oo)[Oo]=!0,m(this,Co)[Co]=!0,m(this,Lo)[Lo]=!0,m(this,Ro)[Ro]=!0,m(this,So)[So]=e.createVec3(),m(this,Xo)[Xo]=null,m(this,No)[No]=!1,m(this,Do)[Do]={},m(this,zo)[zo]=!0}var i=r.prototype;return i.init=function(e){m(this,xo)[xo]=e,m(this,Vo)[Vo].init(m(this,xo)[xo].capabilities)},i.getCapabilities=function(e){e.maxViews=1;var r,i=document.createElement("canvas");try{r=i.getContext("webgl2")}catch(e){console.error("Failed to get a WebGL context")}r&&(e.astcSupported=!!t.getExtension(r,"WEBGL_compressed_texture_astc"),e.etc1Supported=!0,e.etc2Supported=!!t.getExtension(r,"WEBGL_compressed_texture_etc"),e.dxtSupported=!!t.getExtension(r,"WEBGL_compressed_texture_s3tc"),e.bptcSupported=!!t.getExtension(r,"EXT_texture_compression_bptc"),e.pvrtcSupported=!(!t.getExtension(r,"WEBGL_compressed_texture_pvrtc")&&!t.getExtension(r,"WEBKIT_WEBGL_compressed_texture_pvrtc")))},i.registerView=function(e){var t=this;if(m(this,Mo)[Mo])throw"Only one View allowed with WebGLRenderer (see WebViewerCapabilities.maxViews)";m(this,_o)[_o]=e;for(var r=["webglutils"],i=e.canvasElement,n={},s=null,o=0;!s&&o<r.length;o++)try{s=i.getContext(r[o],n)}catch(e){}return s?(s&&s.hint(s.FRAGMENT_SHADER_DERIVATIVE_HINT,s.NICEST),m(this,Mo)[Mo]=new $(m(this,xo)[xo],m(this,_o)[_o],s),this.tileManager=new mo({camera:e.camera,gl:s}),m(this,Wo)[Wo]={colorTriangles:new Xt(m(this,Mo)[Mo])},e.camera.onViewMatrix.sub(function(){m(t,zo)[zo]=!0}),0):(console.error("Failed to get a WebGL2 context"),0)},i.deregisterView=function(e){},i.addModel=function(e){var t=this;if(!m(this,Mo)[Mo])throw new Error("Must register a View before you add a SceneModel");var r=new zs(function(e,t){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}({sceneModel:e.sceneModel,view:m(this,_o)[_o],textureTranscoder:m(this,Vo)[Vo],webglRenderer:this,renderContext:m(this,Mo)[Mo],layerId:e.layerId},e));m(this,Do)[Do][r.id]=r,m(this,qo)[qo](r),m(this,Bo)[Bo]=!0,r.onDestroyed.one(function(e){var r=m(t,Do)[Do][e.id];delete m(t,Do)[Do][e.id],m(t,Yo)[Yo](r),m(t,Bo)[Bo]=!0})},i.removeModel=function(e){if(m(this,To)[To][e]){var t=m(this,Do)[Do][e];delete m(this,Do)[Do][e],m(this,Yo)[Yo](t),m(this,Bo)[Bo]=!0}},i.registerPickable=function(e){return m(this,Fo)[Fo].addItem(e)},i.deregisterPickable=function(e){m(this,Fo)[Fo].removeItem(e)},i.setImageDirty=function(e){m(this,Io)[Io]=!0},i.setBackgroundColor=function(e,t){m(this,So)[So].set(t),m(this,Io)[Io]=!0},i.setEdgesEnabled=function(e,t){m(this,Co)[Co]=t,m(this,Io)[Io]=!0},i.setPBREnabled=function(e,t){m(this,Ro)[Ro]=t,m(this,Io)[Io]=!0},i.getSAOSupported=function(){return wo&&t.WEBGL_INFO.SUPPORTED_EXTENSIONS.OES_standard_derivatives},i.setSAOEnabled=function(e,t){m(this,Lo)[Lo]=t,m(this,Io)[Io]=!0},i.setTransparentEnabled=function(e,t){m(this,Oo)[Oo]=t,m(this,Io)[Io]=!0},i.clear=function(e){var t=m(this,Mo)[Mo].gl;t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),m(this,Po)[Po]?t.clearColor(1,1,1,1):t.clearColor(m(this,So)[So][0],m(this,So)[So][1],m(this,So)[So][2],1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},i.needsRebuild=function(e){for(var t in m(this,Wo)[Wo])m(this,Wo)[Wo][t].needRebuild()},i.needsRender=function(e){return m(this,Io)[Io]||m(this,Bo)[Bo]||m(this,jo)[jo]},i.render=function(e,t){(t=t||{}).force&&(m(this,Io)[Io]=!0),m(this,zo)[zo]&&(this.tileManager.refreshMatrices(),m(this,zo)[zo]=!1),m(this,Ko)[Ko](),m(this,Io)[Io]&&(m(this,Zo)[Zo]({clear:!0}),m(this,Io)[Io]=!1)},i.pickSceneObject=function(e,t){return null},r}();function na(e){var t=e.rendererViewObjects;for(var r in t)this.rendererViewObjects[r]=t[r]}function sa(e){var t=e.rendererViewObjects;for(var r in t)delete this.rendererViewObjects[r]}function oa(){m(this,Bo)[Bo]&&(m(this,Qo)[Qo](),m(this,Bo)[Bo]=!1,m(this,jo)[jo]=!0),m(this,jo)[jo]&&(m(this,jo)[jo]=!1,m(this,Io)[Io]=!0)}function aa(){var e=0;for(var t in m(this,Do)[Do])for(var r=m(this,Do)[Do][t],i=0,n=r.layerList.length;i<n;i++)m(this,Ao)[Ao][e++]=r.layerList[i];m(this,Ao)[Ao].length=e}function ha(e){m(this,Jo)[Jo](),m(this,Lo)[Lo]&&m(this,_o)[_o].sao.possible&&m(this,$o)[$o](e),m(this,ta)[ta](e)}function ca(){t.WEBGL_INFO.SUPPORTED_EXTENSIONS.OES_element_index_uint&&(m(this,Go)[Go].OES_element_index_uint=m(this,Mo)[Mo].gl.getExtension("OES_element_index_uint")),m(this,No)[No]&&t.WEBGL_INFO.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(m(this,Go)[Go].EXT_frag_depth=m(this,Mo)[Mo].gl.getExtension("EXT_frag_depth")),t.WEBGL_INFO.SUPPORTED_EXTENSIONS.WEBGL_depth_texture&&(m(this,Go)[Go].WEBGL_depth_texture=m(this,Mo)[Mo].gl.getExtension("WEBGL_depth_texture"))}function ua(e){}function la(e){m(this,Mo)[Mo].reset();var t=m(this,Mo)[Mo].gl;t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),t.clearColor(0,0,0,0),t.enable(t.DEPTH_TEST),t.frontFace(t.CCW),t.enable(t.CULL_FACE),t.depthMask(!0),!1!==e.clear&&t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}function da(e){var r=m(this,_o)[_o],i=m(this,Mo)[Mo],n=i.gl,s=[],o=[],a=[],h=[],c=[],u=[],l=[],d=[],f=[],v=[],p=[],g=[],y=[],b=[],E=[],w=[];i.reset(),i.withSAO=!1,i.pbrEnabled=m(this,Ro)[Ro]&&!!r.qualityRender,n.viewport(0,0,n.drawingBufferWidth,n.drawingBufferHeight),m(this,Po)[Po]?n.clearColor(0,0,0,0):n.clearColor(m(this,So)[So][0],m(this,So)[So][1],m(this,So)[So][2],1),n.enable(n.DEPTH_TEST),n.frontFace(n.CCW),n.enable(n.CULL_FACE),n.depthMask(!0),n.lineWidth(1),i.lineWidth=1;var T=r.sao.possible;if(m(this,Lo)[Lo]&&T){var x=m(this,Uo)[Uo].getRenderBuffer("saoOcclusion",{depthTexture:!1,size:[n.drawingBufferWidth,n.drawingBufferHeight]});i.occlusionTexture=x?x.getTexture():null}else i.occlusionTexture=null;!1!==e.clear&&n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT);for(var _=0,M=0,P=0,O=0,C=0,I=0,L=0,R=0,S=0,D=0,A=0,B=0,j=0,F=0,k=0,U=0,G=0,N=m(this,Ao)[Ao].length;G<N;G++){var H=m(this,Ao)[Ao][G],X=H.meshCounts;X.numCulled!==X.numMeshes&&0!==X.numVisible&&(X.numTransparent<X.numMeshes&&(m(this,Lo)[Lo]&&T&&H.rendererModel.qualityRender?s[_++]=H:m(this,ra)[ra](H,Ot.COLOR_OPAQUE,H.rendererModel.qualityRender)),m(this,Oo)[Oo]&&X.numTransparent&&(a[P++]=H),X.numXRayed>0&&r.xrayMaterial.fill&&(r.xrayMaterial.fillAlpha<1?l[L++]=H:c[C++]=H),X.numHighlighted>0&&r.highlightMaterial.fill&&(r.highlightMaterial.fillAlpha<1?p[A++]=H:f[S++]=H),X.numSelected>0&&r.selectedMaterial.fill&&(r.selectedMaterial.fillAlpha<1?E[k++]=H:y[j++]=H),m(this,Co)[Co]&&m(this,_o)[_o].edgeMaterial.edges&&X.numEdges>0&&(X.numTransparent<X.numMeshes&&(o[M++]=H),X.numTransparent>0&&(h[O++]=H),r.selectedMaterial.edgeAlpha<1?w[U++]=H:b[F++]=H,r.xrayMaterial.edgeAlpha<1?d[R++]=H:u[I++]=H,r.highlightMaterial.edgeAlpha<1?g[B++]=H:v[D++]=H))}_>0&&(i.withSAO=!0);for(var V=0;V<M;V++)m(this,ra)[ra](o[V],Ot.EDGES_COLOR_OPAQUE);for(var W=0;W<C;W++)m(this,ra)[ra](c[W],Ot.SILHOUETTE_XRAYED);for(var z=0;z<I;z++)m(this,ra)[ra](u[z],Ot.EDGES_XRAYED);if(L>0||R>0||P>0||O>0){n.enable(n.CULL_FACE),n.enable(n.BLEND),m(this,Po)[Po]?(n.blendEquation(n.FUNC_ADD),n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA)):(n.blendEquation(n.FUNC_ADD),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA)),i.backfaces=!1,m(this,Ho)[Ho]||n.depthMask(!1);for(var q=0;q<R;q++)m(this,ra)[ra](d[q],Ot.EDGES_XRAYED);for(var Y=0;Y<L;Y++)m(this,ra)[ra](l[Y],Ot.SILHOUETTE_XRAYED);(P>0||O>0)&&n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA);for(var K=0;K<O;K++)m(this,ra)[ra](h[K],Ot.EDGES_COLOR_TRANSPARENT);for(var Q=0;Q<P;Q++)m(this,ra)[ra](a[Q],Ot.COLOR_TRANSPARENT);n.disable(n.BLEND),m(this,Ho)[Ho]||n.depthMask(!0)}if(S>0||D>0){i.lastProgramId=-1,n.clear(n.DEPTH_BUFFER_BIT);for(var Z=0;Z<D;Z++)m(this,ra)[ra](v[Z],Ot.EDGES_HIGHLIGHTED);for(var J=0;J<S;J++)m(this,ra)[ra](f[J],Ot.SILHOUETTE_HIGHLIGHTED)}if(A>0||B>0||S>0){i.lastProgramId=-1,n.clear(n.DEPTH_BUFFER_BIT),n.enable(n.CULL_FACE),n.enable(n.BLEND),m(this,Po)[Po]?(n.blendEquation(n.FUNC_ADD),n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA)):n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA);for(var $=0;$<B;$++)m(this,ra)[ra](g[$],Ot.EDGES_HIGHLIGHTED);for(var ee=0;ee<A;ee++)m(this,ra)[ra](p[ee],Ot.SILHOUETTE_HIGHLIGHTED);n.disable(n.BLEND)}if(j>0||F>0){i.lastProgramId=-1,n.clear(n.DEPTH_BUFFER_BIT);for(var te=0;te<F;te++)m(this,ra)[ra](b[te],Ot.EDGES_SELECTED);for(var re=0;re<j;re++)m(this,ra)[ra](y[re],Ot.SILHOUETTE_SELECTED)}if(k>0||U>0){i.lastProgramId=-1,n.clear(n.DEPTH_BUFFER_BIT),n.enable(n.CULL_FACE),n.enable(n.BLEND),m(this,Po)[Po]?(n.blendEquation(n.FUNC_ADD),n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA)):n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA);for(var ie=0;ie<U;ie++)m(this,ra)[ra](w[ie],Ot.EDGES_SELECTED);for(var ne=0;ne<k;ne++)m(this,ra)[ra](E[ne],Ot.SILHOUETTE_SELECTED);n.disable(n.BLEND)}for(var se=t.WEBGL_INFO.MAX_TEXTURE_UNITS,oe=0;oe<se;oe++)n.activeTexture(n.TEXTURE0+oe);n.bindTexture(n.TEXTURE_CUBE_MAP,null),n.bindTexture(n.TEXTURE_2D,null);for(var ae=t.WEBGL_INFO.MAX_VERTEX_ATTRIBS,he=0;he<ae;he++)n.disableVertexAttribArray(he)}function fa(e,t,r){switch(void 0===r&&(r=!0),e.renderState.primitive){case 20002:case 20004:case 20003:switch(t){case Ot.COLOR_OPAQUE:if(e.meshCounts.numTransparent===e.meshCounts.numMeshes||e.meshCounts.numXRayed===e.meshCounts.numMeshes)return;r||m(this,Wo)[Wo].colorTriangles.draw(e);break;case Ot.COLOR_TRANSPARENT:if(0===e.meshCounts.numTransparent)return;r||m(this,Wo)[Wo].colorTriangles.draw(e)}}}exports.WebGLRenderer=ia;
//# sourceMappingURL=index.js.map
