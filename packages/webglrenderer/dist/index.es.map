{"version":3,"file":"index.es","sources":["../../utils/dist/utils.js","../../constants/dist/index.es","../../ktx2/dist/index.es","../src/RenderContext.ts","../../viewer/dist/index.es","../src/RENDER_PASSES.ts","../src/LayerRenderer.ts","../src/FastColorTrianglesRenderer.ts","../../boundaries/dist/index.es","../src/DataTextureSet.ts","../src/MeshCounts.ts","../src/SCENE_OBJECT_FLAGS.ts","../src/float16.ts","../src/dataTextures.ts","../src/DataTextureBuffer.ts","../src/Layer.ts","../src/RendererGeometryImpl.ts","../src/RendererTextureImpl.ts","../src/RendererObjectImpl.ts","../src/RendererMeshImpl.ts","../src/RendererTextureSetImpl.ts","../src/RendererModelImpl.ts","../../rtc/src/index.ts","../src/TileManager.ts","../src/WebGLRenderer.ts"],"sourcesContent":["function t(e,r){return t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},t(e,r)}var e=0;function r(t){return\"__private_\"+e+++\"_\"+t}function n(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError(\"attempted to use private field on non-instance\");return t}var i=/*#__PURE__*/r(\"items\"),o=/*#__PURE__*/r(\"lastUniqueId\"),s=/*#__PURE__*/function(){function t(t,e){Object.defineProperty(this,i,{writable:!0,value:void 0}),Object.defineProperty(this,o,{writable:!0,value:void 0}),n(this,i)[i]=t||[],n(this,o)[o]=(e||0)+1}var e=t.prototype;return e.addItem=function(){var t;if(2===arguments.length){var e=arguments[0];if(t=arguments[1],n(this,i)[i][e])throw\"ID clash: '\"+e+\"'\";return n(this,i)[i][e]=t,e}for(t=arguments[0]||{};;){var r=n(this,o)[o]++;if(!n(this,i)[i][r])return n(this,i)[i][r]=t,r}},e.removeItem=function(t){var e=n(this,i)[i][t];return delete n(this,i)[i][t],e},t}(),a=/*#__PURE__*/function(){function t(){this._head=void 0,this._headLength=void 0,this._tail=void 0,this._index=void 0,this._length=void 0,this._head=[],this._headLength=0,this._tail=[],this._index=0,this._length=0}var e,r,n=t.prototype;return n.shift=function(){if(this._index>=this._headLength){var t=this._head;if(t.length=0,this._head=this._tail,this._tail=t,this._index=0,this._headLength=this._head.length,!this._headLength)return}var e=this._head[this._index];return this._index<0?delete this._head[this._index++]:this._head[this._index++]=void 0,this._length--,e},n.push=function(t){return this._length++,this._tail.push(t),this},n.unshift=function(t){return this._head[--this._index]=t,this._length++,this},n.clear=function(){this._head=[],this._headLength=0,this._tail=[],this._index=0,this._length=0},e=t,(r=[{key:\"length\",get:function(){return this._length}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(t,\"symbol\"==typeof(i=function(t,e){if(\"object\"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,\"string\");if(\"object\"!=typeof n)return n;throw new TypeError(\"@@toPrimitive must return a primitive value.\")}return String(t)}(n.key))?i:String(i),n)}var i}(e.prototype,r),Object.defineProperty(e,\"prototype\",{writable:!1}),t}(),h=/*#__PURE__*/function(){function t(t,e,r){this.isLoading=void 0,this.itemsLoaded=void 0,this.itemsTotal=void 0,this.urlModifier=void 0,this.handlers=void 0,this.onStart=void 0,this.onLoad=void 0,this.onProgress=void 0,this.onError=void 0,this.isLoading=!1,this.itemsLoaded=0,this.itemsTotal=0,this.urlModifier=void 0,this.handlers=[],this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=r}var e=t.prototype;return e.itemStart=function(t){this.itemsTotal++,this.isLoading||void 0!==this.onStart&&this.onStart(t,this.itemsLoaded,this.itemsTotal),this.isLoading=!0},e.itemEnd=function(t){this.itemsLoaded++,void 0!==this.onProgress&&this.onProgress(t,this.itemsLoaded,this.itemsTotal),this.itemsLoaded===this.itemsTotal&&(this.isLoading=!1,void 0!==this.onLoad&&this.onLoad())},e.itemError=function(t){void 0!==this.onError&&this.onError(t)},e.resolveURL=function(t){return this.urlModifier?this.urlModifier(t):t},e.setURLModifier=function(t){return this.urlModifier=t,this},e.addHandler=function(t,e){return this.handlers.push(t,e),this},e.removeHandler=function(t){var e=this.handlers.indexOf(t);return-1!==e&&this.handlers.splice(e,2),this},e.getHandler=function(t){for(var e=0,r=this.handlers.length;e<r;e+=2){var n=this.handlers[e],i=this.handlers[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return i}return null},t}(),u=new h,d=/*#__PURE__*/function(){function t(t){this.manager=void 0,this.crossOrigin=void 0,this.withCredentials=void 0,this.path=void 0,this.resourcePath=void 0,this.requestHeader=void 0,this.manager=void 0!==t?t:u,this.crossOrigin=\"anonymous\",this.withCredentials=!1,this.path=\"\",this.resourcePath=\"\",this.requestHeader={}}var e=t.prototype;return e.load=function(t,e,r,n){},e.loadAsync=function(t,e){var r=this;return new Promise(function(n,i){r.load(t,n,e,i)})},e.parse=function(){},e.setCrossOrigin=function(t){return this.crossOrigin=t,this},e.setWithCredentials=function(t){return this.withCredentials=t,this},e.setPath=function(t){return this.path=t,this},e.setResourcePath=function(t){return this.resourcePath=t,this},e.setRequestHeader=function(t){return this.requestHeader=t,this},t}(),f=/*#__PURE__*/function(){function t(t){void 0===t&&(t=4),this.pool=void 0,this.queue=void 0,this.workers=void 0,this.workersResolve=void 0,this.workerStatus=void 0,this.workerCreator=void 0,this.pool=t,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}var e=t.prototype;return e._initWorker=function(t){if(!this.workers[t]){var e=this.workerCreator();e.addEventListener(\"message\",this._onMessage.bind(this,t)),this.workers[t]=e}},e._getIdleWorker=function(){for(var t=0;t<this.pool;t++)if(!(this.workerStatus&1<<t))return t;return-1},e._onMessage=function(t,e){var r=this.workersResolve[t];if(r&&r(e),this.queue.length){var n=this.queue.shift(),i=n.msg,o=n.transfer;this.workersResolve[t]=n.resolve,this.workers[t].postMessage(i,o)}else this.workerStatus^=1<<t},e.setWorkerCreator=function(t){this.workerCreator=t},e.setWorkerLimit=function(t){this.pool=t},e.postMessage=function(t,e){var r=this;return new Promise(function(n){var i=r._getIdleWorker();-1!==i?(r._initWorker(i),r.workerStatus|=1<<i,r.workersResolve[i]=n,r.workers[i].postMessage(t,e)):r.queue.push({resolve:n,msg:t,transfer:e})})},e.destroy=function(){this.workers.forEach(function(t){return t.terminate()}),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0},t}(),c={enabled:!1,files:{},add:function(t,e){},get:function(t){},remove:function(t){},clear:function(){this.files={}}},l={},v=/*#__PURE__*/function(e){var r,n;function i(t){var r;return(r=e.call(this,t)||this).mimeType=void 0,r.responseType=void 0,r}n=e,(r=i).prototype=Object.create(n.prototype),r.prototype.constructor=r,t(r,n);var o=i.prototype;return o.load=function(t,e,r,n){var i=this;void 0===t&&(t=\"\"),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var o=c.get(t);if(void 0!==o)return this.manager.itemStart(t),setTimeout(function(){e&&e(o),i.manager.itemEnd(t)},0),o;if(void 0===l[t]){l[t]=[],l[t].push({onLoad:e,onProgress:r,onError:n});var s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?\"include\":\"same-origin\"}),a=this.mimeType,h=this.responseType;fetch(s).then(function(e){if(200===e.status||0===e.status){if(0===e.status&&console.warn(\"FileLoader: HTTP Status 0 received.\"),\"undefined\"==typeof ReadableStream||void 0===e.body.getReader)return e;var r=l[t],n=e.body.getReader(),i=e.headers.get(\"Content-Length\"),o=i?parseInt(i):0,s=0!==o,a=0,h=new ReadableStream({start:function(t){!function e(){n.read().then(function(n){var i=n.value;if(n.done)t.close();else{for(var h=new ProgressEvent(\"progress\",{lengthComputable:s,loaded:a+=i.byteLength,total:o}),u=0,d=r.length;u<d;u++){var f=r[u];f.onProgress&&f.onProgress(h)}t.enqueue(i),e()}})}()}});return new Response(h)}throw new Error('fetch for \"'+e.url+'\" responded with '+e.status+\": \"+e.statusText)}).then(function(t){switch(h){case\"arraybuffer\":return t.arrayBuffer();case\"blob\":return t.blob();case\"document\":return t.text().then(function(t){return(new DOMParser).parseFromString(t,a)});case\"json\":return t.json();default:if(void 0===a)return t.text();var e=/charset=\"?([^;\"\\s]*)\"?/i.exec(a),r=e&&e[1]?e[1].toLowerCase():void 0,n=new TextDecoder(r);return t.arrayBuffer().then(function(t){return n.decode(t)})}}).then(function(e){c.add(t,e);var r=l[t];delete l[t];for(var n=0,i=r.length;n<i;n++){var o=r[n];o.onLoad&&o.onLoad(e)}}).catch(function(e){var r=l[t];if(void 0===r)throw i.manager.itemError(t),e;delete l[t];for(var n=0,o=r.length;n<o;n++){var s=r[n];s.onError&&s.onError(e)}i.manager.itemError(t)}).finally(function(){i.manager.itemEnd(t)}),this.manager.itemStart(t)}else l[t].push({onLoad:e,onProgress:r,onError:n})},o.setResponseType=function(t){return this.responseType=t,this},o.setMimeType=function(t){return this.mimeType=t,this},i}(d);function p(t){return JSON.parse(JSON.stringify(t))}var g=[[\"0\",10],[\"A\",26],[\"a\",26],[\"_\",1],[\"$\",1]].map(function(t){for(var e=[],r=t[0].charCodeAt(0),n=r+t[1],i=r;i<n;++i)e.push(i);return String.fromCharCode.apply(null,e)}).join(\"\");function m(t,e){return(e&&4!==e?[0,6]:[0,6,12,18]).map(function(e){return g.substr(parseInt(String(t/(1<<e)))%64,1)}).reverse().join(\"\")}function w(t){var e=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30].map(function(e){return parseInt(t.substr(e,2),16)});return m(e[0],2)+[1,4,7,10,13].map(function(t){return m((e[t]<<16)+(e[t+1]<<8)+e[t+2],4)}).join(\"\")}function y(t,e){var r=[];return function t(n){n.type===e&&r.push(n),(n.children||[]).forEach(function(e){t(e)})}(t),r}function _(t){return new Promise(function(e,r){setTimeout(e,t)})}function b(t){return new Promise(function(e,r){var n=new XMLHttpRequest;n.open(t.method||\"GET\",t.url,!0),n.onload=function(i){console.log(t.url,n.readyState,n.status),4===n.readyState&&(200===n.status?e(n.responseXML):r(n.statusText))},n.send(null)})}function L(t,e,r){var n=function(t){};e=e||n,r=r||n;var i=new XMLHttpRequest;i.overrideMimeType(\"application/json\"),i.open(\"GET\",t,!0),i.addEventListener(\"load\",function(t){var n=t.target.response;if(200===this.status){var i;try{i=JSON.parse(n)}catch(t){r(\"utils.loadJSON(): Failed to parse JSON response - \"+t)}e(i)}else if(0===this.status){console.warn(\"loadFile: HTTP Status 0 received.\");try{e(JSON.parse(n))}catch(t){r(\"utils.loadJSON(): Failed to parse JSON response - \"+t)}}else r(t)},!1),i.addEventListener(\"error\",function(t){r(t)},!1),i.send(null)}function S(t,e,r){var n=function(t){};e=e||n,r=r||n;var i=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(i){var o=!!i[2],s=i[3];s=window.decodeURIComponent(s),o&&(s=window.atob(s));try{for(var a=new ArrayBuffer(s.length),h=new Uint8Array(a),u=0;u<s.length;u++)h[u]=s.charCodeAt(u);window.setTimeout(function(){e(a)},0)}catch(t){window.setTimeout(function(){r(t)},0)}}else{var d=new XMLHttpRequest;d.open(\"GET\",t,!0),d.responseType=\"arraybuffer\",d.onreadystatechange=function(){4===d.readyState&&(200===d.status?e(d.response):r(\"loadArrayBuffer error : \"+d.response))},d.send(null)}}function P(t){return t&&!t.propertyIsEnumerable(\"length\")&&\"object\"==typeof t&&\"number\"==typeof t.length}function T(t){return\"string\"==typeof t||t instanceof String}function k(t){return!isNaN(parseFloat(t))&&isFinite(t)}function O(t){return T(t)||k(t)}function E(t){return\"function\"==typeof t}function M(t){return!!t&&t.constructor==={}.constructor}function R(t){return x(t,{})}function x(t,e){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}function C(t,e){for(var r in t)t.hasOwnProperty(r)&&null!=t[r]&&(e[r]=t[r]);return e}function j(t,e){for(var r in t)t.hasOwnProperty(r)&&null==e[r]&&(e[r]=t[r]);return e}function q(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}function H(t){return k(t)?\"\"+t:\"'\"+t+\"'\"}function I(t,e){var r=new t.constructor(t.length+e.length);return r.set(t),r.set(e,t.length),r}var N=function(){for(var t=[],e=0;e<256;e++)t[e]=(e<16?\"0\":\"\")+e.toString(16);return function(){var e=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+\"-\"+t[255&r]+t[r>>8&255]+\"-\"+t[r>>16&15|64]+t[r>>24&255]+\"-\"+t[63&n|128]+t[n>>8&255]+\"-\"+t[n>>16&255]+t[n>>24&255]+t[255&i]+t[i>>8&255]+t[i>>16&255]+t[i>>24&255]}}();export{c as Cache,u as DefaultLoadingManager,v as FileLoader,d as Loader,h as LoadingManager,s as Map,a as Queue,f as WorkerPool,x as apply,C as apply2,j as applyIf,m as b64,p as clone,w as compressGuid,I as concat,R as copy,N as createUUID,y as findNodeOfType,b as httpRequest,H as inQuotes,P as isArray,q as isEmptyObject,E as isFunction,O as isID,k as isNumeric,M as isObject,T as isString,S as loadArraybuffer,L as loadJSON,_ as timeout};\n//# sourceMappingURL=utils.js.map\n","var e=1e3,r=1001,a=1002,o=1003,p=1004,t=1004,v=1005,x=1005,b=1006,c=1007,d=1007,f=1008,g=1008,h=1009,i=1010,j=1011,k=1012,l=1013,m=1014,n=1015,q=1016,s=1017,u=1018,w=1020,y=1021,z=1022,A=1023,B=1024,C=1025,D=1026,E=1027,F=1028,G=1029,H=1030,I=1031,J=1033,K=33776,L=33777,M=33778,N=33779,O=35840,P=35841,Q=35842,R=35843,S=36196,T=37492,U=37496,V=37808,W=37809,X=37810,Y=37811,Z=37812,$=37813,_=37814,ee=37815,re=37816,ae=37817,oe=37818,pe=37819,te=37820,ve=37821,xe=36492,be=3e3,ce=3001,de=1e4,fe=10001,ge=10002,he=2e4,ie=20001,je=20002,ke=20003,le=20004,me=3e4,ne=300001,qe=4e5,se=400001,ue=400002,we=400003,ye=400004,ze=400005,Ae=5e5,Be=500001,Ce=500002,De=500003;export{y as AlphaFormat,i as ByteType,se as CentimetersUnit,r as ClampToEdgeWrapping,De as CustomProjectionType,D as DepthFormat,E as DepthStencilFormat,ne as FastRender,ye as FeetUnit,n as FloatType,Ce as FrustumProjectionType,de as GIFMediaType,q as HalfFloatType,ze as InchesUnit,l as IntType,fe as JPEGMediaType,be as LinearEncoding,b as LinearFilter,g as LinearMipMapLinearFilter,d as LinearMipMapNearestFilter,f as LinearMipmapLinearFilter,c as LinearMipmapNearestFilter,ie as LinesPrimitive,C as LuminanceAlphaFormat,B as LuminanceFormat,qe as MetersUnit,ue as MillimetersUnit,a as MirroredRepeatWrapping,o as NearestFilter,x as NearestMipMapLinearFilter,p as NearestMipMapNearestFilter,v as NearestMipmapLinearFilter,t as NearestMipmapNearestFilter,Be as OrthoProjectionType,ge as PNGMediaType,Ae as PerspectiveProjectionType,he as PointsPrimitive,me as QualityRender,A as RGBAFormat,J as RGBAIntegerFormat,pe as RGBA_ASTC_10x10_Format,re as RGBA_ASTC_10x5_Format,ae as RGBA_ASTC_10x6_Format,oe as RGBA_ASTC_10x8_Format,te as RGBA_ASTC_12x10_Format,ve as RGBA_ASTC_12x12_Format,V as RGBA_ASTC_4x4_Format,W as RGBA_ASTC_5x4_Format,X as RGBA_ASTC_5x5_Format,Y as RGBA_ASTC_6x5_Format,Z as RGBA_ASTC_6x6_Format,$ as RGBA_ASTC_8x5_Format,_ as RGBA_ASTC_8x6_Format,ee as RGBA_ASTC_8x8_Format,xe as RGBA_BPTC_Format,U as RGBA_ETC2_EAC_Format,R as RGBA_PVRTC_2BPPV1_Format,Q as RGBA_PVRTC_4BPPV1_Format,L as RGBA_S3TC_DXT1_Format,M as RGBA_S3TC_DXT3_Format,N as RGBA_S3TC_DXT5_Format,z as RGBFormat,S as RGB_ETC1_Format,T as RGB_ETC2_Format,P as RGB_PVRTC_2BPPV1_Format,O as RGB_PVRTC_4BPPV1_Format,K as RGB_S3TC_DXT1_Format,H as RGFormat,I as RGIntegerFormat,F as RedFormat,G as RedIntegerFormat,e as RepeatWrapping,j as ShortType,ke as SolidPrimitive,le as SurfacePrimitive,je as TrianglesPrimitive,h as UnsignedByteType,w as UnsignedInt248Type,m as UnsignedIntType,s as UnsignedShort4444Type,u as UnsignedShort5551Type,k as UnsignedShortType,we as YardsUnit,ce as sRGBEncoding};\n//# sourceMappingURL=index.es.map\n","var t=0;function e(e){return\"__private_\"+t+++\"_\"+e}function r(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError(\"attempted to use private field on non-instance\");return t}function o(t,e){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},o(t,e)}var i=/*#__PURE__*/function(){function t(t,e,r){this.isLoading=void 0,this.itemsLoaded=void 0,this.itemsTotal=void 0,this.urlModifier=void 0,this.handlers=void 0,this.onStart=void 0,this.onLoad=void 0,this.onProgress=void 0,this.onError=void 0,this.isLoading=!1,this.itemsLoaded=0,this.itemsTotal=0,this.urlModifier=void 0,this.handlers=[],this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=r}var e=t.prototype;return e.itemStart=function(t){this.itemsTotal++,this.isLoading||void 0!==this.onStart&&this.onStart(t,this.itemsLoaded,this.itemsTotal),this.isLoading=!0},e.itemEnd=function(t){this.itemsLoaded++,void 0!==this.onProgress&&this.onProgress(t,this.itemsLoaded,this.itemsTotal),this.itemsLoaded===this.itemsTotal&&(this.isLoading=!1,void 0!==this.onLoad&&this.onLoad())},e.itemError=function(t){void 0!==this.onError&&this.onError(t)},e.resolveURL=function(t){return this.urlModifier?this.urlModifier(t):t},e.setURLModifier=function(t){return this.urlModifier=t,this},e.addHandler=function(t,e){return this.handlers.push(t,e),this},e.removeHandler=function(t){var e=this.handlers.indexOf(t);return-1!==e&&this.handlers.splice(e,2),this},e.getHandler=function(t){for(var e=0,r=this.handlers.length;e<r;e+=2){var o=this.handlers[e],i=this.handlers[e+1];if(o.global&&(o.lastIndex=0),o.test(t))return i}return null},t}(),s=new i,n=/*#__PURE__*/function(){function t(t){this.manager=void 0,this.crossOrigin=void 0,this.withCredentials=void 0,this.path=void 0,this.resourcePath=void 0,this.requestHeader=void 0,this.manager=void 0!==t?t:s,this.crossOrigin=\"anonymous\",this.withCredentials=!1,this.path=\"\",this.resourcePath=\"\",this.requestHeader={}}var e=t.prototype;return e.load=function(t,e,r,o){},e.loadAsync=function(t,e){var r=this;return new Promise(function(o,i){r.load(t,o,e,i)})},e.parse=function(){},e.setCrossOrigin=function(t){return this.crossOrigin=t,this},e.setWithCredentials=function(t){return this.withCredentials=t,this},e.setPath=function(t){return this.path=t,this},e.setResourcePath=function(t){return this.resourcePath=t,this},e.setRequestHeader=function(t){return this.requestHeader=t,this},t}(),a=/*#__PURE__*/function(){function t(t){void 0===t&&(t=4),this.pool=void 0,this.queue=void 0,this.workers=void 0,this.workersResolve=void 0,this.workerStatus=void 0,this.workerCreator=void 0,this.pool=t,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}var e=t.prototype;return e._initWorker=function(t){if(!this.workers[t]){var e=this.workerCreator();e.addEventListener(\"message\",this._onMessage.bind(this,t)),this.workers[t]=e}},e._getIdleWorker=function(){for(var t=0;t<this.pool;t++)if(!(this.workerStatus&1<<t))return t;return-1},e._onMessage=function(t,e){var r=this.workersResolve[t];if(r&&r(e),this.queue.length){var o=this.queue.shift(),i=o.msg,s=o.transfer;this.workersResolve[t]=o.resolve,this.workers[t].postMessage(i,s)}else this.workerStatus^=1<<t},e.setWorkerCreator=function(t){this.workerCreator=t},e.setWorkerLimit=function(t){this.pool=t},e.postMessage=function(t,e){var r=this;return new Promise(function(o){var i=r._getIdleWorker();-1!==i?(r._initWorker(i),r.workerStatus|=1<<i,r.workersResolve[i]=o,r.workers[i].postMessage(t,e)):r.queue.push({resolve:o,msg:t,transfer:e})})},e.destroy=function(){this.workers.forEach(function(t){return t.terminate()}),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0},t}(),d={},h=/*#__PURE__*/function(t){var e,r;function i(e){var r;return(r=t.call(this,e)||this).mimeType=void 0,r.responseType=void 0,r}r=t,(e=i).prototype=Object.create(r.prototype),e.prototype.constructor=e,o(e,r);var s=i.prototype;return s.load=function(t,e,r,o){var i=this;if(void 0===t&&(t=\"\"),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t),void 0===d[t]){d[t]=[],d[t].push({onLoad:e,onProgress:r,onError:o});var s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?\"include\":\"same-origin\"}),n=this.mimeType,a=this.responseType;fetch(s).then(function(e){if(200===e.status||0===e.status){if(0===e.status&&console.warn(\"FileLoader: HTTP Status 0 received.\"),\"undefined\"==typeof ReadableStream||void 0===e.body.getReader)return e;var r=d[t],o=e.body.getReader(),i=e.headers.get(\"Content-Length\"),s=i?parseInt(i):0,n=0!==s,a=0,h=new ReadableStream({start:function(t){!function e(){o.read().then(function(o){var i=o.value;if(o.done)t.close();else{for(var d=new ProgressEvent(\"progress\",{lengthComputable:n,loaded:a+=i.byteLength,total:s}),h=0,u=r.length;h<u;h++){var c=r[h];c.onProgress&&c.onProgress(d)}t.enqueue(i),e()}})}()}});return new Response(h)}throw new Error('fetch for \"'+e.url+'\" responded with '+e.status+\": \"+e.statusText)}).then(function(t){switch(a){case\"arraybuffer\":return t.arrayBuffer();case\"blob\":return t.blob();case\"document\":return t.text().then(function(t){return(new DOMParser).parseFromString(t,n)});case\"json\":return t.json();default:if(void 0===n)return t.text();var e=/charset=\"?([^;\"\\s]*)\"?/i.exec(n),r=e&&e[1]?e[1].toLowerCase():void 0,o=new TextDecoder(r);return t.arrayBuffer().then(function(t){return o.decode(t)})}}).then(function(e){var r=d[t];delete d[t];for(var o=0,i=r.length;o<i;o++){var s=r[o];s.onLoad&&s.onLoad(e)}}).catch(function(e){var r=d[t];if(void 0===r)throw i.manager.itemError(t),e;delete d[t];for(var o=0,s=r.length;o<s;o++){var n=r[o];n.onError&&n.onError(e)}i.manager.itemError(t)}).finally(function(){i.manager.itemEnd(t)}),this.manager.itemStart(t)}else d[t].push({onLoad:e,onProgress:r,onError:o})},s.setResponseType=function(t){return this.responseType=t,this},s.setMimeType=function(t){return this.mimeType=t,this},i}(n);[[\"0\",10],[\"A\",26],[\"a\",26],[\"_\",1],[\"$\",1]].map(function(t){for(var e=[],r=t[0].charCodeAt(0),o=r+t[1],i=r;i<o;++i)e.push(i);return String.fromCharCode.apply(null,e)}).join(\"\"),function(){for(var t=[],e=0;e<256;e++)t[e]=(e<16?\"0\":\"\")+e.toString(16)}();var u=0,c={ETC1S:0,UASTC_4x4:1},f={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},l={RGBAFormat:1023,RGBA_ASTC_4x4_Format:37808,RGBA_BPTC_Format:36492,RGBA_ETC2_EAC_Format:37496,RGBA_PVRTC_4BPPV1_Format:35842,RGBA_S3TC_DXT5_Format:33779,RGB_ETC1_Format:36196,RGB_ETC2_Format:37492,RGB_PVRTC_4BPPV1_Format:35840,RGB_S3TC_DXT1_Format:33776},p=/*#__PURE__*/e(\"transcoderPath\"),m=/*#__PURE__*/e(\"transcoderBinary\"),v=/*#__PURE__*/e(\"transcoderPending\"),T=/*#__PURE__*/e(\"workerPool\"),g=/*#__PURE__*/e(\"workerSourceURL\"),_=/*#__PURE__*/e(\"workerConfig\"),w=/*#__PURE__*/e(\"supportedFileTypes\"),C=/*#__PURE__*/e(\"withCredentials\"),S=/*#__PURE__*/e(\"initTranscoder\"),y=/*#__PURE__*/function(){function t(t){Object.defineProperty(this,S,{value:F}),Object.defineProperty(this,p,{writable:!0,value:void 0}),Object.defineProperty(this,m,{writable:!0,value:void 0}),Object.defineProperty(this,v,{writable:!0,value:void 0}),Object.defineProperty(this,T,{writable:!0,value:void 0}),Object.defineProperty(this,g,{writable:!0,value:void 0}),Object.defineProperty(this,_,{writable:!0,value:void 0}),Object.defineProperty(this,w,{writable:!0,value:void 0}),Object.defineProperty(this,C,{writable:!0,value:void 0}),r(this,p)[p]=t.transcoderPath||\"https://cdn.jsdelivr.net/npm/@xeokit/sdk/dist/basis/\",r(this,m)[m]=null,r(this,v)[v]=null,r(this,T)[T]=new a,r(this,g)[g]=\"\",t.workerLimit&&r(this,T)[T].setWorkerLimit(t.workerLimit),r(this,_)[_]=null,r(this,C)[C]=!1,r(this,w)[w]=[\"xkt2\"]}var e=t.prototype;return e.init=function(t){r(this,_)[_]={astcSupported:t.astcSupported,etc1Supported:t.etc1Supported,etc2Supported:t.etc2Supported,dxtSupported:t.dxtSupported,bptcSupported:t.bptcSupported,pvrtcSupported:t.pvrtcSupported}},e.transcode=function(t,e){var o=this;return void 0===e&&(e={}),new Promise(function(i,s){var n=e;r(o,S)[S]().then(function(){return r(o,T)[T].postMessage({type:\"transcode\",buffers:t,taskConfig:n},t)}).then(function(t){var e=t.data,r=e.mipmaps,o=e.format,n=e.dfdTransferFn,a=e.dfdFlags;if(\"error\"===e.type)return s(e.error);i({mipmaps:r,props:{format:o,minFilter:1===r.length?1006:1008,magFilter:1===r.length?1006:1008,encoding:2===n?3001:3e3,premultiplyAlpha:!!(1&a)}})})})},e.destroy=function(){URL.revokeObjectURL(r(this,g)[g]),r(this,T)[T].destroy(),u--},t}();function F(){var t=this;if(!r(this,v)[v]){var e=new h;e.setPath(r(this,p)[p]),e.setWithCredentials(r(this,C)[C]);var o=e.loadAsync(\"basis_transcoder.js\"),i=new h;i.setPath(r(this,p)[p]),i.setResponseType(\"arraybuffer\"),i.setWithCredentials(r(this,C)[C]);var s=i.loadAsync(\"basis_transcoder.wasm\");r(this,v)[v]=Promise.all([o,s]).then(function(e){var o=e[0],i=e[1],s=P.toString(),n=[\"/* constants */\",\"let _EngineFormat = \"+JSON.stringify(l),\"let _TranscoderFormat = \"+JSON.stringify(f),\"let _BasisFormat = \"+JSON.stringify(c),\"/* basis_transcoder.js */\",o,\"/* worker */\",s.substring(s.indexOf(\"{\")+1,s.lastIndexOf(\"}\"))].join(\"\\n\");r(t,g)[g]=URL.createObjectURL(new Blob([n])),r(t,m)[m]=i,r(t,T)[T].setWorkerCreator(function(){var e=new Worker(r(t,g)[g]),o=r(t,m)[m].slice(0);return e.postMessage({type:\"init\",config:r(t,_)[_],transcoderBinary:o},[o]),e})}),u>0&&console.warn(\"KTX2TextureTranscoder: Multiple active KTX2TextureTranscoder may cause performance issues. Use a single KTX2TextureTranscoder instance, or call .dispose() on old instances.\"),u++}return r(this,v)[v]}var P=function(){var t,e,r,o=_EngineFormat,i=_TranscoderFormat,s=_BasisFormat;self.addEventListener(\"message\",function(n){var u,c=n.data;switch(c.type){case\"init\":t=c.config,u=c.transcoderBinary,e=new Promise(function(t){r={wasmBinary:u,onRuntimeInitialized:t},BASIS(r)}).then(function(){r.initializeBasis(),void 0===r.KTX2File&&console.warn(\"KTX2TextureTranscoder: Please update Basis Universal transcoder.\")});break;case\"transcode\":e.then(function(){try{for(var e=function(e){var n=new r.KTX2File(new Uint8Array(e));function u(){n.close(),n.delete()}if(!n.isValid())throw u(),new Error(\"KTX2TextureTranscoder: Invalid or unsupported .ktx2 file\");var c=n.isUASTC()?s.UASTC_4x4:s.ETC1S,f=n.getWidth(),l=n.getHeight(),p=n.getLevels(),m=n.getHasAlpha(),v=n.getDFDTransferFunc(),T=n.getDFDFlags(),g=function(e,r,n,u){for(var c=e===s.ETC1S?a:d,f=0;f<c.length;f++){var l=c[f];if(t[l.if]&&l.basisFormat.includes(e)&&!(u&&l.transcoderFormat.length<2)&&(!l.needsPowerOfTwo||h(r)&&h(n)))return{transcoderFormat:l.transcoderFormat[u?1:0],engineFormat:l.engineFormat[u?1:0]}}return console.warn(\"KTX2TextureTranscoder: No suitable compressed texture format found. Decoding to RGBA32.\"),{transcoderFormat:i.RGBA32,engineFormat:o.RGBAFormat}}(c,f,l,m),_=g.transcoderFormat,w=g.engineFormat;if(!f||!l||!p)throw u(),new Error(\"KTX2TextureTranscoder: Invalid texture\");if(!n.startTranscoding())throw u(),new Error(\"KTX2TextureTranscoder: .startTranscoding failed\");for(var C=[],S=0;S<p;S++){var y=n.getImageLevelInfo(S,0,0),F=y.origWidth,P=y.origHeight,R=new Uint8Array(n.getImageTranscodedSizeInBytes(S,0,0,_));if(!n.transcodeImage(R,S,0,0,_,0,-1,-1))throw u(),new Error(\"KTX2TextureTranscoder: .transcodeImage failed.\");C.push({data:R,width:F,height:P})}return u(),{width:f,height:l,hasAlpha:m,mipmaps:C,format:w,dfdTransferFn:v,dfdFlags:T}}(c.buffers[0]),n=e.width,u=e.height,f=e.hasAlpha,l=e.mipmaps,p=e.format,m=e.dfdTransferFn,v=e.dfdFlags,T=[],g=0;g<l.length;++g)T.push(l[g].data.buffer);self.postMessage({type:\"transcode\",id:c.id,width:n,height:u,hasAlpha:f,mipmaps:l,format:p,dfdTransferFn:m,dfdFlags:v},T)}catch(t){console.error(\"[BasisWorker]: \"+t),self.postMessage({type:\"error\",id:c.id,error:t.message})}})}});var n=[{if:\"astcSupported\",basisFormat:[s.UASTC_4x4],transcoderFormat:[i.ASTC_4x4,i.ASTC_4x4],engineFormat:[o.RGBA_ASTC_4x4_Format,o.RGBA_ASTC_4x4_Format],priorityETC1S:Infinity,priorityUASTC:1,needsPowerOfTwo:!1},{if:\"bptcSupported\",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.BC7_M5,i.BC7_M5],engineFormat:[o.RGBA_BPTC_Format,o.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:\"dxtSupported\",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.BC1,i.BC3],engineFormat:[o.RGB_S3TC_DXT1_Format,o.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:\"etc2Supported\",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.ETC1,i.ETC2],engineFormat:[o.RGB_ETC2_Format,o.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:\"etc1Supported\",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.ETC1],engineFormat:[o.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:\"pvrtcSupported\",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.PVRTC1_4_RGB,i.PVRTC1_4_RGBA],engineFormat:[o.RGB_PVRTC_4BPPV1_Format,o.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],a=n.sort(function(t,e){return t.priorityETC1S-e.priorityETC1S}),d=n.sort(function(t,e){return t.priorityUASTC-e.priorityUASTC});function h(t){return t<=2||0==(t&t-1)&&0!==t}};export{y as KTX2TextureTranscoder};\n//# sourceMappingURL=index.es.map\n","import type {View, Viewer} from \"@xeokit/viewer\";\nimport {GLAbstractTexture, GLDataTexture, WEBGL_INFO} from \"@xeokit/webglutils\";\n\n\n\n/**\n * Provides rendering context within a WebGLRenderer.\n */\nexport class RenderContext {\n\n    /**\n     * The Viewer.\n     */\n    public viewer: Viewer;\n\n    /**\n     * The View we are rendering.\n     */\n    public view: View;\n\n    /**\n     * The WebGL rendering context.\n     */\n    public gl: WebGL2RenderingContext;\n\n    public viewMatrixDataTexture: GLDataTexture;\n\n    /**\n     * Whether to render a quality representation for triangle surfaces.\n     *\n     * When ````false````, we'll render them with a fast vertex-shaded Gouraud-shaded representation, which\n     * is great for zillions of objects.\n     *\n     * When ````true````, we'll render them at a better visual quality, using smooth, per-fragment shading\n     * and a more realistic lighting model.\n     */\n    public pbrEnabled: boolean;\n\n    /**\n     * Whether SAO is currently enabled during the current frame.\n     */\n    public withSAO: boolean;\n\n    /**\n     * Whether backfaces are currently enabled during the current frame.\n     */\n    public backfaces: boolean;\n\n    /**\n     * The vertex winding order for what we currently consider to be a backface during current\n     * frame: true == \"cw\", false == \"ccw\".\n     */\n    public frontface: boolean;\n\n    /**\n     * The next available texture unit to bind a {@link GLAbstractTexture} to.\n     */\n    public textureUnit: number;\n\n    /**\n     * Statistic that counts how many times ````gl.bindTexture()```` has been called so far within the current frame.\n     */\n    public bindTexture: number;\n\n    /**\n     * Indicates which pass the renderer is currently rendering.\n     */\n    public renderPass: number;\n\n    /**\n     * The 4x4 viewing transform matrix the renderer is currently using when rendering castsShadows.\n     *\n     * This sets the viewpoint to look from the point of view of each {@link DirLight}\n     * or {@link PointLight} that casts a shadow.\n     */\n    public shadowViewMatrix: any;\n\n    /**\n     * The 4x4 viewing projection matrix the renderer is currently using when rendering shadows.\n     */\n    public shadowProjMatrix: any;\n\n    /**\n     * The 4x4 viewing transform matrix the renderer is currently using when rendering a ray-pick.\n     *\n     * This sets the viewpoint to look along the ray given to {@link Scene/pick:method\"}}Scene#pick(){{/crossLink}}\n     * when picking with a ray.\n     */\n    public pickViewMatrix: any;\n\n    /**\n     * The 4x4 orthographic projection transform matrix the renderer is currently using when rendering a ray-pick.\n     */\n    public pickProjMatrix: any;\n\n    /**\n     * Distance to the near clipping plane when rendering depth fragments for GPU-accelerated 3D picking.\n     */\n    public pickZNear: number;\n\n    /**\n     * Distance to the far clipping plane when rendering depth fragments for GPU-accelerated 3D picking.\n     */\n    public pickZFar: number;\n\n    /**\n     * Whether or not the renderer is currently picking invisible objects.\n     */\n    public pickInvisible: boolean;\n\n    /** The current line width.\n     */\n    public lineWidth: number;\n\n    /**\n     * ID of the last {@link WebGLProgram} that was bound during the current frame.\n     */\n    public lastProgramId: number;\n\n    /**\n     * The occlusion rendering texture.\n     */\n    public occlusionTexture: GLAbstractTexture | null;\n\n    constructor(viewer: Viewer, view: View, gl: WebGL2RenderingContext) {\n        this.viewer = viewer;\n        this.view = view;\n        this.gl = gl;\n        this.reset();\n    }\n\n    /**\n     * Called by the renderer before each frame.\n     */\n    reset() {\n        this.lastProgramId = -1;\n        this.pbrEnabled = false;\n        this.withSAO = false;\n        this.backfaces = false;\n        this.frontface = true;\n        this.textureUnit = 0;\n        this.shadowViewMatrix = null;\n        this.shadowProjMatrix = null;\n        this.pickViewMatrix = null;\n        this.pickProjMatrix = null;\n        this.pickZNear = 0.01;\n        this.pickZFar = 5000;\n        this.pickInvisible = false;\n        this.lineWidth = 1;\n        this.occlusionTexture = null;\n    }\n\n    /**\n     * Gets the next available texture unit for this render\n     */\n    get nextTextureUnit() {\n        const textureUnit = this.textureUnit;\n        this.textureUnit = (this.textureUnit + 1) % WEBGL_INFO.MAX_TEXTURE_UNITS;\n        return textureUnit;\n    }\n}\n","import{Component as t,EventEmitter as e,SDKError as i}from\"@xeokit/core\";import{EventDispatcher as r}from\"strongly-typed-events\";import{Scene as n}from\"@xeokit/scene\";import{newFloatArray as s,MAX_DOUBLE as o,MIN_DOUBLE as h,DEGTORAD as a}from\"@xeokit/math\";import{decompressPoint3 as c}from\"@xeokit/compression\";function l(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,\"value\"in r&&(r.writable=!0),Object.defineProperty(t,\"symbol\"==typeof(n=function(t,e){if(\"object\"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,\"string\");if(\"object\"!=typeof r)return r;throw new TypeError(\"@@toPrimitive must return a primitive value.\")}return String(t)}(r.key))?n:String(n),r)}var n}function d(t,e,i){return e&&l(t.prototype,e),i&&l(t,i),Object.defineProperty(t,\"prototype\",{writable:!1}),t}function u(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,v(t,e)}function v(t,e){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},v(t,e)}function f(t){if(void 0===t)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return t}var y=0;function p(t){return\"__private_\"+y+++\"_\"+t}function b(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError(\"attempted to use private field on non-instance\");return t}var w=0;function j(t){return\"__private_\"+w+++\"_\"+t}function g(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError(\"attempted to use private field on non-instance\");return t}var O=/*#__PURE__*/j(\"items\"),P=/*#__PURE__*/j(\"lastUniqueId\"),m=/*#__PURE__*/function(){function t(t,e){Object.defineProperty(this,O,{writable:!0,value:void 0}),Object.defineProperty(this,P,{writable:!0,value:void 0}),g(this,O)[O]=t||[],g(this,P)[P]=(e||0)+1}var e=t.prototype;return e.addItem=function(){var t;if(2===arguments.length){var e=arguments[0];if(t=arguments[1],g(this,O)[O][e])throw\"ID clash: '\"+e+\"'\";return g(this,O)[O][e]=t,e}for(t=arguments[0]||{};;){var i=g(this,P)[P]++;if(!g(this,O)[O][i])return g(this,O)[O][i]=t,i}},e.removeItem=function(t){var e=g(this,O)[O][t];return delete g(this,O)[O][t],e},t}(),k=/*#__PURE__*/function(){function t(){this._head=void 0,this._headLength=void 0,this._tail=void 0,this._index=void 0,this._length=void 0,this._head=[],this._headLength=0,this._tail=[],this._index=0,this._length=0}var e,i,r=t.prototype;return r.shift=function(){if(this._index>=this._headLength){var t=this._head;if(t.length=0,this._head=this._tail,this._tail=t,this._index=0,this._headLength=this._head.length,!this._headLength)return}var e=this._head[this._index];return this._index<0?delete this._head[this._index++]:this._head[this._index++]=void 0,this._length--,e},r.push=function(t){return this._length++,this._tail.push(t),this},r.unshift=function(t){return this._head[--this._index]=t,this._length++,this},r.clear=function(){this._head=[],this._headLength=0,this._tail=[],this._index=0,this._length=0},e=t,(i=[{key:\"length\",get:function(){return this._length}}])&&function(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,\"value\"in r&&(r.writable=!0),Object.defineProperty(t,\"symbol\"==typeof(n=function(t,e){if(\"object\"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,\"string\");if(\"object\"!=typeof r)return r;throw new TypeError(\"@@toPrimitive must return a primitive value.\")}return String(t)}(r.key))?n:String(n),r)}var n}(e.prototype,i),Object.defineProperty(e,\"prototype\",{writable:!1}),t}();function x(t){return function(t){return!isNaN(parseFloat(t))&&isFinite(t)}(t)?\"\"+t:\"'\"+t+\"'\"}[[\"0\",10],[\"A\",26],[\"a\",26],[\"_\",1],[\"$\",1]].map(function(t){for(var e=[],i=t[0].charCodeAt(0),r=i+t[1],n=i;n<r;++n)e.push(n);return String.fromCharCode.apply(null,e)}).join(\"\");var M=function(){for(var t=[],e=0;e<256;e++)t[e]=(e<16?\"0\":\"\")+e.toString(16);return function(){var e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+\"-\"+t[255&i]+t[i>>8&255]+\"-\"+t[i>>16&15|64]+t[i>>24&255]+\"-\"+t[63&r|128]+t[r>>8&255]+\"-\"+t[r>>16&255]+t[r>>24&255]+t[255&n]+t[n>>8&255]+t[n>>16&255]+t[n>>24&255]}}(),I=3e4,A=4e5,D=5e5,S=500001,V=500002,C=500003;function L(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function U(t){return new Float64Array(t||3)}function T(t){return new FloatArrayClass(t||4)}function z(t,e,i){return i||(i=t),i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i}function F(t,e,i){return i||(i=t),i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i}function _(t,e,i){return i||(i=t),i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i}function R(t,e,i){i||(i=t);var r=t[0],n=t[1],s=t[2],o=e[0],h=e[1],a=e[2];return i[0]=n*a-s*h,i[1]=s*o-r*a,i[2]=r*h-n*o,i}function W(t){return Math.sqrt(function(t){return L(t,t)}(t))}function E(t,e,i,r,n,s){var o=s||U(),h=(t-e)/(i-e);return o[0]=r[0]+h*(n[0]-r[0]),o[1]=r[1]+h*(n[1]-r[1]),o[2]=r[2]+h*(n[2]-r[2]),o}function H(t,e){return z(t,1/W(t),e)}function q(t){return s(t||16)}T(),T(),new FloatArrayClass(2);var X=q(),B=q();function N(t){return t||(t=q()),t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function G(t,e,i){i||(i=q());var r,n,s,o,h,a,c=function(t,e){return function(t,e,i){return i||(i=t),i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i[3]=t[3]*e,i}(t,1/function(t){return Math.sqrt(function(t){return function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}(t,t)}(t))}(t),[])}([e[0],e[1],e[2],0]),l=Math.sin(t),d=Math.cos(t),u=1-d,v=c[0],f=c[1],y=c[2];return r=v*f,n=f*y,s=y*v,o=v*l,h=f*l,a=y*l,i[0]=u*v*v+d,i[1]=u*r+a,i[2]=u*s-h,i[3]=0,i[4]=u*r-a,i[5]=u*f*f+d,i[6]=u*n+o,i[7]=0,i[8]=u*s+h,i[9]=u*n-o,i[10]=u*y*y+d,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Q(t,e,i,r){r||(r=q());var n,s,o,h,a,c,l,d,u,v,f=t[0],y=t[1],p=t[2],b=i[0],w=i[1],j=i[2],g=e[0],O=e[1],P=e[2];return f===g&&y===O&&p===P?N():(n=f-g,s=y-O,o=p-P,h=w*(o*=v=1/Math.sqrt(n*n+s*s+o*o))-j*(s*=v),a=j*(n*=v)-b*o,c=b*s-w*n,(v=Math.sqrt(h*h+a*a+c*c))?(h*=v=1/v,a*=v,c*=v):(h=0,a=0,c=0),l=s*c-o*a,d=o*h-n*c,u=n*a-s*h,(v=Math.sqrt(l*l+d*d+u*u))?(l*=v=1/v,d*=v,u*=v):(l=0,d=0,u=0),r[0]=h,r[1]=l,r[2]=n,r[3]=0,r[4]=a,r[5]=d,r[6]=s,r[7]=0,r[8]=c,r[9]=u,r[10]=o,r[11]=0,r[12]=-(h*f+a*y+c*p),r[13]=-(l*f+d*y+u*p),r[14]=-(n*f+s*y+o*p),r[15]=1,r)}function Y(t,e){e||(e=t);var i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],h=t[5],a=t[6],c=t[7],l=t[8],d=t[9],u=t[10],v=t[11],f=t[12],y=t[13],p=t[14],b=t[15],w=i*h-r*o,j=i*a-n*o,g=i*c-s*o,O=r*a-n*h,P=r*c-s*h,m=n*c-s*a,k=l*y-d*f,x=l*p-u*f,M=l*b-v*f,I=d*p-u*y,A=d*b-v*y,D=u*b-v*p,S=1/(w*D-j*A+g*I+O*M-P*x+m*k);return e[0]=(h*D-a*A+c*I)*S,e[1]=(-r*D+n*A-s*I)*S,e[2]=(y*m-p*P+b*O)*S,e[3]=(-d*m+u*P-v*O)*S,e[4]=(-o*D+a*M-c*x)*S,e[5]=(i*D-n*M+s*x)*S,e[6]=(-f*m+p*g-b*j)*S,e[7]=(l*m-u*g+v*j)*S,e[8]=(o*A-h*M+c*k)*S,e[9]=(-i*A+r*M-s*k)*S,e[10]=(f*P-y*g+b*w)*S,e[11]=(-l*P+d*g-v*w)*S,e[12]=(-o*I+h*x-a*k)*S,e[13]=(i*I-r*x+n*k)*S,e[14]=(-f*O+y*j-p*w)*S,e[15]=(l*O-d*j+u*w)*S,e}function $(t,e){var i=t[4],r=t[14],n=t[8],s=t[13],o=t[12],h=t[9];if(!e||t===e){var a=t[1],c=t[2],l=t[3],d=t[6],u=t[7],v=t[11];return t[1]=i,t[2]=n,t[3]=o,t[4]=a,t[6]=h,t[7]=s,t[8]=c,t[9]=d,t[11]=r,t[12]=l,t[13]=u,t[14]=v,t}return e[0]=t[0],e[1]=i,e[2]=n,e[3]=o,e[4]=t[1],e[5]=t[5],e[6]=h,e[7]=s,e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=r,e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15],e}function J(t,e,i){i||(i=t);var r=e[0],n=e[1],s=e[2],o=e[3];return i[0]=t[0]*r+t[4]*n+t[8]*s+t[12]*o,i[1]=t[1]*r+t[5]*n+t[9]*s+t[13]*o,i[2]=t[2]*r+t[6]*n+t[10]*s+t[14]*o,i[3]=t[3]*r+t[7]*n+t[11]*s+t[15]*o,i}function K(t,e,i){i||(i=t);var r=t[0],n=t[1],s=t[2],o=t[3],h=t[4],a=t[5],c=t[6],l=t[7],d=t[8],u=t[9],v=t[10],f=t[11],y=t[12],p=t[13],b=t[14],w=t[15],j=e[0],g=e[1],O=e[2],P=e[3],m=e[4],k=e[5],x=e[6],M=e[7],I=e[8],A=e[9],D=e[10],S=e[11],V=e[12],C=e[13],L=e[14],U=e[15];return i[0]=j*r+g*h+O*d+P*y,i[1]=j*n+g*a+O*u+P*p,i[2]=j*s+g*c+O*v+P*b,i[3]=j*o+g*l+O*f+P*w,i[4]=m*r+k*h+x*d+M*y,i[5]=m*n+k*a+x*u+M*p,i[6]=m*s+k*c+x*v+M*b,i[7]=m*o+k*l+x*f+M*w,i[8]=I*r+A*h+D*d+S*y,i[9]=I*n+A*a+D*u+S*p,i[10]=I*s+A*c+D*v+S*b,i[11]=I*o+A*l+D*f+S*w,i[12]=V*r+C*h+L*d+U*y,i[13]=V*n+C*a+L*u+U*p,i[14]=V*s+C*c+L*v+U*b,i[15]=V*o+C*l+L*f+U*w,i}function Z(t,e,i){i||(i=e);var r=e[0],n=e[1],s=e[2];return i[0]=t[0]*r+t[4]*n+t[8]*s+t[12],i[1]=t[1]*r+t[5]*n+t[9]*s+t[13],i[2]=t[2]*r+t[6]*n+t[10]*s+t[14],i}s(3),U(),q(),s(3);var tt,et=/*#__PURE__*/p(\"rendererViewObject\"),it=/*#__PURE__*/p(\"state\"),rt=/*#__PURE__*/function(){function t(t,e,i){this.id=void 0,this.layer=void 0,this.sceneObject=void 0,Object.defineProperty(this,et,{writable:!0,value:void 0}),Object.defineProperty(this,it,{writable:!0,value:void 0}),this.id=e.id,this.layer=t,this.sceneObject=e,b(this,et)[et]=i,b(this,it)[it]={visible:!0,culled:!1,pickable:!0,clippable:!0,collidable:!0,xrayed:!1,selected:!1,highlighted:!1,edges:!1,colorize:new Float32Array(4),colorized:!1,opacityUpdated:!1},b(this,et)[et].setVisible(this.layer.view.viewIndex,b(this,it)[it].visible),this.layer.objectVisibilityUpdated(this,b(this,it)[it].visible,!0)}return t.prototype._destroy=function(){b(this,it)[it].visible&&this.layer.objectVisibilityUpdated(this,!1,!1),b(this,it)[it].xrayed&&this.layer.objectXRayedUpdated(this,!1),b(this,it)[it].selected&&this.layer.objectSelectedUpdated(this,!1),b(this,it)[it].highlighted&&this.layer.objectHighlightedUpdated(this,!1),b(this,it)[it].colorized&&this.layer.objectColorizeUpdated(this,!1),b(this,it)[it].opacityUpdated&&this.layer.objectOpacityUpdated(this,!1),this.layer.redraw()},d(t,[{key:\"aabb\",get:function(){return this.sceneObject.aabb}},{key:\"visible\",get:function(){return b(this,it)[it].visible},set:function(t){t!==b(this,it)[it].visible&&(b(this,it)[it].visible=t,b(this,et)[et].setVisible(this.layer.view.viewIndex,t),this.layer.objectVisibilityUpdated(this,t,!0),this.layer.redraw())}},{key:\"xrayed\",get:function(){return b(this,it)[it].xrayed},set:function(t){b(this,it)[it].xrayed!==t&&(b(this,it)[it].xrayed=t,b(this,et)[et].setXRayed(this.layer.view.viewIndex,t),this.layer.objectXRayedUpdated(this,t),this.layer.redraw())}},{key:\"edges\",get:function(){return b(this,it)[it].edges},set:function(t){b(this,it)[it].edges!==t&&(b(this,it)[it].edges=t,b(this,et)[et].setEdges(this.layer.view.viewIndex,t),this.layer.redraw())}},{key:\"highlighted\",get:function(){return b(this,it)[it].highlighted},set:function(t){t!==b(this,it)[it].highlighted&&(b(this,it)[it].highlighted=t,b(this,et)[et].setHighlighted(this.layer.view.viewIndex,t),this.layer.objectHighlightedUpdated(this,t),this.layer.redraw())}},{key:\"selected\",get:function(){return b(this,it)[it].selected},set:function(t){t!==b(this,it)[it].selected&&(b(this,it)[it].selected=t,b(this,et)[et].setSelected(this.layer.view.viewIndex,t),this.layer.objectSelectedUpdated(this,t),this.layer.redraw())}},{key:\"culled\",get:function(){return b(this,it)[it].culled},set:function(t){t!==b(this,it)[it].culled&&(b(this,it)[it].culled=t,this.layer.redraw())}},{key:\"clippable\",get:function(){return b(this,it)[it].clippable},set:function(t){t!==b(this,it)[it].clippable&&(b(this,it)[it].clippable=t,this.layer.redraw())}},{key:\"collidable\",get:function(){return b(this,it)[it].collidable},set:function(t){t!==b(this,it)[it].collidable&&(b(this,it)[it].collidable=t)}},{key:\"pickable\",get:function(){return b(this,it)[it].pickable},set:function(t){b(this,it)[it].pickable!==t&&(b(this,it)[it].pickable=t)}},{key:\"colorize\",get:function(){return b(this,it)[it].colorize},set:function(t){var e=b(this,it)[it].colorize;t?(e[0]=t[0],e[1]=t[1],e[2]=t[2]):(e[0]=1,e[1]=1,e[2]=1),b(this,it)[it].colorized=!!t,this.layer.objectColorizeUpdated(this,b(this,it)[it].colorized),this.layer.redraw()}},{key:\"opacity\",get:function(){return b(this,it)[it].colorize[3]},set:function(t){var e=b(this,it)[it].colorize;b(this,it)[it].opacityUpdated=null!=t,e[3]=b(this,it)[it].opacityUpdated?t:1,this.layer.objectOpacityUpdated(this,b(this,it)[it].opacityUpdated),this.layer.redraw()}}]),t}(),nt=/*#__PURE__*/p(\"state\"),st=/*#__PURE__*/function(t){function i(i,n){var s;return void 0===n&&(n={}),(s=t.call(this,i,n)||this).view=void 0,s.onPos=void 0,s.onDir=void 0,s.onActive=void 0,Object.defineProperty(f(s),nt,{writable:!0,value:void 0}),s.view=i,b(f(s),nt)[nt]={active:!1!==n.active,pos:new Float64Array(n.pos||[0,0,0]),dir:new Float32Array(n.pos||[0,0,-1]),dist:0},s.onPos=new e(new r),s.onDir=new e(new r),s.onActive=new e(new r),s}u(i,t);var n=i.prototype;return n.flipDir=function(){var t=b(this,nt)[nt].dir;t[0]*=-1,t[1]*=-1,t[2]*=-1,b(this,nt)[nt].dist=-L(b(this,nt)[nt].pos,b(this,nt)[nt].dir),this.onDir.dispatch(this,b(this,nt)[nt].dir),this.view.redraw()},n.destroy=function(){this.onPos.clear(),this.onDir.clear(),t.prototype.destroy.call(this)},d(i,[{key:\"active\",get:function(){return b(this,nt)[nt].active},set:function(t){b(this,nt)[nt].active!==t&&(b(this,nt)[nt].active=t,this.view.redraw(),this.onActive.dispatch(this,b(this,nt)[nt].active))}},{key:\"pos\",get:function(){return b(this,nt)[nt].pos},set:function(t){b(this,nt)[nt].pos.set(t),b(this,nt)[nt].dist=-L(b(this,nt)[nt].pos,b(this,nt)[nt].dir),this.onPos.dispatch(this,b(this,nt)[nt].pos)}},{key:\"dir\",get:function(){return b(this,nt)[nt].dir},set:function(t){b(this,nt)[nt].dir.set(t),b(this,nt)[nt].dist=-L(b(this,nt)[nt].pos,b(this,nt)[nt].dir),this.view.redraw(),this.onDir.dispatch(this,b(this,nt)[nt].dir)}},{key:\"dist\",get:function(){return b(this,nt)[nt].dist}}]),i}(t),ot=((tt={})[A]={abbrev:\"m\"},tt[400001]={abbrev:\"cm\"},tt[400002]={abbrev:\"mm\"},tt[400003]={abbrev:\"yd\"},tt[400004]={abbrev:\"ft\"},tt[400005]={abbrev:\"in\"},tt),ht=/*#__PURE__*/p(\"units\"),at=/*#__PURE__*/p(\"scale\"),ct=/*#__PURE__*/p(\"origin\"),lt=/*#__PURE__*/function(t){function i(i,n){var s;return void 0===n&&(n={units:A,scale:1,origin:[1,1,1]}),s=t.call(this,i,n)||this,Object.defineProperty(f(s),ht,{writable:!0,value:void 0}),Object.defineProperty(f(s),at,{writable:!0,value:void 0}),Object.defineProperty(f(s),ct,{writable:!0,value:void 0}),s.onUnits=void 0,s.onScale=void 0,s.onOrigin=void 0,s.onUnits=new e(new r),s.onScale=new e(new r),s.onOrigin=new e(new r),b(f(s),ht)[ht]=A,b(f(s),at)[at]=1,b(f(s),ct)[ct]=U([0,0,0]),s.units=n.units,s.scale=n.scale,s.origin=n.origin,s}u(i,t);var n=i.prototype;return n.worldToRealPos=function(t,e){return void 0===e&&(e=U()),e[0]=b(this,ct)[ct][0]+b(this,at)[at]*t[0],e[1]=b(this,ct)[ct][1]+b(this,at)[at]*t[1],e[2]=b(this,ct)[ct][2]+b(this,at)[at]*t[2],e},n.realToWorldPos=function(t,e){return void 0===e&&(e=U()),e[0]=(t[0]-b(this,ct)[ct][0])/b(this,at)[at],e[1]=(t[1]-b(this,ct)[ct][1])/b(this,at)[at],e[2]=(t[2]-b(this,ct)[ct][2])/b(this,at)[at],e},n.destroy=function(){t.prototype.destroy.call(this),this.onUnits.clear(),this.onScale.clear(),this.onOrigin.clear()},d(i,[{key:\"unitsInfo\",get:function(){return ot}},{key:\"units\",get:function(){return b(this,ht)[ht]},set:function(t){t||(t=A),ot[t]||(this.error(\"Unsupported value for 'units': \"+t+\" defaulting to MetersUnit\"),t=A),b(this,ht)[ht]=t,this.onUnits.dispatch(this,b(this,ht)[ht])}},{key:\"scale\",get:function(){return b(this,at)[at]},set:function(t){(t=t||1)<=0?this.error(\"scale value should be larger than zero\"):(b(this,at)[at]=t,this.onScale.dispatch(this,b(this,at)[at]))}},{key:\"origin\",get:function(){return b(this,ct)[ct]},set:function(t){if(!t)return b(this,ct)[ct][0]=0,b(this,ct)[ct][1]=0,void(b(this,ct)[ct][2]=0);b(this,ct)[ct][0]=t[0],b(this,ct)[ct][1]=t[1],b(this,ct)[ct][2]=t[2],this.onOrigin.dispatch(this,b(this,ct)[ct])}}]),i}(t),dt=/*#__PURE__*/p(\"state\"),ut=/*#__PURE__*/function(t){function e(e,i){var r;return(r=t.call(this,e,i)||this).view=void 0,Object.defineProperty(f(r),dt,{writable:!0,value:void 0}),r.view=e,b(f(r),dt)[dt]={renderModes:[I],enabled:!1!==i.enabled,kernelRadius:i.kernelRadius||100,intensity:void 0!==i.intensity?i.intensity:.15,bias:void 0!==i.bias?i.bias:.5,scale:void 0!==i.scale?i.scale:1,minResolution:void 0!==i.minResolution?i.minResolution:0,numSamples:void 0!==i.numSamples?i.numSamples:10,blur:!!i.blur,blendCutoff:void 0!==i.blendCutff?i.blendCutoff:.3,blendFactor:void 0!==i.blendFactor?i.blendFactor:1},r}return u(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this)},d(e,[{key:\"renderModes\",get:function(){return b(this,dt)[dt].renderModes},set:function(t){b(this,dt)[dt].renderModes=t,this.view.redraw()}},{key:\"supported\",get:function(){return this.view.viewer.renderer.getSAOSupported()}},{key:\"enabled\",get:function(){return b(this,dt)[dt].enabled},set:function(t){t=!!t,b(this,dt)[dt].enabled!==t&&(b(this,dt)[dt].enabled=t,this.view.redraw())}},{key:\"possible\",get:function(){if(!this.supported)return!1;if(!b(this,dt)[dt].enabled)return!1;var t=this.view.camera.projectionType;return t!==C&&t!==V}},{key:\"kernelRadius\",get:function(){return b(this,dt)[dt].kernelRadius},set:function(t){null==t&&(t=100),b(this,dt)[dt].kernelRadius!==t&&(b(this,dt)[dt].kernelRadius=t,this.view.redraw())}},{key:\"intensity\",get:function(){return b(this,dt)[dt].intensity},set:function(t){null==t&&(t=.15),b(this,dt)[dt].intensity!==t&&(b(this,dt)[dt].intensity=t,this.view.redraw())}},{key:\"bias\",get:function(){return b(this,dt)[dt].bias},set:function(t){null==t&&(t=.5),b(this,dt)[dt].bias!==t&&(b(this,dt)[dt].bias=t,this.view.redraw())}},{key:\"scale\",get:function(){return b(this,dt)[dt].scale},set:function(t){null==t&&(t=1),b(this,dt)[dt].scale!==t&&(b(this,dt)[dt].scale=t,this.view.redraw())}},{key:\"minResolution\",get:function(){return b(this,dt)[dt].minResolution},set:function(t){null==t&&(t=0),b(this,dt)[dt].minResolution!==t&&(b(this,dt)[dt].minResolution=t,this.view.redraw())}},{key:\"numSamples\",get:function(){return b(this,dt)[dt].numSamples},set:function(t){null==t&&(t=10),b(this,dt)[dt].numSamples!==t&&(b(this,dt)[dt].numSamples=t,this.view.redraw())}},{key:\"blur\",get:function(){return b(this,dt)[dt].blur},set:function(t){t=!1!==t,b(this,dt)[dt].blur!==t&&(b(this,dt)[dt].blur=t,this.view.redraw())}},{key:\"blendCutoff\",get:function(){return b(this,dt)[dt].blendCutoff},set:function(t){null==t&&(t=.3),b(this,dt)[dt].blendCutoff!==t&&(b(this,dt)[dt].blendCutoff=t,this.view.redraw())}},{key:\"blendFactor\",get:function(){return b(this,dt)[dt].blendFactor},set:function(t){null==t&&(t=1),b(this,dt)[dt].blendFactor!==t&&(b(this,dt)[dt].blendFactor=t,this.view.redraw())}}]),e}(t),vt=/*#__PURE__*/p(\"state\"),ft=/*#__PURE__*/function(t){function e(e,i){var r;return void 0===i&&(i={lineWidth:1}),(r=t.call(this,e,i)||this).view=void 0,Object.defineProperty(f(r),vt,{writable:!0,value:void 0}),r.view=e,b(f(r),vt)[vt]={lineWidth:null!=i.lineWidth?i.lineWidth:1},r}return u(e,t),d(e,[{key:\"lineWidth\",get:function(){return b(this,vt)[vt].lineWidth},set:function(t){b(this,vt)[vt].lineWidth=t||1,this.view.redraw()}}]),e}(t),yt=/*#__PURE__*/p(\"numObjects\"),pt=/*#__PURE__*/p(\"objectIds\"),bt=/*#__PURE__*/p(\"numVisibleObjects\"),wt=/*#__PURE__*/p(\"visibleObjectIds\"),jt=/*#__PURE__*/p(\"numXRayedObjects\"),gt=/*#__PURE__*/p(\"xrayedObjectIds\"),Ot=/*#__PURE__*/p(\"numHighlightedObjects\"),Pt=/*#__PURE__*/p(\"highlightedObjectIds\"),mt=/*#__PURE__*/p(\"numSelectedObjects\"),kt=/*#__PURE__*/p(\"selectedObjectIds\"),xt=/*#__PURE__*/p(\"numColorizedObjects\"),Mt=/*#__PURE__*/p(\"colorizedObjectIds\"),It=/*#__PURE__*/p(\"numOpacityObjects\"),At=/*#__PURE__*/p(\"opacityObjectIds\"),Dt=/*#__PURE__*/p(\"qualityRender\"),St=/*#__PURE__*/p(\"initObjects\"),Vt=/*#__PURE__*/p(\"createObjects\"),Ct=/*#__PURE__*/p(\"destroyObjects\"),Lt=/*#__PURE__*/function(t){function i(i){var n;return n=t.call(this,i.view,i)||this,Object.defineProperty(f(n),Ct,{value:zt}),Object.defineProperty(f(n),Vt,{value:Tt}),Object.defineProperty(f(n),St,{value:Ut}),n.objects=void 0,n.visibleObjects=void 0,n.xrayedObjects=void 0,n.highlightedObjects=void 0,n.selectedObjects=void 0,n.colorizedObjects=void 0,n.opacityObjects=void 0,n.autoDestroy=void 0,n.onObjectVisibility=void 0,Object.defineProperty(f(n),yt,{writable:!0,value:void 0}),Object.defineProperty(f(n),pt,{writable:!0,value:void 0}),Object.defineProperty(f(n),bt,{writable:!0,value:void 0}),Object.defineProperty(f(n),wt,{writable:!0,value:void 0}),Object.defineProperty(f(n),jt,{writable:!0,value:void 0}),Object.defineProperty(f(n),gt,{writable:!0,value:void 0}),Object.defineProperty(f(n),Ot,{writable:!0,value:void 0}),Object.defineProperty(f(n),Pt,{writable:!0,value:void 0}),Object.defineProperty(f(n),mt,{writable:!0,value:void 0}),Object.defineProperty(f(n),kt,{writable:!0,value:void 0}),Object.defineProperty(f(n),xt,{writable:!0,value:void 0}),Object.defineProperty(f(n),Mt,{writable:!0,value:void 0}),Object.defineProperty(f(n),It,{writable:!0,value:void 0}),Object.defineProperty(f(n),At,{writable:!0,value:void 0}),Object.defineProperty(f(n),Dt,{writable:!0,value:void 0}),n.gammaOutput=void 0,n.id=i.id,n.viewer=i.viewer,n.view=i.view,n.objects={},n.visibleObjects={},n.xrayedObjects={},n.highlightedObjects={},n.selectedObjects={},n.colorizedObjects={},n.opacityObjects={},n.autoDestroy=!1!==i.autoDestroy,b(f(n),yt)[yt]=0,b(f(n),bt)[bt]=0,b(f(n),jt)[jt]=0,b(f(n),Ot)[Ot]=0,b(f(n),mt)[mt]=0,b(f(n),xt)[xt]=0,b(f(n),It)[It]=0,b(f(n),Dt)[Dt]=!!i.qualityRender,n.onObjectVisibility=new e(new r),b(f(n),St)[St](),n}u(i,t);var n=i.prototype;return n.registerViewObject=function(t){this.objects[t.id]=t,b(this,yt)[yt]++,b(this,pt)[pt]=null},n.deregisterViewObject=function(t){delete this.objects[t.id],delete this.visibleObjects[t.id],delete this.xrayedObjects[t.id],delete this.highlightedObjects[t.id],delete this.selectedObjects[t.id],delete this.colorizedObjects[t.id],delete this.opacityObjects[t.id],b(this,yt)[yt]--,b(this,pt)[pt]=null},n.redraw=function(){this.viewer.renderer.setImageDirty(this.view.viewIndex)},n.objectVisibilityUpdated=function(t,e,i){void 0===i&&(i=!0),e?(this.visibleObjects[t.id]=t,b(this,bt)[bt]++):(delete this.visibleObjects[t.id],b(this,bt)[bt]--),b(this,wt)[wt]=null,i&&this.onObjectVisibility.dispatch(this,t),this.view.objectVisibilityUpdated(t,e,i)},n.objectXRayedUpdated=function(t,e){e?(this.xrayedObjects[t.id]=t,b(this,jt)[jt]++):(delete this.xrayedObjects[t.id],b(this,jt)[jt]--),b(this,gt)[gt]=null,this.view.objectXRayedUpdated(t,e)},n.objectHighlightedUpdated=function(t,e){e?(this.highlightedObjects[t.id]=t,b(this,Ot)[Ot]++):(delete this.highlightedObjects[t.id],b(this,Ot)[Ot]--),b(this,Pt)[Pt]=null,this.view.objectHighlightedUpdated(t,e)},n.objectSelectedUpdated=function(t,e){e?(this.selectedObjects[t.id]=t,b(this,mt)[mt]++):(delete this.selectedObjects[t.id],b(this,mt)[mt]--),b(this,kt)[kt]=null,this.view.objectSelectedUpdated(t,e)},n.objectColorizeUpdated=function(t,e){e?(this.colorizedObjects[t.id]=t,b(this,xt)[xt]++):(delete this.colorizedObjects[t.id],b(this,xt)[xt]--),b(this,Mt)[Mt]=null,this.view.objectColorizeUpdated(t,e)},n.objectOpacityUpdated=function(t,e){e?(this.opacityObjects[t.id]=t,b(this,It)[It]++):(delete this.opacityObjects[t.id],b(this,It)[It]--),b(this,At)[At]=null,this.view.objectOpacityUpdated(t,e)},n.setObjectsVisible=function(t,e){return this.withObjects(t,function(t){var i=t.visible!==e;return t.visible=e,i})},n.setObjectsCollidable=function(t,e){return this.withObjects(t,function(t){var i=t.collidable!==e;return t.collidable=e,i})},n.setObjectsCulled=function(t,e){return this.withObjects(t,function(t){var i=t.culled!==e;return t.culled=e,i})},n.setObjectsSelected=function(t,e){return this.withObjects(t,function(t){var i=t.selected!==e;return t.selected=e,i})},n.setObjectsHighlighted=function(t,e){return this.withObjects(t,function(t){var i=t.highlighted!==e;return t.highlighted=e,i})},n.setObjectsXRayed=function(t,e){return this.withObjects(t,function(t){var i=t.xrayed!==e;return i&&(t.xrayed=e),i})},n.setObjectsColorized=function(t,e){return this.withObjects(t,function(t){t.colorize=e})},n.setObjectsOpacity=function(t,e){return this.withObjects(t,function(t){var i=t.opacity!==e;return i&&(t.opacity=e),i})},n.setObjectsPickable=function(t,e){return this.withObjects(t,function(t){var i=t.pickable!==e;return i&&(t.pickable=e),i})},n.setObjectsClippable=function(t,e){return this.withObjects(t,function(t){var i=t.clippable!==e;return i&&(t.clippable=e),i})},n.withObjects=function(t,e){for(var i=!1,r=0,n=t.length;r<n;r++){var s=this.objects[t[r]];s&&(i=e(s)||i)}return i},n.destroy=function(){t.prototype.destroy.call(this)},d(i,[{key:\"gammaFactor\",get:function(){return 1}},{key:\"qualityRender\",get:function(){return b(this,Dt)[Dt]},set:function(t){b(this,Dt)[Dt]!==t&&(b(this,Dt)[Dt]=t,this.redraw())}},{key:\"numObjects\",get:function(){return b(this,yt)[yt]}},{key:\"objectIds\",get:function(){return b(this,pt)[pt]||(b(this,pt)[pt]=Object.keys(this.objects)),b(this,pt)[pt]}},{key:\"numVisibleObjects\",get:function(){return b(this,bt)[bt]}},{key:\"visibleObjectIds\",get:function(){return b(this,wt)[wt]||(b(this,wt)[wt]=Object.keys(this.visibleObjects)),b(this,wt)[wt]}},{key:\"numXRayedObjects\",get:function(){return b(this,jt)[jt]}},{key:\"xrayedObjectIds\",get:function(){return b(this,gt)[gt]||(b(this,gt)[gt]=Object.keys(this.xrayedObjects)),b(this,gt)[gt]}},{key:\"numHighlightedObjects\",get:function(){return b(this,Ot)[Ot]}},{key:\"highlightedObjectIds\",get:function(){return b(this,Pt)[Pt]||(b(this,Pt)[Pt]=Object.keys(this.highlightedObjects)),b(this,Pt)[Pt]}},{key:\"numSelectedObjects\",get:function(){return b(this,mt)[mt]}},{key:\"selectedObjectIds\",get:function(){return b(this,kt)[kt]||(b(this,kt)[kt]=Object.keys(this.selectedObjects)),b(this,kt)[kt]}},{key:\"numColorizedObjects\",get:function(){return b(this,xt)[xt]}},{key:\"colorizedObjectIds\",get:function(){return b(this,Mt)[Mt]||(b(this,Mt)[Mt]=Object.keys(this.colorizedObjects)),b(this,Mt)[Mt]}},{key:\"opacityObjectIds\",get:function(){return b(this,At)[At]||(b(this,At)[At]=Object.keys(this.opacityObjects)),b(this,At)[At]}},{key:\"numOpacityObjects\",get:function(){return b(this,It)[It]}}]),i}(t);function Ut(){var t=this,e=this.viewer.scene.models;for(var i in e){var r=e[i];b(this,Vt)[Vt](r)}this.viewer.scene.onModelCreated.subscribe(function(e,i){b(t,Vt)[Vt](i)}),this.viewer.scene.onModelDestroyed.subscribe(function(e,i){b(t,Ct)[Ct](i)})}function Tt(t){var e=t.objects;for(var i in e){var r=this.viewer.renderer.rendererViewObjects[i];if(r.layerId==this.id){var n=new rt(this,e[i],r);this.objects[n.id]=n,b(this,yt)[yt]++,b(this,pt)[pt]=null}}}function zt(t){var e=t.objects;for(var i in e)this.objects[e[i].id]._destroy(),b(this,yt)[yt]--,b(this,pt)[pt]=null}var Ft=/*#__PURE__*/p(\"state\"),_t=/*#__PURE__*/function(t){function e(e,i){var r;return void 0===i&&(i={}),(r=t.call(this,e,i)||this).view=void 0,Object.defineProperty(f(r),Ft,{writable:!0,value:void 0}),r.view=e,b(f(r),Ft)[Ft]={fill:!!i.fill,fillColor:new Float32Array(i.fillColor||[.4,.4,.4]),fillAlpha:null!=i.fillAlpha?i.fillAlpha:.2,edges:!1!==i.edges,edgeColor:new Float32Array(i.edgeColor||[.2,.2,.2]),edgeAlpha:null!=i.edgeAlpha?i.edgeAlpha:.5,edgeWidth:null!=i.edgeWidth?i.edgeWidth:1,backfaces:!!i.backfaces},r}return u(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this)},d(e,[{key:\"fill\",get:function(){return b(this,Ft)[Ft].fill},set:function(t){b(this,Ft)[Ft].fill!==t&&(b(this,Ft)[Ft].fill=t,this.view.redraw())}},{key:\"fillColor\",get:function(){return b(this,Ft)[Ft].fillColor},set:function(t){var e=b(this,Ft)[Ft].fillColor;e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]||(e[0]=.4,e[1]=.4,e[2]=.4,this.view.redraw())}},{key:\"fillAlpha\",get:function(){return b(this,Ft)[Ft].fillAlpha},set:function(t){b(this,Ft)[Ft].fillAlpha!==t&&(b(this,Ft)[Ft].fillAlpha=t,this.view.redraw())}},{key:\"edges\",get:function(){return b(this,Ft)[Ft].edges},set:function(t){b(this,Ft)[Ft].edges!==t&&(b(this,Ft)[Ft].edges=t,this.view.redraw())}},{key:\"edgeColor\",get:function(){return b(this,Ft)[Ft].edgeColor},set:function(t){var e=b(this,Ft)[Ft].edgeColor;e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]||(e[0]=.2,e[1]=.2,e[2]=.2,this.view.redraw())}},{key:\"edgeAlpha\",get:function(){return b(this,Ft)[Ft].edgeAlpha},set:function(t){b(this,Ft)[Ft].edgeAlpha!==t&&(b(this,Ft)[Ft].edgeAlpha=t,this.view.redraw())}},{key:\"edgeWidth\",get:function(){return b(this,Ft)[Ft].edgeWidth},set:function(t){b(this,Ft)[Ft].edgeWidth=t,this.view.redraw()}},{key:\"backfaces\",get:function(){return b(this,Ft)[Ft].backfaces},set:function(t){b(this,Ft)[Ft].backfaces!==t&&(b(this,Ft)[Ft].backfaces=t,this.view.redraw())}},{key:\"hash\",get:function(){return\"\"}}]),e}(t),Rt=/*#__PURE__*/p(\"state\"),Wt=/*#__PURE__*/function(t){function e(e,i){var r;return void 0===i&&(i={}),(r=t.call(this,e,i)||this).view=void 0,Object.defineProperty(f(r),Rt,{writable:!0,value:void 0}),r.view=e,b(f(r),Rt)[Rt]={renderModes:i.renderModes||[I],edges:!1!==i.edges,edgeColor:new Float32Array(i.edgeColor||[.2,.2,.2]),edgeAlpha:null!=i.edgeAlpha?i.edgeAlpha:.5,edgeWidth:null!=i.edgeWidth?i.edgeWidth:1},r}return u(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this)},d(e,[{key:\"renderModes\",get:function(){return b(this,Rt)[Rt].renderModes},set:function(t){b(this,Rt)[Rt].renderModes=t,this.view.redraw()}},{key:\"edges\",get:function(){return b(this,Rt)[Rt].edges},set:function(t){b(this,Rt)[Rt].edges!==t&&(b(this,Rt)[Rt].edges=t,this.view.redraw())}},{key:\"edgeColor\",get:function(){return b(this,Rt)[Rt].edgeColor},set:function(t){var e=b(this,Rt)[Rt].edgeColor;t&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]||(e[0]=.2,e[1]=.2,e[2]=.2,this.view.redraw())}},{key:\"edgeAlpha\",get:function(){return b(this,Rt)[Rt].edgeAlpha},set:function(t){b(this,Rt)[Rt].edgeAlpha!==t&&(b(this,Rt)[Rt].edgeAlpha=t,this.view.redraw())}},{key:\"edgeWidth\",get:function(){return b(this,Rt)[Rt].edgeWidth},set:function(t){b(this,Rt)[Rt].edgeWidth!==t&&(b(this,Rt)[Rt].edgeWidth=t,this.view.redraw())}}]),e}(t),Et=/*#__PURE__*/p(\"state\"),Ht=/*#__PURE__*/function(t){function e(e,i){var r;return void 0===i&&(i={}),(r=t.call(this,e,i)||this).view=void 0,Object.defineProperty(f(r),Et,{writable:!0,value:void 0}),r.view=e,b(f(r),Et)[Et]={pointSize:null!=i.pointSize?i.pointSize:1,roundPoints:!1!==i.roundPoints,perspectivePoints:!1!==i.perspectivePoints,minPerspectivePointSize:null!=i.minPerspectivePointSize?i.minPerspectivePointSize:1,maxPerspectivePointSize:null!=i.maxPerspectivePointSize?i.maxPerspectivePointSize:6,filterIntensity:!!i.filterIntensity,minIntensity:null!=i.minIntensity?i.minIntensity:0,maxIntensity:null!=i.maxIntensity?i.maxIntensity:1},r}return u(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this)},d(e,[{key:\"pointSize\",get:function(){return b(this,Et)[Et].pointSize},set:function(t){b(this,Et)[Et].pointSize=t,this.view.redraw()}},{key:\"roundPoints\",get:function(){return b(this,Et)[Et].roundPoints},set:function(t){b(this,Et)[Et].roundPoints!==t&&(b(this,Et)[Et].roundPoints=t,this.view.rebuild())}},{key:\"perspectivePoints\",get:function(){return b(this,Et)[Et].perspectivePoints},set:function(t){b(this,Et)[Et].perspectivePoints!==t&&(b(this,Et)[Et].perspectivePoints=t,this.view.rebuild())}},{key:\"minPerspectivePointSize\",get:function(){return b(this,Et)[Et].minPerspectivePointSize},set:function(t){b(this,Et)[Et].minPerspectivePointSize!==t&&(b(this,Et)[Et].minPerspectivePointSize=t,this.view.rebuild())}},{key:\"maxPerspectivePointSize\",get:function(){return b(this,Et)[Et].maxPerspectivePointSize},set:function(t){b(this,Et)[Et].maxPerspectivePointSize!==t&&(b(this,Et)[Et].maxPerspectivePointSize=t,this.view.rebuild())}},{key:\"filterIntensity\",get:function(){return b(this,Et)[Et].filterIntensity},set:function(t){b(this,Et)[Et].filterIntensity!==t&&(b(this,Et)[Et].filterIntensity=t,this.view.rebuild())}},{key:\"minIntensity\",get:function(){return b(this,Et)[Et].minIntensity},set:function(t){b(this,Et)[Et].minIntensity!==t&&(b(this,Et)[Et].minIntensity=t,this.view.redraw())}},{key:\"maxIntensity\",get:function(){return b(this,Et)[Et].maxIntensity},set:function(t){b(this,Et)[Et].maxIntensity!==t&&(b(this,Et)[Et].maxIntensity=t,this.view.redraw())}},{key:\"hash\",get:function(){var t=b(this,Et)[Et];return t.pointSize+\";\\n        \"+t.roundPoints+\";\\n        \"+t.perspectivePoints+\";\\n        \"+t.minPerspectivePointSize+\";\\n        \"+t.maxPerspectivePointSize+\";\\n        \"+t.filterIntensity}}]),e}(t),qt=/*#__PURE__*/p(\"state\"),Xt=/*#__PURE__*/p(\"inverseMatrixDirty\"),Bt=/*#__PURE__*/p(\"transposedProjMatrixDirty\"),Nt=/*#__PURE__*/p(\"onViewBoundary\"),Gt=/*#__PURE__*/function(t){function i(i,n){var s;return void 0===n&&(n={}),(s=t.call(this,i,n)||this).camera=void 0,s.onProjMatrix=void 0,Object.defineProperty(f(s),qt,{writable:!0,value:void 0}),Object.defineProperty(f(s),Xt,{writable:!0,value:void 0}),Object.defineProperty(f(s),Bt,{writable:!0,value:void 0}),Object.defineProperty(f(s),Nt,{writable:!0,value:void 0}),s.camera=i,b(f(s),qt)[qt]={near:n.near||.1,far:n.far||2e3,fov:n.fov||60,fovAxis:n.fovAxis||\"min\",projMatrix:q(),inverseProjMatrix:q(),transposedProjMatrix:q()},b(f(s),Xt)[Xt]=!0,b(f(s),Bt)[Bt]=!0,b(f(s),Nt)[Nt]=s.camera.view.onBoundary.subscribe(function(){s.setDirty()}),s.onProjMatrix=new e(new r),s}u(i,t);var n=i.prototype;return n.clean=function(){var t=this.camera.view.boundary,e=t[2]/t[3],i=b(this,qt)[qt].fovAxis,r=b(this,qt)[qt].fov;(\"x\"===i||\"min\"===i&&e<1||\"max\"===i&&e>1)&&(r/=e),function(t,e,i,r,n){var s=[],o=[];s[2]=i,o[2]=r,o[1]=s[2]*Math.tan(t/2),s[1]=-o[1],o[0]=o[1]*e,s[0]=-o[0],function(t,e,i){i||(i=q());var r=[t[0],t[1],t[2],0],n=[e[0],e[1],e[2],0];(function(t,e,i){i||(i=t),i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i[3]=t[3]+e[3]})(n,r,X),function(t,e,i){i||(i=t),i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i[3]=t[3]-e[3]}(n,r,B);var s=2*r[2],o=B[0],h=B[1],a=B[2];i[0]=s/o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=s/h,i[6]=0,i[7]=0,i[8]=X[0]/o,i[9]=X[1]/h,i[10]=-X[2]/a,i[11]=-1,i[12]=0,i[13]=0,i[14]=-s*n[2]/a,i[15]=0}(s,o,n)}((r=Math.min(r,120))*(Math.PI/180),e,b(this,qt)[qt].near,b(this,qt)[qt].far,b(this,qt)[qt].projMatrix),b(this,Xt)[Xt]=!0,b(this,Bt)[Bt]=!0,this.camera.view.redraw(),this.onProjMatrix.dispatch(this,b(this,qt)[qt].projMatrix)},n.unproject=function(t,e,i,r,n){var s=this.camera.view.canvasElement,o=s.offsetWidth/2,h=s.offsetHeight/2;return i[0]=(t[0]-o)/o,i[1]=(t[1]-h)/h,i[2]=e,i[3]=1,J(this.inverseProjMatrix,i,r),z(r,1/r[3]),r[3]=1,r[1]*=-1,J(this.camera.inverseViewMatrix,r,n),n},n.destroy=function(){t.prototype.destroy.call(this),this.camera.view.onBoundary.unsubscribe(b(this,Nt)[Nt]),this.onProjMatrix.clear()},d(i,[{key:\"fov\",get:function(){return b(this,qt)[qt].fov},set:function(t){t!==b(this,qt)[qt].fov&&(b(this,qt)[qt].fov=t,this.setDirty())}},{key:\"fovAxis\",get:function(){return b(this,qt)[qt].fovAxis},set:function(t){t=t||\"min\",b(this,qt)[qt].fovAxis!==t&&(\"x\"!==t&&\"y\"!==t&&\"min\"!==t&&(this.error(\"Unsupported value for 'fovAxis': \"+t+\" - defaulting to 'min'\"),t=\"min\"),b(this,qt)[qt].fovAxis=t,this.setDirty())}},{key:\"near\",get:function(){return b(this,qt)[qt].near},set:function(t){b(this,qt)[qt].near!==t&&(b(this,qt)[qt].near=t,this.setDirty())}},{key:\"far\",get:function(){return b(this,qt)[qt].far},set:function(t){b(this,qt)[qt].far!==t&&(b(this,qt)[qt].far=t,this.setDirty())}},{key:\"projMatrix\",get:function(){return this.dirty&&this.cleanIfDirty(),b(this,qt)[qt].projMatrix}},{key:\"inverseProjMatrix\",get:function(){return this.dirty&&this.cleanIfDirty(),b(this,Xt)[Xt]&&(Y(b(this,qt)[qt].projMatrix,b(this,qt)[qt].inverseProjMatrix),b(this,Xt)[Xt]=!1),b(this,qt)[qt].inverseProjMatrix}},{key:\"transposedProjMatrix\",get:function(){return this.dirty&&this.cleanIfDirty(),b(this,Bt)[Bt]&&($(b(this,qt)[qt].projMatrix,b(this,qt)[qt].transposedProjMatrix),b(this,Bt)[Bt]=!1),b(this,qt)[qt].transposedProjMatrix}}]),i}(t);Gt.type=D;var Qt=/*#__PURE__*/p(\"state\"),Yt=/*#__PURE__*/p(\"inverseMatrixDirty\"),$t=/*#__PURE__*/p(\"transposedProjMatrixDirty\"),Jt=/*#__PURE__*/p(\"onViewBoundary\"),Kt=/*#__PURE__*/function(t){function i(i,n){var s;return void 0===n&&(n={}),(s=t.call(this,i,n)||this).camera=void 0,s.onProjMatrix=void 0,Object.defineProperty(f(s),Qt,{writable:!0,value:void 0}),Object.defineProperty(f(s),Yt,{writable:!0,value:void 0}),Object.defineProperty(f(s),$t,{writable:!0,value:void 0}),Object.defineProperty(f(s),Jt,{writable:!0,value:void 0}),s.camera=i,b(f(s),Qt)[Qt]={near:n.near||.1,far:n.far||2e3,scale:n.scale||1,projMatrix:q(),inverseProjMatrix:q(),transposedProjMatrix:q()},s.onProjMatrix=new e(new r),b(f(s),Yt)[Yt]=!0,b(f(s),$t)[$t]=!0,b(f(s),Jt)[Jt]=s.camera.view.onBoundary.subscribe(function(){s.setDirty()}),s}u(i,t);var n=i.prototype;return n.clean=function(){var t,e,i,r,n=this.camera.view,s=.5*b(this,Qt)[Qt].scale,o=n.boundary,h=o[2],a=o[3],c=h/a;h>a?(t=-s,e=s,i=s/c,r=-s/c):(t=-s*c,e=s*c,i=s,r=-s),function(t,e,i,r,n,s,o){o||(o=q());var h=e-t,a=r-i,c=s-n;o[0]=2/h,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2/a,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=-2/c,o[11]=0,o[12]=-(t+e)/h,o[13]=-(r+i)/a,o[14]=-(s+n)/c,o[15]=1}(t,e,r,i,b(this,Qt)[Qt].near,b(this,Qt)[Qt].far,b(this,Qt)[Qt].projMatrix),b(this,Yt)[Yt]=!0,b(this,$t)[$t]=!0,this.camera.view.redraw(),this.onProjMatrix.dispatch(this,b(this,Qt)[Qt].projMatrix)},n.unproject=function(t,e,i,r,n){var s=this.camera.view.canvasElement,o=s.offsetWidth/2,h=s.offsetHeight/2;return i[0]=(t[0]-o)/o,i[1]=(t[1]-h)/h,i[2]=e,i[3]=1,J(this.inverseProjMatrix,i,r),z(r,1/r[3]),r[3]=1,r[1]*=-1,J(this.camera.inverseViewMatrix,r,n),n},n.destroy=function(){t.prototype.destroy.call(this),this.camera.view.onBoundary.unsubscribe(b(this,Jt)[Jt]),this.onProjMatrix.clear()},d(i,[{key:\"scale\",get:function(){return b(this,Qt)[Qt].scale},set:function(t){t<=0&&(t=.01),b(this,Qt)[Qt].scale=t,this.setDirty()}},{key:\"near\",get:function(){return b(this,Qt)[Qt].near},set:function(t){b(this,Qt)[Qt].near!==t&&(b(this,Qt)[Qt].near=t,this.setDirty())}},{key:\"far\",get:function(){return b(this,Qt)[Qt].far},set:function(t){b(this,Qt)[Qt].far!==t&&(b(this,Qt)[Qt].far=t,this.setDirty())}},{key:\"projMatrix\",get:function(){return this.dirty&&this.cleanIfDirty(),b(this,Qt)[Qt].projMatrix}},{key:\"inverseProjMatrix\",get:function(){return this.dirty&&this.cleanIfDirty(),b(this,Yt)[Yt]&&(Y(b(this,Qt)[Qt].projMatrix,b(this,Qt)[Qt].inverseProjMatrix),b(this,Yt)[Yt]=!1),b(this,Qt)[Qt].inverseProjMatrix}},{key:\"transposedProjMatrix\",get:function(){return this.dirty&&this.cleanIfDirty(),b(this,$t)[$t]&&($(b(this,Qt)[Qt].projMatrix,b(this,Qt)[Qt].transposedProjMatrix),b(this,$t)[$t]=!1),b(this,Qt)[Qt].transposedProjMatrix}}]),i}(t);Kt.type=S;var Zt=/*#__PURE__*/p(\"state\"),te=/*#__PURE__*/p(\"inverseProjMatrixDirty\"),ee=/*#__PURE__*/p(\"transposedProjMatrixDirty\"),ie=/*#__PURE__*/function(t){function i(i,n){var s;return void 0===n&&(n={}),(s=t.call(this,i,n)||this).camera=void 0,s.onProjMatrix=void 0,Object.defineProperty(f(s),Zt,{writable:!0,value:void 0}),Object.defineProperty(f(s),te,{writable:!0,value:void 0}),Object.defineProperty(f(s),ee,{writable:!0,value:void 0}),s.camera=i,b(f(s),Zt)[Zt]={projMatrix:q(n.projMatrix||N()),inverseProjMatrix:q(),transposedProjMatrix:q()},s.onProjMatrix=new e(new r),b(f(s),te)[te]=!0,b(f(s),ee)[ee]=!1,s}u(i,t);var n=i.prototype;return n.unproject=function(t,e,i,r,n){var s=this.camera.view.canvasElement,o=s.offsetWidth/2,h=s.offsetHeight/2;return i[0]=(t[0]-o)/o,i[1]=(t[1]-h)/h,i[2]=e,i[3]=1,J(this.inverseProjMatrix,i,r),z(r,1/r[3]),r[3]=1,r[1]*=-1,J(this.camera.inverseViewMatrix,r,n),n},n.destroy=function(){t.prototype.destroy.call(this),this.onProjMatrix.clear()},d(i,[{key:\"projMatrix\",get:function(){return b(this,Zt)[Zt].projMatrix},set:function(t){b(this,Zt)[Zt].projMatrix.set(t),b(this,te)[te]=!0,b(this,ee)[ee]=!0,this.setDirty(),this.camera.view.redraw(),this.onProjMatrix.dispatch(this,b(this,Zt)[Zt].projMatrix)}},{key:\"inverseProjMatrix\",get:function(){return this.dirty&&this.cleanIfDirty(),b(this,te)[te]&&(Y(b(this,Zt)[Zt].projMatrix,b(this,Zt)[Zt].inverseProjMatrix),b(this,te)[te]=!1),b(this,Zt)[Zt].inverseProjMatrix}},{key:\"transposedProjMatrix\",get:function(){return this.dirty&&this.cleanIfDirty(),b(this,ee)[ee]&&($(b(this,Zt)[Zt].projMatrix,b(this,Zt)[Zt].transposedProjMatrix),b(this,ee)[ee]=!1),b(this,Zt)[Zt].transposedProjMatrix}}]),i}(t);ie.type=C;var re,ne,se,oe=q(),he=(re=s(3),ne=s(3),se=s(3),function(t){return re[0]=t[0],re[1]=t[1],re[2]=t[2],ne[0]=t[3],ne[1]=t[4],ne[2]=t[5],_(ne,re,se),Math.abs(W(se))}),ae=function(){var t=s(3),e=s(3),i=s(3);return function(r,n){t[0]=r[0],t[1]=r[1],t[2]=r[2],e[0]=r[3],e[1]=r[4],e[2]=r[5];var s=_(e,t,i),o=n[0]-r[0],h=r[3]-n[0],a=n[1]-r[1],c=r[4]-n[1],l=n[2]-r[2],d=r[5]-n[2];return s[0]+=o>h?o:h,s[1]+=a>c?a:c,s[2]+=l>d?l:d,Math.abs(W(s))}}();function ce(t,e){return void 0===e&&(e=U()),e[0]=(t[0]+t[3])/2,e[1]=(t[1]+t[4])/2,e[2]=(t[2]+t[5])/2,e}s(3);var le=/*#__PURE__*/function(){function t(){this.testVertex=void 0,this.offset=void 0,this.normal=void 0,this.normal=U(),this.offset=0,this.testVertex=U()}return t.prototype.set=function(t,e,i,r){var n=1/Math.sqrt(t*t+e*e+i*i);this.normal[0]=t*n,this.normal[1]=e*n,this.normal[2]=i*n,this.offset=r*n,this.testVertex[0]=this.normal[0]>=0?1:0,this.testVertex[1]=this.normal[1]>=0?1:0,this.testVertex[2]=this.normal[2]>=0?1:0},t}(),de=function(){this.planes=void 0,this.planes=[new le,new le,new le,new le,new le,new le]},ue=U(),ve=U(),fe=U(),ye=U(),pe=U(),be=U(),we=q(),je=q(),ge=U(),Oe=U(),Pe=U(),me=U(),ke=/*#__PURE__*/p(\"state\"),xe=/*#__PURE__*/p(\"frustum\"),Me=/*#__PURE__*/p(\"activeProjection\"),Ie=/*#__PURE__*/function(t){function i(i,n){var s;return void 0===n&&(n={}),(s=t.call(this,i,n)||this).view=void 0,s.perspectiveProjection=void 0,s.orthoProjection=void 0,s.frustumProjection=void 0,s.customProjection=void 0,s.onProjectionType=void 0,s.onViewMatrix=void 0,s.onProjMatrix=void 0,s.onWorldAxis=void 0,s.onFrustum=void 0,Object.defineProperty(f(s),ke,{writable:!0,value:void 0}),Object.defineProperty(f(s),xe,{writable:!0,value:void 0}),Object.defineProperty(f(s),Me,{writable:!0,value:void 0}),s.onProjectionType=new e(new r),s.onViewMatrix=new e(new r),s.onProjMatrix=new e(new r),s.onWorldAxis=new e(new r),s.onFrustum=new e(new r),s.view=i,b(f(s),ke)[ke]={eye:U(n.eye||[0,0,10]),look:U(n.look||[0,0,0]),up:U(n.up||[0,1,0]),worldUp:U([0,1,0]),worldRight:U([1,0,0]),worldForward:U([0,0,-1]),worldAxis:new Float32Array(n.worldAxis||[1,0,0,0,1,0,0,0,1]),gimbalLock:!1!==n.gimbalLock,constrainPitch:!0===n.constrainPitch,projectionType:n.projectionType||D,deviceMatrix:n.deviceMatrix?q(n.deviceMatrix):N(),hasDeviceMatrix:!!n.deviceMatrix,viewMatrix:q(),viewNormalMatrix:q(),inverseViewMatrix:q()},b(f(s),xe)[xe]=new de,s.perspectiveProjection=new Gt(f(s)),s.orthoProjection=new Kt(f(s)),s.customProjection=new ie(f(s)),b(f(s),Me)[Me]=s.perspectiveProjection,s.perspectiveProjection.onProjMatrix.subscribe(function(){b(f(s),ke)[ke].projectionType===D&&s.onProjMatrix.dispatch(f(s),s.perspectiveProjection.projMatrix)}),s.orthoProjection.onProjMatrix.subscribe(function(){b(f(s),ke)[ke].projectionType===S&&s.onProjMatrix.dispatch(f(s),s.orthoProjection.projMatrix)}),s.frustumProjection.onProjMatrix.subscribe(function(){b(f(s),ke)[ke].projectionType===V&&s.onProjMatrix.dispatch(f(s),s.frustumProjection.projMatrix)}),s.customProjection.onProjMatrix.subscribe(function(){b(f(s),ke)[ke].projectionType===C&&s.onProjMatrix.dispatch(f(s),s.customProjection.projMatrix)}),s}u(i,t);var n=i.prototype;return n.clean=function(){var t,e=b(this,ke)[ke];this.projectionType===S?(_(b(this,ke)[ke].eye,b(this,ke)[ke].look,ge),H(ge,Oe),z(Oe,1e3,Pe),F(b(this,ke)[ke].look,Pe,me),t=me):t=b(this,ke)[ke].eye,e.hasDeviceMatrix?(Q(t,b(this,ke)[ke].look,b(this,ke)[ke].up,je),K(e.deviceMatrix,je,e.viewMatrix)):Q(t,b(this,ke)[ke].look,b(this,ke)[ke].up,e.viewMatrix),Y(b(this,ke)[ke].viewMatrix,b(this,ke)[ke].inverseViewMatrix),$(b(this,ke)[ke].inverseViewMatrix,b(this,ke)[ke].viewNormalMatrix),this.view.redraw(),function(t,e,i){var r=K(e,t,oe),n=r[0],s=r[1],o=r[2],h=r[3],a=r[4],c=r[5],l=r[6],d=r[7],u=r[8],v=r[9],f=r[10],y=r[11],p=r[12],b=r[13],w=r[14],j=r[15];(i=i||new de).planes[0].set(h-n,d-a,y-u,j-p),i.planes[1].set(h+n,d+a,y+u,j+p),i.planes[2].set(h-s,d-c,y-v,j-b),i.planes[3].set(h+s,d+c,y+v,j+b),i.planes[4].set(h-o,d-l,y-f,j-w),i.planes[5].set(h+o,d+l,y+f,j+w)}(b(this,ke)[ke].viewMatrix,b(this,Me)[Me].projMatrix,b(this,xe)[xe]),this.onViewMatrix.dispatch(this,b(this,ke)[ke].viewMatrix),this.onFrustum.dispatch(this,b(this,xe)[xe])},n.orbitYaw=function(t){var e=_(b(this,ke)[ke].eye,b(this,ke)[ke].look,ue);G(.0174532925*t,b(this,ke)[ke].gimbalLock?b(this,ke)[ke].worldUp:b(this,ke)[ke].up,we),e=Z(we,e,ve),this.eye=F(b(this,ke)[ke].look,e,fe),this.up=Z(we,b(this,ke)[ke].up,ye)},n.orbitPitch=function(t){if(!(b(this,ke)[ke].constrainPitch&&(t=L(b(this,ke)[ke].up,b(this,ke)[ke].worldUp)/a)<1)){var e=_(b(this,ke)[ke].eye,b(this,ke)[ke].look,ue);G(.0174532925*t,R(H(e,ve),H(b(this,ke)[ke].up,fe)),we),e=Z(we,e,ye),this.up=Z(we,b(this,ke)[ke].up,pe),this.eye=F(e,b(this,ke)[ke].look,be)}},n.yaw=function(t){var e=_(b(this,ke)[ke].look,b(this,ke)[ke].eye,ue);G(.0174532925*t,b(this,ke)[ke].gimbalLock?b(this,ke)[ke].worldUp:b(this,ke)[ke].up,we),e=Z(we,e,ve),this.look=F(e,b(this,ke)[ke].eye,fe),b(this,ke)[ke].gimbalLock&&(this.up=Z(we,b(this,ke)[ke].up,ye))},n.pitch=function(t){if(!(b(this,ke)[ke].constrainPitch&&(t=L(b(this,ke)[ke].up,b(this,ke)[ke].worldUp)/a)<1)){var e=_(b(this,ke)[ke].look,b(this,ke)[ke].eye,ue);G(.0174532925*t,R(H(e,ve),H(b(this,ke)[ke].up,fe)),we),this.up=Z(we,b(this,ke)[ke].up,be),e=Z(we,e,ye),this.look=F(e,b(this,ke)[ke].eye,pe)}},n.pan=function(t){var e,i=_(b(this,ke)[ke].eye,b(this,ke)[ke].look,ue),r=[0,0,0];0!==t[0]&&(e=z(R(H(i,[]),H(b(this,ke)[ke].up,ve)),t[0]),r[0]+=e[0],r[1]+=e[1],r[2]+=e[2]),0!==t[1]&&(e=z(H(b(this,ke)[ke].up,fe),t[1]),r[0]+=e[0],r[1]+=e[1],r[2]+=e[2]),0!==t[2]&&(e=z(H(i,ye),t[2]),r[0]+=e[0],r[1]+=e[1],r[2]+=e[2]),this.eye=F(b(this,ke)[ke].eye,r,pe),this.look=F(b(this,ke)[ke].look,r,be)},n.zoom=function(t){var e=_(b(this,ke)[ke].eye,b(this,ke)[ke].look,ue),i=Math.abs(W(e)),r=Math.abs(i+t);if(!(r<.5)){var n=H(e,fe);this.eye=F(b(this,ke)[ke].look,z(n,r),ye)}},n.destroy=function(){t.prototype.destroy.call(this),this.onProjectionType.clear(),this.onViewMatrix.clear(),this.onProjMatrix.clear(),this.onWorldAxis.clear()},d(i,[{key:\"project\",get:function(){return b(this,Me)[Me]}},{key:\"eye\",get:function(){return b(this,ke)[ke].eye},set:function(t){b(this,ke)[ke].eye.set(t),this.setDirty()}},{key:\"look\",get:function(){return b(this,ke)[ke].look},set:function(t){b(this,ke)[ke].look.set(t),this.setDirty()}},{key:\"up\",get:function(){return b(this,ke)[ke].up},set:function(t){b(this,ke)[ke].up.set(t),this.setDirty()}},{key:\"worldUp\",get:function(){return b(this,ke)[ke].worldUp}},{key:\"worldRight\",get:function(){return b(this,ke)[ke].worldRight}},{key:\"worldForward\",get:function(){return b(this,ke)[ke].worldForward}},{key:\"constrainPitch\",get:function(){return b(this,ke)[ke].constrainPitch},set:function(t){b(this,ke)[ke].constrainPitch=t}},{key:\"gimbalLock\",get:function(){return b(this,ke)[ke].gimbalLock},set:function(t){b(this,ke)[ke].gimbalLock=t}},{key:\"worldAxis\",get:function(){return b(this,ke)[ke].worldAxis},set:function(t){var e=b(this,ke)[ke];e.worldAxis.set(t),e.worldRight[0]=e.worldAxis[0],e.worldRight[1]=e.worldAxis[1],e.worldRight[2]=e.worldAxis[2],e.worldUp[0]=e.worldAxis[3],e.worldUp[1]=e.worldAxis[4],e.worldUp[2]=e.worldAxis[5],e.worldForward[0]=e.worldAxis[6],e.worldForward[1]=e.worldAxis[7],e.worldForward[2]=e.worldAxis[8],this.onWorldAxis.dispatch(this,e.worldAxis)}},{key:\"deviceMatrix\",get:function(){return b(this,ke)[ke].deviceMatrix},set:function(t){b(this,ke)[ke].deviceMatrix.set(t||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),b(this,ke)[ke].hasDeviceMatrix=!!t,this.setDirty()}},{key:\"xUp\",get:function(){return b(this,ke)[ke].worldUp[0]>b(this,ke)[ke].worldUp[1]&&b(this,ke)[ke].worldUp[0]>b(this,ke)[ke].worldUp[2]}},{key:\"yUp\",get:function(){return b(this,ke)[ke].worldUp[1]>b(this,ke)[ke].worldUp[0]&&b(this,ke)[ke].worldUp[1]>b(this,ke)[ke].worldUp[2]}},{key:\"zUp\",get:function(){return b(this,ke)[ke].worldUp[2]>b(this,ke)[ke].worldUp[0]&&b(this,ke)[ke].worldUp[2]>b(this,ke)[ke].worldUp[1]}},{key:\"eyeLookDist\",get:function(){return W(_(b(this,ke)[ke].look,b(this,ke)[ke].eye,ue))}},{key:\"viewMatrix\",get:function(){return this.dirty&&this.cleanIfDirty(),b(this,ke)[ke].viewMatrix}},{key:\"inverseViewMatrix\",get:function(){return this.dirty&&this.cleanIfDirty(),b(this,ke)[ke].inverseViewMatrix}},{key:\"projMatrix\",get:function(){return b(this,Me)[Me].projMatrix}},{key:\"frustum\",get:function(){return this.dirty&&this.cleanIfDirty(),b(this,xe)[xe]}},{key:\"projectionType\",get:function(){return b(this,ke)[ke].projectionType},set:function(t){t=t||D,b(this,ke)[ke].projectionType!==t&&(t===D?b(this,Me)[Me]=this.perspectiveProjection:t===S?b(this,Me)[Me]=this.orthoProjection:t===V?b(this,Me)[Me]=this.frustumProjection:t===C?b(this,Me)[Me]=this.customProjection:(this.error(\"Unsupported value for 'projection': \"+t+\" defaulting to PerspectiveProjectionType\"),b(this,Me)[Me]=this.perspectiveProjection,t=D),b(this,Me)[Me].clean(),b(this,ke)[ke].projectionType=t,this.clean(),this.onProjectionType.dispatch(this,b(this,ke)[ke].projectionType),this.onProjMatrix.dispatch(this,b(this,Me)[Me].projMatrix))}}]),i}(t),Ae={viewerId:\"\",time:0,startTime:0,prevTime:0,deltaTime:0},De=/*#__PURE__*/p(\"viewersRenderInfo\"),Se=/*#__PURE__*/p(\"viewerIDMap\"),Ve=/*#__PURE__*/p(\"taskQueue\"),Ce=/*#__PURE__*/p(\"taskBudget\"),Le=/*#__PURE__*/p(\"lastTime\"),Ue=/*#__PURE__*/p(\"elapsedTime\"),Te=/*#__PURE__*/p(\"runTasks\"),ze=/*#__PURE__*/p(\"runTasksUntil\"),Fe=/*#__PURE__*/p(\"fireTickEvents\"),_e=/*#__PURE__*/p(\"renderViewers\");function Re(t){b(this,ze)[ze](t+b(this,Ce)[Ce]),this.getNumTasks(),b(this,Ce)}function We(t){void 0===t&&(t=-1);for(var e=(new Date).getTime(),i=0;b(this,Ve)[Ve].length>0&&(t<0||e<t);){var r=b(this,Ve)[Ve].shift(),n=b(this,Ve)[Ve].shift();n?r.call(n):r(),e=(new Date).getTime(),i++}return i}function Ee(t){for(var e in Ae.time=t,qe.viewers)if(this.viewers.hasOwnProperty(e)){var i=this.viewers[e];Ae.viewerId=e,Ae.startTime=i.startTime,Ae.deltaTime=null!=Ae.prevTime?Ae.time-Ae.prevTime:0,i.onTick.dispatch(i,Ae)}Ae.prevTime=t}function He(){for(var t in this.viewers)if(this.viewers.hasOwnProperty(t)){var e=this.viewers[t],i=b(this,De)[De][t];i||(i=b(this,De)[De][t]={}),e.render({})}}var qe=new(/*#__PURE__*/function(){function t(){var t=this;Object.defineProperty(this,_e,{value:He}),Object.defineProperty(this,Fe,{value:Ee}),Object.defineProperty(this,ze,{value:We}),Object.defineProperty(this,Te,{value:Re}),this.viewers=void 0,Object.defineProperty(this,De,{writable:!0,value:{}}),Object.defineProperty(this,Se,{writable:!0,value:new m}),Object.defineProperty(this,Ve,{writable:!0,value:new k}),Object.defineProperty(this,Ce,{writable:!0,value:10}),Object.defineProperty(this,Le,{writable:!0,value:0}),Object.defineProperty(this,Ue,{writable:!0,value:0}),this.viewers={},requestAnimationFrame(function e(){var i=Date.now();b(t,Le)[Le]>0&&(b(t,Ue)[Ue]=i-b(t,Le)[Le]),b(t,Te)[Te](i),b(t,Fe)[Fe](i),b(t,_e)[_e](),b(t,Le)[Le]=i,requestAnimationFrame(e)})}var e=t.prototype;return e.registerViewer=function(t){if(t.id){if(this.viewers[t.id])return void console.error(\"[ERROR] Viewer \"+x(t.id)+\" already exists\")}else t.id=b(this,Se)[Se].addItem({});this.viewers[t.id]=t,b(this,De)[De][t.id]={}},e.deregisterViewer=function(t){this.viewers[t.id]&&(b(this,Se)[Se].removeItem(t.id),delete this.viewers[t.id],delete b(this,De)[De][t.id])},e.scheduleTask=function(t,e){b(this,Ve)[Ve].push(t),b(this,Ve)[Ve].push(e)},e.getNumTasks=function(){return b(this,Ve)[Ve].length},t}()),Xe=U(),Be=U(),Ne=U(),Ge=U(),Qe=U(),Ye=/*#__PURE__*/p(\"duration\"),$e=/*#__PURE__*/p(\"look1\"),Je=/*#__PURE__*/p(\"eye1\"),Ke=/*#__PURE__*/p(\"up1\"),Ze=/*#__PURE__*/p(\"look2\"),ti=/*#__PURE__*/p(\"eye2\"),ei=/*#__PURE__*/p(\"up2\"),ii=/*#__PURE__*/p(\"orthoScale1\"),ri=/*#__PURE__*/p(\"orthoScale2\"),ni=/*#__PURE__*/p(\"fit\"),si=/*#__PURE__*/p(\"trail\"),oi=/*#__PURE__*/p(\"flying\"),hi=/*#__PURE__*/p(\"flyEyeLookUp\"),ai=/*#__PURE__*/p(\"flyingEye\"),ci=/*#__PURE__*/p(\"flyingLook\"),li=/*#__PURE__*/p(\"callback\"),di=/*#__PURE__*/p(\"callbackScope\"),ui=/*#__PURE__*/p(\"time1\"),vi=/*#__PURE__*/p(\"time2\"),fi=/*#__PURE__*/p(\"flyingEyeLookUp\"),yi=/*#__PURE__*/p(\"fitFOV\"),pi=/*#__PURE__*/p(\"projection2\"),bi=/*#__PURE__*/p(\"projMatrix1\"),wi=/*#__PURE__*/p(\"projMatrix2\"),ji=/*#__PURE__*/p(\"jumpTo\"),gi=/*#__PURE__*/p(\"update\"),Oi=/*#__PURE__*/p(\"ease\"),Pi=/*#__PURE__*/p(\"easeInCubic\"),mi=/*#__PURE__*/p(\"easeOutExpo\"),ki=/*#__PURE__*/function(t){function i(i,n){var s;return s=t.call(this,i,n)||this,Object.defineProperty(f(s),gi,{value:Mi}),Object.defineProperty(f(s),ji,{value:xi}),s.view=void 0,s.camera=void 0,Object.defineProperty(f(s),Ye,{writable:!0,value:void 0}),Object.defineProperty(f(s),$e,{writable:!0,value:void 0}),Object.defineProperty(f(s),Je,{writable:!0,value:void 0}),Object.defineProperty(f(s),Ke,{writable:!0,value:void 0}),Object.defineProperty(f(s),Ze,{writable:!0,value:void 0}),Object.defineProperty(f(s),ti,{writable:!0,value:void 0}),Object.defineProperty(f(s),ei,{writable:!0,value:void 0}),Object.defineProperty(f(s),ii,{writable:!0,value:void 0}),Object.defineProperty(f(s),ri,{writable:!0,value:void 0}),Object.defineProperty(f(s),ni,{writable:!0,value:void 0}),Object.defineProperty(f(s),si,{writable:!0,value:void 0}),Object.defineProperty(f(s),oi,{writable:!0,value:void 0}),Object.defineProperty(f(s),hi,{writable:!0,value:void 0}),Object.defineProperty(f(s),ai,{writable:!0,value:void 0}),Object.defineProperty(f(s),ci,{writable:!0,value:void 0}),Object.defineProperty(f(s),li,{writable:!0,value:void 0}),Object.defineProperty(f(s),di,{writable:!0,value:void 0}),Object.defineProperty(f(s),ui,{writable:!0,value:void 0}),Object.defineProperty(f(s),vi,{writable:!0,value:void 0}),s.easing=void 0,Object.defineProperty(f(s),fi,{writable:!0,value:void 0}),Object.defineProperty(f(s),yi,{writable:!0,value:void 0}),Object.defineProperty(f(s),pi,{writable:!0,value:void 0}),Object.defineProperty(f(s),bi,{writable:!0,value:void 0}),Object.defineProperty(f(s),wi,{writable:!0,value:void 0}),s.onStarted=void 0,s.onStopped=void 0,s.onCancelled=void 0,s.view=i,s.camera=i.camera,b(f(s),$e)[$e]=U(),b(f(s),Je)[Je]=U(),b(f(s),Ke)[Ke]=U(),b(f(s),Ze)[Ze]=U(),b(f(s),ti)[ti]=U(),b(f(s),ei)[ei]=U(),b(f(s),ii)[ii]=1,b(f(s),ri)[ri]=1,b(f(s),oi)[oi]=!1,b(f(s),hi)[hi]=!1,b(f(s),ai)[ai]=!1,b(f(s),ci)[ci]=!1,b(f(s),li)[li]=null,b(f(s),di)[di]=null,b(f(s),ui)[ui]=null,b(f(s),vi)[vi]=null,s.easing=!0,b(f(s),si)[si]=!1,b(f(s),ni)[ni]=!0,b(f(s),Ye)[Ye]=500,s.onStarted=new e(new r),s.onStopped=new e(new r),s.onCancelled=new e(new r),s}u(i,t);var n=i.prototype;return n.flyTo=function(t,e){void 0===t&&(t={}),b(this,oi)[oi]&&this.stop(),b(this,oi)[oi]=!1,b(this,ai)[ai]=!1,b(this,ci)[ci]=!1,b(this,fi)[fi]=!1,b(this,li)[li]=e;var i,r,n,s,o=this.camera,h=!!t.projection&&t.projection!==o.projectionType;b(this,Je)[Je][0]=o.eye[0],b(this,Je)[Je][1]=o.eye[1],b(this,Je)[Je][2]=o.eye[2],b(this,$e)[$e][0]=o.look[0],b(this,$e)[$e][1]=o.look[1],b(this,$e)[$e][2]=o.look[2],b(this,Ke)[Ke][0]=o.up[0],b(this,Ke)[Ke][1]=o.up[1],b(this,Ke)[Ke][2]=o.up[2],b(this,ii)[ii]=o.orthoProjection.scale,b(this,ri)[ri]=t.orthoScale||b(this,ii)[ii],t.aabb?i=t.aabb:t.eye&&t.look||t.up?(r=t.eye,n=t.look,s=t.up):t.eye?r=t.eye:t.look?n=t.look:h||(i=this.view.aabb);var c=t.poi;if(i){if(i[3]<i[0]||i[4]<i[1]||i[5]<i[2])return;if(i[3]===i[0]&&i[4]===i[1]&&i[5]===i[2])return;var l=ce(i=i.slice());b(this,Ze)[Ze]=c||l;var d=H(_(b(this,Je)[Je],b(this,$e)[$e],Xe)),u=c?ae(i,c):he(i),v=t.fitFOV||b(this,yi)[yi],f=Math.abs(u/Math.tan(v*a));b(this,ri)[ri]=1.1*u,b(this,ti)[ti][0]=b(this,Ze)[Ze][0]+d[0]*f,b(this,ti)[ti][1]=b(this,Ze)[Ze][1]+d[1]*f,b(this,ti)[ti][2]=b(this,Ze)[Ze][2]+d[2]*f,b(this,ei)[ei][0]=b(this,Ke)[Ke][0],b(this,ei)[ei][1]=b(this,Ke)[Ke][1],b(this,ei)[ei][2]=b(this,Ke)[Ke][2],b(this,fi)[fi]=!0}else(r||n||s)&&(b(this,fi)[fi]=!!r&&!!n&&!!s,b(this,ai)[ai]=!!r&&!n,b(this,ci)[ci]=!!n&&!r,r&&(b(this,ti)[ti][0]=r[0],b(this,ti)[ti][1]=r[1],b(this,ti)[ti][2]=r[2]),n&&(b(this,Ze)[Ze][0]=n[0],b(this,Ze)[Ze][1]=n[1],b(this,Ze)[Ze][2]=n[2]),s&&(b(this,ei)[ei][0]=s[0],b(this,ei)[ei][1]=s[1],b(this,ei)[ei][2]=s[2]));h?(t.projection===S&&o.projectionType!==S&&(b(this,pi)[pi]=S,b(this,bi)[bi]=o.projMatrix.slice(),b(this,wi)[wi]=o.orthoProjection.projMatrix.slice(),o.projectionType=C),t.projection===D&&o.projectionType!==D&&(b(this,pi)[pi]=D,b(this,bi)[bi]=o.projMatrix.slice(),b(this,wi)[wi]=o.perspectiveProjection.projMatrix.slice(),o.projectionType=C)):b(this,pi)[pi]=null,this.onStarted.dispatch(this,null),b(this,ui)[ui]=Date.now(),b(this,vi)[vi]=b(this,ui)[ui]+(t.duration?1e3*t.duration:b(this,Ye)[Ye]),b(this,oi)[oi]=!0,qe.scheduleTask(b(this,gi)[gi],this)},n.jumpTo=function(t){b(this,ji)[ji](t)},n.stop=function(){if(b(this,oi)[oi]){b(this,oi)[oi]=!1,b(this,ui)[ui]=null,b(this,vi)[vi]=null,b(this,pi)[pi]&&(this.camera.projectionType=b(this,pi)[pi]);var t=b(this,li)[li];t&&(b(this,li)[li]=null,t()),this.onStopped.dispatch(this,null)}},n.cancel=function(){b(this,oi)[oi]&&(b(this,oi)[oi]=!1,b(this,ui)[ui]=null,b(this,vi)[vi]=null,b(this,li)[li]&&(b(this,li)[li]=null),this.onCancelled.dispatch(this,null))},n.destroy=function(){this.stop(),t.prototype.destroy.call(this),this.onStarted.clear(),this.onStopped.clear(),this.onCancelled.clear()},d(i,[{key:\"duration\",get:function(){return b(this,Ye)[Ye]/1e3},set:function(t){b(this,Ye)[Ye]=t?1e3*t:500,this.stop()}},{key:\"fit\",get:function(){return b(this,ni)[ni]},set:function(t){b(this,ni)[ni]=t}},{key:\"fitFOV\",get:function(){return b(this,yi)[yi]},set:function(t){b(this,yi)[yi]=t}},{key:\"trail\",get:function(){return b(this,si)[si]},set:function(t){b(this,si)[si]=t}}]),i}(t);function xi(t){b(this,oi)[oi]&&this.stop();var e,i,r,n,s=this.camera;t.aabb?e=t.aabb:t.eye||t.look||t.up?(i=t.eye,r=t.look,n=t.up):e=this.view.aabb;var o=t.poi;if(e){if(e[3]<=e[0]||e[4]<=e[1]||e[5]<=e[2])return;var h,c=o?ae(e,o):he(e);r=o||ce(e,r),b(this,si)[si]?_(s.look,r,Qe):_(s.eye,s.look,Qe),H(Qe),h=(void 0!==t.fit?t.fit:b(this,ni)[ni])?Math.abs(c/Math.tan((t.fitFOV||b(this,yi)[yi])*a)):W(_(s.eye,s.look,Xe)),z(Qe,h),s.eye=F(r,Qe,Xe),s.look=r,this.camera.orthoProjection.scale=1.1*c}else(i||r||n)&&(i&&(s.eye=i),r&&(s.look=r),n&&(s.up=n));t.projection&&(s.projectionType=t.projection)}function Mi(){if(b(this,oi)[oi]){var t=(Date.now()-b(this,ui)[ui])/(b(this,vi)[vi]-b(this,ui)[ui]),e=t>=1;t>1&&(t=1);var i=this.easing?b(ki,Oi)[Oi](t,0,1,1):t,r=this.camera;if(b(this,ai)[ai]||b(this,ci)[ci]?b(this,ai)[ai]?(_(r.eye,r.look,Qe),r.eye=E(i,0,1,b(this,Je)[Je],b(this,ti)[ti],Ne),r.look=_(Ne,Qe,Be)):b(this,ci)[ci]&&(r.look=E(i,0,1,b(this,$e)[$e],b(this,Ze)[Ze],Be),r.up=E(i,0,1,b(this,Ke)[Ke],b(this,ei)[ei],Ge)):b(this,fi)[fi]&&(r.eye=E(i,0,1,b(this,Je)[Je],b(this,ti)[ti],Ne),r.look=E(i,0,1,b(this,$e)[$e],b(this,Ze)[Ze],Be),r.up=E(i,0,1,b(this,Ke)[Ke],b(this,ei)[ei],Ge)),b(this,pi)[pi]){var n=b(this,pi)[pi]===S?b(ki,mi)[mi](t,0,1,1):b(ki,Pi)[Pi](t,0,1,1);r.customProjection.projMatrix=function(t,e,i,r,n,s){var o=q(),h=(t-0)/1;return o[0]=r[0]+h*(n[0]-r[0]),o[1]=r[1]+h*(n[1]-r[1]),o[2]=r[2]+h*(n[2]-r[2]),o[3]=r[3]+h*(n[3]-r[3]),o[4]=r[4]+h*(n[4]-r[4]),o[5]=r[5]+h*(n[5]-r[5]),o[6]=r[6]+h*(n[6]-r[6]),o[7]=r[7]+h*(n[7]-r[7]),o[8]=r[8]+h*(n[8]-r[8]),o[9]=r[9]+h*(n[9]-r[9]),o[10]=r[10]+h*(n[10]-r[10]),o[11]=r[11]+h*(n[11]-r[11]),o[12]=r[12]+h*(n[12]-r[12]),o[13]=r[13]+h*(n[13]-r[13]),o[14]=r[14]+h*(n[14]-r[14]),o[15]=r[15]+h*(n[15]-r[15]),o}(n,0,0,b(this,bi)[bi],b(this,wi)[wi])}else r.orthoProjection.scale=b(this,ii)[ii]+t*(b(this,ri)[ri]-b(this,ii)[ii]);if(e)return r.orthoProjection.scale=b(this,ri)[ri],void this.stop();qe.scheduleTask(b(this,gi)[gi],this)}}Object.defineProperty(ki,mi,{value:function(t,e,i,r){return i*(1-Math.pow(2,-10*t/r))+e}}),Object.defineProperty(ki,Pi,{value:function(t,e,i,r){return i*(t/=r)*t*t+e}}),Object.defineProperty(ki,Oi,{value:function(t,e,i,r){return-i*(t/=r)*(t-2)+e}});var Ii=/*#__PURE__*/p(\"onTick\"),Ai=/*#__PURE__*/p(\"backgroundColor\"),Di=/*#__PURE__*/p(\"backgroundColorFromAmbientLight\"),Si=/*#__PURE__*/p(\"resolutionScale\"),Vi=/*#__PURE__*/p(\"numObjects\"),Ci=/*#__PURE__*/p(\"objectIds\"),Li=/*#__PURE__*/p(\"numVisibleObjects\"),Ui=/*#__PURE__*/p(\"visibleObjectIds\"),Ti=/*#__PURE__*/p(\"numXRayedObjects\"),zi=/*#__PURE__*/p(\"xrayedObjectIds\"),Fi=/*#__PURE__*/p(\"numHighlightedObjects\"),_i=/*#__PURE__*/p(\"highlightedObjectIds\"),Ri=/*#__PURE__*/p(\"numSelectedObjects\"),Wi=/*#__PURE__*/p(\"selectedObjectIds\"),Ei=/*#__PURE__*/p(\"numColorizedObjects\"),Hi=/*#__PURE__*/p(\"colorizedObjectIds\"),qi=/*#__PURE__*/p(\"numOpacityObjects\"),Xi=/*#__PURE__*/p(\"opacityObjectIds\"),Bi=/*#__PURE__*/p(\"qualityRender\"),Ni=/*#__PURE__*/p(\"lightsHash\"),Gi=/*#__PURE__*/p(\"sectionPlanesHash\"),Qi=/*#__PURE__*/p(\"registerSectionPlane\"),Yi=/*#__PURE__*/p(\"deregisterSectionPlane\"),$i=/*#__PURE__*/p(\"initObjects\"),Ji=/*#__PURE__*/p(\"createObjects\"),Ki=/*#__PURE__*/p(\"destroyObjects\"),Zi=/*#__PURE__*/function(t){function i(i){var n;if(n=t.call(this,null,i)||this,Object.defineProperty(f(n),Ki,{value:nr}),Object.defineProperty(f(n),Ji,{value:rr}),Object.defineProperty(f(n),$i,{value:ir}),Object.defineProperty(f(n),Yi,{value:er}),Object.defineProperty(f(n),Qi,{value:tr}),n.viewIndex=void 0,n.camera=void 0,n.canvasElement=void 0,n.transparent=void 0,n.boundary=void 0,n.logarithmicDepthBufferEnabled=void 0,n.sao=void 0,n.cameraFlight=void 0,n.metrics=void 0,n.xrayMaterial=void 0,n.highlightMaterial=void 0,n.selectedMaterial=void 0,n.edgeMaterial=void 0,n.pointsMaterial=void 0,n.linesMaterial=void 0,n.objects=void 0,n.visibleObjects=void 0,n.xrayedObjects=void 0,n.highlightedObjects=void 0,n.selectedObjects=void 0,n.colorizedObjects=void 0,n.opacityObjects=void 0,n.sectionPlanes=void 0,n.sectionPlanesList=[],n.lights=void 0,n.lightsList=[],n.gammaOutput=void 0,n.layers=void 0,n.autoLayers=void 0,n.onBoundary=void 0,n.onObjectVisibility=void 0,n.onObjectXRayed=void 0,n.onLayerCreated=void 0,n.onLayerDestroyed=void 0,n.onSectionPlaneCreated=void 0,n.onSectionPlaneDestroyed=void 0,Object.defineProperty(f(n),Ii,{writable:!0,value:void 0}),Object.defineProperty(f(n),Ai,{writable:!0,value:void 0}),Object.defineProperty(f(n),Di,{writable:!0,value:void 0}),Object.defineProperty(f(n),Si,{writable:!0,value:void 0}),Object.defineProperty(f(n),Vi,{writable:!0,value:void 0}),Object.defineProperty(f(n),Ci,{writable:!0,value:void 0}),Object.defineProperty(f(n),Li,{writable:!0,value:void 0}),Object.defineProperty(f(n),Ui,{writable:!0,value:void 0}),Object.defineProperty(f(n),Ti,{writable:!0,value:void 0}),Object.defineProperty(f(n),zi,{writable:!0,value:void 0}),Object.defineProperty(f(n),Fi,{writable:!0,value:void 0}),Object.defineProperty(f(n),_i,{writable:!0,value:void 0}),Object.defineProperty(f(n),Ri,{writable:!0,value:void 0}),Object.defineProperty(f(n),Wi,{writable:!0,value:void 0}),Object.defineProperty(f(n),Ei,{writable:!0,value:void 0}),Object.defineProperty(f(n),Hi,{writable:!0,value:void 0}),Object.defineProperty(f(n),qi,{writable:!0,value:void 0}),Object.defineProperty(f(n),Xi,{writable:!0,value:void 0}),Object.defineProperty(f(n),Bi,{writable:!0,value:void 0}),Object.defineProperty(f(n),Ni,{writable:!0,value:null}),Object.defineProperty(f(n),Gi,{writable:!0,value:null}),n.viewer=i.viewer,!((i.canvasElement||document.getElementById(i.canvasId))instanceof HTMLCanvasElement))throw\"Mandatory View config expected: valid canvasId or canvasElement\";n.viewIndex=0,n.objects={},n.visibleObjects={},n.xrayedObjects={},n.highlightedObjects={},n.selectedObjects={},n.colorizedObjects={},n.opacityObjects={},n.sectionPlanes={},n.sectionPlanesList=[],n.lights={},n.lightsList=[],n.layers={},b(f(n),Vi)[Vi]=0,b(f(n),Ci)[Ci]=null,b(f(n),Li)[Li]=0,b(f(n),Ui)[Ui]=null,b(f(n),Ti)[Ti]=0,b(f(n),zi)[zi]=null,b(f(n),Fi)[Fi]=0,b(f(n),_i)[_i]=null,b(f(n),Ri)[Ri]=0,b(f(n),Wi)[Wi]=null,b(f(n),Ei)[Ei]=0,b(f(n),Hi)[Hi]=null,b(f(n),qi)[qi]=0,b(f(n),Xi)[Xi]=null,b(f(n),Bi)[Bi]=!!i.qualityRender,n.gammaOutput=!0,b(f(n),Gi)[Gi]=null,b(f(n),Ni)[Ni]=null,n.onBoundary=new e(new r),b(f(n),Si)[Si]=1,b(f(n),Ai)[Ai]=U([i.backgroundColor?i.backgroundColor[0]:1,i.backgroundColor?i.backgroundColor[1]:1,i.backgroundColor?i.backgroundColor[2]:1]),b(f(n),Di)[Di]=!!i.backgroundColorFromAmbientLight,n.canvasElement=i.canvasElement,n.transparent=!!i.transparent,n.canvasElement.width=n.canvasElement.clientWidth,n.canvasElement.height=n.canvasElement.clientHeight,n.boundary=[n.canvasElement.offsetLeft,n.canvasElement.offsetTop,n.canvasElement.clientWidth,n.canvasElement.clientHeight];var s=0,o=0,h=0,a=0,c=0,l=0,d=null,u=null;return b(f(n),Ii)[Ii]=n.viewer.onTick.subscribe(function(){var t=n.canvasElement,e=b(f(n),Si)[Si]!==u,i=window.innerWidth!==s||window.innerHeight!==o,r=t.clientWidth!==h||t.clientHeight!==a,v=t.offsetLeft!==c||t.offsetTop!==l,y=t.parentElement;if(e||i||r||v||y!==d){if(e||r||v){var p=t.clientWidth,w=t.clientHeight;(e||r)&&(t.width=Math.round(t.clientWidth*b(f(n),Si)[Si]),t.height=Math.round(t.clientHeight*b(f(n),Si)[Si]));var j=n.boundary;j[0]=t.offsetLeft,j[1]=t.offsetTop,j[2]=p,j[3]=w,e&&!r||n.onBoundary.dispatch(f(n),j),h=p,a=w}e&&(u=b(f(n),Si)[Si]),i&&(s=window.innerWidth,o=window.innerHeight),v&&(c=t.offsetLeft,l=t.offsetTop),d=y}}),n.camera=new Ie(f(n)),n.sao=new ut(f(n),{}),n.cameraFlight=new ki(f(n),{duration:.5}),n.metrics=new lt(f(n),{units:i.units,scale:i.scale,origin:i.origin}),n.xrayMaterial=new _t(f(n),{fill:!0,fillColor:[.9,.7,.6],fillAlpha:.4,edges:!0,edgeColor:[.5,.4,.4],edgeAlpha:1,edgeWidth:1}),n.highlightMaterial=new _t(f(n),{fill:!0,fillColor:[1,1,0],fillAlpha:.5,edges:!0,edgeColor:[.5,.4,.4],edgeAlpha:1,edgeWidth:1}),n.selectedMaterial=new _t(f(n),{fill:!0,fillColor:[0,1,0],fillAlpha:.5,edges:!0,edgeColor:[.4,.5,.4],edgeAlpha:1,edgeWidth:1}),n.edgeMaterial=new Wt(f(n),{edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1,edges:!0,renderModes:[I]}),n.pointsMaterial=new Ht(f(n),{pointSize:1,roundPoints:!0,perspectivePoints:!0,minPerspectivePointSize:1,maxPerspectivePointSize:6,filterIntensity:!1,minIntensity:0,maxIntensity:1}),n.linesMaterial=new ft(f(n),{lineWidth:1}),n.lights={},b(f(n),Bi)[Bi]=!!i.qualityRender,n.autoLayers=!1!==i.autoLayers,n.logarithmicDepthBufferEnabled=!!i.logarithmicDepthBufferEnabled,n.onObjectVisibility=new e(new r),n.onObjectXRayed=new e(new r),n.onLayerCreated=new e(new r),n.onLayerDestroyed=new e(new r),n.onSectionPlaneCreated=new e(new r),n.onSectionPlaneDestroyed=new e(new r),b(f(n),$i)[$i](),n}u(i,t);var n=i.prototype;return n.registerViewObject=function(t){this.objects[t.id]=t,b(this,Vi)[Vi]++,b(this,Ci)[Ci]=null},n.deregisterViewObject=function(t){delete this.objects[t.id],delete this.visibleObjects[t.id],delete this.xrayedObjects[t.id],delete this.highlightedObjects[t.id],delete this.selectedObjects[t.id],delete this.colorizedObjects[t.id],delete this.opacityObjects[t.id],b(this,Vi)[Vi]--,b(this,Ci)[Ci]=null},n.objectVisibilityUpdated=function(t,e,i){void 0===i&&(i=!0),e?(this.visibleObjects[t.id]=t,b(this,Li)[Li]++):(delete this.visibleObjects[t.id],b(this,Li)[Li]--),b(this,Ui)[Ui]=null,i&&this.onObjectVisibility.dispatch(this,t)},n.objectXRayedUpdated=function(t,e,i){void 0===i&&(i=!0),e?(this.xrayedObjects[t.id]=t,b(this,Ti)[Ti]++):(delete this.xrayedObjects[t.id],b(this,Ti)[Ti]--),b(this,zi)[zi]=null,i&&this.onObjectXRayed.dispatch(this,t)},n.objectHighlightedUpdated=function(t,e){e?(this.highlightedObjects[t.id]=t,b(this,Fi)[Fi]++):(delete this.highlightedObjects[t.id],b(this,Fi)[Fi]--),b(this,_i)[_i]=null},n.objectSelectedUpdated=function(t,e){e?(this.selectedObjects[t.id]=t,b(this,Ri)[Ri]++):(delete this.selectedObjects[t.id],b(this,Ri)[Ri]--),b(this,Wi)[Wi]=null},n.objectColorizeUpdated=function(t,e){e?(this.colorizedObjects[t.id]=t,b(this,Ei)[Ei]++):(delete this.colorizedObjects[t.id],b(this,Ei)[Ei]--),b(this,Hi)[Hi]=null},n.objectOpacityUpdated=function(t,e){e?(this.opacityObjects[t.id]=t,b(this,qi)[qi]++):(delete this.opacityObjects[t.id],b(this,qi)[qi]--),b(this,Xi)[Xi]=null},n.createSectionPlane=function(t){var e=this,i=t.id||M();this.sectionPlanes[i]&&(this.error('SectionPlane with ID \"'+i+'\" already exists - will randomly-generate ID'),i=M());var r=new st(this,t);return b(this,Qi)[Qi](r),r.onDestroyed.one(function(){b(e,Yi)[Yi](r)}),r},n.clearSectionPlanes=function(){for(var t=Object.keys(this.sectionPlanes),e=0,i=t.length;e<i;e++)this.sectionPlanes[t[e]].destroy();this.sectionPlanesList.length=0,b(this,Gi)[Gi]=null},n.getSectionPlanesHash=function(){if(b(this,Gi)[Gi])return b(this,Gi)[Gi];if(0===this.sectionPlanesList.length)return b(this,Gi)[Gi]=\";\";for(var t=[],e=0,i=this.sectionPlanesList.length;e<i;e++)t.push(\"cp\");return t.push(\";\"),b(this,Gi)[Gi]=t.join(\"\"),b(this,Gi)[Gi]},n.registerLight=function(t){this.lightsList.push(t),this.lights[t.id]=t,b(this,Ni)[Ni]=null,this.rebuild()},n.deregisterLight=function(t){for(var e=0,i=this.lightsList.length;e<i;e++)if(this.lightsList[e].id===t.id)return this.lightsList.splice(e,1),b(this,Ni)[Ni]=null,delete this.lights[t.id],void this.rebuild()},n.clearLights=function(){for(var t=Object.keys(this.lights),e=0,i=t.length;e<i;e++)this.lights[t[e]].destroy()},n.getLightsHash=function(){if(b(this,Ni)[Ni])return b(this,Ni)[Ni];if(0===this.lightsList.length)return b(this,Ni)[Ni]=\";\";for(var t=[],e=this.lightsList,i=0,r=e.length;i<r;i++){var n=e[i];t.push(\"/\"),t.push(n.type),t.push(\"world\"===n.space?\"w\":\"v\"),n.castsShadow&&t.push(\"sh\")}return t.push(\";\"),b(this,Ni)[Ni]=t.join(\"\"),b(this,Ni)[Ni]},n.rebuild=function(){this.viewer.renderer.needsRebuild(this.viewIndex)},n.redraw=function(){this.viewer.renderer.setImageDirty(this.viewIndex)},n.destroy=function(){this.viewer.onTick.unsubscribe(b(this,Ii)[Ii]),t.prototype.destroy.call(this),this.onObjectVisibility.clear(),this.onObjectXRayed.clear(),this.onLayerCreated.clear(),this.onLayerDestroyed.clear(),this.onSectionPlaneCreated.clear(),this.onSectionPlaneDestroyed.clear()},n.getAmbientColorAndIntensity=function(){return[0,0,0,1]},n.setObjectsVisible=function(t,e){return this.withObjects(t,function(t){var i=t.visible!==e;return t.visible=e,i})},n.setObjectsCollidable=function(t,e){return this.withObjects(t,function(t){var i=t.collidable!==e;return t.collidable=e,i})},n.setObjectsCulled=function(t,e){return this.withObjects(t,function(t){var i=t.culled!==e;return t.culled=e,i})},n.setObjectsSelected=function(t,e){return this.withObjects(t,function(t){var i=t.selected!==e;return t.selected=e,i})},n.setObjectsHighlighted=function(t,e){return this.withObjects(t,function(t){var i=t.highlighted!==e;return t.highlighted=e,i})},n.setObjectsXRayed=function(t,e){return this.withObjects(t,function(t){var i=t.xrayed!==e;return i&&(t.xrayed=e),i})},n.setObjectsColorized=function(t,e){return this.withObjects(t,function(t){t.colorize=e})},n.setObjectsOpacity=function(t,e){return this.withObjects(t,function(t){var i=t.opacity!==e;return i&&(t.opacity=e),i})},n.setObjectsPickable=function(t,e){return this.withObjects(t,function(t){var i=t.pickable!==e;return i&&(t.pickable=e),i})},n.setObjectsClippable=function(t,e){return this.withObjects(t,function(t){var i=t.clippable!==e;return i&&(t.clippable=e),i})},n.withObjects=function(t,e){for(var i=!1,r=0,n=t.length;r<n;r++){var s=this.objects[t[r]];s&&(i=e(s)||i)}return i},n.createLayer=function(t){var e=this,i=this.layers[t.id];return i||(i=new Lt({id:t.id,view:this,viewer:this.viewer}),this.layers[t.id]=i,this.onLayerCreated.dispatch(this,i),i.onDestroyed.one(function(){delete e.layers[i.id],e.onLayerDestroyed.dispatch(e,i)})),i.autoDestroy=!1,i},d(i,[{key:\"aabb\",get:function(){return this.viewer.scene.aabb}},{key:\"backgroundColor\",get:function(){return b(this,Ai)[Ai]},set:function(t){t?(b(this,Ai)[Ai][0]=t[0],b(this,Ai)[Ai][1]=t[1],b(this,Ai)[Ai][2]=t[2]):(b(this,Ai)[Ai][0]=1,b(this,Ai)[Ai][1]=1,b(this,Ai)[Ai][2]=1),this.redraw()}},{key:\"backgroundColorFromAmbientLight\",get:function(){return b(this,Di)[Di]},set:function(t){b(this,Di)[Di]=!1!==t}},{key:\"resolutionScale\",get:function(){return b(this,Si)[Si]},set:function(t){if((t=t||1)!==b(this,Si)[Si]){b(this,Si)[Si]=t;var e=this.canvasElement;e.width=Math.round(e.clientWidth*b(this,Si)[Si]),e.height=Math.round(e.clientHeight*b(this,Si)[Si]),this.redraw()}}},{key:\"gammaFactor\",get:function(){return 1}},{key:\"qualityRender\",get:function(){return b(this,Bi)[Bi]},set:function(t){b(this,Bi)[Bi]!==t&&(b(this,Bi)[Bi]=t,this.redraw())}},{key:\"numObjects\",get:function(){return b(this,Vi)[Vi]}},{key:\"objectIds\",get:function(){return b(this,Ci)[Ci]||(b(this,Ci)[Ci]=Object.keys(this.objects)),b(this,Ci)[Ci]}},{key:\"numVisibleObjects\",get:function(){return b(this,Li)[Li]}},{key:\"visibleObjectIds\",get:function(){return b(this,Ui)[Ui]||(b(this,Ui)[Ui]=Object.keys(this.visibleObjects)),b(this,Ui)[Ui]}},{key:\"numXRayedObjects\",get:function(){return b(this,Ti)[Ti]}},{key:\"xrayedObjectIds\",get:function(){return b(this,zi)[zi]||(b(this,zi)[zi]=Object.keys(this.xrayedObjects)),b(this,zi)[zi]}},{key:\"numHighlightedObjects\",get:function(){return b(this,Fi)[Fi]}},{key:\"highlightedObjectIds\",get:function(){return b(this,_i)[_i]||(b(this,_i)[_i]=Object.keys(this.highlightedObjects)),b(this,_i)[_i]}},{key:\"numSelectedObjects\",get:function(){return b(this,Ri)[Ri]}},{key:\"selectedObjectIds\",get:function(){return b(this,Wi)[Wi]||(b(this,Wi)[Wi]=Object.keys(this.selectedObjects)),b(this,Wi)[Wi]}},{key:\"numColorizedObjects\",get:function(){return b(this,Ei)[Ei]}},{key:\"colorizedObjectIds\",get:function(){return b(this,Hi)[Hi]||(b(this,Hi)[Hi]=Object.keys(this.colorizedObjects)),b(this,Hi)[Hi]}},{key:\"opacityObjectIds\",get:function(){return b(this,Xi)[Xi]||(b(this,Xi)[Xi]=Object.keys(this.opacityObjects)),b(this,Xi)[Xi]}},{key:\"numOpacityObjects\",get:function(){return b(this,qi)[qi]}}]),i}(t);function tr(t){this.sectionPlanesList.push(t),this.sectionPlanes[t.id]=t,b(this,Gi)[Gi]=null,this.rebuild(),this.onSectionPlaneCreated.dispatch(this,t)}function er(t){for(var e=0,i=this.sectionPlanesList.length;e<i;e++)if(this.sectionPlanesList[e].id===t.id)return this.sectionPlanesList.splice(e,1),b(this,Gi)[Gi]=null,delete this.sectionPlanes[t.id],this.rebuild(),void this.onSectionPlaneDestroyed.dispatch(this,t)}function ir(){var t=this;for(var e in this.viewer.scene.models)b(this,Ji)[Ji](this.viewer.scene.models[e]);this.viewer.scene.onModelCreated.subscribe(function(e,i){b(t,Ji)[Ji](i)}),this.viewer.scene.onModelDestroyed.subscribe(function(e,i){b(t,Ki)[Ki](i)})}function rr(t){var e=this,i=t.objects,r=this.viewer.renderer.rendererViewObjects,n=function(){var t=i[s],n=r[s],o=\"default\",h=e.layers[o];if(!h){if(!e.autoLayers)return\"continue\";h=new Lt({id:o,view:e,viewer:e.viewer}),e.layers[o]=h,h.onDestroyed.one(function(){delete e.layers[h.id],e.onLayerDestroyed.dispatch(e,h)}),e.onLayerCreated.dispatch(e,h)}var a=new rt(h,t,n);h.registerViewObject(a),e.registerViewObject(a)};for(var s in i)n()}function nr(t){var e=t.objects;for(var i in e){var r=this.layers.default,n=this.objects[e[i].id];this.deregisterViewObject(n),r&&(r.deregisterViewObject(n),r.autoDestroy&&0===r.numObjects&&r.destroy())}}var sr=/*#__PURE__*/p(\"prefixMessageWithID\"),or=/*#__PURE__*/p(\"registerView\"),hr=/*#__PURE__*/p(\"deregisterView\"),ar=/*#__PURE__*/function(t){function s(i){var s;return s=t.call(this,null,{})||this,Object.defineProperty(f(s),hr,{value:dr}),Object.defineProperty(f(s),or,{value:lr}),Object.defineProperty(f(s),sr,{value:cr}),s.capabilities=void 0,s.onTick=void 0,s.onViewCreated=void 0,s.onViewDestroyed=void 0,s.scene=void 0,s.views=void 0,s.viewList=void 0,s.numViews=void 0,s.startTime=(new Date).getTime(),s.renderer=void 0,s.onTick=new e(new r),s.onViewCreated=new e(new r),s.onViewDestroyed=new e(new r),s.id=i.id||M(),s.viewList=[],s.numViews=0,s.views={},s.destroyed=!1,s.capabilities={maxViews:0,astcSupported:!1,etc1Supported:!1,etc2Supported:!1,dxtSupported:!1,bptcSupported:!1,pvrtcSupported:!1},s.scene=i.scene||new n,s.renderer=i.renderer,s.renderer.getCapabilities(s.capabilities),s.renderer.init(f(s)),qe.registerViewer(f(s)),s}u(s,t);var o=s.prototype;return o.createView=function(t){var e=this;if(this.viewList.length>=this.capabilities.maxViews)return new i(\"Attempted to create too many Views with View.createView() - maximum of \"+this.capabilities.maxViews+\" is allowed\");var r=t.id||M();if(this.views[r])return new i('View with ID \"'+r+'\" already exists');if(!((t.canvasElement||document.getElementById(t.canvasId))instanceof HTMLCanvasElement))return new i(\"Mandatory View config expected: valid canvasId or canvasElement\");var n=new Zi(function(t,e){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}({viewId:r,viewer:this},t));return b(this,or)[or](n),n.viewIndex=this.renderer.registerView(n),n.onDestroyed.one(function(){b(e,hr)[hr](n),e.renderer.deregisterView(n.viewIndex),e.onViewDestroyed.dispatch(e,n)}),this.onViewCreated.dispatch(this,n),this.log(\"View created: \"+n.viewId),n},o.redraw=function(){for(var t in this.views)this.views[t].redraw()},o.log=function(t){t=\"[LOG] \"+b(this,sr)[sr](t),window.console.log(t)},o.warn=function(t){t=\"[WARN] \"+b(this,sr)[sr](t),window.console.warn(t)},o.error=function(t){t=\"[ERROR] \"+b(this,sr)[sr](t),window.console.error(t)},o.destroy=function(){if(!this.destroyed){for(var t in qe.deregisterViewer(this),this.views)this.views[t].destroy();this.onTick.clear(),this.onViewCreated.clear(),this.onViewDestroyed.clear()}},o.render=function(t){for(var e=0;e<this.viewList.length;e++)this.renderer.render(e,{force:!0})},s}(t);function cr(t){return\" [\"+this.constructor.name+' \"'+x(this.id)+'\"]: '+t}function lr(t){if(!this.views[t.id]){this.views[t.id]=t;for(var e=0;;e++)if(!this.viewList[e])return this.viewList[e]=t,this.numViews++,void(t.viewIndex=e)}}function dr(t){this.views[t.id]&&(delete this.views[t.id],delete this.viewList[t.viewIndex],this.numViews--)}var ur=/*#__PURE__*/p(\"state\"),vr=/*#__PURE__*/p(\"inverseMatrixDirty\"),fr=/*#__PURE__*/p(\"transposedProjMatrixDirty\"),yr=/*#__PURE__*/function(t){function i(i,n){var s;return void 0===n&&(n={}),(s=t.call(this,i,n)||this).camera=void 0,s.onProjMatrix=void 0,Object.defineProperty(f(s),ur,{writable:!0,value:void 0}),Object.defineProperty(f(s),vr,{writable:!0,value:void 0}),Object.defineProperty(f(s),fr,{writable:!0,value:void 0}),s.camera=i,b(f(s),ur)[ur]={projMatrix:q(),inverseProjMatrix:q(),transposedProjMatrix:q(),near:.1,far:1e4,left:null!=n.left?n.left:-1,right:null!=n.right?n.right:1,bottom:null!=n.bottom?n.bottom:-1,top:null!=n.top?n.top:1},s.onProjMatrix=new e(new r),b(f(s),vr)[vr]=!0,b(f(s),fr)[fr]=!0,s}u(i,t);var n=i.prototype;return n.clean=function(){!function(t,e,i,r,n,s,o){o||(o=q());var h=e-t,a=r-i,c=s-n;o[0]=2*n/h,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*n/a,o[6]=0,o[7]=0,o[8]=(e+t)/h,o[9]=(r+i)/a,o[10]=-(s+n)/c,o[11]=-1,o[12]=0,o[13]=0,o[14]=-s*n*2/c,o[15]=0}(b(this,ur)[ur].left,b(this,ur)[ur].right,b(this,ur)[ur].bottom,b(this,ur)[ur].top,b(this,ur)[ur].near,b(this,ur)[ur].far,b(this,ur)[ur].projMatrix),b(this,vr)[vr]=!0,b(this,fr)[fr]=!0,this.camera.view.redraw(),this.onProjMatrix.dispatch(this,b(this,ur)[ur].projMatrix)},n.unproject=function(t,e,i,r,n){var s=this.camera.view.canvasElement,o=s.offsetWidth/2,h=s.offsetHeight/2;return i[0]=(t[0]-o)/o,i[1]=(t[1]-h)/h,i[2]=e,i[3]=1,J(this.inverseProjMatrix,i,r),z(r,1/r[3]),r[3]=1,r[1]*=-1,J(this.camera.inverseViewMatrix,r,n),n},n.destroy=function(){t.prototype.destroy.call(this),this.onProjMatrix.clear()},d(i,[{key:\"left\",get:function(){return b(this,ur)[ur].left},set:function(t){b(this,ur)[ur].left=t,this.setDirty()}},{key:\"right\",get:function(){return b(this,ur)[ur].right},set:function(t){b(this,ur)[ur].right=t,this.setDirty()}},{key:\"top\",get:function(){return b(this,ur)[ur].top},set:function(t){b(this,ur)[ur].top=t,this.setDirty()}},{key:\"bottom\",get:function(){return b(this,ur)[ur].bottom},set:function(t){b(this,ur)[ur].bottom=t,this.setDirty()}},{key:\"near\",get:function(){return b(this,ur)[ur].near},set:function(t){b(this,ur)[ur].near=t,this.setDirty()}},{key:\"far\",get:function(){return b(this,ur)[ur].far},set:function(t){b(this,ur)[ur].far=t,this.setDirty()}},{key:\"projMatrix\",get:function(){return this.dirty&&this.cleanIfDirty(),b(this,ur)[ur].projMatrix}},{key:\"inverseProjMatrix\",get:function(){return this.dirty&&this.cleanIfDirty(),b(this,vr)[vr]&&(Y(b(this,ur)[ur].projMatrix,b(this,ur)[ur].inverseProjMatrix),b(this,vr)[vr]=!1),b(this,ur)[ur].inverseProjMatrix}},{key:\"transposedProjMatrix\",get:function(){return this.dirty&&this.cleanIfDirty(),b(this,fr)[fr]&&($(b(this,ur)[ur].projMatrix,b(this,ur)[ur].transposedProjMatrix),b(this,fr)[fr]=!1),b(this,ur)[ur].transposedProjMatrix}}]),i}(t);yr.type=V;var pr=/*#__PURE__*/p(\"state\"),br=/*#__PURE__*/function(t){function e(e,i){var r;return void 0===i&&(i={}),(r=t.call(this,e,i)||this).view=void 0,Object.defineProperty(f(r),pr,{writable:!0,value:void 0}),r.view=e,b(f(r),pr)[pr]={type:\"ambient\",color:new Float32Array(i.color||[.7,.7,.7]),intensity:null!=i.intensity?i.intensity:1},r.view.registerLight(f(r)),r}return u(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this),this.view.deregisterLight(this)},d(e,[{key:\"color\",get:function(){return b(this,pr)[pr].color},set:function(t){b(this,pr)[pr].color.set(t),this.view.redraw()}},{key:\"intensity\",get:function(){return b(this,pr)[pr].intensity},set:function(t){b(this,pr)[pr].intensity=void 0!==t?t:1,this.view.redraw()}}]),e}(t),wr=/*#__PURE__*/p(\"state\"),jr=/*#__PURE__*/function(t){function e(e,i){var r;return void 0===i&&(i={}),(r=t.call(this,e,i)||this).view=void 0,Object.defineProperty(f(r),wr,{writable:!0,value:void 0}),r.view=e,b(f(r),wr)[wr]={type:\"dir\",dir:new Float32Array(i.dir||[1,1,1]),color:new Float32Array(i.color||[.7,.7,.8]),intensity:null!=i.intensity?i.intensity:1,space:i.space||\"view\"},r.view.registerLight(f(r)),r}return u(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this),this.view.deregisterLight(this),this.view.redraw()},d(e,[{key:\"dir\",get:function(){return b(this,wr)[wr].dir},set:function(t){b(this,wr)[wr].dir.set(t),this.view.redraw()}},{key:\"color\",get:function(){return b(this,wr)[wr].color},set:function(t){b(this,wr)[wr].color.set(t),this.view.redraw()}},{key:\"intensity\",get:function(){return b(this,wr)[wr].intensity},set:function(t){b(this,wr)[wr].intensity=t,this.view.redraw()}}]),e}(t),gr=/*#__PURE__*/p(\"state\"),Or=/*#__PURE__*/function(t){function e(e,i){var r;return void 0===i&&(i={}),(r=t.call(this,e,i)||this).view=void 0,Object.defineProperty(f(r),gr,{writable:!0,value:void 0}),r.view=e,b(f(r),gr)[gr]={type:\"point\",pos:new Float64Array(i.pos||[1,1,1]),color:new Float32Array(i.color||[.7,.7,.8]),intensity:1,attenuation:new Float32Array([i.constantAttenuation,i.linearAttenuation,i.quadraticAttenuation]),space:i.space||\"view\"},r.view.registerLight(f(r)),r}return u(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this),this.view.deregisterLight(this),this.view.redraw()},d(e,[{key:\"pos\",get:function(){return b(this,gr)[gr].pos},set:function(t){b(this,gr)[gr].pos.set(t||[1,1,1]),this.view.redraw()}},{key:\"color\",get:function(){return b(this,gr)[gr].color},set:function(t){b(this,gr)[gr].color.set(t||[.7,.7,.8]),this.view.redraw()}},{key:\"intensity\",get:function(){return b(this,gr)[gr].intensity},set:function(t){t!==b(this,gr)[gr].intensity&&(b(this,gr)[gr].intensity=t,this.view.redraw())}},{key:\"constantAttenuation\",get:function(){return b(this,gr)[gr].attenuation[0]},set:function(t){b(this,gr)[gr].attenuation[0]=t,this.view.redraw()}},{key:\"linearAttenuation\",get:function(){return b(this,gr)[gr].attenuation[1]},set:function(t){b(this,gr)[gr].attenuation[1]=t,this.view.redraw()}},{key:\"quadraticAttenuation\",get:function(){return b(this,gr)[gr].attenuation[2]},set:function(t){b(this,gr)[gr].attenuation[2]=t,this.view.redraw()}}]),e}(t),Pr=/*#__PURE__*/p(\"viewObject\"),mr=/*#__PURE__*/p(\"gotCanvasPos\"),kr=/*#__PURE__*/p(\"gotOrigin\"),xr=/*#__PURE__*/p(\"gotDirection\"),Mr=/*#__PURE__*/p(\"gotIndices\"),Ir=/*#__PURE__*/p(\"gotLocalPos\"),Ar=/*#__PURE__*/p(\"gotWorldPos\"),Dr=/*#__PURE__*/p(\"gotViewPos\"),Sr=/*#__PURE__*/p(\"gotWorldNormal\"),Vr=/*#__PURE__*/p(\"gotUV\"),Cr=/*#__PURE__*/p(\"canvasPos\"),Lr=/*#__PURE__*/p(\"origin\"),Ur=/*#__PURE__*/p(\"direction\"),Tr=/*#__PURE__*/p(\"indices\"),zr=/*#__PURE__*/p(\"localPos\"),Fr=/*#__PURE__*/p(\"worldPos\"),_r=/*#__PURE__*/p(\"viewPos\"),Rr=/*#__PURE__*/p(\"worldNormal\"),Wr=/*#__PURE__*/p(\"uv\"),Er=/*#__PURE__*/function(){function t(){Object.defineProperty(this,Pr,{writable:!0,value:void 0}),Object.defineProperty(this,mr,{writable:!0,value:void 0}),Object.defineProperty(this,kr,{writable:!0,value:void 0}),Object.defineProperty(this,xr,{writable:!0,value:void 0}),Object.defineProperty(this,Mr,{writable:!0,value:void 0}),Object.defineProperty(this,Ir,{writable:!0,value:void 0}),Object.defineProperty(this,Ar,{writable:!0,value:void 0}),Object.defineProperty(this,Dr,{writable:!0,value:void 0}),Object.defineProperty(this,Sr,{writable:!0,value:void 0}),Object.defineProperty(this,Vr,{writable:!0,value:void 0}),Object.defineProperty(this,Cr,{writable:!0,value:void 0}),Object.defineProperty(this,Lr,{writable:!0,value:void 0}),Object.defineProperty(this,Ur,{writable:!0,value:void 0}),Object.defineProperty(this,Tr,{writable:!0,value:void 0}),Object.defineProperty(this,zr,{writable:!0,value:void 0}),Object.defineProperty(this,Fr,{writable:!0,value:void 0}),Object.defineProperty(this,_r,{writable:!0,value:void 0}),Object.defineProperty(this,Rr,{writable:!0,value:void 0}),Object.defineProperty(this,Wr,{writable:!0,value:void 0}),b(this,Pr)[Pr]=null,b(this,Cr)[Cr]=new Int16Array([0,0]),b(this,Lr)[Lr]=new Float64Array([0,0,0]),b(this,Ur)[Ur]=new Float64Array([0,0,0]),b(this,Tr)[Tr]=new Int32Array(3),b(this,zr)[zr]=new Float64Array([0,0,0]),b(this,Fr)[Fr]=new Float64Array([0,0,0]),b(this,_r)[_r]=new Float64Array([0,0,0]),b(this,Rr)[Rr]=new Float64Array([0,0,0]),b(this,Wr)[Wr]=new Float64Array([0,0]),b(this,kr)[kr]=!1,b(this,xr)[xr]=!1,b(this,Mr)[Mr]=!1,b(this,mr)[mr]=!1,b(this,Ir)[Ir]=!1,b(this,Ar)[Ar]=!1,b(this,Dr)[Dr]=!1,b(this,Sr)[Sr]=!1,b(this,Vr)[Vr]=!1,this.reset()}return t.prototype.reset=function(){b(this,Pr)[Pr]=null,b(this,mr)[mr]=!1,b(this,kr)[kr]=!1,b(this,xr)[xr]=!1,b(this,Mr)[Mr]=!1,b(this,Ir)[Ir]=!1,b(this,Ar)[Ar]=!1,b(this,Dr)[Dr]=!1,b(this,Sr)[Sr]=!1,b(this,Vr)[Vr]=!1},d(t,[{key:\"viewObject\",get:function(){return b(this,Pr)[Pr]},set:function(t){b(this,Pr)[Pr]=t}},{key:\"canvasPos\",get:function(){return b(this,mr)[mr]?b(this,Cr)[Cr]:void 0},set:function(t){t?(b(this,Cr)[Cr][0]=t[0],b(this,Cr)[Cr][1]=t[1],b(this,mr)[mr]=!0):b(this,mr)[mr]=!1}},{key:\"origin\",get:function(){return b(this,kr)[kr]?b(this,Lr)[Lr]:null},set:function(t){t?(b(this,Lr)[Lr][0]=t[0],b(this,Lr)[Lr][1]=t[1],b(this,Lr)[Lr][2]=t[2],b(this,kr)[kr]=!0):b(this,kr)[kr]=!1}},{key:\"direction\",get:function(){return b(this,xr)[xr]?b(this,Ur)[Ur]:null},set:function(t){t?(b(this,Ur)[Ur][0]=t[0],b(this,Ur)[Ur][1]=t[1],b(this,Ur)[Ur][2]=t[2],b(this,xr)[xr]=!0):b(this,xr)[xr]=!1}},{key:\"indices\",get:function(){return b(this,Pr)[Pr]&&b(this,Mr)[Mr]?b(this,Tr)[Tr]:null},set:function(t){t?(b(this,Tr)[Tr][0]=t[0],b(this,Tr)[Tr][1]=t[1],b(this,Tr)[Tr][2]=t[2],b(this,Mr)[Mr]=!0):b(this,Mr)[Mr]=!1}},{key:\"localPos\",get:function(){return b(this,Pr)[Pr]&&b(this,Ir)[Ir]?b(this,zr)[zr]:null},set:function(t){t?(b(this,zr)[zr][0]=t[0],b(this,zr)[zr][1]=t[1],b(this,zr)[zr][2]=t[2],b(this,Ir)[Ir]=!0):b(this,Ir)[Ir]=!1}},{key:\"worldPos\",get:function(){return b(this,Pr)[Pr]&&b(this,Ar)[Ar]?b(this,Fr)[Fr]:null},set:function(t){t?(b(this,Fr)[Fr][0]=t[0],b(this,Fr)[Fr][1]=t[1],b(this,Fr)[Fr][2]=t[2],b(this,Ar)[Ar]=!0):b(this,Ar)[Ar]=!1}},{key:\"viewPos\",get:function(){return b(this,Pr)[Pr]&&b(this,Dr)[Dr]?b(this,_r)[_r]:null},set:function(t){t?(b(this,_r)[_r][0]=t[0],b(this,_r)[_r][1]=t[1],b(this,_r)[_r][2]=t[2],b(this,Dr)[Dr]=!0):b(this,Dr)[Dr]=!1}},{key:\"worldNormal\",get:function(){return b(this,Pr)[Pr]&&b(this,Sr)[Sr]?b(this,Rr)[Rr]:null},set:function(t){t?(b(this,Rr)[Rr][0]=t[0],b(this,Rr)[Rr][1]=t[1],b(this,Rr)[Rr][2]=t[2],b(this,Sr)[Sr]=!0):b(this,Sr)[Sr]=!1}},{key:\"uv\",get:function(){return b(this,Pr)[Pr]&&b(this,Vr)[Vr]?b(this,Wr)[Wr]:null},set:function(t){t?(b(this,Wr)[Wr][0]=t[0],b(this,Wr)[Wr][1]=t[1],b(this,Vr)[Vr]=!0):b(this,Vr)[Vr]=!1}}]),t}();export{br as AmbientLight,Ie as Camera,ki as CameraFlightAnimation,ie as CustomProjection,jr as DirLight,Wt as EdgeMaterial,_t as EmphasisMaterial,yr as FrustumProjection,lt as Metrics,Kt as OrthoProjection,Gt as PerspectiveProjection,Er as PickResult,Or as PointLight,Ht as PointsMaterial,ut as SAO,st as SectionPlane,Zi as View,Lt as ViewLayer,rt as ViewObject,ar as Viewer};\n//# sourceMappingURL=index.es.map\n","\n/**\n * @private\n */\nexport const RENDER_PASSES = {\n\n    // Skipped - suppress rendering\n\n    NOT_RENDERED: 0,\n\n    // Normal rendering - mutually exclusive modes\n\n    COLOR_OPAQUE: 1,\n    COLOR_TRANSPARENT: 2,\n\n    // Emphasis silhouette rendering - mutually exclusive modes\n\n    SILHOUETTE_HIGHLIGHTED: 3,\n    SILHOUETTE_SELECTED: 4,\n    SILHOUETTE_XRAYED: 5,\n\n    // Edges rendering - mutually exclusive modes\n\n    EDGES_COLOR_OPAQUE: 6,\n    EDGES_COLOR_TRANSPARENT: 7,\n    EDGES_HIGHLIGHTED: 8,\n    EDGES_SELECTED: 9,\n    EDGES_XRAYED: 10,\n\n    // Picking\n\n    PICK: 11\n};\n\n","import {createVec4} from \"@xeokit/matrix\";\nimport {OrthoProjectionType} from \"@xeokit/constants\";\nimport {AmbientLight, DirLight, PerspectiveProjection, PointLight} from \"@xeokit/viewer\";\n\nimport type {RenderContext} from \"./RenderContext\";\nimport {RENDER_PASSES} from \"./RENDER_PASSES\";\nimport type {Layer} from \"./Layer\";\nimport {GLProgram, GLSampler} from \"@xeokit/webglutils\";\n\nconst tempVec4 = createVec4();\n\n/**\n * @private\n */\nexport abstract class LayerRenderer {\n\n    /**\n     * Initialization error messages\n     */\n    errors: string[] | undefined;\n\n    protected renderContext: RenderContext;\n\n    #hash: string;\n    #program: GLProgram | null;\n    #needRebuild: boolean;\n\n    #uniforms: {\n        renderPass: WebGLUniformLocation,\n        viewMatrix: WebGLUniformLocation,\n        projMatrix: WebGLUniformLocation,\n        worldMatrix: WebGLUniformLocation,\n        sectionPlanes: {\n            pos: WebGLUniformLocation,\n            dir: WebGLUniformLocation,\n            active: WebGLUniformLocation\n        }[];\n        lights: {\n            pos?: WebGLUniformLocation,\n            dir?: WebGLUniformLocation,\n            color: WebGLUniformLocation,\n            attenuation?: WebGLUniformLocation\n        }[];\n        pickInvisible: WebGLUniformLocation;\n        pickZFar: WebGLUniformLocation;\n        pickZNear: WebGLUniformLocation;\n        pointCloudIntensityRange: WebGLUniformLocation;\n        nearPlaneHeight: WebGLUniformLocation;\n        pointSize: WebGLUniformLocation;\n        gammaFactor: WebGLUniformLocation;\n        logDepthBufFC: WebGLUniformLocation;\n        sao: WebGLUniformLocation;\n        lightAmbient: WebGLUniformLocation;\n        color: WebGLUniformLocation;\n    }\n\n    #samplers: {\n        viewMatrices: GLSampler;\n        positions: GLSampler;\n        indices: GLSampler;\n        edgeIndices: GLSampler;\n        eachMeshMatrices: GLSampler;\n        eachMeshAttributes: GLSampler;\n        //    eachMeshOffsets: GLSampler;\n        eachEdgeOffset: GLSampler;\n        eachPrimitiveMesh: GLSampler;\n        eachEdgeMesh: GLSampler;\n        baseColorMap: GLSampler;\n        metallicRoughMap: GLSampler;\n        emissiveMap: GLSampler;\n        normalMap: GLSampler;\n        occlusionMap: GLSampler;\n    };\n\n    protected constructor(renderContext: RenderContext) {\n        this.renderContext = renderContext;\n        this.#needRebuild = true;\n        this.#build();\n    }\n\n    #build(): void {\n\n        const view = this.renderContext.view;\n        const gl = this.renderContext.gl;\n\n        this.#program = new GLProgram(gl, this.#buildShader());\n\n        if (this.#program.errors) {\n            this.errors = this.#program.errors;\n            return;\n        }\n\n        const program = this.#program;\n\n        this.#uniforms = {\n            renderPass: program.getLocation(\"renderPass\"),\n            viewMatrix: program.getLocation(\"viewMatrix\"),\n            projMatrix: program.getLocation(\"projMatrix\"),\n            worldMatrix: program.getLocation(\"worldMatrix\"),\n            sao: program.getLocation(\"sao\"),\n            logDepthBufFC: program.getLocation(\"logDepthBufFC\"),\n            gammaFactor: program.getLocation(\"gammaFactor\"),\n            pointSize: program.getLocation(\"pointSize\"),\n            nearPlaneHeight: program.getLocation(\"nearPlaneHeight\"),\n            pointCloudIntensityRange: program.getLocation(\"pointCloudIntensityRange\"),\n            pickZNear: program.getLocation(\"pickZNear\"),\n            pickZFar: program.getLocation(\"pickZFar\"),\n            pickInvisible: program.getLocation(\"pickInvisible\"),\n            color: program.getLocation(\"color\"),\n            lightAmbient: program.getLocation(\"lightAmbient\"),\n            lights: [],\n            sectionPlanes: []\n        };\n\n        const uniforms = this.#uniforms;\n\n        const lights = view.lightsList;\n        for (let i = 0, len = lights.length; i < len; i++) {\n            const light: any = lights[i];\n            switch (light.type) {\n                case \"dir\":\n                    uniforms.lights.push({\n                        color: program.getLocation(\"lightColor\" + i),\n                        dir: program.getLocation(\"lightDir\" + i)\n                    });\n                    break;\n                case \"point\":\n                    uniforms.lights.push({\n                        color: program.getLocation(\"lightColor\" + i),\n                        pos: program.getLocation(\"lightPos\" + i),\n                        attenuation: program.getLocation(\"lightAttenuation\" + i)\n                    });\n                    break;\n                case \"spot\":\n                    uniforms.lights.push({\n                        color: program.getLocation(\"lightColor\" + i),\n                        pos: program.getLocation(\"lightPos\" + i),\n                        dir: program.getLocation(\"lightDir\" + i),\n                        attenuation: program.getLocation(\"lightAttenuation\" + i)\n                    });\n                    break;\n            }\n        }\n\n        for (let i = 0, len = view.sectionPlanesList.length; i < len; i++) {\n            uniforms.sectionPlanes.push({\n                active: program.getLocation(\"sectionPlaneActive\" + i),\n                pos: program.getLocation(\"sectionPlanePos\" + i),\n                dir: program.getLocation(\"sectionPlaneDir\" + i)\n            });\n        }\n\n        this.#samplers = {\n            viewMatrices: program.getSampler(\"viewMatrices\"),\n            positions: program.getSampler(\"positions\"),\n            indices: program.getSampler(\"indices\"),\n            edgeIndices: program.getSampler(\"edgeIndices\"),\n            eachMeshAttributes: program.getSampler(\"eachMeshAttributes\"),\n            eachMeshMatrices: program.getSampler(\"eachMeshMatrices\"),\n            eachEdgeOffset: program.getSampler(\"eachMeshOffset\"),\n            eachPrimitiveMesh: program.getSampler(\"eachMeshTriangleMesh\"),\n            eachEdgeMesh: program.getSampler(\"eachEdgeMesh\"),\n            baseColorMap: program.getSampler(\"baseColorMap\"),\n            metallicRoughMap: program.getSampler(\"metallicRoughMap\"),\n            emissiveMap: program.getSampler(\"emissiveMap\"),\n            normalMap: program.getSampler(\"normalMap\"),\n            occlusionMap: program.getSampler(\"occlusionMap\")\n        };\n\n        this.#hash = this.getHash();\n    }\n\n    #buildShader() {\n        return {\n            vertex: this.buildVertexShader(),\n            fragment: this.buildFragmentShader()\n        };\n    }\n\n    /**\n     * Generates vertex shader GLSL for the current View state\n     */\n    protected abstract buildVertexShader(): string;\n\n    /**\n     * Generates fragment shader GLSL for the current View state\n     */\n    protected abstract buildFragmentShader(): string;\n\n    /**\n     * Gets a hash for the View's current configuration as pertaining to the LayerRenderer.\n     */\n    protected abstract getHash(): string;\n\n    /**\n     * Indicates that the LayerRenderer may need to rebuild shaders\n     */\n    needRebuild() {\n        this.#needRebuild = true;\n    }\n\n    /**\n     * Gets if this LayerRenderer's configuration is still valid for the current View state.\n     */\n    #getValid() {\n        if (!this.#needRebuild) {\n            return true;\n        }\n        this.#needRebuild = false;\n        return this.#hash === this.getHash();\n    };\n\n    /**\n     * Draws the given Layer.\n     *\n     * @param layer The Layer to draw\n     */\n    draw(layer: Layer) {\n\n        if (this.#program && !this.#getValid()) {\n            this.#program.destroy();\n            this.#program = null;\n        }\n\n        if (!this.#program) {\n            this.#build();\n            if (this.errors) {\n                return;\n            }\n            this.renderContext.lastProgramId = -1;\n        }\n\n        const renderState = layer.renderState;\n        const program = this.#program;\n        const renderContext = this.renderContext;\n        const renderPass = renderContext.renderPass;\n        const gl = this.renderContext.gl;\n        const view = this.renderContext.view;\n        const uniforms = this.#uniforms;\n        const samplers = this.#samplers;\n\n        // @ts-ignore\n        if (renderContext.lastProgramId !== program.id) {\n            // @ts-ignore\n            renderContext.lastProgramId = program.id;\n            this.#bind();\n        }\n\n        if (uniforms.renderPass) {\n            gl.uniform1i(uniforms.renderPass, renderPass);\n        }\n\n        // if (uniforms.viewMatrix) {\n        //     //gl.uniformMatrix4fv(uniforms.viewMatrix, false, <Float32Array | GLfloat[]>layer.rtcViewMat.viewMatrix);\n        //     gl.uniformMatrix4fv(uniforms.viewMatrix, false, <Float32Array | GLfloat[]>view.camera.viewMatrix);\n        // }\n\n        if (uniforms.projMatrix) {\n            gl.uniformMatrix4fv(uniforms.projMatrix, false, <Float32Array | GLfloat[]>view.camera.projMatrix);\n        }\n\n        if (uniforms.worldMatrix) {\n            gl.uniformMatrix4fv(uniforms.worldMatrix, false, <Float32Array | GLfloat[]>layer.rendererModel.worldMatrix);\n        }\n\n        if (uniforms.color) {\n            if (renderPass === RENDER_PASSES.SILHOUETTE_XRAYED) {\n                const material = view.xrayMaterial;\n                const fillColor = material.fillColor;\n                const fillAlpha = material.fillAlpha;\n                gl.uniform4f(uniforms.color, fillColor[0], fillColor[1], fillColor[2], fillAlpha);\n\n            } else if (renderPass === RENDER_PASSES.SILHOUETTE_HIGHLIGHTED) {\n                const material = view.highlightMaterial;\n                const fillColor = material.fillColor;\n                const fillAlpha = material.fillAlpha;\n                gl.uniform4f(uniforms.color, fillColor[0], fillColor[1], fillColor[2], fillAlpha);\n\n            } else if (renderPass === RENDER_PASSES.SILHOUETTE_SELECTED) {\n                const material = view.selectedMaterial;\n                const fillColor = material.fillColor;\n                const fillAlpha = material.fillAlpha;\n                gl.uniform4f(uniforms.color, fillColor[0], fillColor[1], fillColor[2], fillAlpha);\n\n            } else {\n                gl.uniform4fv(uniforms.color, new Float32Array([1, 1, 1]));\n            }\n        }\n\n        // if (view.sectionPlanesList.length) {\n        //     const numSectionPlanes = view.sectionPlanesList.length;\n        //     const origin = layer.renderState.origin;\n        //     const sectionPlanes = view.sectionPlanesList;\n        //     const baseIndex = layer.layerIndex * numSectionPlanes;\n        //     const drawFlags = rendererModel.drawFlags;\n        //     for (let sectionPlaneIndex = 0; sectionPlaneIndex < numSectionPlanes; sectionPlaneIndex++) {\n        //         const sectionPlaneUniforms = this.#uniforms.sectionPlanes[sectionPlaneIndex];\n        //         if (sectionPlaneUniforms) {\n        //             const active = drawFlags.sectionPlanesActivePerLayer[baseIndex + sectionPlaneIndex];\n        //             gl.uniform1i(sectionPlaneUniforms.active, active ? 1 : 0);\n        //             if (active) {\n        //                 const sectionPlane = sectionPlanes[sectionPlaneIndex];\n        //                 if (origin) {\n        //                     const rtcSectionPlanePos = rtc.getPlaneRTCPos(sectionPlane.dist, sectionPlane.dir, origin, tempVec3a);\n        //                     gl.uniform3fv(sectionPlaneUniforms.pos, rtcSectionPlanePos);\n        //                 } else {\n        //                     gl.uniform3fv(sectionPlaneUniforms.pos, sectionPlane.pos);\n        //                 }\n        //                 gl.uniform3fv(sectionPlaneUniforms.dir, sectionPlane.dir);\n        //             }\n        //         }\n        //     }\n        // }\n\n        if (samplers.viewMatrices) {\n            // @ts-ignore\n            renderState.dataTextureSet.viewMatrices.bindTexture(program, samplers.viewMatrices, renderContext.nextTextureUnit);\n        }\n        if (samplers.positions) {\n            // @ts-ignore\n            renderState.dataTextureSet.positions.bindTexture(program, samplers.positions, renderContext.nextTextureUnit);\n        }\n        if (samplers.eachMeshMatrices) {\n            // @ts-ignore\n            renderState.dataTextureSet.eachMeshMatrices.bindTexture(program, samplers.eachMeshMatrices, renderContext.nextTextureUnit);\n        }\n        if (samplers.eachMeshAttributes) {\n            // @ts-ignore\n            renderState.dataTextureSet.eachMeshAttributes.bindTexture(program, samplers.eachMeshAttributes, renderContext.nextTextureUnit);\n        }\n        if (samplers.eachPrimitiveMesh) {\n            if (renderState.numIndices8Bits > 0) {\n                // @ts-ignore\n                renderState.dataTextureSet.eachPrimitiveMesh_8Bits.bindTexture(program, samplers.eachPrimitiveMesh, renderContext.nextTextureUnit);\n                // @ts-ignore\n                renderState.dataTextureSet.indices_8Bits.bindTexture(program, samplers.indices, renderContext.nextTextureUnit);\n                gl.drawArrays(gl.TRIANGLES, 0, renderState.numIndices8Bits);\n            }\n            if (renderState.numIndices16Bits > 0) {\n                // @ts-ignore\n                renderState.dataTextureSet.eachPrimitiveMesh_16Bits.bindTexture(program, samplers.eachPrimitiveMesh, renderContext.nextTextureUnit);\n                // @ts-ignore\n                renderState.dataTextureSet.indices_16Bits.bindTexture(program, samplers.indices, renderContext.nextTextureUnit);\n                gl.drawArrays(gl.TRIANGLES, 0, renderState.numIndices16Bits);\n            }\n            if (renderState.numIndices32Bits > 0) {\n                // @ts-ignore\n                renderState.dataTextureSet.eachPrimitiveMesh_32Bits.bindTexture(program, samplers.eachPrimitiveMesh, renderContext.nextTextureUnit);\n                // @ts-ignore\n                renderState.dataTextureSet.indices_32Bits.bindTexture(program, samplers.indices, renderContext.nextTextureUnit);\n                gl.drawArrays(gl.TRIANGLES, 0, renderState.numIndices32Bits);\n            }\n        }\n        if (samplers.baseColorMap) {\n            samplers.baseColorMap.bindTexture(renderState.materialTextureSet.colorTexture.texture2D, renderContext.nextTextureUnit);\n        }\n        if (samplers.metallicRoughMap) {\n            samplers.metallicRoughMap.bindTexture(renderState.materialTextureSet.metallicRoughnessTexture.texture2D, renderContext.nextTextureUnit);\n        }\n        if (samplers.emissiveMap) {\n            samplers.emissiveMap.bindTexture(renderState.materialTextureSet.emissiveTexture.texture2D, renderContext.nextTextureUnit);\n        }\n        if (samplers.occlusionMap) {\n            samplers.occlusionMap.bindTexture(renderState.materialTextureSet.occlusionTexture.texture2D, renderContext.nextTextureUnit);\n        }\n    }\n\n    #bind() {\n\n        const view = this.renderContext.view;\n        const gl = this.renderContext.gl;\n        const uniforms = this.#uniforms;\n        const project = view.camera.project;\n\n        // @ts-ignore\n        this.#program.bind();\n        // if (this.#uProjMatrix) {\n        //     gl.uniformMatrix4fv(this.#uProjMatrix, false, project.matrix);\n        // }\n        if (uniforms.lightAmbient) {      // @ts-ignore\n            gl.uniform4fv(uniforms.lightAmbient, view.getAmbientColorAndIntensity());\n        }\n        for (let i = 0, len = uniforms.lights.length; i < len; i++) {\n            const fragLightSourceUniforms = uniforms.lights[i];\n            const light = view.lightsList[i];\n            if (fragLightSourceUniforms.color) {\n                gl.uniform4f(fragLightSourceUniforms.color, light.color[0], light.color[1], light.color[2], light.intensity);\n            }\n            if (fragLightSourceUniforms.dir) { // @ts-ignore\n                gl.uniform3f(fragLightSourceUniforms.dir, light.dir[0], light.dir[1], light.dir[2]);\n            }\n            if (fragLightSourceUniforms.pos) { // @ts-ignore\n                gl.uniform3f(fragLightSourceUniforms.pos, light.pos[0], light.pos[1], light.pos[2]);\n            }\n            if (fragLightSourceUniforms.attenuation) { // @ts-ignore\n                gl.uniform1f(fragLightSourceUniforms.attenuation, light.attenuation);\n            }\n        }\n        if (uniforms.sao) {\n            const sao = view.sao;\n            const saoEnabled = sao.possible;\n            if (saoEnabled) {\n                const viewportWidth = gl.drawingBufferWidth;\n                const viewportHeight = gl.drawingBufferHeight;\n                tempVec4[0] = viewportWidth;\n                tempVec4[1] = viewportHeight;\n                tempVec4[2] = sao.blendCutoff;\n                tempVec4[3] = sao.blendFactor;\n                // @ts-ignore\n                gl.uniform4fv(uniforms.sao, tempVec4);\n                // program.bindTexture(this.#uOcclusionTexture, renderContext.occlusionTexture, 0);\n            }\n        }\n        if (uniforms.gammaFactor) {\n            gl.uniform1f(uniforms.gammaFactor, view.gammaFactor);\n        }\n        if (uniforms.pointSize) {\n            gl.uniform1f(uniforms.pointSize, view.pointsMaterial.pointSize);\n        }\n        if (uniforms.nearPlaneHeight) {\n            gl.uniform1f(uniforms.nearPlaneHeight, (view.camera.projectionType === OrthoProjectionType) ? 1.0 : (gl.drawingBufferHeight / (2 * Math.tan(0.5 * view.camera.perspectiveProjection.fov * Math.PI / 180.0))));\n        }\n        if (uniforms.pickZNear) {\n            gl.uniform1f(uniforms.pickZNear, this.renderContext.pickZNear);\n            gl.uniform1f(uniforms.pickZFar, this.renderContext.pickZFar);\n        }\n        if (uniforms.pickInvisible) {\n            gl.uniform1i(uniforms.pickInvisible, this.renderContext.pickInvisible ? 1 : 0);\n        }\n        if (uniforms.logDepthBufFC) {\n            const logDepthBufFC = 2.0 / (Math.log((project as PerspectiveProjection).far + 1.0) / Math.LN2);\n            gl.uniform1f(uniforms.logDepthBufFC, logDepthBufFC);\n        }\n    }\n\n    // protected get vertexShader(): string {\n    //     return `${this.vertHeader}\n    //     ${this.vertDataTextureDefs}\n    //     ${this.vertLogDepthBufDefs}\n    //     void main(void) {\n    //             ${this.vertDataTextureSamples}\n    //             ${this.vertLogDepthBufOutputs}\n    //     }`;\n    // }\n\n    protected get vertHeader(): string {\n        return `#version 300 es\n                #ifdef GL_FRAGMENT_PRECISION_HIGH\n                precision highp float;\n                precision highp int;\n                precision highp usampler2D;\n                precision highp isampler2D;\n                precision highp sampler2D;\n                #else\n                precision mediump float;\n                precision mediump int;\n                precision mediump usampler2D;\n                precision mediump isampler2D;\n                precision mediump sampler2D;\n                uniform int renderPass;\n                #endif`;\n    }\n\n    protected get vertDataTextureDefs(): string {\n        return `uniform mediump sampler2D eachMeshMatrices;\n                uniform lowp usampler2D eachMeshAttributes;\n                uniform highp sampler2D eachMeshOffset;\n                uniform mediump usampler2D positions;\n                uniform highp usampler2D indices;\n                uniform mediump usampler2D eachPrimitiveMesh;\n                uniform highp sampler2D cameraMatrices;\n                uniform highp sampler2D sceneModelRendererMatrices;`;\n    }\n\n    protected get vertLogDepthBufDefs(): string {\n        if (this.renderContext.view.logarithmicDepthBufferEnabled) {\n            return `uniform float logDepthBufFC;\n                    out float fragDepth;\n                    bool isPerspectiveMatrix(mat4 m) {\n                        return (m[2][3] == - 1.0);\n                    }\n                    out float isPerspective;`;\n        } else {\n            return \"\"\n        }\n    }\n\n    protected get vertDataTextureSamples(): string {\n        return \"\";\n    }\n\n    protected get vertLogDepthBufOutputs(): string {\n        if (this.renderContext.view.logarithmicDepthBufferEnabled) {\n            return `fragDepth = 1.0 + clipPos.w;\n                    isPerspective = float (isPerspectiveMatrix(projMatrix));`;\n        } else {\n            return \"\"\n        }\n    }\n\n    protected get fragmentShader(): string {\n        return `${this.fragHeader}\n        ${this.fragGammaDefs}\n        ${this.fragSectionPlaneDefs}\n        ${this.fragLightDefs}\n        ${this.fragLogDepthBufDefs}\n        void main(void) {\n            ${this.fragSectionPlanesSlice}\n            ${this.fragLighting}\n            ${this.fragLogDepthBufOutput}\n        }`;\n    }\n\n    protected get fragHeader(): string {\n        return `#version 300 es\n        #ifdef GL_FRAGMENT_PRECISION_HIGH\n       precision highp float;\n        precision highp int;\n        #else\n        precision mediump float;\n        precision mediump int;\n        #endif`;\n    }\n\n    protected get fragGammaDefs(): string {\n        return `uniform float gammaFactor;\n        vec4 linearToLinear( in vec4 value ) {\n            return value;\n        }\n        vec4 sRGBToLinear( in vec4 value ) {\n            return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n        }\n        vec4 gammaToLinear( in vec4 value) {\n            return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n        }\n        vec4 linearToGamma( in vec4 value, in float gammaFactor ) {\n              return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\");\n        }`;\n    }\n\n    protected get fragLightDefs(): string {\n        const view = this.renderContext.view;\n        const src = [];\n        src.push(\"uniform vec4 lightAmbient;\");\n        for (let i = 0, len = view.lightsList.length; i < len; i++) {\n            const light: any = view.lightsList[i];\n            if (light.type === \"ambient\") {\n                continue;\n            }\n            src.push(\"uniform vec4 lightColor\" + i + \";\");\n            if (light.type === \"dir\") {\n                src.push(\"uniform vec3 lightDir\" + i + \";\");\n            }\n            if (light.type === \"point\") {\n                src.push(\"uniform vec3 lightPos\" + i + \";\");\n            }\n            if (light.type === \"spot\") {\n                src.push(\"uniform vec3 lightPos\" + i + \";\");\n                src.push(\"uniform vec3 lightDir\" + i + \";\");\n            }\n        }\n        return src.join(\"\\n\");\n    }\n\n    protected get fragLogDepthBufDefs(): string {\n        if (this.renderContext.view.logarithmicDepthBufferEnabled) {\n            return `in float isPerspective;\n                    uniform float logDepthBufFC;\n                    in float fragDepth;`;\n        } else {\n            return \"\"\n        }\n    }\n\n    protected get fragLogDepthBufOutput(): string {\n        if (this.renderContext.view.logarithmicDepthBufferEnabled) {\n            return \"gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( fragDepth ) * logDepthBufFC * 0.5;\";\n        } else {\n            return \"\"\n        }\n    }\n\n    protected get fragLighting(): string {\n        const src = [];\n        src.push(\"vec4 viewPosition  = viewMatrix * worldPosition; \");\n        src.push(\"vec4 modelNormal = vec4(octDecode(normal.xy), 0.0); \");\n        src.push(\"vec4 worldNormal = worldNormalMatrix * vec4(dot(modelNormal, modelNormalMatrixCol0), dot(modelNormal, modelNormalMatrixCol1), dot(modelNormal, modelNormalMatrixCol2), 0.0);\");\n        src.push(\"vec3 viewNormal = normalize(vec4(viewNormalMatrix * worldNormal).xyz);\");\n        src.push(\"vec3 reflectedColor = vec3(0.0, 0.0, 0.0);\");\n        src.push(\"vec3 viewLightDir = vec3(0.0, 0.0, -1.0);\");\n        src.push(\"float lambertian = 1.0;\");\n\n        for (let i = 0, len = this.renderContext.view.lightsList.length; i < len; i++) {\n            const light: any = this.renderContext.view.lightsList[i];\n            if (light.type === \"ambient\") {\n                continue;\n            }\n            if (light.type === \"dir\") {\n                if (light.space === \"view\") {\n                    src.push(\"viewLightDir = normalize(lightDir\" + i + \");\");\n                } else {\n                    src.push(\"viewLightDir = normalize((viewMatrix * vec4(lightDir\" + i + \", 0.0)).xyz);\");\n                }\n            } else if (light.type === \"point\") {\n                if (light.space === \"view\") {\n                    src.push(\"viewLightDir = -normalize(lightPos\" + i + \" - viewPosition.xyz);\");\n                } else {\n                    src.push(\"viewLightDir = -normalize((viewMatrix * vec4(lightPos\" + i + \", 0.0)).xyz);\");\n                }\n            } else if (light.type === \"spot\") {\n                if (light.space === \"view\") {\n                    src.push(\"viewLightDir = normalize(lightDir\" + i + \");\");\n                } else {\n                    src.push(\"viewLightDir = normalize((viewMatrix * vec4(lightDir\" + i + \", 0.0)).xyz);\");\n                }\n            } else {\n                continue;\n            }\n            src.push(\"lambertian = max(dot(-viewNormal, viewLightDir), 0.0);\");\n            src.push(\"reflectedColor += lambertian * (lightColor\" + i + \".rgb * lightColor\" + i + \".a);\");\n        }\n        src.push(\"vec3 rgb = (vec3(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0));\");\n        src.push(\"meshColor =  vec4((lightAmbient.rgb * lightAmbient.a * rgb) + (reflectedColor * rgb), float(color.a) / 255.0);\");\n\n        return src.join(\"\\n\");\n    }\n\n    protected get fragSAOOutput(): string {\n        if (this.renderContext.view.sao.enabled) {\n            // Doing SAO blend in the main solid fill draw shader just so that edge lines can be drawn over the top\n            // Would be more efficient to defer this, then render lines later, using same depth buffer for Z-reject\n            return `float viewportWidth     = uSAOParams[0];\n                    float viewportHeight    = uSAOParams[1];\n                    float blendCutoff       = uSAOParams[2];\n                    float blendFactor       = uSAOParams[3];\n                    vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);\n                    float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture(uOcclusionTexture, uv))) * blendFactor;\n                    outColor                = vec4(fragColor.rgb * ambient, 1.0);`;\n        } else {\n            return `outColor            = fragColor;`;\n        }\n    }\n\n    protected get fragOutput(): string {\n        return `outColor            = fragColor;`;\n    }\n\n\n    protected get fragSectionPlaneDefs(): string {\n        const src = [];\n        src.push(`in vec4 worldPosition;\n                  in vec4 meshFlags2;`);\n        for (let i = 0, len = this.renderContext.view.sectionPlanesList.length; i < len; i++) {\n            src.push(`uniform bool sectionPlaneActive${i};\n                      uniform vec3 sectionPlanePos${i};\n                      uniform vec3 sectionPlaneDir${i};`);\n        }\n        return src.join(\"\\n\");\n    }\n\n    protected get fragLightSourceUniforms(): string {\n        const src = [];\n        src.push(`uniform vec4 lightAmbient;`);\n        for (let i = 0, len = this.renderContext.view.lightsList.length; i < len; i++) {\n            const light = this.renderContext.view.lightsList[i];\n            if (light instanceof AmbientLight) {\n                continue;\n            }\n            src.push(`uniform vec4 lightColor${i};`);\n            if (light instanceof DirLight) {\n                src.push(`uniform vec3 lightDir${i};`);\n            }\n            if (light instanceof PointLight) {\n                src.push(`uniform vec3 lightPos${i};`);\n            }\n        }\n        return src.join(\"\\n\");\n    }\n\n    protected get fragSectionPlanesSlice(): string {\n        const src = [];\n        const clipping = (this.renderContext.view.sectionPlanesList.length > 0);\n        if (clipping) {\n            src.push(`bool clippable = (float(meshFlags2.x) > 0.0);\n                      if (clippable) {\n                          float dist = 0.0;`);\n            for (let i = 0, len = this.renderContext.view.sectionPlanesList.length; i < len; i++) {\n                src.push(`if (sectionPlaneActive${i}) {\n                              dist += clamp(dot(-sectionPlaneDir${i}.xyz, worldPosition.xyz - sectionPlanePos${i}.xyz), 0.0, 1000.0);\n                          }`);\n            }\n            src.push(`if (dist > 0.0) { \n                          discard;\n                      }\n                  }`);\n        }\n        return src.join(\"\\n\");\n    }\n\n    protected get fragFlatShading(): string {\n        const src = [];\n        src.push(\"\");\n        return src.join(\"\\n\");\n    }\n\n    destroy() {\n        if (this.#program) {\n            this.#program.destroy();\n        }\n        this.#program = null;\n    }\n}\n","import {LayerRenderer} from \"./LayerRenderer\";\nimport type {RenderContext} from \"./RenderContext\";\n\nexport class FastColorTrianglesRenderer extends LayerRenderer {\n\n    constructor(renderContext: RenderContext) {\n        super(renderContext);\n    }\n\n    getHash(): string {\n        return `${this.renderContext.view.getSectionPlanesHash()}-${this.renderContext.view.getLightsHash()}`;\n    }\n\n    buildVertexShader(): string {\n        return `${this.vertHeader}   \n        \n                uniform int                 renderPass;   \n            \n                uniform highp   mat4        projMatrix;\n                uniform highp   mat4        worldMatrix;\n                      \n                uniform mediump sampler2D   viewMatrices;\n                           \n                uniform mediump usampler2D  eachPrimitiveMesh;\n                uniform lowp    usampler2D  eachMeshAttributes;\n                \n                uniform mediump sampler2D   eachMeshMatrices;\n                uniform mediump usampler2D  positions;\n                uniform highp   usampler2D  indices;\n                \n                uniform  float  logDepthBufFC;\n                 \n                out vec4        worldPosition;\n                flat out uint   meshFlags2r;                       \n                flat out uvec4  meshColor;\n                out float       fragDepth;\n                \n                bool isPerspectiveMatrix(mat4 m) {\n                    return (m[2][3] == - 1.0);\n                }\n                \n                out float isPerspective;\n                    \n                void main(void) {\n                                   \n                    int triangleIndex      = gl_VertexID / 3;\n                    \n                    int hPackedMeshIdIndex = (triangleIndex >> 3) & 1023;\n                    int vPackedMeshIdIndex = (triangleIndex >> 3) >> 10;\n                    \n                    int meshIndex          = int(texelFetch(eachPrimitiveMesh, ivec2(hPackedMeshIdIndex, vPackedMeshIdIndex), 0).r);                   \n                    uvec4 meshFlags        = texelFetch (eachMeshAttributes, ivec2(2, meshIndex), 0);\n\n                    if (int(meshFlags.x) != renderPass) {\n                        gl_Position = vec4(3.0, 3.0, 3.0, 1.0);\n                        return;\n                    } \n                 \n                    uvec4 meshFlags2 = texelFetch (eachMeshAttributes, ivec2(3, meshIndex), 0);\n\n                    ivec4 packedVertexBase = ivec4(texelFetch (eachMeshAttributes, ivec2(4, meshIndex), 0));\n                    ivec4 packedIndexBaseOffset = ivec4(texelFetch (eachMeshAttributes, ivec2(5, meshIndex), 0));\n                    int indexBaseOffset =   (packedIndexBaseOffset.r << 24) + \n                                            (packedIndexBaseOffset.g << 16) + \n                                            (packedIndexBaseOffset.b << 8) + \n                                            (packedIndexBaseOffset.a);\n\n                    int hIndex = (triangleIndex - indexBaseOffset) & 1023;\n                    int vIndex = (triangleIndex - indexBaseOffset) >> 10;\n\n                    ivec3 vertexIndices = ivec3(texelFetch(indices, ivec2(hIndex, vIndex), 0));\n                    ivec3 uniqueVertexIndexes = vertexIndices + (packedVertexBase.r << 24) + (packedVertexBase.g << 16) + (packedVertexBase.b << 8) + packedVertexBase.a;\n\n                    ivec3 indexPositionH = uniqueVertexIndexes & 1023;\n                    ivec3 indexPositionV = uniqueVertexIndexes >> 10;\n\n                    mat4 positionsDecompressMatrix = mat4 (\n                        texelFetch (eachMeshMatrices, ivec2(0, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(1, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(2, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(3, meshIndex), 0));\n                        \n                    mat4 meshMatrix = mat4 (\n                        texelFetch (eachMeshMatrices, ivec2(4, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(5, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(6, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(7, meshIndex), 0));\n\n                    ivec4 packedViewMatrixIndex = ivec4(texelFetch (eachMeshAttributes, ivec2(7, meshIndex), 0));\n                    int viewMatrixIndex = \n                            (packedViewMatrixIndex.r << 24) + \n                            (packedViewMatrixIndex.g << 16) + \n                            (packedViewMatrixIndex.b << 8) + \n                            (packedViewMatrixIndex.a);\n                   \n                    mat4 viewMatrix = mat4 (\n                        texelFetch (viewMatrices, ivec2(4, viewMatrixIndex), 0), \n                        texelFetch (viewMatrices, ivec2(5, viewMatrixIndex), 0), \n                        texelFetch (viewMatrices, ivec2(6, viewMatrixIndex), 0), \n                        texelFetch (viewMatrices, ivec2(7, viewMatrixIndex), 0));\n\n                    vec3 _positions[3];\n                   \n                    _positions[0] = vec3(texelFetch(positions, ivec2(indexPositionH.r, indexPositionV.r), 0));\n                    _positions[1] = vec3(texelFetch(positions, ivec2(indexPositionH.g, indexPositionV.g), 0));\n                    _positions[2] = vec3(texelFetch(positions, ivec2(indexPositionH.b, indexPositionV.b), 0));\n  \n                    vec3  position       = _positions[gl_VertexID % 3];\n                   \n                    vec4  _worldPosition = worldMatrix * ((meshMatrix * positionsDecompressMatrix) * vec4(position, 1.0)); \n                    vec4  viewPosition   = viewMatrix * _worldPosition;                   \n                    vec4  clipPosition   = projMatrix * viewPosition;\n\n                    meshFlags2r     = meshFlags2.r;                     \n                    meshColor       = texelFetch (eachMeshAttributes, ivec2(0, meshIndex), 0);                          \n                    fragDepth       = 1.0 + clipPosition.w;\n                    isPerspective   = float (isPerspectiveMatrix(projMatrix));\n                    worldPosition   = _worldPosition;                                               \n                    \n                    gl_Position     = clipPosition;\n                }`;\n    }\n\n    buildFragmentShader(): string {\n        return `${this.fragHeader}                        \n    \n             flat   in uvec4    meshColor;\n                in float        fragDepth;\n                in float        isPerspective;    \n                flat in uint    meshFlags2r;        \n                uniform float   logDepthBufFC;                        \n    \n                ${this.fragSectionPlaneDefs}                  \n                ${this.fragLightSourceUniforms}                                                             \n    \n                out vec4 outColor;        \n    \n                void main(void) {         \n                \n                // src.push(\"float lambertian = 1.0;\");\n                // \n                //  vec3 xTangent = dFdx( vViewPosition.xyz );\n                //  vec3 yTangent = dFdy( vViewPosition.xyz );\n                // \n                //  vec3 viewNormal = normalize( cross( xTangent, yTangent ) );        \n    \n                    ${this.fragSectionPlanesSlice}                                    \n                    ${this.fragFlatShading}     \n          \n                    outColor = vec4(meshColor);                   \n                    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( fragDepth ) * logDepthBufFC * 0.5;                        \n                }`;\n    }\n\n    // get lambertianLighting() : string{\n    //     const src = [];\n    //     src.push(\"createVec3 reflectedColor = createVec3(0.0, 0.0, 0.0);\");\n    //     src.push(\"createVec3 viewLightDir = createVec3(0.0, 0.0, -1.0);\");\n    //     src.push(\"float lambertian = 1.0;\");\n    //     for (let i = 0, len = this.view.lightsList.length; i < len; i++) {\n    //         const light = this.view.lightsList[i];\n    //         if (light.type === \"ambient\") {\n    //             continue;\n    //         }\n    //         if (light.type === \"dir\") {\n    //             src.push(\"viewLightDir = normalize((viewMatrix * createVec4(lightDir\" + i + \", 0.0)).xyz);\");\n    //         } else {\n    //             continue;\n    //         }\n    //         src.push(\"lambertian = max(dot(-viewNormal, viewLightDir), 0.0);\");\n    //         src.push(\"reflectedColor += lambertian * (lightColor\" + i + \".rgb * lightColor\" + i + \".a);\");\n    //     }\n    //     return src.join(\"\\n\");\n    // }\n\n}","import{createVec3 as t,createMat4 as n,subVec3 as r,lenVec3 as e,createVec2 as o,mulMat4 as i}from\"@xeokit/matrix\";import{newFloatArray as u,MAX_DOUBLE as f,MIN_DOUBLE as a}from\"@xeokit/math\";import{decompressPoint3 as s}from\"@xeokit/compression\";var c=t(),v=t(),l=n();function h(t){return new Float64Array(t||6)}function m(t){return new Int16Array(t||6)}function p(t){return u(t||4)}function x(t){return u(t||32)}function d(t){return u(t||16)}function V(t,n,r,e){return u([t,n,r,e])}function w(t,n,r){var e;void 0===r&&(r=n);var o,i,u,f=n.length,a=t[0],s=t[1],c=t[2],v=t[3],l=t[4],h=t[5],m=t[6],p=t[7],x=t[8],d=t[9],V=t[10],w=t[11],g=t[12],k=t[13],y=t[14],M=t[15];for(e=0;e<f;e+=4)r[e+0]=a*(o=n[e+0])+l*(i=n[e+1])+x*(u=n[e+2])+g,r[e+1]=s*o+h*i+d*u+k,r[e+2]=c*o+m*i+V*u+y,r[e+3]=v*o+p*i+w*u+M;return r}function g(t,n){return t[0]<=n[0]&&n[3]<=t[3]&&t[1]<=n[1]&&t[2]<=n[2]}function k(t,n){return t[0]<=n[0]&&n[3]<=t[3]&&t[1]<=n[1]&&n[4]<=t[4]&&t[2]<=n[2]&&n[5]<=t[5]}var y,M,b,A=(y=u(3),M=u(3),b=u(3),function(t){return y[0]=t[0],y[1]=t[1],y[2]=t[2],M[0]=t[3],M[1]=t[4],M[2]=t[5],r(M,y,b),Math.abs(e(b))}),q=function(){var t=u(3),n=u(3),o=u(3);return function(i,u){t[0]=i[0],t[1]=i[1],t[2]=i[2],n[0]=i[3],n[1]=i[4],n[2]=i[5];var f=r(n,t,o),a=u[0]-i[0],s=i[3]-u[0],c=u[1]-i[1],v=i[4]-u[1],l=u[2]-i[2],h=i[5]-u[2];return f[0]+=a>s?a:s,f[1]+=c>v?c:v,f[2]+=l>h?l:h,Math.abs(e(f))}}();function F(t){return(t[3]-t[0])*(t[4]-t[1])*(t[5]-t[2])}function I(n,r){return void 0===r&&(r=t()),r[0]=(n[0]+n[3])/2,r[1]=(n[1]+n[4])/2,r[2]=(n[2]+n[5])/2,r}function j(t,n){return void 0===n&&(n=o()),n[0]=(t[2]+t[0])/2,n[1]=(t[3]+t[1])/2,n}function z(t){return void 0===t&&(t=h()),t[0]=f,t[1]=f,t[2]=f,t[3]=a,t[4]=a,t[5]=a,t}function B(t){return void 0===t&&(t=m()),t[0]=65535,t[1]=65535,t[2]=65535,t[3]=-65535,t[4]=-65535,t[5]=-65535,t}function C(t,n){return void 0===t&&(t=h()),void 0===n&&(n=x()),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1,n[4]=t[3],n[5]=t[1],n[6]=t[2],n[7]=1,n[8]=t[3],n[9]=t[4],n[10]=t[2],n[11]=1,n[12]=t[0],n[13]=t[4],n[14]=t[2],n[15]=1,n[16]=t[0],n[17]=t[1],n[18]=t[5],n[19]=1,n[20]=t[3],n[21]=t[1],n[22]=t[5],n[23]=1,n[24]=t[3],n[25]=t[4],n[26]=t[5],n[27]=1,n[28]=t[0],n[29]=t[4],n[30]=t[5],n[31]=1,n}function D(t,n){return t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]>n[2]&&(t[2]=n[2]),t[3]<n[3]&&(t[3]=n[3]),t[4]<n[4]&&(t[4]=n[4]),t[5]<n[5]&&(t[5]=n[5]),t}function E(t,n){return t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[3]<n[3]&&(t[3]=n[3]),t[4]<n[4]&&(t[4]=n[4]),t}function G(t,n){return t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]>n[2]&&(t[2]=n[2]),t[3]<n[0]&&(t[3]=n[0]),t[4]<n[1]&&(t[4]=n[1]),t[5]<n[2]&&(t[5]=n[2]),t}function H(t,n){return t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[3]<n[0]&&(t[3]=n[0]),t[4]<n[1]&&(t[4]=n[1]),t}function J(t,n){for(var r,e,o,i=0,u=n.length;i<u;i+=3)e=n[i+1],o=n[i+2],t[0]>(r=n[i])&&(t[0]=r),t[1]>e&&(t[1]=e),t[2]>o&&(t[2]=o),t[3]<r&&(t[3]=r),t[4]<e&&(t[4]=e),t[5]<o&&(t[5]=o);return t}function K(t,n){return void 0===n&&(n=x()),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1,n[4]=t[3],n[5]=t[1],n[6]=t[2],n[7]=1,n[8]=t[3],n[9]=t[4],n[10]=t[2],n[11]=1,n[12]=t[0],n[13]=t[4],n[14]=t[2],n[15]=1,n[16]=t[0],n[17]=t[1],n[18]=t[5],n[19]=1,n[20]=t[3],n[21]=t[1],n[22]=t[5],n[23]=1,n[24]=t[3],n[25]=t[4],n[26]=t[5],n[27]=1,n[28]=t[0],n[29]=t[4],n[30]=t[5],n[31]=1,n}var L,N=(L=u(3),function(t,n,r){n=n||h();for(var e,o,i,u=f,c=f,v=f,l=a,m=a,p=a,x=0,d=t.length;x<d;x+=3)r?(L[0]=t[x+0],L[1]=t[x+1],L[2]=t[x+2],s(L,r,L),e=L[0],o=L[1],i=L[2]):(e=t[x+0],o=t[x+1],i=t[x+2]),e<u&&(u=e),o<c&&(c=o),i<v&&(v=i),e>l&&(l=e),o>m&&(m=o),i>p&&(p=i);return n[0]=u,n[1]=c,n[2]=v,n[3]=l,n[4]=m,n[5]=p,n});function O(t,n){void 0===n&&(n=h());for(var r,e,o,i=f,u=f,s=f,c=a,v=a,l=a,m=0,p=t.length;m<p;m+=4)(r=t[m+0])<i&&(i=r),(e=t[m+1])<u&&(u=e),(o=t[m+2])<s&&(s=o),r>c&&(c=r),e>v&&(v=e),o>l&&(l=o);return n[0]=i,n[1]=u,n[2]=s,n[3]=c,n[4]=v,n[5]=l,n}function P(t,n){void 0===n&&(n=h());for(var r,e,o,i=f,u=f,s=f,c=a,v=a,l=a,m=0,p=t.length;m<p;m++)(r=t[m][0])<i&&(i=r),(e=t[m][1])<u&&(u=e),(o=t[m][2])<s&&(s=o),r>c&&(c=r),e>v&&(v=e),o>l&&(l=o);return n[0]=i,n[1]=u,n[2]=s,n[3]=c,n[4]=v,n[5]=l,n}function Q(n,r){void 0===r&&(r=t());for(var e=0,o=0,i=0,u=0,f=n.length;u<f;u+=3)e+=n[u+0],o+=n[u+1],i+=n[u+2];var a=n.length/3;return r[0]=e/a,r[1]=o/a,r[2]=i/a,r}var R=/*#__PURE__*/function(){function n(){this.testVertex=void 0,this.offset=void 0,this.normal=void 0,this.normal=t(),this.offset=0,this.testVertex=t()}return n.prototype.set=function(t,n,r,e){var o=1/Math.sqrt(t*t+n*n+r*r);this.normal[0]=t*o,this.normal[1]=n*o,this.normal[2]=r*o,this.offset=e*o,this.testVertex[0]=this.normal[0]>=0?1:0,this.testVertex[1]=this.normal[1]>=0?1:0,this.testVertex[2]=this.normal[2]>=0?1:0},n}(),S=1,T=2,U=3,W=function(){this.planes=void 0,this.planes=[new R,new R,new R,new R,new R,new R]};function X(t,n,r){var e=i(n,t,l),o=e[0],u=e[1],f=e[2],a=e[3],s=e[4],c=e[5],v=e[6],h=e[7],m=e[8],p=e[9],x=e[10],d=e[11],V=e[12],w=e[13],g=e[14],k=e[15];return(r=r||new W).planes[0].set(a-o,h-s,d-m,k-V),r.planes[1].set(a+o,h+s,d+m,k+V),r.planes[2].set(a-u,h-c,d-p,k-w),r.planes[3].set(a+u,h+c,d+p,k+w),r.planes[4].set(a-f,h-v,d-x,k-g),r.planes[5].set(a+f,h+v,d+x,k+g),r}function Y(t,n){var r=1,e=c,o=v;e[0]=n[0],e[1]=n[1],e[2]=n[2],o[0]=n[3],o[1]=n[4],o[2]=n[5];for(var i=[e,o],u=0;u<6;++u){var f=t.planes[u];if(f.normal[0]*i[f.testVertex[0]][0]+f.normal[1]*i[f.testVertex[1]][1]+f.normal[2]*i[f.testVertex[2]][2]+f.offset<0)return 3;f.normal[0]*i[1-f.testVertex[0]][0]+f.normal[1]*i[1-f.testVertex[1]][1]+f.normal[2]*i[1-f.testVertex[2]][2]+f.offset<0&&(r=2)}return r}function Z(t,n){return 2}function $(t,n,r){return!0}function _(t,n,r,e){return!0}function tt(t,n,r){return!0}function nt(t,n){return!0}function rt(t,n){return!0}function et(t,n,r){return!1}function ot(t,n,r){return!1}function it(t,n){for(var r=t[0],e=t[1],o=t[2],i=t[3],u=t[4],f=t[5],a=0,s=n.length;a<s;a+=3){var c=n[a];if(r<=c&&c<=i){var v=n[a+1];if(e<=v&&v<=u){var l=n[a+2];if(o<=l&&l<=f)return!0}}}return!1}function ut(t,n){return t[0]<=n[0]&&n[0]<=t[3]&&t[1]<=n[1]&&n[1]<=t[4]&&t[2]<=n[2]&&n[2]<=t[5]}function ft(t,n){return t[0]<=n[0]&&n[0]<=t[3]&&t[1]<=n[1]&&n[1]<=t[4]}export{C as AABB3ToOBB3,K as ABB3ToOBB3,W as Frustum3,R as FrustumPlane3,S as INSIDE,T as INTERSECT,O as OBB3ToAABB3,U as OUTSIDE,z as collapseAABB3,B as collapseAABB3Int16,g as containsAABB2,ft as containsAABB2Point2,k as containsAABB3,ut as containsAABB3Point3,p as createAABB2,h as createAABB3,m as createAABB3Int16,d as createOBB2,x as createOBB3,V as createSphere3,E as expandAABB2,H as expandAABB2Point2,D as expandAABB3,G as expandAABB3Point3,J as expandAABB3Points3,j as getAABB2Center,F as getAABB3Area,I as getAABB3Center,A as getAABB3Diag,q as getAABB3DiagPoint,Q as getPositions3Center,ot as intersectAABB3Lines3,it as intersectAABB3Positions3,et as intersectAABB3Triangles3,Z as intersectAABB3s,Y as intersectFrustum3AABB3,tt as intersectFrustum3Lines3,rt as intersectFrustum3Point3,nt as intersectFrustum3Positions3,_ as intersectFrustum3Triangle3,$ as intersectFrustum3Triangles3,P as points3ToAABB3,N as positions3ToAABB3,X as setFrustum3,w as transformOBB3};\n//# sourceMappingURL=index.es.map\n","/**\n * @private\n */\nimport type {GLDataTexture} from \"@xeokit/webglutils\";\n\n\nexport class DataTextureSet {\n\n    positions: GLDataTexture | null; // All quantized positions for a Layer\n    indices_8Bits: GLDataTexture | null; // All 8-bit indices\n    indices_16Bits: GLDataTexture | null; // All 16-bit indices\n    indices_32Bits: GLDataTexture | null; // All 32-bt indices\n    edgeIndices_8Bits: GLDataTexture | null; // All 8-bit edge indices\n    edgeIndices_16Bits: GLDataTexture | null; // All 16-bit edges indices\n    edgeIndices_32Bits: GLDataTexture | null; // All 32-bit edges indices\n    indices: { [key: number]: GLDataTexture | null }; // All 8, 16, and 32-bit indices\n    edgeIndices: { [key: number]: GLDataTexture | null } | null; // All 8, 16 and 32-bit indices\n    eachMeshAttributes: GLDataTexture | null; // For each mesh, a set of attributes including color, opacity, visibility etc\n    eachMeshMatrices: GLDataTexture | null; // For each mesh, a positions decompression matrix and a modeling matrix\n    eachEdgeOffset: GLDataTexture | null;\n    eachPrimitiveMesh_8Bits: GLDataTexture | null;\n    eachPrimitiveMesh_16Bits: GLDataTexture | null;\n    eachPrimitiveMesh_32Bits: GLDataTexture | null;\n    eachPrimitiveMesh: { [key: number]: GLDataTexture | null } | null;\n    eachEdgeMesh_8Bits: GLDataTexture | null;\n    eachEdgeMesh_16Bits: GLDataTexture | null;\n    eachEdgeMesh_32Bits: GLDataTexture | null;\n    eachEdgeMesh: { [key: number]: GLDataTexture | null } | null;\n    #built: boolean;\n\n    constructor() {\n        this.positions = null;\n        this.indices_8Bits = null;\n        this.indices_16Bits = null;\n        this.indices_32Bits = null;\n        this.edgeIndices_8Bits = null;\n        this.edgeIndices_16Bits = null;\n        this.edgeIndices_32Bits = null;\n        this.eachMeshAttributes = null;\n        this.eachMeshMatrices = null;\n        this.eachPrimitiveMesh_8Bits = null;\n        this.eachPrimitiveMesh_16Bits = null;\n        this.eachPrimitiveMesh_32Bits = null;\n        this.eachEdgeMesh_8Bits = null;\n        this.eachEdgeMesh_16Bits = null;\n        this.eachEdgeMesh_32Bits = null;\n        this.eachEdgeOffset = null;\n        this.#built = false;\n    }\n\n    build() {\n        this.indices = {\n            8: this.indices_8Bits,\n            16: this.indices_16Bits,\n            32: this.indices_32Bits,\n        };\n        this.eachPrimitiveMesh = {\n            8: this.eachPrimitiveMesh_8Bits,\n            16: this.eachPrimitiveMesh_16Bits,\n            32: this.eachPrimitiveMesh_32Bits,\n        };\n        this.edgeIndices = {\n            8: this.edgeIndices_8Bits,\n            16: this.edgeIndices_16Bits,\n            32: this.edgeIndices_32Bits,\n        };\n        this.eachEdgeMesh = {\n            8: this.eachEdgeMesh_8Bits,\n            16: this.eachEdgeMesh_16Bits,\n            32: this.eachEdgeMesh_32Bits,\n        };\n        this.#built = true;\n    }\n\n    destroy() {\n        if (this.positions) {\n            this.positions.destroy();\n        }\n        if (this.indices_8Bits) {\n            this.indices_8Bits.destroy();\n        }\n        if (this.indices_16Bits) {\n            this.indices_16Bits.destroy();\n        }\n        if (this.indices_32Bits) {\n            this.indices_32Bits.destroy();\n        }\n        if (this.edgeIndices_8Bits) {\n            this.edgeIndices_8Bits.destroy();\n        }\n        if (this.edgeIndices_16Bits) {\n            this.edgeIndices_16Bits.destroy();\n        }\n        if (this.edgeIndices_32Bits) {\n            this.edgeIndices_32Bits.destroy();\n        }\n        if (this.eachMeshMatrices) {\n            this.eachMeshMatrices.destroy();\n        }\n        if (this.eachMeshAttributes) {\n            this.eachMeshAttributes.destroy();\n        }\n        if (this.eachEdgeOffset) {\n            this.eachEdgeOffset.destroy();\n        }\n        if (this.eachPrimitiveMesh_8Bits) {\n            this.eachPrimitiveMesh_8Bits.destroy();\n        }\n        if (this.eachPrimitiveMesh_16Bits) {\n            this.eachPrimitiveMesh_16Bits.destroy();\n        }\n        if (this.eachPrimitiveMesh_32Bits) {\n            this.eachPrimitiveMesh_32Bits.destroy();\n        }\n        if (this.eachEdgeMesh_8Bits) {\n            this.eachEdgeMesh_8Bits.destroy();\n        }\n        if (this.eachEdgeMesh_16Bits) {\n            this.eachEdgeMesh_16Bits.destroy();\n        }\n        if (this.eachEdgeMesh_32Bits) {\n            this.eachEdgeMesh_32Bits.destroy();\n        }\n    }\n}\n","\n/**\n * @private\n */\nexport class MeshCounts {\n\n    numMeshes: number;\n    numVisible: number;\n    numTransparent: number;\n    numEdges: number;\n    numXRayed: number;\n    numSelected: number;\n    numHighlighted: number;\n    numClippable: number;\n    numPickable: number;\n    numCulled: number;\n\n    constructor() {\n        this.reset();\n    }\n\n    reset() {\n        this.numMeshes = 0;\n        this.numVisible = 0;\n        this.numTransparent = 0;\n        this.numEdges = 0;\n        this.numXRayed = 0;\n        this.numSelected = 0;\n        this.numHighlighted = 0;\n        this.numClippable = 0;\n        this.numPickable = 0;\n        this.numCulled = 0;\n    }\n}","\n/**\n * @private\n */\nexport const SCENE_OBJECT_FLAGS = {\n    VISIBLE: 1,\n    CULLED: 1 << 2,\n    PICKABLE: 1 << 3,\n    CLIPPABLE: 1 << 4,\n    COLLIDABLE: 1 << 5,\n    CAST_SHADOW: 1 << 6,\n    RECEIVE_SHADOW: 1 << 7,\n    XRAYED: 1 << 8,\n    HIGHLIGHTED: 1 << 9,\n    SELECTED: 1 << 10,\n    EDGES: 1 << 11,\n    BACKFACES: 1 << 12,\n    TRANSPARENT: 1 << 13\n};\n","/**\n * Bundled by jsDelivr using Rollup v2.59.0 and Terser v5.9.0.\n * Original file: /npm/@petamoriken/float16@3.5.11/src/index.mjs\n *\n * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files\n */\nfunction t(t: Function) {\n    // @ts-ignore\n    return (r: any, ...e: ArrayLike<any>) => n(t, r, e)\n}\n\nfunction r(r: object, n: PropertyKey) {\n    // @ts-ignore\n    return t(s(r, n).get)\n}\n\n// @ts-ignore\n// @ts-ignore\nconst {\n        apply: n,\n        construct: e,\n        defineProperty: o,\n        get: i,\n        getOwnPropertyDescriptor: s,\n        getPrototypeOf: c,\n        has: u,\n        ownKeys: f,\n        set: h,\n        setPrototypeOf: l\n    } = Reflect, a = Proxy, y = Number,\n    {\n        isFinite: p,\n        isNaN: w\n    } = y,\n    {\n        iterator: g,\n        species: d,\n        toStringTag: v,\n        for: b\n    } = Symbol, A = Object,\n    {\n        create: m,\n        defineProperty: B,\n        freeze: x,\n        is: E\n        // @ts-ignore\n    } = A, T = A.prototype, O = t(T.isPrototypeOf), j = A.hasOwn || t(T.hasOwnProperty), I = Array, P = I.isArray,\n    // @ts-ignore\n    S = I.prototype, _ = t(S.join), F = t(S.push), L = t(S.toLocaleString), R = S[g], C = t(R), N = Math.trunc,\n    U = ArrayBuffer, M = U.isView, D = t(U.prototype.slice), k = r(U.prototype, \"byteLength\"),\n    W = \"undefined\" != typeof SharedArrayBuffer ? SharedArrayBuffer : null, V = W && r(W.prototype, \"byteLength\"),\n    // @ts-ignore\n    Y = c(Uint8Array), z = Y.from, G = Y.prototype, K = G[g], X = t(G.keys), q = t(G.values), H = t(G.entries),\n    J = t(G.set), Q = t(G.reverse), Z = t(G.fill), $ = t(G.copyWithin), tt = t(G.sort), rt = t(G.slice),\n    nt = t(G.subarray), et = r(G, \"buffer\"), ot = r(G, \"byteOffset\"), it = r(G, \"length\"), st = r(G, v),\n    // @ts-ignore\n    ct = Uint16Array, ut = (...t) => n(z, ct, t), ft = Uint32Array, ht = Float32Array, lt = c([][g]()), at = t(lt.next),\n    yt = t(function* () {\n        // @ts-ignore\n    }().next), pt = c(lt), wt = DataView.prototype, gt = t(wt.getUint16), dt = t(wt.setUint16), vt = TypeError,\n    bt = RangeError, At = Set, mt = At.prototype, Bt = t(mt.add), xt = t(mt.has), Et = WeakMap, Tt = Et.prototype,\n    Ot = t(Tt.get), jt = t(Tt.has), It = t(Tt.set), Pt = new U(4), St = new ht(Pt), _t = new ft(Pt), Ft = new ft(512),\n    Lt = new ft(512);\nfor (let t = 0; t < 256; ++t) {\n    const r = t - 127;\n    r < -27 ? (Ft[t] = 0, Ft[256 | t] = 32768, Lt[t] = 24, Lt[256 | t] = 24) : r < -14 ? (Ft[t] = 1024 >> -r - 14, Ft[256 | t] = 1024 >> -r - 14 | 32768, Lt[t] = -r - 1, Lt[256 | t] = -r - 1) : r <= 15 ? (Ft[t] = r + 15 << 10, Ft[256 | t] = r + 15 << 10 | 32768, Lt[t] = 13, Lt[256 | t] = 13) : r < 128 ? (Ft[t] = 31744, Ft[256 | t] = 64512, Lt[t] = 24, Lt[256 | t] = 24) : (Ft[t] = 31744, Ft[256 | t] = 64512, Lt[t] = 13, Lt[256 | t] = 13)\n}\n\nfunction Rt(t: number) {\n    St[0] = t;\n    const r = _t[0],\n        n = r >> 23 & 511;\n    return Ft[n] + ((8388607 & r) >> Lt[n])\n}\n\nconst Ct = new ft(2048),\n    Nt = new ft(64),\n    Ut = new ft(64);\nCt[0] = 0;\nfor (let t = 1; t < 1024; ++t) {\n    let r = t << 13,\n        n = 0;\n    for (; 0 == (8388608 & r);) n -= 8388608, r <<= 1;\n    r &= -8388609, n += 947912704, Ct[t] = r | n\n}\nfor (let t = 1024; t < 2048; ++t) Ct[t] = 939524096 + (t - 1024 << 13);\nNt[0] = 0;\nfor (let t = 1; t < 31; ++t) Nt[t] = t << 23;\nNt[31] = 1199570944, Nt[32] = 2147483648;\nfor (let t = 33; t < 63; ++t) Nt[t] = 2147483648 + (t - 32 << 23);\nNt[63] = 3347054592, Ut[0] = 0;\nfor (let t = 1; t < 64; ++t) Ut[t] = 32 === t ? 0 : 1024;\n\nfunction Mt(t: number) {\n    const r = t >> 10;\n    return _t[0] = Ct[Ut[r] + (1023 & t)] + Nt[r], St[0]\n}\n\nfunction Dt(t: unknown) {\n    if (\"bigint\" == typeof t) throw vt(\"Cannot convert a BigInt value to a number\");\n    if (t = y(t), !p(t) || 0 === t) return t;\n    // @ts-ignore\n    return Mt(Rt(t))\n}\n\nfunction kt(t: any[]) {\n    // @ts-ignore\n    if (t[g] === R) return t;\n    const r = C(t);\n    return m(null,\n        {\n            next:\n                {\n                    value: function () {\n                        return at(r)\n                    }\n                },\n            [g]:\n                {\n                    value: function () {\n                        return this\n                    }\n                }\n        })\n}\n\nconst Wt = new Et,\n    Vt = m(pt,\n        {\n            next:\n                {\n                    value: function () {\n                        const t = Ot(Wt, this);\n                        return yt(t)\n                    },\n                    writable: !0,\n                    configurable: !0\n                },\n            [v]:\n                {\n                    value: \"Array Iterator\",\n                    configurable: !0\n                }\n        });\n\nfunction Yt(t:any) {\n    const r = m(Vt);\n    return It(Wt, r, t), r\n}\n\nfunction zt(t:any) {\n    return null !== t && \"object\" == typeof t || \"function\" == typeof t\n}\n\nfunction Gt(t:any) {\n    return null !== t && \"object\" == typeof t\n}\n\nfunction Kt(t:any) {\n    return void 0 !== st(t)\n}\n\nfunction Xt(t:any) {\n    const r = st(t);\n    return \"BigInt64Array\" === r || \"BigUint64Array\" === r\n}\n\nfunction qt(t:any) {\n    if (null === W) return !1;\n    try {\n        // @ts-ignore\n        return V(t), !0\n    } catch (t:any) {\n        return !1\n    }\n}\n\nfunction Ht(t:any) {\n    if (!P(t)) return !1;\n    // @ts-ignore\n    if (t[g] === R) return !0;\n    // @ts-ignore\n    return \"Array Iterator\" === t[g]()[v]\n}\n\nfunction Jt(t:any) {\n    if (\"string\" != typeof t) return !1;\n    const r = y(t);\n    return t === r + \"\" && (!!p(r) && r === N(r))\n}\n\nconst Qt = y.MAX_SAFE_INTEGER;\n\nfunction Zt(t:any) {\n    if (\"bigint\" == typeof t) throw vt(\"Cannot convert a BigInt value to a number\");\n    const r = y(t);\n    return w(r) || 0 === r ? 0 : N(r)\n}\n\nfunction $t(t:any) {\n    const r = Zt(t);\n    return r < 0 ? 0 : r < Qt ? r : Qt\n}\n\nfunction tr(t: { constructor: any; }, r: ArrayBufferConstructor) {\n    if (!zt(t)) throw vt(\"This is not an object\");\n    const n = t.constructor;\n    if (void 0 === n) return r;\n    if (!zt(n)) throw vt(\"The constructor property value is not an object\");\n    const e = n[d];\n    return null == e ? r : e\n}\n\nfunction rr(t:any) {\n    if (qt(t)) return !1;\n    try {\n        return D(t, 0, 0), !1\n    } catch (t:any) {\n    }\n    return !0\n}\n\nfunction nr(t: unknown, r: unknown) {\n    const n = w(t),\n        e = w(r);\n    if (n && e) return 0;\n    if (n) return 1;\n    if (e) return -1;\n    // @ts-ignore\n    if (t < r) return -1;\n    // @ts-ignore\n    if (t > r) return 1;\n    if (0 === t && 0 === r) {\n        const n = E(t, 0),\n            e = E(r, 0);\n        if (!n && e) return -1;\n        if (n && !e) return 1\n    }\n    return 0\n}\n\nconst er = b(\"__Float16Array__\"),\n    or = new Et;\n\nfunction ir(t:any) {\n    return jt(or, t) || !M(t) && function (t:any) {\n        if (!Gt(t)) return !1;\n        const r = c(t);\n        if (!Gt(r)) return !1;\n        // @ts-ignore\n        const n = r.constructor;\n        if (void 0 === n) return !1;\n        if (!zt(n)) throw vt(\"The constructor property value is not an object\");\n        return u(n, er)\n    }(t)\n}\n\nfunction sr(t:any) {\n    if (!ir(t)) throw vt(\"This is not a Float16Array object\")\n}\n\nfunction cr(t: any, r: number) {\n    const n = ir(t),\n        e = Kt(t);\n    if (!n && !e) throw vt(\"Species constructor didn't return TypedArray object\");\n    if (\"number\" == typeof r) {\n        let e;\n        if (n) {\n            const r = ur(t);\n            e = it(r)\n        } else e = it(t);\n        if (e < r) throw vt(\"Derived constructor created TypedArray object which was too small length\")\n    }\n    if (Xt(t)) throw vt(\"Cannot mix BigInt and other types, use explicit conversions\")\n}\n\nfunction ur(t:any) {\n    const r = Ot(or, t);\n    if (void 0 !== r) {\n        if (rr(et(r))) throw vt(\"Attempting to access detached ArrayBuffer\");\n        return r\n    }\n    const n = t.buffer;\n    if (rr(n)) throw vt(\"Attempting to access detached ArrayBuffer\");\n    const o = e(ar, [n, t.byteOffset, t.length], t.constructor);\n    return Ot(or, o)\n}\n\nfunction fr(t:any) {\n    const r = it(t),\n        n = [];\n    for (let e = 0; e < r; ++e) n[e] = Mt(t[e]);\n    return n\n}\n\nconst hr = new At;\nfor (const t of f(G)) {\n    if (t === v) continue;\n    const r = s(G, t);\n    j(r, \"get\") && Bt(hr, t)\n}\nconst lr = x(\n    {\n        get: (t: object, r: PropertyKey, n: any) => Jt(r) && j(t, r) ? Mt(i(t, r)) : xt(hr, r) && O(G, t) ? i(t, r) : i(t, r, n),\n        set: (t: object, r: PropertyKey, n: number, e: any) => Jt(r) && j(t, r) ? h(t, r, Rt(n)) : h(t, r, n, e),\n        getOwnPropertyDescriptor(t: object, r: PropertyKey) {\n            if (Jt(r) && j(t, r)) {\n                const n = s(t, r);\n                // @ts-ignore\n                return n.value = Mt(n.value), n\n            }\n            return s(t, r)\n        },\n        defineProperty: (t: object, r: PropertyKey, n: PropertyDescriptor & ThisType<any>) => Jt(r) && j(t, r) && j(n, \"value\") ? (n.value = Rt(n.value), o(t, r, n)) : o(t, r, n)\n    });\n\nclass ar {\n    constructor(t: string | number | any[], r: undefined, n: undefined) {\n        let o;\n        if (ir(t)) o = e(ct, [ur(t)], new.target);\n        else if (zt(t) && !function (t:any) {\n            try {\n                return k(t), !0\n            } catch (t) {\n                return !1\n            }\n        }(t)) {\n            let r, n;\n            if (Kt(t)) {\n                r = t, n = it(t);\n                const i = et(t),\n                    s = qt(i) ? U : tr(i, U);\n                if (rr(i)) throw vt(\"Attempting to access detached ArrayBuffer\");\n                if (Xt(t)) throw vt(\"Cannot mix BigInt and other types, use explicit conversions\");\n                const c = new s(2 * n);\n                o = e(ct, [c], new.target)\n            } else {\n                // @ts-ignore\n                const i = t[g];\n                if (null != i && \"function\" != typeof i) throw vt(\"@@iterator property is not callable\");\n                // @ts-ignore\n                null != i ? Ht(t) ? (r = t, n = t.length) : (r = [...t], n = r.length) : (r = t, n = $t(r.length)), o = e(ct, [n], new.target)\n            }\n            for (let t = 0; t < n; ++t) { // @ts-ignore\n                o[t] = Rt(r[t])\n            }\n        } else o = e(ct, arguments, new.target);\n        const i = new a(o, lr);\n        return It(or, i, o), i\n    }\n\n    static from(t: string | any[], ...r: any[]) {\n        const e = this;\n        if (!u(e, er)) throw vt(\"This constructor is not a subclass of Float16Array\");\n        if (e === ar) {\n            if (ir(t) && 0 === r.length) {\n                const r = ur(t),\n                    n = new ct(et(r), ot(r), it(r));\n                // @ts-ignore\n                return new ar(et(rt(n)))\n            }\n            // @ts-ignore\n            if (0 === r.length) return new ar(et(ut(t, Rt)));\n            const e = r[0],\n                o = r[1];\n            // @ts-ignore\n            return new ar(et(ut(t, ((t, ...r) => {\n                return Rt(n(e, this, [t, ...kt(r)]))\n            }), o)))\n        }\n        let o, i;\n        // @ts-ignore\n        const s = t[g];\n        if (null != s && \"function\" != typeof s) throw vt(\"@@iterator property is not callable\");\n        // @ts-ignore\n        if (null != s) Ht(t) ? (o = t, i = t.length) : !Kt(c = t) || c[g] !== K && \"Array Iterator\" !== c[g]()[v] ? (o = [...t], i = o.length) : (o = t, i = it(t));\n        else {\n            if (null == t) throw vt(\"Cannot convert undefined or null to object\");\n            o = A(t), i = $t(o.length)\n        }\n        var c;\n        // @ts-ignore\n        const f = new e(i);\n        if (0 === r.length)\n            // @ts-ignore\n            for (let t = 0; t < i; ++t) f[t] = o[t];\n        else {\n            const t = r[0],\n                e = r[1];\n            // @ts-ignore\n            for (let r = 0; r < i; ++r) f[r] = n(t, e, [o[r], r])\n        }\n        return f\n    }\n\n    static of(...t:any) {\n        const r = this;\n        if (!u(r, er)) throw vt(\"This constructor is not a subclass of Float16Array\");\n        const n = t.length;\n        if (r === ar) {\n            // @ts-ignore\n            const r = new ar(n),\n                e = ur(r);\n            for (let r = 0; r < n; ++r) e[r] = Rt(t[r]);\n            return r\n        }\n        // @ts-ignore\n        const e = new r(n);\n        // @ts-ignore\n        for (let r = 0; r < n; ++r) e[r] = t[r];\n        return e\n    }\n\n    keys() {\n        sr(this);\n        const t = ur(this);\n        return X(t)\n    }\n\n    values() {\n        sr(this);\n        const t = ur(this);\n        return Yt(function* () {\n            for (const r of q(t)) yield Mt(r)\n        }())\n    }\n\n    entries() {\n        sr(this);\n        const t = ur(this);\n        return Yt(function* () {\n            for (const [r, n] of H(t)) yield [r, Mt(n)]\n        }())\n    }\n\n    at(t:any) {\n        sr(this);\n        const r = ur(this),\n            n = it(r),\n            e = Zt(t),\n            o = e >= 0 ? e : n + e;\n        if (!(o < 0 || o >= n)) return Mt(r[o])\n    }\n\n    map(t: Function, ...r: any[]) {\n        sr(this);\n        const e = ur(this),\n            o = it(e),\n            i = r[0],\n            // @ts-ignore\n            s = tr(e, ar);\n        if (s === ar) {\n            // @ts-ignore\n            const r = new ar(o),\n                s = ur(r);\n            for (let r = 0; r < o; ++r) {\n                const o = Mt(e[r]);\n                s[r] = Rt(n(t, i, [o, r, this]))\n            }\n            return r\n        }\n        const c = new s(o);\n        cr(c, o);\n        for (let r = 0; r < o; ++r) {\n            const o = Mt(e[r]);\n            c[r] = n(t, i, [o, r, this])\n        }\n        return c\n    }\n\n    filter(t: Function, ...r: any[]) {\n        sr(this);\n        const e = ur(this),\n            o = it(e),\n            i = r[0],\n            // @ts-ignore\n            s = [];\n        for (let r = 0; r < o; ++r) {\n            const o = Mt(e[r]);\n            // @ts-ignore\n            n(t, i, [o, r, this]) && F(s, o)\n        }\n        // @ts-ignore\n        const c = new (tr(e, ar))(s);\n        // @ts-ignore\n        return cr(c), c\n    }\n\n    reduce(t: (arg0: any, arg1: number, arg2: number, arg3: this) => any, ...r: any[]) {\n        sr(this);\n        const n = ur(this),\n            e = it(n);\n        if (0 === e && 0 === r.length) throw vt(\"Reduce of empty array with no initial value\");\n        let o, i;\n        0 === r.length ? (o = Mt(n[0]), i = 1) : (o = r[0], i = 0);\n        for (let r = i; r < e; ++r) o = t(o, Mt(n[r]), r, this);\n        return o\n    }\n\n    reduceRight(t: (arg0: any, arg1: number, arg2: number, arg3: this) => any, ...r: any[]) {\n        sr(this);\n        const n = ur(this),\n            e = it(n);\n        if (0 === e && 0 === r.length) throw vt(\"Reduce of empty array with no initial value\");\n        let o, i;\n        0 === r.length ? (o = Mt(n[e - 1]), i = e - 2) : (o = r[0], i = e - 1);\n        for (let r = i; r >= 0; --r) o = t(o, Mt(n[r]), r, this);\n        return o\n    }\n\n    forEach(t: Function, ...r: any[]) {\n        sr(this);\n        const e = ur(this),\n            o = it(e),\n            i = r[0];\n        for (let r = 0; r < o; ++r) n(t, i, [Mt(e[r]), r, this])\n    }\n\n    find(t: Function, ...r: any[]) {\n        sr(this);\n        const e = ur(this),\n            o = it(e),\n            i = r[0];\n        for (let r = 0; r < o; ++r) {\n            const o = Mt(e[r]);\n            if (n(t, i, [o, r, this])) return o\n        }\n    }\n\n    findIndex(t: Function, ...r: any[]) {\n        sr(this);\n        const e = ur(this),\n            o = it(e),\n            i = r[0];\n        for (let r = 0; r < o; ++r) {\n            const o = Mt(e[r]);\n            if (n(t, i, [o, r, this])) return r\n        }\n        return -1\n    }\n\n    findLast(t: Function, ...r: any[]) {\n        sr(this);\n        const e = ur(this),\n            o = it(e),\n            i = r[0];\n        for (let r = o - 1; r >= 0; --r) {\n            const o = Mt(e[r]);\n            if (n(t, i, [o, r, this])) return o\n        }\n    }\n\n    findLastIndex(t: Function, ...r: any[]) {\n        sr(this);\n        const e = ur(this),\n            o = it(e),\n            i = r[0];\n        for (let r = o - 1; r >= 0; --r) {\n            const o = Mt(e[r]);\n            if (n(t, i, [o, r, this])) return r\n        }\n        return -1\n    }\n\n    every(t: Function, ...r: any[]) {\n        sr(this);\n        const e = ur(this),\n            o = it(e),\n            i = r[0];\n        for (let r = 0; r < o; ++r)\n            if (!n(t, i, [Mt(e[r]), r, this])) return !1;\n        return !0\n    }\n\n    some(t: Function, ...r: any[]) {\n        sr(this);\n        const e = ur(this),\n            o = it(e),\n            i = r[0];\n        for (let r = 0; r < o; ++r)\n            if (n(t, i, [Mt(e[r]), r, this])) return !0;\n        return !1\n    }\n\n    set(t: number, ...r: number[]) {\n        sr(this);\n        const n = ur(this),\n            e = Zt(r[0]);\n        if (e < 0) throw bt(\"Offset is out of bounds\");\n        if (null == t) throw vt(\"Cannot convert undefined or null to object\");\n        if (Xt(t)) throw vt(\"Cannot mix BigInt and other types, use explicit conversions\");\n        if (ir(t)) return J(ur(this), ur(t), e);\n        if (Kt(t)) {\n            if (rr(et(t))) throw vt(\"Attempting to access detached ArrayBuffer\")\n        }\n        const o = it(n),\n            i = A(t),\n            s = $t(i.length);\n        if (e === 1 / 0 || s + e > o) throw bt(\"Offset is out of bounds\");\n        for (let t = 0; t < s; ++t) n[t + e] = Rt(i[t])\n    }\n\n    reverse() {\n        sr(this);\n        const t = ur(this);\n        return Q(t), this\n    }\n\n    fill(t: number, ...r: any[]) {\n        sr(this);\n        const n = ur(this);\n        return Z(n, Rt(t), ...kt(r)), this\n    }\n\n    copyWithin(t: any, r: any, ...n: any[]) {\n        sr(this);\n        const e = ur(this);\n        return $(e, t, r, ...kt(n)), this\n    }\n\n    sort(...t:any) {\n        sr(this);\n        const r = ur(this),\n            n = void 0 !== t[0] ? t[0] : nr;\n        // @ts-ignore\n        return tt(r, ((t, r) => n(Mt(t), Mt(r)))), this\n    }\n\n    slice(...t:any) {\n        sr(this);\n        const r = ur(this),\n            // @ts-ignore\n            n = tr(r, ar);\n        if (n === ar) {\n            const n = new ct(et(r), ot(r), it(r));\n            // @ts-ignore\n            return new ar(et(rt(n, ...kt(t))))\n        }\n        const e = it(r),\n            o = Zt(t[0]),\n            i = void 0 === t[1] ? e : Zt(t[1]);\n        let s, c;\n        s = o === -1 / 0 ? 0 : o < 0 ? e + o > 0 ? e + o : 0 : e < o ? e : o, c = i === -1 / 0 ? 0 : i < 0 ? e + i > 0 ? e + i : 0 : e < i ? e : i;\n        const u = c - s > 0 ? c - s : 0,\n            f = new n(u);\n        if (cr(f, u), 0 === u) return f;\n        if (rr(et(r))) throw vt(\"Attempting to access detached ArrayBuffer\");\n        let h = 0;\n        for (; s < c;) f[h] = Mt(r[s]), ++s, ++h;\n        return f\n    }\n\n    subarray(...t:any) {\n        sr(this);\n        const r = ur(this),\n            // @ts-ignore\n            n = tr(r, ar),\n            e = new ct(et(r), ot(r), it(r)),\n            o = nt(e, ...kt(t)),\n            i = new n(et(o), ot(o), it(o));\n        // @ts-ignore\n        return cr(i), i\n    }\n\n    indexOf(t: number, ...r: any[]) {\n        sr(this);\n        const n = ur(this),\n            e = it(n);\n        let o = Zt(r[0]);\n        if (o === 1 / 0) return -1;\n        o < 0 && (o += e, o < 0 && (o = 0));\n        for (let r = o; r < e; ++r)\n            if (j(n, r) && Mt(n[r]) === t) return r;\n        return -1\n    }\n\n        lastIndexOf(t: number, ...r: any[]) {\n        sr(this);\n        const n = ur(this),\n            e = it(n);\n        let o = r.length >= 1 ? Zt(r[0]) : e - 1;\n        if (o === -1 / 0) return -1;\n        o >= 0 ? o = o < e - 1 ? o : e - 1 : o += e;\n        for (let r = o; r >= 0; --r)\n            if (j(n, r) && Mt(n[r]) === t) return r;\n        return -1\n    }\n\n    includes(t: unknown, ...r: any[]) {\n        sr(this);\n        const n = ur(this),\n            e = it(n);\n        let o = Zt(r[0]);\n        if (o === 1 / 0) return !1;\n        o < 0 && (o += e, o < 0 && (o = 0));\n        const i = w(t);\n        for (let r = o; r < e; ++r) {\n            const e = Mt(n[r]);\n            if (i && w(e)) return !0;\n            if (e === t) return !0\n        }\n        return !1\n    }\n\n    join(...t:any) {\n        sr(this);\n        const r = fr(ur(this));\n        return _(r, ...kt(t))\n    }\n\n    toLocaleString(...t:any) {\n        sr(this);\n        const r = fr(ur(this));\n        return L(r, ...kt(t))\n    }\n\n    get [v]() {\n        if (ir(this)) return \"Float16Array\"\n    }\n}\n\nB(ar, \"BYTES_PER_ELEMENT\",\n    {\n        value: 2\n    }), B(ar, er,\n    {}), l(ar, Y);\nconst yr = ar.prototype;\n\nfunction pr(t: any, r: any, ...n: any[]) {\n    return Mt(gt(t, r, ...kt(n)))\n}\n\nfunction wr(t: any, r: any, n: number, ...e: any[]) {\n    return dt(t, r, Rt(n), ...kt(e))\n}\n\nB(yr, \"BYTES_PER_ELEMENT\",\n    {\n        value: 2\n    }), B(yr, g,\n    {\n        value: yr.values,\n        writable: !0,\n        configurable: !0\n    }), l(yr, G);\nexport\n{\n    ar as Float16Array, pr as getFloat16, Dt as hfround, ir as isFloat16Array, wr as setFloat16\n};","import type {FloatArrayParam, IntArrayParam} from \"@xeokit/math\";\nimport {GLDataTexture} from \"@xeokit/webglutils\";\nimport {Float16Array} from \"./float16\";\n\nconst emptyDataTexture = new GLDataTexture({textureWidth: 0, textureHeight: 0});\n\n/**\n * Enables the currently bound ````WebGLTexture```` to be used as a data texture.\n */\nexport function disableFilteringForBoundTexture(gl: WebGL2RenderingContext) {\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n}\n\n/**\n * Creates a GLDataTexture that holds per-geometry matrices for positions decode.\n *\n * The texture will have:\n * - 4 RGBA columns per row (each column will contain 4 packed half-float (16 bits) components).\n *   Thus, each row will contain 16 packed half-floats corresponding to a complete positions decode matrix)\n * - N rows where N is the number of meshes\n *\n * @param gl\n * @param positionDecodeMatrices Positions decode matrix for each mesh in the layer\n */\nexport function createEachGeometryMatricesDataTexture(gl: WebGL2RenderingContext, positionDecodeMatrices: FloatArrayParam): GLDataTexture {\n\n    // Texture has one row per mesh:\n    //\n    //    - col0: Positions decode matrix\n\n    const textureHeight = positionDecodeMatrices.length;\n    if (textureHeight == 0) {\n        throw \"texture height == 0\";\n    }\n    const textureWidth = 4 * 3;\n    // @ts-ignore\n    const textureData = new Float16Array(4 * textureWidth * textureHeight);\n    for (let i = 0; i < positionDecodeMatrices.length; i++) {\n        textureData.set(positionDecodeMatrices [i], i * 24);   // 4x4 values\n    }\n    const texture = gl.createTexture();\n    if (!texture) {\n        return emptyDataTexture;\n    }\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA16F, textureWidth, textureHeight);\n    // @ts-ignore\n    gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, textureWidth, textureHeight, gl.RGBA, gl.HALF_FLOAT, new Uint16Array(textureData.buffer), 0);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    return new GLDataTexture({gl, texture, textureWidth, textureHeight});\n}\n\n\n/**\n * Creates a GLDataTexture containing the given vertex positions.\n */\nexport function createPositionsDataTexture(gl: WebGL2RenderingContext, positions: FloatArrayParam): GLDataTexture {\n    const numVertices = positions.length / 3;\n    const textureWidth = 1024;\n    const textureHeight = Math.ceil(numVertices / textureWidth);\n    if (textureHeight == 0) {\n        throw \"texture height == 0\";\n    }\n    const textureDataSize = textureWidth * textureHeight * 3;\n    const textureData = new Uint16Array(textureDataSize);\n    //   dataTextureRamStats.sizeDataTexturePositions += textureData.byteLength;\n    textureData.fill(0);\n    // @ts-ignore\n    textureData.set(positions, 0);\n    const texture = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGB16UI, textureWidth, textureHeight);\n    gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, textureWidth, textureHeight, gl.RGB_INTEGER, gl.UNSIGNED_SHORT, textureData, 0);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    // @ts-ignore\n    return new GLDataTexture({gl, texture, textureWidth, textureHeight});\n}\n\n/**\n * Creates a GLDataTexture containing the given 8-bit indices.\n */\nexport function createIndices8BitDataTexture(gl: WebGL2RenderingContext, indices_8Bits: IntArrayParam): GLDataTexture {\n    if (indices_8Bits.length == 0) {\n        return emptyDataTexture;\n    }\n    const textureWidth = 1024;\n    const textureHeight = Math.ceil(indices_8Bits.length / 3 / textureWidth);\n    if (textureHeight == 0) {\n        throw \"texture height == 0\";\n    }\n    const textureDataSize = textureWidth * textureHeight * 3;\n    const textureData = new Uint8Array(textureDataSize);\n    //dataTextureRamStats.sizeDataTextureIndices += textureData.byteLength;\n    textureData.fill(0);\n    textureData.set(indices_8Bits, 0)\n    const texture = gl.createTexture();\n    if (!texture) {\n        return emptyDataTexture;\n    }\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGB8UI, textureWidth, textureHeight);\n    gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, textureWidth, textureHeight, gl.RGB_INTEGER, gl.UNSIGNED_BYTE, textureData, 0);\n    disableFilteringForBoundTexture(gl);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    return new GLDataTexture({gl, texture, textureWidth, textureHeight});\n}\n\n/**\n * Creates a GLDataTexture containing the given 16-bit indices.\n */\nexport function createIndices16BitDataTexture(gl: WebGL2RenderingContext, indices_16Bits: IntArrayParam): GLDataTexture {\n    if (indices_16Bits.length == 0) {\n        return emptyDataTexture;\n    }\n    const textureWidth = 1024;\n    const textureHeight = Math.ceil(indices_16Bits.length / 3 / textureWidth);\n    if (textureHeight == 0) {\n        throw \"texture height == 0\";\n    }\n    const textureDataSize = textureWidth * textureHeight * 3;\n    const textureData = new Uint16Array(textureDataSize);\n    // dataTextureRamStats.sizeDataTextureIndices += textureData.byteLength;\n    textureData.fill(0);\n    // @ts-ignore\n    textureData.set(indices_16Bits, 0)\n    const texture = gl.createTexture();\n    if (!texture) {\n        return emptyDataTexture;\n    }\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGB16UI, textureWidth, textureHeight);\n    gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, textureWidth, textureHeight, gl.RGB_INTEGER, gl.UNSIGNED_SHORT, textureData, 0);\n    disableFilteringForBoundTexture(gl);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    return new GLDataTexture({gl, texture, textureWidth, textureHeight});\n}\n\n/**\n * Creates a GLDataTexture containing the given 32-bit indices.\n */\nexport function createIndices32BitDataTexture(gl: WebGL2RenderingContext, indices_32Bits: IntArrayParam): GLDataTexture {\n    if (indices_32Bits.length == 0) {\n        return emptyDataTexture;\n    }\n    const textureWidth = 1024;\n    const textureHeight = Math.ceil(indices_32Bits.length / 3 / textureWidth);\n    if (textureHeight == 0) {\n        throw \"texture height == 0\";\n    }\n    const textureDataSize = textureWidth * textureHeight * 3;\n    const textureData = new Uint32Array(textureDataSize);\n    // dataTextureRamStats.sizeDataTextureIndices += textureData.byteLength;\n    textureData.fill(0);\n    // @ts-ignore\n    textureData.set(indices_32Bits, 0)\n    const texture = gl.createTexture();\n    if (!texture) {\n        return emptyDataTexture;\n    }\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGB32UI, textureWidth, textureHeight);\n    gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, textureWidth, textureHeight, gl.RGB_INTEGER, gl.UNSIGNED_INT, textureData, 0);\n    disableFilteringForBoundTexture(gl);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    return new GLDataTexture({gl, texture, textureWidth, textureHeight});\n}\n\n/**\n * Creates a GLDataTexture containing the given 8-bit edge indices.\n */\nexport function createEdgeIndices8BitDataTexture(gl: WebGL2RenderingContext, edgeIndices_8Bits: IntArrayParam): GLDataTexture {\n    if (edgeIndices_8Bits.length == 0) {\n        return emptyDataTexture;\n    }\n    const textureWidth = 1024;\n    const textureHeight = Math.ceil(edgeIndices_8Bits.length / 2 / textureWidth);\n    if (textureHeight == 0) {\n        throw \"texture height == 0\";\n    }\n    const textureDataSize = textureWidth * textureHeight * 2;\n    const textureData = new Uint8Array(textureDataSize);\n    // dataTextureRamStats.sizeDataTextureEdgeIndices += textureData.byteLength;\n    textureData.fill(0);\n    // @ts-ignore\n    textureData.set(edgeIndices_8Bits, 0)\n    const texture = gl.createTexture();\n    if (!texture) {\n        return emptyDataTexture;\n    }\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RG8UI, textureWidth, textureHeight);\n    gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, textureWidth, textureHeight, gl.RG_INTEGER, gl.UNSIGNED_BYTE, textureData, 0);\n    disableFilteringForBoundTexture(gl);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    return new GLDataTexture({gl, texture, textureWidth, textureHeight});\n}\n\n/**\n * Creates a GLDataTexture containing the given 16-bit edge indices.\n */\nexport function createEdgeIndices16BitDataTexture(gl: WebGL2RenderingContext, edgeIndices_16Bits: IntArrayParam): GLDataTexture {\n    if (edgeIndices_16Bits.length == 0) {\n        return emptyDataTexture;\n    }\n    const textureWidth = 1024;\n    const textureHeight = Math.ceil(edgeIndices_16Bits.length / 2 / textureWidth);\n    if (textureHeight == 0) {\n        throw \"texture height == 0\";\n    }\n    const textureDataSize = textureWidth * textureHeight * 2;\n    const textureData = new Uint16Array(textureDataSize);\n    //     dataTextureRamStats.sizeDataTextureEdgeIndices += textureData.byteLength;\n    textureData.fill(0);\n    // @ts-ignore\n    textureData.set(edgeIndices_16Bits, 0)\n    const texture = gl.createTexture();\n    if (!texture) {\n        return emptyDataTexture;\n    }\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RG16UI, textureWidth, textureHeight);\n    gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, textureWidth, textureHeight, gl.RG_INTEGER, gl.UNSIGNED_SHORT, textureData, 0);\n    disableFilteringForBoundTexture(gl);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    return new GLDataTexture({gl, texture, textureWidth, textureHeight});\n}\n\n/**\n * Creates a GLDataTexture containing the given 32-bit edge indices.\n */\nexport function createEdgeIndices32BitDataTexture(gl: WebGL2RenderingContext, edgeIndices_32Bits: IntArrayParam): GLDataTexture {\n    if (edgeIndices_32Bits.length == 0) {\n        return emptyDataTexture;\n    }\n    const textureWidth = 1024;\n    const textureHeight = Math.ceil(edgeIndices_32Bits.length / 2 / textureWidth);\n    if (textureHeight == 0) {\n        throw \"texture height == 0\";\n    }\n    const textureDataSize = textureWidth * textureHeight * 2;\n    const textureData = new Uint32Array(textureDataSize);\n    //   dataTextureRamStats.sizeDataTextureEdgeIndices += textureData.byteLength;\n    textureData.fill(0);\n    // @ts-ignore\n    textureData.set(edgeIndices_32Bits, 0)\n    const texture = gl.createTexture();\n    if (!texture) {\n        return emptyDataTexture;\n    }\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RG32UI, textureWidth, textureHeight);\n    gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, textureWidth, textureHeight, gl.RG_INTEGER, gl.UNSIGNED_INT, textureData, 0);\n    disableFilteringForBoundTexture(gl);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    return new GLDataTexture({gl, texture, textureWidth, textureHeight});\n}\n\n/**\n * Creates a GLDataTexture containing per-mesh colors, pick colors, flags, vertex portion bases, indices portion bases, edge indices portion bases\n *\n * The texture will have:\n * - 4 RGBA columns per row: for each mesh (pick) color and flags(2)\n * - N rows where N is the number of meshes\n *\n * @param gl\n * @param colors Color per mesh\n * @param pickColors Pick color per mesh\n * @param vertexBases Vertex index base for each mesh\n * @param indexBaseOffsets For triangles: array of offsets between the (gl_VertexID / 3) and the position where the indices start in the texture layer\n * @param edgeIndexBaseOffsets For edges: Array of offsets between the (gl_VertexID / 2) and the position where the edge indices start in the texture layer\n */\nexport function createEachMeshAttributesDataTexture(gl: WebGL2RenderingContext, colors: FloatArrayParam[], pickColors: FloatArrayParam[], vertexBases: IntArrayParam, indexBaseOffsets: IntArrayParam, edgeIndexBaseOffsets: IntArrayParam): GLDataTexture {\n\n    // Texture has one row per mesh:\n    //\n    //    - col0: (RGBA) mesh color RGBA\n    //    - col1: (packed Uint32 as RGBA) mesh pick color\n    //    - col2: (packed 4 bytes as RGBA) mesh flags\n    //    - col3: (packed 4 bytes as RGBA) mesh flags2\n    //    - col4: (packed Uint32 bytes as RGBA) vertex base\n    //    - col5: (packed Uint32 bytes as RGBA) index base offset\n    //    - col6: (packed Uint32 bytes as RGBA) edge index base offset\n    //    - col7: (packed Uint32 bytes as RGBA) RTC view matrix index base offset\n\n    const textureHeight = colors.length;\n    if (textureHeight == 0) {\n        throw \"texture height == 0\";\n    }\n    const textureWidth = 8;\n    const textureData = new Uint8Array(4 * textureWidth * textureHeight);\n    for (let i = 0; i < textureHeight; i++) {\n        textureData.set(colors [i], i * 28 + 0); // mesh color\n        textureData.set(pickColors [i], i * 28 + 4); // mesh pick color\n        textureData.set([0, 0, 0, 0], i * 28 + 8);  // mesh flags\n        textureData.set([0, 0, 0, 0], i * 28 + 12); // mesh flags2\n        textureData.set([(vertexBases[i] >> 24) & 255, (vertexBases[i] >> 16) & 255, (vertexBases[i] >> 8) & 255, (vertexBases[i]) & 255], i * 28 + 16);   // vertex base\n        textureData.set([(indexBaseOffsets[i] >> 24) & 255, (indexBaseOffsets[i] >> 16) & 255, (indexBaseOffsets[i] >> 8) & 255, (indexBaseOffsets[i]) & 255], i * 28 + 20);    // triangles index base offset\n        textureData.set([(edgeIndexBaseOffsets[i] >> 24) & 255, (edgeIndexBaseOffsets[i] >> 16) & 255, (edgeIndexBaseOffsets[i] >> 8) & 255, (edgeIndexBaseOffsets[i]) & 255], i * 28 + 24);    // edge index base offset\n    //    textureData.set([(rtcViewMatIndices[i] >> 24) & 255, (rtcViewMatIndices[i] >> 16) & 255, (rtcViewMatIndices[i] >> 8) & 255, (rtcViewMatIndices[i]) & 255], i * 28 + 28);    // RTC view matrix\n    }\n    const texture = gl.createTexture();\n    if (!texture) {\n        return emptyDataTexture;\n    }\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA8UI, textureWidth, textureHeight);\n    gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, textureWidth, textureHeight, gl.RGBA_INTEGER, gl.UNSIGNED_BYTE, textureData, 0);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    return new GLDataTexture({gl, texture, textureWidth, textureHeight, textureData}); // Re-writeable texture data\n}\n\n/**\n * Creates GLDataTexture containing a 3D offset for each mesh\n *\n * @param gl\n * @param offsets An offset for each mesh\n */\nexport function createEachEdgeOffsetDataTexture(gl: WebGL2RenderingContext, offsets: FloatArrayParam[]) :GLDataTexture{\n    const textureHeight = offsets.length;\n    if (textureHeight == 0) {\n        throw \"texture height == 0\";\n    }\n    const textureWidth = 1;\n    const textureData = new Float32Array(3 * textureWidth * textureHeight);\n    for (let i = 0; i < offsets.length; i++) {\n        textureData.set(offsets [i], i * 3); // mesh offset\n    }\n    const texture = gl.createTexture();\n    if (!texture) {\n        return emptyDataTexture;\n    }\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGB32F, textureWidth, textureHeight);\n    gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, textureWidth, textureHeight, gl.RGB, gl.FLOAT, textureData, 0);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    return new GLDataTexture({gl, texture, textureWidth, textureHeight, textureData}); // Re-writeable texture data\n}\n\n/**\n * Creates a GLDataTexture that holds per-mesh matrices for positions decode, position modeling, and normals modeling.\n *\n * The texture will have:\n * - 4 RGBA columns per row (each column will contain 4 packed half-float (16 bits) components).\n *   Thus, each row will contain 16 packed half-floats corresponding to a complete positions decode matrix)\n * - N rows where N is the number of meshes\n *\n * @param gl\n * @param positionDecodeMatrices Positions decode matrix for each mesh in the layer\n * @param matrices Positions instancing matrix for each mesh in the layer. Null if the meshes are not instanced.\n */\nexport function createEachMeshMatricesDataTexture(gl: WebGL2RenderingContext, positionDecodeMatrices: FloatArrayParam, matrices: FloatArrayParam): GLDataTexture {\n\n    // Texture has one row per mesh:\n    //\n    //    - col0: Positions decode matrix\n    //    - col1: Positions modeling matrix\n    //    - col2: Normals modeling matrix\n\n    const textureHeight = positionDecodeMatrices.length;\n    if (textureHeight == 0) {\n        throw \"texture height == 0\";\n    }\n    const textureWidth = 4 * 3;\n    // @ts-ignore\n    const textureData = new Float16Array(4 * textureWidth * textureHeight);\n    for (let i = 0; i < positionDecodeMatrices.length; i++) {\n        textureData.set(positionDecodeMatrices [i], i * 48);   // 4x4 values\n        textureData.set(matrices [i], i * 48 + 16);   // 4x4 values\n    }\n    const texture = gl.createTexture();\n    if (!texture) {\n        return emptyDataTexture;\n    }\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA16F, textureWidth, textureHeight);\n    // @ts-ignore\n    gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, textureWidth, textureHeight, gl.RGBA, gl.HALF_FLOAT, new Uint16Array(textureData.buffer), 0);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    return new GLDataTexture({gl, texture, textureWidth, textureHeight});\n}\n\n/**\n * Creates a GLDataTexture containing the given mesh IDs.\n * This type of texture is used for a lookup table, of mesh IDs for given keys.\n *\n * @param gl\n * @param meshIds\n */\nexport function createPointerTableDataTexture(gl: WebGL2RenderingContext, meshIds: IntArrayParam): GLDataTexture {\n    if (meshIds.length == 0) {\n        return emptyDataTexture;\n    }\n    const texture = gl.createTexture();\n    if (!texture) {\n        return emptyDataTexture;\n    }\n    const lenArray = meshIds.length;\n    const textureWidth = 1024;\n    const textureHeight = Math.ceil(lenArray / textureWidth);\n    if (textureHeight == 0) {\n        throw \"texture height == 0\";\n    }\n    const textureDataSize = textureWidth * textureHeight;\n    const textureData = new Uint16Array(textureDataSize);\n    textureData.set(meshIds, 0);\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texStorage2D(gl.TEXTURE_2D, 1, gl.R16UI, textureWidth, textureHeight);\n    gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, textureWidth, textureHeight, gl.RED_INTEGER, gl.UNSIGNED_SHORT, textureData, 0);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    return new GLDataTexture({gl, texture, textureWidth, textureHeight});\n}\n\n/**\n * Creates a GLDataTexture that holds matrices.\n *\n * The texture will have:\n * - 4 RGBA columns per row (each column will contain 4 packed half-float (16 bits) components).\n *   Thus, each row will contain 16 packed half-floats corresponding to a complete positions decode matrix)\n * - N rows where N is the number of matrices\n *\n * @param gl\n * @param numMatrices\n */\nexport function createMatricesDataTexture(gl: WebGL2RenderingContext, numMatrices: number): GLDataTexture {\n    const textureHeight = numMatrices;\n    if (textureHeight == 0) {\n        throw \"texture height == 0\";\n    }\n    const textureWidth = 4 * 3;\n    // @ts-ignore\n    const textureData = new Float16Array(4 * textureWidth * textureHeight);\n    const texture = gl.createTexture();\n    if (!texture) {\n        return emptyDataTexture;\n    }\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA16F, textureWidth, textureHeight);\n    // @ts-ignore\n    gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, textureWidth, textureHeight, gl.RGBA, gl.HALF_FLOAT, new Uint16Array(textureData.buffer), 0);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    return new GLDataTexture({gl, texture, textureWidth, textureHeight});\n}\n","export class DataTextureBuffer { // Temp data buffer as we build a Layer; converted into data textures once Layer is built\n\n    positionsDecompressMatrices: number[];\n    positionsCompressed: number[];\n    indices_8Bits: number[];\n    indices_16Bits: number[];\n    indices_32Bits: number[];\n    edgeIndices_8Bits: number[];\n    edgeIndices_16Bits: number[];\n    edgeIndices_32Bits: number[];\n\n    eachPrimitiveMesh_8Bits: number[];\n    eachPrimitiveMesh_16Bits: number[];\n    eachPrimitiveMesh_32Bits: number[];\n\n    eachEdgeMesh_8Bits: number[];\n    eachEdgeMesh_16Bits: number[];\n    eachEdgeMesh_32Bits: number[];\n\n    eachMeshVertexPortionBase: number[];\n    eachMeshVertexPortionOffset: number[];\n    eachMeshEdgeIndicesOffset: number[];\n\n    eachMeshColor: any[];\n    eachMeshPickColor: any[];\n    eachMeshMatrices: any[];\n    eachMeshNormalMatrix: any[];\n    eachMeshPositionsDecompressMatrix: any[];\n    eachMeshFlags1: any[];\n    eachMeshFlags2: any[];\n    eachEdgeOffset: any[];\n    eachMeshParts: number[];\n\n    constructor() {\n        this.positionsDecompressMatrices = [];\n        this.positionsCompressed = [];\n        this.indices_8Bits = [];\n        this.indices_16Bits = [];\n        this.indices_32Bits = [];\n        this.edgeIndices_8Bits = [];\n        this.edgeIndices_16Bits = [];\n        this.edgeIndices_32Bits = [];\n        this.eachMeshVertexPortionBase = [];\n        this.eachMeshVertexPortionOffset = [];\n        this.eachMeshEdgeIndicesOffset = [];\n        this.eachMeshColor = [];\n        this.eachMeshPickColor = [];\n        this.eachMeshMatrices = [];\n        this.eachMeshNormalMatrix = [];\n        this.eachMeshPositionsDecompressMatrix = [];\n        this.eachMeshFlags1 = [];\n        this.eachMeshFlags2 = [];\n        this.eachPrimitiveMesh_32Bits = [];\n        this.eachPrimitiveMesh_16Bits = [];\n        this.eachPrimitiveMesh_8Bits = [];\n        this.eachEdgeMesh_32Bits = [];\n        this.eachEdgeMesh_16Bits = [];\n        this.eachEdgeMesh_8Bits = [];\n        this.eachEdgeOffset = [];\n        this.eachMeshParts = [];\n    }\n}","import {createVec4, identityMat4, transformPoint4} from \"@xeokit/matrix\";\nimport type {View} from \"@xeokit/viewer\";\nimport type {FloatArrayParam} from \"@xeokit/math\";\n\nimport type {RendererModelImpl} from \"./RendererModelImpl\";\nimport {DataTextureSet} from \"./DataTextureSet\";\nimport {MeshCounts} from \"./MeshCounts\";\nimport {SCENE_OBJECT_FLAGS} from './SCENE_OBJECT_FLAGS';\nimport {RENDER_PASSES} from './RENDER_PASSES';\nimport {LinesPrimitive, PointsPrimitive} from \"@xeokit/constants\";\nimport {AABB3ToOBB3, collapseAABB3, expandAABB3Point3} from \"@xeokit/boundaries\";\nimport type {GeometryBucketParams, GeometryCompressedParams, MeshParams} from \"@xeokit/scene\";\nimport type {RendererTextureSetImpl} from \"./RendererTextureSetImpl\";\nimport {\n    createEachEdgeOffsetDataTexture,\n    createEachMeshAttributesDataTexture,\n    createEachMeshMatricesDataTexture,\n    createEdgeIndices16BitDataTexture,\n    createEdgeIndices32BitDataTexture,\n    createEdgeIndices8BitDataTexture,\n    createIndices16BitDataTexture,\n    createIndices32BitDataTexture,\n    createIndices8BitDataTexture,\n    createPositionsDataTexture\n} from \"./dataTextures\";\nimport type {LayerParams} from \"./LayerParams\";\nimport type {GeometryBucketHandle} from \"./GeometryBucketHandle\";\nimport {DataTextureBuffer} from \"./DataTextureBuffer\";\n\nconst MAX_MESH_PARTS = (1 << 12); // 12 bits \nconst MAX_DATATEXTURE_HEIGHT = (1 << 11); // 2048\nconst INDICES_EDGE_INDICES_ALIGNMENT_SIZE = 8;\n\nconst identityMatrix = identityMat4();\nconst tempVec4a = createVec4([0, 0, 0, 1]);\nconst tempVec4b = createVec4([0, 0, 0, 1]);\nconst tempVec4c = createVec4([0, 0, 0, 1]);\nconst tempUint8Array4 = new Uint8Array(4);\nconst tempFloat32Array3 = new Float32Array(3);\n\n\ninterface GeometryHandle { // Storage handle for a geometry within a Layer\n    aabb: FloatArrayParam;\n    positionsDecompressMatrix: FloatArrayParam;\n    geometryBucketHandles: GeometryBucketHandle[]\n}\n\ninterface MeshPartParams {\n    aabb: FloatArrayParam;\n}\n\ninterface MeshPartHandle {\n    vertsBase: number;\n    numVerts: number;\n}\n\n/**\n * @private\n */\nexport interface LayerRenderState { // What a LayerRenderer needs to render this Layer\n    materialTextureSet: RendererTextureSetImpl; // Color, opacity, metal/roughness, ambient occlusion maps\n    dataTextureSet: DataTextureSet;  // Data textures containing geometry, transforms, flags and material attributes\n    primitive: number; // Layer primitive type\n    numIndices8Bits: number; // How many 8-bit encodable indices in layer\n    numIndices16Bits: number; // How many 16-bit encodable indices in layer\n    numIndices32Bits: number; // How many 32-bit encodable indices in layer\n    numEdgeIndices8Bits: number; // How many 8-bit encodable edge indices in layer\n    numEdgeIndices16Bits: number; // How many 16-bit encodable edge indices in layer\n    numEdgeIndices32Bits: number; // How many 32-bit encodable edge indices in layer\n    numVertices: number; // How many vertices in layer\n}\n\n/**\n * @private\n */\nexport class Layer {\n\n    rendererModel: RendererModelImpl;\n    layerIndex: number;\n    meshCounts: MeshCounts;\n    renderState: LayerRenderState;\n\n    #gl: WebGL2RenderingContext;\n    #view: View;\n    #dataTextureBuffer: DataTextureBuffer;\n    #geometryHandles: { [key: string]: any };\n    #meshPartHandles: MeshPartHandle[];\n    #numMeshParts: number;\n    #deferredSetFlagsActive: boolean;\n    #deferredSetFlagsDirty: boolean;\n    #built: boolean;\n\n    constructor(layerParams: LayerParams, renderers?: any) {\n\n        this.meshCounts = new MeshCounts();\n        this.layerIndex = layerParams.layerIndex;\n        this.rendererModel = layerParams.rendererModel;\n\n        this.renderState = <LayerRenderState>{\n            primitive: layerParams.primitive,\n            dataTextureSet: new DataTextureSet(),\n            numIndices8Bits: 0,\n            numIndices16Bits: 0,\n            numIndices32Bits: 0,\n            numEdgeIndices8Bits: 0,\n            numEdgeIndices16Bits: 0,\n            numEdgeIndices32Bits: 0,\n            numVertices: 0\n        };\n\n        this.#gl = layerParams.gl;\n        this.#view = layerParams.view;\n        this.#dataTextureBuffer = new DataTextureBuffer();\n        this.#numMeshParts = 0;\n        this.#geometryHandles = {};\n        this.#meshPartHandles = [];\n        this.#built = false;\n\n        this.beginDeferredFlags();\n    }\n\n    get hash() {\n        return `layer-${this.renderState.primitive}`;\n    }\n\n    canCreateMesh(geometryCompressedParams: GeometryCompressedParams): boolean {\n        if (this.#built) {\n            throw \"Already built\";\n        }\n        const renderState = this.renderState;\n        const numGeometryBuckets = geometryCompressedParams.geometryBuckets.length;\n        if ((this.#numMeshParts + numGeometryBuckets) > MAX_MESH_PARTS) {\n            return false;\n        }\n        let numPositions = 0;\n        let numIndices = 0;\n        for (let i = 0; i < numGeometryBuckets; i++) {\n            const geometryBucket = geometryCompressedParams.geometryBuckets[i];\n            numPositions += geometryBucket.positionsCompressed.length;\n            if (geometryBucket.indices) {\n                numIndices += geometryBucket.indices.length;\n            }\n        }\n        const primVerts = (geometryCompressedParams.primitive === PointsPrimitive) ? 1 : (geometryCompressedParams.primitive == LinesPrimitive ? 2 : 3);\n        const maxIndicesOfAnyBits = Math.max(renderState.numIndices8Bits, renderState.numIndices16Bits, renderState.numIndices32Bits);\n        const numVerts = numPositions / primVerts;\n        let numTriangleIndices = numIndices / 3;\n        return (renderState.numVertices + numVerts) <= MAX_DATATEXTURE_HEIGHT * 1024 && (numTriangleIndices + numIndices) <= MAX_DATATEXTURE_HEIGHT * 1024;\n    }\n\n    hasGeometry(geometryId: string): boolean {\n        return this.#geometryHandles[geometryId];\n    }\n\n    createGeometryCompressed(geometryCompressedParams: GeometryCompressedParams) {\n        if (this.#built) {\n            throw \"Already built\";\n        }\n        const geometryBucketHandles = [];\n        for (let i = 0, len = geometryCompressedParams.geometryBuckets.length; i < len; i++) {\n            geometryBucketHandles.push(this.#createGeometryBucket(geometryCompressedParams.geometryBuckets[i]));\n        }\n        this.#geometryHandles[geometryCompressedParams.id] = <GeometryHandle>{\n            id: geometryCompressedParams.id,\n            aabb: geometryCompressedParams.aabb,\n            positionsDecompressMatrix: geometryCompressedParams.positionsDecompressMatrix,\n            geometryBucketHandles\n        };\n    }\n\n    #createGeometryBucket(geometryBucket: GeometryBucketParams): GeometryBucketHandle {\n        const renderState = this.renderState;\n        if (geometryBucket.indices) {  // Align indices to INDICES_EDGE_INDICES_ALIGNMENT_SIZE\n            const numVertsForPrim = (this.renderState.primitive === PointsPrimitive ? 1 : (this.renderState.primitive === LinesPrimitive ? 2 : 3));\n            const alignedIndicesLen = Math.ceil((geometryBucket.indices.length / numVertsForPrim) / INDICES_EDGE_INDICES_ALIGNMENT_SIZE) * INDICES_EDGE_INDICES_ALIGNMENT_SIZE * numVertsForPrim;\n            const alignedIndices = new Uint32Array(alignedIndicesLen);\n            alignedIndices.fill(0);\n            alignedIndices.set(geometryBucket.indices);\n            geometryBucket.indices = alignedIndices;\n        }\n        if (geometryBucket.edgeIndices) {  // Align edge indices to INDICES_EDGE_INDICES_ALIGNMENT_SIZE\n            const alignedEdgeIndicesLen = Math.ceil((geometryBucket.edgeIndices.length / 2) / INDICES_EDGE_INDICES_ALIGNMENT_SIZE) * INDICES_EDGE_INDICES_ALIGNMENT_SIZE * 2;\n            const alignedEdgeIndices = new Uint32Array(alignedEdgeIndicesLen);\n            alignedEdgeIndices.fill(0);\n            alignedEdgeIndices.set(geometryBucket.edgeIndices);\n            geometryBucket.edgeIndices = alignedEdgeIndices;\n        }\n        const dataTextureBuffer = this.#dataTextureBuffer;\n        const positionsCompressed = geometryBucket.positionsCompressed;\n        const indices = geometryBucket.indices;\n        const edgeIndices = geometryBucket.edgeIndices;\n        const vertexBase = dataTextureBuffer.positionsCompressed.length / 3;\n        const numVertices = positionsCompressed.length / 3;\n        for (let i = 0, len = positionsCompressed.length; i < len; i++) {\n            dataTextureBuffer.positionsCompressed.push(positionsCompressed[i]);\n        }\n        let indicesBase;\n        let numTriangles = 0;\n        if (indices) {\n            numTriangles = indices.length / 3;\n            let indicesBuffer;\n            if (numVertices <= (1 << 8)) {\n                indicesBuffer = dataTextureBuffer.indices_8Bits;\n            } else if (numVertices <= (1 << 16)) {\n                indicesBuffer = dataTextureBuffer.indices_16Bits;\n            } else {\n                indicesBuffer = dataTextureBuffer.indices_32Bits;\n            }\n            indicesBase = indicesBuffer.length / 3;\n            for (let i = 0, len = indices.length; i < len; i++) {\n                indicesBuffer.push(indices[i]);\n            }\n        }\n        let edgeIndicesBase;\n        let numEdges = 0;\n        if (edgeIndices) {\n            numEdges = edgeIndices.length / 2;\n            let edgeIndicesBuffer;\n            if (numVertices <= (1 << 8)) {\n                edgeIndicesBuffer = dataTextureBuffer.edgeIndices_8Bits;\n            } else if (numVertices <= (1 << 16)) {\n                edgeIndicesBuffer = dataTextureBuffer.edgeIndices_16Bits;\n            } else {\n                edgeIndicesBuffer = dataTextureBuffer.edgeIndices_32Bits;\n            }\n            edgeIndicesBase = edgeIndicesBuffer.length / 2;\n            for (let i = 0, len = edgeIndices.length; i < len; i++) {\n                edgeIndicesBuffer.push(edgeIndices[i]);\n            }\n        }\n        renderState.numVertices += numVertices;\n        return <GeometryBucketHandle>{\n            vertexBase,\n            numVertices,\n            numTriangles,\n            numEdges,\n            indicesBase,\n            edgeIndicesBase\n        };\n    }\n\n    createMesh(meshParams: MeshParams): number {\n        if (this.#built) {\n            throw new Error(\"Already built\");\n        }\n        const meshIndex = this.meshCounts.numMeshes;\n        const meshPartIds: number[] = [];\n        if (!meshParams.geometryId) {\n            throw new Error(\"geometryId expected\");\n        }\n        const geometryHandle = this.#geometryHandles[meshParams.geometryId];\n        if (!geometryHandle) {\n            throw new Error(\"Geometry not found\");\n        }\n        geometryHandle.geometryBucketHandles.forEach((geometryBucketHandle: GeometryBucketHandle) => {\n            const meshPartId = this.#createMeshPart(meshParams, geometryHandle, geometryBucketHandle);\n            meshPartIds.push(meshPartId);\n        });\n        const worldAABB = collapseAABB3();\n        const geometryOBB = AABB3ToOBB3(geometryHandle.aabb);\n        for (let i = 0, len = geometryOBB.length; i < len; i += 4) {\n            tempVec4a[0] = geometryOBB[i + 0];\n            tempVec4a[1] = geometryOBB[i + 1];\n            tempVec4a[2] = geometryOBB[i + 2];\n            if (meshParams.matrix) {\n                transformPoint4(meshParams.matrix, tempVec4a, tempVec4b);\n                // transformPoint4(meshParams.matrix, tempVec4b, tempVec4c);\n                expandAABB3Point3(worldAABB, tempVec4b);\n            } else {\n                expandAABB3Point3(worldAABB, tempVec4b);\n            }\n        }\n        this.meshCounts.numMeshes++;\n        return meshIndex;\n    }\n\n    #createMeshPart(meshParams: MeshParams, geometryHandle: GeometryHandle, geometryBucketHandle: GeometryBucketHandle): number {\n\n        const dataTextureBuffer = this.#dataTextureBuffer;\n\n        const renderState = this.renderState;\n\n        const matrix = meshParams.matrix || identityMatrix;\n        const color = meshParams.color || [255, 255, 255];\n        const opacity = meshParams.opacity;\n        const metallic = meshParams.metallic;\n        const roughness = meshParams.roughness;\n\n        const positionsIndex = dataTextureBuffer.positionsCompressed.length;\n        const vertsIndex = positionsIndex / 3;\n\n        dataTextureBuffer.eachMeshPositionsDecompressMatrix.push(geometryHandle.positionsDecompressMatrix);\n        dataTextureBuffer.eachMeshMatrices.push(matrix);\n        dataTextureBuffer.eachMeshColor.push([color[0], color[1], color[2], 255]);\n        dataTextureBuffer.eachMeshPickColor.push(meshParams.pickColor);\n\n        let currentNumIndices;\n        if (geometryBucketHandle.numVertices <= (1 << 8)) {\n            currentNumIndices = renderState.numIndices8Bits;\n        } else if (geometryBucketHandle.numVertices <= (1 << 16)) {\n            currentNumIndices = renderState.numIndices16Bits;\n        } else {\n            currentNumIndices = renderState.numIndices32Bits;\n        }\n        dataTextureBuffer.eachMeshVertexPortionBase.push(geometryBucketHandle.vertexBase);\n        dataTextureBuffer.eachMeshVertexPortionOffset.push(currentNumIndices / 3 - geometryBucketHandle.indicesBase);\n\n        // Edge indices\n\n        let currentNumEdgeIndices;\n        if (geometryBucketHandle.numVertices <= (1 << 8)) {\n            currentNumEdgeIndices = renderState.numEdgeIndices8Bits;\n        } else if (geometryBucketHandle.numVertices <= (1 << 16)) {\n            currentNumEdgeIndices = renderState.numEdgeIndices16Bits;\n        } else {\n            currentNumEdgeIndices = renderState.numEdgeIndices32Bits;\n        }\n        dataTextureBuffer.eachMeshEdgeIndicesOffset.push(currentNumEdgeIndices / 2 - geometryBucketHandle.edgeIndicesBase);\n\n        // Primitive -> mesh lookup\n\n        const meshPartId = this.#meshPartHandles.length;\n\n        if (geometryBucketHandle.numTriangles > 0) {\n            const numIndices = geometryBucketHandle.numTriangles * 3;\n            let eachPrimitiveMeshBuffer;\n            if (geometryBucketHandle.numVertices <= (1 << 8)) {\n                eachPrimitiveMeshBuffer = dataTextureBuffer.eachPrimitiveMesh_8Bits;\n                renderState.numIndices8Bits += numIndices;\n            } else if (geometryBucketHandle.numVertices <= (1 << 16)) {\n                eachPrimitiveMeshBuffer = dataTextureBuffer.eachPrimitiveMesh_16Bits;\n                renderState.numIndices16Bits += numIndices;\n            } else {\n                eachPrimitiveMeshBuffer = dataTextureBuffer.eachPrimitiveMesh_32Bits;\n                renderState.numIndices32Bits += numIndices;\n            }\n            for (let i = 0; i < geometryBucketHandle.numTriangles; i += INDICES_EDGE_INDICES_ALIGNMENT_SIZE) {\n                eachPrimitiveMeshBuffer.push(meshPartId);\n            }\n        }\n\n        // Edge index -> mesh lookup\n\n        if (geometryBucketHandle.numEdges > 0) {\n            let numEdgeIndices = geometryBucketHandle.numEdges * 2;\n            let edgeIndicesMeshIdBuffer;\n            if (geometryBucketHandle.numVertices <= (1 << 8)) {\n                edgeIndicesMeshIdBuffer = dataTextureBuffer.eachEdgeMesh_8Bits;\n                renderState.numEdgeIndices8Bits += numEdgeIndices;\n            } else if (geometryBucketHandle.numVertices <= (1 << 16)) {\n                edgeIndicesMeshIdBuffer = dataTextureBuffer.eachEdgeMesh_16Bits;\n                renderState.numEdgeIndices16Bits += numEdgeIndices;\n            } else {\n                edgeIndicesMeshIdBuffer = dataTextureBuffer.eachEdgeMesh_32Bits;\n                renderState.numEdgeIndices32Bits += numEdgeIndices;\n            }\n            for (let i = 0; i < geometryBucketHandle.numEdges; i += INDICES_EDGE_INDICES_ALIGNMENT_SIZE) {\n                edgeIndicesMeshIdBuffer.push(meshPartId);\n            }\n        }\n        dataTextureBuffer.eachEdgeOffset.push([0, 0, 0]);\n\n        this.#meshPartHandles.push(<MeshPartHandle>{\n            vertsBase: vertsIndex,\n            numVerts: geometryBucketHandle.numTriangles //////////////////// TODO\n        });\n        this.#numMeshParts++;\n        return meshPartId;\n    }\n\n    build() {\n        if (this.#built) {\n            throw new Error(\"Already built\");\n        }\n        const gl = this.#gl;\n        const dataTextureBuffer = this.#dataTextureBuffer;\n        const dataTextureSet = this.renderState.dataTextureSet;\n        dataTextureSet.positions = createPositionsDataTexture(gl, dataTextureBuffer.positionsCompressed);\n        dataTextureSet.indices_8Bits = createIndices8BitDataTexture(gl, dataTextureBuffer.indices_8Bits);\n        dataTextureSet.indices_16Bits = createIndices16BitDataTexture(gl, dataTextureBuffer.indices_16Bits);\n        dataTextureSet.indices_32Bits = createIndices32BitDataTexture(gl, dataTextureBuffer.indices_32Bits);\n        dataTextureSet.edgeIndices_8Bits = createEdgeIndices8BitDataTexture(gl, dataTextureBuffer.edgeIndices_8Bits);\n        dataTextureSet.edgeIndices_16Bits = createEdgeIndices16BitDataTexture(gl, dataTextureBuffer.edgeIndices_16Bits);\n        dataTextureSet.edgeIndices_32Bits = createEdgeIndices32BitDataTexture(gl, dataTextureBuffer.edgeIndices_32Bits);\n        dataTextureSet.eachMeshAttributes = createEachMeshAttributesDataTexture(gl,\n            dataTextureBuffer.eachMeshColor,\n            dataTextureBuffer.eachMeshPickColor,\n            dataTextureBuffer.eachMeshVertexPortionBase,\n            dataTextureBuffer.eachMeshVertexPortionOffset,\n            dataTextureBuffer.eachMeshEdgeIndicesOffset);\n        dataTextureSet.eachMeshMatrices = createEachMeshMatricesDataTexture(gl, dataTextureBuffer.eachMeshPositionsDecompressMatrix, dataTextureBuffer.eachMeshMatrices);\n        // dataTextureSet.eachPrimitiveMesh8BitsDataTexture = createPointerTableDataTexture(gl, dataTextureBuffer.eachPrimitiveMesh_8Bits);\n        // dataTextureSet.eachPrimitiveMesh16BitsDataTexture = createPointerTableDataTexture(gl, dataTextureBuffer.eachPrimitiveMesh_16Bits);\n        // dataTextureSet.eachPrimitiveMesh32BitsDataTexture = createPointerTableDataTexture(gl, dataTextureBuffer.eachPrimitiveMesh_32Bits);\n        // dataTextureSet.eachEdgeMesh8BitsDataTexture = createPointerTableDataTexture(gl, dataTextureBuffer.eachEdgeMesh_8Bits);\n        // dataTextureSet.eachEdgeMesh16BitsDataTexture = createPointerTableDataTexture(gl, dataTextureBuffer.eachEdgeMesh_16Bits);\n        // dataTextureSet.eachEdgeMesh32BitsDataTexture = createPointerTableDataTexture(gl, dataTextureBuffer.eachEdgeMesh_32Bits);\n        dataTextureSet.eachEdgeOffset = createEachEdgeOffsetDataTexture(gl, dataTextureBuffer.eachEdgeOffset);\n        dataTextureSet.build();\n        // @ts-ignore\n        this.#dataTextureBuffer = null;\n        this.#geometryHandles = {};\n        this.#meshPartHandles = [];\n        this.#built = true;\n    }\n\n    isEmpty() {\n        return this.meshCounts.numMeshes == 0;\n    }\n\n    initFlags(meshIndex: number, flags: number, meshTransparent: boolean) {\n        if (flags & SCENE_OBJECT_FLAGS.VISIBLE) {\n            this.meshCounts.numVisible++;\n        }\n        if (flags & SCENE_OBJECT_FLAGS.HIGHLIGHTED) {\n            this.meshCounts.numHighlighted++;\n        }\n        if (flags & SCENE_OBJECT_FLAGS.XRAYED) {\n            this.meshCounts.numXRayed++;\n        }\n        if (flags & SCENE_OBJECT_FLAGS.SELECTED) {\n            this.meshCounts.numSelected++;\n        }\n        if (flags & SCENE_OBJECT_FLAGS.CLIPPABLE) {\n            this.meshCounts.numClippable++;\n        }\n        if (flags & SCENE_OBJECT_FLAGS.EDGES) {\n            this.meshCounts.numEdges++;\n        }\n        if (flags & SCENE_OBJECT_FLAGS.PICKABLE) {\n            this.meshCounts.numPickable++;\n        }\n        if (flags & SCENE_OBJECT_FLAGS.CULLED) {\n            this.meshCounts.numCulled++;\n        }\n        if (meshTransparent) {\n            this.meshCounts.numTransparent++;\n        }\n        this.#setMeshFlags(meshIndex, flags, meshTransparent);\n        this.#setMeshFlags2(meshIndex, flags);\n    }\n\n    beginDeferredFlags() {\n        this.#deferredSetFlagsActive = true;\n    }\n\n    commitDeferredFlags() {\n        this.#deferredSetFlagsActive = false;\n        if (!this.#deferredSetFlagsDirty) {\n            return;\n        }\n        this.#deferredSetFlagsDirty = false;\n        const gl = this.#gl;\n        const dataTextureSet = this.renderState.dataTextureSet;\n        // @ts-ignore\n        gl.bindTexture(gl.TEXTURE_2D, dataTextureSet.eachMeshAttributes.texture);\n        // @ts-ignore\n        gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, dataTextureSet.eachMeshAttributes.textureWidth, dataTextureSet.eachMeshAttributes.textureHeight, gl.RGBA_INTEGER, gl.UNSIGNED_BYTE, dataTextureSet.eachMeshAttributes.textureData);\n        // @ts-ignore\n        gl.bindTexture(gl.TEXTURE_2D, dataTextureSet.eachEdgeOffset.texture);\n        // @ts-ignore\n        gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, dataTextureSet.eachEdgeOffset.textureWidth, dataTextureSet.eachEdgeOffset.textureHeight, gl.RGB, gl.FLOAT, dataTextureSet.eachEdgeOffset.textureData);\n    }\n\n    flushInitFlags() {\n        this.commitDeferredFlags();\n    }\n\n    setMeshVisible(meshIndex: number, flags: number, transparent: boolean) {\n        if (!this.#built) {\n            throw \"Not built\";\n        }\n        if (flags & SCENE_OBJECT_FLAGS.VISIBLE) {\n            debugger;\n            this.meshCounts.numVisible++;\n        } else {\n            this.meshCounts.numVisible--;\n        }\n        this.#setMeshFlags(meshIndex, flags, transparent);\n    }\n\n    setMeshHighlighted(meshIndex: number, flags: number, transparent: boolean) {\n        if (!this.#built) {\n            throw \"Not built\";\n        }\n        if (flags & SCENE_OBJECT_FLAGS.HIGHLIGHTED) {\n            this.meshCounts.numHighlighted++;\n        } else {\n            this.meshCounts.numHighlighted--;\n        }\n        this.#setMeshFlags(meshIndex, flags, transparent);\n    }\n\n    setMeshXRayed(meshIndex: number, flags: number, transparent: boolean) {\n        if (!this.#built) {\n            throw \"Not built\";\n        }\n        if (flags & SCENE_OBJECT_FLAGS.XRAYED) {\n            this.meshCounts.numXRayed++;\n        } else {\n            this.meshCounts.numXRayed--;\n        }\n        this.#setMeshFlags(meshIndex, flags, transparent);\n    }\n\n    setMeshSelected(meshIndex: number, flags: number, transparent: boolean) {\n        if (!this.#built) {\n            throw \"Not built\";\n        }\n        if (flags & SCENE_OBJECT_FLAGS.SELECTED) {\n            this.meshCounts.numSelected++;\n        } else {\n            this.meshCounts.numSelected--;\n        }\n        this.#setMeshFlags(meshIndex, flags, transparent);\n    }\n\n    setMeshEdges(meshIndex: number, flags: number, transparent: boolean) {\n        if (!this.#built) {\n            throw \"Not built\";\n        }\n        if (flags & SCENE_OBJECT_FLAGS.EDGES) {\n            this.meshCounts.numEdges++;\n        } else {\n            this.meshCounts.numEdges--;\n        }\n        this.#setMeshFlags(meshIndex, flags, transparent);\n    }\n\n    setMeshClippable(meshIndex: number, flags: number) {\n        if (!this.#built) {\n            throw \"Not built\";\n        }\n        if (flags & SCENE_OBJECT_FLAGS.CLIPPABLE) {\n            this.meshCounts.numClippable++;\n        } else {\n            this.meshCounts.numClippable--;\n        }\n        this.#setMeshFlags2(meshIndex, flags);\n    }\n\n    setMeshCulled(meshIndex: number, flags: number, transparent: boolean) {\n        if (!this.#built) {\n            throw \"Not built\";\n        }\n        if (flags & SCENE_OBJECT_FLAGS.CULLED) {\n            this.meshCounts.numCulled++;\n        } else {\n            this.meshCounts.numCulled--;\n        }\n        this.#setMeshFlags(meshIndex, flags, transparent);\n    }\n\n    setMeshCollidable(meshIndex: number, flags: number) {\n        if (!this.#built) {\n            throw \"Not built\";\n        }\n    }\n\n    setMeshPickable(meshIndex: number, flags: number, transparent: boolean) {\n        if (!this.#built) {\n            throw \"Not built\";\n        }\n        if (flags & SCENE_OBJECT_FLAGS.PICKABLE) {\n            this.meshCounts.numPickable++;\n        } else {\n            this.meshCounts.numPickable--;\n        }\n        this.#setMeshFlags(meshIndex, flags, transparent);\n    }\n\n    setMeshColor(meshIndex: number, color: FloatArrayParam, transparent?: boolean) {\n        if (!this.#built) {\n            throw \"Not built\";\n        }\n        const dataTextureSet = this.renderState.dataTextureSet;\n        const gl = this.#gl;\n        tempUint8Array4 [0] = color[0];\n        tempUint8Array4 [1] = color[1];\n        tempUint8Array4 [2] = color[2];\n        tempUint8Array4 [3] = color[3];\n        // @ts-ignore\n        dataTextureSet.eachMeshAttributes.textureData.set(tempUint8Array4, meshIndex * 28);\n        if (this.#deferredSetFlagsActive) {\n            this.#deferredSetFlagsDirty = true;\n            return;\n        }\n        // @ts-ignore\n        gl.bindTexture(gl.TEXTURE_2D, dataTextureSet.eachMeshAttributes.texture);\n        gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, meshIndex, 1, 1, gl.RGBA_INTEGER, gl.UNSIGNED_BYTE, tempUint8Array4);\n        // gl.bindTexture (gl.TEXTURE_2D, null);\n    }\n\n    setMeshTransparent(meshIndex: number, flags: number, transparent: boolean) {\n        if (!this.#built) {\n            throw \"Not built\";\n        }\n        if (transparent) {\n            this.meshCounts.numTransparent++;\n            this.meshCounts.numTransparent++;\n        } else {\n            this.meshCounts.numTransparent--;\n            this.meshCounts.numTransparent--;\n        }\n        this.#setMeshFlags(meshIndex, flags, transparent);\n    }\n\n    #setMeshFlags(meshIndex: number, flags: number, transparent: boolean) {\n        if (!this.#built) {\n            throw \"Not built\";\n        }\n        const visible = !!(flags & SCENE_OBJECT_FLAGS.VISIBLE);\n        const xrayed = !!(flags & SCENE_OBJECT_FLAGS.XRAYED);\n        const highlighted = !!(flags & SCENE_OBJECT_FLAGS.HIGHLIGHTED);\n        const selected = !!(flags & SCENE_OBJECT_FLAGS.SELECTED);\n        const edges = !!(flags & SCENE_OBJECT_FLAGS.EDGES);\n        const pickable = !!(flags & SCENE_OBJECT_FLAGS.PICKABLE);\n        const culled = !!(flags & SCENE_OBJECT_FLAGS.CULLED);\n        let f0; // Color\n        if (!visible || culled || xrayed) { // Highlight & select are layered on top of color - not mutually exclusive\n            f0 = RENDER_PASSES.NOT_RENDERED;\n        } else {\n            if (transparent) {\n                f0 = RENDER_PASSES.COLOR_TRANSPARENT;\n            } else {\n                f0 = RENDER_PASSES.COLOR_OPAQUE;\n            }\n        }\n        let f1; // Silhouette\n        if (!visible || culled) {\n            f1 = RENDER_PASSES.NOT_RENDERED;\n        } else if (selected) {\n            f1 = RENDER_PASSES.SILHOUETTE_SELECTED;\n        } else if (highlighted) {\n            f1 = RENDER_PASSES.SILHOUETTE_HIGHLIGHTED;\n        } else if (xrayed) {\n            f1 = RENDER_PASSES.SILHOUETTE_XRAYED;\n        } else {\n            f1 = RENDER_PASSES.NOT_RENDERED;\n        }\n        let f2 = 0; // Edges\n        if (!visible || culled) {\n            f2 = RENDER_PASSES.NOT_RENDERED;\n        } else if (selected) {\n            f2 = RENDER_PASSES.EDGES_SELECTED;\n        } else if (highlighted) {\n            f2 = RENDER_PASSES.EDGES_HIGHLIGHTED;\n        } else if (xrayed) {\n            f2 = RENDER_PASSES.EDGES_XRAYED;\n        } else if (edges) {\n            if (transparent) {\n                f2 = RENDER_PASSES.EDGES_COLOR_TRANSPARENT;\n            } else {\n                f2 = RENDER_PASSES.EDGES_COLOR_OPAQUE;\n            }\n        } else {\n            f2 = RENDER_PASSES.NOT_RENDERED;\n        }\n        let f3 = (visible && !culled && pickable) ? RENDER_PASSES.PICK : RENDER_PASSES.NOT_RENDERED; // Pick\n        const dataTextureSet = this.renderState.dataTextureSet;\n        const gl = this.#gl;\n        tempUint8Array4 [0] = f0;\n        tempUint8Array4 [1] = f1;\n        tempUint8Array4 [2] = f2;\n        tempUint8Array4 [3] = f3;\n        if (this.#deferredSetFlagsActive) {\n            // @ts-ignore\n            dataTextureSet.eachMeshAttributes.textureData.set(tempUint8Array4, meshIndex * 28 + 8);\n            this.#deferredSetFlagsDirty = true;\n            return;\n        }\n        // @ts-ignore\n        gl.bindTexture(gl.TEXTURE_2D, dataTextureSet.eachMeshAttributes.texture);\n        gl.texSubImage2D(gl.TEXTURE_2D, 0, 2, meshIndex, 1, 1, gl.RGBA_INTEGER, gl.UNSIGNED_BYTE, tempUint8Array4);\n        // gl.bindTexture (gl.TEXTURE_2D, null);\n    }\n\n    #setMeshFlags2(meshIndex: number, flags: number) {\n        if (!this.#built) {\n            throw \"Not built\";\n        }\n        const clippable = !!(flags & SCENE_OBJECT_FLAGS.CLIPPABLE) ? 255 : 0;\n        const dataTextureSet = this.renderState.dataTextureSet;\n        const gl = this.#gl;\n        tempUint8Array4 [0] = clippable;\n        tempUint8Array4 [1] = 0;\n        tempUint8Array4 [2] = 1;\n        tempUint8Array4 [3] = 2;\n        if (this.#deferredSetFlagsActive) {\n            // @ts-ignore\n            dataTextureSet.eachMeshAttributes.textureData.set(tempUint8Array4, meshIndex * 28 + 12); // Flags\n            this.#deferredSetFlagsDirty = true;\n            return;\n        }\n        // @ts-ignore\n        gl.bindTexture(gl.TEXTURE_2D, dataTextureSet.eachMeshAttributes.texture);\n        gl.texSubImage2D(gl.TEXTURE_2D, 0, 3, meshIndex, 1, 1, gl.RGBA_INTEGER, gl.UNSIGNED_BYTE, tempUint8Array4);\n        // gl.bindTexture (gl.TEXTURE_2D, null);\n    }\n\n    setMeshOffset(meshIndex: number, offset: FloatArrayParam) {\n        if (!this.#built) {\n            throw \"Not built\";\n        }\n        const dataTextureSet = this.renderState.dataTextureSet;\n        const gl = this.#gl;\n        tempFloat32Array3 [0] = offset[0];\n        tempFloat32Array3 [1] = offset[1];\n        tempFloat32Array3 [2] = offset[2];\n        // dataTextureSet.eachMeshOffset.textureData.set(tempFloat32Array3, meshIndex * 3);\n        if (this.#deferredSetFlagsActive) {\n            this.#deferredSetFlagsDirty = true;\n            return;\n        }\n        //gl.bindTexture(gl.TEXTURE_2D, dataTextureSet.eachMeshOffset.texture);\n        gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, meshIndex, 1, 1, gl.RGB, gl.FLOAT, tempFloat32Array3);\n        // gl.bindTexture (gl.TEXTURE_2D, null);\n    }\n\n    setMeshMatrix(meshIndex: number, matrix: FloatArrayParam) {\n        if (!this.#built) {\n            throw \"Not built\";\n        }\n        const dataTextureSet = this.renderState.dataTextureSet;\n        const gl = this.#gl;\n\n        if (this.#deferredSetFlagsActive) {\n            this.#deferredSetFlagsDirty = true;\n            return;\n        }\n\n    }\n\n    setMeshViewMatrixIndex(meshIndex: number, index: number) {\n        if (!this.#built) {\n            throw \"Not built\";\n        }\n        const dataTextureSet = this.renderState.dataTextureSet;\n        const gl = this.#gl;\n        // tempUint8Array4 [0] = color[0];\n        // tempUint8Array4 [1] = color[1];\n        // tempUint8Array4 [2] = color[2];\n        // tempUint8Array4 [3] = color[3];\n        // // @ts-ignore\n        // dataTextureSet.eachMeshAttributes.textureData.set(tempUint8Array4, meshIndex * 28);\n        if (this.#deferredSetFlagsActive) {\n            this.#deferredSetFlagsDirty = true;\n            return;\n        }\n        // // @ts-ignore\n        // gl.bindTexture(gl.TEXTURE_2D, dataTextureSet.eachMeshAttributes.texture);\n        // gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, meshIndex, 1, 1, gl.RGBA_INTEGER, gl.UNSIGNED_BYTE, tempUint8Array4);\n        // // gl.bindTexture (gl.TEXTURE_2D, null);\n    }\n\n    destroy() {\n        this.renderState.dataTextureSet.destroy();\n    }\n}\n\n","import type {Geometry, RendererGeometry} from \"@xeokit/scene\";\n\n/**\n * @private\n */\nexport class RendererGeometryImpl implements RendererGeometry {\n\n    constructor() {\n    }\n}","import type {RendererTexture, Texture} from \"@xeokit/scene\";\nimport type {GLTexture} from \"@xeokit/webglutils\";\n\n/**\n * @private\n */\nexport class RendererTextureImpl implements RendererTexture {\n\n    texture: Texture | null;\n    texture2D: GLTexture;\n\n    constructor(texture: Texture | null, texture2D: GLTexture) {\n        this.texture = texture\n        this.texture2D = texture2D;\n    }\n\n    destroy() {\n        if (this.texture2D) {\n            this.texture2D.destroy();\n        }\n    }\n\n\n}\n","\nimport {createAABB3} from \"@xeokit/boundaries\";\nimport {createVec3} from \"@xeokit/matrix\";\nimport type {FloatArrayParam} from \"@xeokit/math\";\nimport {SCENE_OBJECT_FLAGS} from './SCENE_OBJECT_FLAGS';\nimport type {RendererMeshImpl} from \"./RendererMeshImpl\";\nimport type {RendererViewObject} from \"viewer/src/RendererViewObject\";\nimport type {RendererModel, RendererObject, SceneModel, SceneObject} from \"@xeokit/scene\";\n\nconst tempIntRGB = new Uint16Array([0, 0, 0]);\n\n/**\n * @private\n */\nexport class RendererObjectImpl implements RendererObject, RendererViewObject {\n\n    readonly id: string;\n    readonly model: SceneModel;\n    readonly sceneObject: SceneObject;\n    readonly layerId: string | null;\n\n    readonly rendererMeshes: RendererMeshImpl[];\n\n    #flags: number;\n    #aabb: FloatArrayParam;\n    #offsetAABB: FloatArrayParam;\n    #offset: FloatArrayParam;\n    #colorizeUpdated: boolean;\n    #opacityUpdated: boolean;\n\n    constructor(params: {\n        id: string,\n        rendererModel: RendererModel,\n        rendererMeshes: RendererMeshImpl[],\n        aabb: any,\n        layerId?: string\n    }) {\n        this.id = params.id;\n        //this.model = params.rendererModel;\n        this.rendererMeshes = params.rendererMeshes || [];\n        this.#flags = 0;\n        this.#aabb = params.aabb;\n        this.#offsetAABB = createAABB3(params.aabb);\n        this.#offset = createVec3();\n        this.#colorizeUpdated = false;\n        this.#opacityUpdated = false;\n\n        this.layerId = params.layerId || null;\n\n        for (let i = 0, len = this.rendererMeshes.length; i < len; i++) {  // TODO: tidier way? Refactor?\n            this.rendererMeshes[i].setSceneObject(this);\n        }\n    }\n\n    get aabb(): FloatArrayParam {\n        return this.#offsetAABB;\n    }\n\n    setVisible(viewIndex: number, visible: boolean): void {\n        if (!!(this.#flags & SCENE_OBJECT_FLAGS.VISIBLE) === visible) {\n            return;\n        }\n        this.#flags = visible ? this.#flags | SCENE_OBJECT_FLAGS.VISIBLE : this.#flags & ~SCENE_OBJECT_FLAGS.VISIBLE;\n        for (let i = 0, len = this.rendererMeshes.length; i < len; i++) {\n            this.rendererMeshes[i].setVisible(this.#flags);\n        }\n    }\n\n    setHighlighted(viewIndex: number, highlighted: boolean): void {\n        if (!!(this.#flags & SCENE_OBJECT_FLAGS.HIGHLIGHTED) === highlighted) {\n            return;\n        }\n        this.#flags = highlighted ? this.#flags | SCENE_OBJECT_FLAGS.HIGHLIGHTED : this.#flags & ~SCENE_OBJECT_FLAGS.HIGHLIGHTED;\n        for (let i = 0, len = this.rendererMeshes.length; i < len; i++) {\n            this.rendererMeshes[i].setHighlighted(this.#flags);\n        }\n    }\n\n    setXRayed(viewIndex: number, xrayed: boolean): void {\n        if (!!(this.#flags & SCENE_OBJECT_FLAGS.XRAYED) === xrayed) {\n            return;\n        }\n        this.#flags = xrayed ? this.#flags | SCENE_OBJECT_FLAGS.XRAYED : this.#flags & ~SCENE_OBJECT_FLAGS.XRAYED;\n        for (let i = 0, len = this.rendererMeshes.length; i < len; i++) {\n            this.rendererMeshes[i].setXRayed(this.#flags);\n        }\n    }\n\n    setSelected(viewIndex: number, selected: boolean): void {\n        if (!!(this.#flags & SCENE_OBJECT_FLAGS.SELECTED) === selected) {\n            return;\n        }\n        this.#flags = selected ? this.#flags | SCENE_OBJECT_FLAGS.SELECTED : this.#flags & ~SCENE_OBJECT_FLAGS.SELECTED;\n        for (let i = 0, len = this.rendererMeshes.length; i < len; i++) {\n            this.rendererMeshes[i].setSelected(this.#flags);\n        }\n    }\n\n    setEdges(viewIndex: number, edges: boolean): void {\n        if (!!(this.#flags & SCENE_OBJECT_FLAGS.EDGES) === edges) {\n            return;\n        }\n        this.#flags = edges ? this.#flags | SCENE_OBJECT_FLAGS.EDGES : this.#flags & ~SCENE_OBJECT_FLAGS.EDGES;\n        for (let i = 0, len = this.rendererMeshes.length; i < len; i++) {\n            this.rendererMeshes[i].setEdges(this.#flags);\n        }\n    }\n\n    setCulled(viewIndex: number, culled: boolean): void {\n        if (!!(this.#flags & SCENE_OBJECT_FLAGS.CULLED) === culled) {\n            return;\n        }\n        this.#flags = culled ? this.#flags | SCENE_OBJECT_FLAGS.CULLED : this.#flags & ~SCENE_OBJECT_FLAGS.CULLED;\n        for (let i = 0, len = this.rendererMeshes.length; i < len; i++) {\n            this.rendererMeshes[i].setCulled(this.#flags);\n        }\n    }\n\n    setClippable(viewIndex: number, clippable: boolean): void {\n        if ((!!(this.#flags & SCENE_OBJECT_FLAGS.CLIPPABLE)) === clippable) {\n            return;\n        }\n        this.#flags = clippable ? this.#flags | SCENE_OBJECT_FLAGS.CLIPPABLE : this.#flags & ~SCENE_OBJECT_FLAGS.CLIPPABLE;\n        for (let i = 0, len = this.rendererMeshes.length; i < len; i++) {\n            this.rendererMeshes[i].setClippable(this.#flags);\n        }\n    }\n\n    setCollidable(viewIndex: number, collidable: boolean): void {\n        if (!!(this.#flags & SCENE_OBJECT_FLAGS.COLLIDABLE) === collidable) {\n            return;\n        }\n        this.#flags = collidable ? this.#flags | SCENE_OBJECT_FLAGS.COLLIDABLE : this.#flags & ~SCENE_OBJECT_FLAGS.COLLIDABLE;\n        for (let i = 0, len = this.rendererMeshes.length; i < len; i++) {\n            this.rendererMeshes[i].setCollidable(this.#flags);\n        }\n    }\n\n    setPickable(viewIndex: number, pickable: boolean): void {\n        if (!!(this.#flags & SCENE_OBJECT_FLAGS.PICKABLE) === pickable) {\n            return;\n        }\n        this.#flags = pickable ? this.#flags | SCENE_OBJECT_FLAGS.PICKABLE : this.#flags & ~SCENE_OBJECT_FLAGS.PICKABLE;\n        for (let i = 0, len = this.rendererMeshes.length; i < len; i++) {\n            this.rendererMeshes[i].setPickable(this.#flags);\n        }\n    }\n\n    setColorize(viewIndex: number, color?: FloatArrayParam): void { // [0..1, 0..1, 0..1]\n        if (color) {\n            tempIntRGB[0] = Math.floor(color[0] * 255.0); // Quantize\n            tempIntRGB[1] = Math.floor(color[1] * 255.0);\n            tempIntRGB[2] = Math.floor(color[2] * 255.0);\n            for (let i = 0, len = this.rendererMeshes.length; i < len; i++) {\n                this.rendererMeshes[i].setColorize(tempIntRGB);\n            }\n        } else {\n            for (let i = 0, len = this.rendererMeshes.length; i < len; i++) {\n                this.rendererMeshes[i].setColorize(null);\n            }\n        }\n    }\n\n    setOpacity(viewIndex: number, opacity?: number): void {\n        if (this.rendererMeshes.length === 0) {\n            return;\n        }\n        // @ts-ignore\n        const lastOpacityQuantized = this.rendererMeshes[0].colorize[3];\n        let opacityQuantized = 255;\n        if (opacity !== null && opacity !== undefined) {\n            if (opacity < 0) {\n                opacity = 0;\n            } else if (opacity > 1) {\n                opacity = 1;\n            }\n            opacityQuantized = Math.floor(opacity * 255.0); // Quantize\n            if (lastOpacityQuantized === opacityQuantized) {\n                return;\n            }\n        } else {\n            opacityQuantized = 255.0;\n            if (lastOpacityQuantized === opacityQuantized) {\n                return;\n            }\n        }\n        for (let i = 0, len = this.rendererMeshes.length; i < len; i++) {\n            this.rendererMeshes[i].setOpacity(opacityQuantized, this.#flags);\n        }\n    }\n\n    setOffset(viewIndex: number, offset: FloatArrayParam): void {\n        // if (offset) {\n        //     this.#offset[0] = offset[0];\n        //     this.#offset[1] = offset[1];\n        //     this.#offset[2] = offset[2];\n        // } else {\n        //     this.#offset[0] = 0;\n        //     this.#offset[1] = 0;\n        //     this.#offset[2] = 0;\n        // }\n        // for (let i = 0, len = this.rendererMeshes.length; i < len; i++) {\n        //     this.rendererMeshes[i].setOffset(this.#offset);\n        // }\n        // this.#offsetAABB[0] = this.#aabb[0] + this.#offset[0];\n        // this.#offsetAABB[1] = this.#aabb[1] + this.#offset[1];\n        // this.#offsetAABB[2] = this.#aabb[2] + this.#offset[2];\n        // this.#offsetAABB[3] = this.#aabb[3] + this.#offset[0];\n        // this.#offsetAABB[4] = this.#aabb[4] + this.#offset[1];\n        // this.#offsetAABB[5] = this.#aabb[5] + this.#offset[2];\n        // // this.scene.#aabbDirty = true;\n        // // this.scene._objectOffsetUpdated(this, offset);\n        // // this.rendererModel._aabbDirty = true;\n        // // this.rendererModel.glRedraw();\n    }\n\n    build(): void {\n        for (let i = 0, len = this.rendererMeshes.length; i < len; i++) {\n            this.rendererMeshes[i].build(this.#flags);\n        }\n    }\n\n    finalize2(): void {\n        for (let i = 0, len = this.rendererMeshes.length; i < len; i++) {\n            this.rendererMeshes[i].finalize2();\n        }\n    }\n\n    destroy(): void {\n        for (let i = 0, len = this.rendererMeshes.length; i < len; i++) {\n            this.rendererMeshes[i].destroy();\n        }\n    }\n}\n","import type {RendererGeometry, RendererMesh, RendererObject, RendererTextureSet, SceneObject} from \"@xeokit/scene\";\nimport type {FloatArrayParam} from \"@xeokit/math\";\nimport {createAABB3} from \"@xeokit/boundaries\";\n\nimport type {RenderContext} from \"./RenderContext\";\nimport type {Layer} from \"./Layer\";\nimport type {Pickable} from \"./Pickable\";\nimport {createMat4, mulMat4, transformPoint3, translationMat4c} from \"@xeokit/matrix\";\nimport type {Tile, TileManager} from \"./TileManager\";\n\nconst tempMat4a = createMat4();\nconst tempMat4b = createMat4();\n\n\n/**\n * @private\n */\nexport class RendererMeshImpl implements RendererMesh, Pickable {\n\n    id: string;\n    color: FloatArrayParam;\n    rendererGeometry: RendererGeometry;\n    rendererTextureSet: RendererTextureSet;\n    matrix: FloatArrayParam;\n    metallic: number;\n    roughness: number;\n    opacity: number;\n    pickId: number;\n    tileManager: TileManager;\n    tile: Tile;\n    sceneObjectRenderer: RendererObject | null;\n    aabb: FloatArrayParam;\n    layer: Layer;\n    meshIndex: number;\n    colorize: FloatArrayParam;\n    colorizing: boolean;\n    transparent: boolean;\n\n\n    constructor(params: {\n        tileManager: TileManager,\n        layer: Layer,\n        id: string,\n        matrix: FloatArrayParam;\n        metallic: number;\n        roughness: number;\n        color: FloatArrayParam,\n        opacity: number,\n        rendererTextureSet: RendererTextureSet\n        rendererGeometry: RendererGeometry,\n        meshIndex: number\n    }) {\n        this.sceneObjectRenderer = null;\n        this.tileManager = params.tileManager;\n        this.id = params.id;\n        this.pickId = 0;\n        this.color = [params.color[0], params.color[1], params.color[2], params.opacity]; // [0..255]\n        this.colorize = [params.color[0], params.color[1], params.color[2], params.opacity]; // [0..255]\n        this.colorizing = false;\n        this.transparent = (params.opacity < 255);\n        this.layer = params.layer;\n        this.matrix = params.matrix;\n        this.metallic = params.metallic;\n        this.roughness = params.roughness;\n        this.opacity = params.opacity;\n        this.aabb = createAABB3();\n        this.rendererTextureSet = params.rendererTextureSet;\n        this.rendererGeometry = params.rendererGeometry;\n        this.meshIndex = params.meshIndex;\n    }\n\n    delegatePickedEntity(): SceneObject {\n        throw new Error(\"Method not implemented.\");\n    }\n\n    setSceneObject(sceneObjectRenderer: RendererObject) {\n        this.sceneObjectRenderer = sceneObjectRenderer;\n    }\n\n    build(flags: number) {\n        // @ts-ignore\n        this.layer.initFlags(this.meshIndex, flags, this.transparent);\n    }\n\n    finalize2() {\n        // @ts-ignore\n        if (this.layer.flushInitFlags) {\n            this.layer.flushInitFlags();\n        }\n    }\n\n    setVisible(flags: any) {\n        this.layer.setMeshVisible(this.meshIndex, flags, this.transparent);\n    }\n\n    setMatrix(matrix: FloatArrayParam): void {\n        const center = transformPoint3(matrix, [0, 0, 0]);\n        const oldTile = this.tile;\n        this.tile = oldTile ? this.tileManager.updateTileCenter(oldTile, center) : this.tileManager.getTile(center);\n        const tileChanged = !oldTile || oldTile.id !== this.tile.id;\n        const tileCenter = this.tile.center;\n        const needRTC = (tileCenter[0] !== 0 || tileCenter[1] !== 0 || tileCenter[2] !== 0);\n        this.layer.setMeshMatrix(this.meshIndex, needRTC\n            ? mulMat4(matrix, translationMat4c(-tileCenter[0], -tileCenter[1], -tileCenter[2], tempMat4a), tempMat4b)\n            : matrix);\n        if (tileChanged) {\n            this.layer.setMeshViewMatrixIndex(this.meshIndex, this.tile.index);\n        }\n    }\n\n    setMetallic(metallic: number): void {\n    }\n\n    setRoughness(roughness: number): void {\n    }\n\n    setColor(color: FloatArrayParam) {\n        this.color[0] = color[0];\n        this.color[1] = color[1];\n        this.color[2] = color[2];\n        if (!this.colorizing) {\n            this.layer.setMeshColor(this.meshIndex, this.color);\n        }\n    }\n\n    setColorize(colorize: FloatArrayParam | null) {\n        const setOpacity = false;\n        if (colorize) {\n            this.colorize[0] = colorize[0];\n            this.colorize[1] = colorize[1];\n            this.colorize[2] = colorize[2];\n            this.layer.setMeshColor(this.meshIndex, this.colorize, setOpacity);\n            this.colorizing = true;\n        } else {\n            this.layer.setMeshColor(this.meshIndex, this.color, setOpacity);\n            this.colorizing = false;\n        }\n    }\n\n    setOpacity(opacity: number, flags: number) {\n        const newTransparent = (opacity < 255);\n        const lastTransparent = this.transparent;\n        const changingTransparency = (lastTransparent !== newTransparent);\n        this.color[3] = opacity;\n        this.colorize[3] = opacity;\n        this.transparent = newTransparent;\n        if (this.colorizing) {\n            this.layer.setMeshColor(this.meshIndex, this.colorize);\n        } else {\n            this.layer.setMeshColor(this.meshIndex, this.color);\n        }\n        if (changingTransparency) {\n            this.layer.setMeshTransparent(this.meshIndex, flags, newTransparent);\n        }\n    }\n\n    setHighlighted(flags: number) {\n        this.layer.setMeshHighlighted(this.meshIndex, flags, this.transparent);\n    }\n\n    setXRayed(flags: number) {\n        this.layer.setMeshXRayed(this.meshIndex, flags, this.transparent);\n    }\n\n    setSelected(flags: number) {\n        this.layer.setMeshSelected(this.meshIndex, flags, this.transparent);\n    }\n\n    setEdges(flags: number) {\n        this.layer.setMeshEdges(this.meshIndex, flags, this.transparent);\n    }\n\n    setClippable(flags: number) {\n        this.layer.setMeshClippable(this.meshIndex, flags);\n    }\n\n    setCollidable(flags: number) {\n        this.layer.setMeshCollidable(this.meshIndex, flags);\n    }\n\n    setPickable(flags: number) {\n        this.layer.setMeshPickable(this.meshIndex, flags, this.transparent);\n    }\n\n    setCulled(flags: number) {\n        this.layer.setMeshCulled(this.meshIndex, flags, this.transparent);\n    }\n\n    canPickTriangle() {\n        return false;\n    }\n\n    drawPickTriangles(drawFlags: any, renderContext: any) {\n        // NOP\n    }\n\n    pickTriangleSurface(pickResult: any) {\n        // NOP\n    }\n\n    canPickWorldPos() {\n        return true;\n    }\n\n    drawPickNormals(renderContext: RenderContext) {\n        //this.sceneObjectRenderer.rendererModel.drawPickNormals(renderContext);\n    }\n\n    // delegatePickedEntity(): SceneObjectRendererCommands {\n    //     return <SceneObjectRendererCommands>this.sceneObjectRenderer;\n    // }\n\n    destroy() {\n        if (this.tile && this.tileManager) {\n            this.tileManager.putTile(this.tile);\n        }\n    }\n}\n","import type { RendererTextureSet} from \"@xeokit/scene\";\nimport type {RendererTextureImpl} from \"./RendererTextureImpl\";\n\n\n/**\n * @private\n */\nexport class RendererTextureSetImpl implements RendererTextureSet {\n\n    public readonly id: string;\n    public readonly colorTexture: RendererTextureImpl;\n    public readonly metallicRoughnessTexture: RendererTextureImpl;\n    public readonly emissiveTexture: RendererTextureImpl;\n    public readonly occlusionTexture: RendererTextureImpl;\n\n    constructor(params: {\n        id: string;\n        colorTexture: RendererTextureImpl;\n        metallicRoughnessTexture: RendererTextureImpl;\n        emissiveTexture: RendererTextureImpl;\n        occlusionTexture: RendererTextureImpl;\n    }) {\n        this.id = params.id;\n        this.colorTexture = params.colorTexture;\n        this.metallicRoughnessTexture = params.metallicRoughnessTexture;\n        this.emissiveTexture = params.emissiveTexture;\n        this.occlusionTexture = params.occlusionTexture;\n    }\n}\n","import {EventDispatcher} from \"strongly-typed-events\";\nimport {Component, EventEmitter, TextureTranscoder} from \"@xeokit/core\";\nimport {createUUID, loadArraybuffer} from \"@xeokit/utils\";\nimport {collapseAABB3, expandAABB3} from \"@xeokit/boundaries\";\nimport {composeMat4, createMat4, createVec3, createVec4, eulerToQuat, identityQuat, mulMat4} from \"@xeokit/matrix\";\n\nimport type {FloatArrayParam} from \"@xeokit/math\";\nimport type {Camera, View} from \"@xeokit/viewer\";\nimport type {Viewer} from \"@xeokit/viewer\";\nimport {GLTexture} from \"@xeokit/webglutils\";\nimport type {\n    Geometry,\n    GeometryCompressedParams,\n    Mesh,\n    RendererGeometry,\n    RendererMesh,\n    RendererModel,\n    RendererTexture,\n    RendererTextureSet,\n    SceneModel,\n    SceneObject,\n    Texture,\n    TextureSet\n} from \"@xeokit/scene\";\nimport type {WebGLRenderer} from \"./WebGLRenderer\";\nimport {Layer} from \"./Layer\";\nimport type {RenderContext} from \"./RenderContext\";\nimport {RendererGeometryImpl} from \"./RendererGeometryImpl\";\nimport type {RendererViewObject} from \"viewer/src/RendererViewObject\";\nimport {RendererTextureImpl} from \"./RendererTextureImpl\";\nimport {RendererObjectImpl} from \"./RendererObjectImpl\";\nimport {RendererMeshImpl} from \"./RendererMeshImpl\";\nimport {RendererTextureSetImpl} from \"./RendererTextureSetImpl\";\nimport type {LayerParams} from \"./LayerParams\";\nimport type {TileManager} from \"./TileManager\";\n\n\nconst tempVec3a = createVec3();\nconst tempMat4 = createMat4();\n\nconst defaultScale = createVec3([1, 1, 1]);\nconst defaultPosition = createVec3([0, 0, 0]);\nconst defaultRotation = createVec3([0, 0, 0]);\nconst defaultQuaternion = identityQuat();\n\nconst defaultColorTextureId = \"defaultColorTexture\";\nconst defaultMetalRoughTextureId = \"defaultMetalRoughTexture\";\nconst defaultNormalsTextureId = \"defaultNormalsTexture\";\nconst defaultEmissiveTextureId = \"defaultEmissiveTexture\";\nconst defaultOcclusionTextureId = \"defaultOcclusionTexture\";\nconst defaultTextureSetId = \"defaultTextureSet\";\n\n/**\n * @private\n */\nexport class RendererModelImpl extends Component implements RendererModel {\n\n    readonly qualityRender: boolean;\n    declare readonly id: string;\n    declare readonly destroyed: boolean;\n    declare built: boolean;\n\n    sceneModel: SceneModel | null;\n\n    rendererGeometries: { [key: string]: RendererGeometry };\n    rendererTextures: { [key: string]: RendererTexture };\n    rendererTextureSets: { [key: string]: RendererTextureSet; };\n    rendererMeshes: { [key: string]: RendererMesh };\n    rendererObjects: { [key: string]: RendererObjectImpl };\n    rendererObjectsList: RendererObjectImpl[];\n\n    rendererViewObjects: { [key: string]: RendererViewObject };\n\n    readonly viewer: Viewer;\n\n    layerList: Layer[];\n    readonly onBuilt: EventEmitter<RendererModel, null>;\n    declare readonly onDestroyed: EventEmitter<Component, null>;\n    #view: View;\n    #webglRenderer: WebGLRenderer;\n    #renderContext: RenderContext;\n    #position: FloatArrayParam;\n    #rotation: FloatArrayParam;\n    #quaternion: FloatArrayParam;\n    #scale: FloatArrayParam;\n    #worldMatrix: FloatArrayParam;\n    #viewMatrix: FloatArrayParam;\n    #colorTextureEnabled: boolean;\n    #backfaces: boolean;\n    #layers: { [key: string]: Layer };\n    #numGeometries: number;\n    #numTriangles: number;\n    #numLines: number;\n    #numPoints: number;\n    #numViewerObjects: number;\n    #textureTranscoder: TextureTranscoder;\n    #aabbDirty: boolean;\n    #edgeThreshold: number;\n    #currentLayers: { [key: string]: any };\n    #aabb: FloatArrayParam;\n    #viewMatrixDirty: boolean;\n    #worldMatrixNonIdentity: boolean;\n    #onCameraViewMatrix: () => void;\n    #layerId: string | undefined;\n\n    constructor(params: {\n        id: string;\n        sceneModel: SceneModel;\n        matrix?: FloatArrayParam;\n        scale?: FloatArrayParam;\n        view: View;\n        webglRenderer: WebGLRenderer;\n        renderContext: RenderContext;\n        quaternion?: FloatArrayParam;\n        rotation?: FloatArrayParam;\n        position?: FloatArrayParam;\n        edgeThreshold?: number;\n        textureTranscoder: TextureTranscoder;\n        qualityRender?: boolean;\n        layerId?: string;\n    }) {\n\n        super(params.view);\n\n        this.id = params.id;\n        this.sceneModel = params.sceneModel\n        this.viewer = params.view.viewer;\n\n        this.#view = params.view;\n        this.#webglRenderer = params.webglRenderer;\n        this.#renderContext = params.renderContext;\n        this.#textureTranscoder = params.textureTranscoder;\n\n        this.#aabb = collapseAABB3();\n        this.#aabbDirty = false;\n        this.#layers = {};\n        this.layerList = [];\n        this.#currentLayers = {};\n\n        this.rendererGeometries = {};\n        this.rendererTextures = {};\n        this.rendererTextureSets = {};\n        this.rendererMeshes = {};\n        this.rendererObjects = {};\n        this.rendererObjectsList = [];\n\n        this.rendererViewObjects = {};\n\n        this.#numGeometries = 0;\n        this.#numViewerObjects = 0;\n\n        this.#numTriangles = 0;\n        this.#numLines = 0;\n        this.#numPoints = 0;\n        this.#edgeThreshold = params.edgeThreshold || 10;\n\n        this.built = false;\n\n        // Build static matrix\n\n        this.#position = createVec3(params.position || [0, 0, 0]);\n        this.#rotation = createVec3(params.rotation || [0, 0, 0]);\n        this.#quaternion = createVec4(params.quaternion || [0, 0, 0, 1]);\n        if (params.rotation) {\n            eulerToQuat(this.#rotation, \"XYZ\", this.#quaternion);\n        }\n        this.#scale = createVec3(params.scale || [1, 1, 1]);\n        this.#worldMatrix = createMat4();\n        composeMat4(this.#position, this.#quaternion, this.#scale, this.#worldMatrix);\n\n        if (params.matrix || params.position || params.rotation || params.scale || params.quaternion) {\n            this.#viewMatrix = createMat4();\n            this.#viewMatrixDirty = true;\n            this.#worldMatrixNonIdentity = true;\n        }\n\n        this.qualityRender = (params.qualityRender !== false);\n\n        this.#layerId = params.layerId;\n\n        this.#onCameraViewMatrix = this.#view.camera.onViewMatrix.subscribe((camera: Camera, viewMatrix: FloatArrayParam) => {\n            this.#viewMatrixDirty = true;\n        });\n\n        this.#createDefaultTextureSetRenderer();\n\n        this.onBuilt = new EventEmitter(new EventDispatcher<RendererModel, null>());\n\n        this.#addModel(params.sceneModel);\n\n        // this.layerList.sort((a, b) => {\n        //     if (a.sortId < b.sortId) {\n        //         return -1;\n        //     }\n        //     if (a.sortId > b.sortId) {\n        //         return 1;\n        //     }\n        //     return 0;\n        // });\n        for (let i = 0, len = this.layerList.length; i < len; i++) {\n            const layer = this.layerList[i];\n            layer.layerIndex = i;\n        }\n        this.#currentLayers = {};\n        this.built = true;\n        this.#webglRenderer.setImageDirty();\n        //     this.#view.viewer.scene.setAABBDirty();\n        this.onBuilt.dispatch(this, null);\n    }\n\n    get position(): FloatArrayParam {\n        return this.#position;\n    }\n\n    get rotation(): FloatArrayParam {\n        return this.#rotation;\n    }\n\n    get quaternion(): FloatArrayParam {\n        return this.#quaternion;\n    }\n\n    get scale(): FloatArrayParam {\n        return this.#scale;\n    }\n\n    get worldMatrix(): FloatArrayParam {\n        return this.#worldMatrix;\n    }\n\n    get viewMatrix(): FloatArrayParam {\n        if (!this.#viewMatrix) {\n            return this.#view.camera.viewMatrix;\n        }\n        if (this.#viewMatrixDirty) {\n            mulMat4(this.#view.camera.viewMatrix, this.#worldMatrix, this.#viewMatrix);\n            this.#viewMatrixDirty = false;\n        }\n        return this.#viewMatrix;\n    }\n\n    get colorTextureEnabled() {\n        return this.#colorTextureEnabled;\n    }\n\n    get backfaces(): boolean {\n        return this.#backfaces;\n    }\n\n    set backfaces(backfaces: boolean) {\n        backfaces = !!backfaces;\n        this.#backfaces = backfaces;\n        this.#webglRenderer.setImageDirty();\n    }\n\n    get matrix(): FloatArrayParam {\n        return this.#worldMatrix;\n    }\n\n    get aabb(): FloatArrayParam {\n        if (this.#aabbDirty) {\n            this.#rebuildAABB();\n        }\n        return this.#aabb;\n    }\n\n    get numTriangles(): number {\n        return this.#numTriangles;\n    }\n\n    get numLines(): number {\n        return this.#numLines;\n    }\n\n    get numPoints(): number {\n        return this.#numPoints;\n    }\n\n    setVisible(viewIndex: number, visible: boolean): void {\n        for (let i = 0, len = this.rendererObjectsList.length; i < len; i++) {\n            this.rendererObjectsList[i].setVisible(viewIndex, visible);\n        }\n        this.#webglRenderer.setImageDirty(viewIndex);\n    }\n\n    setXRayed(viewIndex: number, xrayed: boolean): void {\n        for (let i = 0, len = this.rendererObjectsList.length; i < len; i++) {\n            this.rendererObjectsList[i].setXRayed(viewIndex, xrayed);\n        }\n        this.#webglRenderer.setImageDirty(viewIndex);\n    }\n\n    setHighlighted(viewIndex: number, highlighted: boolean): void {\n        for (let i = 0, len = this.rendererObjectsList.length; i < len; i++) {\n            this.rendererObjectsList[i].setHighlighted(viewIndex, highlighted);\n        }\n        this.#webglRenderer.setImageDirty(viewIndex);\n    }\n\n    setSelected(viewIndex: number, selected: boolean): void {\n        for (let i = 0, len = this.rendererObjectsList.length; i < len; i++) {\n            this.rendererObjectsList[i].setSelected(viewIndex, selected);\n        }\n        this.#webglRenderer.setImageDirty(viewIndex);\n    }\n\n    setEdges(viewIndex: number, edges: boolean): void {\n        for (let i = 0, len = this.rendererObjectsList.length; i < len; i++) {\n            this.rendererObjectsList[i].setEdges(viewIndex, edges);\n        }\n        this.#webglRenderer.setImageDirty(viewIndex);\n    }\n\n    setCulled(viewIndex: number, culled: boolean): void {\n        for (let i = 0, len = this.rendererObjectsList.length; i < len; i++) {\n            this.rendererObjectsList[i].setCulled(viewIndex, culled);\n        }\n        this.#webglRenderer.setImageDirty(viewIndex);\n    }\n\n    setClippable(viewIndex: number, clippable: boolean): void {\n        for (let i = 0, len = this.rendererObjectsList.length; i < len; i++) {\n            this.rendererObjectsList[i].setClippable(viewIndex, clippable);\n        }\n        this.#webglRenderer.setImageDirty(viewIndex);\n    }\n\n    setCollidable(viewIndex: number, collidable: boolean): void {\n        for (let i = 0, len = this.rendererObjectsList.length; i < len; i++) {\n            this.rendererObjectsList[i].setCollidable(viewIndex, collidable);\n        }\n    }\n\n    setPickable(viewIndex: number, pickable: boolean): void {\n        for (let i = 0, len = this.rendererObjectsList.length; i < len; i++) {\n            this.rendererObjectsList[i].setPickable(viewIndex, pickable);\n        }\n    }\n\n    setColorize(viewIndex: number, colorize: FloatArrayParam): void {\n        for (let i = 0, len = this.rendererObjectsList.length; i < len; i++) {\n            this.rendererObjectsList[i].setColorize(viewIndex, colorize);\n        }\n    }\n\n    setOpacity(viewIndex: number, opacity: number): void {\n        for (let i = 0, len = this.rendererObjectsList.length; i < len; i++) {\n            this.rendererObjectsList[i].setOpacity(viewIndex, opacity);\n        }\n    }\n\n    /*\n    rebuildDrawFlags() {\n        this.drawFlags.reset();\n        this.#updateDrawFlagsVisibleLayers();\n        if (this.drawFlags.numLayers > 0 && this.drawFlags.numVisibleLayers === 0) {\n            this.drawFlags.culled = true;\n            return;\n        }\n        this.#updateDrawFlags();\n    }\n\n    drawColorOpaque(renderContext: RenderContext): void {\n        if (this.meshCounts.numVisible === 0) {\n            return;\n        }\n        const drawFlags = this.drawFlags;\n        for (let i = 0, len = drawFlags.visibleLayers.length; i < len; i++) {\n            const layerIndex = drawFlags.visibleLayers[i];\n            this.layerList[layerIndex].drawColorOpaque(drawFlags, renderContext);\n        }\n    }\n\n    drawColorTransparent(renderContext: RenderContext): void {\n        if (this.meshCounts.numVisible === 0) {\n            return;\n        }\n        const drawFlags = this.drawFlags;\n        for (let i = 0, len = drawFlags.visibleLayers.length; i < len; i++) {\n            const layerIndex = drawFlags.visibleLayers[i];\n            this.layerList[layerIndex].drawColorTransparent(drawFlags, renderContext);\n        }\n    }\n\n    drawDepth(renderContext: RenderContext): void { // Dedicated to SAO because it skips transparent objects\n        if (this.meshCounts.numVisible === 0) {\n            return;\n        }\n        const drawFlags = this.drawFlags;\n        for (let i = 0, len = drawFlags.visibleLayers.length; i < len; i++) {\n            const layerIndex = drawFlags.visibleLayers[i];\n            this.layerList[layerIndex].drawDepth(drawFlags, renderContext);\n        }\n    }\n\n    drawNormals(renderContext: RenderContext): void { // Dedicated to SAO because it skips transparent objects\n        if (this.meshCounts.numVisible === 0) {\n            return;\n        }\n        const drawFlags = this.drawFlags;\n        for (let i = 0, len = drawFlags.visibleLayers.length; i < len; i++) {\n            const layerIndex = drawFlags.visibleLayers[i];\n            this.layerList[layerIndex].drawNormals(drawFlags, renderContext);\n        }\n    }\n\n    drawSilhouetteXRayed(renderContext: RenderContext): void {\n        if (this.meshCounts.numVisible === 0) {\n            return;\n        }\n        const drawFlags = this.drawFlags;\n        for (let i = 0, len = drawFlags.visibleLayers.length; i < len; i++) {\n            const layerIndex = drawFlags.visibleLayers[i];\n            this.layerList[layerIndex].drawSilhouetteXRayed(drawFlags, renderContext);\n        }\n    }\n\n    drawSilhouetteHighlighted(renderContext: RenderContext): void {\n        if (this.meshCounts.numVisible === 0) {\n            return;\n        }\n        const drawFlags = this.drawFlags;\n        for (let i = 0, len = drawFlags.visibleLayers.length; i < len; i++) {\n            const layerIndex = drawFlags.visibleLayers[i];\n            this.layerList[layerIndex].drawSilhouetteHighlighted(drawFlags, renderContext);\n        }\n    }\n\n    drawSilhouetteSelected(renderContext: RenderContext): void {\n        if (this.meshCounts.numVisible === 0) {\n            return;\n        }\n        const drawFlags = this.drawFlags;\n        for (let i = 0, len = drawFlags.visibleLayers.length; i < len; i++) {\n            const layerIndex = drawFlags.visibleLayers[i];\n            this.layerList[layerIndex].drawSilhouetteSelected(drawFlags, renderContext);\n        }\n    }\n\n    drawEdgesColorOpaque(renderContext: RenderContext): void {\n        if (this.meshCounts.numVisible === 0) {\n            return;\n        }\n        const drawFlags = this.drawFlags;\n        for (let i = 0, len = drawFlags.visibleLayers.length; i < len; i++) {\n            const layerIndex = drawFlags.visibleLayers[i];\n            this.layerList[layerIndex].drawEdgesColorOpaque(drawFlags, renderContext);\n        }\n    }\n\n    drawEdgesColorTransparent(renderContext: RenderContext): void {\n        if (this.meshCounts.numVisible === 0) {\n            return;\n        }\n        const drawFlags = this.drawFlags;\n        for (let i = 0, len = drawFlags.visibleLayers.length; i < len; i++) {\n            const layerIndex = drawFlags.visibleLayers[i];\n            this.layerList[layerIndex].drawEdgesColorTransparent(drawFlags, renderContext);\n        }\n    }\n\n    drawEdgesXRayed(renderContext: RenderContext): void {\n        if (this.meshCounts.numVisible === 0) {\n            return;\n        }\n        const drawFlags = this.drawFlags;\n        for (let i = 0, len = drawFlags.visibleLayers.length; i < len; i++) {\n            const layerIndex = drawFlags.visibleLayers[i];\n            this.layerList[layerIndex].drawEdgesXRayed(drawFlags, renderContext);\n        }\n    }\n\n    drawEdgesHighlighted(renderContext: RenderContext) {\n        if (this.meshCounts.numVisible === 0) {\n            return;\n        }\n        const drawFlags = this.drawFlags;\n        for (let i = 0, len = drawFlags.visibleLayers.length; i < len; i++) {\n            const layerIndex = drawFlags.visibleLayers[i];\n            this.layerList[layerIndex].drawEdgesHighlighted(drawFlags, renderContext);\n        }\n    }\n\n    drawEdgesSelected(renderContext: RenderContext) {\n        if (this.meshCounts.numVisible === 0) {\n            return;\n        }\n        const drawFlags = this.drawFlags;\n        for (let i = 0, len = drawFlags.visibleLayers.length; i < len; i++) {\n            const layerIndex = drawFlags.visibleLayers[i];\n            this.layerList[layerIndex].drawEdgesSelected(drawFlags, renderContext);\n        }\n    }\n\n    drawOcclusion(renderContext: RenderContext) {\n        if (this.meshCounts.numVisible === 0) {\n            return;\n        }\n        const drawFlags = this.drawFlags;\n        for (let i = 0, len = drawFlags.visibleLayers.length; i < len; i++) {\n            const layerIndex = drawFlags.visibleLayers[i];\n            this.layerList[layerIndex].drawOcclusion(drawFlags, renderContext);\n        }\n    }\n\n    drawShadow(renderContext: RenderContext) {\n        if (this.meshCounts.numVisible === 0) {\n            return;\n        }\n        const drawFlags = this.drawFlags;\n        for (let i = 0, len = drawFlags.visibleLayers.length; i < len; i++) {\n            const layerIndex = drawFlags.visibleLayers[i];\n            this.layerList[layerIndex].drawShadow(drawFlags, renderContext);\n        }\n    }\n\n    drawPickMesh(renderContext: RenderContext) {\n        if (this.meshCounts.numVisible === 0) {\n            return;\n        }\n        const drawFlags = this.drawFlags;\n        for (let i = 0, len = drawFlags.visibleLayers.length; i < len; i++) {\n            const layerIndex = drawFlags.visibleLayers[i];\n            this.layerList[layerIndex].drawPickMesh(drawFlags, renderContext);\n        }\n    }\n\n    drawPickDepths(renderContext: RenderContext) {\n        if (this.meshCounts.numVisible === 0) {\n            return;\n        }\n        const drawFlags = this.drawFlags;\n        for (let i = 0, len = drawFlags.visibleLayers.length; i < len; i++) {\n            const layerIndex = drawFlags.visibleLayers[i];\n            this.layerList[layerIndex].drawPickDepths(drawFlags, renderContext);\n        }\n    }\n\n    drawPickNormals(renderContext: RenderContext) {\n        if (this.meshCounts.numVisible === 0) {\n            return;\n        }\n        const drawFlags = this.drawFlags;\n        for (let i = 0, len = drawFlags.visibleLayers.length; i < len; i++) {\n            const layerIndex = drawFlags.visibleLayers[i];\n            this.layerList[layerIndex].drawPickNormals(drawFlags, renderContext);\n        }\n    }\n*/\n    destroy() {\n        if (this.destroyed) {\n            return;\n        }\n        this.#removeModel();\n        this.#view.camera.onViewMatrix.unsubscribe(this.#onCameraViewMatrix);\n        for (let layerId in this.#currentLayers) {\n            if (this.#currentLayers.hasOwnProperty(layerId)) {\n                this.#currentLayers[layerId].destroy();\n            }\n        }\n        for (let i = 0, len = this.layerList.length; i < len; i++) {\n            this.layerList[i].destroy();\n        }\n        for (let objectId in this.rendererObjects) {\n            this.rendererObjects[objectId].destroy();\n        }\n        for (let meshId in this.rendererMeshes) {\n            //    this.#webglRenderer.deregisterPickable(this.rendererMeshes[meshId].pickId);\n        }\n        this.#currentLayers = {};\n        this.#layers = {};\n        this.layerList = [];\n        this.rendererGeometries = {};\n        this.rendererTextures = {};\n        this.rendererTextureSets = {};\n        this.rendererMeshes = {};\n        this.rendererViewObjects = {};\n        // this.#view.viewer.setAABBDirty();\n        this.onBuilt.clear();\n        super.destroy();\n    }\n\n    #addModel(sceneModel: SceneModel): void {\n\n        const textures = sceneModel.textures;\n        const geometries = sceneModel.geometries;\n        const meshes = sceneModel.meshes;\n        const objects = sceneModel.objects;\n\n        if (textures) {\n            for (let textureId in textures) {\n                const texture = textures[textureId];\n                this.#addTexture(texture);\n            }\n        }\n        if (geometries) {\n            for (let geometryId in geometries) {\n                const geometry = geometries[geometryId];\n                this.#addGeometry(geometry);\n            }\n        }\n        if (meshes) {\n            for (let meshId in meshes) {\n                const mesh = meshes[meshId];\n                this.#addMesh(mesh);\n            }\n        }\n        if (objects) {\n            for (let geometryId in objects) {\n                const object = objects[geometryId];\n                this.#addObject(object);\n            }\n        }\n        for (let layerId in this.#currentLayers) {\n            if (this.#currentLayers.hasOwnProperty(layerId)) {\n                this.#currentLayers[layerId].build();\n            }\n        }\n        for (let i = 0, len = this.rendererObjectsList.length; i < len; i++) {\n            const objectRenderer = this.rendererObjectsList[i];\n            objectRenderer.build();\n        }\n        for (let i = 0, len = this.rendererObjectsList.length; i < len; i++) {\n            const objectRenderer = this.rendererObjectsList[i];\n            objectRenderer.finalize2();\n        }\n    }\n\n    #addTexture(texture: Texture): void {\n        const textureId = texture.id;\n        if (this.rendererTextures[textureId]) {\n            throw new Error(\"RendererTexture already created: \" + textureId);\n        }\n        const glTexture = new GLTexture({gl: this.#renderContext.gl});\n        if (texture.preloadColor) {\n            glTexture.setPreloadColor(texture.preloadColor);\n        }\n        if (texture.image) { // Ignore transcoder for Images\n            const image = texture.image;\n            image.crossOrigin = \"Anonymous\";\n            glTexture.setImage(image, {\n                minFilter: texture.minFilter,\n                magFilter: texture.magFilter,\n                wrapS: texture.wrapS,\n                wrapT: texture.wrapT,\n                wrapR: texture.wrapR,\n                flipY: texture.flipY,\n                encoding: texture.encoding\n            });\n        } else if (texture.src) {\n            const ext = texture.src.split('.').pop();\n            switch (ext) { // Don't transcode recognized image file types\n                case \"jpeg\":\n                case \"jpg\":\n                case \"png\":\n                case \"gif\":\n                    const image = new Image();\n                    image.onload = () => {\n                        glTexture.setImage(image, {\n                            minFilter: texture.minFilter,\n                            magFilter: texture.magFilter,\n                            wrapS: texture.wrapS,\n                            wrapT: texture.wrapT,\n                            wrapR: texture.wrapR,\n                            flipY: texture.flipY,\n                            encoding: texture.encoding\n                        });\n                    };\n                    image.src = texture.src; // URL or Base64 string\n                    break;\n                default: // Assume other file types need transcoding\n                    if (!this.#textureTranscoder) {\n                        this.error(`Can't create texture from 'src' - rendererModel needs to be configured with a TextureTranscoder for this file type ('${ext}')`);\n                    } else {\n                        loadArraybuffer(texture.src, (arrayBuffer: ArrayBuffer) => {\n                                if (!arrayBuffer.byteLength) {\n                                    this.error(`Can't create texture from 'src': file data is zero length`);\n                                    return;\n                                }\n                                this.#textureTranscoder.transcode([arrayBuffer]).then((compressedTextureData) => {\n                                    glTexture.setCompressedData(compressedTextureData);\n                                    this.#webglRenderer.setImageDirty();\n                                });\n                            },\n                            (errMsg: string) => {\n                                this.error(`Can't create texture from 'src': ${errMsg}`);\n                            });\n                    }\n                    break;\n            }\n        } else if (texture.buffers) { // Buffers implicitly require transcoding\n            if (!this.#textureTranscoder) {\n                this.error(`Can't create texture from 'buffers' - rendererModel needs to be configured with a TextureTranscoder for this option`);\n            } else {\n                this.#textureTranscoder.transcode(texture.buffers).then((compressedTextureData) => {\n                    glTexture.setCompressedData(compressedTextureData);\n                    this.#webglRenderer.setImageDirty();\n                });\n            }\n        }\n        const rendererTexture = new RendererTextureImpl(texture, glTexture);\n        texture.rendererTexture = rendererTexture;\n        this.rendererTextures[textureId] = rendererTexture;\n    }\n\n    #addGeometry(geometry: Geometry): void {\n        const geometryId = geometry.id;\n        if (this.rendererGeometries[geometryId]) {\n            throw new Error(`GeometryRenderer already created: ${geometryId}`);\n        }\n        const rendererGeometry = new RendererGeometryImpl();\n        this.rendererGeometries[geometryId] = rendererGeometry;\n        geometry.rendererGeometry = rendererGeometry;\n        this.#numGeometries++;\n    }\n\n    #addMesh(mesh: Mesh): void {\n        const rendererGeometry = this.rendererGeometries[mesh.geometry.id];\n        if (!rendererGeometry) {\n            throw new Error(\"RendererGeometry not found\");\n        }\n        const rendererTextureSet = this.rendererTextureSets[(<TextureSet>mesh.textureSet).id];\n        if (!rendererTextureSet) {\n            throw new Error(\"rendererTextureSet not found\");\n        }\n\n        const layer = this.#getLayer((<TextureSet>mesh.textureSet).id, mesh.geometry);\n\n        if (!layer) {\n            return;\n        }\n\n        if (!layer.hasGeometry(mesh.geometry.id)) {\n            layer.createGeometryCompressed(mesh.geometry)\n        }\n\n        let meshMatrix;\n        let worldMatrix = this.#worldMatrixNonIdentity ? this.#worldMatrix : null;\n\n        meshMatrix = mesh.matrix;\n\n\n        const color = (mesh.color) ? new Uint8Array([Math.floor(mesh.color[0] * 255), Math.floor(mesh.color[1] * 255), Math.floor(mesh.color[2] * 255)]) : [255, 255, 255];\n        const opacity = (mesh.opacity !== undefined && mesh.opacity !== null) ? Math.floor(mesh.opacity * 255) : 255;\n        const metallic = (mesh.metallic !== undefined && mesh.metallic !== null) ? Math.floor(mesh.metallic * 255) : 0;\n        const roughness = (mesh.roughness !== undefined && mesh.roughness !== null) ? Math.floor(mesh.roughness * 255) : 255;\n\n        const meshRenderer = new RendererMeshImpl({\n            tileManager: <TileManager>this.#webglRenderer.tileManager,\n            id: mesh.id,\n            layer,\n            color,\n            opacity,\n            matrix: meshMatrix,\n            metallic,\n            roughness,\n            rendererTextureSet,\n            rendererGeometry,\n            meshIndex: 0\n        });\n\n        meshRenderer.pickId = this.#webglRenderer.registerPickable(meshRenderer);\n\n        const a = meshRenderer.pickId >> 24 & 0xFF;\n        const b = meshRenderer.pickId >> 16 & 0xFF;\n        const g = meshRenderer.pickId >> 8 & 0xFF;\n        const r = meshRenderer.pickId & 0xFF;\n\n        const pickColor = new Uint8Array([r, g, b, a]); // Quantized pick color\n        collapseAABB3(meshRenderer.aabb);\n\n        const meshIndex = layer.createMesh({\n            id: mesh.id,\n            geometryId: mesh.geometry.id,\n            color,\n            opacity,\n            metallic,\n            roughness,\n            matrix: meshMatrix,\n            //     worldMatrix: worldMatrix,\n            //    aabb: mesh.aabb,\n            pickColor\n        });\n        this.#numGeometries++;\n        expandAABB3(this.#aabb, meshRenderer.aabb);\n        meshRenderer.layer = layer;\n        meshRenderer.meshIndex = meshIndex;\n        this.rendererMeshes[mesh.id] = meshRenderer;\n    }\n\n\n    // build() {\n    //     if (this.destroyed) {\n    //         this.log(\"rendererModel already destroyed\");\n    //         return;\n    //     }\n    //     if (this.built) {\n    //         this.log(\"rendererModel already built\");\n    //         return;\n    //     }\n    //     for (let layerId in this.#currentLayers) {\n    //         if (this.#currentLayers.hasOwnProperty(layerId)) {\n    //             this.#currentLayers[layerId].build();\n    //         }\n    //     }\n    //     for (let i = 0, len = this.objectList.length; i < len; i++) {\n    //         const objectRenderer = this.objectList[i];\n    //         objectRenderer.build();\n    //     }\n    //     for (let i = 0, len = this.objectList.length; i < len; i++) {\n    //         const objectRenderer = this.objectList[i];\n    //         objectRenderer.finalize2();\n    //     }\n    //     // this.layerList.sort((a, b) => {\n    //     //     if (a.sortId < b.sortId) {\n    //     //         return -1;\n    //     //     }\n    //     //     if (a.sortId > b.sortId) {\n    //     //         return 1;\n    //     //     }\n    //     //     return 0;\n    //     // });\n    //     for (let i = 0, len = this.layerList.length; i < len; i++) {\n    //         const layer = this.layerList[i];\n    //         layer.layerIndex = i;\n    //     }\n    //     this.#currentLayers = {};\n    //     this.built = true;\n    //     this.#webglRenderer.setImageDirty();\n    //     //     this.#view.viewer.scene.setAABBDirty();\n    //     this.onBuilt.dispatch(this, null);\n    // }\n    //\n    // addModel(params: {\n    //     id: string,\n    //     sceneModel: SceneModel\n    // }) {\n    //\n    //     const sceneModel = params.sceneModel;\n    //     const textures = sceneModel.textures;\n    //     const geometries = sceneModel.geometries;\n    //     const meshes = sceneModel.meshes;\n    //     const objects = sceneModel.objects;\n    //\n    //     if (textures) {\n    //         for (let textureId in textures) {\n    //             const texture = textures[textureId];\n    //             this.#addTexture(texture);\n    //         }\n    //     }\n    //\n    //     if (geometries) {\n    //         for (let geometryId in geometries) {\n    //             const geometry = geometries[geometryId];\n    //             this.#addGeometry(geometry);\n    //         }\n    //     }\n    //\n    //     if (meshes) {\n    //         for (let meshId in meshes) {\n    //             const mesh = meshes[meshId];\n    //             this.#addMesh(mesh);\n    //         }\n    //     }\n    //\n    //     if (objects) {\n    //         for (let geometryId in objects) {\n    //             const object = objects[geometryId];\n    //             this.#addObject(object);\n    //         }\n    //     }\n    // }\n\n    #addObject(sceneObject: SceneObject): void {\n        let objectId = sceneObject.id;\n        if (objectId === undefined) {\n            objectId = createUUID();\n        } else if (this.rendererObjects[objectId]) {\n            this.error(\"[createObject] rendererModel already has a ViewerObject with this ID: \" + objectId + \" - will assign random ID\");\n            objectId = createUUID();\n        }\n        const meshes = sceneObject.meshes;\n        if (meshes === undefined) {\n            throw new Error(\"[createObject] Param expected: meshes\");\n        }\n        const rendererMeshes: RendererMeshImpl[] = [];\n        for (let i = 0, len = meshes.length; i < len; i++) {\n            const mesh = meshes[i];\n            const rendererMesh = <RendererMeshImpl>this.rendererMeshes[mesh.id];\n            rendererMeshes.push(rendererMesh);\n        }\n        const objectRenderer = new RendererObjectImpl({\n            id: objectId,\n            rendererModel: this,\n            rendererMeshes,\n            aabb: sceneObject.aabb,\n            layerId: this.#layerId\n        });\n        this.rendererObjectsList.push(objectRenderer);\n        this.rendererObjects[objectId] = objectRenderer;\n        this.rendererViewObjects[objectId] = objectRenderer;\n        this.#numViewerObjects++;\n    }\n\n    #removeModel(): void {\n        const sceneModel = this.sceneModel;\n        if (!sceneModel) {\n            return;\n        }\n        const textures = sceneModel.textures;\n        const geometries = sceneModel.geometries;\n        const meshes = sceneModel.meshes;\n        const objects = sceneModel.objects;\n        if (textures) {\n            for (let textureId in textures) {\n                const texture = textures[textureId];\n                if (texture.rendererTexture) {\n                    texture.rendererTexture = null;\n                }\n            }\n        }\n        if (geometries) {\n            for (let geometryId in geometries) {\n                const geometry = geometries[geometryId];\n                if (geometry.rendererGeometry) {\n                    geometry.rendererGeometry = null;\n                }\n            }\n        }\n        if (meshes) {\n            for (let meshId in meshes) {\n                const mesh = meshes[meshId];\n                if (mesh.rendererMesh) {\n                    mesh.rendererMesh = null;\n                }\n            }\n        }\n        if (objects) {\n            for (let objectId in objects) {\n                const object = objects[objectId];\n                if (object.rendererObject) {\n                    object.rendererObject = null;\n                }\n            }\n        }\n        this.sceneModel = null;\n    }\n\n    #createDefaultTextureSetRenderer() {\n        const defaultColorTexture = new RendererTextureImpl(\n            null,\n            new GLTexture({\n                gl: this.#renderContext.gl,\n                preloadColor: [1, 1, 1, 1] // [r, g, b, a]})\n            }));\n\n        const defaultMetalRoughTexture = new RendererTextureImpl(\n            null,\n            new GLTexture({\n                gl: this.#renderContext.gl,\n                preloadColor: [0, 1, 1, 1] // [unused, roughness, metalness, unused]\n            }));\n        const defaultNormalsTexture = new RendererTextureImpl(\n            null,\n            new GLTexture({\n                gl: this.#renderContext.gl,\n                preloadColor: [0, 0, 0, 0] // [x, y, z, unused] - these must be zeros\n            }));\n\n        const defaultEmissiveTexture = new RendererTextureImpl(\n            null,\n            new GLTexture({\n                gl: this.#renderContext.gl,\n                preloadColor: [0, 0, 0, 1] // [x, y, z, unused]\n            }));\n        const defaultOcclusionTexture = new RendererTextureImpl(\n            null,\n            new GLTexture({\n                gl: this.#renderContext.gl,\n                preloadColor: [1, 1, 1, 1] // [x, y, z, unused]\n            }));\n        this.rendererTextures[defaultColorTextureId] = defaultColorTexture;\n        this.rendererTextures[defaultMetalRoughTextureId] = defaultMetalRoughTexture;\n        this.rendererTextures[defaultNormalsTextureId] = defaultNormalsTexture;\n        this.rendererTextures[defaultEmissiveTextureId] = defaultEmissiveTexture;\n        this.rendererTextures[defaultOcclusionTextureId] = defaultOcclusionTexture;\n        this.rendererTextureSets[defaultTextureSetId] = new RendererTextureSetImpl({\n            id: defaultTextureSetId,\n            colorTexture: defaultColorTexture,\n            metallicRoughnessTexture: defaultMetalRoughTexture,\n            emissiveTexture: defaultEmissiveTexture,\n            occlusionTexture: defaultOcclusionTexture\n        });\n    }\n\n    #getLayer(textureSetId: string | undefined, geometryCompressedParams: GeometryCompressedParams): Layer | undefined {\n        const layerId = `${textureSetId}_${geometryCompressedParams.primitive}`;\n        let layer = this.#currentLayers[layerId];\n        if (layer) {\n            if (layer.canCreateMesh(geometryCompressedParams)) {\n                return layer;\n            } else {\n                layer.build();\n                delete this.#currentLayers[layerId];\n            }\n        }\n        let textureSet;\n        if (textureSetId) {\n            textureSet = this.rendererTextureSets[textureSetId];\n            if (!textureSet) {\n                this.error(`TextureSet not found: ${textureSetId} - ensure that you create it first with createTextureSet()`);\n                return;\n            }\n        }\n        layer = new Layer(<LayerParams>{\n            gl: this.#renderContext.gl,\n            view: this.#view,\n            rendererModel: this,\n            primitive: geometryCompressedParams.primitive,\n            textureSet,\n            layerIndex: 0\n        });\n        this.#layers[layerId] = layer;\n        this.layerList.push(layer);\n        this.#currentLayers[layerId] = layer;\n        return layer;\n    }\n\n    #rebuildAABB() {\n        collapseAABB3(this.#aabb);\n        for (let i = 0, len = this.rendererObjectsList.length; i < len; i++) {\n            const objectRenderer = this.rendererObjectsList[i];\n            expandAABB3(this.#aabb, objectRenderer.aabb);\n        }\n        this.#aabbDirty = false;\n    }\n\n    /*\n        #getActiveSectionPlanesForLayer(layer: any) {\n            const drawFlags = this.drawFlags;\n            const sectionPlanes = this.#view.sectionPlanesList;\n            const numSectionPlanes = sectionPlanes.length;\n            const baseIndex = layer.layerIndex * numSectionPlanes;\n            if (numSectionPlanes > 0) {\n                for (let i = 0; i < numSectionPlanes; i++) {\n                    const sectionPlane = sectionPlanes[i];\n                    if (!sectionPlane.active) {\n                        drawFlags.sectionPlanesActivePerLayer[baseIndex + i] = false;\n\n                    } else {\n                        drawFlags.sectionPlanesActivePerLayer[baseIndex + i] = true;\n                        drawFlags.sectioned = true;\n                    }\n                }\n            }\n            return true;\n        }\n\n        #updateDrawFlagsVisibleLayers() {\n            const drawFlags = this.drawFlags;\n            drawFlags.numLayers = this.layerList.length;\n            drawFlags.numVisibleLayers = 0;\n            for (let layerIndex = 0, len = this.layerList.length; layerIndex < len; layerIndex++) {\n                const layer = this.layerList[layerIndex];\n                const layerVisible = this.#getActiveSectionPlanesForLayer(layer);\n                if (layerVisible) {\n                    drawFlags.visibleLayers[drawFlags.numVisibleLayers++] = layerIndex;\n                }\n            }\n        }\n\n        #updateDrawFlags() {\n            if (this.meshCounts.numVisible === 0) {\n                return;\n            }\n            if (this.meshCounts.numCulled === this.meshCounts.numMeshes) {\n                return;\n            }\n            const drawFlags = this.drawFlags;\n            drawFlags.colorOpaque = (this.meshCounts.numTransparent < this.meshCounts.numMeshes);\n            if (this.meshCounts.numTransparent > 0) {\n                drawFlags.colorTransparent = true;\n            }\n            if (this.meshCounts.numXRayed > 0) {\n                const xrayMaterial = this.#view.xrayMaterial.state;\n                if (xrayMaterial.fill) {\n                    if (xrayMaterial.fillAlpha < 1.0) {\n                        drawFlags.xrayedSilhouetteTransparent = true;\n                    } else {\n                        drawFlags.xrayedSilhouetteOpaque = true;\n                    }\n                }\n                if (xrayMaterial.edges) {\n                    if (xrayMaterial.edgeAlpha < 1.0) {\n                        drawFlags.xrayedEdgesTransparent = true;\n                    } else {\n                        drawFlags.xrayedEdgesOpaque = true;\n                    }\n                }\n            }\n            if (this.meshCounts.numEdges > 0) {\n                const edgeMaterial = this.#view.edgeMaterial.state;\n                if (edgeMaterial.edges) {\n                    drawFlags.edgesOpaque = (this.meshCounts.numTransparent < this.meshCounts.numMeshes);\n                    if (this.meshCounts.numTransparent > 0) {\n                        drawFlags.edgesTransparent = true;\n                    }\n                }\n            }\n            if (this.meshCounts.numSelected > 0) {\n                const selectedMaterial = this.#view.selectedMaterial.state;\n                if (selectedMaterial.fill) {\n                    if (selectedMaterial.fillAlpha < 1.0) {\n                        drawFlags.selectedSilhouetteTransparent = true;\n                    } else {\n                        drawFlags.selectedSilhouetteOpaque = true;\n                    }\n                }\n                if (selectedMaterial.edges) {\n                    if (selectedMaterial.edgeAlpha < 1.0) {\n                        drawFlags.selectedEdgesTransparent = true;\n                    } else {\n                        drawFlags.selectedEdgesOpaque = true;\n                    }\n                }\n            }\n            if (this.meshCounts.numHighlighted > 0) {\n                const highlightMaterial = this.#view.highlightMaterial.state;\n                if (highlightMaterial.fill) {\n                    if (highlightMaterial.fillAlpha < 1.0) {\n                        drawFlags.highlightedSilhouetteTransparent = true;\n                    } else {\n                        drawFlags.highlightedSilhouetteOpaque = true;\n                    }\n                }\n                if (highlightMaterial.edges) {\n                    if (highlightMaterial.edgeAlpha < 1.0) {\n                        drawFlags.highlightedEdgesTransparent = true;\n                    } else {\n                        drawFlags.highlightedEdgesOpaque = true;\n                    }\n                }\n            }\n        }\n\n     */\n}\n\n\n\n","/**\n * [![npm version](https://badge.fury.io/js/%40xeokit%2Fsvg)](https://badge.fury.io/js/%40xeokit%2Fmath)\n * [![](https://data.jsdelivr.com/v1/package/npm/@xeokit/badge)](https://www.jsdelivr.com/package/npm/@xeokit/math)\n *\n * <img style=\"padding:0px; padding-top:20px; padding-bottom:20px;  height:270px\" src=\"media://images/3D-Cart.svg\"/>\n *\n * # xeokit RTC Coordinate Utilities\n *\n * ---\n *\n * ### *Math functions for working with RTC cartesian coordinates*\n *\n * ---\n *\n * * Math functions for working with relative-to-center (RTC) coordinate systems\n * * Used internally within {@link @xeokit/viewer!Viewer}\n *\n * ## Installation\n *\n * ````bash\n * npm install @xeokit/rtc\n * ````\n *\n * ## Usage\n *\n * ````javascript\n * import * as rtc from \"@xeokit/rtc\";\n *\n * const worldPos = [100000000000.0, 1000000000.0, 1000000000000.0];\n * const rtcCenter = [0,0,0];\n * const rtcPos = [0,0,0];\n *\n * rtc.worldToRTCPos(worldPos, rtcCenter, rtcPos);\n *\n * //..\n * ````\n *\n * @module @xeokit/rtc\n */\nimport type {FloatArrayParam} from \"@xeokit/math\";\nimport {createVec3, dotVec3, mulVec3Scalar, normalizeVec3, setMat4Translation, transformVec4} from \"@xeokit/matrix\";\nimport {getPositions3Center} from \"@xeokit/boundaries\";\n\n\nconst tempVec3a = createVec3();\n\n\nconst tempMat = new Float32Array(16);\nconst rtcCenterWorld = new Float64Array(4);\nconst rtcCenterView = new Float64Array(4);\n\n/**\n * Given a view matrix and a relative-to-center (RTC) coordinate origin, returns a view matrix\n * to transform RTC coordinates to View-space.\n */\nexport function createRTCViewMat(viewMat: FloatArrayParam, rtcCenter: FloatArrayParam, rtcViewMat: FloatArrayParam = tempMat): FloatArrayParam {\n    rtcCenterWorld[0] = rtcCenter[0];\n    rtcCenterWorld[1] = rtcCenter[1];\n    rtcCenterWorld[2] = rtcCenter[2];\n    rtcCenterWorld[3] = 1;\n    transformVec4(viewMat, rtcCenterWorld, rtcCenterView);\n    setMat4Translation(viewMat, rtcCenterView, rtcViewMat);\n    return rtcViewMat;\n}\n\n/**\n * Converts a World-space 3D position to RTC.\n *\n * Given a double-precision World-space position, returns a double-precision relative-to-center (RTC) center pos\n * and a single-precision offset fom that center.\n *\n * @param worldPos The World-space position.\n * @param rtcCenter Double-precision relative-to-center (RTC) center pos.\n * @param rtcPos Single-precision offset fom that center.\n */\nexport function worldToRTCPos(worldPos: FloatArrayParam, rtcCenter: FloatArrayParam, rtcPos: FloatArrayParam) {\n\n    const xHigh = Float32Array.from([worldPos[0]])[0];\n    const xLow = worldPos[0] - xHigh;\n\n    const yHigh = Float32Array.from([worldPos[1]])[0];\n    const yLow = worldPos[1] - yHigh;\n\n    const zHigh = Float32Array.from([worldPos[2]])[0];\n    const zLow = worldPos[2] - zHigh;\n\n    rtcCenter[0] = xHigh;\n    rtcCenter[1] = yHigh;\n    rtcCenter[2] = zHigh;\n\n    rtcPos[0] = xLow;\n    rtcPos[1] = yLow;\n    rtcPos[2] = zLow;\n}\n\n/**\n * Converts a World-space 3D position to RTC.\n *\n * Given a double-precision World-space position, returns a double-precision relative-to-center (RTC) center.\n *\n * @param worldCenter The World-space position.\n * @param rtcCenter Double-precision relative-to-center (RTC) center pos.\n * @param [cellSize=200] The size of each coordinate cell within the RTC coordinate system.\n */\nexport function worldToRTCCenter(worldCenter: FloatArrayParam, rtcCenter: FloatArrayParam, cellSize = 200) {\n    rtcCenter[0] = Math.round(worldCenter[0] / cellSize) * cellSize;\n    rtcCenter[1] = Math.round(worldCenter[1] / cellSize) * cellSize;\n    rtcCenter[2] = Math.round(worldCenter[2] / cellSize) * cellSize;\n    return rtcCenter;\n}\n\n/**\n * Converts a flat array of double-precision positions to RTC positions.\n *\n * Returns the RTC positions, along with a computed RTC center for those positions.\n *\n * When computing the RTC position, this function uses a modulus operation to ensure that, whenever possible,\n * identical RTC positions are reused for different positions arrays.\n *\n * @param worldPositions Flat array of World-space 3D positions.\n * @param rtcPositions Outputs the computed flat array of 3D RTC positions.\n * @param rtcCenter Outputs the computed double-precision relative-to-center (RTC) center pos.\n * @param [cellSize=200] The size of each coordinate cell within the RTC coordinate system.\n * @returns ````True```` if the positions actually needed conversion to RTC, else ````false````. When\n * ````false````, we can safely ignore the data returned in ````rtcPositions```` and ````rtcCenter````,\n * since ````rtcCenter```` will equal ````[0,0,0]````, and ````rtcPositions```` will contain identical values to ````positions````.\n */\nexport function worldToRTCPositions(worldPositions: FloatArrayParam, rtcPositions: FloatArrayParam, rtcCenter: FloatArrayParam, cellSize = 200): boolean {\n\n    const center = getPositions3Center(worldPositions, tempVec3a);\n\n    const rtcCenterX = Math.round(center[0] / cellSize) * cellSize;\n    const rtcCenterY = Math.round(center[1] / cellSize) * cellSize;\n    const rtcCenterZ = Math.round(center[2] / cellSize) * cellSize;\n\n    for (let i = 0, len = worldPositions.length; i < len; i += 3) {\n        rtcPositions[i + 0] = worldPositions[i + 0] - rtcCenterX;\n        rtcPositions[i + 1] = worldPositions[i + 1] - rtcCenterY;\n        rtcPositions[i + 2] = worldPositions[i + 2] - rtcCenterZ;\n    }\n\n    rtcCenter[0] = rtcCenterX;\n    rtcCenter[1] = rtcCenterY;\n    rtcCenter[2] = rtcCenterZ;\n\n    const rtcNeeded = (rtcCenter[0] !== 0 || rtcCenter[1] !== 0 || rtcCenter[2] !== 0);\n\n    return rtcNeeded;\n}\n\n/**\n * Converts an RTC 3D position to World-space.\n *\n * @param rtcCenter Double-precision relative-to-center (RTC) center pos.\n * @param rtcPos Single-precision offset fom that center.\n * @param worldPos The World-space position.\n */\nexport function rtcToWorldPos(rtcCenter: FloatArrayParam, rtcPos: FloatArrayParam, worldPos: FloatArrayParam): FloatArrayParam {\n    worldPos[0] = rtcCenter[0] + rtcPos[0];\n    worldPos[1] = rtcCenter[1] + rtcPos[1];\n    worldPos[2] = rtcCenter[2] + rtcPos[2];\n    return worldPos;\n}\n\n/**\n * Given a 3D plane defined by distance from origin and direction, and an RTC center position,\n * return a plane position that is relative to the RTC center.\n *\n * @param dist\n * @param dir\n * @param rtcCenter\n * @param rtcPlanePos\n * @returns {*}\n */\nexport function getPlaneRTCPos(dist: number, dir: FloatArrayParam, rtcCenter: FloatArrayParam, rtcPlanePos: FloatArrayParam) {\n    const rtcCenterToPlaneDist = dotVec3(dir, rtcCenter) + dist;\n    const dirNormalized = normalizeVec3(dir, tempVec3a);\n    mulVec3Scalar(dirNormalized, -rtcCenterToPlaneDist, rtcPlanePos);\n    return rtcPlanePos;\n}\n","import {createMatricesDataTexture} from \"./dataTextures\";\nimport type {GLDataTexture} from \"@xeokit/webglutils\";\nimport type {FloatArrayParam} from \"@xeokit/math\";\nimport {createMat4, createVec3} from \"@xeokit/matrix\";\nimport {createRTCViewMat, worldToRTCCenter} from \"@xeokit/rtc\";\nimport type {Camera} from \"@xeokit/viewer\";\n\nconst NUM_TILES = 2000;\n\nexport interface Tile {\n    id: string;\n    index: number;\n    useCount: number;\n    center: FloatArrayParam;\n    rtcViewMatrix: FloatArrayParam;\n}\n\nexport class TileManager {\n\n    #gl: WebGL2RenderingContext;\n    #indexesUsed: boolean[];\n    #tiles: { [key: string]: Tile };\n    #dataTexture: GLDataTexture;\n    #camera: Camera;\n    #lastFreeIndex: number;\n\n    constructor(params: {\n        camera: Camera,\n        gl: WebGL2RenderingContext\n    }) {\n        this.#camera = params.camera;\n        this.#gl = params.gl;\n        this.#indexesUsed = [];\n        this.#lastFreeIndex = 0;\n        this.#tiles = {};\n        this.#dataTexture = createMatricesDataTexture(this.#gl, NUM_TILES);\n    }\n\n    getTile(center: FloatArrayParam): Tile {\n        const rtcCenter = worldToRTCCenter(center, createVec3());\n        const id = `${rtcCenter[0]}-${rtcCenter[1]}-${rtcCenter[2]}`;\n        let tile = this.#tiles[id];\n        if (!tile) {\n            tile = {\n                id,\n                index: this.#findFreeTile(),\n                useCount: 0,\n                center: createVec3(),\n                rtcViewMatrix: createMat4()\n            };\n            this.#tiles[tile.id] = tile;\n        }\n        tile.useCount++;\n        return tile;\n    }\n\n    putTile(tile: Tile) {\n        if (--tile.useCount <= 0) {\n            delete this.#tiles[tile.id];\n            this.#putFreeTile(tile.index);\n        }\n    }\n\n    updateTileCenter(tile: Tile, newCenter: FloatArrayParam): Tile {\n        const newRTCCenter = worldToRTCCenter(newCenter, createVec3());\n        const newId = `${newRTCCenter[0]}-${newRTCCenter[1]}-${newRTCCenter[2]}`;\n        if (newId === tile.id) {\n            return tile;\n        }\n        this.putTile(tile);\n        let newTile = this.#tiles[newId];\n        if (!newTile) {\n            newTile = {\n                id: newId,\n                index: this.#findFreeTile(),\n                useCount: 0,\n                center: createVec3(),\n                rtcViewMatrix: createMat4()\n            };\n            this.#tiles[newTile.id] = newTile;\n        }\n        newTile.useCount++;\n        return newTile;\n    }\n\n    refreshMatrices() {\n        if (!this.#dataTexture.texture) {\n            return;\n        }\n        const gl = this.#gl;\n        const viewMatrix = this.#camera.viewMatrix;\n        const tileIds = Object.keys(this.#tiles);\n        const numTiles = tileIds.length;\n        const data = new Float32Array(16 * numTiles);\n        for (let i = 0, len = tileIds.length; i < len; i++) {\n            const tileId = tileIds[i];\n            const tile = this.#tiles[tileId];\n            createRTCViewMat(viewMatrix, tile.center, tile.rtcViewMatrix);\n            data.set(tile.rtcViewMatrix, tile.index * 16);\n        }\n        gl.bindTexture(gl.TEXTURE_2D, this.#dataTexture.texture);\n        gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, 1, 1, gl.RGBA, gl.FLOAT, data);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n    }\n\n    #putFreeTile(index: number) {\n        delete this.#indexesUsed[index];\n        this.#lastFreeIndex = index;\n    }\n\n    #findFreeTile(): number {\n        for (let index = this.#lastFreeIndex; ; index = (index + 1) % NUM_TILES) {\n            if (!this.#indexesUsed[index]) {\n                this.#indexesUsed[index] = true;\n                return index;\n            }\n        }\n    }\n\n\n}","import {apply, Map} from \"@xeokit/utils\";\nimport {createVec3} from \"@xeokit/matrix\";\nimport type {FloatArrayParam} from \"@xeokit/math\";\nimport {\n    LinesPrimitive,\n    PointsPrimitive,\n    SolidPrimitive,\n    SurfacePrimitive,\n    TrianglesPrimitive\n} from \"@xeokit/constants\";\n\nimport type {CreateModelParams, Renderer, View, Viewer, ViewObject} from \"@xeokit/viewer\";\n\nimport {KTX2TextureTranscoder} from \"@xeokit/ktx2\";\nimport {RenderContext} from \"./RenderContext\";\nimport {FastColorTrianglesRenderer} from \"./FastColorTrianglesRenderer\";\nimport {getExtension, GLRenderBuffer, GLRenderBufferManager, WEBGL_INFO} from \"@xeokit/webglutils\";\nimport {RENDER_PASSES} from \"./RENDER_PASSES\";\nimport type {Pickable} from \"./Pickable\";\nimport {RendererModelImpl} from \"./RendererModelImpl\";\nimport type {Layer} from \"./Layer\";\nimport type {RendererViewObject} from \"@xeokit/viewer/src/RendererViewObject\";\nimport type {Capabilities, Component, TextureTranscoder} from \"@xeokit/core\";\nimport type {SceneModel} from \"@xeokit/scene\";\nimport {TileManager} from \"./TileManager\";\n\n\nconst ua = navigator.userAgent.match(/(opera|chrome|safari|firefox|msie|mobile)\\/?\\s*(\\.?\\d+(\\.\\d+)*)/i);\nconst isSafari = (ua && ua[1].toLowerCase() === \"safari\");\n\n/**\n * WebGL-based rendering strategy for a {@link @xeokit/viewer!Viewer | Viewer}.\n *\n * See {@link @xeokit/webglrenderer} for usage.\n *\n * @internal\n */\nexport class WebGLRenderer implements Renderer {\n\n    rendererViewObjects: { [key: string]: RendererViewObject };\n    tileManager: TileManager|null;\n    #sceneModels: { [key: string]: SceneModel };\n    #viewer: Viewer;\n    #view: View;\n    #renderContext: RenderContext;\n    #canvasTransparent: boolean;\n    #transparentEnabled: boolean;\n    #edgesEnabled: boolean;\n    #imageDirty: boolean;\n    #saoEnabled: boolean;\n    #pbrEnabled: boolean;\n    #backgroundColor: FloatArrayParam;\n    #rendererModels: { [key: string]: RendererModelImpl };\n    #layerList: Layer[];\n    #layerListDirty: boolean;\n    #stateSortDirty: boolean;\n    #pickIDs = new Map({});\n    #saoDepthRenderBuffer: GLRenderBuffer;\n    #renderBufferManager: GLRenderBufferManager;\n    #extensionHandles: any;\n    #logarithmicDepthBufferEnabled: boolean;\n    #alphaDepthMask: boolean;\n    #occlusionTester: any;\n    // #saoOcclusionRenderer: null | SAOOcclusionRenderer;\n    // #saoDepthLimitedBlurRenderer: SAODepthLimitedBlurRenderer;\n    #textureTranscoder: TextureTranscoder;\n\n    // @ts-ignore\n    #layerRenderers: {\n        // colorPoints: ColorPointsLayerRenderer;\n        colorTriangles: FastColorTrianglesRenderer;\n        // qualityColorTriangles: QualityColorTrianglesRenderer;\n        // colorLines: ColorLinesLayerRenderer;\n        // silhouettePoints: SilhouettePointsRenderer;\n        // silhouetteTriangles: SilhouetteTrianglesLayerRenderer;\n        // silhouetteLines: SilhouetteLinesRenderer;\n    };\n    #viewMatrixDirty: boolean;\n\n    /**\n     Creates a WebGLRenderer.\n\n     @param params Configs\n     @param params.textureTranscoder Injects an optional transcoder that will be used internally by {@link rendererModel.createTexture}\n     to convert transcoded texture data. The transcoder is only required when we'll be providing transcoded data\n     to {@link rendererModel.createTexture}. We assume that all transcoded texture data added to a  ````rendererModel````\n     will then be in a format supported by this transcoder.\n     */\n    constructor(params: {\n        textureTranscoder?: TextureTranscoder\n    }) {\n        this.tileManager = null;\n        this.#sceneModels = {};\n        this.rendererViewObjects = {};\n\n        this.#textureTranscoder = params.textureTranscoder || new KTX2TextureTranscoder({});\n        this.#canvasTransparent = false;\n        this.#alphaDepthMask = false;\n        this.#extensionHandles = {};\n        this.#pickIDs = new Map({});\n        this.#layerList = [];\n        this.#layerListDirty = true;\n        this.#stateSortDirty = true;\n        this.#imageDirty = true;\n        this.#transparentEnabled = true;\n        this.#edgesEnabled = true;\n        this.#saoEnabled = true;\n        this.#pbrEnabled = true;\n        this.#backgroundColor = createVec3();\n        this.#occlusionTester = null; // Lazy-created in #addMarker()\n\n        // this.#saoDepthRenderBuffer = null;\n        // this.#renderBufferManager = null;\n        this.#logarithmicDepthBufferEnabled = false;\n        this.#rendererModels = {};\n        this.#viewMatrixDirty = true;\n    }\n\n    init(viewer: Viewer): void {\n        this.#viewer = viewer;\n        this.#textureTranscoder.init(this.#viewer.capabilities);\n    }\n\n    getCapabilities(capabilities: Capabilities): void {\n        capabilities.maxViews = 1;\n        const canvasElement = document.createElement('canvas');\n        let gl;\n        try {\n            gl = canvasElement.getContext(\"webgl2\");\n        } catch (e) {\n            console.error('Failed to get a WebGL context');\n        }\n        if (gl) {\n            capabilities.astcSupported = !!getExtension(gl, 'WEBGL_compressed_texture_astc');\n            capabilities.etc1Supported = true; // WebGL\n            capabilities.etc2Supported = !!getExtension(gl, 'WEBGL_compressed_texture_etc');\n            capabilities.dxtSupported = !!getExtension(gl, 'WEBGL_compressed_texture_s3tc');\n            capabilities.bptcSupported = !!getExtension(gl, 'EXT_texture_compression_bptc');\n            capabilities.pvrtcSupported = !!(getExtension(gl, 'WEBGL_compressed_texture_pvrtc') || getExtension(gl, 'WEBKIT_WEBGL_compressed_texture_pvrtc'));\n        }\n    }\n\n    registerView(view: View): number {\n        if (this.#renderContext) {\n            throw \"Only one View allowed with WebGLRenderer (see WebViewerCapabilities.maxViews)\";\n        }\n        this.#view = view;\n        const WEBGL_CONTEXT_NAMES = [\"webglutils\"];\n        const canvasElement = view.canvasElement;\n        const contextAttr = {};\n        let gl: WebGL2RenderingContext | null = null;\n        for (let i = 0; !gl && i < WEBGL_CONTEXT_NAMES.length; i++) {\n            try {  // @ts-ignore\n                gl = canvasElement.getContext(WEBGL_CONTEXT_NAMES[i], contextAttr);\n            } catch (e) { // Try with next context name\n            }\n        }\n        if (!gl) {\n            console.error('Failed to get a WebGL2 context');\n            //  view.events.fire(\"webglContextFailed\", true, true);\n            return 0;\n        }\n        if (gl) {\n            gl.hint(gl.FRAGMENT_SHADER_DERIVATIVE_HINT, gl.NICEST);\n        }\n        this.#renderContext = new RenderContext(this.#viewer, this.#view, gl);\n        this.tileManager = new TileManager({\n            camera: view.camera,\n            gl\n        });\n        this.#layerRenderers = {\n            //       colorPoints: new ColorPointsLayerRenderer(this.#renderContext),\n            colorTriangles: new FastColorTrianglesRenderer(this.#renderContext),\n            // qualityColorTriangles: new QualityColorTrianglesRenderer(this.#renderContext),\n            // colorLines: new ColorLinesLayerRenderer(this.#renderContext),\n            // silhouettePoints: new SilhouettePointsRenderer(this.#renderContext),\n            // silhouetteTriangles: new SilhouetteTrianglesLayerRenderer(this.#renderContext),\n            // silhouetteLines: new SilhouetteLinesRenderer(this.#renderContext)\n        };\n        view.camera.onViewMatrix.sub(() => {\n            this.#viewMatrixDirty = true;\n        })\n        return 0;\n    }\n\n    deregisterView(viewIndex: number): void { // Nop\n    }\n\n    /**\n     * Adds a SceneModel to this renderer.\n     */\n    addModel(params: CreateModelParams): void {\n        if (!this.#renderContext) {\n            throw new Error(\"Must register a View before you add a SceneModel\");\n        }\n        const rendererModel = new RendererModelImpl(apply({\n            sceneModel: params.sceneModel,\n            view: this.#view,\n            textureTranscoder: this.#textureTranscoder,\n            webglRenderer: this,\n            renderContext: this.#renderContext,\n            layerId: params.layerId\n        }, params));\n\n        this.#rendererModels[rendererModel.id] = rendererModel;\n        this.#registerRendererViewObjects(rendererModel);\n        this.#layerListDirty = true;\n\n        rendererModel.onDestroyed.one((component: Component) => {\n            const rendererModel = this.#rendererModels[component.id];\n            delete this.#rendererModels[component.id];\n            this.#deregisterRendererViewObjects(rendererModel);\n            this.#layerListDirty = true;\n        });\n    }\n\n    removeModel(modelId: string): void {\n        const sceneModel = this.#sceneModels[modelId];\n        if (sceneModel) {\n            const rendererModel = this.#rendererModels[modelId];\n            delete this.#rendererModels[modelId];\n            this.#deregisterRendererViewObjects(rendererModel);\n            this.#layerListDirty = true;\n\n        }\n    }\n\n    /**\n     * @private\n     */\n    registerPickable(pickable: Pickable): number { // @ts-ignore\n        return this.#pickIDs.addItem(pickable);\n    }\n\n    /**\n     * @private\n     */\n    deregisterPickable(pickId: number) {\n        this.#pickIDs.removeItem(pickId);\n    }\n\n    //\n    // createModel(params: ModelParams): SceneModel {\n    //     if (!this.#renderContext) {\n    //         throw \"Must register a View before you create a model\";\n    //     }\n    //     const WebGLSceneModelRenderer = new WebGLSceneModelRenderer(apply({\n    //         view: this.#view,\n    //         textureTranscoder: this.#textureTranscoder,\n    //         webglRenderer: this,\n    //         renderContext: this.#renderContext,\n    //         layerId: params.layerId\n    //     }, params));\n    //     WebGLSceneModelRenderer.onBuilt.one((buildsceneModelRenderer: SceneModel) => {\n    //         this.#rendererModels[buildsceneModelRenderer.id] = <WebGLSceneModelRenderer>buildsceneModelRenderer;\n    //         this.#layerListDirty = true;\n    //     });\n    //     WebGLSceneModelRenderer.onDestroyed.one((destroyedsceneModelRenderer: Component) => {\n    //         delete this.#rendererModels[destroyedsceneModelRenderer.id];\n    //         this.#layerListDirty = true;\n    //     });\n    //     return WebGLSceneModelRenderer;\n    // }\n\n    setImageDirty(viewIndex?: number) {\n        this.#imageDirty = true;\n    }\n\n    setBackgroundColor(viewIndex: number, color: FloatArrayParam): void { // @ts-ignore\n        this.#backgroundColor.set(color);\n        this.#imageDirty = true;\n    }\n\n    setEdgesEnabled(viewIndex: number, enabled: boolean): void {\n        this.#edgesEnabled = enabled;\n        this.#imageDirty = true;\n    }\n\n    setPBREnabled(viewIndex: number, enabled: boolean): void {\n        this.#pbrEnabled = enabled;\n        this.#imageDirty = true;\n    }\n\n    getSAOSupported(): boolean {\n        return isSafari && WEBGL_INFO.SUPPORTED_EXTENSIONS[\"OES_standard_derivatives\"];\n    }\n\n    setSAOEnabled(viewIndex: number, enabled: boolean): void {\n        this.#saoEnabled = enabled;\n        this.#imageDirty = true;\n    }\n\n    setTransparentEnabled(viewIndex: number, enabled: boolean): void {\n        this.#transparentEnabled = enabled;\n        this.#imageDirty = true;\n    }\n\n    clear(viewIndex: number) {\n        const gl = this.#renderContext.gl;\n        gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\n        if (this.#canvasTransparent) {\n            gl.clearColor(1, 1, 1, 1);\n        } else {\n            gl.clearColor(this.#backgroundColor[0], this.#backgroundColor[1], this.#backgroundColor[2], 1.0);\n        }\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n    };\n\n    needsRebuild(viewIndex?: number): void {\n        for (let rendererId in this.#layerRenderers) {\n            // @ts-ignore\n            this.#layerRenderers[rendererId].needRebuild();\n        }\n    }\n\n    needsRender(viewIndex?: number): boolean {\n        return (this.#imageDirty || this.#layerListDirty || this.#stateSortDirty);\n    }\n\n    render(viewIndex: number, params: {\n        force?: boolean;\n    }) {\n        params = params || {};\n        if (params.force) {\n            this.#imageDirty = true;\n        }\n        if (this.#viewMatrixDirty) {\n            (<TileManager>this.tileManager).refreshMatrices();\n            this.#viewMatrixDirty = false;\n        }\n        this.#updateLayerList();\n        if (this.#imageDirty) {\n            this.#draw({clear: true});\n            this.#imageDirty = false;\n        }\n    }\n\n    pickSceneObject(viewIndex: number, params: {}): ViewObject | null {\n        return null;\n    };\n\n    #registerRendererViewObjects(rendererModel: RendererModelImpl) {\n        const rendererObjects = rendererModel.rendererViewObjects;\n        for (let id in rendererObjects) {\n            this.rendererViewObjects[id] = rendererObjects[id];\n        }\n    }\n\n    #deregisterRendererViewObjects(rendererModel: RendererModelImpl) {\n        const rendererViewObjects = rendererModel.rendererViewObjects;\n        for (let id in rendererViewObjects) {\n            delete this.rendererViewObjects[id];\n        }\n    }\n\n    #updateLayerList() {\n        if (this.#layerListDirty) {\n            this.#buildLayerList();\n            this.#layerListDirty = false;\n            this.#stateSortDirty = true;\n        }\n        if (this.#stateSortDirty) {\n            //     this.#sortLayerList();\n            this.#stateSortDirty = false;\n            this.#imageDirty = true;\n        }\n    }\n\n    #buildLayerList() {\n        let lenDrawableList = 0;\n        for (let id in this.#rendererModels) {\n            const webGLSceneModelRenderer = this.#rendererModels[id];\n            for (let i = 0, len = webGLSceneModelRenderer.layerList.length; i < len; i++) {\n                this.#layerList[lenDrawableList++] = webGLSceneModelRenderer.layerList[i];\n            }\n        }\n        this.#layerList.length = lenDrawableList;\n    }\n\n    #draw(params: {\n        clear: boolean;\n    }) {\n        this.#activateExtensions();\n        if (this.#saoEnabled && this.#view.sao.possible) {\n            this.#drawSAOBuffers(params);\n        }\n        this.#drawColor(params);\n    }\n\n    #activateExtensions() {\n        if (WEBGL_INFO.SUPPORTED_EXTENSIONS[\"OES_element_index_uint\"]) {\n            this.#extensionHandles.OES_element_index_uint = this.#renderContext.gl.getExtension(\"OES_element_index_uint\");\n        }\n        if (this.#logarithmicDepthBufferEnabled && WEBGL_INFO.SUPPORTED_EXTENSIONS[\"EXT_frag_depth\"]) {\n            this.#extensionHandles.EXT_frag_depth = this.#renderContext.gl.getExtension('EXT_frag_depth');\n        }\n        if (WEBGL_INFO.SUPPORTED_EXTENSIONS[\"WEBGL_depth_texture\"]) {\n            this.#extensionHandles.WEBGL_depth_texture = this.#renderContext.gl.getExtension('WEBGL_depth_texture');\n        }\n    }\n\n    #drawSAOBuffers(params: {\n        clear: boolean;\n    }) {\n        // const sao = this.#view.sao;\n        // const saoDepthRenderBuffer = this.#renderBufferManager.getRenderBuffer(\"saoDepth\", {\n        //     depthTexture: WEBGL_INFO.SUPPORTED_EXTENSIONS[\"WEBGL_depth_texture\"]\n        // });\n        // this.#saoDepthRenderBuffer.bind();\n        // this.#saoDepthRenderBuffer.clear();\n        // this.#drawDepth(params);\n        // this.#saoDepthRenderBuffer.unbind();\n        // // Render occlusion buffer\n        // const occlusionRenderBuffer1 = this.#renderBufferManager.getRenderBuffer(\"saoOcclusion\");\n        // occlusionRenderBuffer1.bind();\n        // occlusionRenderBuffer1.clear();\n        // this.#saoOcclusionRenderer.render(saoDepthRenderBuffer);\n        // occlusionRenderBuffer1.unbind();\n        // if (sao.blur) {\n        //     // Horizontally blur occlusion buffer 1 into occlusion buffer 2\n        //     const occlusionRenderBuffer2 = this.#renderBufferManager.getRenderBuffer(\"saoOcclusion2\");\n        //     occlusionRenderBuffer2.bind();\n        //     occlusionRenderBuffer2.clear();\n        //     this.#saoDepthLimitedBlurRenderer.render(saoDepthRenderBuffer, occlusionRenderBuffer1, 0);\n        //     occlusionRenderBuffer2.unbind();\n        //     // Vertically blur occlusion buffer 2 back into occlusion buffer 1\n        //     occlusionRenderBuffer1.bind();\n        //     occlusionRenderBuffer1.clear();\n        //     this.#saoDepthLimitedBlurRenderer.render(saoDepthRenderBuffer, occlusionRenderBuffer2, 1);\n        //     occlusionRenderBuffer1.unbind();\n        // }\n    }\n\n    #drawDepth(params: {\n        clear: boolean\n    }) {\n        this.#renderContext.reset();\n        const gl = this.#renderContext.gl;\n        gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\n        gl.clearColor(0, 0, 0, 0);\n        gl.enable(gl.DEPTH_TEST);\n        gl.frontFace(gl.CCW);\n        gl.enable(gl.CULL_FACE);\n        gl.depthMask(true);\n        if (params.clear !== false) {\n            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n        }\n\n        // for (let i = 0, len = this.#layerListPostCull.length; i < len; i++) {\n        //     const layer = this.#layerListPostCull[i];\n        //     // if (layer.culled === true || layer.visible === false || !layer.drawDepth) {\n        //     //     continue;\n        //     // }\n        //     // if (layer.drawFlags.colorOpaque) {\n        //     //     //    layer.drawDepth(this.#renderContext);\n        //     // }\n        // }\n        // const numVertexAttribs = WEBGL_INFO.MAX_VERTEX_ATTRIBS; // Fixes https://github.com/xeokit/xeokit-sdk/issues/174\n        // for (let ii = 0; ii < numVertexAttribs; ii++) {\n        //     gl.disableVertexAttribArray(ii);\n        // }\n    }\n\n    #drawColor(params: {\n        clear: boolean;\n    }) {\n\n        const view = this.#view;\n        const renderContext = this.#renderContext;\n        const gl = renderContext.gl;\n\n        const normalDrawSAOBin: Layer[] = [];\n        const edgesColorOpaqueBin: Layer[] = [];\n        const normalFillTransparentBin: Layer[] = [];\n        const edgesColorTransparentBin: Layer[] = [];\n        const xrayedSilhouetteOpaqueBin: Layer[] = [];\n        const xrayEdgesOpaqueBin: Layer[] = [];\n        const xrayedSilhouetteTransparentBin: Layer[] = [];\n        const xrayEdgesTransparentBin: Layer[] = [];\n        const highlightedSilhouetteOpaqueBin: Layer[] = [];\n        const highlightedEdgesOpaqueBin: Layer[] = [];\n        const highlightedSilhouetteTransparentBin: Layer[] = [];\n        const highlightedEdgesTransparentBin: Layer[] = [];\n        const selectedSilhouetteOpaqueBin: Layer[] = [];\n        const selectedEdgesOpaqueBin: Layer[] = [];\n        const selectedSilhouetteTransparentBin: Layer[] = [];\n        const selectedEdgesTransparentBin: Layer[] = [];\n\n        renderContext.reset();\n        renderContext.withSAO = false;\n        renderContext.pbrEnabled = this.#pbrEnabled && !!view.qualityRender;\n\n        gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\n\n        if (this.#canvasTransparent) {\n            gl.clearColor(0, 0, 0, 0);\n        } else {\n            gl.clearColor(this.#backgroundColor[0], this.#backgroundColor[1], this.#backgroundColor[2], 1.0);\n        }\n\n        gl.enable(gl.DEPTH_TEST);\n        gl.frontFace(gl.CCW);\n        gl.enable(gl.CULL_FACE);\n        gl.depthMask(true);\n        gl.lineWidth(1);\n\n        renderContext.lineWidth = 1;\n\n        const saoPossible = view.sao.possible;\n\n        if (this.#saoEnabled && saoPossible) {\n            const occlusionRenderBuffer1 = this.#renderBufferManager.getRenderBuffer(\"saoOcclusion\", {\n                depthTexture: false,\n                size: [gl.drawingBufferWidth, gl.drawingBufferHeight]\n            });\n            renderContext.occlusionTexture = occlusionRenderBuffer1 ? occlusionRenderBuffer1.getTexture() : null;\n        } else {\n            renderContext.occlusionTexture = null;\n\n        }\n\n        if (params.clear !== false) {\n            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n        }\n\n        // Render normal opaque solids, defer others to subsequent bins, to render after\n\n        let normalDrawSAOBinLen = 0;\n        let edgesColorOpaqueBinLen = 0;\n        let normalFillTransparentBinLen = 0;\n        let edgesColorTransparentBinLen = 0;\n        let xrayedSilhouetteOpaqueBinLen = 0;\n        let xrayEdgesOpaqueBinLen = 0;\n        let xrayedSilhouetteTransparentBinLen = 0;\n        let xrayEdgesTransparentBinLen = 0;\n        let highlightedSilhouetteOpaqueBinLen = 0;\n        let highlightedEdgesOpaqueBinLen = 0;\n        let highlightedSilhouetteTransparentBinLen = 0;\n        let highlightedEdgesTransparentBinLen = 0;\n        let selectedSilhouetteOpaqueBinLen = 0;\n        let selectedEdgesOpaqueBinLen = 0;\n        let selectedSilhouetteTransparentBinLen = 0;\n        let selectedEdgesTransparentBinLen = 0;\n\n        for (let i = 0, len = this.#layerList.length; i < len; i++) {\n\n            const layer = this.#layerList[i];\n            const meshCounts = layer.meshCounts;\n\n            if (meshCounts.numCulled === meshCounts.numMeshes || meshCounts.numVisible === 0) {\n                continue;\n            }\n\n            if (meshCounts.numTransparent < meshCounts.numMeshes) {\n                if (this.#saoEnabled && saoPossible && layer.rendererModel.qualityRender) {\n                    normalDrawSAOBin[normalDrawSAOBinLen++] = layer;\n                } else {\n                    this.#drawLayer(layer, RENDER_PASSES.COLOR_OPAQUE, layer.rendererModel.qualityRender);\n                }\n            }\n\n            if (this.#transparentEnabled) {\n                if (meshCounts.numTransparent) {\n                    normalFillTransparentBin[normalFillTransparentBinLen++] = layer;\n                }\n            }\n\n            if (meshCounts.numXRayed > 0) {\n                if (view.xrayMaterial.fill) {\n                    if (view.xrayMaterial.fillAlpha < 1.0) {\n                        xrayedSilhouetteTransparentBin[xrayedSilhouetteTransparentBinLen++] = layer;\n                    } else {\n                        xrayedSilhouetteOpaqueBin[xrayedSilhouetteOpaqueBinLen++] = layer;\n                    }\n                }\n            }\n\n            if (meshCounts.numHighlighted > 0) {\n                if (view.highlightMaterial.fill) {\n                    if (view.highlightMaterial.fillAlpha < 1.0) {\n                        highlightedSilhouetteTransparentBin[highlightedSilhouetteTransparentBinLen++] = layer;\n                    } else {\n                        highlightedSilhouetteOpaqueBin[highlightedSilhouetteOpaqueBinLen++] = layer;\n                    }\n                }\n            }\n\n            if (meshCounts.numSelected > 0) {\n                if (view.selectedMaterial.fill) {\n                    if (view.selectedMaterial.fillAlpha < 1.0) {\n                        selectedSilhouetteTransparentBin[selectedSilhouetteTransparentBinLen++] = layer;\n                    } else {\n                        selectedSilhouetteOpaqueBin[selectedSilhouetteOpaqueBinLen++] = layer;\n                    }\n                }\n            }\n\n            if (this.#edgesEnabled && this.#view.edgeMaterial.edges) {\n                if (meshCounts.numEdges > 0) {\n                    if (meshCounts.numTransparent < meshCounts.numMeshes) {\n                        edgesColorOpaqueBin[edgesColorOpaqueBinLen++] = layer;\n                    }\n                    if (meshCounts.numTransparent > 0) {\n                        edgesColorTransparentBin[edgesColorTransparentBinLen++] = layer;\n                    }\n                    if (view.selectedMaterial.edgeAlpha < 1.0) {\n                        selectedEdgesTransparentBin[selectedEdgesTransparentBinLen++] = layer;\n                    } else {\n                        selectedEdgesOpaqueBin[selectedEdgesOpaqueBinLen++] = layer;\n                    }\n                    if (view.xrayMaterial.edgeAlpha < 1.0) {\n                        xrayEdgesTransparentBin[xrayEdgesTransparentBinLen++] = layer;\n                    } else {\n                        xrayEdgesOpaqueBin[xrayEdgesOpaqueBinLen++] = layer;\n                    }\n                    if (view.highlightMaterial.edgeAlpha < 1.0) {\n                        highlightedEdgesTransparentBin[highlightedEdgesTransparentBinLen++] = layer;\n                    } else {\n                        highlightedEdgesOpaqueBin[highlightedEdgesOpaqueBinLen++] = layer;\n                    }\n                }\n            }\n        }\n\n        // Render deferred bins\n\n        if (normalDrawSAOBinLen > 0) {\n            renderContext.withSAO = true;\n            for (let i = 0; i < normalDrawSAOBinLen; i++) {\n                //    this.#drawLayer(normalDrawSAOBin[i], RENDER_PASSES.COLOR_OPAQUE, layer.rendererModel.qualityRender);\n                //    normalDrawSAOBin[i].drawColorOpaque(renderContext);\n            }\n        }\n\n        for (let i = 0; i < edgesColorOpaqueBinLen; i++) {\n            this.#drawLayer(edgesColorOpaqueBin[i], RENDER_PASSES.EDGES_COLOR_OPAQUE);\n        }\n\n        for (let i = 0; i < xrayedSilhouetteOpaqueBinLen; i++) {\n            this.#drawLayer(xrayedSilhouetteOpaqueBin[i], RENDER_PASSES.SILHOUETTE_XRAYED);\n        }\n\n        for (let i = 0; i < xrayEdgesOpaqueBinLen; i++) {\n            this.#drawLayer(xrayEdgesOpaqueBin[i], RENDER_PASSES.EDGES_XRAYED);\n        }\n\n        if (xrayedSilhouetteTransparentBinLen > 0 || xrayEdgesTransparentBinLen > 0 || normalFillTransparentBinLen > 0 || edgesColorTransparentBinLen > 0) {\n            gl.enable(gl.CULL_FACE);\n            gl.enable(gl.BLEND);\n            if (this.#canvasTransparent) {\n                gl.blendEquation(gl.FUNC_ADD);\n                gl.blendFuncSeparate(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n            } else {\n                gl.blendEquation(gl.FUNC_ADD);\n                gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n            }\n            renderContext.backfaces = false;\n            if (!this.#alphaDepthMask) {\n                gl.depthMask(false);\n            }\n            for (let i = 0; i < xrayEdgesTransparentBinLen; i++) {\n                this.#drawLayer(xrayEdgesTransparentBin[i], RENDER_PASSES.EDGES_XRAYED);\n            }\n            for (let i = 0; i < xrayedSilhouetteTransparentBinLen; i++) {\n                this.#drawLayer(xrayedSilhouetteTransparentBin[i], RENDER_PASSES.SILHOUETTE_XRAYED);\n            }\n            if (normalFillTransparentBinLen > 0 || edgesColorTransparentBinLen > 0) {\n                gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n            }\n            for (let i = 0; i < edgesColorTransparentBinLen; i++) {\n                this.#drawLayer(edgesColorTransparentBin[i], RENDER_PASSES.EDGES_COLOR_TRANSPARENT);\n            }\n            for (let i = 0; i < normalFillTransparentBinLen; i++) {\n                this.#drawLayer(normalFillTransparentBin[i], RENDER_PASSES.COLOR_TRANSPARENT);\n            }\n            gl.disable(gl.BLEND);\n            if (!this.#alphaDepthMask) {\n                gl.depthMask(true);\n            }\n        }\n\n        if (highlightedSilhouetteOpaqueBinLen > 0 || highlightedEdgesOpaqueBinLen > 0) {\n            renderContext.lastProgramId = -1; // HACK\n            gl.clear(gl.DEPTH_BUFFER_BIT);\n            for (let i = 0; i < highlightedEdgesOpaqueBinLen; i++) {\n                this.#drawLayer(highlightedEdgesOpaqueBin[i], RENDER_PASSES.EDGES_HIGHLIGHTED);\n            }\n            for (let i = 0; i < highlightedSilhouetteOpaqueBinLen; i++) {\n                this.#drawLayer(highlightedSilhouetteOpaqueBin[i], RENDER_PASSES.SILHOUETTE_HIGHLIGHTED);\n            }\n        }\n\n        if (highlightedSilhouetteTransparentBinLen > 0 || highlightedEdgesTransparentBinLen > 0 || highlightedSilhouetteOpaqueBinLen > 0) {\n            renderContext.lastProgramId = -1;\n            gl.clear(gl.DEPTH_BUFFER_BIT);\n            gl.enable(gl.CULL_FACE);\n            gl.enable(gl.BLEND);\n            if (this.#canvasTransparent) {\n                gl.blendEquation(gl.FUNC_ADD);\n                gl.blendFuncSeparate(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n            } else {\n                gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n            }\n            for (let i = 0; i < highlightedEdgesTransparentBinLen; i++) {\n                this.#drawLayer(highlightedEdgesTransparentBin[i], RENDER_PASSES.EDGES_HIGHLIGHTED);\n            }\n            for (let i = 0; i < highlightedSilhouetteTransparentBinLen; i++) {\n                this.#drawLayer(highlightedSilhouetteTransparentBin[i], RENDER_PASSES.SILHOUETTE_HIGHLIGHTED);\n            }\n            gl.disable(gl.BLEND);\n        }\n\n        if (selectedSilhouetteOpaqueBinLen > 0 || selectedEdgesOpaqueBinLen > 0) {\n            renderContext.lastProgramId = -1;\n            gl.clear(gl.DEPTH_BUFFER_BIT);\n            for (let i = 0; i < selectedEdgesOpaqueBinLen; i++) {\n                this.#drawLayer(selectedEdgesOpaqueBin[i], RENDER_PASSES.EDGES_SELECTED);\n            }\n            for (let i = 0; i < selectedSilhouetteOpaqueBinLen; i++) {\n                this.#drawLayer(selectedSilhouetteOpaqueBin[i], RENDER_PASSES.SILHOUETTE_SELECTED);\n            }\n        }\n\n        if (selectedSilhouetteTransparentBinLen > 0 || selectedEdgesTransparentBinLen > 0) {\n            renderContext.lastProgramId = -1;\n            gl.clear(gl.DEPTH_BUFFER_BIT);\n            gl.enable(gl.CULL_FACE);\n            gl.enable(gl.BLEND);\n            if (this.#canvasTransparent) {\n                gl.blendEquation(gl.FUNC_ADD);\n                gl.blendFuncSeparate(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n            } else {\n                gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n            }\n            for (let i = 0; i < selectedEdgesTransparentBinLen; i++) {\n                this.#drawLayer(selectedEdgesTransparentBin[i], RENDER_PASSES.EDGES_SELECTED);\n            }\n            for (let i = 0; i < selectedSilhouetteTransparentBinLen; i++) {\n                this.#drawLayer(selectedSilhouetteTransparentBin[i], RENDER_PASSES.SILHOUETTE_SELECTED);\n            }\n            gl.disable(gl.BLEND);\n        }\n\n        const numTextureUnits = WEBGL_INFO.MAX_TEXTURE_UNITS;\n        for (let ii = 0; ii < numTextureUnits; ii++) {\n            gl.activeTexture(gl.TEXTURE0 + ii);\n        }\n        gl.bindTexture(gl.TEXTURE_CUBE_MAP, null);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n\n        const numVertexAttribs = WEBGL_INFO.MAX_VERTEX_ATTRIBS; // Fixes https://github.com/xeokit/xeokit-sdk/issues/174\n        for (let ii = 0; ii < numVertexAttribs; ii++) {\n            gl.disableVertexAttribArray(ii);\n        }\n    }\n\n    #drawLayer(layer: Layer, renderPass: number, quality: boolean = true) {\n        switch (layer.renderState.primitive) {\n            case TrianglesPrimitive:\n            case SurfacePrimitive:\n            case SolidPrimitive:\n                switch (renderPass) {\n                    case RENDER_PASSES.COLOR_OPAQUE:\n                        if (layer.meshCounts.numTransparent === layer.meshCounts.numMeshes || layer.meshCounts.numXRayed === layer.meshCounts.numMeshes) {\n                            return;\n                        }\n                        if (quality) {\n                            //    this.#layerRenderers.qualityColorTriangles.draw(layer);\n                        } else {\n                            this.#layerRenderers.colorTriangles.draw(layer);\n                        }\n                        break;\n                    case RENDER_PASSES.COLOR_TRANSPARENT:\n                        if (layer.meshCounts.numTransparent === 0) {\n                            return;\n                        }\n                        if (quality) {\n                            //     this.#layerRenderers.qualityColorTriangles.draw(layer);\n                        } else {\n                            this.#layerRenderers.colorTriangles.draw(layer);\n                        }\n                        break;\n                    case RENDER_PASSES.SILHOUETTE_SELECTED:\n                        if (layer.meshCounts.numSelected > 0) {\n                            //  this.#layerRenderers.silhouetteTriangles.draw(layer);\n                        }\n                        break;\n                    case RENDER_PASSES.SILHOUETTE_HIGHLIGHTED:\n                        if (layer.meshCounts.numHighlighted > 0) {\n                            // this.#layerRenderers.silhouetteTriangles.draw(layer);\n                        }\n                        break;\n                    case RENDER_PASSES.SILHOUETTE_XRAYED:\n                        if (layer.meshCounts.numXRayed > 0) {\n                            //   this.#layerRenderers.silhouetteTriangles.draw(layer);\n                        }\n                        break;\n                }\n                break;\n            case LinesPrimitive:\n                switch (renderPass) {\n                    case RENDER_PASSES.COLOR_OPAQUE:\n                    case RENDER_PASSES.COLOR_TRANSPARENT:\n                        //this.#layerRenderers.colorLines.draw(layer);\n                        break;\n                    case RENDER_PASSES.SILHOUETTE_SELECTED:\n                    case RENDER_PASSES.SILHOUETTE_HIGHLIGHTED:\n                    case RENDER_PASSES.SILHOUETTE_XRAYED:\n                        // this.#layerRenderers.silhouetteLines.draw(layer);\n                        break;\n                }\n                break;\n            case PointsPrimitive:\n                switch (renderPass) {\n                    case RENDER_PASSES.COLOR_OPAQUE:\n                    case RENDER_PASSES.COLOR_TRANSPARENT:\n                        //  this.#layerRenderers.colorPoints.draw(layer);\n                        break;\n                    case RENDER_PASSES.SILHOUETTE_SELECTED:\n                    case RENDER_PASSES.SILHOUETTE_HIGHLIGHTED:\n                    case RENDER_PASSES.SILHOUETTE_XRAYED:\n                        //  this.#layerRenderers.silhouettePoints.draw(layer);\n                        break;\n                }\n                break;\n        }\n    }\n\n\n}"],"names":["s","t","e","Object","defineProperty","i","writable","value","o","n","this","prototype","addItem","arguments","length","r","removeItem","he","ie","u","c","ETC1S","UASTC_4x4","f","ETC1","ETC2","BC1","BC3","BC4","BC5","BC7_M6_OPAQUE_ONLY","BC7_M5","PVRTC1_4_RGB","PVRTC1_4_RGBA","ASTC_4x4","ATC_RGB","ATC_RGBA_INTERPOLATED_ALPHA","RGBA32","RGB565","BGR565","RGBA4444","l","RGBAFormat","RGBA_ASTC_4x4_Format","RGBA_BPTC_Format","RGBA_ETC2_EAC_Format","RGBA_PVRTC_4BPPV1_Format","RGBA_S3TC_DXT5_Format","RGB_ETC1_Format","RGB_ETC2_Format","RGB_PVRTC_4BPPV1_Format","RGB_S3TC_DXT1_Format","p","m","v","T","g","_","w","C","S","y","F","transcoderPath","a","workerLimit","setWorkerLimit","init","astcSupported","etc1Supported","etc2Supported","dxtSupported","bptcSupported","pvrtcSupported","transcode","Promise","then","postMessage","type","buffers","taskConfig","data","mipmaps","format","dfdTransferFn","dfdFlags","error","props","minFilter","magFilter","encoding","premultiplyAlpha","destroy","URL","revokeObjectURL","h","setPath","setWithCredentials","loadAsync","setResponseType","all","P","toString","JSON","stringify","substring","indexOf","lastIndexOf","join","createObjectURL","Blob","setWorkerCreator","Worker","slice","config","transcoderBinary","console","warn","_EngineFormat","_TranscoderFormat","_BasisFormat","self","addEventListener","wasmBinary","onRuntimeInitialized","BASIS","initializeBasis","KTX2File","Uint8Array","close","isValid","Error","isUASTC","getWidth","getHeight","getLevels","getHasAlpha","getDFDTransferFunc","getDFDFlags","d","basisFormat","includes","transcoderFormat","needsPowerOfTwo","engineFormat","startTranscoding","getImageLevelInfo","origWidth","origHeight","R","getImageTranscodedSizeInBytes","transcodeImage","push","width","height","hasAlpha","buffer","id","message","if","priorityETC1S","Infinity","priorityUASTC","sort","RenderContext","viewer","view","gl","viewMatrixDataTexture","pbrEnabled","withSAO","backfaces","frontface","textureUnit","bindTexture","renderPass","shadowViewMatrix","shadowProjMatrix","pickViewMatrix","pickProjMatrix","pickZNear","pickZFar","pickInvisible","lineWidth","lastProgramId","occlusionTexture","reset","_createClass","key","get","WEBGL_INFO","MAX_TEXTURE_UNITS","O","k","_head","_headLength","_tail","_index","_length","shift","unshift","clear","enumerable","configurable","Symbol","toPrimitive","call","TypeError","String","map","charCodeAt","fromCharCode","apply","x","isNaN","parseFloat","isFinite","RENDER_PASSES","NOT_RENDERED","COLOR_OPAQUE","COLOR_TRANSPARENT","SILHOUETTE_HIGHLIGHTED","SILHOUETTE_SELECTED","SILHOUETTE_XRAYED","EDGES_COLOR_OPAQUE","EDGES_COLOR_TRANSPARENT","EDGES_HIGHLIGHTED","EDGES_SELECTED","EDGES_XRAYED","PICK","tempVec4","createVec4","_hash","_classPrivateFieldLooseKey","_program","_needRebuild","_uniforms","_samplers","_build","_buildShader","_getValid","_bind","LayerRenderer","renderContext","_bind2","_getValid2","_buildShader2","_build2","errors","_classPrivateFieldLooseBase","_proto","needRebuild","draw","layer","renderState","program","uniforms","samplers","uniform1i","projMatrix","uniformMatrix4fv","camera","worldMatrix","rendererModel","color","material","xrayMaterial","fillColor","uniform4f","fillAlpha","highlightMaterial","selectedMaterial","uniform4fv","Float32Array","viewMatrices","dataTextureSet","nextTextureUnit","positions","eachMeshMatrices","eachMeshAttributes","eachPrimitiveMesh","numIndices8Bits","eachPrimitiveMesh_8Bits","indices_8Bits","indices","drawArrays","TRIANGLES","numIndices16Bits","eachPrimitiveMesh_16Bits","indices_16Bits","numIndices32Bits","eachPrimitiveMesh_32Bits","indices_32Bits","baseColorMap","materialTextureSet","colorTexture","texture2D","metallicRoughMap","metallicRoughnessTexture","emissiveMap","emissiveTexture","occlusionMap","logarithmicDepthBufferEnabled","fragHeader","fragGammaDefs","fragSectionPlaneDefs","fragLightDefs","fragLogDepthBufDefs","fragSectionPlanesSlice","fragLighting","fragLogDepthBufOutput","src","len","lightsList","light","space","sao","enabled","sectionPlanesList","AmbientLight","DirLight","PointLight","GLProgram","getLocation","viewMatrix","logDepthBufFC","gammaFactor","pointSize","nearPlaneHeight","pointCloudIntensityRange","lightAmbient","lights","sectionPlanes","dir","pos","attenuation","active","getSampler","edgeIndices","eachEdgeOffset","eachEdgeMesh","normalMap","getHash","vertex","buildVertexShader","fragment","buildFragmentShader","project","bind","getAmbientColorAndIntensity","fragLightSourceUniforms","intensity","uniform3f","uniform1f","possible","viewportHeight","drawingBufferHeight","drawingBufferWidth","blendCutoff","blendFactor","pointsMaterial","projectionType","Math","tan","perspectiveProjection","fov","PI","log","far","LN2","FastColorTrianglesRenderer","_LayerRenderer","_inheritsLoose","getSectionPlanesHash","getLightsHash","vertHeader","fragFlatShading","Float64Array","z","D","G","DataTextureSet","edgeIndices_8Bits","edgeIndices_16Bits","edgeIndices_32Bits","eachEdgeMesh_8Bits","eachEdgeMesh_16Bits","eachEdgeMesh_32Bits","_built","build","MeshCounts","numMeshes","numVisible","numTransparent","numEdges","numXRayed","numSelected","numHighlighted","numClippable","numPickable","numCulled","SCENE_OBJECT_FLAGS","VISIBLE","CULLED","PICKABLE","CLIPPABLE","COLLIDABLE","CAST_SHADOW","RECEIVE_SHADOW","XRAYED","HIGHLIGHTED","SELECTED","EDGES","BACKFACES","TRANSPARENT","Reflect","construct","getOwnPropertyDescriptor","getPrototypeOf","has","ownKeys","set","setPrototypeOf","Proxy","Number","iterator","species","toStringTag","b","A","create","B","freeze","E","is","isPrototypeOf","j","hasOwn","hasOwnProperty","I","Array","isArray","L","toLocaleString","N","trunc","U","ArrayBuffer","M","isView","W","SharedArrayBuffer","V","Y","from","K","X","keys","q","values","H","entries","J","Q","reverse","Z","fill","$","copyWithin","tt","rt","nt","subarray","et","ot","it","st","ct","Uint16Array","ut","ft","Uint32Array","ht","lt","at","next","yt","_regeneratorRuntime","mark","_callee","wrap","_context","prev","stop","pt","vt","bt","RangeError","At","Set","mt","Bt","add","xt","Et","WeakMap","Tt","Ot","jt","It","Pt","St","_t","Ft","Lt","Rt","Ct","Nt","Ut","Mt","kt","_m","Wt","Vt","_m2","Yt","zt","Gt","Kt","Xt","qt","Ht","Jt","Qt","MAX_SAFE_INTEGER","Zt","$t","tr","constructor","rr","nr","er","or","ir","sr","cr","ur","ar","byteOffset","fr","_step","hr","_iterator","_createForOfIteratorHelperLoose","done","lr","concat","_this","of","_callee2","_iterator2","_step2","_r10","_context2","_callee3","_iterator3","_step3","_step3$value","_r11","_n6","_context3","filter","reduce","reduceRight","forEach","find","findIndex","findLast","findLastIndex","every","some","yr","emptyDataTexture","GLDataTexture","textureWidth","textureHeight","disableFilteringForBoundTexture","texParameteri","TEXTURE_2D","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","DataTextureBuffer","positionsDecompressMatrices","positionsCompressed","eachMeshVertexPortionBase","eachMeshVertexPortionOffset","eachMeshEdgeIndicesOffset","eachMeshColor","eachMeshPickColor","eachMeshNormalMatrix","eachMeshPositionsDecompressMatrix","eachMeshFlags1","eachMeshFlags2","eachMeshParts","INDICES_EDGE_INDICES_ALIGNMENT_SIZE","identityMatrix","identityMat4","tempVec4a","tempVec4b","tempUint8Array4","tempFloat32Array3","_gl","_view","_dataTextureBuffer","_geometryHandles","_meshPartHandles","_numMeshParts","_deferredSetFlagsActive","_deferredSetFlagsDirty","_createGeometryBucket","_createMeshPart","_setMeshFlags","_setMeshFlags3","Layer","layerParams","renderers","_setMeshFlags4","_setMeshFlags2","_createMeshPart2","_createGeometryBucket2","layerIndex","meshCounts","primitive","numEdgeIndices8Bits","numEdgeIndices16Bits","numEdgeIndices32Bits","numVertices","beginDeferredFlags","canCreateMesh","geometryCompressedParams","numGeometryBuckets","geometryBuckets","numPositions","numIndices","geometryBucket","PointsPrimitive","LinesPrimitive","MAX_DATATEXTURE_HEIGHT","hasGeometry","geometryId","createGeometryCompressed","geometryBucketHandles","aabb","positionsDecompressMatrix","createMesh","meshParams","meshIndex","geometryHandle","geometryBucketHandle","worldAABB","collapseAABB3","geometryOBB","AABB3ToOBB3","matrix","transformPoint4","expandAABB3Point3","dataTextureBuffer","ceil","textureData","texture","createTexture","texStorage2D","RGB16UI","texSubImage2D","RGB_INTEGER","UNSIGNED_SHORT","createPositionsDataTexture","RGB8UI","UNSIGNED_BYTE","createIndices8BitDataTexture","createIndices16BitDataTexture","RGB32UI","UNSIGNED_INT","createIndices32BitDataTexture","RG8UI","RG_INTEGER","createEdgeIndices8BitDataTexture","RG16UI","createEdgeIndices16BitDataTexture","RG32UI","createEdgeIndices32BitDataTexture","colors","pickColors","vertexBases","indexBaseOffsets","edgeIndexBaseOffsets","RGBA8UI","RGBA_INTEGER","createEachMeshAttributesDataTexture","positionDecodeMatrices","matrices","Float16Array","RGBA16F","RGBA","HALF_FLOAT","createEachMeshMatricesDataTexture","offsets","RGB32F","RGB","FLOAT","createEachEdgeOffsetDataTexture","isEmpty","initFlags","flags","meshTransparent","commitDeferredFlags","flushInitFlags","setMeshVisible","transparent","setMeshHighlighted","setMeshXRayed","setMeshSelected","setMeshEdges","setMeshClippable","setMeshCulled","setMeshCollidable","setMeshPickable","setMeshColor","setMeshTransparent","setMeshOffset","offset","setMeshMatrix","setMeshViewMatrixIndex","index","numVertsForPrim","alignedIndicesLen","alignedIndices","alignedEdgeIndicesLen","alignedEdgeIndices","indicesBase","vertexBase","edgeIndicesBase","numTriangles","indicesBuffer","edgeIndicesBuffer","currentNumIndices","vertsIndex","pickColor","meshPartId","eachPrimitiveMeshBuffer","edgeIndicesMeshIdBuffer","numEdgeIndices","vertsBase","numVerts","f0","f1","f2","visible","xrayed","highlighted","selected","culled","f3","clippable","RendererGeometryImpl","RendererTextureImpl","tempIntRGB","_flags","_aabb","_offsetAABB","_offset","_colorizeUpdated","_opacityUpdated","RendererObjectImpl","params","model","sceneObject","layerId","rendererMeshes","createAABB3","createVec3","setSceneObject","setVisible","viewIndex","setHighlighted","setXRayed","setSelected","setEdges","edges","setCulled","setClippable","setCollidable","collidable","setPickable","pickable","setColorize","floor","setOpacity","opacity","lastOpacityQuantized","colorize","opacityQuantized","setOffset","finalize2","tempMat4a","createMat4","tempMat4b","RendererMeshImpl","rendererGeometry","rendererTextureSet","metallic","roughness","pickId","tileManager","tile","sceneObjectRenderer","colorizing","delegatePickedEntity","setMatrix","center","transformPoint3","oldTile","updateTileCenter","getTile","tileChanged","tileCenter","mulMat4","translationMat4c","setMetallic","setRoughness","setColor","newTransparent","changingTransparency","canPickTriangle","drawPickTriangles","drawFlags","pickTriangleSurface","pickResult","canPickWorldPos","drawPickNormals","putTile","RendererTextureSetImpl","identityQuat","defaultTextureSetId","_webglRenderer","_renderContext","_position","_rotation","_quaternion","_scale","_worldMatrix","_viewMatrix","_colorTextureEnabled","_backfaces","_layers","_numGeometries","_numTriangles","_numLines","_numPoints","_numViewerObjects","_textureTranscoder","_aabbDirty","_edgeThreshold","_currentLayers","_viewMatrixDirty","_worldMatrixNonIdentity","_onCameraViewMatrix","_layerId","_addModel","_addTexture","_addGeometry","_addMesh","_addObject","_removeModel","_createDefaultTextureSetRenderer","_getLayer","_rebuildAABB","RendererModelImpl","_Component","_assertThisInitialized","_rebuildAABB2","_getLayer2","_createDefaultTextureSetRenderer2","_removeModel2","_addObject2","_addMesh2","_addGeometry2","_addTexture2","_addModel2","qualityRender","sceneModel","rendererGeometries","rendererTextures","rendererTextureSets","rendererObjects","rendererObjectsList","rendererViewObjects","layerList","onBuilt","webglRenderer","textureTranscoder","edgeThreshold","built","position","rotation","quaternion","eulerToQuat","scale","composeMat4","onViewMatrix","subscribe","EventEmitter","EventDispatcher","setImageDirty","dispatch","destroyed","unsubscribe","objectId","Component","textures","geometries","meshes","objects","textureId","geometry","meshId","mesh","object","_this2","glTexture","GLTexture","preloadColor","setPreloadColor","image","crossOrigin","setImage","wrapS","wrapT","wrapR","flipY","ext","split","pop","Image","onload","loadArraybuffer","arrayBuffer","byteLength","compressedTextureData","setCompressedData","errMsg","rendererTexture","textureSet","meshMatrix","meshRenderer","registerPickable","expandAABB3","undefined","createUUID","objectRenderer","rendererMesh","rendererObject","defaultColorTexture","defaultMetalRoughTexture","defaultNormalsTexture","defaultEmissiveTexture","defaultOcclusionTexture","textureSetId","tempMat","rtcCenterWorld","rtcCenterView","worldToRTCCenter","worldCenter","rtcCenter","cellSize","round","NUM_TILES","_indexesUsed","_tiles","_dataTexture","_camera","_lastFreeIndex","_putFreeTile","_findFreeTile","TileManager","_findFreeTile2","_putFreeTile2","numMatrices","createMatricesDataTexture","useCount","rtcViewMatrix","newCenter","newRTCCenter","newId","newTile","refreshMatrices","viewMat","rtcViewMat","tileIds","tileId","transformVec4","setMat4Translation","ua","navigator","userAgent","match","isSafari","toLowerCase","_sceneModels","_viewer","_canvasTransparent","_transparentEnabled","_edgesEnabled","_imageDirty","_saoEnabled","_pbrEnabled","_backgroundColor","_rendererModels","_layerList","_layerListDirty","_stateSortDirty","_pickIDs","_saoDepthRenderBuffer","_renderBufferManager","_extensionHandles","_logarithmicDepthBufferEnabled","_alphaDepthMask","_occlusionTester","_layerRenderers","_registerRendererViewObjects","_deregisterRendererViewObjects","_updateLayerList","_buildLayerList","_draw","_activateExtensions","_drawSAOBuffers","_drawDepth","_drawColor","_drawLayer","WebGLRenderer","_drawLayer2","_drawColor2","_drawDepth2","_drawSAOBuffers2","_activateExtensions2","_draw2","_buildLayerList2","_updateLayerList2","_deregisterRendererViewObjects2","_registerRendererViewObjects2","Map","KTX2TextureTranscoder","capabilities","getCapabilities","maxViews","canvasElement","document","createElement","getContext","getExtension","registerView","WEBGL_CONTEXT_NAMES","contextAttr","hint","FRAGMENT_SHADER_DERIVATIVE_HINT","NICEST","colorTriangles","sub","deregisterView","addModel","onDestroyed","one","component","removeModel","modelId","deregisterPickable","setBackgroundColor","setEdgesEnabled","setPBREnabled","getSAOSupported","SUPPORTED_EXTENSIONS","setSAOEnabled","setTransparentEnabled","viewport","clearColor","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","needsRebuild","rendererId","needsRender","render","force","pickSceneObject","lenDrawableList","webGLSceneModelRenderer","OES_element_index_uint","EXT_frag_depth","WEBGL_depth_texture","enable","DEPTH_TEST","frontFace","CCW","CULL_FACE","depthMask","normalDrawSAOBin","edgesColorOpaqueBin","normalFillTransparentBin","edgesColorTransparentBin","xrayedSilhouetteOpaqueBin","xrayEdgesOpaqueBin","xrayedSilhouetteTransparentBin","xrayEdgesTransparentBin","highlightedSilhouetteOpaqueBin","highlightedEdgesOpaqueBin","highlightedSilhouetteTransparentBin","highlightedEdgesTransparentBin","selectedSilhouetteOpaqueBin","selectedEdgesOpaqueBin","selectedSilhouetteTransparentBin","selectedEdgesTransparentBin","saoPossible","occlusionRenderBuffer1","getRenderBuffer","depthTexture","size","getTexture","normalDrawSAOBinLen","edgesColorOpaqueBinLen","normalFillTransparentBinLen","edgesColorTransparentBinLen","xrayedSilhouetteOpaqueBinLen","xrayEdgesOpaqueBinLen","xrayedSilhouetteTransparentBinLen","xrayEdgesTransparentBinLen","highlightedSilhouetteOpaqueBinLen","highlightedEdgesOpaqueBinLen","highlightedSilhouetteTransparentBinLen","highlightedEdgesTransparentBinLen","selectedSilhouetteOpaqueBinLen","selectedEdgesOpaqueBinLen","selectedSilhouetteTransparentBinLen","selectedEdgesTransparentBinLen","edgeMaterial","edgeAlpha","BLEND","blendEquation","FUNC_ADD","blendFuncSeparate","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","ONE","blendFunc","disable","numTextureUnits","ii","activeTexture","TEXTURE0","TEXTURE_CUBE_MAP","numVertexAttribs","MAX_VERTEX_ATTRIBS","disableVertexAttribArray","quality"],"mappings":"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"}