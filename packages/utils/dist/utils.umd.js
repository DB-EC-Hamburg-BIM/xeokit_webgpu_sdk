!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t||self).utils={})}(this,function(t){function e(t,r){return e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},e(t,r)}var r=0;function n(t){return"__private_"+r+++"_"+t}function i(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var o=/*#__PURE__*/n("items"),s=/*#__PURE__*/n("lastUniqueId"),a=/*#__PURE__*/function(){function t(t,e){Object.defineProperty(this,o,{writable:!0,value:void 0}),Object.defineProperty(this,s,{writable:!0,value:void 0}),i(this,o)[o]=t||[],i(this,s)[s]=(e||0)+1}var e=t.prototype;return e.addItem=function(){var t;if(2===arguments.length){var e=arguments[0];if(t=arguments[1],i(this,o)[o][e])throw"ID clash: '"+e+"'";return i(this,o)[o][e]=t,e}for(t=arguments[0]||{};;){var r=i(this,s)[s]++;if(!i(this,o)[o][r])return i(this,o)[o][r]=t,r}},e.removeItem=function(t){var e=i(this,o)[o][t];return delete i(this,o)[o][t],e},t}(),u=/*#__PURE__*/function(){function t(){this._head=void 0,this._headLength=void 0,this._tail=void 0,this._index=void 0,this._length=void 0,this._head=[],this._headLength=0,this._tail=[],this._index=0,this._length=0}var e,r,n=t.prototype;return n.shift=function(){if(this._index>=this._headLength){var t=this._head;if(t.length=0,this._head=this._tail,this._tail=t,this._index=0,this._headLength=this._head.length,!this._headLength)return}var e=this._head[this._index];return this._index<0?delete this._head[this._index++]:this._head[this._index++]=void 0,this._length--,e},n.push=function(t){return this._length++,this._tail.push(t),this},n.unshift=function(t){return this._head[--this._index]=t,this._length++,this},n.clear=function(){this._head=[],this._headLength=0,this._tail=[],this._index=0,this._length=0},e=t,(r=[{key:"length",get:function(){return this._length}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,"symbol"==typeof(i=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key))?i:String(i),n)}var i}(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}(),h=/*#__PURE__*/function(){function t(t,e,r){this.isLoading=void 0,this.itemsLoaded=void 0,this.itemsTotal=void 0,this.urlModifier=void 0,this.handlers=void 0,this.onStart=void 0,this.onLoad=void 0,this.onProgress=void 0,this.onError=void 0,this.isLoading=!1,this.itemsLoaded=0,this.itemsTotal=0,this.urlModifier=void 0,this.handlers=[],this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=r}var e=t.prototype;return e.itemStart=function(t){this.itemsTotal++,this.isLoading||void 0!==this.onStart&&this.onStart(t,this.itemsLoaded,this.itemsTotal),this.isLoading=!0},e.itemEnd=function(t){this.itemsLoaded++,void 0!==this.onProgress&&this.onProgress(t,this.itemsLoaded,this.itemsTotal),this.itemsLoaded===this.itemsTotal&&(this.isLoading=!1,void 0!==this.onLoad&&this.onLoad())},e.itemError=function(t){void 0!==this.onError&&this.onError(t)},e.resolveURL=function(t){return this.urlModifier?this.urlModifier(t):t},e.setURLModifier=function(t){return this.urlModifier=t,this},e.addHandler=function(t,e){return this.handlers.push(t,e),this},e.removeHandler=function(t){var e=this.handlers.indexOf(t);return-1!==e&&this.handlers.splice(e,2),this},e.getHandler=function(t){for(var e=0,r=this.handlers.length;e<r;e+=2){var n=this.handlers[e],i=this.handlers[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return i}return null},t}(),d=new h,f=/*#__PURE__*/function(){function t(t){this.manager=void 0,this.crossOrigin=void 0,this.withCredentials=void 0,this.path=void 0,this.resourcePath=void 0,this.requestHeader=void 0,this.manager=void 0!==t?t:d,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}var e=t.prototype;return e.load=function(t,e,r,n){},e.loadAsync=function(t,e){var r=this;return new Promise(function(n,i){r.load(t,n,e,i)})},e.parse=function(){},e.setCrossOrigin=function(t){return this.crossOrigin=t,this},e.setWithCredentials=function(t){return this.withCredentials=t,this},e.setPath=function(t){return this.path=t,this},e.setResourcePath=function(t){return this.resourcePath=t,this},e.setRequestHeader=function(t){return this.requestHeader=t,this},t}(),c=/*#__PURE__*/function(){function t(t){void 0===t&&(t=4),this.pool=void 0,this.queue=void 0,this.workers=void 0,this.workersResolve=void 0,this.workerStatus=void 0,this.workerCreator=void 0,this.pool=t,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}var e=t.prototype;return e._initWorker=function(t){if(!this.workers[t]){var e=this.workerCreator();e.addEventListener("message",this._onMessage.bind(this,t)),this.workers[t]=e}},e._getIdleWorker=function(){for(var t=0;t<this.pool;t++)if(!(this.workerStatus&1<<t))return t;return-1},e._onMessage=function(t,e){var r=this.workersResolve[t];if(r&&r(e),this.queue.length){var n=this.queue.shift(),i=n.msg,o=n.transfer;this.workersResolve[t]=n.resolve,this.workers[t].postMessage(i,o)}else this.workerStatus^=1<<t},e.setWorkerCreator=function(t){this.workerCreator=t},e.setWorkerLimit=function(t){this.pool=t},e.postMessage=function(t,e){var r=this;return new Promise(function(n){var i=r._getIdleWorker();-1!==i?(r._initWorker(i),r.workerStatus|=1<<i,r.workersResolve[i]=n,r.workers[i].postMessage(t,e)):r.queue.push({resolve:n,msg:t,transfer:e})})},e.destroy=function(){this.workers.forEach(function(t){return t.terminate()}),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0},t}(),l={enabled:!1,files:{},add:function(t,e){},get:function(t){},remove:function(t){},clear:function(){this.files={}}},v={},p=/*#__PURE__*/function(t){var r,n;function i(e){var r;return(r=t.call(this,e)||this).mimeType=void 0,r.responseType=void 0,r}n=t,(r=i).prototype=Object.create(n.prototype),r.prototype.constructor=r,e(r,n);var o=i.prototype;return o.load=function(t,e,r,n){var i=this;void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var o=l.get(t);if(void 0!==o)return this.manager.itemStart(t),setTimeout(function(){e&&e(o),i.manager.itemEnd(t)},0),o;if(void 0===v[t]){v[t]=[],v[t].push({onLoad:e,onProgress:r,onError:n});var s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,u=this.responseType;fetch(s).then(function(e){if(200===e.status||0===e.status){if(0===e.status&&console.warn("FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===e.body.getReader)return e;var r=v[t],n=e.body.getReader(),i=e.headers.get("Content-Length"),o=i?parseInt(i):0,s=0!==o,a=0,u=new ReadableStream({start:function(t){!function e(){n.read().then(function(n){var i=n.value;if(n.done)t.close();else{for(var u=new ProgressEvent("progress",{lengthComputable:s,loaded:a+=i.byteLength,total:o}),h=0,d=r.length;h<d;h++){var f=r[h];f.onProgress&&f.onProgress(u)}t.enqueue(i),e()}})}()}});return new Response(u)}throw new Error('fetch for "'+e.url+'" responded with '+e.status+": "+e.statusText)}).then(function(t){switch(u){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then(function(t){return(new DOMParser).parseFromString(t,a)});case"json":return t.json();default:if(void 0===a)return t.text();var e=/charset="?([^;"\s]*)"?/i.exec(a),r=e&&e[1]?e[1].toLowerCase():void 0,n=new TextDecoder(r);return t.arrayBuffer().then(function(t){return n.decode(t)})}}).then(function(e){l.add(t,e);var r=v[t];delete v[t];for(var n=0,i=r.length;n<i;n++){var o=r[n];o.onLoad&&o.onLoad(e)}}).catch(function(e){var r=v[t];if(void 0===r)throw i.manager.itemError(t),e;delete v[t];for(var n=0,o=r.length;n<o;n++){var s=r[n];s.onError&&s.onError(e)}i.manager.itemError(t)}).finally(function(){i.manager.itemEnd(t)}),this.manager.itemStart(t)}else v[t].push({onLoad:e,onProgress:r,onError:n})},o.setResponseType=function(t){return this.responseType=t,this},o.setMimeType=function(t){return this.mimeType=t,this},i}(f),g=[["0",10],["A",26],["a",26],["_",1],["$",1]].map(function(t){for(var e=[],r=t[0].charCodeAt(0),n=r+t[1],i=r;i<n;++i)e.push(i);return String.fromCharCode.apply(null,e)}).join("");function m(t,e){return(e&&4!==e?[0,6]:[0,6,12,18]).map(function(e){return g.substr(parseInt(String(t/(1<<e)))%64,1)}).reverse().join("")}function y(t){return"string"==typeof t||t instanceof String}function w(t){return!isNaN(parseFloat(t))&&isFinite(t)}function _(t,e){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}var b=function(){for(var t=[],e=0;e<256;e++)t[e]=(e<16?"0":"")+e.toString(16);return function(){var e=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&r]+t[r>>8&255]+"-"+t[r>>16&15|64]+t[r>>24&255]+"-"+t[63&n|128]+t[n>>8&255]+"-"+t[n>>16&255]+t[n>>24&255]+t[255&i]+t[i>>8&255]+t[i>>16&255]+t[i>>24&255]}}();t.Cache=l,t.DefaultLoadingManager=d,t.FileLoader=p,t.Loader=f,t.LoadingManager=h,t.Map=a,t.Queue=u,t.WorkerPool=c,t.apply=_,t.apply2=function(t,e){for(var r in t)t.hasOwnProperty(r)&&null!=t[r]&&(e[r]=t[r]);return e},t.applyIf=function(t,e){for(var r in t)t.hasOwnProperty(r)&&null==e[r]&&(e[r]=t[r]);return e},t.b64=m,t.clone=function(t){return JSON.parse(JSON.stringify(t))},t.compressGuid=function(t){var e=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30].map(function(e){return parseInt(t.substr(e,2),16)});return m(e[0],2)+[1,4,7,10,13].map(function(t){return m((e[t]<<16)+(e[t+1]<<8)+e[t+2],4)}).join("")},t.concat=function(t,e){var r=new t.constructor(t.length+e.length);return r.set(t),r.set(e,t.length),r},t.copy=function(t){return _(t,{})},t.createUUID=b,t.findNodeOfType=function(t,e){var r=[];return function t(n){n.type===e&&r.push(n),(n.children||[]).forEach(function(e){t(e)})}(t),r},t.httpRequest=function(t){return new Promise(function(e,r){var n=new XMLHttpRequest;n.open(t.method||"GET",t.url,!0),n.onload=function(i){console.log(t.url,n.readyState,n.status),4===n.readyState&&(200===n.status?e(n.responseXML):r(n.statusText))},n.send(null)})},t.inQuotes=function(t){return w(t)?""+t:"'"+t+"'"},t.isArray=function(t){return t&&!t.propertyIsEnumerable("length")&&"object"==typeof t&&"number"==typeof t.length},t.isEmptyObject=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},t.isFunction=function(t){return"function"==typeof t},t.isID=function(t){return y(t)||w(t)},t.isNumeric=w,t.isObject=function(t){return!!t&&t.constructor==={}.constructor},t.isString=y,t.loadArraybuffer=function(t,e,r){var n=function(t){};e=e||n,r=r||n;var i=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(i){var o=!!i[2],s=i[3];s=window.decodeURIComponent(s),o&&(s=window.atob(s));try{for(var a=new ArrayBuffer(s.length),u=new Uint8Array(a),h=0;h<s.length;h++)u[h]=s.charCodeAt(h);window.setTimeout(function(){e(a)},0)}catch(t){window.setTimeout(function(){r(t)},0)}}else{var d=new XMLHttpRequest;d.open("GET",t,!0),d.responseType="arraybuffer",d.onreadystatechange=function(){4===d.readyState&&(200===d.status?e(d.response):r("loadArrayBuffer error : "+d.response))},d.send(null)}},t.loadJSON=function(t,e,r){var n=function(t){};e=e||n,r=r||n;var i=new XMLHttpRequest;i.overrideMimeType("application/json"),i.open("GET",t,!0),i.addEventListener("load",function(t){var n=t.target.response;if(200===this.status){var i;try{i=JSON.parse(n)}catch(t){r("utils.loadJSON(): Failed to parse JSON response - "+t)}e(i)}else if(0===this.status){console.warn("loadFile: HTTP Status 0 received.");try{e(JSON.parse(n))}catch(t){r("utils.loadJSON(): Failed to parse JSON response - "+t)}}else r(t)},!1),i.addEventListener("error",function(t){r(t)},!1),i.send(null)},t.timeout=function(t){return new Promise(function(e,r){setTimeout(e,t)})}});
//# sourceMappingURL=utils.umd.js.map
