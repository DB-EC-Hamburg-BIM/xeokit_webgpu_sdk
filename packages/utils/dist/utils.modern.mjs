var t=0;function e(e){return"__private_"+t+++"_"+e}function s(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var r=/*#__PURE__*/e("items"),n=/*#__PURE__*/e("lastUniqueId");class i{constructor(t,e){Object.defineProperty(this,r,{writable:!0,value:void 0}),Object.defineProperty(this,n,{writable:!0,value:void 0}),s(this,r)[r]=t||[],s(this,n)[n]=(e||0)+1}addItem(){let t;if(2===arguments.length){const e=arguments[0];if(t=arguments[1],s(this,r)[r][e])throw"ID clash: '"+e+"'";return s(this,r)[r][e]=t,e}for(t=arguments[0]||{};;){const e=s(this,n)[n]++;if(!s(this,r)[r][e])return s(this,r)[r][e]=t,e}}removeItem(t){const e=s(this,r)[r][t];return delete s(this,r)[r][t],e}}class o{constructor(){this._head=void 0,this._headLength=void 0,this._tail=void 0,this._index=void 0,this._length=void 0,this._head=[],this._headLength=0,this._tail=[],this._index=0,this._length=0}get length(){return this._length}shift(){if(this._index>=this._headLength){const t=this._head;if(t.length=0,this._head=this._tail,this._tail=t,this._index=0,this._headLength=this._head.length,!this._headLength)return}const t=this._head[this._index];return this._index<0?delete this._head[this._index++]:this._head[this._index++]=void 0,this._length--,t}push(t){return this._length++,this._tail.push(t),this}unshift(t){return this._head[--this._index]=t,this._length++,this}clear(){this._head=[],this._headLength=0,this._tail=[],this._index=0,this._length=0}}class h{constructor(t,e,s){this.isLoading=void 0,this.itemsLoaded=void 0,this.itemsTotal=void 0,this.urlModifier=void 0,this.handlers=void 0,this.onStart=void 0,this.onLoad=void 0,this.onProgress=void 0,this.onError=void 0,this.isLoading=!1,this.itemsLoaded=0,this.itemsTotal=0,this.urlModifier=void 0,this.handlers=[],this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=s}itemStart(t){this.itemsTotal++,this.isLoading||void 0!==this.onStart&&this.onStart(t,this.itemsLoaded,this.itemsTotal),this.isLoading=!0}itemEnd(t){this.itemsLoaded++,void 0!==this.onProgress&&this.onProgress(t,this.itemsLoaded,this.itemsTotal),this.itemsLoaded===this.itemsTotal&&(this.isLoading=!1,void 0!==this.onLoad&&this.onLoad())}itemError(t){void 0!==this.onError&&this.onError(t)}resolveURL(t){return this.urlModifier?this.urlModifier(t):t}setURLModifier(t){return this.urlModifier=t,this}addHandler(t,e){return this.handlers.push(t,e),this}removeHandler(t){const e=this.handlers.indexOf(t);return-1!==e&&this.handlers.splice(e,2),this}getHandler(t){for(let e=0,s=this.handlers.length;e<s;e+=2){const s=this.handlers[e],r=this.handlers[e+1];if(s.global&&(s.lastIndex=0),s.test(t))return r}return null}}const a=new h;class d{constructor(t){this.manager=void 0,this.crossOrigin=void 0,this.withCredentials=void 0,this.path=void 0,this.resourcePath=void 0,this.requestHeader=void 0,this.manager=void 0!==t?t:a,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(t,e,s,r){}loadAsync(t,e){const s=this;return new Promise(function(r,n){s.load(t,r,e,n)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}class u{constructor(t=4){this.pool=void 0,this.queue=void 0,this.workers=void 0,this.workersResolve=void 0,this.workerStatus=void 0,this.workerCreator=void 0,this.pool=t,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(t){if(!this.workers[t]){const e=this.workerCreator();e.addEventListener("message",this._onMessage.bind(this,t)),this.workers[t]=e}}_getIdleWorker(){for(let t=0;t<this.pool;t++)if(!(this.workerStatus&1<<t))return t;return-1}_onMessage(t,e){const s=this.workersResolve[t];if(s&&s(e),this.queue.length){const{resolve:e,msg:s,transfer:r}=this.queue.shift();this.workersResolve[t]=e,this.workers[t].postMessage(s,r)}else this.workerStatus^=1<<t}setWorkerCreator(t){this.workerCreator=t}setWorkerLimit(t){this.pool=t}postMessage(t,e){return new Promise(s=>{const r=this._getIdleWorker();-1!==r?(this._initWorker(r),this.workerStatus|=1<<r,this.workersResolve[r]=s,this.workers[r].postMessage(t,e)):this.queue.push({resolve:s,msg:t,transfer:e})})}destroy(){this.workers.forEach(t=>t.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const l={enabled:!1,files:{},add:function(t,e){},get:function(t){},remove:function(t){},clear:function(){this.files={}}},c={};class f extends d{constructor(t){super(t),this.mimeType=void 0,this.responseType=void 0}load(t,e,s,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const n=l.get(t);if(void 0!==n)return this.manager.itemStart(t),setTimeout(()=>{e&&e(n),this.manager.itemEnd(t)},0),n;if(void 0!==c[t])return void c[t].push({onLoad:e,onProgress:s,onError:r});c[t]=[],c[t].push({onLoad:e,onProgress:s,onError:r});const i=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,h=this.responseType;fetch(i).then(e=>{if(200===e.status||0===e.status){if(0===e.status&&console.warn("FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===e.body.getReader)return e;const s=c[t],r=e.body.getReader(),n=e.headers.get("Content-Length"),i=n?parseInt(n):0,o=0!==i;let h=0;const a=new ReadableStream({start(t){!function e(){r.read().then(({done:r,value:n})=>{if(r)t.close();else{h+=n.byteLength;const r=new ProgressEvent("progress",{lengthComputable:o,loaded:h,total:i});for(let t=0,e=s.length;t<e;t++){const e=s[t];e.onProgress&&e.onProgress(r)}t.enqueue(n),e()}})}()}});return new Response(a)}throw new Error(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`)}).then(t=>{switch(h){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then(t=>(new DOMParser).parseFromString(t,o));case"json":return t.json();default:if(void 0===o)return t.text();{const e=/charset="?([^;"\s]*)"?/i.exec(o),s=e&&e[1]?e[1].toLowerCase():void 0,r=new TextDecoder(s);return t.arrayBuffer().then(t=>r.decode(t))}}}).then(e=>{l.add(t,e);const s=c[t];delete c[t];for(let t=0,r=s.length;t<r;t++){const r=s[t];r.onLoad&&r.onLoad(e)}}).catch(e=>{const s=c[t];if(void 0===s)throw this.manager.itemError(t),e;delete c[t];for(let t=0,r=s.length;t<r;t++){const r=s[t];r.onError&&r.onError(e)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}function p(t){return JSON.parse(JSON.stringify(t))}const g=[["0",10],["A",26],["a",26],["_",1],["$",1]].map(function(t){const e=[],s=t[0].charCodeAt(0),r=s+t[1];for(let t=s;t<r;++t)e.push(t);return String.fromCharCode.apply(null,e)}).join("");function m(t,e){return(e&&4!==e?[0,6]:[0,6,12,18]).map(function(e){return g.substr(parseInt(String(t/(1<<e)))%64,1)}).reverse().join("")}function v(t){const e=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30].map(function(e){return parseInt(t.substr(e,2),16)});return m(e[0],2)+[1,4,7,10,13].map(function(t){return m((e[t]<<16)+(e[t+1]<<8)+e[t+2],4)}).join("")}function w(t,e){const s=[];return function t(r){r.type===e&&s.push(r),(r.children||[]).forEach(function(e){t(e)})}(t),s}function _(t){return new Promise(function(e,s){setTimeout(e,t)})}function y(t){return new Promise(function(e,s){const r=new XMLHttpRequest;r.open(t.method||"GET",t.url,!0),r.onload=function(n){console.log(t.url,r.readyState,r.status),4===r.readyState&&(200===r.status?e(r.responseXML):s(r.statusText))},r.send(null)})}function L(t,e,s){const r=t=>{};e=e||r,s=s||r;const n=new XMLHttpRequest;n.overrideMimeType("application/json"),n.open("GET",t,!0),n.addEventListener("load",function(t){const r=t.target.response;if(200===this.status){let t;try{t=JSON.parse(r)}catch(t){s(`utils.loadJSON(): Failed to parse JSON response - ${t}`)}e(t)}else if(0===this.status){console.warn("loadFile: HTTP Status 0 received.");try{e(JSON.parse(r))}catch(t){s(`utils.loadJSON(): Failed to parse JSON response - ${t}`)}}else s(t)},!1),n.addEventListener("error",function(t){s(t)},!1),n.send(null)}function S(t,e,s){const r=t=>{};e=e||r,s=s||r;const n=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(n){const t=!!n[2];let r=n[3];r=window.decodeURIComponent(r),t&&(r=window.atob(r));try{const t=new ArrayBuffer(r.length),s=new Uint8Array(t);for(let t=0;t<r.length;t++)s[t]=r.charCodeAt(t);window.setTimeout(function(){e(t)},0)}catch(t){window.setTimeout(function(){s(t)},0)}}else{const r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onreadystatechange=function(){4===r.readyState&&(200===r.status?e(r.response):s("loadArrayBuffer error : "+r.response))},r.send(null)}}function T(t){return t&&!t.propertyIsEnumerable("length")&&"object"==typeof t&&"number"==typeof t.length}function k(t){return"string"==typeof t||t instanceof String}function P(t){return!isNaN(parseFloat(t))&&isFinite(t)}function b(t){return k(t)||P(t)}function E(t){return"function"==typeof t}function M(t){return!!t&&t.constructor==={}.constructor}function O(t){return R(t,{})}function R(t,e){for(const s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);return e}function $(t,e){for(const s in t)t.hasOwnProperty(s)&&null!=t[s]&&(e[s]=t[s]);return e}function x(t,e){for(const s in t)t.hasOwnProperty(s)&&null==e[s]&&(e[s]=t[s]);return e}function C(t){for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}function q(t){return P(t)?`${t}`:`'${t}'`}function H(t,e){const s=new t.constructor(t.length+e.length);return s.set(t),s.set(e,t.length),s}const I=(()=>{const t=[];for(let e=0;e<256;e++)t[e]=(e<16?"0":"")+e.toString(16);return()=>{const e=4294967295*Math.random()|0,s=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return`${t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]}-${t[255&s]}${t[s>>8&255]}-${t[s>>16&15|64]}${t[s>>24&255]}-${t[63&r|128]}${t[r>>8&255]}-${t[r>>16&255]}${t[r>>24&255]}${t[255&n]}${t[n>>8&255]}${t[n>>16&255]}${t[n>>24&255]}`}})();export{l as Cache,a as DefaultLoadingManager,f as FileLoader,d as Loader,h as LoadingManager,i as Map,o as Queue,u as WorkerPool,R as apply,$ as apply2,x as applyIf,m as b64,p as clone,v as compressGuid,H as concat,O as copy,I as createUUID,w as findNodeOfType,y as httpRequest,q as inQuotes,T as isArray,C as isEmptyObject,E as isFunction,b as isID,P as isNumeric,M as isObject,k as isString,S as loadArraybuffer,L as loadJSON,_ as timeout};
//# sourceMappingURL=utils.modern.mjs.map
