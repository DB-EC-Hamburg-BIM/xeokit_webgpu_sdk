import"@xeokit/core";var e=0;function t(t){return"__private_"+e+++"_"+t}function n(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var i=Float64Array;function r(e){return new Float64Array(e||3)}function s(e){return new FloatArrayClass(e||4)}function o(e){return new i(e||16)}function a(e,t,n){return n[0]=e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12]*t[3],n[1]=e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13]*t[3],n[2]=e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14]*t[3],n[3]=e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]*t[3],n}s(),s(),new FloatArrayClass(2);var c=r(),u=r(),p=o();function l(e,t){return e[0]<=t[0]&&t[3]<=e[3]&&e[1]<=t[1]&&e[2]<=t[2]}var h=/*#__PURE__*/function(){function e(){this.testVertex=void 0,this.offset=void 0,this.normal=void 0,this.normal=r(),this.offset=0,this.testVertex=r()}return e.prototype.set=function(e,t,n,i){var r=1/Math.sqrt(e*e+t*t+n*n);this.normal[0]=e*r,this.normal[1]=t*r,this.normal[2]=n*r,this.offset=i*r,this.testVertex[0]=this.normal[0]>=0?1:0,this.testVertex[1]=this.normal[1]>=0?1:0,this.testVertex[2]=this.normal[2]>=0?1:0},e}(),m=function(){this.planes=void 0,this.planes=[new h,new h,new h,new h,new h,new h]},d=new Float32Array(2),v=/*#__PURE__*/t("insertItem"),f=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,v,{value:b}),this.root=void 0,this.maxDepth=void 0,this.maxDepth=(null==e?void 0:e.maxDepth)||10,this.root={aabb:e.aabb.slice()}}return e.prototype.insertItem=function(e,t){n(this,v)[v](this.root,{item:e},t,1)},e}();function b(e,t,i,r){if(r>=this.maxDepth)return e.items=e.items||[],void e.items.push(t);if(e.left&&l(e.left.aabb,i))n(this,v)[v](e.left,t,i,r+1);else if(e.right&&l(e.right.aabb,i))n(this,v)[v](e.right,t,i,r+1);else{var s=e.aabb;d[0]=s[2]-s[0],d[1]=s[3]-s[1];var o=0;if(d[1]>d[o]&&(o=1),!e.left){var a=s.slice();if(a[o+2]=(s[o]+s[o+2])/2,e.left={aabb:a},l(a,i))return void n(this,v)[v](e.left,t,i,r+1)}if(!e.right){var c=s.slice();if(c[o]=(s[o]+s[o+2])/2,e.right={aabb:c},l(c,i))return void n(this,v)[v](e.right,t,i,r+1)}e.items=e.items||[],e.items.push(t)}}function g(e){var t={exports:{}};return e(t,t.exports),t.exports}var P=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DispatcherWrapper=void 0,t.DispatcherWrapper=class{constructor(e){this._subscribe=t=>e.subscribe(t),this._unsubscribe=t=>e.unsubscribe(t),this._one=t=>e.one(t),this._has=t=>e.has(t),this._clear=()=>e.clear(),this._count=()=>e.count,this._onSubscriptionChange=()=>e.onSubscriptionChange}get onSubscriptionChange(){return this._onSubscriptionChange()}get count(){return this._count()}subscribe(e){return this._subscribe(e)}sub(e){return this.subscribe(e)}unsubscribe(e){this._unsubscribe(e)}unsub(e){this.unsubscribe(e)}one(e){return this._one(e)}has(e){return this._has(e)}clear(){this._clear()}}}),E=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Subscription=void 0,t.Subscription=class{constructor(e,t){this.handler=e,this.isOnce=t,this.isExecuted=!1}execute(e,t,n){if(!this.isOnce||!this.isExecuted){this.isExecuted=!0;var i=this.handler;e?setTimeout(()=>{i.apply(t,n)},1):i.apply(t,n)}}}}),y=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventManagement=void 0,t.EventManagement=class{constructor(e){this.unsub=e,this.propagationStopped=!1}stopPropagation(){this.propagationStopped=!0}}}),S=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SubscriptionChangeEventDispatcher=t.DispatcherBase=void 0;class n{constructor(){this._subscriptions=new Array}get count(){return this._subscriptions.length}get onSubscriptionChange(){return null==this._onSubscriptionChange&&(this._onSubscriptionChange=new i),this._onSubscriptionChange.asEvent()}subscribe(e){return e&&(this._subscriptions.push(this.createSubscription(e,!1)),this.triggerSubscriptionChange()),()=>{this.unsubscribe(e)}}sub(e){return this.subscribe(e)}one(e){return e&&(this._subscriptions.push(this.createSubscription(e,!0)),this.triggerSubscriptionChange()),()=>{this.unsubscribe(e)}}has(e){return!!e&&this._subscriptions.some(t=>t.handler==e)}unsubscribe(e){if(!e)return;let t=!1;for(let n=0;n<this._subscriptions.length;n++)if(this._subscriptions[n].handler==e){this._subscriptions.splice(n,1),t=!0;break}t&&this.triggerSubscriptionChange()}unsub(e){this.unsubscribe(e)}_dispatch(e,t,n){for(let i of[...this._subscriptions]){let r=new y.EventManagement(()=>this.unsub(i.handler)),s=Array.prototype.slice.call(n);if(s.push(r),i.execute(e,t,s),this.cleanup(i),!e&&r.propagationStopped)return{propagationStopped:!0}}return e?null:{propagationStopped:!1}}createSubscription(e,t){return new E.Subscription(e,t)}cleanup(e){let t=!1;if(e.isOnce&&e.isExecuted){let n=this._subscriptions.indexOf(e);n>-1&&(this._subscriptions.splice(n,1),t=!0)}t&&this.triggerSubscriptionChange()}asEvent(){return null==this._wrap&&(this._wrap=new P.DispatcherWrapper(this)),this._wrap}clear(){0!=this._subscriptions.length&&(this._subscriptions.splice(0,this._subscriptions.length),this.triggerSubscriptionChange())}triggerSubscriptionChange(){null!=this._onSubscriptionChange&&this._onSubscriptionChange.dispatch(this.count)}}t.DispatcherBase=n;class i extends n{dispatch(e){this._dispatch(!1,this,arguments)}}t.SubscriptionChangeEventDispatcher=i}),_=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DispatchError=void 0;class n extends Error{constructor(e){super(e)}}t.DispatchError=n}),D=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventListBase=void 0,t.EventListBase=class{constructor(){this._events={}}get(e){let t=this._events[e];return t||(t=this.createDispatcher(),this._events[e]=t,t)}remove(e){delete this._events[e]}}}),j=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.HandlingBase=void 0,t.HandlingBase=class{constructor(e){this.events=e}one(e,t){this.events.get(e).one(t)}has(e,t){return this.events.get(e).has(t)}subscribe(e,t){this.events.get(e).subscribe(t)}sub(e,t){this.subscribe(e,t)}unsubscribe(e,t){this.events.get(e).unsubscribe(t)}unsub(e,t){this.unsubscribe(e,t)}}}),O=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSubscription=void 0,t.PromiseSubscription=class{constructor(e,t){this.handler=e,this.isOnce=t,this.isExecuted=!1}async execute(e,t,n){if(!this.isOnce||!this.isExecuted){this.isExecuted=!0;var i=this.handler;if(e)return void setTimeout(()=>{i.apply(t,n)},1);let r=i.apply(t,n);await r}}}}),B=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseDispatcherBase=void 0,t.PromiseDispatcherBase=class extends S.DispatcherBase{_dispatch(e,t,n){throw new _.DispatchError("_dispatch not supported. Use _dispatchAsPromise.")}createSubscription(e,t){return new O.PromiseSubscription(e,t)}async _dispatchAsPromise(e,t,n){for(let i of[...this._subscriptions]){let r=new y.EventManagement(()=>this.unsub(i.handler)),s=Array.prototype.slice.call(n);s.push(r);let o=i;if(await o.execute(e,t,s),this.cleanup(i),!e&&r.propagationStopped)return{propagationStopped:!0}}return e?null:{propagationStopped:!1}}}}),L=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SubscriptionChangeEventDispatcher=t.HandlingBase=t.PromiseDispatcherBase=t.PromiseSubscription=t.DispatchError=t.EventManagement=t.EventListBase=t.DispatcherWrapper=t.DispatcherBase=t.Subscription=void 0,Object.defineProperty(t,"DispatcherBase",{enumerable:!0,get:function(){return S.DispatcherBase}}),Object.defineProperty(t,"SubscriptionChangeEventDispatcher",{enumerable:!0,get:function(){return S.SubscriptionChangeEventDispatcher}}),Object.defineProperty(t,"DispatchError",{enumerable:!0,get:function(){return _.DispatchError}}),Object.defineProperty(t,"DispatcherWrapper",{enumerable:!0,get:function(){return P.DispatcherWrapper}}),Object.defineProperty(t,"EventListBase",{enumerable:!0,get:function(){return D.EventListBase}}),Object.defineProperty(t,"EventManagement",{enumerable:!0,get:function(){return y.EventManagement}}),Object.defineProperty(t,"HandlingBase",{enumerable:!0,get:function(){return j.HandlingBase}}),Object.defineProperty(t,"PromiseDispatcherBase",{enumerable:!0,get:function(){return B.PromiseDispatcherBase}}),Object.defineProperty(t,"PromiseSubscription",{enumerable:!0,get:function(){return O.PromiseSubscription}}),Object.defineProperty(t,"Subscription",{enumerable:!0,get:function(){return E.Subscription}})}),w=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventDispatcher=void 0,t.EventDispatcher=class extends L.DispatcherBase{constructor(){super()}dispatch(e,t){const n=this._dispatch(!1,this,arguments);if(null==n)throw new L.DispatchError("Got `null` back from dispatch.");return n}dispatchAsync(e,t){this._dispatch(!0,this,arguments)}asEvent(){return super.asEvent()}}}),x=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventList=void 0,t.EventList=class extends L.EventListBase{constructor(){super()}createDispatcher(){return new w.EventDispatcher}}}),H=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventHandlingBase=void 0,t.EventHandlingBase=class extends L.HandlingBase{constructor(){super(new x.EventList)}}}),M=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformEventList=void 0,t.NonUniformEventList=class{constructor(){this._events={}}get(e){if(this._events[e])return this._events[e];const t=this.createDispatcher();return this._events[e]=t,t}remove(e){delete this._events[e]}createDispatcher(){return new w.EventDispatcher}}}),U=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformEventList=t.EventList=t.EventHandlingBase=t.EventDispatcher=void 0,Object.defineProperty(t,"EventDispatcher",{enumerable:!0,get:function(){return w.EventDispatcher}}),Object.defineProperty(t,"EventHandlingBase",{enumerable:!0,get:function(){return H.EventHandlingBase}}),Object.defineProperty(t,"EventList",{enumerable:!0,get:function(){return x.EventList}}),Object.defineProperty(t,"NonUniformEventList",{enumerable:!0,get:function(){return M.NonUniformEventList}})}),N=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleEventDispatcher=void 0,t.SimpleEventDispatcher=class extends L.DispatcherBase{constructor(){super()}dispatch(e){const t=this._dispatch(!1,this,arguments);if(null==t)throw new L.DispatchError("Got `null` back from dispatch.");return t}dispatchAsync(e){this._dispatch(!0,this,arguments)}asEvent(){return super.asEvent()}}}),k=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleEventList=void 0,t.SimpleEventList=class extends L.EventListBase{constructor(){super()}createDispatcher(){return new N.SimpleEventDispatcher}}}),A=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleEventHandlingBase=void 0,t.SimpleEventHandlingBase=class extends L.HandlingBase{constructor(){super(new k.SimpleEventList)}}}),C=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformSimpleEventList=void 0,t.NonUniformSimpleEventList=class{constructor(){this._events={}}get(e){if(this._events[e])return this._events[e];const t=this.createDispatcher();return this._events[e]=t,t}remove(e){delete this._events[e]}createDispatcher(){return new N.SimpleEventDispatcher}}}),W=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformSimpleEventList=t.SimpleEventList=t.SimpleEventHandlingBase=t.SimpleEventDispatcher=void 0,Object.defineProperty(t,"SimpleEventDispatcher",{enumerable:!0,get:function(){return N.SimpleEventDispatcher}}),Object.defineProperty(t,"SimpleEventHandlingBase",{enumerable:!0,get:function(){return A.SimpleEventHandlingBase}}),Object.defineProperty(t,"NonUniformSimpleEventList",{enumerable:!0,get:function(){return C.NonUniformSimpleEventList}}),Object.defineProperty(t,"SimpleEventList",{enumerable:!0,get:function(){return k.SimpleEventList}})}),V=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SignalDispatcher=void 0,t.SignalDispatcher=class extends L.DispatcherBase{dispatch(){const e=this._dispatch(!1,this,arguments);if(null==e)throw new L.DispatchError("Got `null` back from dispatch.");return e}dispatchAsync(){this._dispatch(!0,this,arguments)}asEvent(){return super.asEvent()}}}),I=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SignalList=void 0,t.SignalList=class extends L.EventListBase{constructor(){super()}createDispatcher(){return new V.SignalDispatcher}}}),F=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SignalHandlingBase=void 0,t.SignalHandlingBase=class extends L.HandlingBase{constructor(){super(new I.SignalList)}}}),G=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SignalList=t.SignalHandlingBase=t.SignalDispatcher=void 0,Object.defineProperty(t,"SignalDispatcher",{enumerable:!0,get:function(){return V.SignalDispatcher}}),Object.defineProperty(t,"SignalHandlingBase",{enumerable:!0,get:function(){return F.SignalHandlingBase}}),Object.defineProperty(t,"SignalList",{enumerable:!0,get:function(){return I.SignalList}})}),T=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseEventDispatcher=void 0,t.PromiseEventDispatcher=class extends L.PromiseDispatcherBase{constructor(){super()}async dispatch(e,t){const n=await this._dispatchAsPromise(!1,this,arguments);if(null==n)throw new L.DispatchError("Got `null` back from dispatch.");return n}dispatchAsync(e,t){this._dispatchAsPromise(!0,this,arguments)}asEvent(){return super.asEvent()}}}),q=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseEventList=void 0,t.PromiseEventList=class extends L.EventListBase{constructor(){super()}createDispatcher(){return new T.PromiseEventDispatcher}}}),z=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseEventHandlingBase=void 0,t.PromiseEventHandlingBase=class extends L.HandlingBase{constructor(){super(new q.PromiseEventList)}}}),J=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformPromiseEventList=void 0,t.NonUniformPromiseEventList=class{constructor(){this._events={}}get(e){if(this._events[e])return this._events[e];const t=this.createDispatcher();return this._events[e]=t,t}remove(e){delete this._events[e]}createDispatcher(){return new T.PromiseEventDispatcher}}}),K=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformPromiseEventList=t.PromiseEventList=t.PromiseEventHandlingBase=t.PromiseEventDispatcher=void 0,Object.defineProperty(t,"PromiseEventDispatcher",{enumerable:!0,get:function(){return T.PromiseEventDispatcher}}),Object.defineProperty(t,"PromiseEventHandlingBase",{enumerable:!0,get:function(){return z.PromiseEventHandlingBase}}),Object.defineProperty(t,"PromiseEventList",{enumerable:!0,get:function(){return q.PromiseEventList}}),Object.defineProperty(t,"NonUniformPromiseEventList",{enumerable:!0,get:function(){return J.NonUniformPromiseEventList}})}),Q=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSignalDispatcher=void 0,t.PromiseSignalDispatcher=class extends L.PromiseDispatcherBase{constructor(){super()}async dispatch(){const e=await this._dispatchAsPromise(!1,this,arguments);if(null==e)throw new L.DispatchError("Got `null` back from dispatch.");return e}dispatchAsync(){this._dispatchAsPromise(!0,this,arguments)}asEvent(){return super.asEvent()}}}),R=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSignalList=void 0,t.PromiseSignalList=class extends L.EventListBase{constructor(){super()}createDispatcher(){return new Q.PromiseSignalDispatcher}}}),X=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSignalHandlingBase=void 0,t.PromiseSignalHandlingBase=class extends L.HandlingBase{constructor(){super(new R.PromiseSignalList)}}}),Y=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSignalList=t.PromiseSignalHandlingBase=t.PromiseSignalDispatcher=void 0,Object.defineProperty(t,"PromiseSignalDispatcher",{enumerable:!0,get:function(){return Q.PromiseSignalDispatcher}}),Object.defineProperty(t,"PromiseSignalHandlingBase",{enumerable:!0,get:function(){return X.PromiseSignalHandlingBase}}),Object.defineProperty(t,"PromiseSignalList",{enumerable:!0,get:function(){return R.PromiseSignalList}})}),Z=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSimpleEventDispatcher=void 0,t.PromiseSimpleEventDispatcher=class extends L.PromiseDispatcherBase{constructor(){super()}async dispatch(e){const t=await this._dispatchAsPromise(!1,this,arguments);if(null==t)throw new L.DispatchError("Got `null` back from dispatch.");return t}dispatchAsync(e){this._dispatchAsPromise(!0,this,arguments)}asEvent(){return super.asEvent()}}}),$=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformPromiseSimpleEventList=void 0,t.NonUniformPromiseSimpleEventList=class{constructor(){this._events={}}get(e){if(this._events[e])return this._events[e];const t=this.createDispatcher();return this._events[e]=t,t}remove(e){delete this._events[e]}createDispatcher(){return new Z.PromiseSimpleEventDispatcher}}}),ee=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSimpleEventList=void 0,t.PromiseSimpleEventList=class extends L.EventListBase{constructor(){super()}createDispatcher(){return new Z.PromiseSimpleEventDispatcher}}}),te=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSimpleEventHandlingBase=void 0,t.PromiseSimpleEventHandlingBase=class extends L.HandlingBase{constructor(){super(new ee.PromiseSimpleEventList)}}}),ne=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformPromiseSimpleEventList=t.PromiseSimpleEventList=t.PromiseSimpleEventHandlingBase=t.PromiseSimpleEventDispatcher=void 0,Object.defineProperty(t,"NonUniformPromiseSimpleEventList",{enumerable:!0,get:function(){return $.NonUniformPromiseSimpleEventList}}),Object.defineProperty(t,"PromiseSimpleEventDispatcher",{enumerable:!0,get:function(){return Z.PromiseSimpleEventDispatcher}}),Object.defineProperty(t,"PromiseSimpleEventHandlingBase",{enumerable:!0,get:function(){return te.PromiseSimpleEventHandlingBase}}),Object.defineProperty(t,"PromiseSimpleEventList",{enumerable:!0,get:function(){return ee.PromiseSimpleEventList}})});g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformPromiseSimpleEventList=t.PromiseSimpleEventList=t.PromiseSimpleEventHandlingBase=t.PromiseSimpleEventDispatcher=t.PromiseSignalList=t.PromiseSignalHandlingBase=t.PromiseSignalDispatcher=t.NonUniformPromiseEventList=t.PromiseEventList=t.PromiseEventHandlingBase=t.PromiseEventDispatcher=t.SignalList=t.SignalHandlingBase=t.SignalDispatcher=t.NonUniformSimpleEventList=t.SimpleEventList=t.SimpleEventHandlingBase=t.SimpleEventDispatcher=t.NonUniformEventList=t.EventList=t.EventHandlingBase=t.EventDispatcher=t.HandlingBase=t.PromiseDispatcherBase=t.PromiseSubscription=t.DispatchError=t.EventManagement=t.EventListBase=t.DispatcherWrapper=t.DispatcherBase=t.Subscription=void 0,Object.defineProperty(t,"Subscription",{enumerable:!0,get:function(){return L.Subscription}}),Object.defineProperty(t,"DispatcherBase",{enumerable:!0,get:function(){return L.DispatcherBase}}),Object.defineProperty(t,"DispatcherWrapper",{enumerable:!0,get:function(){return L.DispatcherWrapper}}),Object.defineProperty(t,"EventListBase",{enumerable:!0,get:function(){return L.EventListBase}}),Object.defineProperty(t,"EventManagement",{enumerable:!0,get:function(){return L.EventManagement}}),Object.defineProperty(t,"DispatchError",{enumerable:!0,get:function(){return L.DispatchError}}),Object.defineProperty(t,"PromiseSubscription",{enumerable:!0,get:function(){return L.PromiseSubscription}}),Object.defineProperty(t,"PromiseDispatcherBase",{enumerable:!0,get:function(){return L.PromiseDispatcherBase}}),Object.defineProperty(t,"HandlingBase",{enumerable:!0,get:function(){return L.HandlingBase}}),Object.defineProperty(t,"EventDispatcher",{enumerable:!0,get:function(){return U.EventDispatcher}}),Object.defineProperty(t,"EventHandlingBase",{enumerable:!0,get:function(){return U.EventHandlingBase}}),Object.defineProperty(t,"EventList",{enumerable:!0,get:function(){return U.EventList}}),Object.defineProperty(t,"NonUniformEventList",{enumerable:!0,get:function(){return U.NonUniformEventList}}),Object.defineProperty(t,"SimpleEventDispatcher",{enumerable:!0,get:function(){return W.SimpleEventDispatcher}}),Object.defineProperty(t,"SimpleEventHandlingBase",{enumerable:!0,get:function(){return W.SimpleEventHandlingBase}}),Object.defineProperty(t,"SimpleEventList",{enumerable:!0,get:function(){return W.SimpleEventList}}),Object.defineProperty(t,"NonUniformSimpleEventList",{enumerable:!0,get:function(){return W.NonUniformSimpleEventList}}),Object.defineProperty(t,"SignalDispatcher",{enumerable:!0,get:function(){return G.SignalDispatcher}}),Object.defineProperty(t,"SignalHandlingBase",{enumerable:!0,get:function(){return G.SignalHandlingBase}}),Object.defineProperty(t,"SignalList",{enumerable:!0,get:function(){return G.SignalList}}),Object.defineProperty(t,"PromiseEventDispatcher",{enumerable:!0,get:function(){return K.PromiseEventDispatcher}}),Object.defineProperty(t,"PromiseEventHandlingBase",{enumerable:!0,get:function(){return K.PromiseEventHandlingBase}}),Object.defineProperty(t,"PromiseEventList",{enumerable:!0,get:function(){return K.PromiseEventList}}),Object.defineProperty(t,"NonUniformPromiseEventList",{enumerable:!0,get:function(){return K.NonUniformPromiseEventList}}),Object.defineProperty(t,"PromiseSignalDispatcher",{enumerable:!0,get:function(){return Y.PromiseSignalDispatcher}}),Object.defineProperty(t,"PromiseSignalHandlingBase",{enumerable:!0,get:function(){return Y.PromiseSignalHandlingBase}}),Object.defineProperty(t,"PromiseSignalList",{enumerable:!0,get:function(){return Y.PromiseSignalList}}),Object.defineProperty(t,"PromiseSimpleEventDispatcher",{enumerable:!0,get:function(){return ne.PromiseSimpleEventDispatcher}}),Object.defineProperty(t,"PromiseSimpleEventHandlingBase",{enumerable:!0,get:function(){return ne.PromiseSimpleEventHandlingBase}}),Object.defineProperty(t,"PromiseSimpleEventList",{enumerable:!0,get:function(){return ne.PromiseSimpleEventList}}),Object.defineProperty(t,"NonUniformPromiseSimpleEventList",{enumerable:!0,get:function(){return ne.NonUniformPromiseSimpleEventList}})});var ie=/*#__PURE__*/t("positionsDecompressed"),re=/*#__PURE__*/t("positionsWorld"),se=/*#__PURE__*/function(){function e(){this.object=void 0,this.mesh=void 0,this.meshIndex=void 0,this.geometry=void 0,this.geometryBucket=void 0,this.geometryBucketIndex=void 0,Object.defineProperty(this,ie,{writable:!0,value:void 0}),Object.defineProperty(this,re,{writable:!0,value:void 0}),this.object=null,this.mesh=null,this.meshIndex=0,this.geometry=null,this.geometryBucket=null,this.geometryBucketIndex=0,n(this,ie)[ie]=null,n(this,re)[re]=null}var t,i;return e.prototype.reset=function(){n(this,ie)[ie]=null,n(this,re)[re]=null},t=e,i=[{key:"totalGeometryBuckets",get:function(){var e=0;if(this.object)for(var t=0,n=this.object.meshes.length;t<n;t++)e+=this.object.meshes[t].geometry.geometryBuckets.length;return e}},{key:"numPrimitives",get:function(){var e=this.geometry.primitive;return this.geometryBucket.indices.length/(20002===e?3:20001===e?2:1)}},{key:"positionsDecompressed",get:function(){return n(this,ie)[ie]||(n(this,ie)[ie]=new Float32Array(this.geometryBucket.positionsCompressed.length),function(e,t,n){void 0===n&&(n=new Float32Array(e.length));for(var i=0,r=e.length;i<r;i+=3)n[i+0]=e[i+0]*t[0]+t[12],n[i+1]=e[i+1]*t[5]+t[13],n[i+2]=e[i+2]*t[10]+t[14]}(this.geometryBucket.positionsCompressed,this.geometry.positionsDecompressMatrix,n(this,ie)[ie])),n(this,ie)[ie]}},{key:"positionsWorld",get:function(){if(!n(this,re)[re]){var e=this.positionsDecompressed;n(this,re)[re]=new Float64Array(e.length),function(e,t,n){var i;n||(n=t);var r,s,o,a=t.length,c=e[0],u=e[1],p=e[2],l=e[3],h=e[4],m=e[5],d=e[6],v=e[7],f=e[8],b=e[9],g=e[10],P=e[11],E=e[12],y=e[13],S=e[14],_=e[15];for(i=0;i<a;i+=3)n[i+0]=c*(r=t[i+0])+h*(s=t[i+1])+f*(o=t[i+2])+E,n[i+1]=u*r+m*s+b*o+y,n[i+2]=p*r+d*s+g*o+S,n[i+3]=l*r+v*s+P*o+_}(e,this.mesh.matrix,n(this,re)[re])}return n(this,re)[re]}},{key:"uvsDecompressed",get:function(){return null}}],i&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,"symbol"==typeof(r=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key))?r:String(r),i)}var r}(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),e}(),oe=new se;function ae(e){var t=new f({aabb:e.canvasBoundary}),n=o(e.viewMatrix),i=o(e.projMatrix),r=function(e,t,n){var i=function(e,t,n){n||(n=e);var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],c=e[5],u=e[6],p=e[7],l=e[8],h=e[9],m=e[10],d=e[11],v=e[12],f=e[13],b=e[14],g=e[15],P=t[0],E=t[1],y=t[2],S=t[3],_=t[4],D=t[5],j=t[6],O=t[7],B=t[8],L=t[9],w=t[10],x=t[11],H=t[12],M=t[13],U=t[14],N=t[15];return n[0]=P*i+E*a+y*l+S*v,n[1]=P*r+E*c+y*h+S*f,n[2]=P*s+E*u+y*m+S*b,n[3]=P*o+E*p+y*d+S*g,n[4]=_*i+D*a+j*l+O*v,n[5]=_*r+D*c+j*h+O*f,n[6]=_*s+D*u+j*m+O*b,n[7]=_*o+D*p+j*d+O*g,n[8]=B*i+L*a+w*l+x*v,n[9]=B*r+L*c+w*h+x*f,n[10]=B*s+L*u+w*m+x*b,n[11]=B*o+L*p+w*d+x*g,n[12]=H*i+M*a+U*l+N*v,n[13]=H*r+M*c+U*h+N*f,n[14]=H*s+M*u+U*m+N*b,n[15]=H*o+M*p+U*d+N*g,n}(t,e,p),r=i[0],s=i[1],o=i[2],a=i[3],c=i[4],u=i[5],l=i[6],h=i[7],d=i[8],v=i[9],f=i[10],b=i[11],g=i[12],P=i[13],E=i[14],y=i[15];return(n=n||new m).planes[0].set(a-r,h-c,b-d,y-g),n.planes[1].set(a+r,h+c,b+d,y+g),n.planes[2].set(a-s,h-u,b-v,y-P),n.planes[3].set(a+s,h+u,b+v,y+P),n.planes[4].set(a-o,h-l,b-f,y-E),n.planes[5].set(a+o,h+l,b+f,y+E),n}(n,i),l=e.canvasBoundary,h=e.sceneObjects;if(h)for(var d=0,v=h.length;d<v;d++)b(h[d]);function b(e,t){void 0===t&&(t=2),1!==t&&(t=function(e,t){var n=1,i=c,r=u;i[0]=t[0],i[1]=t[1],i[2]=t[2],r[0]=t[3],r[1]=t[4],r[2]=t[5];for(var s=[i,r],o=0;o<6;++o){var a=e.planes[o];if(a.normal[0]*s[a.testVertex[0]][0]+a.normal[1]*s[a.testVertex[1]][1]+a.normal[2]*s[a.testVertex[2]][2]+a.offset<0)return 3;a.normal[0]*s[1-a.testVertex[0]][0]+a.normal[1]*s[1-a.testVertex[1]][1]+a.normal[2]*s[1-a.testVertex[2]][2]+a.offset<0&&(n=2)}return n}(r,e.aabb)),3!==t&&function(e,t){oe.reset(),oe.object=e;for(var n=0,i=e.meshes.length;n<i;n++){var r=e.meshes[n];oe.mesh=r,oe.meshIndex=n;var s=r.geometry;oe.geometry=s;for(var o=0,a=s.geometryBuckets.length;o<a;o++)if(oe.geometryBucket=s.geometryBuckets[o],oe.geometryBucketIndex=o,t(oe))return!0}}(e,function(t){for(var n=t.positionsWorld,i=0,r=n.length;i<r;i+=3){var o=s();o[0]=n[i],o[1]=n[i+1],o[2]=n[i+2],o[3]=1,g(e,o)}return!1})}function g(e,r){var o=s(),c=s(),u=new Uint16Array(2);a(n,r,o),a(i,o,c),u[0]=Math.floor((1+c[0]/c[3])*l[2]/2),u[1]=Math.floor((1-c[1]/c[3])*l[3]/2),t.insertItem({sceneObject:e,worldPos:r,canvasPos:u},[u[0],u[1],u[0],u[1]])}return t}function ce(e){return[]}var ue=function(){this.sceneObject=void 0,this.worldPos=void 0,this.canvasPos=void 0};export{f as KdTree2,ue as KdVertex2,ae as createKdTree2FromSceneObjectVerts,ce as searchKdTree2ForNearestNeighbor};
//# sourceMappingURL=index.es.map
