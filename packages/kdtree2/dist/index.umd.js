!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@xeokit/core")):"function"==typeof define&&define.amd?define(["exports","@xeokit/core"],t):t((e||self).kdtree2={})}(this,function(e){var t=0;function n(e){return"__private_"+t+++"_"+e}function i(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var r=Float64Array;function s(e){return new Float64Array(e||3)}function o(e){return new FloatArrayClass(e||4)}function a(e){return new r(e||16)}function c(e,t,n){return n[0]=e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12]*t[3],n[1]=e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13]*t[3],n[2]=e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14]*t[3],n[3]=e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]*t[3],n}o(),o(),new FloatArrayClass(2);var u=s(),p=s(),l=a();function h(e,t){return e[0]<=t[0]&&t[3]<=e[3]&&e[1]<=t[1]&&e[2]<=t[2]}var d=/*#__PURE__*/function(){function e(){this.testVertex=void 0,this.offset=void 0,this.normal=void 0,this.normal=s(),this.offset=0,this.testVertex=s()}return e.prototype.set=function(e,t,n,i){var r=1/Math.sqrt(e*e+t*t+n*n);this.normal[0]=e*r,this.normal[1]=t*r,this.normal[2]=n*r,this.offset=i*r,this.testVertex[0]=this.normal[0]>=0?1:0,this.testVertex[1]=this.normal[1]>=0?1:0,this.testVertex[2]=this.normal[2]>=0?1:0},e}(),m=function(){this.planes=void 0,this.planes=[new d,new d,new d,new d,new d,new d]},v=new Float32Array(2),f=/*#__PURE__*/n("insertItem"),b=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,f,{value:g}),this.root=void 0,this.maxDepth=void 0,this.maxDepth=(null==e?void 0:e.maxDepth)||10,this.root={aabb:e.aabb.slice()}}return e.prototype.insertItem=function(e,t){i(this,f)[f](this.root,{item:e},t,1)},e}();function g(e,t,n,r){if(r>=this.maxDepth)return e.items=e.items||[],void e.items.push(t);if(e.left&&h(e.left.aabb,n))i(this,f)[f](e.left,t,n,r+1);else if(e.right&&h(e.right.aabb,n))i(this,f)[f](e.right,t,n,r+1);else{var s=e.aabb;v[0]=s[2]-s[0],v[1]=s[3]-s[1];var o=0;if(v[1]>v[o]&&(o=1),!e.left){var a=s.slice();if(a[o+2]=(s[o]+s[o+2])/2,e.left={aabb:a},h(a,n))return void i(this,f)[f](e.left,t,n,r+1)}if(!e.right){var c=s.slice();if(c[o]=(s[o]+s[o+2])/2,e.right={aabb:c},h(c,n))return void i(this,f)[f](e.right,t,n,r+1)}e.items=e.items||[],e.items.push(t)}}function P(e){var t={exports:{}};return e(t,t.exports),t.exports}var E=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DispatcherWrapper=void 0,t.DispatcherWrapper=class{constructor(e){this._subscribe=t=>e.subscribe(t),this._unsubscribe=t=>e.unsubscribe(t),this._one=t=>e.one(t),this._has=t=>e.has(t),this._clear=()=>e.clear(),this._count=()=>e.count,this._onSubscriptionChange=()=>e.onSubscriptionChange}get onSubscriptionChange(){return this._onSubscriptionChange()}get count(){return this._count()}subscribe(e){return this._subscribe(e)}sub(e){return this.subscribe(e)}unsubscribe(e){this._unsubscribe(e)}unsub(e){this.unsubscribe(e)}one(e){return this._one(e)}has(e){return this._has(e)}clear(){this._clear()}}}),y=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Subscription=void 0,t.Subscription=class{constructor(e,t){this.handler=e,this.isOnce=t,this.isExecuted=!1}execute(e,t,n){if(!this.isOnce||!this.isExecuted){this.isExecuted=!0;var i=this.handler;e?setTimeout(()=>{i.apply(t,n)},1):i.apply(t,n)}}}}),S=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventManagement=void 0,t.EventManagement=class{constructor(e){this.unsub=e,this.propagationStopped=!1}stopPropagation(){this.propagationStopped=!0}}}),_=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SubscriptionChangeEventDispatcher=t.DispatcherBase=void 0;class n{constructor(){this._subscriptions=new Array}get count(){return this._subscriptions.length}get onSubscriptionChange(){return null==this._onSubscriptionChange&&(this._onSubscriptionChange=new i),this._onSubscriptionChange.asEvent()}subscribe(e){return e&&(this._subscriptions.push(this.createSubscription(e,!1)),this.triggerSubscriptionChange()),()=>{this.unsubscribe(e)}}sub(e){return this.subscribe(e)}one(e){return e&&(this._subscriptions.push(this.createSubscription(e,!0)),this.triggerSubscriptionChange()),()=>{this.unsubscribe(e)}}has(e){return!!e&&this._subscriptions.some(t=>t.handler==e)}unsubscribe(e){if(!e)return;let t=!1;for(let n=0;n<this._subscriptions.length;n++)if(this._subscriptions[n].handler==e){this._subscriptions.splice(n,1),t=!0;break}t&&this.triggerSubscriptionChange()}unsub(e){this.unsubscribe(e)}_dispatch(e,t,n){for(let i of[...this._subscriptions]){let r=new S.EventManagement(()=>this.unsub(i.handler)),s=Array.prototype.slice.call(n);if(s.push(r),i.execute(e,t,s),this.cleanup(i),!e&&r.propagationStopped)return{propagationStopped:!0}}return e?null:{propagationStopped:!1}}createSubscription(e,t){return new y.Subscription(e,t)}cleanup(e){let t=!1;if(e.isOnce&&e.isExecuted){let n=this._subscriptions.indexOf(e);n>-1&&(this._subscriptions.splice(n,1),t=!0)}t&&this.triggerSubscriptionChange()}asEvent(){return null==this._wrap&&(this._wrap=new E.DispatcherWrapper(this)),this._wrap}clear(){0!=this._subscriptions.length&&(this._subscriptions.splice(0,this._subscriptions.length),this.triggerSubscriptionChange())}triggerSubscriptionChange(){null!=this._onSubscriptionChange&&this._onSubscriptionChange.dispatch(this.count)}}t.DispatcherBase=n;class i extends n{dispatch(e){this._dispatch(!1,this,arguments)}}t.SubscriptionChangeEventDispatcher=i}),D=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DispatchError=void 0;class n extends Error{constructor(e){super(e)}}t.DispatchError=n}),j=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventListBase=void 0,t.EventListBase=class{constructor(){this._events={}}get(e){let t=this._events[e];return t||(t=this.createDispatcher(),this._events[e]=t,t)}remove(e){delete this._events[e]}}}),O=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.HandlingBase=void 0,t.HandlingBase=class{constructor(e){this.events=e}one(e,t){this.events.get(e).one(t)}has(e,t){return this.events.get(e).has(t)}subscribe(e,t){this.events.get(e).subscribe(t)}sub(e,t){this.subscribe(e,t)}unsubscribe(e,t){this.events.get(e).unsubscribe(t)}unsub(e,t){this.unsubscribe(e,t)}}}),B=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSubscription=void 0,t.PromiseSubscription=class{constructor(e,t){this.handler=e,this.isOnce=t,this.isExecuted=!1}async execute(e,t,n){if(!this.isOnce||!this.isExecuted){this.isExecuted=!0;var i=this.handler;if(e)return void setTimeout(()=>{i.apply(t,n)},1);let r=i.apply(t,n);await r}}}}),L=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseDispatcherBase=void 0,t.PromiseDispatcherBase=class extends _.DispatcherBase{_dispatch(e,t,n){throw new D.DispatchError("_dispatch not supported. Use _dispatchAsPromise.")}createSubscription(e,t){return new B.PromiseSubscription(e,t)}async _dispatchAsPromise(e,t,n){for(let i of[...this._subscriptions]){let r=new S.EventManagement(()=>this.unsub(i.handler)),s=Array.prototype.slice.call(n);s.push(r);let o=i;if(await o.execute(e,t,s),this.cleanup(i),!e&&r.propagationStopped)return{propagationStopped:!0}}return e?null:{propagationStopped:!1}}}}),w=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SubscriptionChangeEventDispatcher=t.HandlingBase=t.PromiseDispatcherBase=t.PromiseSubscription=t.DispatchError=t.EventManagement=t.EventListBase=t.DispatcherWrapper=t.DispatcherBase=t.Subscription=void 0,Object.defineProperty(t,"DispatcherBase",{enumerable:!0,get:function(){return _.DispatcherBase}}),Object.defineProperty(t,"SubscriptionChangeEventDispatcher",{enumerable:!0,get:function(){return _.SubscriptionChangeEventDispatcher}}),Object.defineProperty(t,"DispatchError",{enumerable:!0,get:function(){return D.DispatchError}}),Object.defineProperty(t,"DispatcherWrapper",{enumerable:!0,get:function(){return E.DispatcherWrapper}}),Object.defineProperty(t,"EventListBase",{enumerable:!0,get:function(){return j.EventListBase}}),Object.defineProperty(t,"EventManagement",{enumerable:!0,get:function(){return S.EventManagement}}),Object.defineProperty(t,"HandlingBase",{enumerable:!0,get:function(){return O.HandlingBase}}),Object.defineProperty(t,"PromiseDispatcherBase",{enumerable:!0,get:function(){return L.PromiseDispatcherBase}}),Object.defineProperty(t,"PromiseSubscription",{enumerable:!0,get:function(){return B.PromiseSubscription}}),Object.defineProperty(t,"Subscription",{enumerable:!0,get:function(){return y.Subscription}})}),x=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventDispatcher=void 0,t.EventDispatcher=class extends w.DispatcherBase{constructor(){super()}dispatch(e,t){const n=this._dispatch(!1,this,arguments);if(null==n)throw new w.DispatchError("Got `null` back from dispatch.");return n}dispatchAsync(e,t){this._dispatch(!0,this,arguments)}asEvent(){return super.asEvent()}}}),H=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventList=void 0,t.EventList=class extends w.EventListBase{constructor(){super()}createDispatcher(){return new x.EventDispatcher}}}),M=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventHandlingBase=void 0,t.EventHandlingBase=class extends w.HandlingBase{constructor(){super(new H.EventList)}}}),N=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformEventList=void 0,t.NonUniformEventList=class{constructor(){this._events={}}get(e){if(this._events[e])return this._events[e];const t=this.createDispatcher();return this._events[e]=t,t}remove(e){delete this._events[e]}createDispatcher(){return new x.EventDispatcher}}}),U=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformEventList=t.EventList=t.EventHandlingBase=t.EventDispatcher=void 0,Object.defineProperty(t,"EventDispatcher",{enumerable:!0,get:function(){return x.EventDispatcher}}),Object.defineProperty(t,"EventHandlingBase",{enumerable:!0,get:function(){return M.EventHandlingBase}}),Object.defineProperty(t,"EventList",{enumerable:!0,get:function(){return H.EventList}}),Object.defineProperty(t,"NonUniformEventList",{enumerable:!0,get:function(){return N.NonUniformEventList}})}),k=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleEventDispatcher=void 0,t.SimpleEventDispatcher=class extends w.DispatcherBase{constructor(){super()}dispatch(e){const t=this._dispatch(!1,this,arguments);if(null==t)throw new w.DispatchError("Got `null` back from dispatch.");return t}dispatchAsync(e){this._dispatch(!0,this,arguments)}asEvent(){return super.asEvent()}}}),A=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleEventList=void 0,t.SimpleEventList=class extends w.EventListBase{constructor(){super()}createDispatcher(){return new k.SimpleEventDispatcher}}}),C=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleEventHandlingBase=void 0,t.SimpleEventHandlingBase=class extends w.HandlingBase{constructor(){super(new A.SimpleEventList)}}}),V=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformSimpleEventList=void 0,t.NonUniformSimpleEventList=class{constructor(){this._events={}}get(e){if(this._events[e])return this._events[e];const t=this.createDispatcher();return this._events[e]=t,t}remove(e){delete this._events[e]}createDispatcher(){return new k.SimpleEventDispatcher}}}),W=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformSimpleEventList=t.SimpleEventList=t.SimpleEventHandlingBase=t.SimpleEventDispatcher=void 0,Object.defineProperty(t,"SimpleEventDispatcher",{enumerable:!0,get:function(){return k.SimpleEventDispatcher}}),Object.defineProperty(t,"SimpleEventHandlingBase",{enumerable:!0,get:function(){return C.SimpleEventHandlingBase}}),Object.defineProperty(t,"NonUniformSimpleEventList",{enumerable:!0,get:function(){return V.NonUniformSimpleEventList}}),Object.defineProperty(t,"SimpleEventList",{enumerable:!0,get:function(){return A.SimpleEventList}})}),F=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SignalDispatcher=void 0,t.SignalDispatcher=class extends w.DispatcherBase{dispatch(){const e=this._dispatch(!1,this,arguments);if(null==e)throw new w.DispatchError("Got `null` back from dispatch.");return e}dispatchAsync(){this._dispatch(!0,this,arguments)}asEvent(){return super.asEvent()}}}),I=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SignalList=void 0,t.SignalList=class extends w.EventListBase{constructor(){super()}createDispatcher(){return new F.SignalDispatcher}}}),T=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SignalHandlingBase=void 0,t.SignalHandlingBase=class extends w.HandlingBase{constructor(){super(new I.SignalList)}}}),G=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SignalList=t.SignalHandlingBase=t.SignalDispatcher=void 0,Object.defineProperty(t,"SignalDispatcher",{enumerable:!0,get:function(){return F.SignalDispatcher}}),Object.defineProperty(t,"SignalHandlingBase",{enumerable:!0,get:function(){return T.SignalHandlingBase}}),Object.defineProperty(t,"SignalList",{enumerable:!0,get:function(){return I.SignalList}})}),K=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseEventDispatcher=void 0,t.PromiseEventDispatcher=class extends w.PromiseDispatcherBase{constructor(){super()}async dispatch(e,t){const n=await this._dispatchAsPromise(!1,this,arguments);if(null==n)throw new w.DispatchError("Got `null` back from dispatch.");return n}dispatchAsync(e,t){this._dispatchAsPromise(!0,this,arguments)}asEvent(){return super.asEvent()}}}),q=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseEventList=void 0,t.PromiseEventList=class extends w.EventListBase{constructor(){super()}createDispatcher(){return new K.PromiseEventDispatcher}}}),z=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseEventHandlingBase=void 0,t.PromiseEventHandlingBase=class extends w.HandlingBase{constructor(){super(new q.PromiseEventList)}}}),J=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformPromiseEventList=void 0,t.NonUniformPromiseEventList=class{constructor(){this._events={}}get(e){if(this._events[e])return this._events[e];const t=this.createDispatcher();return this._events[e]=t,t}remove(e){delete this._events[e]}createDispatcher(){return new K.PromiseEventDispatcher}}}),Q=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformPromiseEventList=t.PromiseEventList=t.PromiseEventHandlingBase=t.PromiseEventDispatcher=void 0,Object.defineProperty(t,"PromiseEventDispatcher",{enumerable:!0,get:function(){return K.PromiseEventDispatcher}}),Object.defineProperty(t,"PromiseEventHandlingBase",{enumerable:!0,get:function(){return z.PromiseEventHandlingBase}}),Object.defineProperty(t,"PromiseEventList",{enumerable:!0,get:function(){return q.PromiseEventList}}),Object.defineProperty(t,"NonUniformPromiseEventList",{enumerable:!0,get:function(){return J.NonUniformPromiseEventList}})}),R=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSignalDispatcher=void 0,t.PromiseSignalDispatcher=class extends w.PromiseDispatcherBase{constructor(){super()}async dispatch(){const e=await this._dispatchAsPromise(!1,this,arguments);if(null==e)throw new w.DispatchError("Got `null` back from dispatch.");return e}dispatchAsync(){this._dispatchAsPromise(!0,this,arguments)}asEvent(){return super.asEvent()}}}),X=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSignalList=void 0,t.PromiseSignalList=class extends w.EventListBase{constructor(){super()}createDispatcher(){return new R.PromiseSignalDispatcher}}}),Y=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSignalHandlingBase=void 0,t.PromiseSignalHandlingBase=class extends w.HandlingBase{constructor(){super(new X.PromiseSignalList)}}}),Z=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSignalList=t.PromiseSignalHandlingBase=t.PromiseSignalDispatcher=void 0,Object.defineProperty(t,"PromiseSignalDispatcher",{enumerable:!0,get:function(){return R.PromiseSignalDispatcher}}),Object.defineProperty(t,"PromiseSignalHandlingBase",{enumerable:!0,get:function(){return Y.PromiseSignalHandlingBase}}),Object.defineProperty(t,"PromiseSignalList",{enumerable:!0,get:function(){return X.PromiseSignalList}})}),$=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSimpleEventDispatcher=void 0,t.PromiseSimpleEventDispatcher=class extends w.PromiseDispatcherBase{constructor(){super()}async dispatch(e){const t=await this._dispatchAsPromise(!1,this,arguments);if(null==t)throw new w.DispatchError("Got `null` back from dispatch.");return t}dispatchAsync(e){this._dispatchAsPromise(!0,this,arguments)}asEvent(){return super.asEvent()}}}),ee=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformPromiseSimpleEventList=void 0,t.NonUniformPromiseSimpleEventList=class{constructor(){this._events={}}get(e){if(this._events[e])return this._events[e];const t=this.createDispatcher();return this._events[e]=t,t}remove(e){delete this._events[e]}createDispatcher(){return new $.PromiseSimpleEventDispatcher}}}),te=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSimpleEventList=void 0,t.PromiseSimpleEventList=class extends w.EventListBase{constructor(){super()}createDispatcher(){return new $.PromiseSimpleEventDispatcher}}}),ne=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSimpleEventHandlingBase=void 0,t.PromiseSimpleEventHandlingBase=class extends w.HandlingBase{constructor(){super(new te.PromiseSimpleEventList)}}}),ie=P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformPromiseSimpleEventList=t.PromiseSimpleEventList=t.PromiseSimpleEventHandlingBase=t.PromiseSimpleEventDispatcher=void 0,Object.defineProperty(t,"NonUniformPromiseSimpleEventList",{enumerable:!0,get:function(){return ee.NonUniformPromiseSimpleEventList}}),Object.defineProperty(t,"PromiseSimpleEventDispatcher",{enumerable:!0,get:function(){return $.PromiseSimpleEventDispatcher}}),Object.defineProperty(t,"PromiseSimpleEventHandlingBase",{enumerable:!0,get:function(){return ne.PromiseSimpleEventHandlingBase}}),Object.defineProperty(t,"PromiseSimpleEventList",{enumerable:!0,get:function(){return te.PromiseSimpleEventList}})});P(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformPromiseSimpleEventList=t.PromiseSimpleEventList=t.PromiseSimpleEventHandlingBase=t.PromiseSimpleEventDispatcher=t.PromiseSignalList=t.PromiseSignalHandlingBase=t.PromiseSignalDispatcher=t.NonUniformPromiseEventList=t.PromiseEventList=t.PromiseEventHandlingBase=t.PromiseEventDispatcher=t.SignalList=t.SignalHandlingBase=t.SignalDispatcher=t.NonUniformSimpleEventList=t.SimpleEventList=t.SimpleEventHandlingBase=t.SimpleEventDispatcher=t.NonUniformEventList=t.EventList=t.EventHandlingBase=t.EventDispatcher=t.HandlingBase=t.PromiseDispatcherBase=t.PromiseSubscription=t.DispatchError=t.EventManagement=t.EventListBase=t.DispatcherWrapper=t.DispatcherBase=t.Subscription=void 0,Object.defineProperty(t,"Subscription",{enumerable:!0,get:function(){return w.Subscription}}),Object.defineProperty(t,"DispatcherBase",{enumerable:!0,get:function(){return w.DispatcherBase}}),Object.defineProperty(t,"DispatcherWrapper",{enumerable:!0,get:function(){return w.DispatcherWrapper}}),Object.defineProperty(t,"EventListBase",{enumerable:!0,get:function(){return w.EventListBase}}),Object.defineProperty(t,"EventManagement",{enumerable:!0,get:function(){return w.EventManagement}}),Object.defineProperty(t,"DispatchError",{enumerable:!0,get:function(){return w.DispatchError}}),Object.defineProperty(t,"PromiseSubscription",{enumerable:!0,get:function(){return w.PromiseSubscription}}),Object.defineProperty(t,"PromiseDispatcherBase",{enumerable:!0,get:function(){return w.PromiseDispatcherBase}}),Object.defineProperty(t,"HandlingBase",{enumerable:!0,get:function(){return w.HandlingBase}}),Object.defineProperty(t,"EventDispatcher",{enumerable:!0,get:function(){return U.EventDispatcher}}),Object.defineProperty(t,"EventHandlingBase",{enumerable:!0,get:function(){return U.EventHandlingBase}}),Object.defineProperty(t,"EventList",{enumerable:!0,get:function(){return U.EventList}}),Object.defineProperty(t,"NonUniformEventList",{enumerable:!0,get:function(){return U.NonUniformEventList}}),Object.defineProperty(t,"SimpleEventDispatcher",{enumerable:!0,get:function(){return W.SimpleEventDispatcher}}),Object.defineProperty(t,"SimpleEventHandlingBase",{enumerable:!0,get:function(){return W.SimpleEventHandlingBase}}),Object.defineProperty(t,"SimpleEventList",{enumerable:!0,get:function(){return W.SimpleEventList}}),Object.defineProperty(t,"NonUniformSimpleEventList",{enumerable:!0,get:function(){return W.NonUniformSimpleEventList}}),Object.defineProperty(t,"SignalDispatcher",{enumerable:!0,get:function(){return G.SignalDispatcher}}),Object.defineProperty(t,"SignalHandlingBase",{enumerable:!0,get:function(){return G.SignalHandlingBase}}),Object.defineProperty(t,"SignalList",{enumerable:!0,get:function(){return G.SignalList}}),Object.defineProperty(t,"PromiseEventDispatcher",{enumerable:!0,get:function(){return Q.PromiseEventDispatcher}}),Object.defineProperty(t,"PromiseEventHandlingBase",{enumerable:!0,get:function(){return Q.PromiseEventHandlingBase}}),Object.defineProperty(t,"PromiseEventList",{enumerable:!0,get:function(){return Q.PromiseEventList}}),Object.defineProperty(t,"NonUniformPromiseEventList",{enumerable:!0,get:function(){return Q.NonUniformPromiseEventList}}),Object.defineProperty(t,"PromiseSignalDispatcher",{enumerable:!0,get:function(){return Z.PromiseSignalDispatcher}}),Object.defineProperty(t,"PromiseSignalHandlingBase",{enumerable:!0,get:function(){return Z.PromiseSignalHandlingBase}}),Object.defineProperty(t,"PromiseSignalList",{enumerable:!0,get:function(){return Z.PromiseSignalList}}),Object.defineProperty(t,"PromiseSimpleEventDispatcher",{enumerable:!0,get:function(){return ie.PromiseSimpleEventDispatcher}}),Object.defineProperty(t,"PromiseSimpleEventHandlingBase",{enumerable:!0,get:function(){return ie.PromiseSimpleEventHandlingBase}}),Object.defineProperty(t,"PromiseSimpleEventList",{enumerable:!0,get:function(){return ie.PromiseSimpleEventList}}),Object.defineProperty(t,"NonUniformPromiseSimpleEventList",{enumerable:!0,get:function(){return ie.NonUniformPromiseSimpleEventList}})});var re=/*#__PURE__*/n("positionsDecompressed"),se=/*#__PURE__*/n("positionsWorld"),oe=/*#__PURE__*/function(){function e(){this.object=void 0,this.mesh=void 0,this.meshIndex=void 0,this.geometry=void 0,this.geometryBucket=void 0,this.geometryBucketIndex=void 0,Object.defineProperty(this,re,{writable:!0,value:void 0}),Object.defineProperty(this,se,{writable:!0,value:void 0}),this.object=null,this.mesh=null,this.meshIndex=0,this.geometry=null,this.geometryBucket=null,this.geometryBucketIndex=0,i(this,re)[re]=null,i(this,se)[se]=null}var t,n;return e.prototype.reset=function(){i(this,re)[re]=null,i(this,se)[se]=null},t=e,n=[{key:"totalGeometryBuckets",get:function(){var e=0;if(this.object)for(var t=0,n=this.object.meshes.length;t<n;t++)e+=this.object.meshes[t].geometry.geometryBuckets.length;return e}},{key:"numPrimitives",get:function(){var e=this.geometry.primitive;return this.geometryBucket.indices.length/(20002===e?3:20001===e?2:1)}},{key:"positionsDecompressed",get:function(){return i(this,re)[re]||(i(this,re)[re]=new Float32Array(this.geometryBucket.positionsCompressed.length),function(e,t,n){void 0===n&&(n=new Float32Array(e.length));for(var i=0,r=e.length;i<r;i+=3)n[i+0]=e[i+0]*t[0]+t[12],n[i+1]=e[i+1]*t[5]+t[13],n[i+2]=e[i+2]*t[10]+t[14]}(this.geometryBucket.positionsCompressed,this.geometry.positionsDecompressMatrix,i(this,re)[re])),i(this,re)[re]}},{key:"positionsWorld",get:function(){if(!i(this,se)[se]){var e=this.positionsDecompressed;i(this,se)[se]=new Float64Array(e.length),function(e,t,n){var i;n||(n=t);var r,s,o,a=t.length,c=e[0],u=e[1],p=e[2],l=e[3],h=e[4],d=e[5],m=e[6],v=e[7],f=e[8],b=e[9],g=e[10],P=e[11],E=e[12],y=e[13],S=e[14],_=e[15];for(i=0;i<a;i+=3)n[i+0]=c*(r=t[i+0])+h*(s=t[i+1])+f*(o=t[i+2])+E,n[i+1]=u*r+d*s+b*o+y,n[i+2]=p*r+m*s+g*o+S,n[i+3]=l*r+v*s+P*o+_}(e,this.mesh.matrix,i(this,se)[se])}return i(this,se)[se]}},{key:"uvsDecompressed",get:function(){return null}}],n&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,"symbol"==typeof(r=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key))?r:String(r),i)}var r}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),ae=new oe;e.KdTree2=b,e.KdVertex2=function(){this.sceneObject=void 0,this.worldPos=void 0,this.canvasPos=void 0},e.createKdTree2FromSceneObjectVerts=function(e){var t=new b({aabb:e.canvasBoundary}),n=a(e.viewMatrix),i=a(e.projMatrix),r=function(e,t,n){var i=function(e,t,n){n||(n=e);var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],c=e[5],u=e[6],p=e[7],l=e[8],h=e[9],d=e[10],m=e[11],v=e[12],f=e[13],b=e[14],g=e[15],P=t[0],E=t[1],y=t[2],S=t[3],_=t[4],D=t[5],j=t[6],O=t[7],B=t[8],L=t[9],w=t[10],x=t[11],H=t[12],M=t[13],N=t[14],U=t[15];return n[0]=P*i+E*a+y*l+S*v,n[1]=P*r+E*c+y*h+S*f,n[2]=P*s+E*u+y*d+S*b,n[3]=P*o+E*p+y*m+S*g,n[4]=_*i+D*a+j*l+O*v,n[5]=_*r+D*c+j*h+O*f,n[6]=_*s+D*u+j*d+O*b,n[7]=_*o+D*p+j*m+O*g,n[8]=B*i+L*a+w*l+x*v,n[9]=B*r+L*c+w*h+x*f,n[10]=B*s+L*u+w*d+x*b,n[11]=B*o+L*p+w*m+x*g,n[12]=H*i+M*a+N*l+U*v,n[13]=H*r+M*c+N*h+U*f,n[14]=H*s+M*u+N*d+U*b,n[15]=H*o+M*p+N*m+U*g,n}(t,e,l),r=i[0],s=i[1],o=i[2],a=i[3],c=i[4],u=i[5],p=i[6],h=i[7],d=i[8],v=i[9],f=i[10],b=i[11],g=i[12],P=i[13],E=i[14],y=i[15];return(n=n||new m).planes[0].set(a-r,h-c,b-d,y-g),n.planes[1].set(a+r,h+c,b+d,y+g),n.planes[2].set(a-s,h-u,b-v,y-P),n.planes[3].set(a+s,h+u,b+v,y+P),n.planes[4].set(a-o,h-p,b-f,y-E),n.planes[5].set(a+o,h+p,b+f,y+E),n}(n,i),s=e.canvasBoundary,h=e.sceneObjects;if(h)for(var d=0,v=h.length;d<v;d++)f(h[d]);function f(e,t){void 0===t&&(t=2),1!==t&&(t=function(e,t){var n=1,i=u,r=p;i[0]=t[0],i[1]=t[1],i[2]=t[2],r[0]=t[3],r[1]=t[4],r[2]=t[5];for(var s=[i,r],o=0;o<6;++o){var a=e.planes[o];if(a.normal[0]*s[a.testVertex[0]][0]+a.normal[1]*s[a.testVertex[1]][1]+a.normal[2]*s[a.testVertex[2]][2]+a.offset<0)return 3;a.normal[0]*s[1-a.testVertex[0]][0]+a.normal[1]*s[1-a.testVertex[1]][1]+a.normal[2]*s[1-a.testVertex[2]][2]+a.offset<0&&(n=2)}return n}(r,e.aabb)),3!==t&&function(e,t){ae.reset(),ae.object=e;for(var n=0,i=e.meshes.length;n<i;n++){var r=e.meshes[n];ae.mesh=r,ae.meshIndex=n;var s=r.geometry;ae.geometry=s;for(var o=0,a=s.geometryBuckets.length;o<a;o++)if(ae.geometryBucket=s.geometryBuckets[o],ae.geometryBucketIndex=o,t(ae))return!0}}(e,function(t){for(var n=t.positionsWorld,i=0,r=n.length;i<r;i+=3){var s=o();s[0]=n[i],s[1]=n[i+1],s[2]=n[i+2],s[3]=1,g(e,s)}return!1})}function g(e,r){var a=o(),u=o(),p=new Uint16Array(2);c(n,r,a),c(i,a,u),p[0]=Math.floor((1+u[0]/u[3])*s[2]/2),p[1]=Math.floor((1-u[1]/u[3])*s[3]/2),t.insertItem({sceneObject:e,worldPos:r,canvasPos:p},[p[0],p[1],p[0],p[1]])}return t},e.searchKdTree2ForNearestNeighbor=function(e){return[]}});
//# sourceMappingURL=index.umd.js.map
