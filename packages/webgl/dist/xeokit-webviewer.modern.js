var e=require("strongly-typed-events");function t(){t=function(){return e};var e={},i=Object.prototype,r=i.hasOwnProperty,n=Object.defineProperty||function(e,t,i){e[t]=i.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",h=s.toStringTag||"@@toStringTag";function l(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,i){return e[t]=i}}function c(e,t,i,r){var s=Object.create((t&&t.prototype instanceof v?t:v).prototype),o=new M(r||[]);return n(s,"_invoke",{value:_(e,i,o)}),s}function u(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var d={};function v(){}function f(){}function p(){}var y={};l(y,o,function(){return this});var g=Object.getPrototypeOf,b=g&&g(g(O([])));b&&b!==i&&r.call(b,o)&&(y=b);var w=p.prototype=v.prototype=Object.create(y);function m(e){["next","throw","return"].forEach(function(t){l(e,t,function(e){return this._invoke(t,e)})})}function P(e,t){function i(n,s,o,a){var h=u(e[n],e,s);if("throw"!==h.type){var l=h.arg,c=l.value;return c&&"object"==typeof c&&r.call(c,"__await")?t.resolve(c.__await).then(function(e){i("next",e,o,a)},function(e){i("throw",e,o,a)}):t.resolve(c).then(function(e){l.value=e,o(l)},function(e){return i("throw",e,o,a)})}a(h.arg)}var s;n(this,"_invoke",{value:function(e,r){function n(){return new t(function(t,n){i(e,r,t,n)})}return s=s?s.then(n,n):n()}})}function _(e,t,i){var r="suspendedStart";return function(n,s){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===n)throw s;return{value:void 0,done:!0}}for(i.method=n,i.arg=s;;){var o=i.delegate;if(o){var a=E(o,i);if(a){if(a===d)continue;return a}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===r)throw r="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r="executing";var h=u(e,t,i);if("normal"===h.type){if(r=i.done?"completed":"suspendedYield",h.arg===d)continue;return{value:h.arg,done:i.done}}"throw"===h.type&&(r="completed",i.method="throw",i.arg=h.arg)}}}function E(e,t){var i=t.method,r=e.iterator[i];if(void 0===r)return t.delegate=null,"throw"===i&&e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method)||"return"!==i&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+i+"' method")),d;var n=u(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,d;var s=n.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function O(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,n=function t(){for(;++i<e.length;)if(r.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:j}}function j(){return{value:void 0,done:!0}}return f.prototype=p,n(w,"constructor",{value:p,configurable:!0}),n(p,"constructor",{value:f,configurable:!0}),f.displayName=l(p,h,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,l(e,h,"GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},m(P.prototype),l(P.prototype,a,function(){return this}),e.AsyncIterator=P,e.async=function(t,i,r,n,s){void 0===s&&(s=Promise);var o=new P(c(t,i,r,n),s);return e.isGeneratorFunction(i)?o:o.next().then(function(e){return e.done?e.value:o.next()})},m(w),l(w,h,"Generator"),l(w,o,function(){return this}),l(w,"toString",function(){return"[object Generator]"}),e.keys=function(e){var t=Object(e),i=[];for(var r in t)i.push(r);return i.reverse(),function e(){for(;i.length;){var r=i.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=O,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(i,r){return o.type="throw",o.arg=e,t.next=i,r&&(t.method="next",t.arg=void 0),!!r}for(var n=this.tryEntries.length-1;n>=0;--n){var s=this.tryEntries[n],o=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var a=r.call(s,"catchLoc"),h=r.call(s,"finallyLoc");if(a&&h){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(a){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&r.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var s=n;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=e,o.arg=t,s?(this.method="next",this.next=s.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),x(i),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var r=i.completion;if("throw"===r.type){var n=r.arg;x(i)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:O(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=void 0),d}},e}function i(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,"symbol"==typeof(n=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key))?n:String(n),r)}var n}function r(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function n(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,s(e,t)}function s(e,t){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},s(e,t)}function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function h(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return a(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l=0;function c(e){return"__private_"+l+++"_"+e}function u(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var d=/*#__PURE__*/c("ievent"),v=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,d,{writable:!0,value:void 0}),u(this,d)[d]=e}var t=e.prototype;return t.subscribe=function(e){return u(this,d)[d].asEvent().subscribe(e)},t.dispatch=function(e,t){u(this,d)[d].dispatch(e,t)},t.sub=function(e){return u(this,d)[d].asEvent().sub(e)},t.unsubscribe=function(e){u(this,d)[d].asEvent().unsubscribe(e)},t.unsub=function(e){u(this,d)[d].asEvent().unsub(e)},t.one=function(e){return u(this,d)[d].asEvent().one(e)},t.has=function(e){return u(this,d)[d].asEvent().has(e)},t.clear=function(){u(this,d)[d].asEvent().clear()},r(e,[{key:"count",get:function(){return u(this,d)[d].count}}]),e}(),f=/*#__PURE__*/c("messages"),p=/*#__PURE__*/c("locales"),y=/*#__PURE__*/c("locale"),g=/*#__PURE__*/function(){function t(t){void 0===t&&(t={messages:{},locale:""}),Object.defineProperty(this,f,{writable:!0,value:void 0}),Object.defineProperty(this,p,{writable:!0,value:void 0}),Object.defineProperty(this,y,{writable:!0,value:"en"}),this.onUpdated=void 0,this.messages=t.messages,this.locale=t.locale,this.onUpdated=new v(new e.EventDispatcher)}var i=t.prototype;return i.loadMessages=function(e){for(var t in void 0===e&&(e={}),e)u(this,f)[f][t]=e[t];this.messages=u(this,f)[f]},i.clearMessages=function(){this.messages={}},i.translate=function(e,t){var i=u(this,f)[f][u(this,y)[y]];if(!i)return null;var r=b(e,i);return r?t?w(r,t):r:null},i.translatePlurals=function(e,t,i){var r=u(this,f)[f][u(this,y)[y]];if(!r)return null;var n=b(e,r);return(n=0===(t=parseInt(""+t,10))?n.zero:t>1?n.other:n.one)?(n=w(n,[t]),i&&(n=w(n,i)),n):null},r(t,[{key:"messages",set:function(e){u(this,f)[f]=e||{},u(this,p)[p]=Object.keys(u(this,f)[f]),this.onUpdated.dispatch(this,u(this,y)[y])}},{key:"locales",get:function(){return u(this,p)[p]}},{key:"locale",get:function(){return u(this,y)[y]},set:function(e){e=e||"de",u(this,y)[y]!==e&&(u(this,y)[y]=e,this.onUpdated.dispatch(this,u(this,y)[y]))}}]),t}();function b(e,t){if(t[e])return t[e];for(var i=e.split("."),r=t,n=0,s=i.length;r&&n<s;n++)r=r[i[n]];return r}function w(e,t){return void 0===t&&(t=[]),e.replace(/\{\{|\}\}|\{(\d+)\}/g,function(e,i){return"{{"===e?"{":"}}"===e?"}":t[i]})}var m=Float64Array,P=-Number.MAX_SAFE_INTEGER,_=Number.MAX_SAFE_INTEGER,E=.0174532925;function T(e,t,i){return Math.max(t,Math.min(i,e))}function x(e){return new m(e)}function M(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function O(e){return new m(e||2)}function j(e){return new Float64Array(e||3)}function R(e){return new m(e||4)}function S(e,t,i){return i||(i=e),i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i[3]=e[3]+t[3],i}function A(e,t,i){return i||(i=e),i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i}function C(e,t,i){return i||(i=e),i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i}function k(e,t,i){return i||(i=e),i[0]=e[0]*t,i[1]=e[1]*t,i}function D(e,t,i){return i||(i=e),i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i}function I(e,t,i){return i||(i=e),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i[3]=e[3]-t[3],i}function B(e,t,i){return i||(i=e),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i}function L(e,t,i){return i||(i=e),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i}function F(){for(var e=[].slice.call(arguments),t=new Float32Array(e[0]),i=1;i<e.length;i++)t[0]+=e[i][0],t[1]+=e[i][1];return t[0]/=e.length,t[1]/=e.length,t}function U(e,t,i){return i||(i=t),i[0]=e/t[0],i[1]=e/t[1],i[2]=e/t[2],i}function N(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function X(e,t,i){i||(i=e);var r=e[0],n=e[1],s=e[2],o=t[0],a=t[1],h=t[2];return i[0]=n*h-s*a,i[1]=s*o-r*h,i[2]=r*a-n*o,i}function G(e){return N(e,e)}function V(e){return Math.sqrt(G(e))}function H(e,t){return e[0]*t[0]+e[1]*t[1]}function W(e){return M(e,e)}function Y(e){return H(e,e)}function z(e){return Math.sqrt(W(e))}var K,q=(K=j(),function(e,t){return z(B(e,t,K))});function Z(e){return Math.sqrt(Y(e))}function Q(e,t,i,r,n,s){var o=s||j(),a=(e-t)/(i-t);return o[0]=r[0]+a*(n[0]-r[0]),o[1]=r[1]+a*(n[1]-r[1]),o[2]=r[2]+a*(n[2]-r[2]),o}var J=function(){var e=O();return function(t,i){return Z(L(t,i,e))}}();function $(e,t){return A(e,1/V(e),t)}function ee(e,t){return C(e,1/z(e),t)}var te=function(){var e=j();return function(t,i){return e[0]=t[0],e[1]=t[1],e[2]=t[2],i[0]=z(e),e[0]=t[4],e[1]=t[5],e[2]=t[6],i[1]=z(e),e[0]=t[8],e[1]=t[9],e[2]=t[10],i[2]=z(e),i}}();function ie(e){return Math.round(1e5*e)/1e5}var re=R();function ne(e){return new x(e||9)}function se(e){return x(e||16)}var oe=se(),ae=se();function he(e,t,i,r,n){var s=[],o=[];return s[2]=i,o[2]=r,o[1]=s[2]*Math.tan(e/2),s[1]=-o[1],o[0]=o[1]*t,s[0]=-o[0],le(s,o,n)}function le(e,t,i){i||(i=se());var r=[e[0],e[1],e[2],0],n=[t[0],t[1],t[2],0];S(n,r,oe),I(n,r,ae);var s=2*r[2],o=ae[0],a=ae[1],h=ae[2];return i[0]=s/o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=s/a,i[6]=0,i[7]=0,i[8]=oe[0]/o,i[9]=oe[1]/a,i[10]=-oe[2]/h,i[11]=-1,i[12]=0,i[13]=0,i[14]=-s*n[2]/h,i[15]=0,i}function ce(e,t,i,r,n,s,o){o||(o=se());var a=t-e,h=r-i,l=s-n;return o[0]=2/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2/h,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=-2/l,o[11]=0,o[12]=-(e+t)/a,o[13]=-(r+i)/h,o[14]=-(s+n)/l,o[15]=1,o}function ue(e,t,i,r,n,s,o){o||(o=se());var a=t-e,h=r-i,l=s-n;return o[0]=2*n/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*n/h,o[6]=0,o[7]=0,o[8]=(t+e)/a,o[9]=(r+i)/h,o[10]=-(s+n)/l,o[11]=-1,o[12]=0,o[13]=0,o[14]=-s*n*2/l,o[15]=0,o}function de(e){return e||(e=se()),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ve(e){return e||(e=se()),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function fe(e,t,i){i||(i=se());var r,n,s,o,a,h,l=$([t[0],t[1],t[2],0],[]),c=Math.sin(e),u=Math.cos(e),d=1-u,v=l[0],f=l[1],p=l[2];return r=v*f,n=f*p,s=p*v,o=v*c,a=f*c,h=p*c,i[0]=d*v*v+u,i[1]=d*r+h,i[2]=d*s-a,i[3]=0,i[4]=d*r-h,i[5]=d*f*f+u,i[6]=d*n+o,i[7]=0,i[8]=d*s+a,i[9]=d*n-o,i[10]=d*p*p+u,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function pe(e,t,i,r){r||(r=se());var n,s,o,a,h,l,c,u,d,v,f=e[0],p=e[1],y=e[2],g=i[0],b=i[1],w=i[2],m=t[0],P=t[1],_=t[2];return f===m&&p===P&&y===_?de():(n=f-m,s=p-P,o=y-_,a=b*(o*=v=1/Math.sqrt(n*n+s*s+o*o))-w*(s*=v),h=w*(n*=v)-g*o,l=g*s-b*n,(v=Math.sqrt(a*a+h*h+l*l))?(a*=v=1/v,h*=v,l*=v):(a=0,h=0,l=0),c=s*l-o*h,u=o*a-n*l,d=n*h-s*a,(v=Math.sqrt(c*c+u*u+d*d))?(c*=v=1/v,u*=v,d*=v):(c=0,u=0,d=0),r[0]=a,r[1]=c,r[2]=n,r[3]=0,r[4]=h,r[5]=u,r[6]=s,r[7]=0,r[8]=l,r[9]=d,r[10]=o,r[11]=0,r[12]=-(a*f+h*p+l*y),r[13]=-(c*f+u*p+d*y),r[14]=-(n*f+s*p+o*y),r[15]=1,r)}function ye(e,t){t||(t=e);var i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],h=e[6],l=e[7],c=e[8],u=e[9],d=e[10],v=e[11],f=e[12],p=e[13],y=e[14],g=e[15],b=i*a-r*o,w=i*h-n*o,m=i*l-s*o,P=r*h-n*a,_=r*l-s*a,E=n*l-s*h,T=c*p-u*f,x=c*y-d*f,M=c*g-v*f,O=u*y-d*p,j=u*g-v*p,R=d*g-v*y,S=1/(b*R-w*j+m*O+P*M-_*x+E*T);return t[0]=(a*R-h*j+l*O)*S,t[1]=(-r*R+n*j-s*O)*S,t[2]=(p*E-y*_+g*P)*S,t[3]=(-u*E+d*_-v*P)*S,t[4]=(-o*R+h*M-l*x)*S,t[5]=(i*R-n*M+s*x)*S,t[6]=(-f*E+y*m-g*w)*S,t[7]=(c*E-d*m+v*w)*S,t[8]=(o*j-a*M+l*T)*S,t[9]=(-i*j+r*M-s*T)*S,t[10]=(f*_-p*m+g*b)*S,t[11]=(-c*_+u*m-v*b)*S,t[12]=(-o*O+a*x-h*T)*S,t[13]=(i*O-r*x+n*T)*S,t[14]=(-f*P+p*w-y*b)*S,t[15]=(c*P-u*w+d*b)*S,t}function ge(e,t){var i=e[4],r=e[14],n=e[8],s=e[13],o=e[12],a=e[9];if(!t||e===t){var h=e[1],l=e[2],c=e[3],u=e[6],d=e[7],v=e[11];return e[1]=i,e[2]=n,e[3]=o,e[4]=h,e[6]=a,e[7]=s,e[8]=l,e[9]=u,e[11]=r,e[12]=c,e[13]=d,e[14]=v,e}return t[0]=e[0],t[1]=i,t[2]=n,t[3]=o,t[4]=e[1],t[5]=e[5],t[6]=a,t[7]=s,t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=r,t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t}function be(e,t,i){i||(i=e);var r=t[0],n=t[1],s=t[2],o=t[3];return i[0]=e[0]*r+e[4]*n+e[8]*s+e[12]*o,i[1]=e[1]*r+e[5]*n+e[9]*s+e[13]*o,i[2]=e[2]*r+e[6]*n+e[10]*s+e[14]*o,i[3]=e[3]*r+e[7]*n+e[11]*s+e[15]*o,i}function we(e,t,i){i||(i=e);var r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],h=e[5],l=e[6],c=e[7],u=e[8],d=e[9],v=e[10],f=e[11],p=e[12],y=e[13],g=e[14],b=e[15],w=t[0],m=t[1],P=t[2],_=t[3],E=t[4],T=t[5],x=t[6],M=t[7],O=t[8],j=t[9],R=t[10],S=t[11],A=t[12],C=t[13],k=t[14],D=t[15];return i[0]=w*r+m*a+P*u+_*p,i[1]=w*n+m*h+P*d+_*y,i[2]=w*s+m*l+P*v+_*g,i[3]=w*o+m*c+P*f+_*b,i[4]=E*r+T*a+x*u+M*p,i[5]=E*n+T*h+x*d+M*y,i[6]=E*s+T*l+x*v+M*g,i[7]=E*o+T*c+x*f+M*b,i[8]=O*r+j*a+R*u+S*p,i[9]=O*n+j*h+R*d+S*y,i[10]=O*s+j*l+R*v+S*g,i[11]=O*o+j*c+R*f+S*b,i[12]=A*r+C*a+k*u+D*p,i[13]=A*n+C*h+k*d+D*y,i[14]=A*s+C*l+k*v+D*g,i[15]=A*o+C*c+k*f+D*b,i}function me(e,t,i){void 0===i&&(i=x(9));var r=e[0],n=e[3],s=e[6],o=e[1],a=e[4],h=e[7],l=e[2],c=e[5],u=e[8],d=t[0],v=t[3],f=t[6],p=t[1],y=t[4],g=t[7],b=t[2],w=t[5],m=t[8];return i[0]=r*d+n*p+s*b,i[3]=r*v+n*y+s*w,i[6]=r*f+n*g+s*m,i[1]=o*d+a*p+h*b,i[4]=o*v+a*y+h*w,i[7]=o*f+a*g+h*m,i[2]=l*d+c*p+u*b,i[5]=l*v+c*y+u*w,i[8]=l*f+c*g+u*m,i}function Pe(e,t,i){i||(i=t);var r=t[0],n=t[1],s=t[2];return i[0]=e[0]*r+e[4]*n+e[8]*s+e[12],i[1]=e[1]*r+e[5]*n+e[9]*s+e[13],i[2]=e[2]*r+e[6]*n+e[10]*s+e[14],i}function _e(e,t,i){return i[0]=e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12]*t[3],i[1]=e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13]*t[3],i[2]=e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14]*t[3],i[3]=e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]*t[3],i}function Ee(e,t,i){var r=t[0],n=t[1],s=t[2];return(i=i||j())[0]=e[0]*r+e[4]*n+e[8]*s,i[1]=e[1]*r+e[5]*n+e[9]*s,i[2]=e[2]*r+e[6]*n+e[10]*s,i}function Te(e,t,i){var r=t[0],n=t[1],s=t[2],o=t[3];return(i=i||R())[0]=e[0]*r+e[4]*n+e[8]*s+e[12]*o,i[1]=e[1]*r+e[5]*n+e[9]*s+e[13]*o,i[2]=e[2]*r+e[6]*n+e[10]*s+e[14]*o,i[3]=e[3]*r+e[7]*n+e[11]*s+e[15]*o,i}function xe(e,t){void 0===t&&(t=de());var i=e[0],r=e[1],n=e[2];return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,t}function Me(e,t){return void 0===t&&(t=de()),t[0]=e[0],t[5]=e[1],t[10]=e[2],t}function Oe(e,t){return void 0===t&&(t=ve()),t[0]=e[0],t[4]=e[1],t}var je,Re=(je=x(3),function(e,t,i,r){return je[0]=e,je[1]=t,je[2]=i,Me(je,r)});function Se(e,t,i,r){return void 0===r&&(r=se()),He(t,r),xe(i,r),Ce(e,r),r}var Ae=function(){var e=j(),t=se();return function(i,r,n,s){e[0]=i[0],e[1]=i[1],e[2]=i[2];var o=z(e);e[0]=i[4],e[1]=i[5],e[2]=i[6];var a=z(e);e[8]=i[8],e[9]=i[9],e[10]=i[10];var h=z(e);Fe(i)<0&&(o=-o),r[0]=i[12],r[1]=i[13],r[2]=i[14],t.set(i);var l=1/o,c=1/a,u=1/h;t[0]*=l,t[1]*=l,t[2]*=l,t[4]*=c,t[5]*=c,t[6]*=c,t[8]*=u,t[9]*=u,t[10]*=u,Ve(t,n),s[0]=o,s[1]=a,s[2]=h}}();function Ce(e,t){return void 0===t&&(t=de()),ke(e[0],e[1],e[2],t)}function ke(e,t,i,r){void 0===r&&(r=de());var n=r[3];r[0]+=n*e,r[1]+=n*t,r[2]+=n*i;var s=r[7];r[4]+=s*e,r[5]+=s*t,r[6]+=s*i;var o=r[11];r[8]+=o*e,r[9]+=o*t,r[10]+=o*i;var a=r[15];return r[12]+=a*e,r[13]+=a*t,r[14]+=a*i,r}function De(e,t,i){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=t[0],i[13]=t[1],i[14]=t[2],i[15]=e[15],i}function Ie(e,t){var i=t||de();return i[12]=e[0],i[13]=e[1],i[14]=e[2],i}function Be(e,t){var i=t||ve();return i[6]=e[0],i[7]=e[1],i}var Le=function(){var e=x(3);return function(t,i,r,n){return e[0]=t,e[1]=i,e[2]=r,Ie(e,n)}}();function Fe(e){var t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],o=e[5],a=e[6],h=e[7],l=e[8],c=e[9],u=e[10],d=e[11],v=e[12],f=e[13],p=e[14],y=e[15];return v*c*a*n-l*f*a*n-v*o*u*n+s*f*u*n+l*o*p*n-s*c*p*n-v*c*r*h+l*f*r*h+v*i*u*h-t*f*u*h-l*i*p*h+t*c*p*h+v*o*r*d-s*f*r*d-v*i*a*d+t*f*a*d+s*i*p*d-t*o*p*d-l*o*r*y+s*c*r*y+l*i*a*y-t*c*a*y-s*i*u*y+t*o*u*y}function Ue(e,t,i){void 0===i&&(i=j());var r=e[0],n=e[4],s=e[8],o=e[1],a=e[5],h=e[9],l=e[2],c=e[6],u=e[10];return"XYZ"===t?(i[1]=Math.asin(T(s,-1,1)),Math.abs(s)<.99999?(i[0]=Math.atan2(-h,u),i[2]=Math.atan2(-n,r)):(i[0]=Math.atan2(c,a),i[2]=0)):"YXZ"===t?(i[0]=Math.asin(-T(h,-1,1)),Math.abs(h)<.99999?(i[1]=Math.atan2(s,u),i[2]=Math.atan2(o,a)):(i[1]=Math.atan2(-l,r),i[2]=0)):"ZXY"===t?(i[0]=Math.asin(T(c,-1,1)),Math.abs(c)<.99999?(i[1]=Math.atan2(-l,u),i[2]=Math.atan2(-n,a)):(i[1]=0,i[2]=Math.atan2(o,r))):"ZYX"===t?(i[1]=Math.asin(-T(l,-1,1)),Math.abs(l)<.99999?(i[0]=Math.atan2(c,u),i[2]=Math.atan2(o,r)):(i[0]=0,i[2]=Math.atan2(-n,a))):"YZX"===t?(i[2]=Math.asin(T(o,-1,1)),Math.abs(o)<.99999?(i[0]=Math.atan2(-h,a),i[1]=Math.atan2(-l,r)):(i[0]=0,i[1]=Math.atan2(s,u))):"XZY"===t&&(i[2]=Math.asin(-T(n,-1,1)),Math.abs(n)<.99999?(i[0]=Math.atan2(c,a),i[1]=Math.atan2(s,r)):(i[0]=Math.atan2(-h,u),i[1]=0)),i}function Ne(e,t,i,r,n,s){var o=s||se(),a=(e-t)/(i-t);return o[0]=r[0]+a*(n[0]-r[0]),o[1]=r[1]+a*(n[1]-r[1]),o[2]=r[2]+a*(n[2]-r[2]),o[3]=r[3]+a*(n[3]-r[3]),o[4]=r[4]+a*(n[4]-r[4]),o[5]=r[5]+a*(n[5]-r[5]),o[6]=r[6]+a*(n[6]-r[6]),o[7]=r[7]+a*(n[7]-r[7]),o[8]=r[8]+a*(n[8]-r[8]),o[9]=r[9]+a*(n[9]-r[9]),o[10]=r[10]+a*(n[10]-r[10]),o[11]=r[11]+a*(n[11]-r[11]),o[12]=r[12]+a*(n[12]-r[12]),o[13]=r[13]+a*(n[13]-r[13]),o[14]=r[14]+a*(n[14]-r[14]),o[15]=r[15]+a*(n[15]-r[15]),o}function Xe(e){return void 0===e&&(e=R()),e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Ge(e,t,i){void 0===i&&(i=R());var r=e[0]*E/2,n=e[1]*E/2,s=e[2]*E/2,o=Math.cos(r),a=Math.cos(n),h=Math.cos(s),l=Math.sin(r),c=Math.sin(n),u=Math.sin(s);return"XYZ"===t?(i[0]=l*a*h+o*c*u,i[1]=o*c*h-l*a*u,i[2]=o*a*u+l*c*h,i[3]=o*a*h-l*c*u):"YXZ"===t?(i[0]=l*a*h+o*c*u,i[1]=o*c*h-l*a*u,i[2]=o*a*u-l*c*h,i[3]=o*a*h+l*c*u):"ZXY"===t?(i[0]=l*a*h-o*c*u,i[1]=o*c*h+l*a*u,i[2]=o*a*u+l*c*h,i[3]=o*a*h-l*c*u):"ZYX"===t?(i[0]=l*a*h-o*c*u,i[1]=o*c*h+l*a*u,i[2]=o*a*u-l*c*h,i[3]=o*a*h+l*c*u):"YZX"===t?(i[0]=l*a*h+o*c*u,i[1]=o*c*h+l*a*u,i[2]=o*a*u-l*c*h,i[3]=o*a*h-l*c*u):"XZY"===t&&(i[0]=l*a*h-o*c*u,i[1]=o*c*h-l*a*u,i[2]=o*a*u+l*c*h,i[3]=o*a*h+l*c*u),i}function Ve(e,t){void 0===t&&(t=R());var i,r=e[0],n=e[4],s=e[8],o=e[1],a=e[5],h=e[9],l=e[2],c=e[6],u=e[10],d=r+a+u;return d>0?(i=.5/Math.sqrt(d+1),t[3]=.25/i,t[0]=(c-h)*i,t[1]=(s-l)*i,t[2]=(o-n)*i):r>a&&r>u?(i=2*Math.sqrt(1+r-a-u),t[3]=(c-h)/i,t[0]=.25*i,t[1]=(n+o)/i,t[2]=(s+l)/i):a>u?(i=2*Math.sqrt(1+a-r-u),t[3]=(s-l)/i,t[0]=(n+o)/i,t[1]=.25*i,t[2]=(h+c)/i):(i=2*Math.sqrt(1+u-r-a),t[3]=(o-n)/i,t[0]=(s+l)/i,t[1]=(h+c)/i,t[2]=.25*i),t}function He(e,t){var i=e[0],r=e[1],n=e[2],s=e[3],o=i+i,a=r+r,h=n+n,l=i*o,c=i*a,u=i*h,d=r*a,v=r*h,f=n*h,p=s*o,y=s*a,g=s*h;return t[0]=1-(d+f),t[4]=c-g,t[8]=u+y,t[1]=c+g,t[5]=1-(l+f),t[9]=v-p,t[2]=u-y,t[6]=v+p,t[10]=1-(l+d),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function We(e,t){void 0===t&&(t=e);var i=V([e[0],e[1],e[2],e[3]]);return t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i,t[3]=e[3]/i,t}function Ye(e,t){return void 0===t&&(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}var ze=j(),Ke=j(),qe=se(),Ze=/*#__PURE__*/function(){function e(){this.testVertex=void 0,this.offset=void 0,this.normal=void 0,this.normal=j(),this.offset=0,this.testVertex=j()}return e.prototype.set=function(e,t,i,r){var n=1/Math.sqrt(e*e+t*t+i*i);this.normal[0]=e*n,this.normal[1]=t*n,this.normal[2]=i*n,this.offset=r*n,this.testVertex[0]=this.normal[0]>=0?1:0,this.testVertex[1]=this.normal[1]>=0?1:0,this.testVertex[2]=this.normal[2]>=0?1:0},e}(),Qe=function(){this.planes=void 0,this.planes=[new Ze,new Ze,new Ze,new Ze,new Ze,new Ze]};Qe.INSIDE=0,Qe.INTERSECT=1,Qe.OUTSIDE=2;var Je=j(),$e=j(),et=j(),tt=j(),it=j(),rt=R(),nt=R(),st={__proto__:null,rayTriangleIntersect:function(e,t,i,r,n,s){s=s||j();var o=B(r,i,Je),a=B(n,i,$e),h=X(t,a,et),l=M(o,h);if(l<1e-6)return null;var c=B(e,i,tt),u=M(c,h);if(u<0||u>l)return null;var d=X(c,o,it),v=M(t,d);if(v<0||u+v>l)return null;var f=M(a,d)/l;return s[0]=e[0]+f*t[0],s[1]=e[1]+f*t[1],s[2]=e[2]+f*t[2],s},transformRay:function(e,t,i,r,n){rt[0]=t[0],rt[1]=t[1],rt[2]=t[2],rt[3]=1,Te(e,rt,nt),r[0]=nt[0],r[1]=nt[1],r[2]=nt[2],rt[0]=i[0],rt[1]=i[1],rt[2]=i[2],Ee(e,rt,nt),ee(nt),n[0]=nt[0],n[1]=nt[1],n[2]=nt[2]}},ot=1e3,at=1001,ht=1002,lt=1003,ct=1006,ut=1008,dt=1023,vt=33776,ft=33779,pt=3e3,yt=3001,gt=2e4,bt=20001,wt=20002,mt=20003,Pt=20004,_t=3e4,Et=4e5,Tt=5e5,xt=500001,Mt=500002,Ot=500003,jt={__proto__:null,RepeatWrapping:ot,ClampToEdgeWrapping:at,MirroredRepeatWrapping:ht,NearestFilter:lt,NearestMipMapNearestFilter:1004,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,NearestMipMapLinearFilter:1005,LinearFilter:ct,LinearMipmapNearestFilter:1007,LinearMipMapNearestFilter:1007,LinearMipmapLinearFilter:ut,LinearMipMapLinearFilter:1008,UnsignedByteType:1009,ByteType:1010,ShortType:1011,UnsignedShortType:1012,IntType:1013,UnsignedIntType:1014,FloatType:1015,HalfFloatType:1016,UnsignedShort4444Type:1017,UnsignedShort5551Type:1018,UnsignedInt248Type:1020,AlphaFormat:1021,RGBFormat:1022,RGBAFormat:dt,LuminanceFormat:1024,LuminanceAlphaFormat:1025,DepthFormat:1026,DepthStencilFormat:1027,RedFormat:1028,RedIntegerFormat:1029,RGFormat:1030,RGIntegerFormat:1031,RGBAIntegerFormat:1033,RGB_S3TC_DXT1_Format:vt,RGBA_S3TC_DXT1_Format:33777,RGBA_S3TC_DXT3_Format:33778,RGBA_S3TC_DXT5_Format:ft,RGB_PVRTC_4BPPV1_Format:35840,RGB_PVRTC_2BPPV1_Format:35841,RGBA_PVRTC_4BPPV1_Format:35842,RGBA_PVRTC_2BPPV1_Format:35843,RGB_ETC1_Format:36196,RGB_ETC2_Format:37492,RGBA_ETC2_EAC_Format:37496,RGBA_ASTC_4x4_Format:37808,RGBA_ASTC_5x4_Format:37809,RGBA_ASTC_5x5_Format:37810,RGBA_ASTC_6x5_Format:37811,RGBA_ASTC_6x6_Format:37812,RGBA_ASTC_8x5_Format:37813,RGBA_ASTC_8x6_Format:37814,RGBA_ASTC_8x8_Format:37815,RGBA_ASTC_10x5_Format:37816,RGBA_ASTC_10x6_Format:37817,RGBA_ASTC_10x8_Format:37818,RGBA_ASTC_10x10_Format:37819,RGBA_ASTC_12x10_Format:37820,RGBA_ASTC_12x12_Format:37821,RGBA_BPTC_Format:36492,LinearEncoding:pt,sRGBEncoding:yt,GIFMediaType:1e4,JPEGMediaType:10001,PNGMediaType:10002,PointsPrimitive:gt,LinesPrimitive:bt,TrianglesPrimitive:wt,SolidPrimitive:mt,SurfacePrimitive:Pt,QualityRender:_t,FastRender:300001,MetersUnit:Et,CentimetersUnit:400001,MillimetersUnit:400002,YardsUnit:400003,FeetUnit:400004,InchesUnit:400005,PerspectiveProjectionType:Tt,OrthoProjectionType:xt,FrustumProjectionType:Mt,CustomProjectionType:Ot},Rt=null;function St(e,t){for(var i,r=0;r<3;r++)if(0!=(i=Rt[3*e+r]-Rt[3*t+r]))return i;return 0}var At=null,Ct=null;function kt(e,t){var i,r,n,s,o,a,h=3*e,l=3*t,c=Math.min(i=Ct[h],r=Ct[h+1],n=Ct[h+2]),u=Math.min(s=Ct[l],o=Ct[l+1],a=Ct[l+2]);if(c!=u)return c-u;var d=Math.max(i,r,n),v=Math.max(s,o,a);return d!=v?d-v:0}var Dt=[],It=[],Bt=[],Lt=[],Ft=[],Ut=0,Nt=new Uint16Array(3),Xt=new Uint16Array(3),Gt=new Uint16Array(3),Vt=j(),Ht=j(),Wt=j(),Yt=j(),zt=j(),Kt=j(),qt=j();function Zt(e,t,i,r){!function(e,t){var i,r,n,s,o,a,h={},l=Math.pow(10,4),c=0;for(o=0,a=e.length;o<a;o+=3)i=e[o],r=e[o+1],n=e[o+2],void 0===h[s=Math.round(i*l)+"_"+Math.round(r*l)+"_"+Math.round(n*l)]&&(h[s]=c/3,Dt[c++]=i,Dt[c++]=r,Dt[c++]=n),It[o/3]=h[s];for(o=0,a=t.length;o<a;o++)Lt[o]=It[t[o]],Bt[Lt[o]]=t[o]}(e,t),function(e,t){Ut=0;for(var i=0,r=e;i<r;i+=3){var n=3*Lt[i],s=3*Lt[i+1],o=3*Lt[i+2];t?(Nt[0]=Dt[n],Nt[1]=Dt[n+1],Nt[2]=Dt[n+2],Xt[0]=Dt[s],Xt[1]=Dt[s+1],Xt[2]=Dt[s+2],Gt[0]=Dt[o],Gt[1]=Dt[o+1],Gt[2]=Dt[o+2],ii(Nt,t,Vt),ii(Xt,t,Ht),ii(Gt,t,Wt)):(Vt[0]=Dt[n],Vt[1]=Dt[n+1],Vt[2]=Dt[n+2],Ht[0]=Dt[s],Ht[1]=Dt[s+1],Ht[2]=Dt[s+2],Wt[0]=Dt[o],Wt[1]=Dt[o+1],Wt[2]=Dt[o+2]),B(Wt,Ht,Yt),B(Vt,Ht,zt),X(Yt,zt,Kt),ee(Kt,qt);var a=Ft[Ut]||(Ft[Ut]={normal:j()});a.normal[0]=qt[0],a.normal[1]=qt[1],a.normal[2]=qt[2],Ut++}}(t.length,i);for(var n,s,o,a,h,l,c,u,d=[],v=Math.cos(E*r),f={},p=!1,y=0,g=t.length;y<g;y+=3)for(var b=y/3,w=0;w<3;w++)n=Lt[y+w],s=Lt[y+(w+1)%3],void 0===f[h=(o=Math.min(n,s))+","+(a=Math.max(n,s))]?f[h]={index1:o,index2:a,face1:b,face2:void 0}:f[h].face2=b;for(h in f)void 0!==(l=f[h]).face2&&M(Ft[l.face1].normal,Ft[l.face2].normal)>v||(c=Bt[l.index1],u=Bt[l.index2],(!p&&c>65535||u>65535)&&(p=!0),d.push(c),d.push(u));return p?new Uint32Array(d):new Uint16Array(d)}var Qt=se(),Jt=se(),$t=j(),ei=j();function ti(e){var t=se(),i=new Float32Array(e.positions.length);!function(e,t,i,r,n){void 0===n&&(n=200);var s=_i(e,ei);t&&(s[0]+=t[0],s[1]+=t[1],s[2]+=t[2]);for(var o=Math.round(s[0]/n)*n,a=Math.round(s[1]/n)*n,h=Math.round(s[2]/n)*n,l=0,c=e.length;l<c;l+=3)i[l+0]=e[l+0]-o,i[l+1]=e[l+1]-a,i[l+2]=e[l+2]-h;r[0]=o,r[1]=a,r[2]=h}(e.positions,e.origin,i,$t);var r=yi();mi(r,i);var n,s=ai(i,r,t),o=e.primitive!==mt&&e.primitive!==Pt&&e.primitive!==wt||!e.indices?null:Zt(s,e.indices,t,e.edgeThreshold||10),a=function(e){var t=e.positionsCompressed,i=e.indices,r=e.edgeIndices;!function(e){if(!(null!==At&&At.length>=e)){At=new Uint32Array(e);for(var t=0;t<e;t++)At[t]=t}}(t.length/3);var n=At.slice(0,t.length/3),s=At.slice(0,t.length/3);Rt=t,n.sort(St);var o=0;s[n[0]]=0;for(var a=1,h=n.length;a<h;a++)0!=St(n[a],n[a-1])&&o++,s[n[a]]=o;var l=new Uint16Array(3*(o+1));l[3*(o=0)+0]=t[3*n[0]+0],l[3*o+1]=t[3*n[0]+1],l[3*o+2]=t[3*n[0]+2];for(var c=1,u=n.length;c<u;c++)0!==St(n[c],n[c-1])&&(l[3*++o+0]=t[3*n[c]+0],l[3*o+1]=t[3*n[c]+1],l[3*o+2]=t[3*n[c]+2]),s[n[c]]=o;Rt=null;for(var d,v=new Uint32Array(i.length),f=0,p=i.length;f<p;f++)v[f]=s[i[f]];if(r){d=new Uint32Array(r.length);for(var y=0,g=r.length;y<g;y++)d[y]=s[r[y]]}return[l,v,d]}({positionsCompressed:s,uvs:e.uvs,indices:e.indices,edgeIndices:o}),h=function(e,t,i){void 0===i&&(i=!1);var r=e.positionsCompressed||[],n=function(e,t){for(var i=new Int32Array(e.length/3),r=0,n=i.length;r<n;r++)i[r]=r;Ct=new Int32Array(e.length);for(var s=0,o=e.length;s<o;s++)Ct[s]=e[s]>>t;i.sort(kt);for(var a=new Int32Array(e.length),h=0,l=i.length;h<l;h++)a[3*h+0]=e[3*i[h]+0],a[3*h+1]=e[3*i[h]+1],a[3*h+2]=e[3*i[h]+2];return a}(e.indices||[],t),s=[];function o(e,t){if(e>t){var i=e;e=t,t=i}function r(i,r){return i!=e?e-i:r!=t?t-r:0}for(var n=0,o=(s.length>>1)-1;n<=o;){var a=o+n>>1,h=r(s[2*a],s[2*a+1]);if(h>0)n=a+1;else{if(!(h<0))return a;o=a-1}}return-n-1}var a=new Int32Array(s.length/2);a.fill(0);var h=r.length/3;if(h>8*(1<<t))return[e];var l=new Int32Array(h);l.fill(-1);var c=[];function u(){l.fill(-1);var e={positionsCompressed:[],indices:[],edgeIndices:[],maxNumPositions:(1<<t)-t,numPositions:0,bucketNumber:c.length};return c.push(e),e}for(var d=u(),v=0,f=n.length;v<f;v+=3){var p=0,y=n[v],g=n[v+1],b=n[v+2];if(-1==l[y]&&p++,-1==l[g]&&p++,-1==l[b]&&p++,p+d.numPositions>d.maxNumPositions&&(d=u()),d.bucketNumber>8)return[e];-1==l[y]&&(l[y]=d.numPositions++,d.positionsCompressed.push(r[3*y]),d.positionsCompressed.push(r[3*y+1]),d.positionsCompressed.push(r[3*y+2])),-1==l[g]&&(l[g]=d.numPositions++,d.positionsCompressed.push(r[3*g]),d.positionsCompressed.push(r[3*g+1]),d.positionsCompressed.push(r[3*g+2])),-1==l[b]&&(l[b]=d.numPositions++,d.positionsCompressed.push(r[3*b]),d.positionsCompressed.push(r[3*b+1]),d.positionsCompressed.push(r[3*b+2])),d.indices.push(l[y]),d.indices.push(l[g]),d.indices.push(l[b]);var w=void 0;(w=o(y,g))>=0&&0==a[w]&&(a[w]=1,d.edgeIndices.push(l[s[2*w]]),d.edgeIndices.push(l[s[2*w+1]])),(w=o(y,b))>=0&&0==a[w]&&(a[w]=1,d.edgeIndices.push(l[s[2*w]]),d.edgeIndices.push(l[s[2*w+1]])),(w=o(g,b))>=0&&0==a[w]&&(a[w]=1,d.edgeIndices.push(l[s[2*w]]),d.edgeIndices.push(l[s[2*w+1]]))}var m=t/8,P=2*r.length+(n.length+s.length)*(t/8*2),_=0;return c.forEach(function(e){_+=2*e.positionsCompressed.length+(e.indices.length+e.edgeIndices.length)*m}),_>P?[e]:(i&&function(e,t){var i={};e.forEach(function(e){for(var t=e.indices,r=e.edgeIndices,n=e.positionsCompressed,s=0,o=t.length;s<o;s+=3)i[n[3*t[s]]+"_"+n[3*t[s]+1]+"_"+n[3*t[s]+2]+"/"+n[3*t[s+1]]+"_"+n[3*t[s+1]+1]+"_"+n[3*t[s+1]+2]+"/"+n[3*t[s+2]]+"_"+n[3*t[s+2]+1]+"_"+n[3*t[s+2]+2]]=!0;for(s=0,o=r.length;s<o;s+=2);});for(var r=t.indices,n=t.positionsCompressed,s=0,o=r.length;s<o;s+=3){var a=n[3*r[s]]+"_"+n[3*r[s]+1]+"_"+n[3*r[s]+2]+"/"+n[3*r[s+1]]+"_"+n[3*r[s+1]+1]+"_"+n[3*r[s+1]+2]+"/"+n[3*r[s+2]]+"_"+n[3*r[s+2]+1]+"_"+n[3*r[s+2]+2];if(!(a in i))throw console.log("Not found "+a),"Ohhhh!"}}(c,e),c)}({positionsCompressed:n=a[0],indices:a[1],edgeIndices:a[2]},n.length/3>65536?16:8);return{id:e.id,primitive:e.primitive===mt&&h.length>1?wt:e.primitive,origin:$t,aabb:r,positionsDecompressMatrix:t,uvsDecompressMatrix:void 0,geometryBuckets:h}}function ii(e,t,i){return void 0===i&&(i=e),i[0]=e[0]*t[0]+t[12],i[1]=e[1]*t[5]+t[13],i[2]=e[2]*t[10]+t[14],i}var ri=function(){var e=ne(),t=ne();return function(i,r,n){var s,o=new Uint16Array(i.length),a=new Float32Array([65535/(n[0]-r[0]),65535/(n[1]-r[1])]);for(s=0;s<i.length;s+=2)o[s+0]=Math.floor((i[s+0]-r[0])*a[0]),o[s+1]=Math.floor((i[s+1]-r[1])*a[1]);return ve(e),Be(r,e),ve(t),Oe([(n[0]-r[0])/65535,(n[1]-r[1])/65535],t),{quantized:o,decompressMatrix:me(e,t,ve())}}}();function ni(e,t,i,r){var n=e[t]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2])),s=e[t+1]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2]));if(e[t+2]<0){var o=(1-Math.abs(s))*(n>=0?1:-1),a=(1-Math.abs(n))*(s>=0?1:-1);n=o,s=a}return new Int8Array([Math[i](127.5*n+(n<0?-1:0)),Math[r](127.5*s+(s<0?-1:0))])}function si(e,t,i){return e[t]*i[0]+e[t+1]*i[1]+e[t+2]*i[2]}function oi(e,t){void 0===t&&(t=j());var i=e[0],r=e[1];i=(2*i+1)/255,r=(2*r+1)/255;var n=1-Math.abs(i)-Math.abs(r);n<0&&(i=(1-Math.abs(r))*(i>=0?1:-1),r=(1-Math.abs(i))*(r>=0?1:-1));var s=Math.sqrt(i*i+r*r+n*n);return t[0]=i/s,t[1]=r/s,t[2]=n/s,t}function ai(e,t,i){for(var r=e.length,n=new Uint16Array(r),s=t[0],o=t[1],a=t[2],h=t[3]-s,l=t[4]-o,c=t[5]-a,u=65525,d=u/h,v=u/l,f=u/c,p=function(e){return e>=0?e:0},y=0;y<r;y+=3)n[y+0]=Math.floor(p(e[y+0]-s)*d),n[y+1]=Math.floor(p(e[y+1]-o)*v),n[y+2]=Math.floor(p(e[y+2]-a)*f);return de(Qt),Ie(t,Qt),de(Jt),Me([h/u,l/u,c/u],Jt),we(Qt,Jt,i),n}function hi(e,t,i){var r,n,s=e[0]/(Math.abs(e[0])+Math.abs(e[1])+Math.abs(e[2])),o=e[1]/(Math.abs(e[0])+Math.abs(e[1])+Math.abs(e[2]));return e[2]<0&&(r=(1-Math.abs(o))*(s>=0?1:-1),n=(1-Math.abs(s))*(o>=0?1:-1),s=r,o=n),new Int8Array([Math[t](127.5*s+(s<0?-1:0)),Math[i](127.5*o+(o<0?-1:0))])}function li(e,t,i,r){var n=e[t]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2])),s=e[t+1]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2]));if(e[t+2]<0){var o=(1-Math.abs(s))*(n>=0?1:-1),a=(1-Math.abs(n))*(s>=0?1:-1);n=o,s=a}return new Int8Array([Math[i](127.5*n+(n<0?-1:0)),Math[r](127.5*s+(s<0?-1:0))])}var ci={__proto__:null,compressGeometryParams:ti,getPositionsBounds:function(e,t,i){var r,n;for(t=t||new Float64Array(3),i=i||new Float64Array(3),r=0;r<3;r++)t[r]=Number.MAX_VALUE,i[r]=-Number.MAX_VALUE;for(r=0;r<e.length;r+=3)for(n=0;n<3;n++)t[n]=Math.min(t[n],e[r+n]),i[n]=Math.max(i[n],e[r+n]);return{min:t,max:i}},createPositionsDecompressMatrix:function(e,t){t=t||se();var i=e[3]-e[0],r=e[4]-e[1],n=e[5]-e[2],s=65535;return de(Qt),Ie(e,Qt),de(Jt),Me([i/s,r/s,n/s],Jt),we(Qt,Jt,t),t},compressPositions:function(e,t,i){var r,n=new Uint16Array(e.length),s=new Float32Array([i[0]!==t[0]?65535/(i[0]-t[0]):0,i[1]!==t[1]?65535/(i[1]-t[1]):0,i[2]!==t[2]?65535/(i[2]-t[2]):0]);for(r=0;r<e.length;r+=3)n[r+0]=Math.floor((e[r+0]-t[0])*s[0]),n[r+1]=Math.floor((e[r+1]-t[1])*s[1]),n[r+2]=Math.floor((e[r+2]-t[2])*s[2]);return de(Qt),Ie(t,Qt),de(Jt),Me([(i[0]-t[0])/65535,(i[1]-t[1])/65535,(i[2]-t[2])/65535],Jt),{quantized:n,decompressMatrix:we(Qt,Jt,de())}},decompressPosition:ii,decompressAABB:function(e,t,i){return void 0===i&&(i=e),i[0]=e[0]*t[0]+t[12],i[1]=e[1]*t[5]+t[13],i[2]=e[2]*t[10]+t[14],i[3]=e[3]*t[0]+t[12],i[4]=e[4]*t[5]+t[13],i[5]=e[5]*t[10]+t[14],i},decompressPositions:function(e,t,i){void 0===i&&(i=new Float32Array(e.length));for(var r=0,n=e.length;r<n;r+=3)i[r+0]=e[r+0]*t[0]+t[12],i[r+1]=e[r+1]*t[5]+t[13],i[r+2]=e[r+2]*t[10]+t[14];return i},getUVBounds:function(e){var t,i,r=new Float32Array(2),n=new Float32Array(2);for(t=0;t<2;t++)r[t]=Number.MAX_VALUE,n[t]=-Number.MAX_VALUE;for(t=0;t<e.length;t+=2)for(i=0;i<2;i++)r[i]=Math.min(r[i],e[t+i]),n[i]=Math.max(n[i],e[t+i]);return{min:r,max:n}},compressUVs:ri,compressNormals:function(e){for(var t,i,r,n,s=new Int8Array(e.length),o=0;o<e.length;o+=3)i=t=ni(e,o,"floor","floor"),r=n=si(e,o,oi(t)),(r=si(e,o,oi(t=ni(e,o,"ceil","floor"))))>n&&(i=t,n=r),(r=si(e,o,oi(t=ni(e,o,"floor","ceil"))))>n&&(i=t,n=r),(r=si(e,o,oi(t=ni(e,o,"ceil","ceil"))))>n&&(i=t,n=r),s[o]=i[0],s[o+1]=i[1];return s},decompressUV:function(e,t,i){void 0===i&&(i=new Float32Array(2)),i[0]=e[0]*t[0]+t[6],i[1]=e[1]*t[4]+t[7]},decompressUVs:function(e,t,i){void 0===i&&(i=new Float32Array(e.length));for(var r=0,n=e.length;r<n;r+=3)i[r+0]=e[r+0]*t[0]+t[6],i[r+1]=e[r+1]*t[4]+t[7];return i},decompressNormal:function(e,t){var i=e[0],r=e[1];i=(2*i+1)/255,r=(2*r+1)/255;var n=1-Math.abs(i)-Math.abs(r);n<0&&(i=(1-Math.abs(r))*(i>=0?1:-1),r=(1-Math.abs(i))*(r>=0?1:-1));var s=Math.sqrt(i*i+r*r+n*n);return t[0]=i/s,t[1]=r/s,t[2]=n/s,t},decompressNormals:function(e,t){for(var i=0,r=0,n=e.length;i<n;i+=2){var s=e[i+0],o=e[i+1];s=(2*s+1)/255,o=(2*o+1)/255;var a=1-Math.abs(s)-Math.abs(o);a<0&&(s=(1-Math.abs(o))*(s>=0?1:-1),o=(1-Math.abs(s))*(o>=0?1:-1));var h=Math.sqrt(s*s+o*o+a*a);t[r+0]=s/h,t[r+1]=o/h,t[r+2]=a/h,r+=3}return t},quantizePositions:ai,transformAndOctEncodeNormals:function(e,t,i,r,n){function s(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}var o,a,h,l,c,u=new Float32Array([0,0,0,0]),d=new Float32Array([0,0,0,0]);for(c=0;c<i;c+=3)u[0]=t[c],u[1]=t[c+1],u[2]=t[c+2],Ee(e,u,d),ee(d,d),a=o=hi(d,"floor","floor"),h=l=s(d,oi(o)),(h=s(d,oi(o=hi(d,"ceil","floor"))))>l&&(a=o,l=h),(h=s(d,oi(o=hi(d,"floor","ceil"))))>l&&(a=o,l=h),(h=s(d,oi(o=hi(d,"ceil","ceil"))))>l&&(a=o,l=h),r[n+c+0]=a[0],r[n+c+1]=a[1],r[n+c+2]=0;return n+i},octEncodeNormals:function(e){for(var t,i,r,n,s=e.length,o=new Int8Array(s),a=0;a<s;a+=3)i=t=li(e,a,"floor","floor"),r=n=si(e,a,oi(t)),(r=si(e,a,oi(t=li(e,a,"ceil","floor"))))>n&&(i=t,n=r),(r=si(e,a,oi(t=li(e,a,"floor","ceil"))))>n&&(i=t,n=r),(r=si(e,a,oi(t=li(e,a,"ceil","ceil"))))>n&&(i=t,n=r),o[a+0]=i[0],o[a+1]=i[1],o[a+2]=0;return o},octEncodeVec3:hi,octEncodeNormal:li};function ui(e){return new Float64Array(e||6)}function di(e){return x(e||32)}var vi=function(){var e=x(3),t=x(3),i=x(3);return function(r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],t[0]=r[3],t[1]=r[4],t[2]=r[5],B(t,e,i),Math.abs(z(i))}}(),fi=function(){var e=x(3),t=x(3),i=x(3);return function(r,n){e[0]=r[0],e[1]=r[1],e[2]=r[2],t[0]=r[3],t[1]=r[4],t[2]=r[5];var s=B(t,e,i),o=n[0]-r[0],a=r[3]-n[0],h=n[1]-r[1],l=r[4]-n[1],c=n[2]-r[2],u=r[5]-n[2];return s[0]+=o>a?o:a,s[1]+=h>l?h:l,s[2]+=c>u?c:u,Math.abs(z(s))}}();function pi(e,t){return void 0===t&&(t=j()),t[0]=(e[0]+e[3])/2,t[1]=(e[1]+e[4])/2,t[2]=(e[2]+e[5])/2,t}function yi(e){return void 0===e&&(e=ui()),e[0]=_,e[1]=_,e[2]=_,e[3]=P,e[4]=P,e[5]=P,e}function gi(e,t){return void 0===e&&(e=ui()),void 0===t&&(t=di()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=1,t[4]=e[3],t[5]=e[1],t[6]=e[2],t[7]=1,t[8]=e[3],t[9]=e[4],t[10]=e[2],t[11]=1,t[12]=e[0],t[13]=e[4],t[14]=e[2],t[15]=1,t[16]=e[0],t[17]=e[1],t[18]=e[5],t[19]=1,t[20]=e[3],t[21]=e[1],t[22]=e[5],t[23]=1,t[24]=e[3],t[25]=e[4],t[26]=e[5],t[27]=1,t[28]=e[0],t[29]=e[4],t[30]=e[5],t[31]=1,t}function bi(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[3]&&(e[3]=t[3]),e[4]<t[4]&&(e[4]=t[4]),e[5]<t[5]&&(e[5]=t[5]),e}function wi(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[0]&&(e[3]=t[0]),e[4]<t[1]&&(e[4]=t[1]),e[5]<t[2]&&(e[5]=t[2]),e}function mi(e,t){for(var i,r,n,s=0,o=t.length;s<o;s+=3)r=t[s+1],n=t[s+2],e[0]>(i=t[s])&&(e[0]=i),e[1]>r&&(e[1]=r),e[2]>n&&(e[2]=n),e[3]<i&&(e[3]=i),e[4]<r&&(e[4]=r),e[5]<n&&(e[5]=n);return e}var Pi=function(){var e=x(3);return function(t,i,r){i=i||ui();for(var n,s,o,a=_,h=_,l=_,c=P,u=P,d=P,v=0,f=t.length;v<f;v+=3)r?(e[0]=t[v+0],e[1]=t[v+1],e[2]=t[v+2],ii(e,r,e),n=e[0],s=e[1],o=e[2]):(n=t[v+0],s=t[v+1],o=t[v+2]),n<a&&(a=n),s<h&&(h=s),o<l&&(l=o),n>c&&(c=n),s>u&&(u=s),o>d&&(d=o);return i[0]=a,i[1]=h,i[2]=l,i[3]=c,i[4]=u,i[5]=d,i}}();function _i(e,t){void 0===t&&(t=j());for(var i=0,r=0,n=0,s=0,o=e.length;s<o;s+=3)i+=e[s+0],r+=e[s+1],n+=e[s+2];var a=e.length/3;return t[0]=i/a,t[1]=r/a,t[2]=n/a,t}var Ei={__proto__:null,AABB3:ui,AABB2:function(e){return x(e||4)},OBB3:di,OBB2:function(e){return x(e||16)},Sphere3:function(e,t,i,r){return x([e,t,i,r])},transformOBB3:function(e,t,i){var r;void 0===i&&(i=t);var n,s,o,a=t.length,h=e[0],l=e[1],c=e[2],u=e[3],d=e[4],v=e[5],f=e[6],p=e[7],y=e[8],g=e[9],b=e[10],w=e[11],m=e[12],P=e[13],_=e[14],E=e[15];for(r=0;r<a;r+=4)i[r+0]=h*(n=t[r+0])+d*(s=t[r+1])+y*(o=t[r+2])+m,i[r+1]=l*n+v*s+g*o+P,i[r+2]=c*n+f*s+b*o+_,i[r+3]=u*n+p*s+w*o+E;return i},containsAABB3:function(e,t){return e[0]<=t[0]&&t[3]<=e[3]&&e[1]<=t[1]&&t[4]<=e[4]&&e[2]<=t[2]&&t[5]<=e[5]},getAABB3Diag:vi,getAABB3DiagPoint:fi,getAABB3Area:function(e){return(e[3]-e[0])*(e[4]-e[1])*(e[5]-e[2])},getAABB3Center:pi,getAABB2Center:function(e,t){return void 0===t&&(t=O()),t[0]=(e[2]+e[0])/2,t[1]=(e[3]+e[1])/2,t},collapseAABB3:yi,AABB3ToOBB3:gi,expandAABB3:bi,expandAABB3Point3:wi,expandAABB3Points3:mi,ABB3ToOBB3:function(e,t){return void 0===t&&(t=di()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=1,t[4]=e[3],t[5]=e[1],t[6]=e[2],t[7]=1,t[8]=e[3],t[9]=e[4],t[10]=e[2],t[11]=1,t[12]=e[0],t[13]=e[4],t[14]=e[2],t[15]=1,t[16]=e[0],t[17]=e[1],t[18]=e[5],t[19]=1,t[20]=e[3],t[21]=e[1],t[22]=e[5],t[23]=1,t[24]=e[3],t[25]=e[4],t[26]=e[5],t[27]=1,t[28]=e[0],t[29]=e[4],t[30]=e[5],t[31]=1,t},positions3ToAABB3:Pi,OBB3ToAABB3:function(e,t){void 0===t&&(t=ui());for(var i,r,n,s=_,o=_,a=_,h=P,l=P,c=P,u=0,d=e.length;u<d;u+=4)(i=e[u+0])<s&&(s=i),(r=e[u+1])<o&&(o=r),(n=e[u+2])<a&&(a=n),i>h&&(h=i),r>l&&(l=r),n>c&&(c=n);return t[0]=s,t[1]=o,t[2]=a,t[3]=h,t[4]=l,t[5]=c,t},points3ToAABB3:function(e,t){void 0===t&&(t=ui());for(var i,r,n,s=_,o=_,a=_,h=P,l=P,c=P,u=0,d=e.length;u<d;u++)(i=e[u][0])<s&&(s=i),(r=e[u][1])<o&&(o=r),(n=e[u][2])<a&&(a=n),i>h&&(h=i),r>l&&(l=r),n>c&&(c=n);return t[0]=s,t[1]=o,t[2]=a,t[3]=h,t[4]=l,t[5]=c,t},getPositionsCenter:_i},Ti=j(),xi=function(){var e=new Float32Array(16),t=new Float64Array(4),i=new Float64Array(4);return function(r,n,s){return void 0===s&&(s=e),t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=1,Te(r,t,i),De(r,i,s),s}}(),Mi={__proto__:null,createRTCViewMat:xi,worldToRTCPos:function(e,t,i){var r=Float32Array.from([e[0]])[0],n=e[0]-r,s=Float32Array.from([e[1]])[0],o=e[1]-s,a=Float32Array.from([e[2]])[0],h=e[2]-a;t[0]=r,t[1]=s,t[2]=a,i[0]=n,i[1]=o,i[2]=h},worldToRTCPositions:function(e,t,i,r){void 0===r&&(r=200);for(var n=_i(e,Ti),s=Math.round(n[0]/r)*r,o=Math.round(n[1]/r)*r,a=Math.round(n[2]/r)*r,h=0,l=e.length;h<l;h+=3)t[h+0]=e[h+0]-s,t[h+1]=e[h+1]-o,t[h+2]=e[h+2]-a;return i[0]=s,i[1]=o,i[2]=a,0!==i[0]||0!==i[1]||0!==i[2]},rtcToWorldPos:function(e,t,i){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i},getPlaneRTCPos:function(e,t,i,r){var n=M(t,i)+e;return C(ee(t,Ti),-n,r),r}},Oi=/*#__PURE__*/c("items"),ji=/*#__PURE__*/c("lastUniqueId"),Ri=/*#__PURE__*/function(){function e(e,t){Object.defineProperty(this,Oi,{writable:!0,value:void 0}),Object.defineProperty(this,ji,{writable:!0,value:void 0}),u(this,Oi)[Oi]=e||[],u(this,ji)[ji]=(t||0)+1}var t=e.prototype;return t.addItem=function(){var e;if(2===arguments.length){var t=arguments[0];if(e=arguments[1],u(this,Oi)[Oi][t])throw"ID clash: '"+t+"'";return u(this,Oi)[Oi][t]=e,t}for(e=arguments[0]||{};;){var i=u(this,ji)[ji]++;if(!u(this,Oi)[Oi][i])return u(this,Oi)[Oi][i]=e,i}},t.removeItem=function(e){var t=u(this,Oi)[Oi][e];return delete u(this,Oi)[Oi][e],t},e}(),Si=/*#__PURE__*/function(){function e(){this._head=void 0,this._headLength=void 0,this._tail=void 0,this._index=void 0,this._length=void 0,this._head=[],this._headLength=0,this._tail=[],this._index=0,this._length=0}var t=e.prototype;return t.shift=function(){if(this._index>=this._headLength){var e=this._head;if(e.length=0,this._head=this._tail,this._tail=e,this._index=0,this._headLength=this._head.length,!this._headLength)return}var t=this._head[this._index];return this._index<0?delete this._head[this._index++]:this._head[this._index++]=void 0,this._length--,t},t.push=function(e){return this._length++,this._tail.push(e),this},t.unshift=function(e){return this._head[--this._index]=e,this._length++,this},t.clear=function(){this._head=[],this._headLength=0,this._tail=[],this._index=0,this._length=0},r(e,[{key:"length",get:function(){return this._length}}]),e}();function Ai(e){return"string"==typeof e||e instanceof String}function Ci(e){return!isNaN(parseFloat(e))&&isFinite(e)}function ki(e,t){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}function Di(e){return Ci(e)?""+e:"'"+e+"'"}[["0",10],["A",26],["a",26],["_",1],["$",1]].map(function(e){for(var t=[],i=e[0].charCodeAt(0),r=i+e[1],n=i;n<r;++n)t.push(n);return String.fromCharCode.apply(null,t)}).join(""),function(){for(var e={},t=window.location.search.substring(1).split("&"),i=0;i<t.length;i++){var r=t[i].split("=");void 0===e[r[0]]?e[r[0]]=decodeURIComponent(r[1]):"string"==typeof e[r[0]]?e[r[0]]=[e[r[0]],decodeURIComponent(r[1])]:e[r[0]].push(decodeURIComponent(r[1]))}}();var Ii=function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&i]+e[i>>8&255]+"-"+e[i>>16&15|64]+e[i>>24&255]+"-"+e[63&r|128]+e[r>>8&255]+"-"+e[r>>16&255]+e[r>>24&255]+e[255&n]+e[n>>8&255]+e[n>>16&255]+e[n>>24&255]}}(),Bi=/*#__PURE__*/function(){function e(e,t,i){this.isLoading=void 0,this.itemsLoaded=void 0,this.itemsTotal=void 0,this.urlModifier=void 0,this.handlers=void 0,this.onStart=void 0,this.onLoad=void 0,this.onProgress=void 0,this.onError=void 0,this.isLoading=!1,this.itemsLoaded=0,this.itemsTotal=0,this.urlModifier=void 0,this.handlers=[],this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i}var t=e.prototype;return t.itemStart=function(e){this.itemsTotal++,!1===this.isLoading&&void 0!==this.onStart&&this.onStart(e,this.itemsLoaded,this.itemsTotal),this.isLoading=!0},t.itemEnd=function(e){this.itemsLoaded++,void 0!==this.onProgress&&this.onProgress(e,this.itemsLoaded,this.itemsTotal),this.itemsLoaded===this.itemsTotal&&(this.isLoading=!1,void 0!==this.onLoad&&this.onLoad())},t.itemError=function(e){void 0!==this.onError&&this.onError(e)},t.resolveURL=function(e){return this.urlModifier?this.urlModifier(e):e},t.setURLModifier=function(e){return this.urlModifier=e,this},t.addHandler=function(e,t){return this.handlers.push(e,t),this},t.removeHandler=function(e){var t=this.handlers.indexOf(e);return-1!==t&&this.handlers.splice(t,2),this},t.getHandler=function(e){for(var t=0,i=this.handlers.length;t<i;t+=2){var r=this.handlers[t],n=this.handlers[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return n}return null},e}(),Li=new Bi,Fi=/*#__PURE__*/function(){function e(e){this.manager=void 0,this.crossOrigin=void 0,this.withCredentials=void 0,this.path=void 0,this.resourcePath=void 0,this.requestHeader=void 0,this.manager=void 0!==e?e:Li,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}var t=e.prototype;return t.load=function(e,t,i,r){},t.loadAsync=function(e,t){var i=this;return new Promise(function(r,n){i.load(e,r,t,n)})},t.parse=function(){},t.setCrossOrigin=function(e){return this.crossOrigin=e,this},t.setWithCredentials=function(e){return this.withCredentials=e,this},t.setPath=function(e){return this.path=e,this},t.setResourcePath=function(e){return this.resourcePath=e,this},t.setRequestHeader=function(e){return this.requestHeader=e,this},e}(),Ui=/*#__PURE__*/function(){function e(e){void 0===e&&(e=4),this.pool=void 0,this.queue=void 0,this.workers=void 0,this.workersResolve=void 0,this.workerStatus=void 0,this.workerCreator=void 0,this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}var t=e.prototype;return t._initWorker=function(e){if(!this.workers[e]){var t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}},t._getIdleWorker=function(){for(var e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1},t._onMessage=function(e,t){var i=this.workersResolve[e];if(i&&i(t),this.queue.length){var r=this.queue.shift(),n=r.msg,s=r.transfer;this.workersResolve[e]=r.resolve,this.workers[e].postMessage(n,s)}else this.workerStatus^=1<<e},t.setWorkerCreator=function(e){this.workerCreator=e},t.setWorkerLimit=function(e){this.pool=e},t.postMessage=function(e,t){var i=this;return new Promise(function(r){var n=i._getIdleWorker();-1!==n?(i._initWorker(n),i.workerStatus|=1<<n,i.workersResolve[n]=r,i.workers[n].postMessage(e,t)):i.queue.push({resolve:r,msg:e,transfer:t})})},t.destroy=function(){this.workers.forEach(function(e){return e.terminate()}),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0},e}(),Ni={},Xi=/*#__PURE__*/function(e){function t(t){var i;return(i=e.call(this,t)||this).mimeType=void 0,i.responseType=void 0,i}n(t,e);var i=t.prototype;return i.load=function(e,t,i,r){var n=this;if(void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e),void 0===Ni[e]){Ni[e]=[],Ni[e].push({onLoad:t,onProgress:i,onError:r});var s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,a=this.responseType;fetch(s).then(function(t){if(200===t.status||0===t.status){if(0===t.status&&console.warn("FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body.getReader)return t;var i=Ni[e],r=t.body.getReader(),n=t.headers.get("Content-Length"),s=n?parseInt(n):0,o=0!==s,a=0,h=new ReadableStream({start:function(e){!function t(){r.read().then(function(r){var n=r.value;if(r.done)e.close();else{for(var h=new ProgressEvent("progress",{lengthComputable:o,loaded:a+=n.byteLength,total:s}),l=0,c=i.length;l<c;l++){var u=i[l];u.onProgress&&u.onProgress(h)}e.enqueue(n),t()}})}()}});return new Response(h)}throw Error('fetch for "'+t.url+'" responded with '+t.status+": "+t.statusText)}).then(function(e){switch(a){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(function(e){return(new DOMParser).parseFromString(e,o)});case"json":return e.json();default:if(void 0===o)return e.text();var t=/charset="?([^;"\s]*)"?/i.exec(o),i=t&&t[1]?t[1].toLowerCase():void 0,r=new TextDecoder(i);return e.arrayBuffer().then(function(e){return r.decode(e)})}}).then(function(t){var i=Ni[e];delete Ni[e];for(var r=0,n=i.length;r<n;r++){var s=i[r];s.onLoad&&s.onLoad(t)}}).catch(function(t){var i=Ni[e];if(void 0===i)throw n.manager.itemError(e),t;delete Ni[e];for(var r=0,s=i.length;r<s;r++){var o=i[r];o.onError&&o.onError(t)}n.manager.itemError(e)}).finally(function(){n.manager.itemEnd(e)}),this.manager.itemStart(e)}else Ni[e].push({onLoad:t,onProgress:i,onError:r})},i.setResponseType=function(e){return this.responseType=e,this},i.setMimeType=function(e){return this.mimeType=e,this},t}(Fi),Gi={" ":{width:16,points:[]},"!":{width:10,points:[[5,21],[5,7],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},'"':{width:16,points:[[4,21],[4,14],[-1,-1],[12,21],[12,14]]},"#":{width:21,points:[[11,25],[4,-7],[-1,-1],[17,25],[10,-7],[-1,-1],[4,12],[18,12],[-1,-1],[3,6],[17,6]]},$:{width:20,points:[[8,25],[8,-4],[-1,-1],[12,25],[12,-4],[-1,-1],[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},"%":{width:24,points:[[21,21],[3,0],[-1,-1],[8,21],[10,19],[10,17],[9,15],[7,14],[5,14],[3,16],[3,18],[4,20],[6,21],[8,21],[10,20],[13,19],[16,19],[19,20],[21,21],[-1,-1],[17,7],[15,6],[14,4],[14,2],[16,0],[18,0],[20,1],[21,3],[21,5],[19,7],[17,7]]},"&":{width:26,points:[[23,12],[23,13],[22,14],[21,14],[20,13],[19,11],[17,6],[15,3],[13,1],[11,0],[7,0],[5,1],[4,2],[3,4],[3,6],[4,8],[5,9],[12,13],[13,14],[14,16],[14,18],[13,20],[11,21],[9,20],[8,18],[8,16],[9,13],[11,10],[16,3],[18,1],[20,0],[22,0],[23,1],[23,2]]},"'":{width:10,points:[[5,19],[4,20],[5,21],[6,20],[6,18],[5,16],[4,15]]},"(":{width:14,points:[[11,25],[9,23],[7,20],[5,16],[4,11],[4,7],[5,2],[7,-2],[9,-5],[11,-7]]},")":{width:14,points:[[3,25],[5,23],[7,20],[9,16],[10,11],[10,7],[9,2],[7,-2],[5,-5],[3,-7]]},"*":{width:16,points:[[8,21],[8,9],[-1,-1],[3,18],[13,12],[-1,-1],[13,18],[3,12]]},"+":{width:26,points:[[13,18],[13,0],[-1,-1],[4,9],[22,9]]},",":{width:10,points:[[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"-":{width:26,points:[[4,9],[22,9]]},".":{width:10,points:[[5,2],[4,1],[5,0],[6,1],[5,2]]},"/":{width:22,points:[[20,25],[2,-7]]},0:{width:20,points:[[9,21],[6,20],[4,17],[3,12],[3,9],[4,4],[6,1],[9,0],[11,0],[14,1],[16,4],[17,9],[17,12],[16,17],[14,20],[11,21],[9,21]]},1:{width:20,points:[[6,17],[8,18],[11,21],[11,0]]},2:{width:20,points:[[4,16],[4,17],[5,19],[6,20],[8,21],[12,21],[14,20],[15,19],[16,17],[16,15],[15,13],[13,10],[3,0],[17,0]]},3:{width:20,points:[[5,21],[16,21],[10,13],[13,13],[15,12],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},4:{width:20,points:[[13,21],[3,7],[18,7],[-1,-1],[13,21],[13,0]]},5:{width:20,points:[[15,21],[5,21],[4,12],[5,13],[8,14],[11,14],[14,13],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},6:{width:20,points:[[16,18],[15,20],[12,21],[10,21],[7,20],[5,17],[4,12],[4,7],[5,3],[7,1],[10,0],[11,0],[14,1],[16,3],[17,6],[17,7],[16,10],[14,12],[11,13],[10,13],[7,12],[5,10],[4,7]]},7:{width:20,points:[[17,21],[7,0],[-1,-1],[3,21],[17,21]]},8:{width:20,points:[[8,21],[5,20],[4,18],[4,16],[5,14],[7,13],[11,12],[14,11],[16,9],[17,7],[17,4],[16,2],[15,1],[12,0],[8,0],[5,1],[4,2],[3,4],[3,7],[4,9],[6,11],[9,12],[13,13],[15,14],[16,16],[16,18],[15,20],[12,21],[8,21]]},9:{width:20,points:[[16,14],[15,11],[13,9],[10,8],[9,8],[6,9],[4,11],[3,14],[3,15],[4,18],[6,20],[9,21],[10,21],[13,20],[15,18],[16,14],[16,9],[15,4],[13,1],[10,0],[8,0],[5,1],[4,3]]},":":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},";":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"<":{width:24,points:[[20,18],[4,9],[20,0]]},"=":{width:26,points:[[4,12],[22,12],[-1,-1],[4,6],[22,6]]},">":{width:24,points:[[4,18],[20,9],[4,0]]},"?":{width:18,points:[[3,16],[3,17],[4,19],[5,20],[7,21],[11,21],[13,20],[14,19],[15,17],[15,15],[14,13],[13,12],[9,10],[9,7],[-1,-1],[9,2],[8,1],[9,0],[10,1],[9,2]]},"@":{width:27,points:[[18,13],[17,15],[15,16],[12,16],[10,15],[9,14],[8,11],[8,8],[9,6],[11,5],[14,5],[16,6],[17,8],[-1,-1],[12,16],[10,14],[9,11],[9,8],[10,6],[11,5],[-1,-1],[18,16],[17,8],[17,6],[19,5],[21,5],[23,7],[24,10],[24,12],[23,15],[22,17],[20,19],[18,20],[15,21],[12,21],[9,20],[7,19],[5,17],[4,15],[3,12],[3,9],[4,6],[5,4],[7,2],[9,1],[12,0],[15,0],[18,1],[20,2],[21,3],[-1,-1],[19,16],[18,8],[18,6],[19,5]]},A:{width:18,points:[[9,21],[1,0],[-1,-1],[9,21],[17,0],[-1,-1],[4,7],[14,7]]},B:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[-1,-1],[4,11],[13,11],[16,10],[17,9],[18,7],[18,4],[17,2],[16,1],[13,0],[4,0]]},C:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5]]},D:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[11,21],[14,20],[16,18],[17,16],[18,13],[18,8],[17,5],[16,3],[14,1],[11,0],[4,0]]},E:{width:19,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11],[-1,-1],[4,0],[17,0]]},F:{width:18,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11]]},G:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[18,8],[-1,-1],[13,8],[18,8]]},H:{width:22,points:[[4,21],[4,0],[-1,-1],[18,21],[18,0],[-1,-1],[4,11],[18,11]]},I:{width:8,points:[[4,21],[4,0]]},J:{width:16,points:[[12,21],[12,5],[11,2],[10,1],[8,0],[6,0],[4,1],[3,2],[2,5],[2,7]]},K:{width:21,points:[[4,21],[4,0],[-1,-1],[18,21],[4,7],[-1,-1],[9,12],[18,0]]},L:{width:17,points:[[4,21],[4,0],[-1,-1],[4,0],[16,0]]},M:{width:24,points:[[4,21],[4,0],[-1,-1],[4,21],[12,0],[-1,-1],[20,21],[12,0],[-1,-1],[20,21],[20,0]]},N:{width:22,points:[[4,21],[4,0],[-1,-1],[4,21],[18,0],[-1,-1],[18,21],[18,0]]},O:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21]]},P:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,14],[17,12],[16,11],[13,10],[4,10]]},Q:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21],[-1,-1],[12,4],[18,-2]]},R:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[4,11],[-1,-1],[11,11],[18,0]]},S:{width:20,points:[[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},T:{width:16,points:[[8,21],[8,0],[-1,-1],[1,21],[15,21]]},U:{width:22,points:[[4,21],[4,6],[5,3],[7,1],[10,0],[12,0],[15,1],[17,3],[18,6],[18,21]]},V:{width:18,points:[[1,21],[9,0],[-1,-1],[17,21],[9,0]]},W:{width:24,points:[[2,21],[7,0],[-1,-1],[12,21],[7,0],[-1,-1],[12,21],[17,0],[-1,-1],[22,21],[17,0]]},X:{width:20,points:[[3,21],[17,0],[-1,-1],[17,21],[3,0]]},Y:{width:18,points:[[1,21],[9,11],[9,0],[-1,-1],[17,21],[9,11]]},Z:{width:20,points:[[17,21],[3,0],[-1,-1],[3,21],[17,21],[-1,-1],[3,0],[17,0]]},"[":{width:14,points:[[4,25],[4,-7],[-1,-1],[5,25],[5,-7],[-1,-1],[4,25],[11,25],[-1,-1],[4,-7],[11,-7]]},"\\":{width:14,points:[[0,21],[14,-3]]},"]":{width:14,points:[[9,25],[9,-7],[-1,-1],[10,25],[10,-7],[-1,-1],[3,25],[10,25],[-1,-1],[3,-7],[10,-7]]},"^":{width:16,points:[[6,15],[8,18],[10,15],[-1,-1],[3,12],[8,17],[13,12],[-1,-1],[8,17],[8,0]]},_:{width:16,points:[[0,-2],[16,-2]]},"`":{width:10,points:[[6,21],[5,20],[4,18],[4,16],[5,15],[6,16],[5,17]]},a:{width:19,points:[[15,14],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},b:{width:19,points:[[4,21],[4,0],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},c:{width:18,points:[[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},d:{width:19,points:[[15,21],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},e:{width:18,points:[[3,8],[15,8],[15,10],[14,12],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},f:{width:12,points:[[10,21],[8,21],[6,20],[5,17],[5,0],[-1,-1],[2,14],[9,14]]},g:{width:19,points:[[15,14],[15,-2],[14,-5],[13,-6],[11,-7],[8,-7],[6,-6],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},h:{width:19,points:[[4,21],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},i:{width:8,points:[[3,21],[4,20],[5,21],[4,22],[3,21],[-1,-1],[4,14],[4,0]]},j:{width:10,points:[[5,21],[6,20],[7,21],[6,22],[5,21],[-1,-1],[6,14],[6,-3],[5,-6],[3,-7],[1,-7]]},k:{width:17,points:[[4,21],[4,0],[-1,-1],[14,14],[4,4],[-1,-1],[8,8],[15,0]]},l:{width:8,points:[[4,21],[4,0]]},m:{width:30,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0],[-1,-1],[15,10],[18,13],[20,14],[23,14],[25,13],[26,10],[26,0]]},n:{width:19,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},o:{width:19,points:[[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3],[16,6],[16,8],[15,11],[13,13],[11,14],[8,14]]},p:{width:19,points:[[4,14],[4,-7],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},q:{width:19,points:[[15,14],[15,-7],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},r:{width:13,points:[[4,14],[4,0],[-1,-1],[4,8],[5,11],[7,13],[9,14],[12,14]]},s:{width:17,points:[[14,11],[13,13],[10,14],[7,14],[4,13],[3,11],[4,9],[6,8],[11,7],[13,6],[14,4],[14,3],[13,1],[10,0],[7,0],[4,1],[3,3]]},t:{width:12,points:[[5,21],[5,4],[6,1],[8,0],[10,0],[-1,-1],[2,14],[9,14]]},u:{width:19,points:[[4,14],[4,4],[5,1],[7,0],[10,0],[12,1],[15,4],[-1,-1],[15,14],[15,0]]},v:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0]]},w:{width:22,points:[[3,14],[7,0],[-1,-1],[11,14],[7,0],[-1,-1],[11,14],[15,0],[-1,-1],[19,14],[15,0]]},x:{width:17,points:[[3,14],[14,0],[-1,-1],[14,14],[3,0]]},y:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0],[6,-4],[4,-6],[2,-7],[1,-7]]},z:{width:17,points:[[14,14],[3,0],[-1,-1],[3,14],[14,14],[-1,-1],[3,0],[14,0]]},"{":{width:14,points:[[9,25],[7,24],[6,23],[5,21],[5,19],[6,17],[7,16],[8,14],[8,12],[6,10],[-1,-1],[7,24],[6,22],[6,20],[7,18],[8,17],[9,15],[9,13],[8,11],[4,9],[8,7],[9,5],[9,3],[8,1],[7,0],[6,-2],[6,-4],[7,-6],[-1,-1],[6,8],[8,6],[8,4],[7,2],[6,1],[5,-1],[5,-3],[6,-5],[7,-6],[9,-7]]},"|":{width:8,points:[[4,25],[4,-7]]},"}":{width:14,points:[[5,25],[7,24],[8,23],[9,21],[9,19],[8,17],[7,16],[6,14],[6,12],[8,10],[-1,-1],[7,24],[8,22],[8,20],[7,18],[6,17],[5,15],[5,13],[6,11],[10,9],[6,7],[5,5],[5,3],[6,1],[7,0],[8,-2],[8,-4],[7,-6],[-1,-1],[8,8],[6,6],[6,4],[7,2],[8,1],[9,-1],[9,-3],[8,-5],[7,-6],[5,-7]]},"~":{width:24,points:[[3,6],[3,8],[4,11],[6,12],[8,12],[10,11],[14,8],[16,7],[18,7],[20,8],[21,10],[-1,-1],[3,8],[4,10],[6,11],[8,11],[10,10],[14,7],[16,6],[18,6],[20,7],[21,10],[21,12]]}},Vi={__proto__:null,buildBoxGeometry:function(e){void 0===e&&(e={center:[0,0,0],xSize:1,ySize:1,zSize:1});var t=e.xSize||1;t<0&&(console.error("negative xSize not allowed - will invert"),t*=-1);var i=e.ySize||1;i<0&&(console.error("negative ySize not allowed - will invert"),i*=-1);var r=e.zSize||1;r<0&&(console.error("negative zSize not allowed - will invert"),r*=-1);var n=e.center,s=n?n[0]:0,o=n?n[1]:0,a=n?n[2]:0,h=-t+s,l=-i+o,c=-r+a,u=t+s,d=i+o,v=r+a;return ki(e,{positions:[u,d,v,h,d,v,h,l,v,u,l,v,u,d,v,u,l,v,u,l,c,u,d,c,u,d,v,u,d,c,h,d,c,h,d,v,h,d,v,h,d,c,h,l,c,h,l,v,h,l,c,u,l,c,u,l,v,h,l,v,u,l,c,h,l,c,h,d,c,u,d,c],normals:[0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],uv:[1,0,0,0,0,1,1,1,0,0,0,1,1,1,1,0,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]})},buildBoxLinesGeometry:function(e){void 0===e&&(e={center:[0,0,0],xSize:1,ySize:1,zSize:1});var t=e.xSize||1;t<0&&(console.error("negative xSize not allowed - will invert"),t*=-1);var i=e.ySize||1;i<0&&(console.error("negative ySize not allowed - will invert"),i*=-1);var r=e.zSize||1;r<0&&(console.error("negative zSize not allowed - will invert"),r*=-1);var n=e.center,s=n?n[0]:0,o=n?n[1]:0,a=n?n[2]:0,h=-t+s,l=-i+o,c=-r+a,u=t+s,d=i+o,v=r+a;return ki(e,{primitive:"lines",positions:[h,l,c,h,l,v,h,d,c,h,d,v,u,l,c,u,l,v,u,d,c,u,d,v],indices:[0,1,1,3,3,2,2,0,4,5,5,7,7,6,6,4,0,4,1,5,2,6,3,7]})},buildCylinderGeometry:function(e){void 0===e&&(e={radiusTop:0,radiusBottom:0,height:0,radialSegments:0,heightSegments:0,openEnded:!1,center:[0,0,0]});var t=e.radiusTop||1;t<0&&(console.error("negative radiusTop not allowed - will invert"),t*=-1);var i=e.radiusBottom||1;i<0&&(console.error("negative radiusBottom not allowed - will invert"),i*=-1);var r=e.height||1;r<0&&(console.error("negative height not allowed - will invert"),r*=-1);var n=e.radialSegments||32;n<0&&(console.error("negative radialSegments not allowed - will invert"),n*=-1),n<3&&(n=3);var s=e.heightSegments||1;s<0&&(console.error("negative heightSegments not allowed - will invert"),s*=-1),s<1&&(s=1);var o,a,h,l,c,u,d,v,f,p,y,g=e.openEnded,b=e.center,w=b?b[0]:0,m=b?b[1]:0,P=b?b[2]:0,_=r/2,E=r/s,T=2*Math.PI/n,x=1/n,M=(t-i)/s,O=[],j=[],R=[],S=[],A=(90-180*Math.atan(r/(i-t))/Math.PI)/90;for(o=0;o<=s;o++)for(c=t-o*M,u=_-o*E,a=0;a<=n;a++)h=Math.sin(a*T),l=Math.cos(a*T),j.push(c*h),j.push(A),j.push(c*l),R.push(a*x),R.push(1*o/s),O.push(c*h+w),O.push(u+m),O.push(c*l+P);for(o=0;o<s;o++)for(a=0;a<=n;a++)v=(d=o*(n+1)+a)+n,S.push(d),S.push(v),S.push(v+1),S.push(d),S.push(v+1),S.push(d+1);if(!g&&t>0){for(f=O.length/3,j.push(0),j.push(1),j.push(0),R.push(.5),R.push(.5),O.push(0+w),O.push(_+m),O.push(0+P),a=0;a<=n;a++)h=Math.sin(a*T),l=Math.cos(a*T),p=.5*Math.sin(a*T)+.5,y=.5*Math.cos(a*T)+.5,j.push(t*h),j.push(1),j.push(t*l),R.push(p),R.push(y),O.push(t*h+w),O.push(_+m),O.push(t*l+P);for(a=0;a<n;a++)S.push(d=f+1+a),S.push(d+1),S.push(f)}if(!g&&i>0){for(f=O.length/3,j.push(0),j.push(-1),j.push(0),R.push(.5),R.push(.5),O.push(0+w),O.push(0-_+m),O.push(0+P),a=0;a<=n;a++)h=Math.sin(a*T),l=Math.cos(a*T),p=.5*Math.sin(a*T)+.5,y=.5*Math.cos(a*T)+.5,j.push(i*h),j.push(-1),j.push(i*l),R.push(p),R.push(y),O.push(i*h+w),O.push(0-_+m),O.push(i*l+P);for(a=0;a<n;a++)d=f+1+a,S.push(f),S.push(d+1),S.push(d)}return ki(e,{positions:O,normals:j,uv:R,indices:S})},buildGridGeometry:function(e){void 0===e&&(e={size:1,divisions:1});var t=e.size||1;t<0&&(console.error("negative size not allowed - will invert"),t*=-1);var i=e.divisions||1;i<0&&(console.error("negative divisions not allowed - will invert"),i*=-1),i<1&&(i=1);for(var r=(t=t||10)/(i=i||10),n=t/2,s=[],o=[],a=0,h=0,l=-n;h<=i;h++,l+=r)s.push(-n),s.push(0),s.push(l),s.push(n),s.push(0),s.push(l),s.push(l),s.push(0),s.push(-n),s.push(l),s.push(0),s.push(n),o.push(a++),o.push(a++),o.push(a++),o.push(a++);return ki(e,{primitive:"lines",positions:s,indices:o})},buildPlaneGeometry:function(e){void 0===e&&(e={xSize:0,zSize:0,xSegments:1,center:[0,0,0]});var t=e.xSize||1;t<0&&(console.error("negative xSize not allowed - will invert"),t*=-1);var i=e.zSize||1;i<0&&(console.error("negative zSize not allowed - will invert"),i*=-1);var r=e.xSegments||1;r<0&&(console.error("negative xSegments not allowed - will invert"),r*=-1),r<1&&(r=1);var n=e.xSegments||1;n<0&&(console.error("negative zSegments not allowed - will invert"),n*=-1),n<1&&(n=1);var s,o,a,h,l,c,u=e.center,d=u?u[0]:0,v=u?u[1]:0,f=u?u[2]:0,p=t/2,y=i/2,g=Math.floor(r)||1,b=Math.floor(n)||1,w=g+1,m=b+1,P=t/g,_=i/b,E=new Float32Array(w*m*3),T=new Float32Array(w*m*3),x=new Float32Array(w*m*2),M=0,O=0;for(s=0;s<m;s++){var j=s*_-y;for(o=0;o<w;o++)E[M]=o*P-p+d,E[M+1]=v,E[M+2]=-j+f,T[M+2]=-1,x[O]=o/g,x[O+1]=(b-s)/b,M+=3,O+=2}M=0;var R=new(E.length/3>65535?Uint32Array:Uint16Array)(g*b*6);for(s=0;s<b;s++)for(o=0;o<g;o++)a=o+w*s,h=o+w*(s+1),l=o+1+w*(s+1),R[M]=c=o+1+w*s,R[M+1]=h,R[M+2]=a,R[M+3]=c,R[M+4]=l,R[M+5]=h,M+=6;return ki(e,{positions:E,normals:T,uv:x,indices:R})},buildSphereGeometry:function(e){void 0===e&&(e={heightSegments:18,widthSegments:18,radius:1,center:[0,0,0]});var t=e.center?e.center[0]:0,i=e.center?e.center[1]:0,r=e.center?e.center[2]:0,n=e.radius||1;n<0&&(console.error("negative radius not allowed - will invert"),n*=-1);var s=e.heightSegments||18;s<0&&(console.error("negative heightSegments not allowed - will invert"),s*=-1),(s=Math.floor(s))<18&&(s=18);var o=e.widthSegments||18;o<0&&(console.error("negative widthSegments not allowed - will invert"),o*=-1),(o=Math.floor(o))<18&&(o=18);var a,h,l,c,u,d,v,f,p,y,g,b,w,m,P,_=[],E=[],T=[],x=[];for(a=0;a<=s;a++)for(l=a*Math.PI/s,c=Math.sin(l),u=Math.cos(l),h=0;h<=o;h++)d=2*h*Math.PI/o,v=Math.sin(d),f=Math.cos(d),y=u,g=v*c,b=1-h/o,w=a/s,E.push(p=f*c),E.push(y),E.push(g),T.push(b),T.push(w),_.push(t+n*p),_.push(i+n*y),_.push(r+n*g);for(a=0;a<s;a++)for(h=0;h<o;h++)P=(m=a*(o+1)+h)+o+1,x.push(m+1),x.push(P+1),x.push(P),x.push(m+1),x.push(P),x.push(m);return ki(e,{positions:_,normals:E,uv:T,indices:x})},buildTorusGeometry:function(e){void 0===e&&(e={radius:0,tube:0,radialSegments:0,tubeSegments:0,arc:0,center:[0,0,0]});var t=e.radius||1;t<0&&(console.error("negative radius not allowed - will invert"),t*=-1),t*=.5;var i=e.tube||.3;i<0&&(console.error("negative tube not allowed - will invert"),i*=-1);var r=e.radialSegments||32;r<0&&(console.error("negative radialSegments not allowed - will invert"),r*=-1),r<4&&(r=4);var n=e.tubeSegments||24;n<0&&(console.error("negative tubeSegments not allowed - will invert"),n*=-1),n<4&&(n=4);var s=e.arc||2*Math.PI;s<0&&(console.warn("negative arc not allowed - will invert"),s*=-1),s>360&&(s=360);var o,a,h,l,c,u,d,v,f,p,y,g,b=e.center,w=b?b[0]:0,m=b?b[1]:0,P=b?b[2]:0,_=[],E=[],T=[],x=[];for(v=0;v<=n;v++)for(d=0;d<=r;d++)o=d/r*s,a=.785398+v/n*Math.PI*2,w=t*Math.cos(o),m=t*Math.sin(o),h=(t+i*Math.cos(a))*Math.cos(o),l=(t+i*Math.cos(a))*Math.sin(o),c=i*Math.sin(a),_.push(h+w),_.push(l+m),_.push(c+P),T.push(1-d/r),T.push(v/n),u=ee(B([h,l,c],[w,m,P],[]),[]),E.push(u[0]),E.push(u[1]),E.push(u[2]);for(v=1;v<=n;v++)for(d=1;d<=r;d++)p=(r+1)*(v-1)+d-1,y=(r+1)*(v-1)+d,g=(r+1)*v+d,x.push(f=(r+1)*v+d-1),x.push(p),x.push(y),x.push(y),x.push(g),x.push(f);return ki(e,{positions:_,normals:E,uv:T,indices:x})},buildVectorTextGeometry:function(e){void 0===e&&(e={origin:[0,0,0],size:1,text:""});var t=e.origin||[0,0,0],i=t[0],r=t[1],n=t[2],s=e.size||1,o=[],a=[],h=e.text;Ci(h)&&(h=""+h);for(var l,c,u,d,v,f,p,y,g,b=(h||"").split("\n"),w=0,m=0,P=.04,_=0;_<b.length;_++){l=0,u=(c=b[_]).length;for(var E=0;E<u;E++)if(d=Gi[c.charAt(E)]){v=1,f=-1,p=-1,y=d.points.length;for(var T=0;T<y;T++)-1!==(g=d.points[T])[0]||-1!==g[1]?(o.push(l+g[0]*s*P+i),o.push(m+g[1]*s*P+r),o.push(0+n),-1===f?f=w:(-1===p||(f=p),p=w),w++,v?v=!1:(a.push(f),a.push(p))):v=1;l+=d.width*P*s}m-=35*P*s}return ki(e,{primitive:"lines",positions:o,indices:a})},buildEdgeIndices:Zt},Hi={__proto__:null,rays:st,rtc:Mi,compression:ci,geometry:Vi,boundaries:Ei,curves:{__proto__:null,tangentQuadraticBezier:function(e,t,i,r){return 2*(1-e)*(i-t)+2*e*(r-i)},tangentQuadraticBezier3:function(e,t,i,r,n){return-3*t*(1-e)*(1-e)+3*i*(1-e)*(1-e)-6*e*i*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*n},tangentSpline:function(e){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},catmullRomInterpolate:function(e,t,i,r,n){var s=.5*(i-e),o=.5*(r-t),a=n*n;return(2*t-2*i+s+o)*(n*a)+(-3*t+3*i-2*s-o)*a+s*n+t},b2p0:function(e,t){var i=1-e;return i*i*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,i,r){return this.b2p0(e,t)+this.b2p1(e,i)+this.b2p2(e,r)},b3p0:function(e,t){var i=1-e;return i*i*i*t},b3p1:function(e,t){var i=1-e;return 3*i*i*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,i,r,n){return this.b3p0(e,t)+this.b3p1(e,i)+this.b3p2(e,r)+this.b3p3(e,n)}},FloatArrayClass:m,MIN_DOUBLE:P,MAX_DOUBLE:_,DEGTORAD:E,RADTODEG:57.295779513,clamp:T,newFloatArray:x,dotVec3:M,vec2:O,vec3:j,vec4:R,negateVec3:function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},negateVec4:function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},addVec4:S,addVec4Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t,i[3]=e[3]+t,i},mulVec4Scalar:A,mulVec3Scalar:C,mulVec2Scalar:k,addVec3:D,addVec3Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t,i},subVec4:I,compareVec3:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},subVec3:B,subVec2:L,geometricMeanVec2:F,subVec4Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]-t,i[1]=e[1]-t,i[2]=e[2]-t,i[3]=e[3]-t,i},subScalarVec4:function(e,t,i){return i||(i=e),i[0]=t-e[0],i[1]=t-e[1],i[2]=t-e[2],i[3]=t-e[3],i},mulVec4:function(e,t,i){return i||(i=e),i[0]=e[0]*t[0],i[1]=e[1]*t[1],i[2]=e[2]*t[2],i[3]=e[3]*t[3],i},divVec3:function(e,t,i){return i||(i=e),i[0]=e[0]/t[0],i[1]=e[1]/t[1],i[2]=e[2]/t[2],i},divVec4:function(e,t,i){return i||(i=e),i[0]=e[0]/t[0],i[1]=e[1]/t[1],i[2]=e[2]/t[2],i[3]=e[3]/t[3],i},divScalarVec3:U,divVec3Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]/t,i[1]=e[1]/t,i[2]=e[2]/t,i},divVec4Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]/t,i[1]=e[1]/t,i[2]=e[2]/t,i[3]=e[3]/t,i},divScalarVec4:function(e,t,i){return i||(i=t),i[0]=e/t[0],i[1]=e/t[1],i[2]=e/t[2],i[3]=e/t[3],i},dotVec4:N,cross3Vec4:function(e,t){var i=e[0],r=e[1],n=e[2],s=t[0],o=t[1],a=t[2];return[r*a-n*o,n*s-i*a,i*o-r*s,0]},cross3Vec3:X,sqLenVec4:G,lenVec4:V,dotVec2:H,sqLenVec3:W,sqLenVec2:Y,lenVec3:z,distVec3:q,lenVec2:Z,lerpVec3:Q,distVec2:J,rcpVec3:function(e,t){return U(1,e,t)},normalizeVec4:$,normalizeVec3:ee,normalizeVec2:function(e,t){return k(e,1/Z(e),t)},angleVec3:function(e,t){var i=M(e,t)/Math.sqrt(W(e)*W(t));return i=i<-1?-1:i>1?1:i,Math.acos(i)},vec3FromMat4Scale:te,vecToArray:function(e){for(var t=0,i=(e=Array.prototype.slice.call(e)).length;t<i;t++)e[t]=ie(e[t]);return e},triangleNormal:function(e,t,i,r){void 0===r&&(r=j());var n=t[0]-e[0],s=t[1]-e[1],o=t[2]-e[2],a=i[0]-e[0],h=i[1]-e[1],l=i[2]-e[2],c=s*l-o*h,u=o*a-n*l,d=n*h-s*a,v=Math.sqrt(c*c+u*u+d*d);return 0===v?(r[0]=0,r[1]=0,r[2]=0):(r[0]=c/v,r[1]=u/v,r[2]=d/v),r},setFrustum:function(e,t,i){var r=we(i,t,qe),n=r[0],s=r[1],o=r[2],a=r[3],h=r[4],l=r[5],c=r[6],u=r[7],d=r[8],v=r[9],f=r[10],p=r[11],y=r[12],g=r[13],b=r[14],w=r[15];e.planes[0].set(a-n,u-h,p-d,w-y),e.planes[1].set(a+n,u+h,p+d,w+y),e.planes[2].set(a-s,u-l,p-v,w-g),e.planes[3].set(a+s,u+l,p+v,w+g),e.planes[4].set(a-o,u-c,p-f,w-b),e.planes[5].set(a+o,u+c,p+f,w+b)},frustumIntersectsAABB3:function(e,t){var i=Qe.INSIDE,r=ze,n=Ke;r[0]=t[0],r[1]=t[1],r[2]=t[2],n[0]=t[3],n[1]=t[4],n[2]=t[5];for(var s=[r,n],o=0;o<6;++o){var a=e.planes[o];if(a.normal[0]*s[a.testVertex[0]][0]+a.normal[1]*s[a.testVertex[1]][1]+a.normal[2]*s[a.testVertex[2]][2]+a.offset<0)return Qe.OUTSIDE;a.normal[0]*s[1-a.testVertex[0]][0]+a.normal[1]*s[1-a.testVertex[1]][1]+a.normal[2]*s[1-a.testVertex[2]][2]+a.offset<0&&(i=Qe.INTERSECT)}return i},mat3:ne,mat4:se,compareMat4:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},perspectiveMat4:he,frustumMat4v:le,orthoMat4c:ce,frustumMat4:ue,identityMat4:de,identityMat3:ve,isIdentityMat4:function(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]},rotationMat4v:fe,lookAtMat4v:pe,inverseMat4:ye,transposeMat4:ge,mulMat4v4:be,mulMat4:we,mulMat3:me,transformPoint3:Pe,transformPoint4:_e,transformPoints3:function(e,t,i){for(var r,n,s,o,a,h=i||[],l=t.length,c=e[0],u=e[1],d=e[2],v=e[3],f=e[4],p=e[5],y=e[6],g=e[7],b=e[8],w=e[9],m=e[10],P=e[11],_=e[12],E=e[13],T=e[14],x=e[15],M=0;M<l;++M)r=(o=t[M])[0],n=o[1],s=o[2],(a=h[M]||(h[M]=[0,0,0]))[0]=c*r+f*n+b*s+_,a[1]=u*r+p*n+w*s+E,a[2]=d*r+y*n+m*s+T,a[3]=v*r+g*n+P*s+x;return h.length=l,h},transformPositions3:function(e,t,i){var r;i||(i=t);var n,s,o,a=t.length,h=e[0],l=e[1],c=e[2],u=e[3],d=e[4],v=e[5],f=e[6],p=e[7],y=e[8],g=e[9],b=e[10],w=e[11],m=e[12],P=e[13],_=e[14],E=e[15];for(r=0;r<a;r+=3)i[r+0]=h*(n=t[r+0])+d*(s=t[r+1])+y*(o=t[r+2])+m,i[r+1]=l*n+v*s+g*o+P,i[r+2]=c*n+f*s+b*o+_,i[r+3]=u*n+p*s+w*o+E;return i},transformPositions4:function(e,t,i){var r;i||(i=t);var n,s,o,a=t.length,h=e[0],l=e[1],c=e[2],u=e[3],d=e[4],v=e[5],f=e[6],p=e[7],y=e[8],g=e[9],b=e[10],w=e[11],m=e[12],P=e[13],_=e[14],E=e[15];for(r=0;r<a;r+=4)i[r+0]=h*(n=t[r+0])+d*(s=t[r+1])+y*(o=t[r+2])+m,i[r+1]=l*n+v*s+g*o+P,i[r+2]=c*n+f*s+b*o+_,i[r+3]=u*n+p*s+w*o+E;return i},transformVec3:Ee,transformVec4:Te,scaleMat4v:xe,scalingMat4v:Me,scalingMat3v:Oe,scalingMat4c:Re,scaleMat4c:function(e,t,i,r){return r[0]*=e,r[4]*=t,r[8]*=i,r[1]*=e,r[5]*=t,r[9]*=i,r[2]*=e,r[6]*=t,r[10]*=i,r[3]*=e,r[7]*=t,r[11]*=i,r},scalingMat4s:function(e){return Re(e,e,e)},composeMat4:Se,decomposeMat4:Ae,translateMat4v:Ce,translateMat4c:ke,setMat4Translation:De,translationMat4v:Ie,translationMat3v:Be,translationMat4c:Le,translationMat4s:function(e,t){return Le(e,e,e,t)},determinantMat4:Fe,mat4ToEuler:Ue,lerpMat4:Ne,identityQuaternion:Xe,eulerToQuaternion:Ge,mat4ToQuaternion:Ve,vec3PairToQuaternion:function(e,t,i){void 0===i&&(i=R());var r=Math.sqrt(M(e,e)*M(t,t)),n=r+M(e,t);return n<1e-8*r?(n=0,Math.abs(e[0])>Math.abs(e[2])?(i[0]=-e[1],i[1]=e[0],i[2]=0):(i[0]=0,i[1]=-e[2],i[2]=e[1])):X(e,t,i),i[3]=n,We(i)},angleAxisToQuaternion:function(e,t){void 0===t&&(t=R());var i=e[3]/2,r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t},quaternionToEuler:function(e,t,i){return void 0===i&&(i=j()),He(e,oe),Ue(oe,t,i),i},mulQuaternions:function(e,t,i){void 0===i&&(i=R());var r=e[0],n=e[1],s=e[2],o=e[3],a=t[0],h=t[1],l=t[2],c=t[3];return i[0]=o*a+r*c+n*l-s*h,i[1]=o*h+n*c+s*a-r*l,i[2]=o*l+s*c+r*h-n*a,i[3]=o*c-r*a-n*h-s*l,i},vec3ApplyQuaternion:function(e,t,i){void 0===i&&(i=j());var r=t[0],n=t[1],s=t[2],o=e[0],a=e[1],h=e[2],l=e[3],c=l*r+a*s-h*n,u=l*n+h*r-o*s,d=l*s+o*n-a*r,v=-o*r-a*n-h*s;return i[0]=c*l+v*-o+u*-h-d*-a,i[1]=u*l+v*-a+d*-o-c*-h,i[2]=d*l+v*-h+c*-a-u*-o,i},quaternionToMat4:function(e,t){t=de(t);var i=e[0],r=e[1],n=e[2],s=e[3],o=2*i,a=2*r,h=2*n,l=o*s,c=a*s,u=h*s,d=o*i,v=a*i,f=h*i,p=a*r,y=h*r,g=h*n;return t[0]=1-(p+g),t[1]=v+u,t[2]=f-c,t[4]=v-u,t[5]=1-(d+g),t[6]=y+l,t[8]=f+c,t[9]=y-l,t[10]=1-(d+p),t},quaternionToRotationMat4:He,normalizeQuaternion:We,conjugateQuaternion:Ye,inverseQuaternion:function(e,t){return We(Ye(e,t))},quaternionToAngleAxis:function(e,t){void 0===t&&(t=R());var i=(e=We(e,re))[3],r=2*Math.acos(i),n=Math.sqrt(1-i*i);return n<.001?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n),t[3]=r,t}},Wi={viewerId:"",time:0,startTime:0,prevTime:0,deltaTime:0},Yi=/*#__PURE__*/c("viewersRenderInfo"),zi=/*#__PURE__*/c("viewerIDMap"),Ki=/*#__PURE__*/c("taskQueue"),qi=/*#__PURE__*/c("taskBudget"),Zi=/*#__PURE__*/c("lastTime"),Qi=/*#__PURE__*/c("elapsedTime"),Ji=/*#__PURE__*/c("runTasks"),$i=/*#__PURE__*/c("runTasksUntil"),er=/*#__PURE__*/c("fireTickEvents"),tr=/*#__PURE__*/c("renderViewers");function ir(e){u(this,$i)[$i](e+u(this,qi)[qi]),this.getNumTasks(),u(this,qi)}function rr(e){void 0===e&&(e=-1);for(var t=(new Date).getTime(),i=0;u(this,Ki)[Ki].length>0&&(e<0||t<e);){var r=u(this,Ki)[Ki].shift(),n=u(this,Ki)[Ki].shift();n?r.call(n):r(),t=(new Date).getTime(),i++}return i}function nr(e){for(var t in Wi.time=e,or.viewers)if(this.viewers.hasOwnProperty(t)){var i=this.viewers[t];Wi.viewerId=t,Wi.startTime=i.startTime,Wi.deltaTime=null!=Wi.prevTime?Wi.time-Wi.prevTime:0,i.onTick.dispatch(i,Wi)}Wi.prevTime=e}function sr(){for(var e in this.viewers)if(this.viewers.hasOwnProperty(e)){var t=this.viewers[e],i=u(this,Yi)[Yi][e];i||(i=u(this,Yi)[Yi][e]={}),t.render({})}}var or=new(/*#__PURE__*/function(){function e(){var e=this;Object.defineProperty(this,tr,{value:sr}),Object.defineProperty(this,er,{value:nr}),Object.defineProperty(this,$i,{value:rr}),Object.defineProperty(this,Ji,{value:ir}),this.viewers=void 0,Object.defineProperty(this,Yi,{writable:!0,value:{}}),Object.defineProperty(this,zi,{writable:!0,value:new Ri}),Object.defineProperty(this,Ki,{writable:!0,value:new Si}),Object.defineProperty(this,qi,{writable:!0,value:10}),Object.defineProperty(this,Zi,{writable:!0,value:0}),Object.defineProperty(this,Qi,{writable:!0,value:0}),this.viewers={},requestAnimationFrame(function t(){var i=Date.now();u(e,Zi)[Zi]>0&&(u(e,Qi)[Qi]=i-u(e,Zi)[Zi]),u(e,Ji)[Ji](i),u(e,er)[er](i),u(e,tr)[tr](),u(e,Zi)[Zi]=i,requestAnimationFrame(t)})}var t=e.prototype;return t.registerViewer=function(e){if(e.id){if(this.viewers[e.id])return void console.error("[ERROR] WebViewer "+Di(e.id)+" already exists")}else e.id=u(this,zi)[zi].addItem({});this.viewers[e.id]=e,u(this,Yi)[Yi][e.id]={}},t.deregisterViewer=function(e){this.viewers[e.id]&&(u(this,zi)[zi].removeItem(e.id),delete this.viewers[e.id],delete u(this,Yi)[Yi][e.id])},t.scheduleTask=function(e,t){u(this,Ki)[Ki].push(e),u(this,Ki)[Ki].push(t)},t.getNumTasks=function(){return u(this,Ki)[Ki].length},e}()),ar=/*#__PURE__*/c("owner"),hr=/*#__PURE__*/c("ownedComponents"),lr=/*#__PURE__*/c("prefixMessageWithID"),cr=/*#__PURE__*/c("own"),ur=/*#__PURE__*/function(){function t(i,r){if(void 0===r&&(r={}),Object.defineProperty(this,cr,{value:vr}),Object.defineProperty(this,lr,{value:dr}),this.viewer=void 0,this.id=void 0,this.destroyed=void 0,this.dirty=void 0,Object.defineProperty(this,ar,{writable:!0,value:void 0}),Object.defineProperty(this,hr,{writable:!0,value:void 0}),this.onDestroyed=void 0,this instanceof Vf)this.viewer=this,u(this,ar)[ar]=void 0;else{if(i instanceof Vf)this.viewer=i;else{if(!(i instanceof t))throw"Invalid Component constructor argument: 'owner' must be a Component";this.viewer=i.viewer}u(this,ar)[ar]=i}this.id=r.id||Ii(),this.destroyed=!1,u(this,hr)[hr]=null,this.dirty=!1,i&&u(i,cr)[cr](this),this.onDestroyed=new v(new e.EventDispatcher)}var i=t.prototype;return i.log=function(e){e="[LOG] "+u(this,lr)[lr](e),window.console.log(e)},i.warn=function(e){e="[WARN] "+u(this,lr)[lr](e),window.console.warn(e)},i.error=function(e){e="[ERROR] "+u(this,lr)[lr](e),window.console.error(e)},i.cleanIfDirty=function(){this.dirty&&(this.dirty=!1,this.clean())},i.clean=function(){},i.destroy=function(){if(!this.destroyed){if(this.onDestroyed.dispatch(this,null),this.onDestroyed.clear(),this.destroyed=!0,u(this,hr)[hr])for(var e in u(this,hr)[hr])u(this,hr)[hr].hasOwnProperty(e)&&(u(this,hr)[hr][e].destroy(),delete u(this,hr)[hr][e]);u(this,hr)[hr]=null,this.dirty=!1}},i.setDirty=function(){this.dirty||(or.scheduleTask(this.cleanIfDirty,this),this.dirty=!0)},t}();function dr(e){return" ["+this.constructor.name+' "'+Di(this.id)+'"]: '+e}function vr(e){var t=this;u(this,hr)[hr]||(u(this,hr)[hr]={}),u(this,hr)[hr][e.id]||(u(this,hr)[hr][e.id]=e),e.onDestroyed.one(function(){delete u(t,hr)[hr][e.id]})}var fr=/*#__PURE__*/function(){function e(e,t,i){this.id=void 0,this.tiles=void 0,this.origin=void 0,this.aabb=void 0,this.sceneModels=void 0,this.sceneObjects=void 0,this.useCount=void 0,this.id=t,this.tiles=e,this.aabb=yi(),this.origin=new Float64Array(i),this.useCount=0,this.sceneModels={},this.sceneObjects={}}var t=e.prototype;return t.registerSceneObject=function(e){var t=this,i=e.model;this.sceneModels[i.id]||i.onDestroyed.one(function(){delete t.sceneModels[i.id]})},t.release=function(){this.tiles.putTile(this)},e}(),pr=/*#__PURE__*/function(e){function t(t){var i;return(i=e.call(this,t)||this).scene=void 0,i.tiles=void 0,i.scene=t,i.tiles={},i}n(t,e);var i=t.prototype;return i.getTile=function(e){var t=e[0]+"-"+e[1]+"-"+e[2],i=this.tiles[t];return i||(i=new fr(this,t,e),this.tiles[t]=i),i.useCount++,i},i.putTile=function(e){e.useCount--,e.useCount<=0&&delete this.tiles[e.id]},t}(ur),yr=/*#__PURE__*/c("center"),gr=/*#__PURE__*/c("aabb"),br=/*#__PURE__*/c("aabbDirty"),wr=/*#__PURE__*/c("registerSceneObjects"),mr=/*#__PURE__*/c("deregisterSceneObjects"),Pr=/*#__PURE__*/function(t){function i(i,r){var n;return void 0===r&&(r={}),n=t.call(this,null,r)||this,Object.defineProperty(o(n),mr,{value:Er}),Object.defineProperty(o(n),wr,{value:_r}),n.tiles=void 0,n.models=void 0,n.objects=void 0,n.onModelCreated=void 0,n.onModelDestroyed=void 0,Object.defineProperty(o(n),yr,{writable:!0,value:void 0}),Object.defineProperty(o(n),gr,{writable:!0,value:void 0}),Object.defineProperty(o(n),br,{writable:!0,value:void 0}),u(o(n),yr)[yr]=j(),u(o(n),gr)[gr]=ui(),u(o(n),br)[br]=!0,n.viewer=i,n.tiles=new pr(o(n)),n.models={},n.objects={},n.onModelCreated=new v(new e.EventDispatcher),n.onModelDestroyed=new v(new e.EventDispatcher),n}n(i,t);var s=i.prototype;return s.createModel=function(e){var t=this;if(this.log("Creating SceneModel : "+e.id),0===this.viewer.viewList.length)throw"Please create a View with WebViewer.createView() before creating a SceneModel";if(e.id=e.id||Ii(),!this.models[e.id]){var i=this.viewer.renderer.createModel(e);return this.models[i.id]=i,i.onBuilt.one(function(){u(t,wr)[wr](i),t.onModelCreated.dispatch(t,i)}),i.onDestroyed.one(function(){delete t.models[i.id],u(t,mr)[mr](i),t.onModelDestroyed.dispatch(t,i)}),i}this.error('SceneModel with this ID already exists, or is under construction: "'+e.id+'"')},s.clear=function(){for(var e in this.models)this.models[e].destroy()},s.setAABBDirty=function(){u(this,br)[br]||(u(this,br)[br]=!0)},s.destroy=function(){for(var e in this.models)this.models.hasOwnProperty(e)&&this.models[e].destroy();t.prototype.destroy.call(this),this.onModelCreated.clear(),this.onModelDestroyed.clear()},r(i,[{key:"center",get:function(){if(u(this,br)[br]){var e=this.aabb;u(this,yr)[yr][0]=(e[0]+e[3])/2,u(this,yr)[yr][1]=(e[1]+e[4])/2,u(this,yr)[yr][2]=(e[2]+e[5])/2}return u(this,yr)[yr]}},{key:"aabb",get:function(){if(u(this,br)[br]){var e,t=_,i=_,r=_,n=P,s=P,o=P,a=this.objects,h=!1;for(var l in a)a.hasOwnProperty(l)&&((e=a[l].aabb)[0]<t&&(t=e[0]),e[1]<i&&(i=e[1]),e[2]<r&&(r=e[2]),e[3]>n&&(n=e[3]),e[4]>s&&(s=e[4]),e[5]>o&&(o=e[5]),h=!0);h||(t=-100,i=-100,r=-100,n=100,s=100,o=100),u(this,gr)[gr][0]=t,u(this,gr)[gr][1]=i,u(this,gr)[gr][2]=r,u(this,gr)[gr][3]=n,u(this,gr)[gr][4]=s,u(this,gr)[gr][5]=o,u(this,br)[br]=!1}return u(this,gr)[gr]}}]),i}(ur);function _r(e){var t=e.objects;for(var i in t){var r=t[i];this.objects[r.id]=r}u(this,br)[br]=!0}function Er(e){var t=e.objects;for(var i in t)delete this.objects[t[i].id];u(this,br)[br]=!0}var Tr=function(e,t){this.propertySet=void 0,this.name=void 0,this.value=void 0,this.type=void 0,this.valueType=void 0,this.description=void 0,this.propertySet=e,this.name=t.name,this.type=t.type,this.value=t.value,this.valueType=t.valueType,this.description=t.description},xr=/*#__PURE__*/function(){function e(e,t){if(this.dataModel=void 0,this.id=void 0,this.originalSystemId=void 0,this.name=void 0,this.type=void 0,this.properties=void 0,this.dataModel=e,this.id=t.id,this.originalSystemId=t.originalSystemId,this.name=t.name,this.type=t.type,this.properties=[],t.properties)for(var i=0,r=t.properties.length;i<r;i++)this.createProperty(t.properties[i])}return e.prototype.createProperty=function(e){var t=new Tr(this,e);return this.properties.push(t),t},e}(),Mr=function(e,t,i){this.type=void 0,this.relating=void 0,this.related=void 0,this.type=e,this.relating=t,this.related=i},Or=/*#__PURE__*/function(){function e(e,t,i,r,n){this.models=void 0,this.id=void 0,this.name=void 0,this.type=void 0,this.propertySets=void 0,this.relating=void 0,this.related=void 0,this.models=[e],this.id=t,this.name=i,this.type=r,this.propertySets=n||[],this.related={},this.relating={}}return e.prototype.createRelation=function(e,t){var i=this.models[0].data.objects[t];if(i){var r=new Mr(e,this,i);i.relating[e].push(r),this.related[e].push(r)}else console.error("[createRelation] DataObject not found: "+t)},e}(),jr=/*#__PURE__*/c("built"),Rr=/*#__PURE__*/c("destroyed"),Sr=/*#__PURE__*/c("removeFromModels"),Ar=/*#__PURE__*/function(t){function i(i,r,n,s){var a;if(a=t.call(this,i)||this,Object.defineProperty(o(a),Sr,{value:Cr}),a.data=void 0,a.projectId=void 0,a.revisionId=void 0,a.author=void 0,a.createdAt=void 0,a.creatingApplication=void 0,a.schema=void 0,a.propertySets=void 0,a.rootDataObject=void 0,a.objects=void 0,a.rootObjects=void 0,a.objectsByType=void 0,a.typeCounts=void 0,a.onBuilt=void 0,Object.defineProperty(o(a),jr,{writable:!0,value:void 0}),Object.defineProperty(o(a),Rr,{writable:!0,value:void 0}),a.data=i,a.id=r,a.projectId=n.projectId||"",a.revisionId=n.revisionId||"",a.author=n.author||"",a.createdAt=n.createdAt||"",a.creatingApplication=n.creatingApplication||"",a.schema=n.schema||"",a.propertySets={},a.objects={},a.objectsByType={},a.typeCounts={},a.rootDataObject=null,u(o(a),jr)[jr]=!1,u(o(a),Rr)[Rr]=!1,n.propertySets)for(var h=0,l=n.propertySets.length;h<l;h++)a.createPropertySet(n.propertySets[h]);if(n.objects)for(var c=0,d=n.objects.length;c<d;c++)a.createObject(n.objects[c]);return a.onBuilt=new v(new e.EventDispatcher),a}n(i,t);var r=i.prototype;return r.createPropertySet=function(e){if(u(this,Rr)[Rr])return null;var t=new xr(this,e);return this.propertySets[e.id]=t,t},r.createObject=function(e){if(u(this,Rr)[Rr])return null;var t=e.id,i=e.type,r=this.data.objects[t];if(r)this.objects[t]=r,this.objectsByType[i]||(this.objectsByType[i]={}),this.objectsByType[i][t]=r,this.typeCounts[i]=void 0===this.typeCounts[i]?1:this.typeCounts[i]+1,r.models.push(this);else{var n=[];if(e.propertySetIds)for(var s=0,o=e.propertySetIds.length;s<o;s++){var a=e.propertySetIds[s],h=this.propertySets[a];h?n.push(h):console.error('PropertySet not found: "'+a+'"')}if(r=new Or(this,t,e.name,e.type,n),this.data.objects[t]=r,this.data.objectsByType[i]||(this.data.objectsByType[i]={}),this.data.objectsByType[i][t]=r,this.data.typeCounts[i]=void 0===this.data.typeCounts[i]?1:this.data.typeCounts[i]+1,r.models.push(this),e.relations)for(var l in e.relations){r.relating[l]||(r.relating[l]=[]);for(var c=e.relations[l],d=0,v=c.length;d<v;d++){var f=c[d],p=this.data.objects[f];if(p){var y=new Mr(l,this,p);p.relating[l].push(y),r.related[l].push(y)}else this.error("[createObject] Can't create Relationship - DataObject not found: "+f)}}this.data.onObjectCreated.dispatch(this.data,r)}return r},r.createRelationship=function(e){var t=this.data.objects[e.relatingObjectId];if(t){var i=this.data.objects[e.relatedObjectId];if(i){var r=new Mr(e.relationType,t,i);i.relating[e.relationType].push(r),t.related[e.relationType].push(r)}else this.error("[createRelation] DataObject not found: "+e.relatedObjectId)}else this.error("[createRelation] DataObject not found: "+e.relatingObjectId)},r.build=function(){this.destroyed?this.log("DataModel already destroyed"):u(this,jr)[jr]?this.log("DataModel already built"):(u(this,jr)[jr]=!0,this.onBuilt.dispatch(this,null))},r.destroy=function(){if(!u(this,Rr)[Rr]){for(var e in this.objects){var i=this.objects[e];if(i.models.length>1)u(this,Sr)[Sr](i);else{delete this.data.objects[e];var r=i.type;if(0==--this.data.typeCounts[r])for(var n in delete this.data.typeCounts[r],delete this.data.objectsByType[r],this.data.onObjectDestroyed.dispatch(this.data,i),i.relating)for(var s=i.relating[n],o=0,a=s.length;o<a;o++)for(var h=s[o].related.relating[n],l=0,c=h.length;l<c;l++)h[0].relating===i&&(h[l]=h[l])}}u(this,Rr)[Rr]=!0,this.onBuilt.clear(),t.prototype.destroy.call(this)}},i}(ur);function Cr(e){for(var t=0,i=e.models.length;t<i;t++)if(e.models[t]===this){e.models=e.models.splice(t,1);break}}var kr=/*#__PURE__*/function(t){function i(i){var r;return(r=t.call(this,null,{})||this).onModelCreated=void 0,r.onModelDestroyed=void 0,r.onObjectCreated=void 0,r.onObjectDestroyed=void 0,r.models=void 0,r.propertySets=void 0,r.objects=void 0,r.rootObjects=void 0,r.objectsByType=void 0,r.typeCounts=void 0,r.viewer=i,r.models={},r.propertySets={},r.objects={},r.rootObjects={},r.objectsByType={},r.typeCounts={},r.onModelCreated=new v(new e.EventDispatcher),r.onModelDestroyed=new v(new e.EventDispatcher),r.onObjectCreated=new v(new e.EventDispatcher),r.onObjectDestroyed=new v(new e.EventDispatcher),r}n(i,t);var r=i.prototype;return r.createModel=function(e,t){var i=this,r=e.id||Ii();this.models[r]&&(this.error('DataModel with ID "'+r+'" already exists - will randomly-generate ID'),r=Ii());var n=new Ar(this,r,e,t);return this.models[n.id]=n,n.onDestroyed.one(function(){delete i.models[n.id],i.onModelDestroyed.dispatch(i,n)}),this.onModelCreated.dispatch(this,n),n},r.getObjectIdsByType=function(e){var t=this.objectsByType[e];return t?Object.keys(t):[]},r.searchDataObjects=function(e){var t=e.includeObjects&&e.includeObjects.length>0?Dr(e.includeObjects):null,i=e.excludeObjects&&e.excludeObjects.length>0?Dr(e.excludeObjects):null;function r(r){if(r){var n=!0;if((i&&i[r.type]||t&&!t[r.type])&&(n=!1),n)if(e.resultObjectIds)e.resultObjectIds.push(r.id);else if(e.resultObjects)e.resultObjects.push(r);else if(e.resultCallback&&e.resultCallback(r))return}}if(e.includeRelating&&e.includeRelating.length>0&&Dr(e.includeRelating),e.excludeRelating&&e.excludeRelating.length>0&&Dr(e.excludeRelating),e.startObjectId){var n=this.objects[e.startObjectId];n&&r(n)}else if(e.startObject)e.startObject&&r(e.startObject);else for(var s in this.rootObjects)r(this.rootObjects[s])},r.destroy=function(){this.onModelCreated.clear(),this.onModelDestroyed.clear(),t.prototype.destroy.call(this)},i}(ur);function Dr(e){for(var t={},i=0,r=e.length;i<r;i++)t[e[i]]=!0;return t}var Ir=/*#__PURE__*/c("state"),Br=/*#__PURE__*/c("inverseMatrixDirty"),Lr=/*#__PURE__*/c("transposedProjMatrixDirty"),Fr=/*#__PURE__*/c("onCanvasBoundary"),Ur=/*#__PURE__*/function(t){function i(i,r){var n;return void 0===r&&(r={}),(n=t.call(this,i,r)||this).camera=void 0,n.onProjMatrix=void 0,Object.defineProperty(o(n),Ir,{writable:!0,value:void 0}),Object.defineProperty(o(n),Br,{writable:!0,value:void 0}),Object.defineProperty(o(n),Lr,{writable:!0,value:void 0}),Object.defineProperty(o(n),Fr,{writable:!0,value:void 0}),n.camera=i,u(o(n),Ir)[Ir]={near:r.near||.1,far:r.far||2e3,fov:r.fov||60,fovAxis:r.fovAxis||"min",projMatrix:se(),inverseProjMatrix:se(),transposedProjMatrix:se()},u(o(n),Br)[Br]=!0,u(o(n),Lr)[Lr]=!0,u(o(n),Fr)[Fr]=n.camera.view.canvas.onBoundary.subscribe(function(){n.setDirty()}),n.onProjMatrix=new v(new e.EventDispatcher),n}n(i,t);var s=i.prototype;return s.clean=function(){var e=this.camera.view.canvas.boundary,t=e[2]/e[3],i=u(this,Ir)[Ir].fovAxis,r=u(this,Ir)[Ir].fov;("x"===i||"min"===i&&t<1||"max"===i&&t>1)&&(r/=t),he((r=Math.min(r,120))*(Math.PI/180),t,u(this,Ir)[Ir].near,u(this,Ir)[Ir].far,u(this,Ir)[Ir].projMatrix),u(this,Br)[Br]=!0,u(this,Lr)[Lr]=!0,this.camera.view.redraw(),this.onProjMatrix.dispatch(this,u(this,Ir)[Ir].projMatrix)},s.unproject=function(e,t,i,r,n){var s=this.camera.view.canvas.canvas,o=s.offsetWidth/2,a=s.offsetHeight/2;return i[0]=(e[0]-o)/o,i[1]=(e[1]-a)/a,i[2]=t,i[3]=1,be(this.inverseProjMatrix,i,r),C(r,1/r[3]),r[3]=1,r[1]*=-1,be(this.camera.inverseViewMatrix,r,n),n},s.destroy=function(){t.prototype.destroy.call(this),this.camera.view.canvas.onBoundary.unsubscribe(u(this,Fr)[Fr]),this.onProjMatrix.clear()},r(i,[{key:"fov",get:function(){return u(this,Ir)[Ir].fov},set:function(e){e!==u(this,Ir)[Ir].fov&&(u(this,Ir)[Ir].fov=e,this.setDirty())}},{key:"fovAxis",get:function(){return u(this,Ir)[Ir].fovAxis},set:function(e){e=e||"min",u(this,Ir)[Ir].fovAxis!==e&&("x"!==e&&"y"!==e&&"min"!==e&&(this.error("Unsupported value for 'fovAxis': "+e+" - defaulting to 'min'"),e="min"),u(this,Ir)[Ir].fovAxis=e,this.setDirty())}},{key:"near",get:function(){return u(this,Ir)[Ir].near},set:function(e){u(this,Ir)[Ir].near!==e&&(u(this,Ir)[Ir].near=e,this.setDirty())}},{key:"far",get:function(){return u(this,Ir)[Ir].far},set:function(e){u(this,Ir)[Ir].far!==e&&(u(this,Ir)[Ir].far=e,this.setDirty())}},{key:"projMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),u(this,Ir)[Ir].projMatrix}},{key:"inverseProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),u(this,Br)[Br]&&(ye(u(this,Ir)[Ir].projMatrix,u(this,Ir)[Ir].inverseProjMatrix),u(this,Br)[Br]=!1),u(this,Ir)[Ir].inverseProjMatrix}},{key:"transposedProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),u(this,Lr)[Lr]&&(ge(u(this,Ir)[Ir].projMatrix,u(this,Ir)[Ir].transposedProjMatrix),u(this,Lr)[Lr]=!1),u(this,Ir)[Ir].transposedProjMatrix}}]),i}(ur);Ur.type=Tt;var Nr=/*#__PURE__*/c("state"),Xr=/*#__PURE__*/c("inverseMatrixDirty"),Gr=/*#__PURE__*/c("transposedProjMatrixDirty"),Vr=/*#__PURE__*/c("onCanvasBoundary"),Hr=/*#__PURE__*/function(t){function i(i,r){var n;return void 0===r&&(r={}),(n=t.call(this,i,r)||this).camera=void 0,n.onProjMatrix=void 0,Object.defineProperty(o(n),Nr,{writable:!0,value:void 0}),Object.defineProperty(o(n),Xr,{writable:!0,value:void 0}),Object.defineProperty(o(n),Gr,{writable:!0,value:void 0}),Object.defineProperty(o(n),Vr,{writable:!0,value:void 0}),n.camera=i,u(o(n),Nr)[Nr]={near:r.near||.1,far:r.far||2e3,scale:r.scale||1,projMatrix:se(),inverseProjMatrix:se(),transposedProjMatrix:se()},n.onProjMatrix=new v(new e.EventDispatcher),u(o(n),Xr)[Xr]=!0,u(o(n),Gr)[Gr]=!0,u(o(n),Vr)[Vr]=n.camera.view.canvas.onBoundary.subscribe(function(){n.setDirty()}),n}n(i,t);var s=i.prototype;return s.clean=function(){var e,t,i,r,n=this.camera.view,s=.5*u(this,Nr)[Nr].scale,o=n.canvas.boundary,a=o[2],h=o[3],l=a/h;a>h?(e=-s,t=s,i=s/l,r=-s/l):(e=-s*l,t=s*l,i=s,r=-s),ce(e,t,r,i,u(this,Nr)[Nr].near,u(this,Nr)[Nr].far,u(this,Nr)[Nr].projMatrix),u(this,Xr)[Xr]=!0,u(this,Gr)[Gr]=!0,this.camera.view.redraw(),this.onProjMatrix.dispatch(this,u(this,Nr)[Nr].projMatrix)},s.unproject=function(e,t,i,r,n){var s=this.camera.view.canvas.canvas,o=s.offsetWidth/2,a=s.offsetHeight/2;return i[0]=(e[0]-o)/o,i[1]=(e[1]-a)/a,i[2]=t,i[3]=1,be(this.inverseProjMatrix,i,r),C(r,1/r[3]),r[3]=1,r[1]*=-1,be(this.camera.inverseViewMatrix,r,n),n},s.destroy=function(){t.prototype.destroy.call(this),this.camera.view.canvas.onBoundary.unsubscribe(u(this,Vr)[Vr]),this.onProjMatrix.clear()},r(i,[{key:"scale",get:function(){return u(this,Nr)[Nr].scale},set:function(e){e<=0&&(e=.01),u(this,Nr)[Nr].scale=e,this.setDirty()}},{key:"near",get:function(){return u(this,Nr)[Nr].near},set:function(e){u(this,Nr)[Nr].near!==e&&(u(this,Nr)[Nr].near=e,this.setDirty())}},{key:"far",get:function(){return u(this,Nr)[Nr].far},set:function(e){u(this,Nr)[Nr].far!==e&&(u(this,Nr)[Nr].far=e,this.setDirty())}},{key:"projMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),u(this,Nr)[Nr].projMatrix}},{key:"inverseProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),u(this,Xr)[Xr]&&(ye(u(this,Nr)[Nr].projMatrix,u(this,Nr)[Nr].inverseProjMatrix),u(this,Xr)[Xr]=!1),u(this,Nr)[Nr].inverseProjMatrix}},{key:"transposedProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),u(this,Gr)[Gr]&&(ge(u(this,Nr)[Nr].projMatrix,u(this,Nr)[Nr].transposedProjMatrix),u(this,Gr)[Gr]=!1),u(this,Nr)[Nr].transposedProjMatrix}}]),i}(ur);Hr.type=xt;var Wr=/*#__PURE__*/c("state"),Yr=/*#__PURE__*/c("inverseMatrixDirty"),zr=/*#__PURE__*/c("transposedProjMatrixDirty"),Kr=/*#__PURE__*/function(t){function i(i,r){var n;return void 0===r&&(r={}),(n=t.call(this,i,r)||this).camera=void 0,n.onProjMatrix=void 0,Object.defineProperty(o(n),Wr,{writable:!0,value:void 0}),Object.defineProperty(o(n),Yr,{writable:!0,value:void 0}),Object.defineProperty(o(n),zr,{writable:!0,value:void 0}),n.camera=i,u(o(n),Wr)[Wr]={projMatrix:se(),inverseProjMatrix:se(),transposedProjMatrix:se(),near:.1,far:1e4,left:null!=r.left?r.left:-1,right:null!=r.right?r.right:1,bottom:null!=r.bottom?r.bottom:-1,top:null!=r.top?r.top:1},n.onProjMatrix=new v(new e.EventDispatcher),u(o(n),Yr)[Yr]=!0,u(o(n),zr)[zr]=!0,n}n(i,t);var s=i.prototype;return s.clean=function(){ue(u(this,Wr)[Wr].left,u(this,Wr)[Wr].right,u(this,Wr)[Wr].bottom,u(this,Wr)[Wr].top,u(this,Wr)[Wr].near,u(this,Wr)[Wr].far,u(this,Wr)[Wr].projMatrix),u(this,Yr)[Yr]=!0,u(this,zr)[zr]=!0,this.camera.view.redraw(),this.onProjMatrix.dispatch(this,u(this,Wr)[Wr].projMatrix)},s.unproject=function(e,t,i,r,n){var s=this.camera.view.canvas.canvas,o=s.offsetWidth/2,a=s.offsetHeight/2;return i[0]=(e[0]-o)/o,i[1]=(e[1]-a)/a,i[2]=t,i[3]=1,be(this.inverseProjMatrix,i,r),C(r,1/r[3]),r[3]=1,r[1]*=-1,be(this.camera.inverseViewMatrix,r,n),n},s.destroy=function(){t.prototype.destroy.call(this),this.onProjMatrix.clear()},r(i,[{key:"left",get:function(){return u(this,Wr)[Wr].left},set:function(e){u(this,Wr)[Wr].left=e,this.setDirty()}},{key:"right",get:function(){return u(this,Wr)[Wr].right},set:function(e){u(this,Wr)[Wr].right=e,this.setDirty()}},{key:"top",get:function(){return u(this,Wr)[Wr].top},set:function(e){u(this,Wr)[Wr].top=e,this.setDirty()}},{key:"bottom",get:function(){return u(this,Wr)[Wr].bottom},set:function(e){u(this,Wr)[Wr].bottom=e,this.setDirty()}},{key:"near",get:function(){return u(this,Wr)[Wr].near},set:function(e){u(this,Wr)[Wr].near=e,this.setDirty()}},{key:"far",get:function(){return u(this,Wr)[Wr].far},set:function(e){u(this,Wr)[Wr].far=e,this.setDirty()}},{key:"projMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),u(this,Wr)[Wr].projMatrix}},{key:"inverseProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),u(this,Yr)[Yr]&&(ye(u(this,Wr)[Wr].projMatrix,u(this,Wr)[Wr].inverseProjMatrix),u(this,Yr)[Yr]=!1),u(this,Wr)[Wr].inverseProjMatrix}},{key:"transposedProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),u(this,zr)[zr]&&(ge(u(this,Wr)[Wr].projMatrix,u(this,Wr)[Wr].transposedProjMatrix),u(this,zr)[zr]=!1),u(this,Wr)[Wr].transposedProjMatrix}}]),i}(ur);Kr.type=Mt;var qr=/*#__PURE__*/c("state"),Zr=/*#__PURE__*/c("inverseProjMatrixDirty"),Qr=/*#__PURE__*/c("transposedProjMatrixDirty"),Jr=/*#__PURE__*/function(t){function i(i,r){var n;return void 0===r&&(r={}),(n=t.call(this,i,r)||this).camera=void 0,n.onProjMatrix=void 0,Object.defineProperty(o(n),qr,{writable:!0,value:void 0}),Object.defineProperty(o(n),Zr,{writable:!0,value:void 0}),Object.defineProperty(o(n),Qr,{writable:!0,value:void 0}),n.camera=i,u(o(n),qr)[qr]={projMatrix:se(r.projMatrix||de()),inverseProjMatrix:se(),transposedProjMatrix:se()},n.onProjMatrix=new v(new e.EventDispatcher),u(o(n),Zr)[Zr]=!0,u(o(n),Qr)[Qr]=!1,n}n(i,t);var s=i.prototype;return s.unproject=function(e,t,i,r,n){var s=this.camera.view.canvas.canvas,o=s.offsetWidth/2,a=s.offsetHeight/2;return i[0]=(e[0]-o)/o,i[1]=(e[1]-a)/a,i[2]=t,i[3]=1,be(this.inverseProjMatrix,i,r),C(r,1/r[3]),r[3]=1,r[1]*=-1,be(this.camera.inverseViewMatrix,r,n),n},s.destroy=function(){t.prototype.destroy.call(this),this.onProjMatrix.clear()},r(i,[{key:"projMatrix",get:function(){return u(this,qr)[qr].projMatrix},set:function(e){u(this,qr)[qr].projMatrix.set(e),u(this,Zr)[Zr]=!0,u(this,Qr)[Qr]=!0,this.setDirty(),this.camera.view.redraw(),this.onProjMatrix.dispatch(this,u(this,qr)[qr].projMatrix)}},{key:"inverseProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),u(this,Zr)[Zr]&&(ye(u(this,qr)[qr].projMatrix,u(this,qr)[qr].inverseProjMatrix),u(this,Zr)[Zr]=!1),u(this,qr)[qr].inverseProjMatrix}},{key:"transposedProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),u(this,Qr)[Qr]&&(ge(u(this,qr)[qr].projMatrix,u(this,qr)[qr].transposedProjMatrix),u(this,Qr)[Qr]=!1),u(this,qr)[qr].transposedProjMatrix}}]),i}(ur);Jr.type=Ot;var $r=/*#__PURE__*/c("viewMatrix"),en=/*#__PURE__*/function(){function e(e,t,i){this.id=void 0,this.camera=void 0,this.origin=void 0,this.useCount=void 0,this.dirty=void 0,Object.defineProperty(this,$r,{writable:!0,value:void 0}),this.camera=e,this.id=t,this.origin=new Float64Array(i),u(this,$r)[$r]=se(),this.useCount=0,this.dirty=!0}return e.prototype.release=function(){this.camera.putRTCViewMat(this)},r(e,[{key:"viewMatrix",get:function(){return this.dirty&&(xi(this.camera.viewMatrix,this.origin,u(this,$r)[$r]),this.dirty=!1),u(this,$r)[$r]}}]),e}(),tn=j(),rn=j(),nn=j(),sn=j(),on=j(),an=j(),hn=se(),ln=se(),cn=j(),un=j(),dn=j(),vn=j(),fn=/*#__PURE__*/c("state"),pn=/*#__PURE__*/c("activeProjection"),yn=/*#__PURE__*/c("invalidateRTCViewMatrices"),gn=/*#__PURE__*/function(t){function i(i,r){var n;return void 0===r&&(r={}),n=t.call(this,i,r)||this,Object.defineProperty(o(n),yn,{value:bn}),n.view=void 0,Object.defineProperty(o(n),fn,{writable:!0,value:void 0}),n.perspective=void 0,n.ortho=void 0,n.frustum=void 0,n.customProjection=void 0,Object.defineProperty(o(n),pn,{writable:!0,value:void 0}),n.rtcViewMats=void 0,n.onProjType=void 0,n.onViewMatrix=void 0,n.onProjMatrix=void 0,n.onWorldAxis=void 0,n.onProjType=new v(new e.EventDispatcher),n.onViewMatrix=new v(new e.EventDispatcher),n.onProjMatrix=new v(new e.EventDispatcher),n.onWorldAxis=new v(new e.EventDispatcher),n.view=i,u(o(n),fn)[fn]={eye:j(r.eye||[0,0,10]),look:j(r.look||[0,0,0]),up:j(r.up||[0,1,0]),worldUp:j([0,1,0]),worldRight:j([1,0,0]),worldForward:j([0,0,-1]),worldAxis:new Float32Array(r.worldAxis||[1,0,0,0,1,0,0,0,1]),gimbalLock:!1!==r.gimbalLock,constrainPitch:!0===r.constrainPitch,projectionType:r.projectionType||Tt,deviceMatrix:r.deviceMatrix?se(r.deviceMatrix):de(),hasDeviceMatrix:!!r.deviceMatrix,viewMatrix:se(),viewNormalMatrix:se(),inverseViewMatrix:se()},n.rtcViewMats={},n.perspective=new Ur(o(n)),n.ortho=new Hr(o(n)),n.frustum=new Kr(o(n)),n.customProjection=new Jr(o(n)),u(o(n),pn)[pn]=n.perspective,n.perspective.onProjMatrix.subscribe(function(){u(o(n),fn)[fn].projectionType===Tt&&n.onProjMatrix.dispatch(o(n),n.perspective.projMatrix)}),n.ortho.onProjMatrix.subscribe(function(){u(o(n),fn)[fn].projectionType===xt&&n.onProjMatrix.dispatch(o(n),n.ortho.projMatrix)}),n.frustum.onProjMatrix.subscribe(function(){u(o(n),fn)[fn].projectionType===Mt&&n.onProjMatrix.dispatch(o(n),n.frustum.projMatrix)}),n.customProjection.onProjMatrix.subscribe(function(){u(o(n),fn)[fn].projectionType===Ot&&n.onProjMatrix.dispatch(o(n),n.customProjection.projMatrix)}),n}n(i,t);var s=i.prototype;return s.clean=function(){var e,t=u(this,fn)[fn];this.projection===xt?(B(u(this,fn)[fn].eye,u(this,fn)[fn].look,cn),ee(cn,un),C(un,1e3,dn),D(u(this,fn)[fn].look,dn,vn),e=vn):e=u(this,fn)[fn].eye,t.hasDeviceMatrix?(pe(e,u(this,fn)[fn].look,u(this,fn)[fn].up,ln),we(t.deviceMatrix,ln,t.viewMatrix)):pe(e,u(this,fn)[fn].look,u(this,fn)[fn].up,t.viewMatrix),ye(u(this,fn)[fn].viewMatrix,u(this,fn)[fn].inverseViewMatrix),ge(u(this,fn)[fn].inverseViewMatrix,u(this,fn)[fn].viewNormalMatrix),u(this,yn)[yn](),this.view.redraw(),this.onViewMatrix.dispatch(this,u(this,fn)[fn].viewMatrix)},s.orbitYaw=function(e){var t=B(u(this,fn)[fn].eye,u(this,fn)[fn].look,tn);fe(.0174532925*e,u(this,fn)[fn].gimbalLock?u(this,fn)[fn].worldUp:u(this,fn)[fn].up,hn),t=Pe(hn,t,rn),this.eye=D(u(this,fn)[fn].look,t,nn),this.up=Pe(hn,u(this,fn)[fn].up,sn)},s.orbitPitch=function(e){if(!(u(this,fn)[fn].constrainPitch&&(e=M(u(this,fn)[fn].up,u(this,fn)[fn].worldUp)/E)<1)){var t=B(u(this,fn)[fn].eye,u(this,fn)[fn].look,tn);fe(.0174532925*e,X(ee(t,rn),ee(u(this,fn)[fn].up,nn)),hn),t=Pe(hn,t,sn),this.up=Pe(hn,u(this,fn)[fn].up,on),this.eye=D(t,u(this,fn)[fn].look,an)}},s.yaw=function(e){var t=B(u(this,fn)[fn].look,u(this,fn)[fn].eye,tn);fe(.0174532925*e,u(this,fn)[fn].gimbalLock?u(this,fn)[fn].worldUp:u(this,fn)[fn].up,hn),t=Pe(hn,t,rn),this.look=D(t,u(this,fn)[fn].eye,nn),u(this,fn)[fn].gimbalLock&&(this.up=Pe(hn,u(this,fn)[fn].up,sn))},s.pitch=function(e){if(!(u(this,fn)[fn].constrainPitch&&(e=M(u(this,fn)[fn].up,u(this,fn)[fn].worldUp)/E)<1)){var t=B(u(this,fn)[fn].look,u(this,fn)[fn].eye,tn);fe(.0174532925*e,X(ee(t,rn),ee(u(this,fn)[fn].up,nn)),hn),this.up=Pe(hn,u(this,fn)[fn].up,an),t=Pe(hn,t,sn),this.look=D(t,u(this,fn)[fn].eye,on)}},s.pan=function(e){var t,i=B(u(this,fn)[fn].eye,u(this,fn)[fn].look,tn),r=[0,0,0];0!==e[0]&&(t=C(X(ee(i,[]),ee(u(this,fn)[fn].up,rn)),e[0]),r[0]+=t[0],r[1]+=t[1],r[2]+=t[2]),0!==e[1]&&(t=C(ee(u(this,fn)[fn].up,nn),e[1]),r[0]+=t[0],r[1]+=t[1],r[2]+=t[2]),0!==e[2]&&(t=C(ee(i,sn),e[2]),r[0]+=t[0],r[1]+=t[1],r[2]+=t[2]),this.eye=D(u(this,fn)[fn].eye,r,on),this.look=D(u(this,fn)[fn].look,r,an)},s.zoom=function(e){var t=B(u(this,fn)[fn].eye,u(this,fn)[fn].look,tn),i=Math.abs(z(t)),r=Math.abs(i+e);if(!(r<.5)){var n=ee(t,nn);this.eye=D(u(this,fn)[fn].look,C(n,r),sn)}},s.getRTCViewMat=function(e){var t=e[0]+"_"+e[1]+"_"+e[2],i=this.rtcViewMats[t];return i||(i=new en(this,t,e),this.rtcViewMats[t]=i),i.useCount++,i},s.putRTCViewMat=function(e){e.useCount--,e.useCount<=0&&delete this.rtcViewMats[e.id]},s.destroy=function(){t.prototype.destroy.call(this),this.onProjType.clear(),this.onViewMatrix.clear(),this.onProjMatrix.clear(),this.onWorldAxis.clear()},r(i,[{key:"project",get:function(){return u(this,pn)[pn]}},{key:"eye",get:function(){return u(this,fn)[fn].eye},set:function(e){u(this,fn)[fn].eye.set(e),this.setDirty()}},{key:"look",get:function(){return u(this,fn)[fn].look},set:function(e){u(this,fn)[fn].look.set(e),this.setDirty()}},{key:"up",get:function(){return u(this,fn)[fn].up},set:function(e){u(this,fn)[fn].up.set(e),this.setDirty()}},{key:"worldUp",get:function(){return u(this,fn)[fn].worldUp}},{key:"worldRight",get:function(){return u(this,fn)[fn].worldRight}},{key:"worldForward",get:function(){return u(this,fn)[fn].worldForward}},{key:"constrainPitch",get:function(){return u(this,fn)[fn].constrainPitch},set:function(e){u(this,fn)[fn].constrainPitch=e}},{key:"gimbalLock",get:function(){return u(this,fn)[fn].gimbalLock},set:function(e){u(this,fn)[fn].gimbalLock=e}},{key:"worldAxis",get:function(){return u(this,fn)[fn].worldAxis},set:function(e){var t=u(this,fn)[fn];t.worldAxis.set(e),t.worldRight[0]=t.worldAxis[0],t.worldRight[1]=t.worldAxis[1],t.worldRight[2]=t.worldAxis[2],t.worldUp[0]=t.worldAxis[3],t.worldUp[1]=t.worldAxis[4],t.worldUp[2]=t.worldAxis[5],t.worldForward[0]=t.worldAxis[6],t.worldForward[1]=t.worldAxis[7],t.worldForward[2]=t.worldAxis[8],this.onWorldAxis.dispatch(this,t.worldAxis)}},{key:"deviceMatrix",get:function(){return u(this,fn)[fn].deviceMatrix},set:function(e){u(this,fn)[fn].deviceMatrix.set(e||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),u(this,fn)[fn].hasDeviceMatrix=!!e,this.setDirty()}},{key:"xUp",get:function(){return u(this,fn)[fn].worldUp[0]>u(this,fn)[fn].worldUp[1]&&u(this,fn)[fn].worldUp[0]>u(this,fn)[fn].worldUp[2]}},{key:"yUp",get:function(){return u(this,fn)[fn].worldUp[1]>u(this,fn)[fn].worldUp[0]&&u(this,fn)[fn].worldUp[1]>u(this,fn)[fn].worldUp[2]}},{key:"zUp",get:function(){return u(this,fn)[fn].worldUp[2]>u(this,fn)[fn].worldUp[0]&&u(this,fn)[fn].worldUp[2]>u(this,fn)[fn].worldUp[1]}},{key:"eyeLookDist",get:function(){return z(B(u(this,fn)[fn].look,u(this,fn)[fn].eye,tn))}},{key:"viewMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),u(this,fn)[fn].viewMatrix}},{key:"viewNormalMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),u(this,fn)[fn].viewNormalMatrix}},{key:"inverseViewMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),u(this,fn)[fn].inverseViewMatrix}},{key:"projMatrix",get:function(){return this[this.projection].projMatrix}},{key:"projection",get:function(){return u(this,fn)[fn].projectionType},set:function(e){e=e||Tt,u(this,fn)[fn].projectionType!==e&&(e===Tt?u(this,pn)[pn]=this.perspective:e===xt?u(this,pn)[pn]=this.ortho:e===Mt?u(this,pn)[pn]=this.frustum:e===Ot?u(this,pn)[pn]=this.customProjection:(this.error("Unsupported value for 'projection': "+e+" defaulting to PerspectiveProjectionType"),u(this,pn)[pn]=this.perspective,e=Tt),u(this,pn)[pn].clean(),u(this,fn)[fn].projectionType=e,this.view.redraw(),this.clean(),this.onProjType.dispatch(this,u(this,fn)[fn].projectionType),this.onProjMatrix.dispatch(this,u(this,pn)[pn].projMatrix))}}]),i}(ur);function bn(){Object.values(this.rtcViewMats).forEach(function(e){e.dirty=!0})}var wn=j(),mn=j(),Pn=j(),_n=j(),En=j(),Tn=/*#__PURE__*/c("duration"),xn=/*#__PURE__*/c("look1"),Mn=/*#__PURE__*/c("eye1"),On=/*#__PURE__*/c("up1"),jn=/*#__PURE__*/c("look2"),Rn=/*#__PURE__*/c("eye2"),Sn=/*#__PURE__*/c("up2"),An=/*#__PURE__*/c("orthoScale1"),Cn=/*#__PURE__*/c("orthoScale2"),kn=/*#__PURE__*/c("fit"),Dn=/*#__PURE__*/c("trail"),In=/*#__PURE__*/c("flying"),Bn=/*#__PURE__*/c("flyEyeLookUp"),Ln=/*#__PURE__*/c("flyingEye"),Fn=/*#__PURE__*/c("flyingLook"),Un=/*#__PURE__*/c("callback"),Nn=/*#__PURE__*/c("callbackScope"),Xn=/*#__PURE__*/c("time1"),Gn=/*#__PURE__*/c("time2"),Vn=/*#__PURE__*/c("flyingEyeLookUp"),Hn=/*#__PURE__*/c("fitFOV"),Wn=/*#__PURE__*/c("projection2"),Yn=/*#__PURE__*/c("projMatrix1"),zn=/*#__PURE__*/c("projMatrix2"),Kn=/*#__PURE__*/c("jumpTo"),qn=/*#__PURE__*/c("update"),Zn=/*#__PURE__*/c("ease"),Qn=/*#__PURE__*/c("easeInCubic"),Jn=/*#__PURE__*/c("easeOutExpo"),$n=/*#__PURE__*/function(t){function i(i,r){var n;return n=t.call(this,i,r)||this,Object.defineProperty(o(n),qn,{value:ts}),Object.defineProperty(o(n),Kn,{value:es}),n.view=void 0,n.camera=void 0,Object.defineProperty(o(n),Tn,{writable:!0,value:void 0}),Object.defineProperty(o(n),xn,{writable:!0,value:void 0}),Object.defineProperty(o(n),Mn,{writable:!0,value:void 0}),Object.defineProperty(o(n),On,{writable:!0,value:void 0}),Object.defineProperty(o(n),jn,{writable:!0,value:void 0}),Object.defineProperty(o(n),Rn,{writable:!0,value:void 0}),Object.defineProperty(o(n),Sn,{writable:!0,value:void 0}),Object.defineProperty(o(n),An,{writable:!0,value:void 0}),Object.defineProperty(o(n),Cn,{writable:!0,value:void 0}),Object.defineProperty(o(n),kn,{writable:!0,value:void 0}),Object.defineProperty(o(n),Dn,{writable:!0,value:void 0}),Object.defineProperty(o(n),In,{writable:!0,value:void 0}),Object.defineProperty(o(n),Bn,{writable:!0,value:void 0}),Object.defineProperty(o(n),Ln,{writable:!0,value:void 0}),Object.defineProperty(o(n),Fn,{writable:!0,value:void 0}),Object.defineProperty(o(n),Un,{writable:!0,value:void 0}),Object.defineProperty(o(n),Nn,{writable:!0,value:void 0}),Object.defineProperty(o(n),Xn,{writable:!0,value:void 0}),Object.defineProperty(o(n),Gn,{writable:!0,value:void 0}),n.easing=void 0,Object.defineProperty(o(n),Vn,{writable:!0,value:void 0}),Object.defineProperty(o(n),Hn,{writable:!0,value:void 0}),Object.defineProperty(o(n),Wn,{writable:!0,value:void 0}),Object.defineProperty(o(n),Yn,{writable:!0,value:void 0}),Object.defineProperty(o(n),zn,{writable:!0,value:void 0}),n.onStarted=void 0,n.onStopped=void 0,n.onCancelled=void 0,n.view=i,n.camera=i.camera,u(o(n),xn)[xn]=j(),u(o(n),Mn)[Mn]=j(),u(o(n),On)[On]=j(),u(o(n),jn)[jn]=j(),u(o(n),Rn)[Rn]=j(),u(o(n),Sn)[Sn]=j(),u(o(n),An)[An]=1,u(o(n),Cn)[Cn]=1,u(o(n),In)[In]=!1,u(o(n),Bn)[Bn]=!1,u(o(n),Ln)[Ln]=!1,u(o(n),Fn)[Fn]=!1,u(o(n),Un)[Un]=null,u(o(n),Nn)[Nn]=null,u(o(n),Xn)[Xn]=null,u(o(n),Gn)[Gn]=null,n.easing=!0,u(o(n),Dn)[Dn]=!1,u(o(n),kn)[kn]=!0,u(o(n),Tn)[Tn]=500,n.onStarted=new v(new e.EventDispatcher),n.onStopped=new v(new e.EventDispatcher),n.onCancelled=new v(new e.EventDispatcher),n}n(i,t);var s=i.prototype;return s.flyTo=function(e,t){void 0===e&&(e={}),u(this,In)[In]&&this.stop(),u(this,In)[In]=!1,u(this,Ln)[Ln]=!1,u(this,Fn)[Fn]=!1,u(this,Vn)[Vn]=!1,u(this,Un)[Un]=t;var i,r,n,s,o=this.camera,a=!!e.projection&&e.projection!==o.projection;u(this,Mn)[Mn][0]=o.eye[0],u(this,Mn)[Mn][1]=o.eye[1],u(this,Mn)[Mn][2]=o.eye[2],u(this,xn)[xn][0]=o.look[0],u(this,xn)[xn][1]=o.look[1],u(this,xn)[xn][2]=o.look[2],u(this,On)[On][0]=o.up[0],u(this,On)[On][1]=o.up[1],u(this,On)[On][2]=o.up[2],u(this,An)[An]=o.ortho.scale,u(this,Cn)[Cn]=e.orthoScale||u(this,An)[An],e.aabb?i=e.aabb:e.eye&&e.look||e.up?(r=e.eye,n=e.look,s=e.up):e.eye?r=e.eye:e.look?n=e.look:a||(i=this.viewer.scene.aabb);var h=e.poi;if(i){if(i[3]<i[0]||i[4]<i[1]||i[5]<i[2])return;if(i[3]===i[0]&&i[4]===i[1]&&i[5]===i[2])return;var l=pi(i=i.slice());u(this,jn)[jn]=h||l;var c=ee(B(u(this,Mn)[Mn],u(this,xn)[xn],wn)),d=h?fi(i,h):vi(i),v=e.fitFOV||u(this,Hn)[Hn],f=Math.abs(d/Math.tan(v*E));u(this,Cn)[Cn]=1.1*d,u(this,Rn)[Rn][0]=u(this,jn)[jn][0]+c[0]*f,u(this,Rn)[Rn][1]=u(this,jn)[jn][1]+c[1]*f,u(this,Rn)[Rn][2]=u(this,jn)[jn][2]+c[2]*f,u(this,Sn)[Sn][0]=u(this,On)[On][0],u(this,Sn)[Sn][1]=u(this,On)[On][1],u(this,Sn)[Sn][2]=u(this,On)[On][2],u(this,Vn)[Vn]=!0}else(r||n||s)&&(u(this,Vn)[Vn]=!!r&&!!n&&!!s,u(this,Ln)[Ln]=!!r&&!n,u(this,Fn)[Fn]=!!n&&!r,r&&(u(this,Rn)[Rn][0]=r[0],u(this,Rn)[Rn][1]=r[1],u(this,Rn)[Rn][2]=r[2]),n&&(u(this,jn)[jn][0]=n[0],u(this,jn)[jn][1]=n[1],u(this,jn)[jn][2]=n[2]),s&&(u(this,Sn)[Sn][0]=s[0],u(this,Sn)[Sn][1]=s[1],u(this,Sn)[Sn][2]=s[2]));a?(e.projection===xt&&o.projection!==xt&&(u(this,Wn)[Wn]=xt,u(this,Yn)[Yn]=o.projMatrix.slice(),u(this,zn)[zn]=o.ortho.projMatrix.slice(),o.projection=Ot),e.projection===Tt&&o.projection!==Tt&&(u(this,Wn)[Wn]=Tt,u(this,Yn)[Yn]=o.projMatrix.slice(),u(this,zn)[zn]=o.perspective.projMatrix.slice(),o.projection=Ot)):u(this,Wn)[Wn]=null,this.onStarted.dispatch(this,null),u(this,Xn)[Xn]=Date.now(),u(this,Gn)[Gn]=u(this,Xn)[Xn]+(e.duration?1e3*e.duration:u(this,Tn)[Tn]),u(this,In)[In]=!0,or.scheduleTask(u(this,qn)[qn],this)},s.jumpTo=function(e){u(this,Kn)[Kn](e)},s.stop=function(){if(u(this,In)[In]){u(this,In)[In]=!1,u(this,Xn)[Xn]=null,u(this,Gn)[Gn]=null,u(this,Wn)[Wn]&&(this.camera.projection=u(this,Wn)[Wn]);var e=u(this,Un)[Un];e&&(u(this,Un)[Un]=null,e()),this.onStopped.dispatch(this,null)}},s.cancel=function(){u(this,In)[In]&&(u(this,In)[In]=!1,u(this,Xn)[Xn]=null,u(this,Gn)[Gn]=null,u(this,Un)[Un]&&(u(this,Un)[Un]=null),this.onCancelled.dispatch(this,null))},s.destroy=function(){this.stop(),t.prototype.destroy.call(this),this.onStarted.clear(),this.onStopped.clear(),this.onCancelled.clear()},r(i,[{key:"duration",get:function(){return u(this,Tn)[Tn]/1e3},set:function(e){u(this,Tn)[Tn]=e?1e3*e:500,this.stop()}},{key:"fit",get:function(){return u(this,kn)[kn]},set:function(e){u(this,kn)[kn]=e}},{key:"fitFOV",get:function(){return u(this,Hn)[Hn]},set:function(e){u(this,Hn)[Hn]=e}},{key:"trail",get:function(){return u(this,Dn)[Dn]},set:function(e){u(this,Dn)[Dn]=e}}]),i}(ur);function es(e){u(this,In)[In]&&this.stop();var t,i,r,n,s=this.camera;e.aabb?t=e.aabb:e.eye||e.look||e.up?(i=e.eye,r=e.look,n=e.up):t=this.viewer.scene.aabb;var o=e.poi;if(t){if(t[3]<=t[0]||t[4]<=t[1]||t[5]<=t[2])return;var a,h=o?fi(t,o):vi(t);r=o||pi(t,r),u(this,Dn)[Dn]?B(s.look,r,En):B(s.eye,s.look,En),ee(En),a=(void 0!==e.fit?e.fit:u(this,kn)[kn])?Math.abs(h/Math.tan((e.fitFOV||u(this,Hn)[Hn])*E)):z(B(s.eye,s.look,wn)),C(En,a),s.eye=D(r,En,wn),s.look=r,this.camera.ortho.scale=1.1*h}else(i||r||n)&&(i&&(s.eye=i),r&&(s.look=r),n&&(s.up=n));e.projection&&(s.projection=e.projection)}function ts(){if(u(this,In)[In]){var e=(Date.now()-u(this,Xn)[Xn])/(u(this,Gn)[Gn]-u(this,Xn)[Xn]),t=e>=1;e>1&&(e=1);var i=this.easing?u($n,Zn)[Zn](e,0,1,1):e,r=this.camera;if(u(this,Ln)[Ln]||u(this,Fn)[Fn]?u(this,Ln)[Ln]?(B(r.eye,r.look,En),r.eye=Q(i,0,1,u(this,Mn)[Mn],u(this,Rn)[Rn],Pn),r.look=B(Pn,En,mn)):u(this,Fn)[Fn]&&(r.look=Q(i,0,1,u(this,xn)[xn],u(this,jn)[jn],mn),r.up=Q(i,0,1,u(this,On)[On],u(this,Sn)[Sn],_n)):u(this,Vn)[Vn]&&(r.eye=Q(i,0,1,u(this,Mn)[Mn],u(this,Rn)[Rn],Pn),r.look=Q(i,0,1,u(this,xn)[xn],u(this,jn)[jn],mn),r.up=Q(i,0,1,u(this,On)[On],u(this,Sn)[Sn],_n)),u(this,Wn)[Wn]){var n=u(this,Wn)[Wn]===xt?u($n,Jn)[Jn](e,0,1,1):u($n,Qn)[Qn](e,0,1,1);r.customProjection.projMatrix=Ne(n,0,1,u(this,Yn)[Yn],u(this,zn)[zn])}else r.ortho.scale=u(this,An)[An]+e*(u(this,Cn)[Cn]-u(this,An)[An]);if(t)return r.ortho.scale=u(this,Cn)[Cn],void this.stop();or.scheduleTask(u(this,qn)[qn],this)}}Object.defineProperty($n,Jn,{value:function(e,t,i,r){return i*(1-Math.pow(2,-10*e/r))+t}}),Object.defineProperty($n,Qn,{value:function(e,t,i,r){return i*(e/=r)*e*e+t}}),Object.defineProperty($n,Zn,{value:function(e,t,i,r){return-i*(e/=r)*(e-2)+t}});var is=/*#__PURE__*/c("onTick"),rs=/*#__PURE__*/c("backgroundColor"),ns=/*#__PURE__*/c("backgroundColorFromAmbientLight"),ss=/*#__PURE__*/c("resolutionScale"),os=/*#__PURE__*/function(t){function i(i,r){var n;(n=t.call(this,i,r)||this).view=void 0,n.canvas=void 0,n.transparent=void 0,n.boundary=void 0,Object.defineProperty(o(n),is,{writable:!0,value:void 0}),Object.defineProperty(o(n),rs,{writable:!0,value:void 0}),Object.defineProperty(o(n),ns,{writable:!0,value:void 0}),Object.defineProperty(o(n),ss,{writable:!0,value:void 0}),n.onBoundary=void 0,n.onBoundary=new v(new e.EventDispatcher),u(o(n),ss)[ss]=1,u(o(n),rs)[rs]=j([r.backgroundColor?r.backgroundColor[0]:1,r.backgroundColor?r.backgroundColor[1]:1,r.backgroundColor?r.backgroundColor[2]:1]),u(o(n),ns)[ns]=!!r.backgroundColorFromAmbientLight,n.view=i,n.canvas=r.canvas,n.transparent=!!r.transparent,n.canvas.width=n.canvas.clientWidth,n.canvas.height=n.canvas.clientHeight,n.boundary=[n.canvas.offsetLeft,n.canvas.offsetTop,n.canvas.clientWidth,n.canvas.clientHeight];var s=0,a=0,h=0,l=0,c=0,d=0,f=null,p=null;return u(o(n),is)[is]=i.viewer.onTick.subscribe(function(){var e=n.canvas,t=u(o(n),ss)[ss]!==p,i=window.innerWidth!==s||window.innerHeight!==a,r=e.clientWidth!==h||e.clientHeight!==l,v=e.offsetLeft!==c||e.offsetTop!==d,y=e.parentElement;if(t||i||r||v||y!==f){if(t||r||v){var g=e.clientWidth,b=e.clientHeight;(t||r)&&(e.width=Math.round(e.clientWidth*u(o(n),ss)[ss]),e.height=Math.round(e.clientHeight*u(o(n),ss)[ss]));var w=n.boundary;w[0]=e.offsetLeft,w[1]=e.offsetTop,w[2]=g,w[3]=b,t&&!r||n.onBoundary.dispatch(o(n),w),h=g,l=b}t&&(p=u(o(n),ss)[ss]),i&&(s=window.innerWidth,a=window.innerHeight),v&&(c=e.offsetLeft,d=e.offsetTop),f=y}}),n}return n(i,t),i.prototype.destroy=function(){this.view.viewer.onTick.unsubscribe(u(this,is)[is]),t.prototype.destroy.call(this)},r(i,[{key:"backgroundColor",get:function(){return u(this,rs)[rs]},set:function(e){e?(u(this,rs)[rs][0]=e[0],u(this,rs)[rs][1]=e[1],u(this,rs)[rs][2]=e[2]):(u(this,rs)[rs][0]=1,u(this,rs)[rs][1]=1,u(this,rs)[rs][2]=1),this.view.redraw()}},{key:"backgroundColorFromAmbientLight",get:function(){return u(this,ns)[ns]},set:function(e){u(this,ns)[ns]=!1!==e}},{key:"resolutionScale",get:function(){return u(this,ss)[ss]},set:function(e){if((e=e||1)!==u(this,ss)[ss]){u(this,ss)[ss]=e;var t=this.canvas;t.width=Math.round(t.clientWidth*u(this,ss)[ss]),t.height=Math.round(t.clientHeight*u(this,ss)[ss]),this.view.redraw()}}}]),i}(ur),as=R(),hs=R(),ls=j(),cs=j(),us=j(),ds=R(),vs=R(),fs=R(),ps=/*#__PURE__*/c("unproject"),ys=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,ps,{value:gs}),this.view=void 0,this.view=e.view}var t=e.prototype;return t.dollyToCanvasPos=function(e,t,i){var r=!1,n=this.view.camera;if(e&&(r=z(B(e,n.eye,ls))<i),n.projection===Tt){n.ortho.scale=n.ortho.scale-i;var s=C(ee(B(u(this,ps)[ps](t,ds),n.eye,fs)),-i,[]);if(n.eye=[n.eye[0]-s[0],n.eye[1]-s[1],n.eye[2]-s[2]],n.look=[n.look[0]-s[0],n.look[1]-s[1],n.look[2]-s[2]],e){var o=z(B(e,n.eye,ls)),a=C(ee(B(n.look,n.eye,cs)),o);n.look=[n.eye[0]+a[0],n.eye[1]+a[1],n.eye[2]+a[2]]}}else if(n.projection===xt){var h=u(this,ps)[ps](t,ds);n.ortho.scale=n.ortho.scale-i,n.ortho.clean();var l=D(B(u(this,ps)[ps](t,vs),h,fs),C(ee(B(n.look,n.eye,ls)),-i,cs),us);n.eye=[n.eye[0]-l[0],n.eye[1]-l[1],n.eye[2]-l[2]],n.look=[n.look[0]-l[0],n.look[1]-l[1],n.look[2]-l[2]]}return r},t.destroy=function(){},e}();function gs(e,t){var i=this.view.camera,r=i.project.transposedProjMatrix,n=r.subarray(8,12),s=r.subarray(12),o=[0,0,-1,1],a=N(o,n)/N(o,s);return i.project.unproject(e,a,as,hs,t),t}var bs=j(),ws=j(),ms=j(),Ps=R(),_s=R(),Es=R(),Ts=/*#__PURE__*/c("view"),xs=/*#__PURE__*/c("configs"),Ms=/*#__PURE__*/c("pivotWorldPos"),Os=/*#__PURE__*/c("cameraOffset"),js=/*#__PURE__*/c("azimuth"),Rs=/*#__PURE__*/c("polar"),Ss=/*#__PURE__*/c("radius"),As=/*#__PURE__*/c("pivotPosSet"),Cs=/*#__PURE__*/c("pivoting"),ks=/*#__PURE__*/c("shown"),Ds=/*#__PURE__*/c("pivotViewPos"),Is=/*#__PURE__*/c("pivotProjPos"),Bs=/*#__PURE__*/c("pivotCanvasPos"),Ls=/*#__PURE__*/c("cameraDirty"),Fs=/*#__PURE__*/c("onViewMatrix"),Us=/*#__PURE__*/c("onProjMatrix"),Ns=/*#__PURE__*/c("onTick"),Xs=/*#__PURE__*/c("hideTimeout"),Gs=/*#__PURE__*/c("pivotElement"),Vs=/*#__PURE__*/c("cameraLookingDownwards"),Hs=/*#__PURE__*/function(){function e(e,t){var i=this;Object.defineProperty(this,Vs,{value:Ws}),Object.defineProperty(this,Ts,{writable:!0,value:void 0}),Object.defineProperty(this,xs,{writable:!0,value:void 0}),Object.defineProperty(this,Ms,{writable:!0,value:void 0}),Object.defineProperty(this,Os,{writable:!0,value:void 0}),Object.defineProperty(this,js,{writable:!0,value:void 0}),Object.defineProperty(this,Rs,{writable:!0,value:void 0}),Object.defineProperty(this,Ss,{writable:!0,value:void 0}),Object.defineProperty(this,As,{writable:!0,value:void 0}),Object.defineProperty(this,Cs,{writable:!0,value:void 0}),Object.defineProperty(this,ks,{writable:!0,value:void 0}),Object.defineProperty(this,Ds,{writable:!0,value:void 0}),Object.defineProperty(this,Is,{writable:!0,value:void 0}),Object.defineProperty(this,Bs,{writable:!0,value:void 0}),Object.defineProperty(this,Ls,{writable:!0,value:void 0}),Object.defineProperty(this,Fs,{writable:!0,value:void 0}),Object.defineProperty(this,Us,{writable:!0,value:void 0}),Object.defineProperty(this,Ns,{writable:!0,value:void 0}),Object.defineProperty(this,Xs,{writable:!0,value:void 0}),Object.defineProperty(this,Gs,{writable:!0,value:void 0}),u(this,Ts)[Ts]=e.view,u(this,xs)[xs]=t,u(this,Ms)[Ms]=j(),u(this,Os)[Os]=j(),u(this,js)[js]=0,u(this,Rs)[Rs]=0,u(this,Ss)[Ss]=0,u(this,As)[As]=!1,u(this,Cs)[Cs]=!1,u(this,ks)[ks]=!1,u(this,Ds)[Ds]=R(),u(this,Is)[Is]=R(),u(this,Bs)[Bs]=O(),u(this,Ls)[Ls]=!0,u(this,Fs)[Fs]=u(this,Ts)[Ts].camera.onViewMatrix.subscribe(function(){u(i,Ls)[Ls]=!0}),u(this,Us)[Us]=u(this,Ts)[Ts].camera.onProjMatrix.subscribe(function(){u(i,Ls)[Ls]=!0}),u(this,Ns)[Ns]=u(this,Ts)[Ts].viewer.onTick.subscribe(function(){i.updatePivotElement()})}var t=e.prototype;return t.updatePivotElement=function(){var e=u(this,Ts)[Ts].camera,t=u(this,Ts)[Ts].canvas;if(u(this,Cs)[Cs]&&u(this,Ls)[Ls]){Pe(e.viewMatrix,this.getPivotPos(),u(this,Ds)[Ds]),u(this,Ds)[Ds][3]=1,_e(e.projMatrix,u(this,Ds)[Ds],u(this,Is)[Is]);var i=t.boundary,r=i[2],n=i[3];u(this,Bs)[Bs][0]=Math.floor((1+u(this,Is)[Is][0]/u(this,Is)[Is][3])*r/2),u(this,Bs)[Bs][1]=Math.floor((1-u(this,Is)[Is][1]/u(this,Is)[Is][3])*n/2);var s=t.canvas.getBoundingClientRect();u(this,Gs)[Gs]&&(u(this,Gs)[Gs].style.left=Math.floor(s.left+u(this,Bs)[Bs][0])-u(this,Gs)[Gs].clientWidth/2+window.scrollX+"px",u(this,Gs)[Gs].style.top=Math.floor(s.top+u(this,Bs)[Bs][1])-u(this,Gs)[Gs].clientHeight/2+window.scrollY+"px"),u(this,Ls)[Ls]=!1}},t.setPivotElement=function(e){u(this,Gs)[Gs]=e},t.startPivot=function(){if(u(this,Vs)[Vs]())return u(this,Cs)[Cs]=!1,!1;var e=u(this,Ts)[Ts].camera,t=pe(e.eye,e.look,e.worldUp);Pe(t,this.getPivotPos(),u(this,Os)[Os]);var i=this.getPivotPos();u(this,Os)[Os][2]+=q(e.eye,i);var r=Ee(t=ye(t),u(this,Os)[Os]),n=j();if(B(e.eye,i,n),D(n,r),e.zUp){var s=n[1];n[1]=n[2],n[2]=s}u(this,Ss)[Ss]=z(n),u(this,Rs)[Rs]=Math.acos(n[1]/u(this,Ss)[Ss]),u(this,js)[js]=Math.atan2(n[0],n[2]),u(this,Cs)[Cs]=!0},t.getPivoting=function(){return u(this,Cs)[Cs]},t.setPivotPos=function(e){u(this,Ms)[Ms].set(e),u(this,As)[As]=!0},t.setCanvasPivotPos=function(e){var t=u(this,Ts)[Ts].camera,i=Math.abs(q(u(this,Ts)[Ts].viewer.scene.center,t.eye)),r=t.project.transposedProjMatrix,n=r.subarray(8,12),s=r.subarray(12),o=[0,0,-1,1],a=N(o,n)/N(o,s),h=Ps;t.project.unproject(e,a,_s,Es,h);var l=ee(B(h,t.eye,bs)),c=D(t.eye,C(l,i,ws),ms);this.setPivotPos(c)},t.getPivotPos=function(){return u(this,As)[As]?u(this,Ms)[Ms]:u(this,Ts)[Ts].camera.look},t.continuePivot=function(e,t){if(u(this,Cs)[Cs]&&(0!==e||0!==t)){var i=u(this,Ts)[Ts].camera,r=-e,n=-t;1===i.worldUp[2]&&(r=-r),u(this,js)[js]+=.01*-r,u(this,Rs)[Rs]+=.01*n,u(this,Rs)[Rs]=T(u(this,Rs)[Rs],.001,Math.PI-.001);var s=[u(this,Ss)[Ss]*Math.sin(u(this,Rs)[Rs])*Math.sin(u(this,js)[js]),u(this,Ss)[Ss]*Math.cos(u(this,Rs)[Rs]),u(this,Ss)[Ss]*Math.sin(u(this,Rs)[Rs])*Math.cos(u(this,js)[js])];if(1===i.worldUp[2]){var o=s[1];s[1]=s[2],s[2]=o}var a=z(B(i.look,i.eye,j())),h=this.getPivotPos();D(s,h);var l=pe(s,h,i.worldUp),c=Ee(l=ye(l),u(this,Os)[Os]);l[12]-=c[0],l[13]-=c[1],l[14]-=c[2];var d=[l[8],l[9],l[10]];i.eye=[l[12],l[13],l[14]],B(i.eye,C(d,a),i.look),i.up=[l[4],l[5],l[6]],this.showPivot()}},t.showPivot=function(){var e=this;u(this,ks)[ks]||(null!==u(this,Xs)[Xs]&&(window.clearTimeout(u(this,Xs)[Xs]),u(this,Xs)[Xs]=null),u(this,Gs)[Gs]&&(this.updatePivotElement(),u(this,Gs)[Gs].style.visibility="visible",u(this,ks)[ks]=!0,u(this,Xs)[Xs]=window.setTimeout(function(){e.hidePivot()},1e3)))},t.hidePivot=function(){u(this,ks)[ks]&&(null!==u(this,Xs)[Xs]&&(window.clearTimeout(u(this,Xs)[Xs]),u(this,Xs)[Xs]=null),u(this,Gs)[Gs]&&(u(this,Gs)[Gs].style.visibility="hidden"),u(this,ks)[ks]=!1)},t.endPivot=function(){u(this,Cs)[Cs]=!1},t.destroy=function(){u(this,Ts)[Ts].camera.onViewMatrix.unsubscribe(u(this,Fs)[Fs]),u(this,Ts)[Ts].camera.onProjMatrix.unsubscribe(u(this,Us)[Us]),u(this,Ts)[Ts].viewer.onTick.unsubscribe(u(this,Ns)[Ns])},e}();function Ws(){var e=u(this,Ts)[Ts].camera;return W(X(ee(B(e.look,e.eye,bs)),e.worldUp,ws))<=1e-4}var Ys=/*#__PURE__*/c("view"),zs=/*#__PURE__*/c("cameraControl"),Ks=/*#__PURE__*/c("config"),qs=/*#__PURE__*/c("lastPickedEntityId"),Zs=/*#__PURE__*/c("needFireEvents"),Qs=/*#__PURE__*/function(){function e(e,t){this.schedulePickEntity=void 0,this.schedulePickSurface=void 0,this.pickCursorPos=void 0,this.picked=void 0,this.pickedSurface=void 0,this.pickResult=void 0,Object.defineProperty(this,Ys,{writable:!0,value:void 0}),Object.defineProperty(this,zs,{writable:!0,value:void 0}),Object.defineProperty(this,Ks,{writable:!0,value:void 0}),Object.defineProperty(this,qs,{writable:!0,value:void 0}),Object.defineProperty(this,Zs,{writable:!0,value:void 0}),u(this,Ys)[Ys]=e.view,u(this,zs)[zs]=e,u(this,Ys)[Ys].canvas.canvas.oncontextmenu=function(e){e.preventDefault()},u(this,Ks)[Ks]=t,this.schedulePickEntity=!1,this.schedulePickSurface=!1,this.pickCursorPos=O(),this.picked=!1,this.pickedSurface=!1,this.pickResult=null,u(this,qs)[qs]=null,u(this,Zs)[Zs]=!1}var t=e.prototype;return t.update=function(){if(u(this,Ks)[Ks].pointerEnabled&&(this.schedulePickEntity||this.schedulePickSurface)){this.picked=!1,this.pickedSurface=!1,u(this,Zs)[Zs]=!1;var e=u(this,zs)[zs].onHoverSurface.count>0;if(this.schedulePickSurface&&this.pickResult&&this.pickResult.worldPos){var t=this.pickResult.canvasPos;if(t[0]===this.pickCursorPos[0]&&t[1]===this.pickCursorPos[1])return this.picked=!0,this.pickedSurface=!0,u(this,Zs)[Zs]=e,this.schedulePickEntity=!1,void(this.schedulePickSurface=!1)}if(this.schedulePickEntity&&this.pickResult){var i=this.pickResult.canvasPos;if(i[0]===this.pickCursorPos[0]&&i[1]===this.pickCursorPos[1])return this.picked=!0,this.pickedSurface=!1,u(this,Zs)[Zs]=!1,this.schedulePickEntity=!1,void(this.schedulePickSurface=!1)}this.schedulePickEntity=!1,this.schedulePickSurface=!1}},t.fireEvents=function(){if(u(this,Zs)[Zs]){if(this.picked&&this.pickResult&&this.pickResult.entity){var e=this.pickResult.entity.id;u(this,qs)[qs]!==e&&(void 0!==u(this,qs)[qs]&&null!==u(this,qs)[qs]&&u(this,zs)[zs].onHoverOut.dispatch(u(this,zs)[zs],{entity:u(this,Ys)[Ys].objects[u(this,qs)[qs]]}),u(this,zs)[zs].onHoverOut.dispatch(u(this,zs)[zs],this.pickResult),u(this,qs)[qs]=e),u(this,zs)[zs].onHover.dispatch(u(this,zs)[zs],this.pickResult),this.pickResult.worldPos&&(this.pickedSurface=!0,u(this,zs)[zs].onHoverSurface.dispatch(u(this,zs)[zs],this.pickResult))}else void 0!==u(this,qs)[qs]&&null!==u(this,qs)[qs]&&(u(this,zs)[zs].onHoverOut.dispatch(u(this,zs)[zs],{entity:u(this,Ys)[Ys].objects[u(this,qs)[qs]]}),u(this,qs)[qs]=void 0),u(this,zs)[zs].onHoverOff.dispatch(u(this,zs)[zs],{canvasPos:this.pickCursorPos});this.pickResult=null,u(this,Zs)[Zs]=!1}},t.destroy=function(){},e}(),Js=O(),$s=/*#__PURE__*/c("view"),eo=/*#__PURE__*/c("documentKeyDownHandler"),to=/*#__PURE__*/c("documentKeyUpHandler"),io=/*#__PURE__*/c("mouseDownHandler"),ro=/*#__PURE__*/c("documentMouseMoveHandler"),no=/*#__PURE__*/c("canvasMouseMoveHandler"),so=/*#__PURE__*/c("documentMouseUpHandler"),oo=/*#__PURE__*/c("mouseUpHandler"),ao=/*#__PURE__*/c("mouseEnterHandler"),ho=/*#__PURE__*/c("mouseWheelHandler"),lo=/*#__PURE__*/function(){function e(e,t,i,r,n){var s=this;Object.defineProperty(this,$s,{writable:!0,value:void 0}),Object.defineProperty(this,eo,{writable:!0,value:void 0}),Object.defineProperty(this,to,{writable:!0,value:void 0}),Object.defineProperty(this,io,{writable:!0,value:void 0}),Object.defineProperty(this,ro,{writable:!0,value:void 0}),Object.defineProperty(this,no,{writable:!0,value:void 0}),Object.defineProperty(this,so,{writable:!0,value:void 0}),Object.defineProperty(this,oo,{writable:!0,value:void 0}),Object.defineProperty(this,ao,{writable:!0,value:void 0}),Object.defineProperty(this,ho,{writable:!0,value:void 0}),u(this,$s)[$s]=e.view;var o,a,h,l=t.pickController,c=0,d=0,v=0,f=0,p=!1,y=new Float64Array(3),g=!0,b=u(this,$s)[$s].canvas.canvas,w=[];function m(e){void 0===e&&(e=!0),b.style.cursor="move",c=r.pointerCanvasPos[0],d=r.pointerCanvasPos[1],v=r.pointerCanvasPos[0],f=r.pointerCanvasPos[1],e&&(l.pickCursorPos=r.pointerCanvasPos,l.schedulePickSurface=!0,l.update(),l.picked&&l.pickedSurface&&l.pickResult&&l.pickResult.worldPos?(p=!0,y.set(l.pickResult.worldPos)):p=!1)}document.addEventListener("keydown",u(this,eo)[eo]=function(e){i.active&&i.pointerEnabled&&i.keyboardEnabled&&(w[e.keyCode]=!0)}),document.addEventListener("keyup",u(this,to)[to]=function(e){i.active&&i.pointerEnabled&&i.keyboardEnabled&&(w[e.keyCode]=!1)}),b.addEventListener("mousedown",u(this,io)[io]=function(e){if(i.active&&i.pointerEnabled)switch(e.which){case 1:w[16]||i.planView?(o=!0,m()):(o=!0,m(!1));break;case 2:a=!0,m();break;case 3:h=!0,i.panRightClick&&m()}}),document.addEventListener("mousemove",u(this,ro)[ro]=function(){if(i.active&&i.pointerEnabled&&(o||a||h)){var e=u(s,$s)[$s].canvas.boundary,t=e[0],l=e[1],v=r.pointerCanvasPos[0],f=r.pointerCanvasPos[1];if(w[16]||i.planView||!i.panRightClick&&a||i.panRightClick&&h){var g=v-c,b=f-d,m=u(s,$s)[$s].camera;if(m.projection===Tt){var P=Math.abs(p?z(B(y,u(s,$s)[$s].camera.eye,[])):u(s,$s)[$s].camera.eyeLookDist)*Math.tan(m.perspective.fov/2*Math.PI/180);n.panDeltaX+=1.5*g*P/l,n.panDeltaY+=1.5*b*P/l}else n.panDeltaX+=.5*m.ortho.scale*(g/l),n.panDeltaY+=.5*m.ortho.scale*(b/l)}else!o||a||h||i.planView||(i.firstPerson?(n.rotateDeltaY-=(v-c)/t*i.dragRotationRate/2,n.rotateDeltaX+=(f-d)/l*(i.dragRotationRate/4)):(n.rotateDeltaY-=(v-c)/t*(1.5*i.dragRotationRate),n.rotateDeltaX+=(f-d)/l*(1.5*i.dragRotationRate)));c=v,d=f}}),b.addEventListener("mousemove",u(this,no)[no]=function(e){i.active&&i.pointerEnabled&&r.mouseover&&(g=!0)}),document.addEventListener("mouseup",u(this,so)[so]=function(e){if(i.active&&i.pointerEnabled)switch(e.which){case 1:case 2:case 3:o=!1,a=!1,h=!1}}),b.addEventListener("mouseup",u(this,oo)[oo]=function(e){if(i.active&&i.pointerEnabled){if(3===e.which){co(e,Js);var r=Js[1];Math.abs(Js[0]-v)<3&&Math.abs(r-f)<3&&t.cameraControl.events.fire("rightClick",{pagePos:[Math.round(e.pageX),Math.round(e.pageY)],canvasPos:Js,event:e},!0)}b.style.removeProperty("cursor")}}),b.addEventListener("mouseenter",u(this,ao)[ao]=function(){});var P=1/60,_=null;b.addEventListener("wheel",u(this,ho)[ho]=function(e){if(i.active&&i.pointerEnabled){var t=performance.now()/1e3,s=null!==_?t-_:0;_=t,s>.05&&(s=.05),s<P&&(s=P);var o=Math.max(-1,Math.min(1,40*-e.deltaY));if(0!==o){var a=o/Math.abs(o);n.dollyDelta+=-a*s*i.mouseWheelDollyRate,g&&(r.followPointerDirty=!0,g=!1),e.preventDefault()}}})}var t=e.prototype;return t.reset=function(){},t.destroy=function(){var e=u(this,$s)[$s].canvas.canvas;document.removeEventListener("keydown",u(this,eo)[eo]),document.removeEventListener("keyup",u(this,to)[to]),e.removeEventListener("mousedown",u(this,io)[io]),document.removeEventListener("mousemove",u(this,ro)[ro]),e.removeEventListener("mousemove",u(this,no)[no]),document.removeEventListener("mouseup",u(this,so)[so]),e.removeEventListener("mouseup",u(this,oo)[oo]),e.removeEventListener("mouseenter",u(this,ao)[ao]),e.removeEventListener("wheel",u(this,ho)[ho])},e}(),co=function(e,t){if(e){for(var i=e.target,r=0,n=0;i.offsetParent;)r+=i.offsetLeft,n+=i.offsetTop,i=i.offsetParent;t[0]=e.pageX-r,t[1]=e.pageY-n}else e=window.event,t[0]=e.x,t[1]=e.y;return t},uo=j(),vo=j(),fo=j(),po=j(),yo=j(),go={eye:new Float64Array(3),look:new Float64Array(3),up:new Float64Array(3),orthoScale:1},bo=/*#__PURE__*/c("documentKeyDownHandler"),wo=/*#__PURE__*/function(){function e(e,t,i,r,n){Object.defineProperty(this,bo,{writable:!0,value:void 0});var s=e.view,o=e.camera,a=t.cameraControl;document.addEventListener("keydown",u(this,bo)[bo]=function(e){if(i.active&&i.pointerEnabled&&i.keyboardEnabled&&r.mouseover){var n=a._isKeyDownForAction(a.AXIS_VIEW_RIGHT),h=a._isKeyDownForAction(a.AXIS_VIEW_BACK),l=a._isKeyDownForAction(a.AXIS_VIEW_LEFT),c=a._isKeyDownForAction(a.AXIS_VIEW_FRONT),u=a._isKeyDownForAction(a.AXIS_VIEW_TOP),d=a._isKeyDownForAction(a.AXIS_VIEW_BOTTOM);if(n||h||l||c||u||d){var v=s.aabb,f=vi(v);pi(v,uo);var p=Math.abs(f/Math.tan(t.cameraFlight.fitFOV*E));go.orthoScale=1.1*f,n?(go.eye.set(D(uo,C(o.worldRight,p,vo),yo)),go.look.set(uo),go.up.set(o.worldUp)):h?(go.eye.set(D(uo,C(o.worldForward,p,vo),yo)),go.look.set(uo),go.up.set(o.worldUp)):l?(go.eye.set(D(uo,C(o.worldRight,-p,vo),yo)),go.look.set(uo),go.up.set(o.worldUp)):c?(go.eye.set(D(uo,C(o.worldForward,-p,vo),yo)),go.look.set(uo),go.up.set(o.worldUp)):u?(go.eye.set(D(uo,C(o.worldUp,p,vo),yo)),go.look.set(uo),go.up.set(ee(C(o.worldForward,1,fo),po))):d&&(go.eye.set(D(uo,C(o.worldUp,-p,vo),yo)),go.look.set(uo),go.up.set(ee(C(o.worldForward,-1,fo)))),!i.firstPerson&&i.followPointer&&t.pivotController.setPivotPos(uo),t.cameraFlight.duration>0?t.cameraFlight.flyTo(go,function(){t.pivotController.getPivoting()&&i.followPointer&&t.pivotController.showPivot()}):(t.cameraFlight.jumpTo(go),t.pivotController.getPivoting()&&i.followPointer&&t.pivotController.showPivot())}}})}var t=e.prototype;return t.reset=function(){},t.destroy=function(){document.removeEventListener("keydown",u(this,bo)[bo])},e}(),mo=/*#__PURE__*/c("view"),Po=/*#__PURE__*/c("clicks"),_o=/*#__PURE__*/c("timeout"),Eo=/*#__PURE__*/c("lastPickedEntityId"),To=/*#__PURE__*/c("canvasMouseMoveHandler"),xo=/*#__PURE__*/c("canvasMouseDownHandler"),Mo=/*#__PURE__*/c("documentMouseUpHandler"),Oo=/*#__PURE__*/c("canvasMouseUpHandler"),jo=/*#__PURE__*/function(){function e(e,t,i,r,n){var s=this;Object.defineProperty(this,mo,{writable:!0,value:void 0}),Object.defineProperty(this,Po,{writable:!0,value:void 0}),Object.defineProperty(this,_o,{writable:!0,value:void 0}),Object.defineProperty(this,Eo,{writable:!0,value:void 0}),Object.defineProperty(this,To,{writable:!0,value:void 0}),Object.defineProperty(this,xo,{writable:!0,value:void 0}),Object.defineProperty(this,Mo,{writable:!0,value:void 0}),Object.defineProperty(this,Oo,{writable:!0,value:void 0}),u(this,mo)[mo]=e.view;var o=t.pickController,a=t.pivotController,h=t.cameraControl;u(this,Po)[Po]=0,u(this,_o)[_o]=null,u(this,Eo)[Eo]=null;var l=!1,c=!1,d=u(this,mo)[mo].canvas.canvas,v=function(e){var i;e&&e.worldPos&&(i=e.worldPos);var r=e&&e.viewObject?e.viewObject.sceneObject.aabb:u(s,mo)[mo].viewer.scene.aabb;if(i){var n=u(s,mo)[mo].camera;B(n.eye,n.look,[]),t.cameraFlight.flyTo({aabb:r})}else t.cameraFlight.flyTo({aabb:r})};d.addEventListener("mousemove",u(this,To)[To]=function(e){if(i.active&&i.pointerEnabled&&!l&&!c){var t=h.events.hasSubs("hover"),n=h.events.hasSubs("hoverOut"),a=h.events.hasSubs("hoverOff"),d=h.events.hasSubs("hoverSurface");if(t||n||a||d)if(o.pickCursorPos=r.pointerCanvasPos,o.schedulePickEntity=!0,o.schedulePickSurface=d,o.update(),o.pickResult){var v=o.pickResult.entity.id;u(s,Eo)[Eo]!==v&&(void 0!==u(s,Eo)[Eo]&&h.events.fire("hoverOut",{entity:u(s,mo)[mo].objects[u(s,Eo)[Eo]]},!0),h.events.fire("hoverEnter",o.pickResult,!0),u(s,Eo)[Eo]=v),h.events.fire("hover",o.pickResult,!0),o.pickResult.worldPos&&h.events.fire("hoverSurface",o.pickResult,!0)}else void 0!==u(s,Eo)[Eo]&&(h.events.fire("hoverOut",{entity:u(s,mo)[mo].objects[u(s,Eo)[Eo]]},!0),u(s,Eo)[Eo]=void 0),h.events.fire("hoverOff",{canvasPos:o.pickCursorPos},!0)}}),d.addEventListener("mousedown",u(this,xo)[xo]=function(e){if(1===e.which&&(l=!0),3===e.which&&(c=!0),1===e.which&&i.active&&i.pointerEnabled&&(r.mouseDownClientX=e.clientX,r.mouseDownClientY=e.clientY,r.mouseDownCursorX=r.pointerCanvasPos[0],r.mouseDownCursorY=r.pointerCanvasPos[1],!i.firstPerson&&i.followPointer&&(o.pickCursorPos=r.pointerCanvasPos,o.schedulePickSurface=!0,o.update(),1===e.which))){var t=o.pickResult;t&&t.worldPos?(a.setPivotPos(t.worldPos),a.startPivot()):(i.smartPivot?a.setCanvasPivotPos(r.pointerCanvasPos):a.setPivotPos(u(s,mo)[mo].camera.look),a.startPivot())}}),document.addEventListener("mouseup",u(this,Mo)[Mo]=function(e){1===e.which&&(l=!1),3===e.which&&(c=!1)}),d.addEventListener("mouseup",u(this,Oo)[Oo]=function(e){if(i.active&&i.pointerEnabled&&1===e.which&&(a.hidePivot(),!(Math.abs(e.clientX-r.mouseDownClientX)>3||Math.abs(e.clientY-r.mouseDownClientY)>3))){var n=h.events.hasSubs("picked"),l=h.events.hasSubs("pickedNothing"),c=h.events.hasSubs("pickedSurface"),d=h.events.hasSubs("doublePicked"),f=h.events.hasSubs("doublePickedSurface"),p=h.events.hasSubs("doublePickedNothing");if(!(i.doublePickFlyTo||d||f||p))return(n||l||c)&&(o.pickCursorPos=r.pointerCanvasPos,o.schedulePickEntity=!0,o.schedulePickSurface=c,o.update(),o.pickResult?(h.events.fire("picked",o.pickResult,!0),o.pickedSurface&&h.events.fire("pickedSurface",o.pickResult,!0)):h.events.fire("pickedNothing",{canvasPos:r.pointerCanvasPos},!0)),void(u(s,Po)[Po]=0);if(u(s,Po)[Po]++,1===u(s,Po)[Po])u(s,_o)[_o]=setTimeout(function(){o.pickCursorPos=r.pointerCanvasPos,o.schedulePickEntity=i.doublePickFlyTo,o.schedulePickSurface=c,o.update(),o.pickResult?(h.events.fire("picked",o.pickResult,!0),o.pickedSurface&&(h.events.fire("pickedSurface",o.pickResult,!0),!i.firstPerson&&i.followPointer&&(t.pivotController.setPivotPos(o.pickResult.worldPos),t.pivotController.startPivot()&&t.pivotController.showPivot()))):h.events.fire("pickedNothing",{canvasPos:r.pointerCanvasPos},!0),u(s,Po)[Po]=0},250);else{if(null!==u(s,_o)[_o]&&(window.clearTimeout(u(s,_o)[_o]),u(s,_o)[_o]=null),o.pickCursorPos=r.pointerCanvasPos,o.schedulePickEntity=i.doublePickFlyTo||d||f,o.schedulePickSurface=o.schedulePickEntity&&f,o.update(),o.pickResult){if(h.events.fire("doublePicked",o.pickResult,!0),o.pickedSurface&&h.onDoublePickedSurface.dispatch(o.pickResult,!0),i.doublePickFlyTo&&(v(o.pickResult),!i.firstPerson&&i.followPointer)){var y=pi(o.pickResult.entity.aabb);t.pivotController.setPivotPos(y),t.pivotController.startPivot()&&t.pivotController.showPivot()}}else if(h.events.fire("doublePickedNothing",{canvasPos:r.pointerCanvasPos},!0),i.doublePickFlyTo&&(v(),!i.firstPerson&&i.followPointer)){var g=pi(u(s,mo)[mo].viewer.scene.aabb);t.pivotController.setPivotPos(g),t.pivotController.startPivot()&&t.pivotController.showPivot()}u(s,Po)[Po]=0}}},!1)}var t=e.prototype;return t.reset=function(){u(this,Po)[Po]=0,u(this,Eo)[Eo]=null,u(this,_o)[_o]&&(window.clearTimeout(u(this,_o)[_o]),u(this,_o)[_o]=null)},t.destroy=function(){var e=u(this,mo)[mo].canvas.canvas;e.removeEventListener("mousemove",u(this,To)[To]),e.removeEventListener("mousedown",u(this,xo)[xo]),document.removeEventListener("mouseup",u(this,Mo)[Mo]),e.removeEventListener("mouseup",u(this,Oo)[Oo]),u(this,_o)[_o]&&(window.clearTimeout(u(this,_o)[_o]),u(this,_o)[_o]=null)},e}(),Ro=/*#__PURE__*/c("view"),So=/*#__PURE__*/c("documentMouseMoveHandler"),Ao=/*#__PURE__*/c("documentKeyDownHandler"),Co=/*#__PURE__*/c("documentKeyUpHandler"),ko=/*#__PURE__*/c("onTick"),Do=/*#__PURE__*/function(){function e(e,t,i,r,n){Object.defineProperty(this,Ro,{writable:!0,value:void 0}),Object.defineProperty(this,So,{writable:!0,value:void 0}),Object.defineProperty(this,Ao,{writable:!0,value:void 0}),Object.defineProperty(this,Co,{writable:!0,value:void 0}),Object.defineProperty(this,ko,{writable:!0,value:void 0}),u(this,Ro)[Ro]=e.view;var s=[],o=e.view.canvas.canvas,a=!0;document.addEventListener("mousemove",u(this,So)[So]=function(){a=!0}),document.addEventListener("keydown",u(this,Ao)[Ao]=function(e){if(i.active&&i.pointerEnabled&&i.keyboardEnabled&&r.mouseover){var t=e.keyCode;s[t]=!0,16===t&&(o.style.cursor="move")}}),document.addEventListener("keyup",u(this,Co)[Co]=function(e){if(i.active&&i.pointerEnabled&&i.keyboardEnabled&&r.mouseover){var t=e.keyCode;s[t]=!1,16===t&&(o.style.cursor=null)}}),u(this,ko)[ko]=e.view.viewer.events.on("tick",function(e){if(i.active&&i.pointerEnabled&&i.keyboardEnabled&&r.mouseover){var o=t.cameraControl,h=e.deltaTime/1e3;if(!i.planView){var l=o._isKeyDownForAction(o.ROTATE_Y_POS,s),c=o._isKeyDownForAction(o.ROTATE_Y_NEG,s),u=o._isKeyDownForAction(o.ROTATE_X_POS,s),d=o._isKeyDownForAction(o.ROTATE_X_NEG,s),v=h*i.keyboardRotationRate;(l||c||u||d)&&(!i.firstPerson&&i.followPointer&&t.pivotController.startPivot(),l?n.rotateDeltaY+=v:c&&(n.rotateDeltaY-=v),u?n.rotateDeltaX+=v:d&&(n.rotateDeltaX-=v),!i.firstPerson&&i.followPointer&&t.pivotController.startPivot())}if(!s[17]&&!s[18]){var f=o._isKeyDownForAction(o.DOLLY_BACKWARDS,s),p=o._isKeyDownForAction(o.DOLLY_FORWARDS,s);if(f||p){var y=h*i.keyboardDollyRate;!i.firstPerson&&i.followPointer&&t.pivotController.startPivot(),p?n.dollyDelta-=y:f&&(n.dollyDelta+=y),a&&(r.followPointerDirty=!0,a=!1)}}var g=o._isKeyDownForAction(o.PAN_FORWARDS,s),b=o._isKeyDownForAction(o.PAN_BACKWARDS,s),w=o._isKeyDownForAction(o.PAN_LEFT,s),m=o._isKeyDownForAction(o.PAN_RIGHT,s),P=o._isKeyDownForAction(o.PAN_UP,s),_=o._isKeyDownForAction(o.PAN_DOWN,s),E=(s[18]?.3:1)*h*i.keyboardPanRate;(g||b||w||m||P||_)&&(!i.firstPerson&&i.followPointer&&t.pivotController.startPivot(),_?n.panDeltaY+=E:P&&(n.panDeltaY+=-E),m?n.panDeltaX+=-E:w&&(n.panDeltaX+=E),b?n.panDeltaZ+=E:g&&(n.panDeltaZ+=-E))}})}var t=e.prototype;return t.reset=function(){},t.destroy=function(){u(this,Ro)[Ro].viewer.onTick.unsubscribe(u(this,ko)[ko]),document.removeEventListener("mousemove",u(this,So)[So]),document.removeEventListener("keydown",u(this,Ao)[Ao]),document.removeEventListener("keyup",u(this,Co)[Co])},e}(),Io=.001,Bo=j(),Lo=/*#__PURE__*/c("onTick"),Fo=/*#__PURE__*/c("view"),Uo=/*#__PURE__*/function(){function e(e,t,i,r,n){Object.defineProperty(this,Lo,{writable:!0,value:void 0}),Object.defineProperty(this,Fo,{writable:!0,value:void 0}),u(this,Fo)[Fo]=e;var s=e.camera,o=t.pickController,a=t.pivotController,h=t.panController,l=1,c=1,d=null;u(this,Lo)[Lo]=e.viewer.onTick.subscribe(function(){if(i.active&&i.pointerEnabled){var t="default";if(Math.abs(n.dollyDelta)<Io&&(n.dollyDelta=0),Math.abs(n.rotateDeltaX)<Io&&(n.rotateDeltaX=0),Math.abs(n.rotateDeltaY)<Io&&(n.rotateDeltaY=0),0===n.rotateDeltaX&&0===n.rotateDeltaY||(n.dollyDelta=0),i.followPointer&&--l<=0&&(l=1,0!==n.dollyDelta)){if(0===n.rotateDeltaY&&0===n.rotateDeltaX&&i.followPointer&&r.followPointerDirty&&(o.pickCursorPos=r.pointerCanvasPos,o.schedulePickSurface=!0,o.update(),o.pickResult&&o.pickResult.worldPos?d=o.pickResult.worldPos:(c=1,d=null),r.followPointerDirty=!1),d){var u=Math.abs(z(B(d,e.camera.eye,Bo)));c=u/i.dollyProximityThreshold}c<i.dollyMinSpeed&&(c=i.dollyMinSpeed)}var v=n.dollyDelta*c;if(0===n.rotateDeltaY&&0===n.rotateDeltaX||(!i.firstPerson&&i.followPointer&&a.getPivoting()?(a.continuePivot(n.rotateDeltaY,n.rotateDeltaX),a.showPivot()):(0!==n.rotateDeltaX&&(i.firstPerson?s.pitch(-n.rotateDeltaX):s.orbitPitch(n.rotateDeltaX)),0!==n.rotateDeltaY&&(i.firstPerson?s.yaw(n.rotateDeltaY):s.orbitYaw(n.rotateDeltaY))),n.rotateDeltaX*=i.rotationInertia,n.rotateDeltaY*=i.rotationInertia,t="grabbing"),Math.abs(n.panDeltaX)<Io&&(n.panDeltaX=0),Math.abs(n.panDeltaY)<Io&&(n.panDeltaY=0),Math.abs(n.panDeltaZ)<Io&&(n.panDeltaZ=0),0!==n.panDeltaX||0!==n.panDeltaY||0!==n.panDeltaZ){var f,p,y=j();if(y[0]=n.panDeltaX,y[1]=n.panDeltaY,y[2]=n.panDeltaZ,i.constrainVertical){s.xUp?(f=s.eye[0],p=s.look[0]):s.yUp?(f=s.eye[1],p=s.look[1]):s.zUp&&(f=s.eye[2],p=s.look[2]),s.pan(y);var g=s.eye,b=s.look;s.xUp?(g[0]=f,b[0]=p):s.yUp?(g[1]=f,b[1]=p):s.zUp&&(g[2]=f,b[2]=p),s.eye=g,s.look=b}else s.pan(y);t="grabbing"}if(n.panDeltaX*=i.panInertia,n.panDeltaY*=i.panInertia,n.panDeltaZ*=i.panInertia,0!==v){var w,m;if(t=v<0?"zoom-in":"zoom-out",i.firstPerson){if(i.constrainVertical&&(s.xUp?(w=s.eye[0],m=s.look[0]):s.yUp?(w=s.eye[1],m=s.look[1]):s.zUp&&(w=s.eye[2],m=s.look[2])),i.followPointer?h.dollyToCanvasPos(d,r.pointerCanvasPos,-v)&&(r.followPointerDirty=!0):(s.pan([0,0,v]),s.ortho.scale=s.ortho.scale-v),i.constrainVertical){var P=s.eye,_=s.look;s.xUp?(P[0]=w,_[0]=m):s.yUp?(P[1]=w,_[1]=m):s.zUp&&(P[2]=w,_[2]=m),s.eye=P,s.look=_}}else i.followPointer?h.dollyToCanvasPos(d,r.pointerCanvasPos,-v)&&(r.followPointerDirty=!0):(s.ortho.scale=s.ortho.scale+v,s.zoom(v));n.dollyDelta*=i.dollyInertia}o.fireEvents(),document.body.style.cursor=t}})}return e.prototype.destroy=function(){u(this,Fo)[Fo].viewer.onTick.unsubscribe(u(this,Lo)[Lo])},e}(),No=/*#__PURE__*/c("view"),Xo=/*#__PURE__*/c("mouseEnterHandler"),Go=/*#__PURE__*/c("mouseMoveHandler"),Vo=/*#__PURE__*/c("mouseLeaveHandler"),Ho=/*#__PURE__*/c("mouseDownHandler"),Wo=/*#__PURE__*/c("mouseUpHandler"),Yo=/*#__PURE__*/function(){function e(e,t,i,r,n){Object.defineProperty(this,No,{writable:!0,value:void 0}),Object.defineProperty(this,Xo,{writable:!0,value:void 0}),Object.defineProperty(this,Go,{writable:!0,value:void 0}),Object.defineProperty(this,Vo,{writable:!0,value:void 0}),Object.defineProperty(this,Ho,{writable:!0,value:void 0}),Object.defineProperty(this,Wo,{writable:!0,value:void 0}),u(this,No)[No]=e.view;var s=u(this,No)[No].canvas.canvas;s.addEventListener("mouseenter",u(this,Xo)[Xo]=function(){r.mouseover=!0}),s.addEventListener("mouseleave",u(this,Vo)[Vo]=function(){r.mouseover=!1,s.style.cursor=null}),document.addEventListener("mousemove",u(this,Go)[Go]=function(e){zo(e,s,r.pointerCanvasPos)}),s.addEventListener("mousedown",u(this,Ho)[Ho]=function(e){i.active&&i.pointerEnabled&&(zo(e,s,r.pointerCanvasPos),r.mouseover=!0)}),s.addEventListener("mouseup",u(this,Wo)[Wo]=function(e){})}var t=e.prototype;return t.reset=function(){},t.destroy=function(){var e=u(this,No)[No].canvas.canvas;document.removeEventListener("mousemove",u(this,Go)[Go]),e.removeEventListener("mouseenter",u(this,Xo)[Xo]),e.removeEventListener("mouseleave",u(this,Vo)[Vo]),e.removeEventListener("mousedown",u(this,Ho)[Ho]),e.removeEventListener("mouseup",u(this,Wo)[Wo])},e}();function zo(e,t,i){if(e){var r=t.getBoundingClientRect(),n=r.y;i[0]=e.clientX-r.x,i[1]=e.clientY-n}else e=window.event,i[0]=e.x,i[1]=e.y;return i}var Ko=function(e,t){if(e){for(var i=e.target,r=0,n=0;i.offsetParent;)r+=i.offsetLeft,n+=i.offsetTop,i=i.offsetParent;t[0]=e.pageX-r,t[1]=e.pageY-n}else e=window.event,t[0]=e.x,t[1]=e.y;return t},qo=/*#__PURE__*/c("view"),Zo=/*#__PURE__*/c("onTick"),Qo=/*#__PURE__*/c("canvasTouchStartHandler"),Jo=/*#__PURE__*/c("canvasTouchMoveHandler"),$o=/*#__PURE__*/function(){function e(e,t,i,r,n){var s=this;Object.defineProperty(this,qo,{writable:!0,value:void 0}),Object.defineProperty(this,Zo,{writable:!0,value:void 0}),Object.defineProperty(this,Qo,{writable:!0,value:void 0}),Object.defineProperty(this,Jo,{writable:!0,value:void 0}),u(this,qo)[qo]=e.view;var o=t.pickController,a=t.pivotController,h=O(),l=O(),c=O(),d=O(),v=[],f=u(this,qo)[qo].canvas.canvas,p=0,y=!1;u(this,Zo)[Zo]=u(this,qo)[qo].viewer.onTick.subscribe(function(){y=!1}),f.addEventListener("touchstart",u(this,Qo)[Qo]=function(e){if(i.active&&i.pointerEnabled){e.preventDefault();var t=e.touches,n=e.changedTouches;for(r.touchStartTime=Date.now(),1===t.length&&1===n.length&&(Ko(t[0],h),i.followPointer&&(o.pickCursorPos=h,o.schedulePickSurface=!0,o.update(),i.planView||(o.picked&&o.pickedSurface&&o.pickResult&&o.pickResult.worldPos?(a.setPivotPos(o.pickResult.worldPos),!i.firstPerson&&a.startPivot()&&a.showPivot()):(i.smartPivot?a.setCanvasPivotPos(r.pointerCanvasPos):a.setPivotPos(u(s,qo)[qo].camera.look),!i.firstPerson&&a.startPivot()&&a.showPivot()))));v.length<t.length;)v.push(O());for(var l=0,c=t.length;l<c;++l)Ko(t[l],v[l]);p=t.length}}),f.addEventListener("touchmove",u(this,Jo)[Jo]=function(e){if(i.active&&i.pointerEnabled&&(e.stopPropagation(),e.preventDefault(),!y)){y=!0;var t=u(s,qo)[qo].canvas.boundary,a=t[0],h=t[1],f=e.touches;if(e.touches.length===p){if(1===p){Ko(f[0],l),L(l,v[0],d);var g=d[0],b=d[1];if(null!==r.longTouchTimeout&&(Math.abs(g)>i.longTapRadius||Math.abs(b)>i.longTapRadius)&&(clearTimeout(r.longTouchTimeout),r.longTouchTimeout=null),i.planView){var w=u(s,qo)[qo].camera;if(w.projection===Tt){var m=Math.abs(u(s,qo)[qo].camera.eyeLookDist)*Math.tan(w.perspective.fov/2*Math.PI/180);n.panDeltaX+=g*m/h*i.touchPanRate,n.panDeltaY+=b*m/h*i.touchPanRate}else n.panDeltaX+=.5*w.ortho.scale*(g/h)*i.touchPanRate,n.panDeltaY+=.5*w.ortho.scale*(b/h)*i.touchPanRate}else n.rotateDeltaY-=g/a*(1*i.dragRotationRate),n.rotateDeltaX+=b/h*(1.5*i.dragRotationRate)}else if(2===p){var P=f[0],_=f[1];Ko(P,l),Ko(_,c);var E=F(v[0],v[1]),T=F(l,c),x=O();L(E,T,x);var M=x[0],j=x[1],R=u(s,qo)[qo].camera,S=J([P.pageX,P.pageY],[_.pageX,_.pageY]),A=(J(v[0],v[1])-S)*i.touchDollyRate;if(n.dollyDelta=A,Math.abs(A)<1)if(R.projection===Tt){var C=o.pickResult?o.pickResult.worldPos:u(s,qo)[qo].viewer.scene.center,k=Math.abs(z(B(C,u(s,qo)[qo].camera.eye,[])))*Math.tan(R.perspective.fov/2*Math.PI/180);n.panDeltaX-=M*k/h*i.touchPanRate,n.panDeltaY-=j*k/h*i.touchPanRate}else n.panDeltaX-=.5*R.ortho.scale*(M/h)*i.touchPanRate,n.panDeltaY-=.5*R.ortho.scale*(j/h)*i.touchPanRate;r.pointerCanvasPos=T}for(var D=0;D<p;++D)Ko(f[D],v[D])}}})}var t=e.prototype;return t.reset=function(){},t.destroy=function(){var e=u(this,qo)[qo].canvas.canvas;e.removeEventListener("touchstart",u(this,Qo)[Qo]),e.removeEventListener("touchmove",u(this,Jo)[Jo]),u(this,qo)[qo].viewer.onTick.unsubscribe(u(this,Zo)[Zo])},e}(),ea=/*#__PURE__*/c("view"),ta=/*#__PURE__*/function(){function e(e,t,i,r,n){var s=this;Object.defineProperty(this,ea,{writable:!0,value:void 0}),this._canvasTouchStartHandler=void 0,this._canvasTouchEndHandler=void 0,u(this,ea)[ea]=e.view;var o,a=t.pickController,h=t.cameraControl,l=[],c=new Float32Array(2),d=-1,v=-1,f=u(this,ea)[ea].canvas.canvas,p=function(e){var i;e&&e.worldPos&&(i=e.worldPos);var r=e&&e.viewObject?e.viewObject.sceneObject.aabb:u(s,ea)[ea].scene.aabb;if(i){var n=u(s,ea)[ea].camera;B(n.eye,n.look,[]),t.cameraFlight.flyTo({aabb:r})}else t.cameraFlight.flyTo({aabb:r})};f.addEventListener("touchstart",this._canvasTouchStartHandler=function(e){if(i.active&&i.pointerEnabled){null!==r.longTouchTimeout&&(clearTimeout(r.longTouchTimeout),r.longTouchTimeout=null);var n=e.touches,s=e.changedTouches;if(o=Date.now(),1===n.length&&1===s.length){d=o,c[0]=n[0].pageX,c[1]=n[0].pageY;var a=n[0].clientX,u=n[0].clientY,v=n[0].pageX,f=n[0].pageY;r.longTouchTimeout=setTimeout(function(){t.cameraControl.onRightClick.dispatch(h,{pagePos:[Math.round(v),Math.round(f)],canvasPos:[Math.round(a),Math.round(u)],event:e}),r.longTouchTimeout=null},i.longTapTimeout)}else d=-1;for(;l.length<n.length;)l.push(new Float32Array(2));for(var p=0,y=n.length;p<y;++p)l[p][0]=n[p].pageX,l[p][1]=n[p].pageY;l.length=n.length}},{passive:!0}),f.addEventListener("touchend",this._canvasTouchEndHandler=function(e){if(i.active&&i.pointerEnabled){var t=Date.now(),n=e.touches,s=e.changedTouches,o=h.events.hasSubs("pickedSurface");null!==r.longTouchTimeout&&(clearTimeout(r.longTouchTimeout),r.longTouchTimeout=null),0===n.length&&1===s.length&&d>-1&&t-d<150&&(v>-1&&d-v<325?(a.pickCursorPos[0]=Math.round(s[0].clientX),a.pickCursorPos[1]=Math.round(s[0].clientY),a.schedulePickEntity=!0,a.schedulePickSurface=o,a.update(),a.pickResult?(h.onDoublePickedSurface.dispatch(h,a.pickResult),a.pickedSurface&&h.onPickedSurface.dispatch(h,a.pickResult),i.doublePickFlyTo&&p(a.pickResult)):(h.onDoublePickedNothing.dispatch(h,null),i.doublePickFlyTo&&p()),v=-1):J(l[0],c)<4&&(a.pickCursorPos[0]=Math.round(s[0].clientX),a.pickCursorPos[1]=Math.round(s[0].clientY),a.schedulePickEntity=!0,a.schedulePickSurface=o,a.update(),a.pickResult?(h.onPicked.dispatch(h,a.pickResult),a.pickedSurface&&h.onPickedSurface.dispatch(h,a.pickResult)):h.onPickedNothing.dispatch(h),v=t),d=-1),l.length=n.length;for(var u=0,f=n.length;u<f;++u)l[u][0]=n[u].pageX,l[u][1]=n[u].pageY;e.stopPropagation()}},{passive:!0})}var t=e.prototype;return t.reset=function(){},t.destroy=function(){var e=u(this,ea)[ea].canvas.canvas;e.removeEventListener("touchstart",this._canvasTouchStartHandler),e.removeEventListener("touchend",this._canvasTouchEndHandler)},e}(),ia=/*#__PURE__*/c("components"),ra=/*#__PURE__*/c("configs"),na=/*#__PURE__*/c("states"),sa=/*#__PURE__*/c("updates"),oa=/*#__PURE__*/c("controllers"),aa=/*#__PURE__*/c("handlers"),ha=/*#__PURE__*/c("cameraUpdater"),la=/*#__PURE__*/c("reset"),ca=/*#__PURE__*/c("destroyHandlers"),ua=/*#__PURE__*/c("destroyControllers"),da=/*#__PURE__*/function(t){function i(i,r,n,s){var a;return a=t.call(this,i,s)||this,Object.defineProperty(o(a),ua,{value:pa}),Object.defineProperty(o(a),ca,{value:fa}),Object.defineProperty(o(a),la,{value:va}),a.view=void 0,a.canvas=void 0,a.camera=void 0,Object.defineProperty(o(a),ia,{writable:!0,value:void 0}),Object.defineProperty(o(a),ra,{writable:!0,value:void 0}),Object.defineProperty(o(a),na,{writable:!0,value:void 0}),Object.defineProperty(o(a),sa,{writable:!0,value:void 0}),Object.defineProperty(o(a),oa,{writable:!0,value:void 0}),Object.defineProperty(o(a),aa,{writable:!0,value:void 0}),Object.defineProperty(o(a),ha,{writable:!0,value:void 0}),a.onRightClick=void 0,a.onHover=void 0,a.onHoverSurface=void 0,a.onHoverOff=void 0,a.onHoverEnter=void 0,a.onHoverOut=void 0,a.onPicked=void 0,a.onPickedSurface=void 0,a.onPickedNothing=void 0,a.onDoublePickedSurface=void 0,a.onDoublePickedNothing=void 0,a.view=i,a.canvas=r,a.camera=n,r.canvas.oncontextmenu=function(e){e.preventDefault()},u(o(a),ia)[ia]={view:i,canvas:r,camera:n},u(o(a),ra)[ra]={longTapTimeout:600,longTapRadius:5,active:!0,keyboardLayout:"qwerty",navMode:"orbit",planView:!1,firstPerson:!1,followPointer:!0,doublePickFlyTo:!0,panRightClick:!0,showPivot:!1,pointerEnabled:!0,constrainVertical:!1,smartPivot:!1,dragRotationRate:360,keyboardRotationRate:90,rotationInertia:0,keyboardPanRate:1,touchPanRate:1,panInertia:.5,keyboardDollyRate:10,mouseWheelDollyRate:100,touchDollyRate:.2,dollyInertia:0,dollyProximityThreshold:30,dollyMinSpeed:.04,keyboardEnabled:!0,keyMap:{}},u(o(a),na)[na]={pointerCanvasPos:O(),mouseover:!1,followPointerDirty:!0,mouseDownClientX:0,mouseDownClientY:0,mouseDownCursorX:0,mouseDownCursorY:0,touchStartTime:null,activeTouches:[],tapStartPos:O(),tapStartTime:-1,lastTapTime:-1,longTouchTimeout:null,altDown:!1,ctrlDown:!1,keyDown:[],shiftDown:!1},u(o(a),sa)[sa]={rotateDeltaX:0,rotateDeltaY:0,panDeltaX:0,panDeltaY:0,panDeltaZ:0,dollyDelta:0},u(o(a),oa)[oa]={cameraControl:o(a),pickController:new Qs(o(a),u(o(a),ra)[ra]),pivotController:new Hs(o(a),u(o(a),ra)[ra]),panController:new ys(o(a)),cameraFlight:new $n(a.view,{duration:.5})},u(o(a),aa)[aa]=[new Yo(u(o(a),ia)[ia],u(o(a),oa)[oa],u(o(a),ra)[ra],u(o(a),na)[na],u(o(a),sa)[sa]),new $o(u(o(a),ia)[ia],u(o(a),oa)[oa],u(o(a),ra)[ra],u(o(a),na)[na],u(o(a),sa)[sa]),new lo(u(o(a),ia)[ia],u(o(a),oa)[oa],u(o(a),ra)[ra],u(o(a),na)[na],u(o(a),sa)[sa]),new wo(u(o(a),ia)[ia],u(o(a),oa)[oa],u(o(a),ra)[ra],u(o(a),na)[na],u(o(a),sa)[sa]),new jo(u(o(a),ia)[ia],u(o(a),oa)[oa],u(o(a),ra)[ra],u(o(a),na)[na],u(o(a),sa)[sa]),new ta(u(o(a),ia)[ia],u(o(a),oa)[oa],u(o(a),ra)[ra],u(o(a),na)[na],u(o(a),sa)[sa]),new Do(u(o(a),ia)[ia],u(o(a),oa)[oa],u(o(a),ra)[ra],u(o(a),na)[na],u(o(a),sa)[sa])],u(o(a),ha)[ha]=new Uo(o(a),u(o(a),oa)[oa],u(o(a),ra)[ra],u(o(a),na)[na],u(o(a),sa)[sa]),a.onHover=new v(new e.EventDispatcher),a.onHoverOff=new v(new e.EventDispatcher),a.onHoverEnter=new v(new e.EventDispatcher),a.onHoverOut=new v(new e.EventDispatcher),a.navMode=s.navMode,a.constrainVertical=s.constrainVertical,a.keyMap=s.keyMap,a.doublePickFlyTo=s.doublePickFlyTo,a.panRightClick=s.panRightClick,a.active=s.active,a.followPointer=s.followPointer,a.rotationInertia=s.rotationInertia,a.keyboardPanRate=s.keyboardPanRate,a.touchPanRate=s.touchPanRate,a.keyboardRotationRate=s.keyboardRotationRate,a.dragRotationRate=s.dragRotationRate,a.touchDollyRate=s.touchDollyRate,a.dollyInertia=s.dollyInertia,a.dollyProximityThreshold=s.dollyProximityThreshold,a.dollyMinSpeed=s.dollyMinSpeed,a.panInertia=s.panInertia,a.pointerEnabled=!0,a.keyboardDollyRate=s.keyboardDollyRate,a.mouseWheelDollyRate=s.mouseWheelDollyRate,a.keyboardEnabled=s.keyboardEnabled,a}n(i,t);var s=i.prototype;return s._isKeyDownForAction=function(e,t){var i=u(this,ra)[ra].keyMap[e];if(!i)return!1;t||(t=u(this,na)[na].keyDown);for(var r=0,n=i.length;r<n;r++)if(t[i[r]])return!0;return!1},s.destroy=function(){u(this,ca)[ca](),u(this,ua)[ua](),u(this,ha)[ha].destroy(),this.onHover.clear(),this.onHoverOff.clear(),this.onHoverEnter.clear(),this.onHoverOut.clear(),t.prototype.destroy.call(this)},r(i,[{key:"keyMap",get:function(){return u(this,ra)[ra].keyMap},set:function(e){if(Ai(e=e||"qwerty")){var t={};switch(e){default:this.error("Unsupported value for 'keyMap': "+e+" defaulting to 'qwerty'");case"qwerty":t[i.PAN_LEFT]=[65],t[i.PAN_RIGHT]=[68],t[i.PAN_UP]=[90],t[i.PAN_DOWN]=[88],t[i.PAN_BACKWARDS]=[],t[i.PAN_FORWARDS]=[],t[i.DOLLY_FORWARDS]=[87,107],t[i.DOLLY_BACKWARDS]=[83,109],t[i.ROTATE_X_POS]=[40],t[i.ROTATE_X_NEG]=[38],t[i.ROTATE_Y_POS]=[81,37],t[i.ROTATE_Y_NEG]=[69,39],t[i.AXIS_VIEW_RIGHT]=[49],t[i.AXIS_VIEW_BACK]=[50],t[i.AXIS_VIEW_LEFT]=[51],t[i.AXIS_VIEW_FRONT]=[52],t[i.AXIS_VIEW_TOP]=[53],t[i.AXIS_VIEW_BOTTOM]=[54];break;case"azerty":t[i.PAN_LEFT]=[81],t[i.PAN_RIGHT]=[68],t[i.PAN_UP]=[87],t[i.PAN_DOWN]=[88],t[i.PAN_BACKWARDS]=[],t[i.PAN_FORWARDS]=[],t[i.DOLLY_FORWARDS]=[90,107],t[i.DOLLY_BACKWARDS]=[83,109],t[i.ROTATE_X_POS]=[40],t[i.ROTATE_X_NEG]=[38],t[i.ROTATE_Y_POS]=[65,37],t[i.ROTATE_Y_NEG]=[69,39],t[i.AXIS_VIEW_RIGHT]=[49],t[i.AXIS_VIEW_BACK]=[50],t[i.AXIS_VIEW_LEFT]=[51],t[i.AXIS_VIEW_FRONT]=[52],t[i.AXIS_VIEW_TOP]=[53],t[i.AXIS_VIEW_BOTTOM]=[54]}u(this,ra)[ra].keyMap=t}else{var r=e;u(this,ra)[ra].keyMap=r}}},{key:"pivotElement",set:function(e){u(this,oa)[oa].pivotController.setPivotElement(e)}},{key:"active",get:function(){return u(this,ra)[ra].active},set:function(e){u(this,ra)[ra].active=!1!==e}},{key:"navMode",get:function(){return u(this,ra)[ra].navMode},set:function(e){"firstPerson"!==(e=e||"orbit")&&"orbit"!==e&&"planView"!==e&&(this.error("Unsupported value for navMode: "+e+" - supported values are 'orbit', 'firstPerson' and 'planView' - defaulting to 'orbit'"),e="orbit"),u(this,ra)[ra].firstPerson="firstPerson"===e,u(this,ra)[ra].planView="planView"===e,(u(this,ra)[ra].firstPerson||u(this,ra)[ra].planView)&&(u(this,oa)[oa].pivotController.hidePivot(),u(this,oa)[oa].pivotController.endPivot()),u(this,ra)[ra].navMode=e}},{key:"pointerEnabled",get:function(){return u(this,ra)[ra].pointerEnabled},set:function(e){u(this,la)[la](),u(this,ra)[ra].pointerEnabled=!!e}},{key:"followPointer",get:function(){return u(this,ra)[ra].followPointer},set:function(e){u(this,ra)[ra].followPointer=!1!==e}},{key:"pivotPos",get:function(){return u(this,oa)[oa].pivotController.getPivotPos()},set:function(e){u(this,oa)[oa].pivotController.setPivotPos(e)}},{key:"dollyToPointer",get:function(){return this.warn("dollyToPointer property is deprecated - replaced with followPointer"),this.followPointer},set:function(e){this.warn("dollyToPointer property is deprecated - replaced with followPointer"),this.followPointer=e}},{key:"panToPointer",get:function(){return this.warn("panToPointer property is deprecated - replaced with followPointer"),!1},set:function(e){this.warn("panToPointer property is deprecated - replaced with followPointer")}},{key:"planView",get:function(){return this.warn("planView property is deprecated - replaced with navMode"),u(this,ra)[ra].planView},set:function(e){u(this,ra)[ra].planView=!!e,u(this,ra)[ra].firstPerson=!1,u(this,ra)[ra].planView&&(u(this,oa)[oa].pivotController.hidePivot(),u(this,oa)[oa].pivotController.endPivot()),this.warn("planView property is deprecated - replaced with navMode")}},{key:"firstPerson",get:function(){return this.warn("firstPerson property is deprecated - replaced with navMode"),u(this,ra)[ra].firstPerson},set:function(e){this.warn("firstPerson property is deprecated - replaced with navMode"),u(this,ra)[ra].firstPerson=!!e,u(this,ra)[ra].planView=!1,u(this,ra)[ra].firstPerson&&(u(this,oa)[oa].pivotController.hidePivot(),u(this,oa)[oa].pivotController.endPivot())}},{key:"constrainVertical",get:function(){return u(this,ra)[ra].constrainVertical},set:function(e){u(this,ra)[ra].constrainVertical=!!e}},{key:"doublePickFlyTo",get:function(){return u(this,ra)[ra].doublePickFlyTo},set:function(e){u(this,ra)[ra].doublePickFlyTo=!1!==e}},{key:"panRightClick",get:function(){return u(this,ra)[ra].panRightClick},set:function(e){u(this,ra)[ra].panRightClick=!1!==e}},{key:"rotationInertia",get:function(){return u(this,ra)[ra].rotationInertia},set:function(e){u(this,ra)[ra].rotationInertia=null!=e?e:0}},{key:"touchPanRate",get:function(){return u(this,ra)[ra].touchPanRate},set:function(e){u(this,ra)[ra].touchPanRate=null!=e?e:1}},{key:"keyboardPanRate",get:function(){return u(this,ra)[ra].keyboardPanRate},set:function(e){u(this,ra)[ra].keyboardPanRate=null!=e?e:5}},{key:"keyboardRotationRate",get:function(){return u(this,ra)[ra].keyboardRotationRate},set:function(e){u(this,ra)[ra].keyboardRotationRate=null!=e?e:90}},{key:"dragRotationRate",get:function(){return u(this,ra)[ra].dragRotationRate},set:function(e){u(this,ra)[ra].dragRotationRate=null!=e?e:360}},{key:"keyboardDollyRate",get:function(){return u(this,ra)[ra].keyboardDollyRate},set:function(e){u(this,ra)[ra].keyboardDollyRate=null!=e?e:15}},{key:"touchDollyRate",get:function(){return u(this,ra)[ra].touchDollyRate},set:function(e){u(this,ra)[ra].touchDollyRate=null!=e?e:.2}},{key:"mouseWheelDollyRate",get:function(){return u(this,ra)[ra].mouseWheelDollyRate},set:function(e){u(this,ra)[ra].mouseWheelDollyRate=null!=e?e:100}},{key:"dollyInertia",get:function(){return u(this,ra)[ra].dollyInertia},set:function(e){u(this,ra)[ra].dollyInertia=null!=e?e:0}},{key:"dollyProximityThreshold",get:function(){return u(this,ra)[ra].dollyProximityThreshold},set:function(e){u(this,ra)[ra].dollyProximityThreshold=null!=e?e:35}},{key:"dollyMinSpeed",get:function(){return u(this,ra)[ra].dollyMinSpeed},set:function(e){u(this,ra)[ra].dollyMinSpeed=null!=e?e:.04}},{key:"panInertia",get:function(){return u(this,ra)[ra].panInertia},set:function(e){u(this,ra)[ra].panInertia=null!=e?e:.5}},{key:"keyboardLayout",get:function(){return u(this,ra)[ra].keyboardLayout},set:function(e){"qwerty"!==(e=e||"qwerty")&&"azerty"!==e&&(this.error("Unsupported value for keyboardLayout - defaulting to 'qwerty'"),e="qwerty"),u(this,ra)[ra].keyboardLayout=e,this.keyMap=u(this,ra)[ra].keyboardLayout}},{key:"smartPivot",get:function(){return u(this,ra)[ra].smartPivot},set:function(e){u(this,ra)[ra].smartPivot=!1!==e}},{key:"keyboardEnabled",get:function(){return u(this,ra)[ra].keyboardEnabled},set:function(e){u(this,ra)[ra].keyboardEnabled=!1!==e}}]),i}(ur);function va(){for(var e=0,t=u(this,aa)[aa].length;e<t;e++){var i=u(this,aa)[aa][e];i.reset&&i.reset()}u(this,sa)[sa].panDeltaX=0,u(this,sa)[sa].panDeltaY=0,u(this,sa)[sa].rotateDeltaX=0,u(this,sa)[sa].rotateDeltaY=0,u(this,sa)[sa].dollyDelta=0}function fa(){for(var e=0,t=u(this,aa)[aa].length;e<t;e++){var i=u(this,aa)[aa][e];i.destroy&&i.destroy()}}function pa(){for(var e in u(this,oa)[oa]){var t=u(this,oa)[oa][e];t.destroy&&t.destroy()}}da.PAN_LEFT=0,da.PAN_RIGHT=1,da.PAN_UP=2,da.PAN_DOWN=3,da.PAN_FORWARDS=4,da.PAN_BACKWARDS=5,da.ROTATE_X_POS=6,da.ROTATE_X_NEG=7,da.ROTATE_Y_POS=8,da.ROTATE_Y_NEG=9,da.DOLLY_FORWARDS=10,da.DOLLY_BACKWARDS=11,da.AXIS_VIEW_RIGHT=12,da.AXIS_VIEW_BACK=13,da.AXIS_VIEW_LEFT=14,da.AXIS_VIEW_FRONT=15,da.AXIS_VIEW_TOP=16,da.AXIS_VIEW_BOTTOM=17;var ya,ga=/*#__PURE__*/c("state"),ba=/*#__PURE__*/function(){function e(e,t,i){void 0===i&&(i={}),this.id=void 0,this.layer=void 0,this.sceneObject=void 0,Object.defineProperty(this,ga,{writable:!0,value:void 0}),this.id=t.id,this.layer=e,this.sceneObject=t,u(this,ga)[ga]={visible:null,culled:null,pickable:null,clippable:null,collidable:null,xrayed:null,selected:null,highlighted:null,edges:null,colorize:new Float32Array(4),colorized:!1,opacityUpdated:!1},this.visible=!1!==i.visible,this.xrayed=!!i.xrayed,this.edges=!!i.edges,this.culled=!!i.culled,this.pickable=!1!==i.pickable,this.clippable=!1!==i.clippable,this.collidable=!1!==i.collidable,this.highlighted=!!i.highlighted,this.selected=!!i.selected,this.colorize=i.colorize,this.opacity=i.opacity}return e.prototype._destroy=function(){u(this,ga)[ga].visible&&this.layer.objectVisibilityUpdated(this,!1,!1),u(this,ga)[ga].xrayed&&this.layer.objectXRayedUpdated(this,!1),u(this,ga)[ga].selected&&this.layer.objectSelectedUpdated(this,!1),u(this,ga)[ga].highlighted&&this.layer.objectHighlightedUpdated(this,!1),u(this,ga)[ga].colorized&&this.layer.objectColorizeUpdated(this,!1),u(this,ga)[ga].opacityUpdated&&this.layer.objectOpacityUpdated(this,!1),this.layer.redraw()},r(e,[{key:"visible",get:function(){return u(this,ga)[ga].visible},set:function(e){e!==u(this,ga)[ga].visible&&(u(this,ga)[ga].visible=e,this.sceneObject.setVisible(this.layer.view.viewIndex,e),this.layer.objectVisibilityUpdated(this,e,!0),this.layer.redraw())}},{key:"xrayed",get:function(){return u(this,ga)[ga].xrayed},set:function(e){u(this,ga)[ga].xrayed!==e&&(u(this,ga)[ga].xrayed=e,this.sceneObject.setXRayed(this.layer.view.viewIndex,e),this.layer.objectXRayedUpdated(this,e),this.layer.redraw())}},{key:"edges",get:function(){return u(this,ga)[ga].edges},set:function(e){u(this,ga)[ga].edges!==e&&(u(this,ga)[ga].edges=e,this.sceneObject.setEdges(this.layer.view.viewIndex,e),this.layer.redraw())}},{key:"highlighted",get:function(){return u(this,ga)[ga].highlighted},set:function(e){e!==u(this,ga)[ga].highlighted&&(u(this,ga)[ga].highlighted=e,this.sceneObject.setHighlighted(this.layer.view.viewIndex,e),this.layer.objectHighlightedUpdated(this,e),this.layer.redraw())}},{key:"selected",get:function(){return u(this,ga)[ga].selected},set:function(e){e!==u(this,ga)[ga].selected&&(u(this,ga)[ga].selected=e,this.sceneObject.setSelected(this.layer.view.viewIndex,e),this.layer.objectSelectedUpdated(this,e),this.layer.redraw())}},{key:"culled",get:function(){return u(this,ga)[ga].culled},set:function(e){e!==u(this,ga)[ga].culled&&(u(this,ga)[ga].culled=e,this.layer.redraw())}},{key:"clippable",get:function(){return u(this,ga)[ga].clippable},set:function(e){e!==u(this,ga)[ga].clippable&&(u(this,ga)[ga].clippable=e,this.layer.redraw())}},{key:"collidable",get:function(){return u(this,ga)[ga].collidable},set:function(e){e!==u(this,ga)[ga].collidable&&(u(this,ga)[ga].collidable=e)}},{key:"pickable",get:function(){return u(this,ga)[ga].pickable},set:function(e){u(this,ga)[ga].pickable!==e&&(u(this,ga)[ga].pickable=e)}},{key:"colorize",get:function(){return u(this,ga)[ga].colorize},set:function(e){var t=u(this,ga)[ga].colorize;e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),u(this,ga)[ga].colorized=!!e,this.layer.objectColorizeUpdated(this,u(this,ga)[ga].colorized),this.layer.redraw()}},{key:"opacity",get:function(){return u(this,ga)[ga].colorize[3]},set:function(e){var t=u(this,ga)[ga].colorize;u(this,ga)[ga].opacityUpdated=null!=e,t[3]=u(this,ga)[ga].opacityUpdated?e:1,this.layer.objectOpacityUpdated(this,u(this,ga)[ga].opacityUpdated),this.layer.redraw()}}]),e}(),wa=/*#__PURE__*/c("state"),ma=/*#__PURE__*/function(t){function i(i,r){var n;return void 0===r&&(r={}),(n=t.call(this,i,r)||this).view=void 0,n.onPos=void 0,n.onDir=void 0,n.onActive=void 0,Object.defineProperty(o(n),wa,{writable:!0,value:void 0}),n.view=i,u(o(n),wa)[wa]={active:!1!==r.active,pos:new Float64Array(r.pos||[0,0,0]),dir:new Float32Array(r.pos||[0,0,-1]),dist:0},n.onPos=new v(new e.EventDispatcher),n.onDir=new v(new e.EventDispatcher),n.onActive=new v(new e.EventDispatcher),n}n(i,t);var s=i.prototype;return s.flipDir=function(){var e=u(this,wa)[wa].dir;e[0]*=-1,e[1]*=-1,e[2]*=-1,u(this,wa)[wa].dist=-M(u(this,wa)[wa].pos,u(this,wa)[wa].dir),this.onDir.dispatch(this,u(this,wa)[wa].dir),this.view.redraw()},s.destroy=function(){this.onPos.clear(),this.onDir.clear(),t.prototype.destroy.call(this)},r(i,[{key:"active",get:function(){return u(this,wa)[wa].active},set:function(e){u(this,wa)[wa].active!==e&&(u(this,wa)[wa].active=e,this.view.redraw(),this.onActive.dispatch(this,u(this,wa)[wa].active))}},{key:"pos",get:function(){return u(this,wa)[wa].pos},set:function(e){u(this,wa)[wa].pos.set(e),u(this,wa)[wa].dist=-M(u(this,wa)[wa].pos,u(this,wa)[wa].dir),this.onPos.dispatch(this,u(this,wa)[wa].pos)}},{key:"dir",get:function(){return u(this,wa)[wa].dir},set:function(e){u(this,wa)[wa].dir.set(e),u(this,wa)[wa].dist=-M(u(this,wa)[wa].pos,u(this,wa)[wa].dir),this.view.redraw(),this.onDir.dispatch(this,u(this,wa)[wa].dir)}},{key:"dist",get:function(){return u(this,wa)[wa].dist}}]),i}(ur),Pa=/*#__PURE__*/c("state"),_a=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(o(r),Pa,{writable:!0,value:void 0}),r.view=t,u(o(r),Pa)[Pa]={fill:!!i.fill,fillColor:new Float32Array(i.fillColor||[.4,.4,.4]),fillAlpha:null!=i.fillAlpha?i.fillAlpha:.2,edges:!1!==i.edges,edgeColor:new Float32Array(i.edgeColor||[.2,.2,.2]),edgeAlpha:null!=i.edgeAlpha?i.edgeAlpha:.5,edgeWidth:null!=i.edgeWidth?i.edgeWidth:1,backfaces:!!i.backfaces},r}return n(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this)},r(t,[{key:"fill",get:function(){return u(this,Pa)[Pa].fill},set:function(e){u(this,Pa)[Pa].fill!==e&&(u(this,Pa)[Pa].fill=e,this.view.redraw())}},{key:"fillColor",get:function(){return u(this,Pa)[Pa].fillColor},set:function(e){var t=u(this,Pa)[Pa].fillColor;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]||(t[0]=.4,t[1]=.4,t[2]=.4,this.view.redraw())}},{key:"fillAlpha",get:function(){return u(this,Pa)[Pa].fillAlpha},set:function(e){u(this,Pa)[Pa].fillAlpha!==e&&(u(this,Pa)[Pa].fillAlpha=e,this.view.redraw())}},{key:"edges",get:function(){return u(this,Pa)[Pa].edges},set:function(e){u(this,Pa)[Pa].edges!==e&&(u(this,Pa)[Pa].edges=e,this.view.redraw())}},{key:"edgeColor",get:function(){return u(this,Pa)[Pa].edgeColor},set:function(e){var t=u(this,Pa)[Pa].edgeColor;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]||(t[0]=.2,t[1]=.2,t[2]=.2,this.view.redraw())}},{key:"edgeAlpha",get:function(){return u(this,Pa)[Pa].edgeAlpha},set:function(e){u(this,Pa)[Pa].edgeAlpha!==e&&(u(this,Pa)[Pa].edgeAlpha=e,this.view.redraw())}},{key:"edgeWidth",get:function(){return u(this,Pa)[Pa].edgeWidth},set:function(e){u(this,Pa)[Pa].edgeWidth=e,this.view.redraw()}},{key:"backfaces",get:function(){return u(this,Pa)[Pa].backfaces},set:function(e){u(this,Pa)[Pa].backfaces!==e&&(u(this,Pa)[Pa].backfaces=e,this.view.redraw())}},{key:"hash",get:function(){return""}}]),t}(ur),Ea=/*#__PURE__*/c("state"),Ta=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(o(r),Ea,{writable:!0,value:void 0}),r.view=t,u(o(r),Ea)[Ea]={renderModes:i.renderModes||[_t],edges:!1!==i.edges,edgeColor:new Float32Array(i.edgeColor||[.2,.2,.2]),edgeAlpha:null!=i.edgeAlpha?i.edgeAlpha:.5,edgeWidth:null!=i.edgeWidth?i.edgeWidth:1},r}return n(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this)},r(t,[{key:"renderModes",get:function(){return u(this,Ea)[Ea].renderModes},set:function(e){u(this,Ea)[Ea].renderModes=e,this.view.redraw()}},{key:"edges",get:function(){return u(this,Ea)[Ea].edges},set:function(e){u(this,Ea)[Ea].edges!==e&&(u(this,Ea)[Ea].edges=e,this.view.redraw())}},{key:"edgeColor",get:function(){return u(this,Ea)[Ea].edgeColor},set:function(e){var t=u(this,Ea)[Ea].edgeColor;e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]||(t[0]=.2,t[1]=.2,t[2]=.2,this.view.redraw())}},{key:"edgeAlpha",get:function(){return u(this,Ea)[Ea].edgeAlpha},set:function(e){u(this,Ea)[Ea].edgeAlpha!==e&&(u(this,Ea)[Ea].edgeAlpha=e,this.view.redraw())}},{key:"edgeWidth",get:function(){return u(this,Ea)[Ea].edgeWidth},set:function(e){u(this,Ea)[Ea].edgeWidth!==e&&(u(this,Ea)[Ea].edgeWidth=e,this.view.redraw())}}]),t}(ur),xa=/*#__PURE__*/c("state"),Ma=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(o(r),xa,{writable:!0,value:void 0}),r.view=t,u(o(r),xa)[xa]={pointSize:null!=i.pointSize?i.pointSize:1,roundPoints:!1!==i.roundPoints,perspectivePoints:!1!==i.perspectivePoints,minPerspectivePointSize:null!=i.minPerspectivePointSize?i.minPerspectivePointSize:1,maxPerspectivePointSize:null!=i.maxPerspectivePointSize?i.maxPerspectivePointSize:6,filterIntensity:!!i.filterIntensity,minIntensity:null!=i.minIntensity?i.minIntensity:0,maxIntensity:null!=i.maxIntensity?i.maxIntensity:1},r}return n(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this)},r(t,[{key:"pointSize",get:function(){return u(this,xa)[xa].pointSize},set:function(e){u(this,xa)[xa].pointSize=e,this.view.redraw()}},{key:"roundPoints",get:function(){return u(this,xa)[xa].roundPoints},set:function(e){u(this,xa)[xa].roundPoints!==e&&(u(this,xa)[xa].roundPoints=e,this.view.rebuild())}},{key:"perspectivePoints",get:function(){return u(this,xa)[xa].perspectivePoints},set:function(e){u(this,xa)[xa].perspectivePoints!==e&&(u(this,xa)[xa].perspectivePoints=e,this.view.rebuild())}},{key:"minPerspectivePointSize",get:function(){return u(this,xa)[xa].minPerspectivePointSize},set:function(e){u(this,xa)[xa].minPerspectivePointSize!==e&&(u(this,xa)[xa].minPerspectivePointSize=e,this.view.rebuild())}},{key:"maxPerspectivePointSize",get:function(){return u(this,xa)[xa].maxPerspectivePointSize},set:function(e){u(this,xa)[xa].maxPerspectivePointSize!==e&&(u(this,xa)[xa].maxPerspectivePointSize=e,this.view.rebuild())}},{key:"filterIntensity",get:function(){return u(this,xa)[xa].filterIntensity},set:function(e){u(this,xa)[xa].filterIntensity!==e&&(u(this,xa)[xa].filterIntensity=e,this.view.rebuild())}},{key:"minIntensity",get:function(){return u(this,xa)[xa].minIntensity},set:function(e){u(this,xa)[xa].minIntensity!==e&&(u(this,xa)[xa].minIntensity=e,this.view.redraw())}},{key:"maxIntensity",get:function(){return u(this,xa)[xa].maxIntensity},set:function(e){u(this,xa)[xa].maxIntensity!==e&&(u(this,xa)[xa].maxIntensity=e,this.view.redraw())}},{key:"hash",get:function(){var e=u(this,xa)[xa];return e.pointSize+";\n        "+e.roundPoints+";\n        "+e.perspectivePoints+";\n        "+e.minPerspectivePointSize+";\n        "+e.maxPerspectivePointSize+";\n        "+e.filterIntensity}}]),t}(ur),Oa=/*#__PURE__*/c("viewObject"),ja=/*#__PURE__*/c("gotCanvasPos"),Ra=/*#__PURE__*/c("gotOrigin"),Sa=/*#__PURE__*/c("gotDirection"),Aa=/*#__PURE__*/c("gotIndices"),Ca=/*#__PURE__*/c("gotLocalPos"),ka=/*#__PURE__*/c("gotWorldPos"),Da=/*#__PURE__*/c("gotViewPos"),Ia=/*#__PURE__*/c("gotWorldNormal"),Ba=/*#__PURE__*/c("gotUV"),La=/*#__PURE__*/c("canvasPos"),Fa=/*#__PURE__*/c("origin"),Ua=/*#__PURE__*/c("direction"),Na=/*#__PURE__*/c("indices"),Xa=/*#__PURE__*/c("localPos"),Ga=/*#__PURE__*/c("worldPos"),Va=/*#__PURE__*/c("viewPos"),Ha=/*#__PURE__*/c("worldNormal"),Wa=/*#__PURE__*/c("uv"),Ya=/*#__PURE__*/function(){function e(){Object.defineProperty(this,Oa,{writable:!0,value:void 0}),Object.defineProperty(this,ja,{writable:!0,value:void 0}),Object.defineProperty(this,Ra,{writable:!0,value:void 0}),Object.defineProperty(this,Sa,{writable:!0,value:void 0}),Object.defineProperty(this,Aa,{writable:!0,value:void 0}),Object.defineProperty(this,Ca,{writable:!0,value:void 0}),Object.defineProperty(this,ka,{writable:!0,value:void 0}),Object.defineProperty(this,Da,{writable:!0,value:void 0}),Object.defineProperty(this,Ia,{writable:!0,value:void 0}),Object.defineProperty(this,Ba,{writable:!0,value:void 0}),Object.defineProperty(this,La,{writable:!0,value:void 0}),Object.defineProperty(this,Fa,{writable:!0,value:void 0}),Object.defineProperty(this,Ua,{writable:!0,value:void 0}),Object.defineProperty(this,Na,{writable:!0,value:void 0}),Object.defineProperty(this,Xa,{writable:!0,value:void 0}),Object.defineProperty(this,Ga,{writable:!0,value:void 0}),Object.defineProperty(this,Va,{writable:!0,value:void 0}),Object.defineProperty(this,Ha,{writable:!0,value:void 0}),Object.defineProperty(this,Wa,{writable:!0,value:void 0}),u(this,Oa)[Oa]=null,u(this,La)[La]=new Int16Array([0,0]),u(this,Fa)[Fa]=new Float64Array([0,0,0]),u(this,Ua)[Ua]=new Float64Array([0,0,0]),u(this,Na)[Na]=new Int32Array(3),u(this,Xa)[Xa]=new Float64Array([0,0,0]),u(this,Ga)[Ga]=new Float64Array([0,0,0]),u(this,Va)[Va]=new Float64Array([0,0,0]),u(this,Ha)[Ha]=new Float64Array([0,0,0]),u(this,Wa)[Wa]=new Float64Array([0,0]),u(this,Ra)[Ra]=!1,u(this,Sa)[Sa]=!1,u(this,Aa)[Aa]=!1,u(this,ja)[ja]=!1,u(this,Ca)[Ca]=!1,u(this,ka)[ka]=!1,u(this,Da)[Da]=!1,u(this,Ia)[Ia]=!1,u(this,Ba)[Ba]=!1,this.reset()}return e.prototype.reset=function(){u(this,Oa)[Oa]=null,u(this,ja)[ja]=!1,u(this,Ra)[Ra]=!1,u(this,Sa)[Sa]=!1,u(this,Aa)[Aa]=!1,u(this,Ca)[Ca]=!1,u(this,ka)[ka]=!1,u(this,Da)[Da]=!1,u(this,Ia)[Ia]=!1,u(this,Ba)[Ba]=!1},r(e,[{key:"viewObject",get:function(){return u(this,Oa)[Oa]},set:function(e){u(this,Oa)[Oa]=e}},{key:"canvasPos",get:function(){return u(this,ja)[ja]?u(this,La)[La]:void 0},set:function(e){e?(u(this,La)[La][0]=e[0],u(this,La)[La][1]=e[1],u(this,ja)[ja]=!0):u(this,ja)[ja]=!1}},{key:"origin",get:function(){return u(this,Ra)[Ra]?u(this,Fa)[Fa]:null},set:function(e){e?(u(this,Fa)[Fa][0]=e[0],u(this,Fa)[Fa][1]=e[1],u(this,Fa)[Fa][2]=e[2],u(this,Ra)[Ra]=!0):u(this,Ra)[Ra]=!1}},{key:"direction",get:function(){return u(this,Sa)[Sa]?u(this,Ua)[Ua]:null},set:function(e){e?(u(this,Ua)[Ua][0]=e[0],u(this,Ua)[Ua][1]=e[1],u(this,Ua)[Ua][2]=e[2],u(this,Sa)[Sa]=!0):u(this,Sa)[Sa]=!1}},{key:"indices",get:function(){return u(this,Oa)[Oa]&&u(this,Aa)[Aa]?u(this,Na)[Na]:null},set:function(e){e?(u(this,Na)[Na][0]=e[0],u(this,Na)[Na][1]=e[1],u(this,Na)[Na][2]=e[2],u(this,Aa)[Aa]=!0):u(this,Aa)[Aa]=!1}},{key:"localPos",get:function(){return u(this,Oa)[Oa]&&u(this,Ca)[Ca]?u(this,Xa)[Xa]:null},set:function(e){e?(u(this,Xa)[Xa][0]=e[0],u(this,Xa)[Xa][1]=e[1],u(this,Xa)[Xa][2]=e[2],u(this,Ca)[Ca]=!0):u(this,Ca)[Ca]=!1}},{key:"worldPos",get:function(){return u(this,Oa)[Oa]&&u(this,ka)[ka]?u(this,Ga)[Ga]:null},set:function(e){e?(u(this,Ga)[Ga][0]=e[0],u(this,Ga)[Ga][1]=e[1],u(this,Ga)[Ga][2]=e[2],u(this,ka)[ka]=!0):u(this,ka)[ka]=!1}},{key:"viewPos",get:function(){return u(this,Oa)[Oa]&&u(this,Da)[Da]?u(this,Va)[Va]:null},set:function(e){e?(u(this,Va)[Va][0]=e[0],u(this,Va)[Va][1]=e[1],u(this,Va)[Va][2]=e[2],u(this,Da)[Da]=!0):u(this,Da)[Da]=!1}},{key:"worldNormal",get:function(){return u(this,Oa)[Oa]&&u(this,Ia)[Ia]?u(this,Ha)[Ha]:null},set:function(e){e?(u(this,Ha)[Ha][0]=e[0],u(this,Ha)[Ha][1]=e[1],u(this,Ha)[Ha][2]=e[2],u(this,Ia)[Ia]=!0):u(this,Ia)[Ia]=!1}},{key:"uv",get:function(){return u(this,Oa)[Oa]&&u(this,Ba)[Ba]?u(this,Wa)[Wa]:null},set:function(e){e?(u(this,Wa)[Wa][0]=e[0],u(this,Wa)[Wa][1]=e[1],u(this,Ba)[Ba]=!0):u(this,Ba)[Ba]=!1}}]),e}(),za=((ya={})[4e5]={abbrev:"m"},ya[400001]={abbrev:"cm"},ya[400002]={abbrev:"mm"},ya[400003]={abbrev:"yd"},ya[400004]={abbrev:"ft"},ya[400005]={abbrev:"in"},ya),Ka=/*#__PURE__*/c("units"),qa=/*#__PURE__*/c("scale"),Za=/*#__PURE__*/c("origin"),Qa=/*#__PURE__*/function(t){function i(i,r){var n;return void 0===r&&(r={units:Et,scale:1,origin:[1,1,1]}),n=t.call(this,i,r)||this,Object.defineProperty(o(n),Ka,{writable:!0,value:void 0}),Object.defineProperty(o(n),qa,{writable:!0,value:void 0}),Object.defineProperty(o(n),Za,{writable:!0,value:void 0}),n.onUnits=void 0,n.onScale=void 0,n.onOrigin=void 0,n.onUnits=new v(new e.EventDispatcher),n.onScale=new v(new e.EventDispatcher),n.onOrigin=new v(new e.EventDispatcher),u(o(n),Ka)[Ka]=Et,u(o(n),qa)[qa]=1,u(o(n),Za)[Za]=j([0,0,0]),n.units=r.units,n.scale=r.scale,n.origin=r.origin,n}n(i,t);var s=i.prototype;return s.worldToRealPos=function(e,t){return void 0===t&&(t=j()),t[0]=u(this,Za)[Za][0]+u(this,qa)[qa]*e[0],t[1]=u(this,Za)[Za][1]+u(this,qa)[qa]*e[1],t[2]=u(this,Za)[Za][2]+u(this,qa)[qa]*e[2],t},s.realToWorldPos=function(e,t){return void 0===t&&(t=j()),t[0]=(e[0]-u(this,Za)[Za][0])/u(this,qa)[qa],t[1]=(e[1]-u(this,Za)[Za][1])/u(this,qa)[qa],t[2]=(e[2]-u(this,Za)[Za][2])/u(this,qa)[qa],t},s.destroy=function(){t.prototype.destroy.call(this),this.onUnits.clear(),this.onScale.clear(),this.onOrigin.clear()},r(i,[{key:"unitsInfo",get:function(){return za}},{key:"units",get:function(){return u(this,Ka)[Ka]},set:function(e){e||(e=Et),za[e]||(this.error("Unsupported value for 'units': "+e+" defaulting to MetersUnit"),e=Et),u(this,Ka)[Ka]=e,this.onUnits.dispatch(this,u(this,Ka)[Ka])}},{key:"scale",get:function(){return u(this,qa)[qa]},set:function(e){(e=e||1)<=0?this.error("scale value should be larger than zero"):(u(this,qa)[qa]=e,this.onScale.dispatch(this,u(this,qa)[qa]))}},{key:"origin",get:function(){return u(this,Za)[Za]},set:function(e){if(!e)return u(this,Za)[Za][0]=0,u(this,Za)[Za][1]=0,void(u(this,Za)[Za][2]=0);u(this,Za)[Za][0]=e[0],u(this,Za)[Za][1]=e[1],u(this,Za)[Za][2]=e[2],this.onOrigin.dispatch(this,u(this,Za)[Za])}}]),i}(ur),Ja=/*#__PURE__*/c("state"),$a=/*#__PURE__*/function(e){function t(t,i){var r;return(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(o(r),Ja,{writable:!0,value:void 0}),r.view=t,u(o(r),Ja)[Ja]={renderModes:[_t],enabled:!1!==i.enabled,kernelRadius:i.kernelRadius||100,intensity:void 0!==i.intensity?i.intensity:.15,bias:void 0!==i.bias?i.bias:.5,scale:void 0!==i.scale?i.scale:1,minResolution:void 0!==i.minResolution?i.minResolution:0,numSamples:void 0!==i.numSamples?i.numSamples:10,blur:!!i.blur,blendCutoff:void 0!==i.blendCutff?i.blendCutoff:.3,blendFactor:void 0!==i.blendFactor?i.blendFactor:1},r}return n(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this)},r(t,[{key:"renderModes",get:function(){return u(this,Ja)[Ja].renderModes},set:function(e){u(this,Ja)[Ja].renderModes=e,this.view.redraw()}},{key:"supported",get:function(){return this.viewer.renderer.getSAOSupported()}},{key:"enabled",get:function(){return u(this,Ja)[Ja].enabled},set:function(e){e=!!e,u(this,Ja)[Ja].enabled!==e&&(u(this,Ja)[Ja].enabled=e,this.view.redraw())}},{key:"possible",get:function(){if(!this.supported)return!1;if(!u(this,Ja)[Ja].enabled)return!1;var e=this.view.camera.projection;return e!==Ot&&e!==Mt}},{key:"kernelRadius",get:function(){return u(this,Ja)[Ja].kernelRadius},set:function(e){null==e&&(e=100),u(this,Ja)[Ja].kernelRadius!==e&&(u(this,Ja)[Ja].kernelRadius=e,this.view.redraw())}},{key:"intensity",get:function(){return u(this,Ja)[Ja].intensity},set:function(e){null==e&&(e=.15),u(this,Ja)[Ja].intensity!==e&&(u(this,Ja)[Ja].intensity=e,this.view.redraw())}},{key:"bias",get:function(){return u(this,Ja)[Ja].bias},set:function(e){null==e&&(e=.5),u(this,Ja)[Ja].bias!==e&&(u(this,Ja)[Ja].bias=e,this.view.redraw())}},{key:"scale",get:function(){return u(this,Ja)[Ja].scale},set:function(e){null==e&&(e=1),u(this,Ja)[Ja].scale!==e&&(u(this,Ja)[Ja].scale=e,this.view.redraw())}},{key:"minResolution",get:function(){return u(this,Ja)[Ja].minResolution},set:function(e){null==e&&(e=0),u(this,Ja)[Ja].minResolution!==e&&(u(this,Ja)[Ja].minResolution=e,this.view.redraw())}},{key:"numSamples",get:function(){return u(this,Ja)[Ja].numSamples},set:function(e){null==e&&(e=10),u(this,Ja)[Ja].numSamples!==e&&(u(this,Ja)[Ja].numSamples=e,this.view.redraw())}},{key:"blur",get:function(){return u(this,Ja)[Ja].blur},set:function(e){e=!1!==e,u(this,Ja)[Ja].blur!==e&&(u(this,Ja)[Ja].blur=e,this.view.redraw())}},{key:"blendCutoff",get:function(){return u(this,Ja)[Ja].blendCutoff},set:function(e){null==e&&(e=.3),u(this,Ja)[Ja].blendCutoff!==e&&(u(this,Ja)[Ja].blendCutoff=e,this.view.redraw())}},{key:"blendFactor",get:function(){return u(this,Ja)[Ja].blendFactor},set:function(e){null==e&&(e=1),u(this,Ja)[Ja].blendFactor!==e&&(u(this,Ja)[Ja].blendFactor=e,this.view.redraw())}}]),t}(ur),eh=/*#__PURE__*/c("state"),th=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={lineWidth:1}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(o(r),eh,{writable:!0,value:void 0}),r.view=t,u(o(r),eh)[eh]={lineWidth:null!=i.lineWidth?i.lineWidth:1},r}return n(t,e),r(t,[{key:"lineWidth",get:function(){return u(this,eh)[eh].lineWidth},set:function(e){u(this,eh)[eh].lineWidth=e||1,this.view.redraw()}}]),t}(ur),ih=/*#__PURE__*/c("numObjects"),rh=/*#__PURE__*/c("objectIds"),nh=/*#__PURE__*/c("numVisibleObjects"),sh=/*#__PURE__*/c("visibleObjectIds"),oh=/*#__PURE__*/c("numXRayedObjects"),ah=/*#__PURE__*/c("xrayedObjectIds"),hh=/*#__PURE__*/c("numHighlightedObjects"),lh=/*#__PURE__*/c("highlightedObjectIds"),ch=/*#__PURE__*/c("numSelectedObjects"),uh=/*#__PURE__*/c("selectedObjectIds"),dh=/*#__PURE__*/c("numColorizedObjects"),vh=/*#__PURE__*/c("colorizedObjectIds"),fh=/*#__PURE__*/c("numOpacityObjects"),ph=/*#__PURE__*/c("opacityObjectIds"),yh=/*#__PURE__*/c("qualityRender"),gh=/*#__PURE__*/c("initObjects"),bh=/*#__PURE__*/c("createObjects"),wh=/*#__PURE__*/c("destroyObjects"),mh=/*#__PURE__*/function(t){function i(i){var r;return r=t.call(this,i.view,i)||this,Object.defineProperty(o(r),wh,{value:Eh}),Object.defineProperty(o(r),bh,{value:_h}),Object.defineProperty(o(r),gh,{value:Ph}),r.objects=void 0,r.visibleObjects=void 0,r.xrayedObjects=void 0,r.highlightedObjects=void 0,r.selectedObjects=void 0,r.colorizedObjects=void 0,r.opacityObjects=void 0,r.autoDestroy=void 0,r.onObjectVisibility=void 0,Object.defineProperty(o(r),ih,{writable:!0,value:void 0}),Object.defineProperty(o(r),rh,{writable:!0,value:void 0}),Object.defineProperty(o(r),nh,{writable:!0,value:void 0}),Object.defineProperty(o(r),sh,{writable:!0,value:void 0}),Object.defineProperty(o(r),oh,{writable:!0,value:void 0}),Object.defineProperty(o(r),ah,{writable:!0,value:void 0}),Object.defineProperty(o(r),hh,{writable:!0,value:void 0}),Object.defineProperty(o(r),lh,{writable:!0,value:void 0}),Object.defineProperty(o(r),ch,{writable:!0,value:void 0}),Object.defineProperty(o(r),uh,{writable:!0,value:void 0}),Object.defineProperty(o(r),dh,{writable:!0,value:void 0}),Object.defineProperty(o(r),vh,{writable:!0,value:void 0}),Object.defineProperty(o(r),fh,{writable:!0,value:void 0}),Object.defineProperty(o(r),ph,{writable:!0,value:void 0}),Object.defineProperty(o(r),yh,{writable:!0,value:void 0}),r.gammaOutput=void 0,r.id=i.id,r.viewer=i.viewer,r.view=i.view,r.objects={},r.visibleObjects={},r.xrayedObjects={},r.highlightedObjects={},r.selectedObjects={},r.colorizedObjects={},r.opacityObjects={},r.autoDestroy=!1!==i.autoDestroy,u(o(r),ih)[ih]=0,u(o(r),nh)[nh]=0,u(o(r),oh)[oh]=0,u(o(r),hh)[hh]=0,u(o(r),ch)[ch]=0,u(o(r),dh)[dh]=0,u(o(r),fh)[fh]=0,u(o(r),yh)[yh]=!!i.qualityRender,r.onObjectVisibility=new v(new e.EventDispatcher),u(o(r),gh)[gh](),r}n(i,t);var s=i.prototype;return s.registerViewObject=function(e){this.objects[e.id]=e,u(this,ih)[ih]++,u(this,rh)[rh]=null},s.deregisterViewObject=function(e){delete this.objects[e.id],delete this.visibleObjects[e.id],delete this.xrayedObjects[e.id],delete this.highlightedObjects[e.id],delete this.selectedObjects[e.id],delete this.colorizedObjects[e.id],delete this.opacityObjects[e.id],u(this,ih)[ih]--,u(this,rh)[rh]=null},s.redraw=function(){this.viewer.renderer.setImageDirty(this.view.viewIndex)},s.objectVisibilityUpdated=function(e,t,i){void 0===i&&(i=!0),t?(this.visibleObjects[e.id]=e,u(this,nh)[nh]++):(delete this.visibleObjects[e.id],u(this,nh)[nh]--),u(this,sh)[sh]=null,i&&this.onObjectVisibility.dispatch(this,e),this.view.objectVisibilityUpdated(e,t,i)},s.objectXRayedUpdated=function(e,t){t?(this.xrayedObjects[e.id]=e,u(this,oh)[oh]++):(delete this.xrayedObjects[e.id],u(this,oh)[oh]--),u(this,ah)[ah]=null,this.view.objectXRayedUpdated(e,t)},s.objectHighlightedUpdated=function(e,t){t?(this.highlightedObjects[e.id]=e,u(this,hh)[hh]++):(delete this.highlightedObjects[e.id],u(this,hh)[hh]--),u(this,lh)[lh]=null,this.view.objectHighlightedUpdated(e,t)},s.objectSelectedUpdated=function(e,t){t?(this.selectedObjects[e.id]=e,u(this,ch)[ch]++):(delete this.selectedObjects[e.id],u(this,ch)[ch]--),u(this,uh)[uh]=null,this.view.objectSelectedUpdated(e,t)},s.objectColorizeUpdated=function(e,t){t?(this.colorizedObjects[e.id]=e,u(this,dh)[dh]++):(delete this.colorizedObjects[e.id],u(this,dh)[dh]--),u(this,vh)[vh]=null,this.view.objectColorizeUpdated(e,t)},s.objectOpacityUpdated=function(e,t){t?(this.opacityObjects[e.id]=e,u(this,fh)[fh]++):(delete this.opacityObjects[e.id],u(this,fh)[fh]--),u(this,ph)[ph]=null,this.view.objectOpacityUpdated(e,t)},s.setObjectsVisible=function(e,t){return this.withObjects(e,function(e){var i=e.visible!==t;return e.visible=t,i})},s.setObjectsCollidable=function(e,t){return this.withObjects(e,function(e){var i=e.collidable!==t;return e.collidable=t,i})},s.setObjectsCulled=function(e,t){return this.withObjects(e,function(e){var i=e.culled!==t;return e.culled=t,i})},s.setObjectsSelected=function(e,t){return this.withObjects(e,function(e){var i=e.selected!==t;return e.selected=t,i})},s.setObjectsHighlighted=function(e,t){return this.withObjects(e,function(e){var i=e.highlighted!==t;return e.highlighted=t,i})},s.setObjectsXRayed=function(e,t){return this.withObjects(e,function(e){var i=e.xrayed!==t;return i&&(e.xrayed=t),i})},s.setObjectsColorized=function(e,t){return this.withObjects(e,function(e){e.colorize=t})},s.setObjectsOpacity=function(e,t){return this.withObjects(e,function(e){var i=e.opacity!==t;return i&&(e.opacity=t),i})},s.setObjectsPickable=function(e,t){return this.withObjects(e,function(e){var i=e.pickable!==t;return i&&(e.pickable=t),i})},s.setObjectsClippable=function(e,t){return this.withObjects(e,function(e){var i=e.clippable!==t;return i&&(e.clippable=t),i})},s.withObjects=function(e,t){Ai(e)&&(e=[e]);for(var i=!1,r=0,n=e.length;r<n;r++){var s=this.objects[e[r]];s&&(i=t(s)||i)}return i},s.destroy=function(){t.prototype.destroy.call(this)},r(i,[{key:"gammaFactor",get:function(){return 1}},{key:"qualityRender",get:function(){return u(this,yh)[yh]},set:function(e){u(this,yh)[yh]!==e&&(u(this,yh)[yh]=e,this.redraw())}},{key:"numObjects",get:function(){return u(this,ih)[ih]}},{key:"objectIds",get:function(){return u(this,rh)[rh]||(u(this,rh)[rh]=Object.keys(this.objects)),u(this,rh)[rh]}},{key:"numVisibleObjects",get:function(){return u(this,nh)[nh]}},{key:"visibleObjectIds",get:function(){return u(this,sh)[sh]||(u(this,sh)[sh]=Object.keys(this.visibleObjects)),u(this,sh)[sh]}},{key:"numXRayedObjects",get:function(){return u(this,oh)[oh]}},{key:"xrayedObjectIds",get:function(){return u(this,ah)[ah]||(u(this,ah)[ah]=Object.keys(this.xrayedObjects)),u(this,ah)[ah]}},{key:"numHighlightedObjects",get:function(){return u(this,hh)[hh]}},{key:"highlightedObjectIds",get:function(){return u(this,lh)[lh]||(u(this,lh)[lh]=Object.keys(this.highlightedObjects)),u(this,lh)[lh]}},{key:"numSelectedObjects",get:function(){return u(this,ch)[ch]}},{key:"selectedObjectIds",get:function(){return u(this,uh)[uh]||(u(this,uh)[uh]=Object.keys(this.selectedObjects)),u(this,uh)[uh]}},{key:"numColorizedObjects",get:function(){return u(this,dh)[dh]}},{key:"colorizedObjectIds",get:function(){return u(this,vh)[vh]||(u(this,vh)[vh]=Object.keys(this.colorizedObjects)),u(this,vh)[vh]}},{key:"opacityObjectIds",get:function(){return u(this,ph)[ph]||(u(this,ph)[ph]=Object.keys(this.opacityObjects)),u(this,ph)[ph]}},{key:"numOpacityObjects",get:function(){return u(this,fh)[fh]}}]),i}(ur);function Ph(){var e=this,t=this.viewer.scene,i=t.models;for(var r in i){var n=i[r];u(this,bh)[bh](n)}t.onModelCreated.subscribe(function(t,i){u(e,bh)[bh](i)}),t.onModelDestroyed.subscribe(function(t,i){u(e,wh)[wh](i)})}function _h(e){var t=e.objects;for(var i in t){var r=t[i];if(r.viewLayerId==this.id){var n=new ba(this,r,{});this.objects[n.id]=n,u(this,ih)[ih]++,u(this,rh)[rh]=null}}}function Eh(e){var t=e.objects;for(var i in t)this.objects[t[i].id]._destroy(),u(this,ih)[ih]--,u(this,rh)[rh]=null}var Th=/*#__PURE__*/c("numObjects"),xh=/*#__PURE__*/c("objectIds"),Mh=/*#__PURE__*/c("numVisibleObjects"),Oh=/*#__PURE__*/c("visibleObjectIds"),jh=/*#__PURE__*/c("numXRayedObjects"),Rh=/*#__PURE__*/c("xrayedObjectIds"),Sh=/*#__PURE__*/c("numHighlightedObjects"),Ah=/*#__PURE__*/c("highlightedObjectIds"),Ch=/*#__PURE__*/c("numSelectedObjects"),kh=/*#__PURE__*/c("selectedObjectIds"),Dh=/*#__PURE__*/c("numColorizedObjects"),Ih=/*#__PURE__*/c("colorizedObjectIds"),Bh=/*#__PURE__*/c("numOpacityObjects"),Lh=/*#__PURE__*/c("opacityObjectIds"),Fh=/*#__PURE__*/c("qualityRender"),Uh=/*#__PURE__*/c("lightsHash"),Nh=/*#__PURE__*/c("sectionPlanesHash"),Xh=/*#__PURE__*/c("registerSectionPlane"),Gh=/*#__PURE__*/c("deregisterSectionPlane"),Vh=/*#__PURE__*/c("initObjects"),Hh=/*#__PURE__*/c("createObjects"),Wh=/*#__PURE__*/c("destroyObjects"),Yh=/*#__PURE__*/function(t){function i(i){var r;r=t.call(this,null,i)||this,Object.defineProperty(o(r),Wh,{value:Qh}),Object.defineProperty(o(r),Hh,{value:Zh}),Object.defineProperty(o(r),Vh,{value:qh}),Object.defineProperty(o(r),Gh,{value:Kh}),Object.defineProperty(o(r),Xh,{value:zh}),r.viewIndex=void 0,r.camera=void 0,r.canvas=void 0,r.logarithmicDepthBufferEnabled=void 0,r.sao=void 0,r.cameraControl=void 0,r.cameraFlight=void 0,r.metrics=void 0,r.xrayMaterial=void 0,r.highlightMaterial=void 0,r.selectedMaterial=void 0,r.edgeMaterial=void 0,r.pointsMaterial=void 0,r.linesMaterial=void 0,r.objects=void 0,r.visibleObjects=void 0,r.xrayedObjects=void 0,r.highlightedObjects=void 0,r.selectedObjects=void 0,r.colorizedObjects=void 0,r.opacityObjects=void 0,r.sectionPlanes=void 0,r.sectionPlanesList=[],r.lights=void 0,r.lightsList=[],r.gammaOutput=void 0,r.layers=void 0,r.autoLayers=void 0,r.onObjectVisibility=void 0,r.onLayerCreated=void 0,r.onLayerDestroyed=void 0,r.onSectionPlaneCreated=void 0,r.onSectionPlaneDestroyed=void 0,Object.defineProperty(o(r),Th,{writable:!0,value:void 0}),Object.defineProperty(o(r),xh,{writable:!0,value:void 0}),Object.defineProperty(o(r),Mh,{writable:!0,value:void 0}),Object.defineProperty(o(r),Oh,{writable:!0,value:void 0}),Object.defineProperty(o(r),jh,{writable:!0,value:void 0}),Object.defineProperty(o(r),Rh,{writable:!0,value:void 0}),Object.defineProperty(o(r),Sh,{writable:!0,value:void 0}),Object.defineProperty(o(r),Ah,{writable:!0,value:void 0}),Object.defineProperty(o(r),Ch,{writable:!0,value:void 0}),Object.defineProperty(o(r),kh,{writable:!0,value:void 0}),Object.defineProperty(o(r),Dh,{writable:!0,value:void 0}),Object.defineProperty(o(r),Ih,{writable:!0,value:void 0}),Object.defineProperty(o(r),Bh,{writable:!0,value:void 0}),Object.defineProperty(o(r),Lh,{writable:!0,value:void 0}),Object.defineProperty(o(r),Fh,{writable:!0,value:void 0}),Object.defineProperty(o(r),Uh,{writable:!0,value:null}),Object.defineProperty(o(r),Nh,{writable:!0,value:null}),r.viewer=i.viewer;var n=i.canvasElement||document.getElementById(i.canvasId);if(!(n instanceof HTMLCanvasElement))throw"Mandatory View config expected: valid canvasId or canvasElement";return r.viewIndex=0,r.objects={},r.visibleObjects={},r.xrayedObjects={},r.highlightedObjects={},r.selectedObjects={},r.colorizedObjects={},r.opacityObjects={},r.sectionPlanes={},r.sectionPlanesList=[],r.lights={},r.lightsList=[],r.layers={},u(o(r),Th)[Th]=0,u(o(r),xh)[xh]=null,u(o(r),Mh)[Mh]=0,u(o(r),Oh)[Oh]=null,u(o(r),jh)[jh]=0,u(o(r),Rh)[Rh]=null,u(o(r),Sh)[Sh]=0,u(o(r),Ah)[Ah]=null,u(o(r),Ch)[Ch]=0,u(o(r),kh)[kh]=null,u(o(r),Dh)[Dh]=0,u(o(r),Ih)[Ih]=null,u(o(r),Bh)[Bh]=0,u(o(r),Lh)[Lh]=null,u(o(r),Fh)[Fh]=!!i.qualityRender,r.gammaOutput=!0,u(o(r),Nh)[Nh]=null,u(o(r),Uh)[Uh]=null,r.canvas=new os(o(r),{canvas:n,transparent:!!i.transparent,backgroundColor:i.backgroundColor,backgroundColorFromAmbientLight:!!i.backgroundColorFromAmbientLight,premultipliedAlpha:!!i.premultipliedAlpha}),r.canvas.onBoundary.subscribe(function(){r.redraw()}),r.camera=new gn(o(r)),r.sao=new $a(o(r),{}),r.cameraControl=new da(o(r),r.canvas,r.camera,{doublePickFlyTo:!0}),r.cameraFlight=new $n(o(r),{duration:.5}),r.metrics=new Qa(o(r),{units:i.units,scale:i.scale,origin:i.origin}),r.xrayMaterial=new _a(o(r),{fill:!0,fillColor:[.9,.7,.6],fillAlpha:.4,edges:!0,edgeColor:[.5,.4,.4],edgeAlpha:1,edgeWidth:1}),r.highlightMaterial=new _a(o(r),{fill:!0,fillColor:[1,1,0],fillAlpha:.5,edges:!0,edgeColor:[.5,.4,.4],edgeAlpha:1,edgeWidth:1}),r.selectedMaterial=new _a(o(r),{fill:!0,fillColor:[0,1,0],fillAlpha:.5,edges:!0,edgeColor:[.4,.5,.4],edgeAlpha:1,edgeWidth:1}),r.edgeMaterial=new Ta(o(r),{edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1,edges:!0,renderModes:[_t]}),r.pointsMaterial=new Ma(o(r),{pointSize:1,roundPoints:!0,perspectivePoints:!0,minPerspectivePointSize:1,maxPerspectivePointSize:6,filterIntensity:!1,minIntensity:0,maxIntensity:1}),r.linesMaterial=new th(o(r),{lineWidth:1}),r.lights={},u(o(r),Fh)[Fh]=!!i.qualityRender,r.autoLayers=!1!==i.autoLayers,r.logarithmicDepthBufferEnabled=!!i.logarithmicDepthBufferEnabled,r.onObjectVisibility=new v(new e.EventDispatcher),r.onLayerCreated=new v(new e.EventDispatcher),r.onLayerDestroyed=new v(new e.EventDispatcher),r.onSectionPlaneCreated=new v(new e.EventDispatcher),r.onSectionPlaneDestroyed=new v(new e.EventDispatcher),u(o(r),Vh)[Vh](),r}n(i,t);var s=i.prototype;return s.registerViewObject=function(e){this.objects[e.id]=e,u(this,Th)[Th]++,u(this,xh)[xh]=null},s.deregisterViewObject=function(e){delete this.objects[e.id],delete this.visibleObjects[e.id],delete this.xrayedObjects[e.id],delete this.highlightedObjects[e.id],delete this.selectedObjects[e.id],delete this.colorizedObjects[e.id],delete this.opacityObjects[e.id],u(this,Th)[Th]--,u(this,xh)[xh]=null},s.objectVisibilityUpdated=function(e,t,i){void 0===i&&(i=!0),t?(this.visibleObjects[e.id]=e,u(this,Mh)[Mh]++):(delete this.visibleObjects[e.id],u(this,Mh)[Mh]--),u(this,Oh)[Oh]=null,i&&this.onObjectVisibility.dispatch(this,e)},s.objectXRayedUpdated=function(e,t){t?(this.xrayedObjects[e.id]=e,u(this,jh)[jh]++):(delete this.xrayedObjects[e.id],u(this,jh)[jh]--),u(this,Rh)[Rh]=null},s.objectHighlightedUpdated=function(e,t){t?(this.highlightedObjects[e.id]=e,u(this,Sh)[Sh]++):(delete this.highlightedObjects[e.id],u(this,Sh)[Sh]--),u(this,Ah)[Ah]=null},s.objectSelectedUpdated=function(e,t){t?(this.selectedObjects[e.id]=e,u(this,Ch)[Ch]++):(delete this.selectedObjects[e.id],u(this,Ch)[Ch]--),u(this,kh)[kh]=null},s.objectColorizeUpdated=function(e,t){t?(this.colorizedObjects[e.id]=e,u(this,Dh)[Dh]++):(delete this.colorizedObjects[e.id],u(this,Dh)[Dh]--),u(this,Ih)[Ih]=null},s.objectOpacityUpdated=function(e,t){t?(this.opacityObjects[e.id]=e,u(this,Bh)[Bh]++):(delete this.opacityObjects[e.id],u(this,Bh)[Bh]--),u(this,Lh)[Lh]=null},s.createSectionPlane=function(e){var t=this,i=e.id||Ii();this.sectionPlanes[i]&&(this.error('SectionPlane with ID "'+i+'" already exists - will randomly-generate ID'),i=Ii());var r=new ma(this,e);return u(this,Xh)[Xh](r),r.onDestroyed.one(function(){u(t,Gh)[Gh](r)}),r},s.clearSectionPlanes=function(){for(var e=Object.keys(this.sectionPlanes),t=0,i=e.length;t<i;t++)this.sectionPlanes[e[t]].destroy();this.sectionPlanesList.length=0,u(this,Nh)[Nh]=null},s.getSectionPlanesHash=function(){if(u(this,Nh)[Nh])return u(this,Nh)[Nh];if(0===this.sectionPlanesList.length)return u(this,Nh)[Nh]=";";for(var e=[],t=0,i=this.sectionPlanesList.length;t<i;t++)e.push("cp");return e.push(";"),u(this,Nh)[Nh]=e.join(""),u(this,Nh)[Nh]},s.registerLight=function(e){this.lightsList.push(e),this.lights[e.id]=e,u(this,Uh)[Uh]=null,this.rebuild()},s.deregisterLight=function(e){for(var t=0,i=this.lightsList.length;t<i;t++)if(this.lightsList[t].id===e.id)return this.lightsList.splice(t,1),u(this,Uh)[Uh]=null,delete this.lights[e.id],void this.rebuild()},s.clearLights=function(){for(var e=Object.keys(this.lights),t=0,i=e.length;t<i;t++)this.lights[e[t]].destroy()},s.getLightsHash=function(){if(u(this,Uh)[Uh])return u(this,Uh)[Uh];if(0===this.lightsList.length)return u(this,Uh)[Uh]=";";for(var e=[],t=this.lightsList,i=0,r=t.length;i<r;i++){var n=t[i];e.push("/"),e.push(n.type),e.push("world"===n.space?"w":"v"),n.castsShadow&&e.push("sh")}return e.push(";"),u(this,Uh)[Uh]=e.join(""),u(this,Uh)[Uh]},s.rebuild=function(){this.viewer.renderer.needsRebuild(this.viewIndex)},s.redraw=function(){this.viewer.renderer.setImageDirty(this.viewIndex)},s.destroy=function(){t.prototype.destroy.call(this),this.onObjectVisibility.clear(),this.onLayerCreated.clear(),this.onLayerDestroyed.clear(),this.onSectionPlaneCreated.clear(),this.onSectionPlaneDestroyed.clear()},s.getAmbientColorAndIntensity=function(){return[0,0,0,1]},s.setObjectsVisible=function(e,t){return this.withObjects(e,function(e){var i=e.visible!==t;return e.visible=t,i})},s.setObjectsCollidable=function(e,t){return this.withObjects(e,function(e){var i=e.collidable!==t;return e.collidable=t,i})},s.setObjectsCulled=function(e,t){return this.withObjects(e,function(e){var i=e.culled!==t;return e.culled=t,i})},s.setObjectsSelected=function(e,t){return this.withObjects(e,function(e){var i=e.selected!==t;return e.selected=t,i})},s.setObjectsHighlighted=function(e,t){return this.withObjects(e,function(e){var i=e.highlighted!==t;return e.highlighted=t,i})},s.setObjectsXRayed=function(e,t){return this.withObjects(e,function(e){var i=e.xrayed!==t;return i&&(e.xrayed=t),i})},s.setObjectsColorized=function(e,t){return this.withObjects(e,function(e){e.colorize=t})},s.setObjectsOpacity=function(e,t){return this.withObjects(e,function(e){var i=e.opacity!==t;return i&&(e.opacity=t),i})},s.setObjectsPickable=function(e,t){return this.withObjects(e,function(e){var i=e.pickable!==t;return i&&(e.pickable=t),i})},s.setObjectsClippable=function(e,t){return this.withObjects(e,function(e){var i=e.clippable!==t;return i&&(e.clippable=t),i})},s.withObjects=function(e,t){Ai(e)&&(e=[e]);for(var i=!1,r=0,n=e.length;r<n;r++){var s=this.objects[e[r]];s&&(i=t(s)||i)}return i},s.createLayer=function(e){var t=this,i=this.layers[e.id];return i||(i=new mh({id:e.id,view:this,viewer:this.viewer}),this.layers[e.id]=i,this.onLayerCreated.dispatch(this,i),i.onDestroyed.one(function(){delete t.layers[i.id],t.onLayerDestroyed.dispatch(t,i)})),i.autoDestroy=!1,i},r(i,[{key:"gammaFactor",get:function(){return 1}},{key:"qualityRender",get:function(){return u(this,Fh)[Fh]},set:function(e){u(this,Fh)[Fh]!==e&&(u(this,Fh)[Fh]=e,this.redraw())}},{key:"numObjects",get:function(){return u(this,Th)[Th]}},{key:"objectIds",get:function(){return u(this,xh)[xh]||(u(this,xh)[xh]=Object.keys(this.objects)),u(this,xh)[xh]}},{key:"numVisibleObjects",get:function(){return u(this,Mh)[Mh]}},{key:"visibleObjectIds",get:function(){return u(this,Oh)[Oh]||(u(this,Oh)[Oh]=Object.keys(this.visibleObjects)),u(this,Oh)[Oh]}},{key:"numXRayedObjects",get:function(){return u(this,jh)[jh]}},{key:"xrayedObjectIds",get:function(){return u(this,Rh)[Rh]||(u(this,Rh)[Rh]=Object.keys(this.xrayedObjects)),u(this,Rh)[Rh]}},{key:"numHighlightedObjects",get:function(){return u(this,Sh)[Sh]}},{key:"highlightedObjectIds",get:function(){return u(this,Ah)[Ah]||(u(this,Ah)[Ah]=Object.keys(this.highlightedObjects)),u(this,Ah)[Ah]}},{key:"numSelectedObjects",get:function(){return u(this,Ch)[Ch]}},{key:"selectedObjectIds",get:function(){return u(this,kh)[kh]||(u(this,kh)[kh]=Object.keys(this.selectedObjects)),u(this,kh)[kh]}},{key:"numColorizedObjects",get:function(){return u(this,Dh)[Dh]}},{key:"colorizedObjectIds",get:function(){return u(this,Ih)[Ih]||(u(this,Ih)[Ih]=Object.keys(this.colorizedObjects)),u(this,Ih)[Ih]}},{key:"opacityObjectIds",get:function(){return u(this,Lh)[Lh]||(u(this,Lh)[Lh]=Object.keys(this.opacityObjects)),u(this,Lh)[Lh]}},{key:"numOpacityObjects",get:function(){return u(this,Bh)[Bh]}}]),i}(ur);function zh(e){this.sectionPlanesList.push(e),this.sectionPlanes[e.id]=e,u(this,Nh)[Nh]=null,this.rebuild(),this.onSectionPlaneCreated.dispatch(this,e)}function Kh(e){for(var t=0,i=this.sectionPlanesList.length;t<i;t++)if(this.sectionPlanesList[t].id===e.id)return this.sectionPlanesList.splice(t,1),u(this,Nh)[Nh]=null,delete this.sectionPlanes[e.id],this.rebuild(),void this.onSectionPlaneDestroyed.dispatch(this,e)}function qh(){var e=this,t=this.viewer.scene,i=t.models;for(var r in i){var n=i[r];u(this,Hh)[Hh](n)}t.onModelCreated.subscribe(function(t,i){u(e,Hh)[Hh](i)}),t.onModelDestroyed.subscribe(function(t,i){u(e,Wh)[Wh](i)})}function Zh(e){var t=this,i=e.objects,r=function(e){var r=i[e],n=r.viewLayerId||"default",s=t.layers[n];if(!s){if(!t.autoLayers)return"continue";s=new mh({id:n,view:t,viewer:t.viewer}),t.layers[n]=s,s.onDestroyed.one(function(){delete t.layers[s.id],t.onLayerDestroyed.dispatch(t,s)}),t.onLayerCreated.dispatch(t,s)}var o=new ba(s,r,{});s.registerViewObject(o),t.registerViewObject(o)};for(var n in i)r(n)}function Qh(e){var t=e.objects;for(var i in t){var r=t[i],n=this.layers[r.viewLayerId||"main"],s=this.objects[r.id];this.deregisterViewObject(s),n&&(n.deregisterViewObject(s),n.autoDestroy&&0===n.numObjects&&n.destroy())}}var Jh={WEBGL:!1,SUPPORTED_EXTENSIONS:{}},$h=document.createElement("canvas");if($h){var el=$h.getContext("webgl2",{antialias:!0});Jh.WEBGL=!!el,Jh.WEBGL&&(Jh.ANTIALIAS=el.getContextAttributes().antialias,Jh.FS_MAX_FLOAT_PRECISION=el.getShaderPrecisionFormat?el.getShaderPrecisionFormat(el.FRAGMENT_SHADER,el.HIGH_FLOAT).precision>0?"highp":el.getShaderPrecisionFormat(el.FRAGMENT_SHADER,el.MEDIUM_FLOAT).precision>0?"mediump":"lowp":"mediump",Jh.DEPTH_BUFFER_BITS=el.getParameter(el.DEPTH_BITS),Jh.MAX_TEXTURE_SIZE=el.getParameter(el.MAX_TEXTURE_SIZE),Jh.MAX_CUBE_MAP_SIZE=el.getParameter(el.MAX_CUBE_MAP_TEXTURE_SIZE),Jh.MAX_RENDERBUFFER_SIZE=el.getParameter(el.MAX_RENDERBUFFER_SIZE),Jh.MAX_TEXTURE_UNITS=el.getParameter(el.MAX_COMBINED_TEXTURE_IMAGE_UNITS),Jh.MAX_TEXTURE_IMAGE_UNITS=el.getParameter(el.MAX_TEXTURE_IMAGE_UNITS),Jh.MAX_VERTEX_ATTRIBS=el.getParameter(el.MAX_VERTEX_ATTRIBS),Jh.MAX_VERTEX_UNIFORM_VECTORS=el.getParameter(el.MAX_VERTEX_UNIFORM_VECTORS),Jh.MAX_FRAGMENT_UNIFORM_VECTORS=el.getParameter(el.MAX_FRAGMENT_UNIFORM_VECTORS),Jh.MAX_VARYING_VECTORS=el.getParameter(el.MAX_VARYING_VECTORS),el.getSupportedExtensions().forEach(function(e){Jh.SUPPORTED_EXTENSIONS[e]=!0}),Jh.depthTexturesSupported=Jh.SUPPORTED_EXTENSIONS.WEBGL_depth_texture)}var tl=/*#__PURE__*/function(){function e(e,t,i){this.viewer=void 0,this.view=void 0,this.gl=void 0,this.pbrEnabled=void 0,this.withSAO=void 0,this.backfaces=void 0,this.frontface=void 0,this.textureUnit=void 0,this.bindTexture=void 0,this.renderPass=void 0,this.shadowViewMatrix=void 0,this.shadowProjMatrix=void 0,this.pickViewMatrix=void 0,this.pickProjMatrix=void 0,this.pickZNear=void 0,this.pickZFar=void 0,this.pickInvisible=void 0,this.lineWidth=void 0,this.lastProgramId=void 0,this.occlusionTexture=void 0,this.viewer=e,this.view=t,this.gl=i,this.reset()}return e.prototype.reset=function(){this.lastProgramId=-1,this.pbrEnabled=!1,this.withSAO=!1,this.backfaces=!1,this.frontface=!0,this.textureUnit=0,this.shadowViewMatrix=null,this.shadowProjMatrix=null,this.pickViewMatrix=null,this.pickProjMatrix=null,this.pickZNear=.01,this.pickZFar=5e3,this.pickInvisible=!1,this.lineWidth=1,this.occlusionTexture=null},r(e,[{key:"nextTextureUnit",get:function(){var e=this.textureUnit;return this.textureUnit=(this.textureUnit+1)%Jh.MAX_TEXTURE_UNITS,e}}]),e}();function il(e,t){if(void 0===e._cachedExtensions&&(e._cachedExtensions={}),void 0!==e._cachedExtensions[t])return e._cachedExtensions[t];var i;switch(t){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(t)}return e._cachedExtensions[t]=i,i}var rl=vt,nl=33777,sl=33778,ol=ft,al=yt;function hl(e,t,i){var r,n=t;if(1009===n)return e.UNSIGNED_BYTE;if(1017===n)return e.UNSIGNED_SHORT_4_4_4_4;if(1018===n)return e.UNSIGNED_SHORT_5_5_5_1;if(1010===n)return e.BYTE;if(1011===n)return e.SHORT;if(1012===n)return e.UNSIGNED_SHORT;if(1013===n)return e.INT;if(1014===n)return e.UNSIGNED_INT;if(1015===n)return e.FLOAT;if(1016===n)return e.HALF_FLOAT;if(1021===n)return e.ALPHA;if(1023===n)return e.RGBA;if(1024===n)return e.LUMINANCE;if(1025===n)return e.LUMINANCE_ALPHA;if(1026===n)return e.DEPTH_COMPONENT;if(1027===n)return e.DEPTH_STENCIL;if(1028===n)return e.RED;if(1022===n)return e.RGBA;if(1029===n)return e.RED_INTEGER;if(1030===n)return e.RG;if(1031===n)return e.RG_INTEGER;if(1033===n)return e.RGBA_INTEGER;if(n===rl||n===nl||n===sl||n===ol)if(i===al){var s=il(e,"WEBGL_compressed_texture_s3tc_srgb");if(null===s)return null;if(n===rl)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===nl)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===sl)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===ol)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(r=il(e,"WEBGL_compressed_texture_s3tc")))return null;if(n===rl)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===nl)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===sl)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===ol)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===n||35841===n||35842===n||35843===n){var o=il(e,"WEBGL_compressed_texture_pvrtc");if(null===o)return null;if(35840===n)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===n)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===n)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===n)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===n){var a=il(e,"WEBGL_compressed_texture_etc1");return null!==a?a.COMPRESSED_RGB_ETC1_WEBGL:null}if(37492===n||37496===n){var h=il(e,"WEBGL_compressed_texture_etc");if(null===h)return null;if(37492===n)return i===al?h.COMPRESSED_SRGB8_ETC2:h.COMPRESSED_RGB8_ETC2;if(37496===n)return i===al?h.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:h.COMPRESSED_RGBA8_ETC2_EAC}if(37808===n||37809===n||37810===n||37811===n||37812===n||37813===n||37814===n||37815===n||37816===n||37817===n||37818===n||37819===n||37820===n||37821===n){var l=il(e,"WEBGL_compressed_texture_astc");if(null===l)return null;if(37808===n)return i===al?l.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:l.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===n)return i===al?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:l.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===n)return i===al?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:l.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===n)return i===al?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:l.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===n)return i===al?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:l.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===n)return i===al?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:l.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===n)return i===al?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:l.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===n)return i===al?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:l.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===n)return i===al?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:l.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===n)return i===al?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:l.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===n)return i===al?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:l.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===n)return i===al?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:l.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===n)return i===al?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:l.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===n)return i===al?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:l.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===n){var c=il(e,"EXT_texture_compression_bptc");if(null===c)return null;if(36492===n)return i===al?c.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:c.COMPRESSED_RGBA_BPTC_UNORM_EXT}return 1020===n?e.UNSIGNED_INT_24_8:1e3===n?e.REPEAT:1001===n?e.CLAMP_TO_EDGE:1004===n||1005===n?e.NEAREST_MIPMAP_LINEAR:1007===n?e.LINEAR_MIPMAP_NEAREST:1008===n?e.LINEAR_MIPMAP_LINEAR:1003===n?e.NEAREST:1006===n?e.LINEAR:null}var ll=new Uint8Array([0,0,0,1]),cl=/*#__PURE__*/function(){function e(e){this.gl=void 0,this.target=void 0,this.format=void 0,this.type=void 0,this.internalFormat=void 0,this.premultiplyAlpha=void 0,this.flipY=void 0,this.unpackAlignment=void 0,this.wrapS=void 0,this.wrapT=void 0,this.wrapR=void 0,this.texture=void 0,this.allocated=void 0,this.minFilter=void 0,this.magFilter=void 0,this.encoding=void 0,this.gl=e.gl,this.target=e.target||e.gl.TEXTURE_2D,this.format=e.format||dt,this.type=e.type||1009,this.internalFormat=-1,this.premultiplyAlpha=!!e.premultiplyAlpha,this.flipY=!!e.flipY,this.unpackAlignment=4,this.wrapS=e.wrapS||ot,this.wrapT=e.wrapT||ot,this.wrapR=e.wrapR||ot,this.texture=e.gl.createTexture(),e.preloadColor&&this.setPreloadColor(e.preloadColor),this.allocated=!0}var t=e.prototype;return t.setPreloadColor=function(e){e?(ll[0]=Math.floor(255*e[0]),ll[1]=Math.floor(255*e[1]),ll[2]=Math.floor(255*e[2]),ll[3]=Math.floor(255*(void 0!==e[3]?e[3]:1))):(ll[0]=0,ll[1]=0,ll[2]=0,ll[3]=255);var t=this.gl;if(t.bindTexture(this.target,this.texture),this.target===t.TEXTURE_CUBE_MAP)for(var i=[t.TEXTURE_CUBE_MAP_POSITIVE_X,t.TEXTURE_CUBE_MAP_NEGATIVE_X,t.TEXTURE_CUBE_MAP_POSITIVE_Y,t.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.TEXTURE_CUBE_MAP_POSITIVE_Z,t.TEXTURE_CUBE_MAP_NEGATIVE_Z],r=0,n=i.length;r<n;r++)t.texImage2D(i[r],0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,ll);else t.texImage2D(this.target,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,ll);t.bindTexture(this.target,null)},t.setTarget=function(e){this.target=e||this.gl.TEXTURE_2D},t.setImage=function(e,t){void 0===t&&(t={});var i=this.gl;void 0!==t.format&&(this.format=t.format),void 0!==t.internalFormat&&(this.internalFormat=t.internalFormat),void 0!==t.encoding&&(this.encoding=t.encoding),void 0!==t.type&&(this.type=t.type),void 0!==t.flipY&&(this.flipY=t.flipY),void 0!==t.premultiplyAlpha&&(this.premultiplyAlpha=t.premultiplyAlpha),void 0!==t.unpackAlignment&&(this.unpackAlignment=t.unpackAlignment),void 0!==t.minFilter&&(this.minFilter=t.minFilter),void 0!==t.magFilter&&(this.magFilter=t.magFilter),void 0!==t.wrapS&&(this.wrapS=t.wrapS),void 0!==t.wrapT&&(this.wrapT=t.wrapT),void 0!==t.wrapR&&(this.wrapR=t.wrapR),i.bindTexture(this.target,this.texture),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,this.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,this.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,i.NONE);var r=hl(i,this.minFilter);i.texParameteri(this.target,i.TEXTURE_MIN_FILTER,r);var n=hl(i,this.magFilter);n&&i.texParameteri(this.target,i.TEXTURE_MAG_FILTER,n);var s=hl(i,this.wrapS);s&&i.texParameteri(this.target,i.TEXTURE_WRAP_S,s);var o=hl(i,this.wrapT);o&&i.texParameteri(this.target,i.TEXTURE_WRAP_T,o);var a,h=hl(i,this.format,this.encoding),l=hl(i,this.type),c=ul(i,this.internalFormat,h,l,this.encoding,!1);if(this.target===i.TEXTURE_CUBE_MAP){if((a=e)&&!a.propertyIsEnumerable("length")&&"object"==typeof a&&"number"==typeof a.length)for(var u=e,d=[i.TEXTURE_CUBE_MAP_POSITIVE_X,i.TEXTURE_CUBE_MAP_NEGATIVE_X,i.TEXTURE_CUBE_MAP_POSITIVE_Y,i.TEXTURE_CUBE_MAP_NEGATIVE_Y,i.TEXTURE_CUBE_MAP_POSITIVE_Z,i.TEXTURE_CUBE_MAP_NEGATIVE_Z],v=0,f=d.length;v<f;v++)i.texImage2D(d[v],0,c,h,l,u[v])}else i.texImage2D(i.TEXTURE_2D,0,c,h,l,e);i.bindTexture(this.target,null)},t.setCompressedData=function(e){var t=this.gl,i=e.mipmaps||[],r=i.length,n=e.props;void 0!==n.format&&(this.format=n.format),void 0!==n.internalFormat&&(this.internalFormat=n.internalFormat),void 0!==n.encoding&&(this.encoding=n.encoding),void 0!==n.type&&(this.type=n.type),void 0!==n.flipY&&(this.flipY=n.flipY),void 0!==n.premultiplyAlpha&&(this.premultiplyAlpha=n.premultiplyAlpha),void 0!==n.unpackAlignment&&(this.unpackAlignment=n.unpackAlignment),void 0!==n.minFilter&&(this.minFilter=n.minFilter),void 0!==n.magFilter&&(this.magFilter=n.magFilter),void 0!==n.wrapS&&(this.wrapS=n.wrapS),void 0!==n.wrapT&&(this.wrapT=n.wrapT),void 0!==n.wrapR&&(this.wrapR=n.wrapR),t.activeTexture(t.TEXTURE0+0),t.bindTexture(this.target,this.texture);var s=i.length>1;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,this.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,this.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE);var o=hl(t,this.wrapS);o&&t.texParameteri(this.target,t.TEXTURE_WRAP_S,o);var a=hl(t,this.wrapT);if(a&&t.texParameteri(this.target,t.TEXTURE_WRAP_T,a),this.type===t.TEXTURE_3D||this.type===t.TEXTURE_2D_ARRAY){var h=hl(t,this.wrapR);h&&t.texParameteri(this.target,t.TEXTURE_WRAP_R,h),t.texParameteri(this.type,t.TEXTURE_WRAP_R,h)}s?(t.texParameteri(this.target,t.TEXTURE_MIN_FILTER,dl(t,this.minFilter)),t.texParameteri(this.target,t.TEXTURE_MAG_FILTER,dl(t,this.magFilter))):(t.texParameteri(this.target,t.TEXTURE_MIN_FILTER,hl(t,this.minFilter)),t.texParameteri(this.target,t.TEXTURE_MAG_FILTER,hl(t,this.magFilter)));var l=hl(t,this.format,this.encoding),c=hl(t,this.type),u=ul(t,this.internalFormat,l,c,this.encoding,!1);t.texStorage2D(t.TEXTURE_2D,r,u,i[0].width,i[0].height);for(var d=0,v=i.length;d<v;d++){var f=i[d];this.format!==dt?null!==l?t.compressedTexSubImage2D(t.TEXTURE_2D,d,0,0,f.width,f.height,l,f.data):console.warn("Attempt to load unsupported compressed texture format in .setCompressedData()"):t.texSubImage2D(t.TEXTURE_2D,d,0,0,f.width,f.height,l,c,f.data)}t.bindTexture(this.target,null)},t.setProps=function(e){var t=this.gl;t.bindTexture(this.target,this.texture),this._uploadProps(e),t.bindTexture(this.target,null)},t._uploadProps=function(e){var t=this.gl;if(void 0!==e.format&&(this.format=e.format),void 0!==e.internalFormat&&(this.internalFormat=e.internalFormat),void 0!==e.encoding&&(this.encoding=e.encoding),void 0!==e.type&&(this.type=e.type),void 0!==e.minFilter){var i=hl(t,e.minFilter);i&&(this.minFilter=e.minFilter,t.texParameteri(this.target,t.TEXTURE_MIN_FILTER,i),i!==t.NEAREST_MIPMAP_NEAREST&&i!==t.LINEAR_MIPMAP_NEAREST&&i!==t.NEAREST_MIPMAP_LINEAR&&i!==t.LINEAR_MIPMAP_LINEAR||t.generateMipmap(this.target))}if(void 0!==e.magFilter){var r=hl(t,e.magFilter);r&&(this.magFilter=e.magFilter,t.texParameteri(this.target,t.TEXTURE_MAG_FILTER,r))}if(void 0!==e.wrapS){var n=hl(t,e.wrapS);n&&(this.wrapS=e.wrapS,t.texParameteri(this.target,t.TEXTURE_WRAP_S,n))}if(void 0!==e.wrapT){var s=hl(t,e.wrapT);s&&(this.wrapT=e.wrapT,t.texParameteri(this.target,t.TEXTURE_WRAP_T,s))}},t.bind=function(e){if(!this.allocated)return!1;if(this.texture){var t=this.gl;return t.activeTexture(t["TEXTURE"+e]),t.bindTexture(this.target,this.texture),!0}return!1},t.unbind=function(e){if(this.allocated&&this.texture){var t=this.gl;t.activeTexture(t["TEXTURE"+e]),t.bindTexture(this.target,null)}},t.destroy=function(){this.allocated&&this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null)},e}();function ul(e,t,i,r,n,s){if(void 0===s&&(s=!1),null!==t){if(void 0!==e[t])return e[t];console.warn("Attempt to use non-existing WebGL internal format '"+t+"'")}var o=i;return i===e.RED&&(r===e.FLOAT&&(o=e.R32F),r===e.HALF_FLOAT&&(o=e.R16F),r===e.UNSIGNED_BYTE&&(o=e.R8)),i===e.RG&&(r===e.FLOAT&&(o=e.RG32F),r===e.HALF_FLOAT&&(o=e.RG16F),r===e.UNSIGNED_BYTE&&(o=e.RG8)),i===e.RGBA&&(r===e.FLOAT&&(o=e.RGBA32F),r===e.HALF_FLOAT&&(o=e.RGBA16F),r===e.UNSIGNED_BYTE&&(o=n===yt&&!1===s?e.SRGB8_ALPHA8:e.RGBA8),r===e.UNSIGNED_SHORT_4_4_4_4&&(o=e.RGBA4),r===e.UNSIGNED_SHORT_5_5_5_1&&(o=e.RGB5_A1)),o!==e.R16F&&o!==e.R32F&&o!==e.RG16F&&o!==e.RG32F&&o!==e.RGBA16F&&o!==e.RGBA32F||il(e,"EXT_color_buffer_float"),o}function dl(e,t){return t===lt||1004===t||1005===t?e.NEAREST:e.LINEAR}var vl,fl=/*#__PURE__*/c("built"),pl=/*#__PURE__*/function(){function e(){this.positions=void 0,this.indices_8Bits=void 0,this.indices_16Bits=void 0,this.indices_32Bits=void 0,this.edgeIndices_8Bits=void 0,this.edgeIndices_16Bits=void 0,this.edgeIndices_32Bits=void 0,this.indices=void 0,this.edgeIndices=void 0,this.eachMeshAttributes=void 0,this.eachMeshMatrices=void 0,this.eachEdgeOffset=void 0,this.eachPrimitiveMesh_8Bits=void 0,this.eachPrimitiveMesh_16Bits=void 0,this.eachPrimitiveMesh_32Bits=void 0,this.eachPrimitiveMesh=void 0,this.eachEdgeMesh_8Bits=void 0,this.eachEdgeMesh_16Bits=void 0,this.eachEdgeMesh_32Bits=void 0,this.eachEdgeMesh=void 0,Object.defineProperty(this,fl,{writable:!0,value:void 0}),this.positions=null,this.indices_8Bits=null,this.indices_16Bits=null,this.indices_32Bits=null,this.edgeIndices_8Bits=null,this.edgeIndices_16Bits=null,this.edgeIndices_32Bits=null,this.eachMeshAttributes=null,this.eachMeshMatrices=null,this.eachPrimitiveMesh_8Bits=null,this.eachPrimitiveMesh_16Bits=null,this.eachPrimitiveMesh_32Bits=null,this.eachEdgeMesh_8Bits=null,this.eachEdgeMesh_16Bits=null,this.eachEdgeMesh_32Bits=null,this.eachEdgeOffset=null,u(this,fl)[fl]=!1}var t=e.prototype;return t.build=function(){this.indices={8:this.indices_8Bits,16:this.indices_16Bits,32:this.indices_32Bits},this.eachPrimitiveMesh={8:this.eachPrimitiveMesh_8Bits,16:this.eachPrimitiveMesh_16Bits,32:this.eachPrimitiveMesh_32Bits},this.edgeIndices={8:this.edgeIndices_8Bits,16:this.edgeIndices_16Bits,32:this.edgeIndices_32Bits},this.eachEdgeMesh={8:this.eachEdgeMesh_8Bits,16:this.eachEdgeMesh_16Bits,32:this.eachEdgeMesh_32Bits},u(this,fl)[fl]=!0},t.destroy=function(){this.positions&&this.positions.destroy(),this.indices_8Bits&&this.indices_8Bits.destroy(),this.indices_16Bits&&this.indices_16Bits.destroy(),this.indices_32Bits&&this.indices_32Bits.destroy(),this.edgeIndices_8Bits&&this.edgeIndices_8Bits.destroy(),this.edgeIndices_16Bits&&this.edgeIndices_16Bits.destroy(),this.edgeIndices_32Bits&&this.edgeIndices_32Bits.destroy(),this.eachMeshMatrices&&this.eachMeshMatrices.destroy(),this.eachMeshAttributes&&this.eachMeshAttributes.destroy(),this.eachEdgeOffset&&this.eachEdgeOffset.destroy(),this.eachPrimitiveMesh_8Bits&&this.eachPrimitiveMesh_8Bits.destroy(),this.eachPrimitiveMesh_16Bits&&this.eachPrimitiveMesh_16Bits.destroy(),this.eachPrimitiveMesh_32Bits&&this.eachPrimitiveMesh_32Bits.destroy(),this.eachEdgeMesh_8Bits&&this.eachEdgeMesh_8Bits.destroy(),this.eachEdgeMesh_16Bits&&this.eachEdgeMesh_16Bits.destroy(),this.eachEdgeMesh_32Bits&&this.eachEdgeMesh_32Bits.destroy()},e}(),yl=/*#__PURE__*/c("onDestroyed"),gl=/*#__PURE__*/function(){function e(e){void 0===e&&(e={}),this.gl=void 0,this.texture=void 0,this.textureWidth=void 0,this.textureHeight=void 0,this.textureData=void 0,Object.defineProperty(this,yl,{writable:!0,value:void 0}),this.gl=e.gl,this.texture=e.texture,this.textureWidth=e.textureWidth,this.textureHeight=e.textureHeight,this.textureData=e.textureData,u(this,yl)[yl]=e.onDestroyed}var t=e.prototype;return t.bindTexture=function(e,t,i){this.gl&&t.bindTexture(this,i)},t.bind=function(e){if(this.gl&&this.texture)return this.gl.activeTexture(this.gl["TEXTURE"+e]),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),!0},t.disableFiltering=function(){this.gl&&(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE))},t.unbind=function(e){},t.destroy=function(){this.gl&&this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null,u(this,yl)[yl]&&u(this,yl)[yl]())},e}();function bl(e){return function(t){return ml(e,t,[].slice.call(arguments,1))}}function wl(e,t){return bl(Tl(e,t).get)}for(var ml=Reflect.apply,Pl=Reflect.construct,_l=Reflect.defineProperty,El=Reflect.get,Tl=Reflect.getOwnPropertyDescriptor,xl=Reflect.getPrototypeOf,Ml=Reflect.has,Ol=Reflect.ownKeys,jl=Reflect.set,Rl=Reflect.setPrototypeOf,Sl=Proxy,Al=Number,Cl=Al.isFinite,kl=Al.isNaN,Dl=Symbol.iterator,Il=Symbol.species,Bl=Symbol.toStringTag,Ll=Symbol.for,Fl=Object,Ul=Fl.create,Nl=Fl.defineProperty,Xl=Fl.freeze,Gl=Fl.is,Vl=Fl.prototype,Hl=bl(Vl.isPrototypeOf),Wl=Fl.hasOwn||bl(Vl.hasOwnProperty),Yl=Array,zl=Yl.isArray,Kl=Yl.prototype,ql=bl(Kl.join),Zl=bl(Kl.push),Ql=bl(Kl.toLocaleString),Jl=Kl[Dl],$l=bl(Jl),ec=Math.trunc,tc=ArrayBuffer,ic=tc.isView,rc=bl(tc.prototype.slice),nc=wl(tc.prototype,"byteLength"),sc="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:null,oc=sc&&wl(sc.prototype,"byteLength"),ac=xl(Uint8Array),hc=ac.from,lc=ac.prototype,cc=lc[Dl],uc=bl(lc.keys),dc=bl(lc.values),vc=bl(lc.entries),fc=bl(lc.set),pc=bl(lc.reverse),yc=bl(lc.fill),gc=bl(lc.copyWithin),bc=bl(lc.sort),wc=bl(lc.slice),mc=bl(lc.subarray),Pc=wl(lc,"buffer"),_c=wl(lc,"byteOffset"),Ec=wl(lc,"length"),Tc=wl(lc,Bl),xc=Uint16Array,Mc=function(){return ml(hc,xc,[].slice.call(arguments))},Oc=Uint32Array,jc=Float32Array,Rc=xl([][Dl]()),Sc=bl(Rc.next),Ac=bl(t().mark(function e(){return t().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})().next),Cc=xl(Rc),kc=TypeError,Dc=RangeError,Ic=Set,Bc=Ic.prototype,Lc=bl(Bc.add),Fc=bl(Bc.has),Uc=WeakMap,Nc=Uc.prototype,Xc=bl(Nc.get),Gc=bl(Nc.has),Vc=bl(Nc.set),Hc=new tc(4),Wc=new jc(Hc),Yc=new Oc(Hc),zc=new Oc(512),Kc=new Oc(512),qc=0;qc<256;++qc){var Zc=qc-127;Zc<-27?(zc[qc]=0,zc[256|qc]=32768,Kc[qc]=24,Kc[256|qc]=24):Zc<-14?(zc[qc]=1024>>-Zc-14,zc[256|qc]=1024>>-Zc-14|32768,Kc[qc]=-Zc-1,Kc[256|qc]=-Zc-1):Zc<=15?(zc[qc]=Zc+15<<10,zc[256|qc]=Zc+15<<10|32768,Kc[qc]=13,Kc[256|qc]=13):Zc<128?(zc[qc]=31744,zc[256|qc]=64512,Kc[qc]=24,Kc[256|qc]=24):(zc[qc]=31744,zc[256|qc]=64512,Kc[qc]=13,Kc[256|qc]=13)}function Qc(e){Wc[0]=e;var t=Yc[0],i=t>>23&511;return zc[i]+((8388607&t)>>Kc[i])}var Jc=new Oc(2048),$c=new Oc(64),eu=new Oc(64);Jc[0]=0;for(var tu=1;tu<1024;++tu){for(var iu=tu<<13,ru=0;0==(8388608&iu);)ru-=8388608,iu<<=1;Jc[tu]=(iu&=-8388609)|(ru+=947912704)}for(var nu=1024;nu<2048;++nu)Jc[nu]=939524096+(nu-1024<<13);$c[0]=0;for(var su=1;su<31;++su)$c[su]=su<<23;$c[31]=1199570944,$c[32]=2147483648;for(var ou=33;ou<63;++ou)$c[ou]=2147483648+(ou-32<<23);$c[63]=3347054592,eu[0]=0;for(var au=1;au<64;++au)eu[au]=32===au?0:1024;function hu(e){var t=e>>10;return Yc[0]=Jc[eu[t]+(1023&e)]+$c[t],Wc[0]}function lu(e){var t;if(e[Dl]===Jl)return e;var i=$l(e);return Ul(null,((t={next:{value:function(){return Sc(i)}}})[Dl]={value:function(){return this}},t))}var cu=new Uc,uu=Ul(Cc,(vl={next:{value:function(){var e=Xc(cu,this);return Ac(e)},writable:!0,configurable:!0}},vl[Bl]={value:"Array Iterator",configurable:!0},vl));function du(e){var t=Ul(uu);return Vc(cu,t,e),t}function vu(e){return null!==e&&"object"==typeof e||"function"==typeof e}function fu(e){return null!==e&&"object"==typeof e}function pu(e){return void 0!==Tc(e)}function yu(e){var t=Tc(e);return"BigInt64Array"===t||"BigUint64Array"===t}function gu(e){if(null===sc)return!1;try{return oc(e),!0}catch(e){return!1}}function bu(e){return!!zl(e)&&(e[Dl]===Jl||"Array Iterator"===e[Dl]()[Bl])}function wu(e){if("string"!=typeof e)return!1;var t=Al(e);return e===t+""&&!!Cl(t)&&t===ec(t)}var mu=Al.MAX_SAFE_INTEGER;function Pu(e){if("bigint"==typeof e)throw kc("Cannot convert a BigInt value to a number");var t=Al(e);return kl(t)||0===t?0:ec(t)}function _u(e){var t=Pu(e);return t<0?0:t<mu?t:mu}function Eu(e,t){if(!vu(e))throw kc("This is not an object");var i=e.constructor;if(void 0===i)return t;if(!vu(i))throw kc("The constructor property value is not an object");var r=i[Il];return null==r?t:r}function Tu(e){if(gu(e))return!1;try{return rc(e,0,0),!1}catch(e){}return!0}function xu(e,t){var i=kl(e),r=kl(t);if(i&&r)return 0;if(i)return 1;if(r)return-1;if(e<t)return-1;if(e>t)return 1;if(0===e&&0===t){var n=Gl(e,0),s=Gl(t,0);if(!n&&s)return-1;if(n&&!s)return 1}return 0}var Mu=Ll("__Float16Array__"),Ou=new Uc;function ju(e){return Gc(Ou,e)||!ic(e)&&function(e){if(!fu(e))return!1;var t=xl(e);if(!fu(t))return!1;var i=t.constructor;if(void 0===i)return!1;if(!vu(i))throw kc("The constructor property value is not an object");return Ml(i,Mu)}(e)}function Ru(e){if(!ju(e))throw kc("This is not a Float16Array object")}function Su(e,t){var i=ju(e),r=pu(e);if(!i&&!r)throw kc("Species constructor didn't return TypedArray object");if("number"==typeof t){var n;if(i){var s=Au(e);n=Ec(s)}else n=Ec(e);if(n<t)throw kc("Derived constructor created TypedArray object which was too small length")}if(yu(e))throw kc("Cannot mix BigInt and other types, use explicit conversions")}function Au(e){var t=Xc(Ou,e);if(void 0!==t){if(Tu(Pc(t)))throw kc("Attempting to access detached ArrayBuffer");return t}var i=e.buffer;if(Tu(i))throw kc("Attempting to access detached ArrayBuffer");var r=Pl(Uu,[i,e.byteOffset,e.length],e.constructor);return Xc(Ou,r)}function Cu(e){for(var t=Ec(e),i=[],r=0;r<t;++r)i[r]=hu(e[r]);return i}for(var ku,Du=new Ic,Iu=h(Ol(lc));!(ku=Iu()).done;){var Bu=ku.value;if(Bu!==Bl){var Lu=Tl(lc,Bu);Wl(Lu,"get")&&Lc(Du,Bu)}}var Fu=Xl({get:function(e,t,i){return wu(t)&&Wl(e,t)?hu(El(e,t)):Fc(Du,t)&&Hl(lc,e)?El(e,t):El(e,t,i)},set:function(e,t,i,r){return wu(t)&&Wl(e,t)?jl(e,t,Qc(i)):jl(e,t,i,r)},getOwnPropertyDescriptor:function(e,t){if(wu(t)&&Wl(e,t)){var i=Tl(e,t);return i.value=hu(i.value),i}return Tl(e,t)},defineProperty:function(e,t,i){return wu(t)&&Wl(e,t)&&Wl(i,"value")?(i.value=Qc(i.value),_l(e,t,i)):_l(e,t,i)}}),Uu=/*#__PURE__*/function(){function e(t,i,r){var n;if(ju(t))n=Pl(xc,[Au(t)],this instanceof e?this.constructor:void 0);else if(vu(t)&&!function(e){try{return nc(e),!0}catch(e){return!1}}(t)){var s,o;if(pu(t)){s=t,o=Ec(t);var a=Pc(t),h=gu(a)?tc:Eu(a,tc);if(Tu(a))throw kc("Attempting to access detached ArrayBuffer");if(yu(t))throw kc("Cannot mix BigInt and other types, use explicit conversions");var l=new h(2*o);n=Pl(xc,[l],this instanceof e?this.constructor:void 0)}else{var c=t[Dl];if(null!=c&&"function"!=typeof c)throw kc("@@iterator property is not callable");null!=c?bu(t)?(s=t,o=t.length):o=(s=[].concat(t)).length:o=_u((s=t).length),n=Pl(xc,[o],this instanceof e?this.constructor:void 0)}for(var u=0;u<o;++u)n[u]=Qc(s[u])}else n=Pl(xc,arguments,this instanceof e?this.constructor:void 0);var d=new Sl(n,Fu);return Vc(Ou,d,n),d}e.from=function(t){var i,r,n=this,s=[].slice.call(arguments,1),o=this;if(!Ml(o,Mu))throw kc("This constructor is not a subclass of Float16Array");if(o===e){if(ju(t)&&0===s.length){var a=Au(t),h=new xc(Pc(a),_c(a),Ec(a));return new e(Pc(wc(h)))}if(0===s.length)return new e(Pc(Mc(t,Qc)));var l=s[0],c=s[1];return new e(Pc(Mc(t,function(e){return Qc(ml(l,n,[e].concat(lu([].slice.call(arguments,1)))))},c)))}var u,d=t[Dl];if(null!=d&&"function"!=typeof d)throw kc("@@iterator property is not callable");if(null!=d)bu(t)?(i=t,r=t.length):!pu(u=t)||u[Dl]!==cc&&"Array Iterator"!==u[Dl]()[Bl]?r=(i=[].concat(t)).length:(i=t,r=Ec(t));else{if(null==t)throw kc("Cannot convert undefined or null to object");r=_u((i=Fl(t)).length)}var v=new o(r);if(0===s.length)for(var f=0;f<r;++f)v[f]=i[f];else for(var p=s[0],y=s[1],g=0;g<r;++g)v[g]=ml(p,y,[i[g],g]);return v},e.of=function(){var t=[].slice.call(arguments),i=this;if(!Ml(i,Mu))throw kc("This constructor is not a subclass of Float16Array");var r=t.length;if(i===e){for(var n=new e(r),s=Au(n),o=0;o<r;++o)s[o]=Qc(t[o]);return n}for(var a=new i(r),h=0;h<r;++h)a[h]=t[h];return a};var i=e.prototype;return i.keys=function(){Ru(this);var e=Au(this);return uc(e)},i.values=function(){Ru(this);var e=Au(this);return du(/*#__PURE__*/t().mark(function i(){var r,n,s;return t().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=h(dc(e));case 1:if((n=r()).done){t.next=7;break}return s=n.value,t.next=5,hu(s);case 5:t.next=1;break;case 7:case"end":return t.stop()}},i)})())},i.entries=function(){Ru(this);var e=Au(this);return du(/*#__PURE__*/t().mark(function i(){var r,n,s,o,a;return t().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=h(vc(e));case 1:if((n=r()).done){t.next=7;break}return o=(s=n.value)[0],a=s[1],t.next=5,[o,hu(a)];case 5:t.next=1;break;case 7:case"end":return t.stop()}},i)})())},i.at=function(e){Ru(this);var t=Au(this),i=Ec(t),r=Pu(e),n=r>=0?r:i+r;if(!(n<0||n>=i))return hu(t[n])},i.map=function(t){Ru(this);var i=Au(this),r=Ec(i),n=[].slice.call(arguments,1)[0],s=Eu(i,e);if(s===e){for(var o=new e(r),a=Au(o),h=0;h<r;++h){var l=hu(i[h]);a[h]=Qc(ml(t,n,[l,h,this]))}return o}var c=new s(r);Su(c,r);for(var u=0;u<r;++u){var d=hu(i[u]);c[u]=ml(t,n,[d,u,this])}return c},i.filter=function(t){Ru(this);for(var i=Au(this),r=Ec(i),n=[].slice.call(arguments,1)[0],s=[],o=0;o<r;++o){var a=hu(i[o]);ml(t,n,[a,o,this])&&Zl(s,a)}var h=new(Eu(i,e))(s);return Su(h),h},i.reduce=function(e){var t=[].slice.call(arguments,1);Ru(this);var i,r,n=Au(this),s=Ec(n);if(0===s&&0===t.length)throw kc("Reduce of empty array with no initial value");0===t.length?(i=hu(n[0]),r=1):(i=t[0],r=0);for(var o=r;o<s;++o)i=e(i,hu(n[o]),o,this);return i},i.reduceRight=function(e){var t=[].slice.call(arguments,1);Ru(this);var i,r,n=Au(this),s=Ec(n);if(0===s&&0===t.length)throw kc("Reduce of empty array with no initial value");0===t.length?(i=hu(n[s-1]),r=s-2):(i=t[0],r=s-1);for(var o=r;o>=0;--o)i=e(i,hu(n[o]),o,this);return i},i.forEach=function(e){Ru(this);for(var t=Au(this),i=Ec(t),r=[].slice.call(arguments,1)[0],n=0;n<i;++n)ml(e,r,[hu(t[n]),n,this])},i.find=function(e){Ru(this);for(var t=Au(this),i=Ec(t),r=[].slice.call(arguments,1)[0],n=0;n<i;++n){var s=hu(t[n]);if(ml(e,r,[s,n,this]))return s}},i.findIndex=function(e){Ru(this);for(var t=Au(this),i=Ec(t),r=[].slice.call(arguments,1)[0],n=0;n<i;++n){var s=hu(t[n]);if(ml(e,r,[s,n,this]))return n}return-1},i.findLast=function(e){Ru(this);for(var t=Au(this),i=Ec(t),r=[].slice.call(arguments,1)[0],n=i-1;n>=0;--n){var s=hu(t[n]);if(ml(e,r,[s,n,this]))return s}},i.findLastIndex=function(e){Ru(this);for(var t=Au(this),i=Ec(t),r=[].slice.call(arguments,1)[0],n=i-1;n>=0;--n){var s=hu(t[n]);if(ml(e,r,[s,n,this]))return n}return-1},i.every=function(e){Ru(this);for(var t=Au(this),i=Ec(t),r=[].slice.call(arguments,1)[0],n=0;n<i;++n)if(!ml(e,r,[hu(t[n]),n,this]))return!1;return!0},i.some=function(e){Ru(this);for(var t=Au(this),i=Ec(t),r=[].slice.call(arguments,1)[0],n=0;n<i;++n)if(ml(e,r,[hu(t[n]),n,this]))return!0;return!1},i.set=function(e){Ru(this);var t=Au(this),i=Pu([].slice.call(arguments,1)[0]);if(i<0)throw Dc("Offset is out of bounds");if(null==e)throw kc("Cannot convert undefined or null to object");if(yu(e))throw kc("Cannot mix BigInt and other types, use explicit conversions");if(ju(e))return fc(Au(this),Au(e),i);if(pu(e)&&Tu(Pc(e)))throw kc("Attempting to access detached ArrayBuffer");var r=Ec(t),n=Fl(e),s=_u(n.length);if(i===1/0||s+i>r)throw Dc("Offset is out of bounds");for(var o=0;o<s;++o)t[o+i]=Qc(n[o])},i.reverse=function(){Ru(this);var e=Au(this);return pc(e),this},i.fill=function(e){Ru(this);var t=Au(this);return yc.apply(void 0,[t,Qc(e)].concat(lu([].slice.call(arguments,1)))),this},i.copyWithin=function(e,t){Ru(this);var i=Au(this);return gc.apply(void 0,[i,e,t].concat(lu([].slice.call(arguments,2)))),this},i.sort=function(){var e=[].slice.call(arguments);Ru(this);var t=Au(this),i=void 0!==e[0]?e[0]:xu;return bc(t,function(e,t){return i(hu(e),hu(t))}),this},i.slice=function(){var t=[].slice.call(arguments);Ru(this);var i=Au(this),r=Eu(i,e);if(r===e){var n=new xc(Pc(i),_c(i),Ec(i));return new e(Pc(wc.apply(void 0,[n].concat(lu(t)))))}var s,o,a=Ec(i),h=Pu(t[0]),l=void 0===t[1]?a:Pu(t[1]),c=(o=l===-1/0?0:l<0?a+l>0?a+l:0:a<l?a:l)-(s=h===-1/0?0:h<0?a+h>0?a+h:0:a<h?a:h)>0?o-s:0,u=new r(c);if(Su(u,c),0===c)return u;if(Tu(Pc(i)))throw kc("Attempting to access detached ArrayBuffer");for(var d=0;s<o;)u[d]=hu(i[s]),++s,++d;return u},i.subarray=function(){Ru(this);var t=Au(this),i=Eu(t,e),r=new xc(Pc(t),_c(t),Ec(t)),n=mc.apply(void 0,[r].concat(lu([].slice.call(arguments)))),s=new i(Pc(n),_c(n),Ec(n));return Su(s),s},i.indexOf=function(e){Ru(this);var t=Au(this),i=Ec(t),r=Pu([].slice.call(arguments,1)[0]);if(r===1/0)return-1;r<0&&(r+=i)<0&&(r=0);for(var n=r;n<i;++n)if(Wl(t,n)&&hu(t[n])===e)return n;return-1},i.lastIndexOf=function(e){var t=[].slice.call(arguments,1);Ru(this);var i=Au(this),r=Ec(i),n=t.length>=1?Pu(t[0]):r-1;if(n===-1/0)return-1;n>=0?n=n<r-1?n:r-1:n+=r;for(var s=n;s>=0;--s)if(Wl(i,s)&&hu(i[s])===e)return s;return-1},i.includes=function(e){Ru(this);var t=Au(this),i=Ec(t),r=Pu([].slice.call(arguments,1)[0]);if(r===1/0)return!1;r<0&&(r+=i)<0&&(r=0);for(var n=kl(e),s=r;s<i;++s){var o=hu(t[s]);if(n&&kl(o))return!0;if(o===e)return!0}return!1},i.join=function(){Ru(this);var e=Cu(Au(this));return ql.apply(void 0,[e].concat(lu([].slice.call(arguments))))},i.toLocaleString=function(){Ru(this);var e=Cu(Au(this));return Ql.apply(void 0,[e].concat(lu([].slice.call(arguments))))},r(e,[{key:Bl,get:function(){if(ju(this))return"Float16Array"}}]),e}();Nl(Uu,"BYTES_PER_ELEMENT",{value:2}),Nl(Uu,Mu,{}),Rl(Uu,ac);var Nu=Uu.prototype;Nl(Nu,"BYTES_PER_ELEMENT",{value:2}),Nl(Nu,Dl,{value:Nu.values,writable:!0,configurable:!0}),Rl(Nu,lc);var Xu=new gl({textureWidth:0,textureHeight:0}),Gu=/*#__PURE__*/function(){function e(){}var t=e.prototype;return t.disableFilteringForBoundTexture=function(e){e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)},t.createPositionsDataTexture=function(e,t){var i=1024,r=Math.ceil(t.length/3/i);if(0==r)throw"texture height == 0";var n=new Uint16Array(i*r*3);n.fill(0),n.set(t,0);var s=e.createTexture();return e.bindTexture(e.TEXTURE_2D,s),e.texStorage2D(e.TEXTURE_2D,1,e.RGB16UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RGB_INTEGER,e.UNSIGNED_SHORT,n,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new gl({gl:e,texture:s,textureWidth:i,textureHeight:r})},t.createIndices8BitDataTexture=function(e,t){if(0==t.length)return Xu;var i=1024,r=Math.ceil(t.length/3/i);if(0==r)throw"texture height == 0";var n=new Uint8Array(i*r*3);n.fill(0),n.set(t,0);var s=e.createTexture();return s?(e.bindTexture(e.TEXTURE_2D,s),e.texStorage2D(e.TEXTURE_2D,1,e.RGB8UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RGB_INTEGER,e.UNSIGNED_BYTE,n,0),this.disableFilteringForBoundTexture(e),e.bindTexture(e.TEXTURE_2D,null),new gl({gl:e,texture:s,textureWidth:i,textureHeight:r})):Xu},t.createIndices16BitDataTexture=function(e,t){if(0==t.length)return Xu;var i=1024,r=Math.ceil(t.length/3/i);if(0==r)throw"texture height == 0";var n=new Uint16Array(i*r*3);n.fill(0),n.set(t,0);var s=e.createTexture();return s?(e.bindTexture(e.TEXTURE_2D,s),e.texStorage2D(e.TEXTURE_2D,1,e.RGB16UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RGB_INTEGER,e.UNSIGNED_SHORT,n,0),this.disableFilteringForBoundTexture(e),e.bindTexture(e.TEXTURE_2D,null),new gl({gl:e,texture:s,textureWidth:i,textureHeight:r})):Xu},t.createIndices32BitDataTexture=function(e,t){if(0==t.length)return Xu;var i=1024,r=Math.ceil(t.length/3/i);if(0==r)throw"texture height == 0";var n=new Uint32Array(i*r*3);n.fill(0),n.set(t,0);var s=e.createTexture();return s?(e.bindTexture(e.TEXTURE_2D,s),e.texStorage2D(e.TEXTURE_2D,1,e.RGB32UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RGB_INTEGER,e.UNSIGNED_INT,n,0),this.disableFilteringForBoundTexture(e),e.bindTexture(e.TEXTURE_2D,null),new gl({gl:e,texture:s,textureWidth:i,textureHeight:r})):Xu},t.createEdgeIndices8BitDataTexture=function(e,t){if(0==t.length)return Xu;var i=1024,r=Math.ceil(t.length/2/i);if(0==r)throw"texture height == 0";var n=new Uint8Array(i*r*2);n.fill(0),n.set(t,0);var s=e.createTexture();return s?(e.bindTexture(e.TEXTURE_2D,s),e.texStorage2D(e.TEXTURE_2D,1,e.RG8UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RG_INTEGER,e.UNSIGNED_BYTE,n,0),this.disableFilteringForBoundTexture(e),e.bindTexture(e.TEXTURE_2D,null),new gl({gl:e,texture:s,textureWidth:i,textureHeight:r})):Xu},t.createEdgeIndices16BitDataTexture=function(e,t){if(0==t.length)return Xu;var i=1024,r=Math.ceil(t.length/2/i);if(0==r)throw"texture height == 0";var n=new Uint16Array(i*r*2);n.fill(0),n.set(t,0);var s=e.createTexture();return s?(e.bindTexture(e.TEXTURE_2D,s),e.texStorage2D(e.TEXTURE_2D,1,e.RG16UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RG_INTEGER,e.UNSIGNED_SHORT,n,0),this.disableFilteringForBoundTexture(e),e.bindTexture(e.TEXTURE_2D,null),new gl({gl:e,texture:s,textureWidth:i,textureHeight:r})):Xu},t.createEdgeIndices32BitDataTexture=function(e,t){if(0==t.length)return Xu;var i=1024,r=Math.ceil(t.length/2/i);if(0==r)throw"texture height == 0";var n=new Uint32Array(i*r*2);n.fill(0),n.set(t,0);var s=e.createTexture();return s?(e.bindTexture(e.TEXTURE_2D,s),e.texStorage2D(e.TEXTURE_2D,1,e.RG32UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RG_INTEGER,e.UNSIGNED_INT,n,0),this.disableFilteringForBoundTexture(e),e.bindTexture(e.TEXTURE_2D,null),new gl({gl:e,texture:s,textureWidth:i,textureHeight:r})):Xu},t.createEachMeshAttributesDataTexture=function(e,t,i,r,n,s){var o=t.length;if(0==o)throw"texture height == 0";for(var a=new Uint8Array(28*o),h=0;h<o;h++)a.set(t[h],28*h+0),a.set(i[h],28*h+4),a.set([0,0,0,0],28*h+8),a.set([0,0,0,0],28*h+12),a.set([r[h]>>24&255,r[h]>>16&255,r[h]>>8&255,255&r[h]],28*h+16),a.set([n[h]>>24&255,n[h]>>16&255,n[h]>>8&255,255&n[h]],28*h+20),a.set([s[h]>>24&255,s[h]>>16&255,s[h]>>8&255,255&s[h]],28*h+24);var l=e.createTexture();return l?(e.bindTexture(e.TEXTURE_2D,l),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA8UI,7,o),e.texSubImage2D(e.TEXTURE_2D,0,0,0,7,o,e.RGBA_INTEGER,e.UNSIGNED_BYTE,a,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new gl({gl:e,texture:l,textureWidth:7,textureHeight:o,textureData:a})):Xu},t.createEachEdgeOffsetDataTexture=function(e,t){var i=t.length;if(0==i)throw"texture height == 0";for(var r=new Float32Array(3*i),n=0;n<t.length;n++)r.set(t[n],3*n);var s=e.createTexture();return s?(e.bindTexture(e.TEXTURE_2D,s),e.texStorage2D(e.TEXTURE_2D,1,e.RGB32F,1,i),e.texSubImage2D(e.TEXTURE_2D,0,0,0,1,i,e.RGB,e.FLOAT,r,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new gl({gl:e,texture:s,textureWidth:1,textureHeight:i,textureData:r})):Xu},t.createEachMeshMatricesDataTexture=function(e,t,i){var r=t.length;if(0==r)throw"texture height == 0";for(var n=new Uu(48*r),s=0;s<t.length;s++)n.set(t[s],48*s),n.set(i[s],48*s+16);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA16F,12,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,12,r,e.RGBA,e.HALF_FLOAT,new Uint16Array(n.buffer),0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new gl({gl:e,texture:o,textureWidth:12,textureHeight:r})):Xu},t.createPointerTableDataTexture=function(e,t){if(0==t.length)return Xu;var i=e.createTexture();if(!i)return Xu;var r=1024,n=Math.ceil(t.length/r);if(0==n)throw"texture height == 0";var s=new Uint16Array(r*n);return s.set(t,0),e.bindTexture(e.TEXTURE_2D,i),e.texStorage2D(e.TEXTURE_2D,1,e.R16UI,r,n),e.texSubImage2D(e.TEXTURE_2D,0,0,0,r,n,e.RED_INTEGER,e.UNSIGNED_SHORT,s,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new gl({gl:e,texture:i,textureWidth:r,textureHeight:n})},e}(),Vu=256,Hu=512,Wu=1024,Yu=2048,zu=/*#__PURE__*/function(){function e(){this.numMeshes=void 0,this.numVisible=void 0,this.numTransparent=void 0,this.numEdges=void 0,this.numXRayed=void 0,this.numSelected=void 0,this.numHighlighted=void 0,this.numClippable=void 0,this.numPickable=void 0,this.numCulled=void 0,this.reset()}return e.prototype.reset=function(){this.numMeshes=0,this.numVisible=0,this.numTransparent=0,this.numEdges=0,this.numXRayed=0,this.numSelected=0,this.numHighlighted=0,this.numClippable=0,this.numPickable=0,this.numCulled=0},e}(),Ku=de(),qu=R([0,0,0,1]),Zu=R([0,0,0,1]),Qu=new Uint8Array(4),Ju=new Float32Array(3),$u=function(){this.positionsCompressed=void 0,this.indices_8Bits=void 0,this.indices_16Bits=void 0,this.indices_32Bits=void 0,this.edgeIndices_8Bits=void 0,this.edgeIndices_16Bits=void 0,this.edgeIndices_32Bits=void 0,this.eachMeshVertexPortionBase=void 0,this.eachMeshVertexPortionOffset=void 0,this.eachMeshEdgeIndicesOffset=void 0,this.eachMeshColor=void 0,this.eachMeshPickColor=void 0,this.eachMeshMatrices=void 0,this.eachMeshNormalMatrix=void 0,this.eachMeshPositionsDecompressMatrix=void 0,this.eachMeshFlags1=void 0,this.eachMeshFlags2=void 0,this.eachPrimitiveMesh_32Bits=void 0,this.eachPrimitiveMesh_16Bits=void 0,this.eachPrimitiveMesh_8Bits=void 0,this.eachEdgeMesh_32Bits=void 0,this.eachEdgeMesh_16Bits=void 0,this.eachEdgeMesh_8Bits=void 0,this.eachEdgeOffset=void 0,this.eachMeshParts=void 0,this.positionsCompressed=[],this.indices_8Bits=[],this.indices_16Bits=[],this.indices_32Bits=[],this.edgeIndices_8Bits=[],this.edgeIndices_16Bits=[],this.edgeIndices_32Bits=[],this.eachMeshVertexPortionBase=[],this.eachMeshVertexPortionOffset=[],this.eachMeshEdgeIndicesOffset=[],this.eachMeshColor=[],this.eachMeshPickColor=[],this.eachMeshMatrices=[],this.eachMeshNormalMatrix=[],this.eachMeshPositionsDecompressMatrix=[],this.eachMeshFlags1=[],this.eachMeshFlags2=[],this.eachPrimitiveMesh_32Bits=[],this.eachPrimitiveMesh_16Bits=[],this.eachPrimitiveMesh_8Bits=[],this.eachEdgeMesh_32Bits=[],this.eachEdgeMesh_16Bits=[],this.eachEdgeMesh_8Bits=[],this.eachEdgeOffset=[],this.eachMeshParts=[]},ed=/*#__PURE__*/c("gl"),td=/*#__PURE__*/c("view"),id=/*#__PURE__*/c("dataTextureBuffer"),rd=/*#__PURE__*/c("geometryHandles"),nd=/*#__PURE__*/c("meshPartHandles"),sd=/*#__PURE__*/c("numMeshParts"),od=/*#__PURE__*/c("deferredSetFlagsActive"),ad=/*#__PURE__*/c("deferredSetFlagsDirty"),hd=/*#__PURE__*/c("built"),ld=/*#__PURE__*/c("createGeometryBucket"),cd=/*#__PURE__*/c("createMeshPart"),ud=/*#__PURE__*/c("setMeshFlags"),dd=/*#__PURE__*/c("setMeshFlags2"),vd=/*#__PURE__*/function(){function e(e,t){Object.defineProperty(this,dd,{value:gd}),Object.defineProperty(this,ud,{value:yd}),Object.defineProperty(this,cd,{value:pd}),Object.defineProperty(this,ld,{value:fd}),this.sceneModel=void 0,this.layerIndex=void 0,this.rtcViewMat=void 0,this.meshCounts=void 0,this.renderState=void 0,Object.defineProperty(this,ed,{writable:!0,value:void 0}),Object.defineProperty(this,td,{writable:!0,value:void 0}),Object.defineProperty(this,id,{writable:!0,value:void 0}),Object.defineProperty(this,rd,{writable:!0,value:void 0}),Object.defineProperty(this,nd,{writable:!0,value:void 0}),Object.defineProperty(this,sd,{writable:!0,value:void 0}),Object.defineProperty(this,od,{writable:!0,value:void 0}),Object.defineProperty(this,ad,{writable:!0,value:void 0}),Object.defineProperty(this,hd,{writable:!0,value:void 0}),this.meshCounts=new zu,this.layerIndex=e.layerIndex,this.sceneModel=e.sceneModel,this.renderState={primitive:e.primitive,dataTextureSet:new pl,origin:j(e.origin),numIndices8Bits:0,numIndices16Bits:0,numIndices32Bits:0,numEdgeIndices8Bits:0,numEdgeIndices16Bits:0,numEdgeIndices32Bits:0,numVertices:0},u(this,ed)[ed]=e.gl,u(this,td)[td]=e.view,u(this,id)[id]=new $u,u(this,sd)[sd]=0,u(this,rd)[rd]={},u(this,nd)[nd]=[],this.rtcViewMat=e.view.camera.getRTCViewMat(this.renderState.origin),this.beginDeferredFlags(),u(this,hd)[hd]=!1}var t=e.prototype;return t.canCreateMesh=function(e){if(u(this,hd)[hd])throw"Already built";var t=this.renderState,i=e.geometryBuckets.length;if(u(this,sd)[sd]+i>4096)return!1;for(var r=0,n=0,s=0;s<i;s++){var o=e.geometryBuckets[s];r+=o.positionsCompressed.length,o.indices&&(n+=o.indices.length)}return t.numVertices+r/(e.primitive===gt?1:e.primitive==bt?2:3)<=2097152&&n/3+n<=2097152},t.hasGeometry=function(e){return u(this,rd)[rd][e]},t.createGeometryCompressed=function(e){if(u(this,hd)[hd])throw"Already built";for(var t=[],i=0,r=e.geometryBuckets.length;i<r;i++)t.push(u(this,ld)[ld](e.geometryBuckets[i]));u(this,rd)[rd][e.id]={id:e.id,aabb:e.aabb,positionsDecompressMatrix:e.positionsDecompressMatrix,geometryBucketHandles:t}},t.createMesh=function(e){var t=this;if(u(this,hd)[hd])throw"Already built";var i=this.meshCounts.numMeshes;if(!e.geometryId)throw"geometryId expected";var r=u(this,rd)[rd][e.geometryId];if(!r)throw"Geometry not found";r.geometryBucketHandles.forEach(function(i){u(t,cd)[cd](e,r,i)});for(var n=yi(),s=gi(r.aabb),o=0,a=s.length;o<a;o+=4)qu[0]=s[o+0],qu[1]=s[o+1],qu[2]=s[o+2],e.matrix?(_e(e.matrix,qu,Zu),wi(n,Zu)):wi(n,Zu);return this.meshCounts.numMeshes++,i},t.build=function(){if(u(this,hd)[hd])throw"Already built";var e=u(this,ed)[ed],t=new Gu,i=u(this,id)[id],r=this.renderState.dataTextureSet;r.positions=t.createPositionsDataTexture(e,i.positionsCompressed),r.indices_8Bits=t.createIndices8BitDataTexture(e,i.indices_8Bits),r.indices_16Bits=t.createIndices16BitDataTexture(e,i.indices_16Bits),r.indices_32Bits=t.createIndices32BitDataTexture(e,i.indices_32Bits),r.edgeIndices_8Bits=t.createEdgeIndices8BitDataTexture(e,i.edgeIndices_8Bits),r.edgeIndices_16Bits=t.createEdgeIndices16BitDataTexture(e,i.edgeIndices_16Bits),r.edgeIndices_32Bits=t.createEdgeIndices32BitDataTexture(e,i.edgeIndices_32Bits),r.eachMeshAttributes=t.createEachMeshAttributesDataTexture(e,i.eachMeshColor,i.eachMeshPickColor,i.eachMeshVertexPortionBase,i.eachMeshVertexPortionOffset,i.eachMeshEdgeIndicesOffset),r.eachMeshMatrices=t.createEachMeshMatricesDataTexture(e,i.eachMeshPositionsDecompressMatrix,i.eachMeshMatrices),r.eachEdgeOffset=t.createEachEdgeOffsetDataTexture(e,i.eachEdgeOffset),r.build(),u(this,id)[id]=null,u(this,rd)[rd]={},u(this,nd)[nd]=[],u(this,hd)[hd]=!0},t.isEmpty=function(){return 0==this.meshCounts.numMeshes},t.initFlags=function(e,t,i){1&t&&this.meshCounts.numVisible++,t&Hu&&this.meshCounts.numHighlighted++,t&Vu&&this.meshCounts.numXRayed++,t&Wu&&this.meshCounts.numSelected++,16&t&&this.meshCounts.numClippable++,t&Yu&&this.meshCounts.numEdges++,8&t&&this.meshCounts.numPickable++,4&t&&this.meshCounts.numCulled++,i&&this.meshCounts.numTransparent++,u(this,ud)[ud](e,t,i),u(this,dd)[dd](e,t)},t.beginDeferredFlags=function(){u(this,od)[od]=!0},t.commitDeferredFlags=function(){if(u(this,od)[od]=!1,u(this,ad)[ad]){u(this,ad)[ad]=!1;var e=u(this,ed)[ed],t=this.renderState.dataTextureSet;e.bindTexture(e.TEXTURE_2D,t.eachMeshAttributes.texture),e.texSubImage2D(e.TEXTURE_2D,0,0,0,t.eachMeshAttributes.textureWidth,t.eachMeshAttributes.textureHeight,e.RGBA_INTEGER,e.UNSIGNED_BYTE,t.eachMeshAttributes.textureData),e.bindTexture(e.TEXTURE_2D,t.eachEdgeOffset.texture),e.texSubImage2D(e.TEXTURE_2D,0,0,0,t.eachEdgeOffset.textureWidth,t.eachEdgeOffset.textureHeight,e.RGB,e.FLOAT,t.eachEdgeOffset.textureData)}},t.flushInitFlags=function(){this.commitDeferredFlags()},t.setMeshVisible=function(e,t,i){if(!u(this,hd)[hd])throw"Not built";1&t?this.meshCounts.numVisible++:this.meshCounts.numVisible--,u(this,ud)[ud](e,t,i)},t.setMeshHighlighted=function(e,t,i){if(!u(this,hd)[hd])throw"Not built";t&Hu?this.meshCounts.numHighlighted++:this.meshCounts.numHighlighted--,u(this,ud)[ud](e,t,i)},t.setMeshXRayed=function(e,t,i){if(!u(this,hd)[hd])throw"Not built";t&Vu?this.meshCounts.numXRayed++:this.meshCounts.numXRayed--,u(this,ud)[ud](e,t,i)},t.setMeshSelected=function(e,t,i){if(!u(this,hd)[hd])throw"Not built";t&Wu?this.meshCounts.numSelected++:this.meshCounts.numSelected--,u(this,ud)[ud](e,t,i)},t.setMeshEdges=function(e,t,i){if(!u(this,hd)[hd])throw"Not built";t&Yu?this.meshCounts.numEdges++:this.meshCounts.numEdges--,u(this,ud)[ud](e,t,i)},t.setMeshClippable=function(e,t){if(!u(this,hd)[hd])throw"Not built";16&t?this.meshCounts.numClippable++:this.meshCounts.numClippable--,u(this,dd)[dd](e,t)},t.setMeshCulled=function(e,t,i){if(!u(this,hd)[hd])throw"Not built";4&t?this.meshCounts.numCulled++:this.meshCounts.numCulled--,u(this,ud)[ud](e,t,i)},t.setMeshCollidable=function(e,t){if(!u(this,hd)[hd])throw"Not built"},t.setMeshPickable=function(e,t,i){if(!u(this,hd)[hd])throw"Not built";8&t?this.meshCounts.numPickable++:this.meshCounts.numPickable--,u(this,ud)[ud](e,t,i)},t.setMeshColor=function(e,t,i){if(!u(this,hd)[hd])throw"Not built";var r=this.renderState.dataTextureSet,n=u(this,ed)[ed];Qu[0]=t[0],Qu[1]=t[1],Qu[2]=t[2],Qu[3]=t[3],r.eachMeshAttributes.textureData.set(Qu,28*e),u(this,od)[od]?u(this,ad)[ad]=!0:(n.bindTexture(n.TEXTURE_2D,r.eachMeshAttributes.texture),n.texSubImage2D(n.TEXTURE_2D,0,0,e,1,1,n.RGBA_INTEGER,n.UNSIGNED_BYTE,Qu))},t.setMeshTransparent=function(e,t,i){if(!u(this,hd)[hd])throw"Not built";i?(this.meshCounts.numTransparent++,this.meshCounts.numTransparent++):(this.meshCounts.numTransparent--,this.meshCounts.numTransparent--),u(this,ud)[ud](e,t,i)},t.setMeshOffset=function(e,t){if(!u(this,hd)[hd])throw"Not built";var i=u(this,ed)[ed];Ju[0]=t[0],Ju[1]=t[1],Ju[2]=t[2],u(this,od)[od]?u(this,ad)[ad]=!0:i.texSubImage2D(i.TEXTURE_2D,0,0,e,1,1,i.RGB,i.FLOAT,Ju)},t.destroy=function(){u(this,td)[td].camera.putRTCViewMat(this.rtcViewMat),this.renderState.dataTextureSet.destroy()},r(e,[{key:"hash",get:function(){return"layer-"+this.renderState.primitive+"-"+this.renderState.origin[0]+"-"+this.renderState.origin[1]+"-"+this.renderState.origin[2]}}]),e}();function fd(e){var t=this.renderState;if(e.indices){var i=this.renderState.primitive===gt?1:this.renderState.primitive===bt?2:3,r=8*Math.ceil(e.indices.length/i/8)*i,n=new Uint32Array(r);n.fill(0),n.set(e.indices),e.indices=n}if(e.edgeIndices){var s=8*Math.ceil(e.edgeIndices.length/2/8)*2,o=new Uint32Array(s);o.fill(0),o.set(e.edgeIndices),e.edgeIndices=o}for(var a,h=u(this,id)[id],l=e.positionsCompressed,c=e.indices,d=e.edgeIndices,v=h.positionsCompressed.length/3,f=l.length/3,p=0,y=l.length;p<y;p++)h.positionsCompressed.push(l[p]);var g,b=0;if(c){var w;b=c.length/3,a=(w=f<=256?h.indices_8Bits:f<=65536?h.indices_16Bits:h.indices_32Bits).length/3;for(var m=0,P=c.length;m<P;m++)w.push(c[m])}var _=0;if(d){var E;_=d.length/2,g=(E=f<=256?h.edgeIndices_8Bits:f<=65536?h.edgeIndices_16Bits:h.edgeIndices_32Bits).length/2;for(var T=0,x=d.length;T<x;T++)E.push(d[T])}return t.numVertices+=f,{vertexBase:v,numVertices:f,numTriangles:b,numEdges:_,indicesBase:a,edgeIndicesBase:g}}function pd(e,t,i){var r,n=u(this,id)[id],s=this.renderState,o=e.matrix||Ku,a=e.color||[255,255,255],h=n.positionsCompressed.length/3;n.eachMeshPositionsDecompressMatrix.push(t.positionsDecompressMatrix),n.eachMeshMatrices.push(o),n.eachMeshColor.push([a[0],a[1],a[2],255]),n.eachMeshPickColor.push(e.pickColor),r=i.numVertices<=256?s.numIndices8Bits:i.numVertices<=65536?s.numIndices16Bits:s.numIndices32Bits,n.eachMeshVertexPortionBase.push(i.vertexBase),n.eachMeshVertexPortionOffset.push(r/3-i.indicesBase),n.eachMeshEdgeIndicesOffset.push((i.numVertices<=256?s.numEdgeIndices8Bits:i.numVertices<=65536?s.numEdgeIndices16Bits:s.numEdgeIndices32Bits)/2-i.edgeIndicesBase);var l=u(this,nd)[nd].length;if(i.numTriangles>0){var c,d=3*i.numTriangles;i.numVertices<=256?(c=n.eachPrimitiveMesh_8Bits,s.numIndices8Bits+=d):i.numVertices<=65536?(c=n.eachPrimitiveMesh_16Bits,s.numIndices16Bits+=d):(c=n.eachPrimitiveMesh_32Bits,s.numIndices32Bits+=d);for(var v=0;v<i.numTriangles;v+=8)c.push(l)}if(i.numEdges>0){var f,p=2*i.numEdges;i.numVertices<=256?(f=n.eachEdgeMesh_8Bits,s.numEdgeIndices8Bits+=p):i.numVertices<=65536?(f=n.eachEdgeMesh_16Bits,s.numEdgeIndices16Bits+=p):(f=n.eachEdgeMesh_32Bits,s.numEdgeIndices32Bits+=p);for(var y=0;y<i.numEdges;y+=8)f.push(l)}return n.eachEdgeOffset.push([0,0,0]),u(this,nd)[nd].push({vertsBase:h,numVerts:i.numTriangles}),u(this,sd)[sd]++,l}function yd(e,t,i){if(!u(this,hd)[hd])throw"Not built";var r,n,s,o=!!(1&t),a=!!(t&Vu),h=!!(t&Hu),l=!!(t&Wu),c=!!(4&t);r=!o||c||a?0:i?2:1,n=!o||c?0:l?4:h?3:a?5:0,s=!o||c?0:l?9:h?8:a?10:t&Yu?i?7:6:0;var d=o&&!c&&8&t?11:0,v=this.renderState.dataTextureSet,f=u(this,ed)[ed];if(Qu[0]=r,Qu[1]=n,Qu[2]=s,Qu[3]=d,u(this,od)[od])return v.eachMeshAttributes.textureData.set(Qu,28*e+8),void(u(this,ad)[ad]=!0);f.bindTexture(f.TEXTURE_2D,v.eachMeshAttributes.texture),f.texSubImage2D(f.TEXTURE_2D,0,2,e,1,1,f.RGBA_INTEGER,f.UNSIGNED_BYTE,Qu)}function gd(e,t){if(!u(this,hd)[hd])throw"Not built";var i=16&t?255:0,r=this.renderState.dataTextureSet,n=u(this,ed)[ed];if(Qu[0]=i,Qu[1]=0,Qu[2]=1,Qu[3]=2,u(this,od)[od])return r.eachMeshAttributes.textureData.set(Qu,28*e+12),void(u(this,ad)[ad]=!0);n.bindTexture(n.TEXTURE_2D,r.eachMeshAttributes.texture),n.texSubImage2D(n.TEXTURE_2D,0,3,e,1,1,n.RGBA_INTEGER,n.UNSIGNED_BYTE,Qu)}var bd=/*#__PURE__*/function(){function e(e){this.id=void 0,this.pickId=void 0,this.sceneObject=void 0,this.aabb=void 0,this.layer=void 0,this.meshId=void 0,this.color=void 0,this.colorize=void 0,this.colorizing=void 0,this.transparent=void 0,this.sceneObject=null,this.id=e.id,this.pickId=0,this.color=[e.color[0],e.color[1],e.color[2],e.opacity],this.colorize=[e.color[0],e.color[1],e.color[2],e.opacity],this.colorizing=!1,this.transparent=e.opacity<255,this.sceneObject=null,this.layer=e.layer,this.aabb=ui()}var t=e.prototype;return t.setSceneObject=function(e){this.sceneObject=e},t.build=function(e){this.layer.initFlags(this.meshId,e,this.transparent)},t.finalize2=function(){this.layer.flushInitFlags&&this.layer.flushInitFlags()},t.setVisible=function(e){this.layer.setMeshVisible(this.meshId,e,this.transparent)},t.setColor=function(e){this.color[0]=e[0],this.color[1]=e[1],this.color[2]=e[2],this.colorizing||this.layer.setMeshColor(this.meshId,this.color)},t.setColorize=function(e){e?(this.colorize[0]=e[0],this.colorize[1]=e[1],this.colorize[2]=e[2],this.layer.setMeshColor(this.meshId,this.colorize,!1),this.colorizing=!0):(this.layer.setMeshColor(this.meshId,this.color,!1),this.colorizing=!1)},t.setOpacity=function(e,t){var i=e<255,r=this.transparent!==i;this.color[3]=e,this.colorize[3]=e,this.transparent=i,this.layer.setMeshColor(this.meshId,this.colorizing?this.colorize:this.color),r&&this.layer.setMeshTransparent(this.meshId,t,i)},t.setOffset=function(e){this.layer.setMeshOffset(this.meshId,e)},t.setHighlighted=function(e){this.layer.setMeshHighlighted(this.meshId,e,this.transparent)},t.setXRayed=function(e){this.layer.setMeshXRayed(this.meshId,e,this.transparent)},t.setSelected=function(e){this.layer.setMeshSelected(this.meshId,e,this.transparent)},t.setEdges=function(e){this.layer.setMeshEdges(this.meshId,e,this.transparent)},t.setClippable=function(e){this.layer.setMeshClippable(this.meshId,e)},t.setCollidable=function(e){this.layer.setMeshCollidable(this.meshId,e)},t.setPickable=function(e){this.layer.setMeshPickable(this.meshId,e,this.transparent)},t.setCulled=function(e){this.layer.setMeshCulled(this.meshId,e,this.transparent)},t.canPickTriangle=function(){return!1},t.drawPickTriangles=function(e,t){},t.pickTriangleSurface=function(e){},t.canPickWorldPos=function(){return!0},t.drawPickNormals=function(e){},t.delegatePickedEntity=function(){return this.sceneObject},t.destroy=function(){},e}(),wd=function(e){this.id=void 0,this.colorTexture=void 0,this.metallicRoughnessTexture=void 0,this.normalsTexture=void 0,this.emissiveTexture=void 0,this.occlusionTexture=void 0,this.id=e.id,this.colorTexture=e.colorTexture,this.metallicRoughnessTexture=e.metallicRoughnessTexture,this.normalsTexture=e.normalsTexture,this.emissiveTexture=e.emissiveTexture,this.occlusionTexture=e.occlusionTexture},md=/*#__PURE__*/function(){function e(e){this.id=void 0,this.texture=void 0,this.id=e.id,this.texture=e.texture}return e.prototype.destroy=function(){this.texture&&this.texture.destroy()},e}(),Pd=new Uint16Array([0,0,0]),_d=/*#__PURE__*/c("meshes"),Ed=/*#__PURE__*/c("flags"),Td=/*#__PURE__*/c("aabb"),xd=/*#__PURE__*/c("offsetAABB"),Md=/*#__PURE__*/c("offset"),Od=/*#__PURE__*/c("colorizeUpdated"),jd=/*#__PURE__*/c("opacityUpdated"),Rd=/*#__PURE__*/function(){function e(e){this.id=void 0,this.model=void 0,this.viewLayerId=void 0,Object.defineProperty(this,_d,{writable:!0,value:void 0}),Object.defineProperty(this,Ed,{writable:!0,value:void 0}),Object.defineProperty(this,Td,{writable:!0,value:void 0}),Object.defineProperty(this,xd,{writable:!0,value:void 0}),Object.defineProperty(this,Md,{writable:!0,value:void 0}),Object.defineProperty(this,Od,{writable:!0,value:void 0}),Object.defineProperty(this,jd,{writable:!0,value:void 0}),this.id=e.id,this.model=e.sceneModel,u(this,_d)[_d]=e.meshes||[],u(this,Ed)[Ed]=0,u(this,Td)[Td]=e.aabb,u(this,xd)[xd]=ui(e.aabb),u(this,Md)[Md]=j(),u(this,Od)[Od]=!1,u(this,jd)[jd]=!1,this.viewLayerId=e.viewLayerId||null;for(var t=0,i=u(this,_d)[_d].length;t<i;t++)u(this,_d)[_d][t].setSceneObject(this)}var t=e.prototype;return t.setVisible=function(e,t){if(!!(1&u(this,Ed)[Ed])!==t){u(this,Ed)[Ed]=t?1|u(this,Ed)[Ed]:-2&u(this,Ed)[Ed];for(var i=0,r=u(this,_d)[_d].length;i<r;i++)u(this,_d)[_d][i].setVisible(u(this,Ed)[Ed])}},t.setHighlighted=function(e,t){if(!!(u(this,Ed)[Ed]&Hu)!==t){u(this,Ed)[Ed]=t?u(this,Ed)[Ed]|Hu:-513&u(this,Ed)[Ed];for(var i=0,r=u(this,_d)[_d].length;i<r;i++)u(this,_d)[_d][i].setHighlighted(u(this,Ed)[Ed])}},t.setXRayed=function(e,t){if(!!(u(this,Ed)[Ed]&Vu)!==t){u(this,Ed)[Ed]=t?u(this,Ed)[Ed]|Vu:-257&u(this,Ed)[Ed];for(var i=0,r=u(this,_d)[_d].length;i<r;i++)u(this,_d)[_d][i].setXRayed(u(this,Ed)[Ed])}},t.setSelected=function(e,t){if(!!(u(this,Ed)[Ed]&Wu)!==t){u(this,Ed)[Ed]=t?u(this,Ed)[Ed]|Wu:-1025&u(this,Ed)[Ed];for(var i=0,r=u(this,_d)[_d].length;i<r;i++)u(this,_d)[_d][i].setSelected(u(this,Ed)[Ed])}},t.setEdges=function(e,t){if(!!(u(this,Ed)[Ed]&Yu)!==t){u(this,Ed)[Ed]=t?u(this,Ed)[Ed]|Yu:-2049&u(this,Ed)[Ed];for(var i=0,r=u(this,_d)[_d].length;i<r;i++)u(this,_d)[_d][i].setEdges(u(this,Ed)[Ed])}},t.setCulled=function(e,t){if(!!(4&u(this,Ed)[Ed])!==t){u(this,Ed)[Ed]=t?4|u(this,Ed)[Ed]:-5&u(this,Ed)[Ed];for(var i=0,r=u(this,_d)[_d].length;i<r;i++)u(this,_d)[_d][i].setCulled(u(this,Ed)[Ed])}},t.setClippable=function(e,t){if(!!(16&u(this,Ed)[Ed])!==t){u(this,Ed)[Ed]=t?16|u(this,Ed)[Ed]:-17&u(this,Ed)[Ed];for(var i=0,r=u(this,_d)[_d].length;i<r;i++)u(this,_d)[_d][i].setClippable(u(this,Ed)[Ed])}},t.setCollidable=function(e,t){if(!!(32&u(this,Ed)[Ed])!==t){u(this,Ed)[Ed]=t?32|u(this,Ed)[Ed]:-33&u(this,Ed)[Ed];for(var i=0,r=u(this,_d)[_d].length;i<r;i++)u(this,_d)[_d][i].setCollidable(u(this,Ed)[Ed])}},t.setPickable=function(e,t){if(!!(8&u(this,Ed)[Ed])!==t){u(this,Ed)[Ed]=t?8|u(this,Ed)[Ed]:-9&u(this,Ed)[Ed];for(var i=0,r=u(this,_d)[_d].length;i<r;i++)u(this,_d)[_d][i].setPickable(u(this,Ed)[Ed])}},t.setColorize=function(e,t){if(t){Pd[0]=Math.floor(255*t[0]),Pd[1]=Math.floor(255*t[1]),Pd[2]=Math.floor(255*t[2]);for(var i=0,r=u(this,_d)[_d].length;i<r;i++)u(this,_d)[_d][i].setColorize(Pd)}else for(var n=0,s=u(this,_d)[_d].length;n<s;n++)u(this,_d)[_d][n].setColorize(null)},t.setOpacity=function(e,t){if(0!==u(this,_d)[_d].length){var i=u(this,_d)[_d][0].colorize[3],r=255;if(null!=t){if(t<0?t=0:t>1&&(t=1),i===(r=Math.floor(255*t)))return}else if(i===(r=255))return;for(var n=0,s=u(this,_d)[_d].length;n<s;n++)u(this,_d)[_d][n].setOpacity(r,u(this,Ed)[Ed])}},t.setOffset=function(e,t){t?(u(this,Md)[Md][0]=t[0],u(this,Md)[Md][1]=t[1],u(this,Md)[Md][2]=t[2]):(u(this,Md)[Md][0]=0,u(this,Md)[Md][1]=0,u(this,Md)[Md][2]=0);for(var i=0,r=u(this,_d)[_d].length;i<r;i++)u(this,_d)[_d][i].setOffset(u(this,Md)[Md]);u(this,xd)[xd][0]=u(this,Td)[Td][0]+u(this,Md)[Md][0],u(this,xd)[xd][1]=u(this,Td)[Td][1]+u(this,Md)[Md][1],u(this,xd)[xd][2]=u(this,Td)[Td][2]+u(this,Md)[Md][2],u(this,xd)[xd][3]=u(this,Td)[Td][3]+u(this,Md)[Md][0],u(this,xd)[xd][4]=u(this,Td)[Td][4]+u(this,Md)[Md][1],u(this,xd)[xd][5]=u(this,Td)[Td][5]+u(this,Md)[Md][2]},t.build=function(){for(var e=0,t=u(this,_d)[_d].length;e<t;e++)u(this,_d)[_d][e].build(u(this,Ed)[Ed])},t.finalize2=function(){for(var e=0,t=u(this,_d)[_d].length;e<t;e++)u(this,_d)[_d][e].finalize2()},t.destroy=function(){for(var e=0,t=u(this,_d)[_d].length;e<t;e++)u(this,_d)[_d][e].destroy()},r(e,[{key:"aabb",get:function(){return u(this,xd)[xd]}}]),e}(),Sd=j(),Ad=se(),Cd=j([1,1,1]),kd=j([0,0,0]),Dd=j([0,0,0]),Id=Xe(),Bd="defaultColorTexture",Ld="defaultMetalRoughTexture",Fd="defaultNormalsTexture",Ud="defaultEmissiveTexture",Nd="defaultOcclusionTexture",Xd="defaultTextureSet",Gd=/*#__PURE__*/c("view"),Vd=/*#__PURE__*/c("webglRenderer"),Hd=/*#__PURE__*/c("renderContext"),Wd=/*#__PURE__*/c("origin"),Yd=/*#__PURE__*/c("position"),zd=/*#__PURE__*/c("rotation"),Kd=/*#__PURE__*/c("quaternion"),qd=/*#__PURE__*/c("scale"),Zd=/*#__PURE__*/c("worldMatrix"),Qd=/*#__PURE__*/c("viewMatrix"),Jd=/*#__PURE__*/c("colorTextureEnabled"),$d=/*#__PURE__*/c("backfaces"),ev=/*#__PURE__*/c("geometries"),tv=/*#__PURE__*/c("textures"),iv=/*#__PURE__*/c("textureSets"),rv=/*#__PURE__*/c("meshes"),nv=/*#__PURE__*/c("layers"),sv=/*#__PURE__*/c("numGeometries"),ov=/*#__PURE__*/c("numTriangles"),av=/*#__PURE__*/c("numLines"),hv=/*#__PURE__*/c("numPoints"),lv=/*#__PURE__*/c("numSceneObjects"),cv=/*#__PURE__*/c("textureTranscoder"),uv=/*#__PURE__*/c("aabbDirty"),dv=/*#__PURE__*/c("lastPositionsDecompressMatrix"),vv=/*#__PURE__*/c("edgeThreshold"),fv=/*#__PURE__*/c("lastmeshHadNormals"),pv=/*#__PURE__*/c("currentLayers"),yv=/*#__PURE__*/c("aabb"),gv=/*#__PURE__*/c("viewMatrixDirty"),bv=/*#__PURE__*/c("worldMatrixNonIdentity"),wv=/*#__PURE__*/c("onCameraViewMatrix"),mv=/*#__PURE__*/c("built"),Pv=/*#__PURE__*/c("viewLayerId"),_v=/*#__PURE__*/c("createDefaultTextureSet"),Ev=/*#__PURE__*/c("getLayer"),Tv=/*#__PURE__*/c("rebuildAABB"),xv=/*#__PURE__*/function(t){function i(i){var r;return r=t.call(this,i.view)||this,Object.defineProperty(o(r),Tv,{value:jv}),Object.defineProperty(o(r),Ev,{value:Ov}),Object.defineProperty(o(r),_v,{value:Mv}),r.qualityRender=void 0,r.scene=void 0,r.objects=void 0,r.objectList=void 0,Object.defineProperty(o(r),Gd,{writable:!0,value:void 0}),Object.defineProperty(o(r),Vd,{writable:!0,value:void 0}),Object.defineProperty(o(r),Hd,{writable:!0,value:void 0}),Object.defineProperty(o(r),Wd,{writable:!0,value:void 0}),Object.defineProperty(o(r),Yd,{writable:!0,value:void 0}),Object.defineProperty(o(r),zd,{writable:!0,value:void 0}),Object.defineProperty(o(r),Kd,{writable:!0,value:void 0}),Object.defineProperty(o(r),qd,{writable:!0,value:void 0}),Object.defineProperty(o(r),Zd,{writable:!0,value:void 0}),Object.defineProperty(o(r),Qd,{writable:!0,value:void 0}),Object.defineProperty(o(r),Jd,{writable:!0,value:void 0}),Object.defineProperty(o(r),$d,{writable:!0,value:void 0}),Object.defineProperty(o(r),ev,{writable:!0,value:void 0}),Object.defineProperty(o(r),tv,{writable:!0,value:void 0}),Object.defineProperty(o(r),iv,{writable:!0,value:void 0}),Object.defineProperty(o(r),rv,{writable:!0,value:void 0}),Object.defineProperty(o(r),nv,{writable:!0,value:void 0}),r.layerList=void 0,Object.defineProperty(o(r),sv,{writable:!0,value:void 0}),Object.defineProperty(o(r),ov,{writable:!0,value:void 0}),Object.defineProperty(o(r),av,{writable:!0,value:void 0}),Object.defineProperty(o(r),hv,{writable:!0,value:void 0}),Object.defineProperty(o(r),lv,{writable:!0,value:void 0}),Object.defineProperty(o(r),cv,{writable:!0,value:void 0}),Object.defineProperty(o(r),uv,{writable:!0,value:void 0}),Object.defineProperty(o(r),dv,{writable:!0,value:void 0}),Object.defineProperty(o(r),vv,{writable:!0,value:void 0}),Object.defineProperty(o(r),fv,{writable:!0,value:void 0}),Object.defineProperty(o(r),pv,{writable:!0,value:void 0}),Object.defineProperty(o(r),yv,{writable:!0,value:void 0}),Object.defineProperty(o(r),gv,{writable:!0,value:void 0}),Object.defineProperty(o(r),bv,{writable:!0,value:void 0}),Object.defineProperty(o(r),wv,{writable:!0,value:void 0}),Object.defineProperty(o(r),mv,{writable:!0,value:void 0}),Object.defineProperty(o(r),Pv,{writable:!0,value:void 0}),r.onBuilt=void 0,r.id=i.id,r.scene=i.scene,r.objects={},r.objectList=[],u(o(r),Gd)[Gd]=i.view,u(o(r),Vd)[Vd]=i.webglRenderer,u(o(r),Hd)[Hd]=i.renderContext,u(o(r),cv)[cv]=i.textureTranscoder,u(o(r),yv)[yv]=yi(),u(o(r),uv)[uv]=!1,u(o(r),nv)[nv]={},r.layerList=[],u(o(r),pv)[pv]={},u(o(r),ev)[ev]={},u(o(r),tv)[tv]={},u(o(r),iv)[iv]={},u(o(r),rv)[rv]={},u(o(r),sv)[sv]=0,u(o(r),lv)[lv]=0,u(o(r),ov)[ov]=0,u(o(r),av)[av]=0,u(o(r),hv)[hv]=0,u(o(r),vv)[vv]=i.edgeThreshold||10,u(o(r),mv)[mv]=!1,u(o(r),Wd)[Wd]=j(i.origin||[0,0,0]),u(o(r),Yd)[Yd]=j(i.position||[0,0,0]),u(o(r),zd)[zd]=j(i.rotation||[0,0,0]),u(o(r),Kd)[Kd]=R(i.quaternion||[0,0,0,1]),i.rotation&&Ge(u(o(r),zd)[zd],"XYZ",u(o(r),Kd)[Kd]),u(o(r),qd)[qd]=j(i.scale||[1,1,1]),u(o(r),Zd)[Zd]=se(),Se(u(o(r),Yd)[Yd],u(o(r),Kd)[Kd],u(o(r),qd)[qd],u(o(r),Zd)[Zd]),(i.matrix||i.position||i.rotation||i.scale||i.quaternion)&&(u(o(r),Qd)[Qd]=se(),u(o(r),gv)[gv]=!0,u(o(r),bv)[bv]=!0),r.qualityRender=!1!==i.qualityRender,u(o(r),Pv)[Pv]=i.viewLayerId,u(o(r),wv)[wv]=u(o(r),Gd)[Gd].camera.onViewMatrix.subscribe(function(e,t){u(o(r),gv)[gv]=!0}),u(o(r),_v)[_v](),r.onBuilt=new v(new e.EventDispatcher),r}n(i,t);var s=i.prototype;return s.setVisible=function(e,t){for(var i=0,r=this.objectList.length;i<r;i++)this.objectList[i].setVisible(e,t);u(this,Vd)[Vd].setImageDirty(e)},s.setXRayed=function(e,t){for(var i=0,r=this.objectList.length;i<r;i++)this.objectList[i].setXRayed(e,t);u(this,Vd)[Vd].setImageDirty(e)},s.setHighlighted=function(e,t){for(var i=0,r=this.objectList.length;i<r;i++)this.objectList[i].setHighlighted(e,t);u(this,Vd)[Vd].setImageDirty(e)},s.setSelected=function(e,t){for(var i=0,r=this.objectList.length;i<r;i++)this.objectList[i].setSelected(e,t);u(this,Vd)[Vd].setImageDirty(e)},s.setEdges=function(e,t){for(var i=0,r=this.objectList.length;i<r;i++)this.objectList[i].setEdges(e,t);u(this,Vd)[Vd].setImageDirty(e)},s.setCulled=function(e,t){for(var i=0,r=this.objectList.length;i<r;i++)this.objectList[i].setCulled(e,t);u(this,Vd)[Vd].setImageDirty(e)},s.setClippable=function(e,t){for(var i=0,r=this.objectList.length;i<r;i++)this.objectList[i].setClippable(e,t);u(this,Vd)[Vd].setImageDirty(e)},s.setCollidable=function(e,t){for(var i=0,r=this.objectList.length;i<r;i++)this.objectList[i].setCollidable(e,t)},s.setPickable=function(e,t){for(var i=0,r=this.objectList.length;i<r;i++)this.objectList[i].setPickable(e,t)},s.setColorize=function(e,t){for(var i=0,r=this.objectList.length;i<r;i++)this.objectList[i].setColorize(e,t)},s.setOpacity=function(e,t){for(var i=0,r=this.objectList.length;i<r;i++)this.objectList[i].setOpacity(e,t)},s.createTransform=function(e){if(this.destroyed)throw new Error("SceneModel already destroyed");if(u(this,mv)[mv])throw new Error("SceneModel already built");return null},s.createGeometry=function(e){if(this.destroyed)throw new Error("SceneModel already destroyed");if(u(this,mv)[mv])throw new Error("SceneModel already built");var t=e.id;if(u(this,ev)[ev][t])this.error("[createGeometry] Geometry with this ID already created: "+t);else{var i=e.primitive;i===gt||i===bt||i===wt||i===mt||i===Pt?e.positions?e.indices||i===gt?(u(this,ev)[ev][t]=ti(e),u(this,sv)[sv]++):this.error("[createGeometry] Param expected: indices (required for primitive type)"):this.error("[createGeometry] Param expected: `positions`"):this.error("[createGeometry] Unsupported value for 'primitive': '"+i+"' - supported values are PointsPrimitive, LinesPrimitive, TrianglesPrimitive, SolidPrimitive and SurfacePrimitive")}},s.createGeometryCompressed=function(e){if(this.destroyed)throw new Error("SceneModel already destroyed");if(u(this,mv)[mv])throw new Error("SceneModel already built");var t=e.id;if(u(this,ev)[ev][t])this.error("[createGeometryCompressed] Geometry with this ID already created: "+t);else{var i=e.primitive;i===gt||i===bt||i===wt||i===mt||i===Pt?(u(this,ev)[ev][t]=e,u(this,sv)[sv]++):this.error("[createGeometryCompressed] Unsupported value for 'primitive': '"+i+"' - supported values are PointsPrimitive, LinesPrimitive, TrianglesPrimitive, SolidPrimitive and SurfacePrimitive")}},s.createTexture=function(e){var t=this;if(this.destroyed)throw new Error("SceneModel already destroyed");if(u(this,mv)[mv])throw new Error("SceneModel already built");var i=e.id;if(null!=i)if(u(this,tv)[tv][i])this.error("[createTexture] Texture already created: "+i);else if(e.src||e.image||e.buffers){var r=e.minFilter||ut;r!==ct&&1007!==r&&r!==ut&&1005!==r&&1004!==r&&(this.error("[createTexture] Unsupported value for 'minFilter' - \n            supported values are LinearFilter, LinearMipMapNearestFilter, NearestMipMapNearestFilter, \n            NearestMipMapLinearFilter and LinearMipmapLinearFilter. Defaulting to LinearMipmapLinearFilter."),r=ut);var n=e.magFilter||ct;n!==ct&&n!==lt&&(this.error("[createTexture] Unsupported value for 'magFilter' - supported values are LinearFilter and NearestFilter. Defaulting to LinearFilter."),n=ct);var s=e.wrapS||ot;s!==at&&s!==ht&&s!==ot&&(this.error("[createTexture] Unsupported value for 'wrapS' - supported values are ClampToEdgeWrapping, MirroredRepeatWrapping and RepeatWrapping. Defaulting to RepeatWrapping."),s=ot);var o=e.wrapT||ot;o!==at&&o!==ht&&o!==ot&&(this.error("[createTexture] Unsupported value for 'wrapT' - supported values are ClampToEdgeWrapping, MirroredRepeatWrapping and RepeatWrapping. Defaulting to RepeatWrapping."),o=ot);var a=e.wrapR||ot;a!==at&&a!==ht&&a!==ot&&(this.error("[createTexture] Unsupported value for 'wrapR' - supported values are ClampToEdgeWrapping, MirroredRepeatWrapping and RepeatWrapping. Defaulting to RepeatWrapping."),a=ot);var h=e.encoding||pt;h!==pt&&h!==yt&&(this.error("[createTexture] Unsupported value for 'encoding' - supported values are LinearEncoding and sRGBEncoding. Defaulting to LinearEncoding."),h=pt);var l=new cl({gl:u(this,Hd)[Hd].gl});if(e.preloadColor&&l.setPreloadColor(e.preloadColor),e.image){var c=e.image;c.crossOrigin="Anonymous",l.setImage(c,{minFilter:r,magFilter:n,wrapS:s,wrapT:o,wrapR:a,flipY:e.flipY,encoding:h})}else if(e.src){var d=e.src.split(".").pop();switch(d){case"jpeg":case"jpg":case"png":case"gif":var v=new Image;v.onload=function(){l.setImage(v,{minFilter:r,magFilter:n,wrapS:s,wrapT:o,wrapR:a,flipY:e.flipY,encoding:h})},v.src=e.src;break;default:u(this,cv)[cv]?function(e,t,i){var r=function(e){};t=t||r,i=i||r;var n=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(n){var s=!!n[2],o=n[3];o=window.decodeURIComponent(o),s&&(o=window.atob(o));try{for(var a=new ArrayBuffer(o.length),h=new Uint8Array(a),l=0;l<o.length;l++)h[l]=o.charCodeAt(l);window.setTimeout(function(){t(a)},0)}catch(e){window.setTimeout(function(){i(e)},0)}}else{var c=new XMLHttpRequest;c.open("GET",e,!0),c.responseType="arraybuffer",c.onreadystatechange=function(){4===c.readyState&&(200===c.status?t(c.response):i("loadArrayBuffer error : "+c.response))},c.send(null)}}(e.src,function(e){e.byteLength?u(t,cv)[cv].transcode([e]).then(function(e){l.setCompressedData(e),u(t,Vd)[Vd].setImageDirty()}):t.error("Can't create texture from 'src': file data is zero length")},function(e){t.error("Can't create texture from 'src': "+e)}):this.error("Can't create texture from 'src' - SceneModel needs to be configured with a TextureTranscoder for this file type ('"+d+"')")}}else e.buffers&&(u(this,cv)[cv]?u(this,cv)[cv].transcode(e.buffers).then(function(e){l.setCompressedData(e),u(t,Vd)[Vd].setImageDirty()}):this.error("Can't create texture from 'buffers' - SceneModel needs to be configured with a TextureTranscoder for this option"));u(this,tv)[tv][i]=new md({id:i,texture:l})}else this.error("[createTexture] Param expected: `src`, `image' or 'buffers'");else this.error("[createTexture] Config missing: id")},s.createTextureSet=function(e){if(this.destroyed)throw new Error("SceneModel already destroyed");if(u(this,mv)[mv])throw new Error("SceneModel already built");var t=e.id;if(null!=t)if(u(this,iv)[iv][t])this.error("Texture set already created: "+t);else{var i,r,n,s,o;if(null!=e.colorTextureId){if(!(i=u(this,tv)[tv][e.colorTextureId]))return void this.error("Texture not found: "+e.colorTextureId+" - ensure that you create it first with createTexture()")}else i=u(this,tv)[tv][Bd];if(null!=e.metallicRoughnessTextureId){if(!(r=u(this,tv)[tv][e.metallicRoughnessTextureId]))return void this.error("Texture not found: "+e.metallicRoughnessTextureId+" - ensure that you create it first with createTexture()")}else r=u(this,tv)[tv][Ld];if(null!=e.normalsTextureId){if(!(n=u(this,tv)[tv][e.normalsTextureId]))return void this.error("Texture not found: "+e.normalsTextureId+" - ensure that you create it first with createTexture()")}else n=u(this,tv)[tv][Fd];if(null!=e.emissiveTextureId){if(!(s=u(this,tv)[tv][e.emissiveTextureId]))return void this.error("Texture not found: "+e.emissiveTextureId+" - ensure that you create it first with createTexture()")}else s=u(this,tv)[tv][Ud];if(null!=e.occlusionTextureId){if(!(o=u(this,tv)[tv][e.occlusionTextureId]))return void this.error("Texture not found: "+e.occlusionTextureId+" - ensure that you create it first with createTexture()")}else o=u(this,tv)[tv][Nd];u(this,iv)[iv][t]=new wd({id:t,colorTexture:i,metallicRoughnessTexture:r,normalsTexture:n,emissiveTexture:s,occlusionTexture:o})}else this.error("Config missing: id")},s.createMesh=function(e){if(this.destroyed)throw new Error("SceneModel already destroyed");if(u(this,mv)[mv])throw new Error("SceneModel already built");var t=u(this,ev)[ev][e.geometryId];if(t){var i=Sd;i[0]=u(this,Wd)[Wd][0],i[1]=u(this,Wd)[Wd][1],i[2]=u(this,Wd)[Wd][2],t.origin&&(i[0]+=t.origin[0],i[1]+=t.origin[1],i[2]+=t.origin[2]),e.origin&&(i[0]+=e.origin[0],i[1]+=e.origin[1],i[2]+=e.origin[2]);var r=u(this,Ev)[Ev](i,e.textureSetId,t);if(r){r.hasGeometry(e.geometryId)||r.createGeometryCompressed(t);var n=e.color?new Uint8Array([Math.floor(255*e.color[0]),Math.floor(255*e.color[1]),Math.floor(255*e.color[2])]):[255,255,255],s=null!=e.opacity?Math.floor(255*e.opacity):255,o=null!=e.metallic?Math.floor(255*e.metallic):0,a=null!=e.roughness?Math.floor(255*e.roughness):255,h=new bd({id:e.id,layer:r,color:n,opacity:s});h.pickId=u(this,Vd)[Vd].registerPickable(h);var l,c=new Uint8Array([255&h.pickId,h.pickId>>8&255,h.pickId>>16&255,h.pickId>>24&255]);if(yi(h.aabb),u(this,bv)[bv]&&u(this,Zd),e.matrix)l=e.matrix;else{var d=e.scale||Cd,v=e.position||kd;Ge(e.rotation||Dd,"XYZ",Id),l=Se(v,Id,d,Ad)}var f=r.createMesh({id:e.id,geometryId:e.geometryId,color:n,opacity:s,metallic:o,roughness:a,matrix:l,pickColor:c});u(this,sv)[sv]++,bi(u(this,yv)[yv],h.aabb),h.layer=r,h.meshId=f,u(this,rv)[rv][e.id]=h}}else this.error("[ceateMesh] Geometry not found: "+e.geometryId)},s.createObject=function(e){if(this.destroyed)throw new Error("SceneModel already destroyed");if(u(this,mv)[mv])throw new Error("SceneModel already built");var t=e.id;void 0===t?t=Ii():this.objects[t]&&(this.error("[createObject] SceneModel already has a SceneObject with this ID: "+t+" - will assign random ID"),t=Ii());var i=e.meshIds;if(void 0===i)throw new Error("[createObject] Param expected: meshIds");for(var r,n=[],s=0,o=i.length;s<o;s++){var a=i[s],h=u(this,rv)[rv][a];h?h.sceneObject?this.error("Mesh with ID "+a+" already belongs to object with ID "+h.sceneObject.id+" - ignoring this mesh"):n.push(h):this.error("Mesh with this ID not found: "+a+" - ignoring this mesh")}if(1===n.length)r=n[0].aabb;else{r=yi();for(var l=0,c=n.length;l<c;l++)bi(r,n[l].aabb)}var d=new Rd({id:t,sceneModel:this,meshes:n,aabb:r,viewLayerId:e.viewLayerId||u(this,Pv)[Pv]});return this.objectList.push(d),this.objects[t]=d,u(this,lv)[lv]++,d},s.build=function(){if(this.destroyed)this.log("SceneModel already destroyed");else if(u(this,mv)[mv])this.log("SceneModel already built");else{for(var e in u(this,pv)[pv])u(this,pv)[pv].hasOwnProperty(e)&&u(this,pv)[pv][e].build();for(var t=0,i=this.objectList.length;t<i;t++)this.objectList[t].build();for(var r=0,n=this.objectList.length;r<n;r++)this.objectList[r].finalize2();for(var s=0,o=this.layerList.length;s<o;s++)this.layerList[s].layerIndex=s;u(this,pv)[pv]={},u(this,Vd)[Vd].setImageDirty(),this.scene.setAABBDirty(),this.onBuilt.dispatch(this,null)}},s.destroy=function(){if(!this.destroyed){for(var e in u(this,Gd)[Gd].camera.onViewMatrix.unsubscribe(u(this,wv)[wv]),u(this,pv)[pv])u(this,pv)[pv].hasOwnProperty(e)&&u(this,pv)[pv][e].destroy();for(var i=0,r=this.layerList.length;i<r;i++)this.layerList[i].destroy();for(var n=0,s=this.objectList.length;n<s;n++)this.objectList[n].destroy();for(var o in u(this,rv)[rv])u(this,Vd)[Vd].deregisterPickable(u(this,rv)[rv][o].pickId);u(this,pv)[pv]={},u(this,nv)[nv]={},this.layerList=[],u(this,ev)[ev]={},u(this,tv)[tv]={},u(this,iv)[iv]={},u(this,rv)[rv]={},this.objects={},this.scene.setAABBDirty(),this.onBuilt.clear(),t.prototype.destroy.call(this)}},r(i,[{key:"origin",get:function(){return u(this,Wd)[Wd]}},{key:"position",get:function(){return u(this,Yd)[Yd]}},{key:"rotation",get:function(){return u(this,zd)[zd]}},{key:"quaternion",get:function(){return u(this,Kd)[Kd]}},{key:"scale",get:function(){return u(this,qd)[qd]}},{key:"worldMatrix",get:function(){return u(this,Zd)[Zd]}},{key:"viewMatrix",get:function(){return u(this,Qd)[Qd]?(u(this,gv)[gv]&&(we(u(this,Gd)[Gd].camera.viewMatrix,u(this,Zd)[Zd],u(this,Qd)[Qd]),u(this,gv)[gv]=!1),u(this,Qd)[Qd]):u(this,Gd)[Gd].camera.viewMatrix}},{key:"colorTextureEnabled",get:function(){return u(this,Jd)[Jd]}},{key:"backfaces",get:function(){return u(this,$d)[$d]},set:function(e){e=!!e,u(this,$d)[$d]=e,u(this,Vd)[Vd].setImageDirty()}},{key:"matrix",get:function(){return u(this,Zd)[Zd]}},{key:"aabb",get:function(){return u(this,uv)[uv]&&u(this,Tv)[Tv](),u(this,yv)[yv]}},{key:"numTriangles",get:function(){return u(this,ov)[ov]}},{key:"numLines",get:function(){return u(this,av)[av]}},{key:"numPoints",get:function(){return u(this,hv)[hv]}}]),i}(ur);function Mv(){var e=new md({id:Bd,texture:new cl({gl:u(this,Hd)[Hd].gl,preloadColor:[1,1,1,1]})}),t=new md({id:Ld,texture:new cl({gl:u(this,Hd)[Hd].gl,preloadColor:[0,1,1,1]})}),i=new md({id:Fd,texture:new cl({gl:u(this,Hd)[Hd].gl,preloadColor:[0,0,0,0]})}),r=new md({id:Ud,texture:new cl({gl:u(this,Hd)[Hd].gl,preloadColor:[0,0,0,1]})}),n=new md({id:Nd,texture:new cl({gl:u(this,Hd)[Hd].gl,preloadColor:[1,1,1,1]})});u(this,tv)[tv][Bd]=e,u(this,tv)[tv][Ld]=t,u(this,tv)[tv][Fd]=i,u(this,tv)[tv][Ud]=r,u(this,tv)[tv][Nd]=n,u(this,iv)[iv][Xd]=new wd({id:Xd,colorTexture:e,metallicRoughnessTexture:t,normalsTexture:i,emissiveTexture:r,occlusionTexture:n})}function Ov(e,t,i){var r,n=e[0]+"_"+e[1]+"_"+e[2]+"_"+t+"_"+i.primitive,s=u(this,pv)[pv][n];if(s){if(s.canCreateMesh(i))return s;s.build(),delete u(this,pv)[pv][n]}if(!t||(r=u(this,iv)[iv][t]))return s=new vd({gl:u(this,Hd)[Hd].gl,view:u(this,Gd)[Gd],sceneModel:this,primitive:i.primitive,origin:e,textureSet:r,layerIndex:0}),u(this,nv)[nv][n]=s,this.layerList.push(s),u(this,pv)[pv][n]=s,s;this.error("TextureSet not found: "+t+" - ensure that you create it first with createTextureSet()")}function jv(){yi(u(this,yv)[yv]);for(var e=0,t=this.objectList.length;e<t;e++){var i=this.objectList[e];bi(u(this,yv)[yv],i.aabb)}u(this,uv)[uv]=!1}var Rv=/*#__PURE__*/function(){function e(e,t,i){if(this.errors=void 0,this.allocated=void 0,this.compiled=void 0,this.handle=void 0,this.allocated=!1,this.compiled=!1,this.handle=e.createShader(t),this.handle){if(this.allocated=!0,e.shaderSource(this.handle,i),e.compileShader(this.handle),this.compiled=e.getShaderParameter(this.handle,e.COMPILE_STATUS),!this.compiled&&!e.isContextLost()){for(var r=i.split("\n"),n=[],s=0;s<r.length;s++)n.push(s+1+": "+r[s]+"\n");this.errors=[],this.errors.push(""),this.errors.push(e.getShaderInfoLog(this.handle)||""),this.errors=this.errors.concat(n.join(""))}}else this.errors=["Failed to allocate"]}return e.prototype.destroy=function(){},e}(),Sv=/*#__PURE__*/function(){function e(e,t){this.location=void 0,this.gl=void 0,this.gl=e,this.location=t}return e.prototype.bindTexture=function(e,t){return!!e.bind(t)&&(this.gl.uniform1i(this.location,t),!0)},e}(),Av=/*#__PURE__*/function(){function e(e,t){this.gl=void 0,this.location=void 0,this.gl=e,this.location=t}return e.prototype.bindArrayBuffer=function(e){e&&(e.bind(),this.gl.enableVertexAttribArray(this.location),this.gl.vertexAttribPointer(this.location,e.itemSize,e.itemType,e.normalized,e.stride,e.offset))},e}(),Cv=new Ri({},""),kv=/*#__PURE__*/function(){function e(e,t){if(this.id=void 0,this.vertexShader=void 0,this.fragmentShader=void 0,this.attributes=void 0,this.samplers=void 0,this.uniforms=void 0,this.errors=void 0,this.validated=void 0,this.linked=void 0,this.compiled=void 0,this.allocated=void 0,this.gl=void 0,this.source=void 0,this.handle=void 0,this.id=Cv.addItem({}),this.source=t,this.gl=e,this.allocated=!1,this.compiled=!1,this.linked=!1,this.validated=!1,this.errors=[],this.uniforms={},this.samplers={},this.attributes={},this.vertexShader=new Rv(e,e.VERTEX_SHADER,this.source.vertex),this.fragmentShader=new Rv(e,e.FRAGMENT_SHADER,this.source.fragment),!this.vertexShader.allocated)return this.errors=["Vertex shader failed to allocate"].concat(this.vertexShader.errors),void Dv(this.errors);if(!this.fragmentShader.allocated)return this.errors=["Fragment shader failed to allocate"].concat(this.fragmentShader.errors),void Dv(this.errors);if(this.allocated=!0,!this.vertexShader.compiled)return this.errors=["Vertex shader failed to compile"].concat(this.vertexShader.errors),void Dv(this.errors);if(!this.fragmentShader.compiled)return this.errors=["Fragment shader failed to compile"].concat(this.fragmentShader.errors),void Dv(this.errors);if(this.compiled=!0,this.handle=e.createProgram(),this.handle){if(e.attachShader(this.handle,this.vertexShader.handle),e.attachShader(this.handle,this.fragmentShader.handle),e.linkProgram(this.handle),this.linked=e.getProgramParameter(this.handle,e.LINK_STATUS),this.validated=!0,!this.linked||!this.validated)return this.errors=[],this.errors.push(""),this.errors.push(e.getProgramInfoLog(this.handle)),this.errors.push("\nVertex shader:\n"),this.errors=this.errors.concat(this.source.vertex),this.errors.push("\nFragment shader:\n"),this.errors=this.errors.concat(this.source.fragment),void Dv(this.errors);for(var i=e.getProgramParameter(this.handle,e.ACTIVE_UNIFORMS),r=0;r<i;++r){var n=e.getActiveUniform(this.handle,r);if(n){var s=n.name;"\0"===s[s.length-1]&&(s=s.substr(0,s.length-1));var o=e.getUniformLocation(this.handle,s);n.type===e.SAMPLER_2D||n.type===e.SAMPLER_CUBE||35682===n.type?this.samplers[s]=new Sv(e,o):this.uniforms[s]=o}}for(var a=e.getProgramParameter(this.handle,e.ACTIVE_ATTRIBUTES),h=0;h<a;h++){var l=e.getActiveAttrib(this.handle,h);if(l){var c=e.getAttribLocation(this.handle,l.name);this.attributes[l.name]=new Av(e,c)}}this.allocated=!0}else this.errors=["Failed to allocate program"]}var t=e.prototype;return t.bind=function(){this.allocated&&this.gl.useProgram(this.handle)},t.getLocation=function(e){return this.uniforms[e]},t.getAttribute=function(e){return this.attributes[e]},t.getSampler=function(e){return this.samplers[e]},t.bindTexture=function(e,t,i){if(!this.allocated)return!1;var r=this.samplers[e];return!!r&&r.bindTexture(t,i)},t.destroy=function(){this.allocated&&(Cv.removeItem(this.id),this.gl.deleteProgram(this.handle),this.gl.deleteShader(this.vertexShader.handle),this.gl.deleteShader(this.fragmentShader.handle),this.attributes={},this.uniforms={},this.samplers={},this.allocated=!1)},e}();function Dv(e){console.error(e.join("\n"))}var Iv=R(),Bv=/*#__PURE__*/c("hash"),Lv=/*#__PURE__*/c("program"),Fv=/*#__PURE__*/c("needRebuild"),Uv=/*#__PURE__*/c("uniforms"),Nv=/*#__PURE__*/c("samplers"),Xv=/*#__PURE__*/c("build"),Gv=/*#__PURE__*/c("buildShader"),Vv=/*#__PURE__*/c("getValid"),Hv=/*#__PURE__*/c("bind"),Wv=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,Hv,{value:qv}),Object.defineProperty(this,Vv,{value:Kv}),Object.defineProperty(this,Gv,{value:zv}),Object.defineProperty(this,Xv,{value:Yv}),this.errors=void 0,this.renderContext=void 0,Object.defineProperty(this,Bv,{writable:!0,value:void 0}),Object.defineProperty(this,Lv,{writable:!0,value:void 0}),Object.defineProperty(this,Fv,{writable:!0,value:void 0}),Object.defineProperty(this,Uv,{writable:!0,value:void 0}),Object.defineProperty(this,Nv,{writable:!0,value:void 0}),this.renderContext=e,u(this,Fv)[Fv]=!0,u(this,Xv)[Xv]()}var t=e.prototype;return t.needRebuild=function(){u(this,Fv)[Fv]=!0},t.draw=function(e){if(u(this,Lv)[Lv]&&!u(this,Vv)[Vv]()&&(u(this,Lv)[Lv].destroy(),u(this,Lv)[Lv]=null),!u(this,Lv)[Lv]){if(u(this,Xv)[Xv](),this.errors)return;this.renderContext.lastProgramId=-1}var t=e.renderState,i=u(this,Lv)[Lv],r=this.renderContext,n=r.renderPass,s=this.renderContext.gl,o=this.renderContext.view,a=u(this,Uv)[Uv],h=u(this,Nv)[Nv];if(r.lastProgramId!==i.id&&(r.lastProgramId=i.id,u(this,Hv)[Hv]()),a.renderPass&&s.uniform1i(a.renderPass,n),a.viewMatrix&&s.uniformMatrix4fv(a.viewMatrix,!1,e.rtcViewMat.viewMatrix),a.projMatrix&&s.uniformMatrix4fv(a.projMatrix,!1,o.camera.projMatrix),a.worldMatrix&&s.uniformMatrix4fv(a.worldMatrix,!1,e.sceneModel.worldMatrix),a.color)if(5===n){var l=o.xrayMaterial,c=l.fillColor;s.uniform4f(a.color,c[0],c[1],c[2],l.fillAlpha)}else if(3===n){var d=o.highlightMaterial,v=d.fillColor;s.uniform4f(a.color,v[0],v[1],v[2],d.fillAlpha)}else if(4===n){var f=o.selectedMaterial,p=f.fillColor;s.uniform4f(a.color,p[0],p[1],p[2],f.fillAlpha)}else s.uniform4fv(a.color,new Float32Array([1,1,1]));h.positions&&t.dataTextureSet.positions.bindTexture(i,h.positions,r.nextTextureUnit),h.eachMeshMatrices&&t.dataTextureSet.eachMeshMatrices.bindTexture(i,h.eachMeshMatrices,r.nextTextureUnit),h.eachMeshAttributes&&t.dataTextureSet.eachMeshAttributes.bindTexture(i,h.eachMeshAttributes,r.nextTextureUnit),h.eachPrimitiveMesh&&(t.numIndices8Bits>0&&(t.dataTextureSet.eachPrimitiveMesh_8Bits.bindTexture(i,h.eachPrimitiveMesh,r.nextTextureUnit),t.dataTextureSet.indices_8Bits.bindTexture(i,h.indices,r.nextTextureUnit),s.drawArrays(s.TRIANGLES,0,t.numIndices8Bits)),t.numIndices16Bits>0&&(t.dataTextureSet.eachPrimitiveMesh_16Bits.bindTexture(i,h.eachPrimitiveMesh,r.nextTextureUnit),t.dataTextureSet.indices_16Bits.bindTexture(i,h.indices,r.nextTextureUnit),s.drawArrays(s.TRIANGLES,0,t.numIndices16Bits)),t.numIndices32Bits>0&&(t.dataTextureSet.eachPrimitiveMesh_32Bits.bindTexture(i,h.eachPrimitiveMesh,r.nextTextureUnit),t.dataTextureSet.indices_32Bits.bindTexture(i,h.indices,r.nextTextureUnit),s.drawArrays(s.TRIANGLES,0,t.numIndices32Bits))),h.baseColorMap&&h.baseColorMap.bindTexture(t.materialTextureSet.colorTexture.texture,r.nextTextureUnit),h.metallicRoughMap&&h.metallicRoughMap.bindTexture(t.materialTextureSet.metallicRoughnessTexture.texture,r.nextTextureUnit),h.emissiveMap&&h.emissiveMap.bindTexture(t.materialTextureSet.emissiveTexture.texture,r.nextTextureUnit),h.normalMap&&h.normalMap.bindTexture(t.materialTextureSet.normalsTexture.texture,r.nextTextureUnit),h.occlusionMap&&h.occlusionMap.bindTexture(t.materialTextureSet.occlusionTexture.texture,r.nextTextureUnit)},t.destroy=function(){u(this,Lv)[Lv]&&u(this,Lv)[Lv].destroy(),u(this,Lv)[Lv]=null},r(e,[{key:"vertHeader",get:function(){return"#version 300 es\n                #ifdef GL_FRAGMENT_PRECISION_HIGH\n                precision highp float;\n                precision highp int;\n                precision highp usampler2D;\n                precision highp isampler2D;\n                precision highp sampler2D;\n                #else\n                precision mediump float;\n                precision mediump int;\n                precision mediump usampler2D;\n                precision mediump isampler2D;\n                precision mediump sampler2D;\n                uniform int renderPass;\n                #endif"}},{key:"vertDataTextureDefs",get:function(){return"uniform mediump sampler2D eachMeshMatrices;\n                uniform lowp usampler2D eachMeshAttributes;\n                uniform highp sampler2D eachMeshOffset;\n                uniform mediump usampler2D positions;\n                uniform highp usampler2D indices;\n                uniform mediump usampler2D eachPrimitiveMesh;\n                uniform highp sampler2D cameraMatrices;\n                uniform highp sampler2D sceneModelMatrices;"}},{key:"vertLogDepthBufDefs",get:function(){return this.renderContext.view.logarithmicDepthBufferEnabled?"uniform float logDepthBufFC;\n                    out float fragDepth;\n                    bool isPerspectiveMatrix(mat4 m) {\n                        return (m[2][3] == - 1.0);\n                    }\n                    out float isPerspective;":""}},{key:"vertDataTextureSamples",get:function(){return""}},{key:"vertLogDepthBufOutputs",get:function(){return this.renderContext.view.logarithmicDepthBufferEnabled?"fragDepth = 1.0 + clipPos.w;\n                    isPerspective = float (isPerspectiveMatrix(projMatrix));":""}},{key:"fragmentShader",get:function(){return this.fragHeader+"\n        "+this.fragGammaDefs+"\n        "+this.fragSectionPlaneDefs+"\n        "+this.fragLightDefs+"\n        "+this.fragLogDepthBufDefs+"\n        void main(void) {\n            "+this.fragSectionPlanesSlice+"\n            "+this.fragLighting+"\n            "+this.fragLogDepthBufOutput+"\n        }"}},{key:"fragHeader",get:function(){return"#version 300 es\n        #ifdef GL_FRAGMENT_PRECISION_HIGH\n       precision highp float;\n        precision highp int;\n        #else\n        precision mediump float;\n        precision mediump int;\n        #endif"}},{key:"fragGammaDefs",get:function(){return'uniform float gammaFactor;\n        vec4 linearToLinear( in vec4 value ) {\n            return value;\n        }\n        vec4 sRGBToLinear( in vec4 value ) {\n            return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n        }\n        vec4 gammaToLinear( in vec4 value) {\n            return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n        }\n        vec4 linearToGamma( in vec4 value, in float gammaFactor ) {\n              return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );");\n        }'}},{key:"fragLightDefs",get:function(){var e=this.renderContext.view,t=[];t.push("uniform vec4 lightAmbient;");for(var i=0,r=e.lightsList.length;i<r;i++){var n=e.lightsList[i];"ambient"!==n.type&&(t.push("uniform vec4 lightColor"+i+";"),"dir"===n.type&&t.push("uniform vec3 lightDir"+i+";"),"point"===n.type&&t.push("uniform vec3 lightPos"+i+";"),"spot"===n.type&&(t.push("uniform vec3 lightPos"+i+";"),t.push("uniform vec3 lightDir"+i+";")))}return t.join("\n")}},{key:"fragLogDepthBufDefs",get:function(){return this.renderContext.view.logarithmicDepthBufferEnabled?"in float isPerspective;\n                    uniform float logDepthBufFC;\n                    in float fragDepth;":""}},{key:"fragLogDepthBufOutput",get:function(){return this.renderContext.view.logarithmicDepthBufferEnabled?"gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( fragDepth ) * logDepthBufFC * 0.5;":""}},{key:"fragLighting",get:function(){var e=[];e.push("vec4 viewPosition  = viewMatrix * worldPosition; "),e.push("vec4 modelNormal = vec4(octDecode(normal.xy), 0.0); "),e.push("vec4 worldNormal = worldNormalMatrix * vec4(dot(modelNormal, modelNormalMatrixCol0), dot(modelNormal, modelNormalMatrixCol1), dot(modelNormal, modelNormalMatrixCol2), 0.0);"),e.push("vec3 viewNormal = normalize(vec4(viewNormalMatrix * worldNormal).xyz);"),e.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),e.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),e.push("float lambertian = 1.0;");for(var t=0,i=this.renderContext.view.lightsList.length;t<i;t++){var r=this.renderContext.view.lightsList[t];if("ambient"!==r.type){if("dir"===r.type)e.push("view"===r.space?"viewLightDir = normalize(lightDir"+t+");":"viewLightDir = normalize((viewMatrix * vec4(lightDir"+t+", 0.0)).xyz);");else if("point"===r.type)e.push("view"===r.space?"viewLightDir = -normalize(lightPos"+t+" - viewPosition.xyz);":"viewLightDir = -normalize((viewMatrix * vec4(lightPos"+t+", 0.0)).xyz);");else{if("spot"!==r.type)continue;e.push("view"===r.space?"viewLightDir = normalize(lightDir"+t+");":"viewLightDir = normalize((viewMatrix * vec4(lightDir"+t+", 0.0)).xyz);")}e.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),e.push("reflectedColor += lambertian * (lightColor"+t+".rgb * lightColor"+t+".a);")}}return e.push("vec3 rgb = (vec3(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0));"),e.push("meshColor =  vec4((lightAmbient.rgb * lightAmbient.a * rgb) + (reflectedColor * rgb), float(color.a) / 255.0);"),e.join("\n")}},{key:"fragSAOOutput",get:function(){return this.renderContext.view.sao.enabled?"float viewportWidth     = uSAOParams[0];\n                    float viewportHeight    = uSAOParams[1];\n                    float blendCutoff       = uSAOParams[2];\n                    float blendFactor       = uSAOParams[3];\n                    vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);\n                    float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture(uOcclusionTexture, uv))) * blendFactor;\n                    outColor                = vec4(fragColor.rgb * ambient, 1.0);":"outColor            = fragColor;"}},{key:"fragOutput",get:function(){return"outColor            = fragColor;"}},{key:"fragSectionPlaneDefs",get:function(){var e=[];e.push("in vec4 worldPosition;\n                  in vec4 meshFlags2;");for(var t=0,i=this.renderContext.view.sectionPlanesList.length;t<i;t++)e.push("uniform bool sectionPlaneActive"+t+";\n                      uniform vec3 sectionPlanePos"+t+";\n                      uniform vec3 sectionPlaneDir"+t+";");return e.join("\n")}},{key:"fragLightSourceUniforms",get:function(){var e=[];e.push("uniform vec4 lightAmbient;");for(var t=0,i=this.renderContext.view.lightsList.length;t<i;t++){var r=this.renderContext.view.lightsList[t];r instanceof Kf||(e.push("uniform vec4 lightColor"+t+";"),r instanceof Zf&&e.push("uniform vec3 lightDir"+t+";"),r instanceof Jf&&e.push("uniform vec3 lightPos"+t+";"))}return e.join("\n")}},{key:"fragSectionPlanesSlice",get:function(){var e=[];if(this.renderContext.view.sectionPlanesList.length>0){e.push("bool clippable = (float(meshFlags2.x) > 0.0);\n                      if (clippable) {\n                          float dist = 0.0;");for(var t=0,i=this.renderContext.view.sectionPlanesList.length;t<i;t++)e.push("if (sectionPlaneActive"+t+") {\n                              dist += clamp(dot(-sectionPlaneDir"+t+".xyz, worldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);\n                          }");e.push("if (dist > 0.0) { \n                          discard;\n                      }\n                  }")}return e.join("\n")}},{key:"fragFlatShading",get:function(){var e=[];return e.push(""),e.join("\n")}}]),e}();function Yv(){var e=this.renderContext.view,t=this.renderContext.gl;if(u(this,Lv)[Lv]=new kv(t,u(this,Gv)[Gv]()),u(this,Lv)[Lv].errors)this.errors=u(this,Lv)[Lv].errors;else{var i=u(this,Lv)[Lv];u(this,Uv)[Uv]={renderPass:i.getLocation("renderPass"),viewMatrix:i.getLocation("viewMatrix"),projMatrix:i.getLocation("projMatrix"),worldMatrix:i.getLocation("worldMatrix"),sao:i.getLocation("sao"),logDepthBufFC:i.getLocation("logDepthBufFC"),gammaFactor:i.getLocation("gammaFactor"),pointSize:i.getLocation("pointSize"),nearPlaneHeight:i.getLocation("nearPlaneHeight"),pointCloudIntensityRange:i.getLocation("pointCloudIntensityRange"),pickZNear:i.getLocation("pickZNear"),pickZFar:i.getLocation("pickZFar"),pickInvisible:i.getLocation("pickInvisible"),color:i.getLocation("color"),lightAmbient:i.getLocation("lightAmbient"),lights:[],sectionPlanes:[]};for(var r=u(this,Uv)[Uv],n=e.lightsList,s=0,o=n.length;s<o;s++)switch(n[s].type){case"dir":r.lights.push({color:i.getLocation("lightColor"+s),dir:i.getLocation("lightDir"+s)});break;case"point":r.lights.push({color:i.getLocation("lightColor"+s),pos:i.getLocation("lightPos"+s),attenuation:i.getLocation("lightAttenuation"+s)});break;case"spot":r.lights.push({color:i.getLocation("lightColor"+s),pos:i.getLocation("lightPos"+s),dir:i.getLocation("lightDir"+s),attenuation:i.getLocation("lightAttenuation"+s)})}for(var a=0,h=e.sectionPlanesList.length;a<h;a++)r.sectionPlanes.push({active:i.getLocation("sectionPlaneActive"+a),pos:i.getLocation("sectionPlanePos"+a),dir:i.getLocation("sectionPlaneDir"+a)});u(this,Nv)[Nv]={positions:i.getSampler("positions"),indices:i.getSampler("indices"),edgeIndices:i.getSampler("edgeIndices"),eachMeshAttributes:i.getSampler("eachMeshAttributes"),eachMeshMatrices:i.getSampler("eachMeshMatrices"),eachEdgeOffset:i.getSampler("eachMeshOffset"),eachPrimitiveMesh:i.getSampler("eachMeshTriangleMesh"),eachEdgeMesh:i.getSampler("eachEdgeMesh"),baseColorMap:i.getSampler("baseColorMap"),metallicRoughMap:i.getSampler("metallicRoughMap"),emissiveMap:i.getSampler("emissiveMap"),normalMap:i.getSampler("normalMap"),occlusionMap:i.getSampler("occlusionMap")},u(this,Bv)[Bv]=this.getHash()}}function zv(){return{vertex:this.buildVertexShader(),fragment:this.buildFragmentShader()}}function Kv(){return!u(this,Fv)[Fv]||(u(this,Fv)[Fv]=!1,u(this,Bv)[Bv]===this.getHash())}function qv(){var e=this.renderContext.view,t=this.renderContext.gl,i=u(this,Uv)[Uv],r=e.camera.project;u(this,Lv)[Lv].bind(),i.lightAmbient&&t.uniform4fv(i.lightAmbient,e.getAmbientColorAndIntensity());for(var n=0,s=i.lights.length;n<s;n++){var o=i.lights[n],a=e.lightsList[n];o.color&&t.uniform4f(o.color,a.color[0],a.color[1],a.color[2],a.intensity),o.dir&&t.uniform3f(o.dir,a.dir[0],a.dir[1],a.dir[2]),o.pos&&t.uniform3f(o.pos,a.pos[0],a.pos[1],a.pos[2]),o.attenuation&&t.uniform1f(o.attenuation,a.attenuation)}if(i.sao){var h=e.sao;if(h.possible){var l=t.drawingBufferHeight;Iv[0]=t.drawingBufferWidth,Iv[1]=l,Iv[2]=h.blendCutoff,Iv[3]=h.blendFactor,t.uniform4fv(i.sao,Iv)}}if(i.gammaFactor&&t.uniform1f(i.gammaFactor,e.gammaFactor),i.pointSize&&t.uniform1f(i.pointSize,e.pointsMaterial.pointSize),i.nearPlaneHeight&&t.uniform1f(i.nearPlaneHeight,e.camera.projection===xt?1:t.drawingBufferHeight/(2*Math.tan(.5*e.camera.perspective.fov*Math.PI/180))),i.pickZNear&&(t.uniform1f(i.pickZNear,this.renderContext.pickZNear),t.uniform1f(i.pickZFar,this.renderContext.pickZFar)),i.pickInvisible&&t.uniform1i(i.pickInvisible,this.renderContext.pickInvisible?1:0),i.logDepthBufFC){var c=2/(Math.log(r.far+1)/Math.LN2);t.uniform1f(i.logDepthBufFC,c)}}var Zv=/*#__PURE__*/function(e){function t(t){return e.call(this,t)||this}n(t,e);var i=t.prototype;return i.getHash=function(){return this.renderContext.view.getSectionPlanesHash()+"-"+this.renderContext.view.getLightsHash()},i.buildVertexShader=function(){return this.vertHeader+"   \n        \n                uniform int                 renderPass;   \n            \n                uniform highp   mat4        viewMatrix;\n                uniform highp   mat4        projMatrix;\n                uniform highp   mat4        worldMatrix;\n                        \n                uniform mediump usampler2D  eachPrimitiveMesh;\n                uniform lowp    usampler2D  eachMeshAttributes;\n                \n                uniform mediump sampler2D   eachMeshMatrices;\n                uniform highp   sampler2D   eachMeshOffset;\n                uniform mediump usampler2D  positions;\n                uniform highp   usampler2D  indices;\n                \n                uniform  float  logDepthBufFC;\n                 \n                out vec4        worldPosition;\n                flat out uint   meshFlags2r;                       \n                flat out uvec4  meshColor;\n                out float       fragDepth;\n                \n                bool isPerspectiveMatrix(mat4 m) {\n                    return (m[2][3] == - 1.0);\n                }\n                \n                out float isPerspective;\n                    \n                void main(void) {\n                                   \n                    int triangleIndex      = gl_VertexID / 3;\n                    \n                    int hPackedMeshIdIndex = (triangleIndex >> 3) & 1023;\n                    int vPackedMeshIdIndex = (triangleIndex >> 3) >> 10;\n                    \n                    int meshIndex          = int(texelFetch(eachPrimitiveMesh, ivec2(hPackedMeshIdIndex, vPackedMeshIdIndex), 0).r);                   \n                    uvec4 meshFlags        = texelFetch (eachMeshAttributes, ivec2(2, meshIndex), 0);\n\n                    if (int(meshFlags.x) != renderPass) {\n                        gl_Position = vec4(3.0, 3.0, 3.0, 1.0);\n                        return;\n                    } \n                 \n                    uvec4 meshFlags2 = texelFetch (eachMeshAttributes, ivec2(3, meshIndex), 0);\n\n                    ivec4 packedVertexBase = ivec4(texelFetch (eachMeshAttributes, ivec2(4, meshIndex), 0));\n                    ivec4 packedIndexBaseOffset = ivec4(texelFetch (eachMeshAttributes, ivec2(5, meshIndex), 0));\n                    int indexBaseOffset = (packedIndexBaseOffset.r << 24) + (packedIndexBaseOffset.g << 16) + (packedIndexBaseOffset.b << 8) + packedIndexBaseOffset.a;\n\n                    int hIndex = (triangleIndex - indexBaseOffset) & 1023;\n                    int vIndex = (triangleIndex - indexBaseOffset) >> 10;\n\n                    ivec3 vertexIndices = ivec3(texelFetch(indices, ivec2(hIndex, vIndex), 0));\n                    ivec3 uniqueVertexIndexes = vertexIndices + (packedVertexBase.r << 24) + (packedVertexBase.g << 16) + (packedVertexBase.b << 8) + packedVertexBase.a;\n\n                    ivec3 indexPositionH = uniqueVertexIndexes & 1023;\n                    ivec3 indexPositionV = uniqueVertexIndexes >> 10;\n\n                    mat4 positionsDecompressMatrix = mat4 (texelFetch (eachMeshMatrices, ivec2(0, meshIndex), 0), texelFetch (eachMeshMatrices, ivec2(1, meshIndex), 0), texelFetch (eachMeshMatrices, ivec2(2, meshIndex), 0), texelFetch (eachMeshMatrices, ivec2(3, meshIndex), 0));\n                    mat4 meshMatrix = mat4 (texelFetch (eachMeshMatrices, ivec2(4, meshIndex), 0), texelFetch (eachMeshMatrices, ivec2(5, meshIndex), 0), texelFetch (eachMeshMatrices, ivec2(6, meshIndex), 0), texelFetch (eachMeshMatrices, ivec2(7, meshIndex), 0));\n\n                    vec3 _positions[3];\n                   \n                    _positions[0] = vec3(texelFetch(positions, ivec2(indexPositionH.r, indexPositionV.r), 0));\n                    _positions[1] = vec3(texelFetch(positions, ivec2(indexPositionH.g, indexPositionV.g), 0));\n                    _positions[2] = vec3(texelFetch(positions, ivec2(indexPositionH.b, indexPositionV.b), 0));\n  \n                    vec3  position       = _positions[gl_VertexID % 3];\n                   \n                    vec4  _worldPosition = worldMatrix * ((meshMatrix * positionsDecompressMatrix) * vec4(position, 1.0)); \n                    vec4  viewPosition   = viewMatrix * _worldPosition;                   \n                    vec4  clipPosition   = projMatrix * viewPosition;\n\n                    meshFlags2r     = meshFlags2.r;                     \n                    meshColor       = texelFetch (eachMeshAttributes, ivec2(0, meshIndex), 0);                          \n                    fragDepth       = 1.0 + clipPosition.w;\n                    isPerspective   = float (isPerspectiveMatrix(projMatrix));\n                    worldPosition   = _worldPosition;                                               \n                    \n                    gl_Position     = clipPosition;\n                }"},i.buildFragmentShader=function(){return this.fragHeader+"                        \n    \n             flat   in uvec4    meshColor;\n                in float        fragDepth;\n                in float        isPerspective;    \n                flat in uint    meshFlags2r;        \n                uniform float   logDepthBufFC;                        \n    \n                "+this.fragSectionPlaneDefs+"                  \n                "+this.fragLightSourceUniforms+'                                                             \n    \n                out vec4 outColor;        \n    \n                void main(void) {         \n                \n                // src.push("float lambertian = 1.0;");\n                // \n                //  vec3 xTangent = dFdx( vViewPosition.xyz );\n                //  vec3 yTangent = dFdy( vViewPosition.xyz );\n                // \n                //  vec3 viewNormal = normalize( cross( xTangent, yTangent ) );        \n    \n                    '+this.fragSectionPlanesSlice+"                                    \n                    "+this.fragFlatShading+"     \n          \n                    outColor = vec4(meshColor);                   \n                    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( fragDepth ) * logDepthBufFC * 0.5;                        \n                }"},t}(Wv),Qv=navigator.userAgent.match(/(opera|chrome|safari|firefox|msie|mobile)\/?\s*(\.?\d+(\.\d+)*)/i),Jv=Qv&&"safari"===Qv[1].toLowerCase(),$v=/*#__PURE__*/c("viewer"),ef=/*#__PURE__*/c("view"),tf=/*#__PURE__*/c("renderContext"),rf=/*#__PURE__*/c("canvasTransparent"),nf=/*#__PURE__*/c("transparentEnabled"),sf=/*#__PURE__*/c("edgesEnabled"),of=/*#__PURE__*/c("imageDirty"),af=/*#__PURE__*/c("saoEnabled"),hf=/*#__PURE__*/c("pbrEnabled"),lf=/*#__PURE__*/c("backgroundColor"),cf=/*#__PURE__*/c("webglSceneModels"),uf=/*#__PURE__*/c("layerList"),df=/*#__PURE__*/c("layerListDirty"),vf=/*#__PURE__*/c("stateSortDirty"),ff=/*#__PURE__*/c("pickIDs"),pf=/*#__PURE__*/c("saoDepthRenderBuffer"),yf=/*#__PURE__*/c("renderBufferManager"),gf=/*#__PURE__*/c("extensionHandles"),bf=/*#__PURE__*/c("logarithmicDepthBufferEnabled"),wf=/*#__PURE__*/c("alphaDepthMask"),mf=/*#__PURE__*/c("occlusionTester"),Pf=/*#__PURE__*/c("textureTranscoder"),_f=/*#__PURE__*/c("layerRenderers"),Ef=/*#__PURE__*/c("updateLayerList"),Tf=/*#__PURE__*/c("buildLayerList"),xf=/*#__PURE__*/c("draw"),Mf=/*#__PURE__*/c("activateExtensions"),Of=/*#__PURE__*/c("drawSAOBuffers"),jf=/*#__PURE__*/c("drawDepth"),Rf=/*#__PURE__*/c("drawColor"),Sf=/*#__PURE__*/c("drawLayer"),Af=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,Sf,{value:Uf}),Object.defineProperty(this,Rf,{value:Ff}),Object.defineProperty(this,jf,{value:Lf}),Object.defineProperty(this,Of,{value:Bf}),Object.defineProperty(this,Mf,{value:If}),Object.defineProperty(this,xf,{value:Df}),Object.defineProperty(this,Tf,{value:kf}),Object.defineProperty(this,Ef,{value:Cf}),Object.defineProperty(this,$v,{writable:!0,value:void 0}),Object.defineProperty(this,ef,{writable:!0,value:void 0}),Object.defineProperty(this,tf,{writable:!0,value:void 0}),Object.defineProperty(this,rf,{writable:!0,value:void 0}),Object.defineProperty(this,nf,{writable:!0,value:void 0}),Object.defineProperty(this,sf,{writable:!0,value:void 0}),Object.defineProperty(this,of,{writable:!0,value:void 0}),Object.defineProperty(this,af,{writable:!0,value:void 0}),Object.defineProperty(this,hf,{writable:!0,value:void 0}),Object.defineProperty(this,lf,{writable:!0,value:void 0}),Object.defineProperty(this,cf,{writable:!0,value:void 0}),Object.defineProperty(this,uf,{writable:!0,value:void 0}),Object.defineProperty(this,df,{writable:!0,value:void 0}),Object.defineProperty(this,vf,{writable:!0,value:void 0}),Object.defineProperty(this,ff,{writable:!0,value:new Ri({})}),Object.defineProperty(this,pf,{writable:!0,value:void 0}),Object.defineProperty(this,yf,{writable:!0,value:void 0}),Object.defineProperty(this,gf,{writable:!0,value:void 0}),Object.defineProperty(this,bf,{writable:!0,value:void 0}),Object.defineProperty(this,wf,{writable:!0,value:void 0}),Object.defineProperty(this,mf,{writable:!0,value:void 0}),Object.defineProperty(this,Pf,{writable:!0,value:void 0}),Object.defineProperty(this,_f,{writable:!0,value:void 0}),u(this,Pf)[Pf]=e.textureTranscoder||new Up({}),u(this,rf)[rf]=!1,u(this,wf)[wf]=!1,u(this,gf)[gf]={},u(this,ff)[ff]=new Ri({}),u(this,uf)[uf]=[],u(this,df)[df]=!0,u(this,vf)[vf]=!0,u(this,of)[of]=!0,u(this,nf)[nf]=!0,u(this,sf)[sf]=!0,u(this,af)[af]=!0,u(this,hf)[hf]=!0,u(this,lf)[lf]=j(),u(this,mf)[mf]=null,u(this,bf)[bf]=!1,u(this,cf)[cf]={}}var t=e.prototype;return t.init=function(e){u(this,$v)[$v]=e,u(this,Pf)[Pf].init(u(this,$v)[$v].capabilities)},t.getCapabilities=function(e){e.maxViews=1;var t,i=document.createElement("canvas");try{t=i.getContext("webgl2")}catch(e){console.error("Failed to get a WebGL context")}t&&(e.astcSupported=!!il(t,"WEBGL_compressed_texture_astc"),e.etc1Supported=!0,e.etc2Supported=!!il(t,"WEBGL_compressed_texture_etc"),e.dxtSupported=!!il(t,"WEBGL_compressed_texture_s3tc"),e.bptcSupported=!!il(t,"EXT_texture_compression_bptc"),e.pvrtcSupported=!(!il(t,"WEBGL_compressed_texture_pvrtc")&&!il(t,"WEBKIT_WEBGL_compressed_texture_pvrtc")))},t.registerView=function(e){if(u(this,tf)[tf])throw"Only one View allowed with WebGLRenderer (see WebViewerCapabilities.maxViews)";u(this,ef)[ef]=e;for(var t=["webgl2"],i=e.canvas.canvas,r={},n=null,s=0;!n&&s<t.length;s++)try{n=i.getContext(t[s],r)}catch(e){}return n?(n&&n.hint(n.FRAGMENT_SHADER_DERIVATIVE_HINT,n.NICEST),u(this,tf)[tf]=new tl(u(this,$v)[$v],u(this,ef)[ef],n),u(this,_f)[_f]={colorTriangles:new Zv(u(this,tf)[tf])},0):(console.error("Failed to get a WebGL2 context"),0)},t.deregisterView=function(e){},t.createModel=function(e){var t=this;if(!u(this,tf)[tf])throw"Must register a View before you create a model";var i=new xv(ki({view:u(this,ef)[ef],scene:u(this,$v)[$v].scene,textureTranscoder:u(this,Pf)[Pf],webglRenderer:this,renderContext:u(this,tf)[tf],viewLayerId:e.viewLayerId},e));return i.onBuilt.one(function(e){u(t,cf)[cf][e.id]=e,u(t,df)[df]=!0}),i.onDestroyed.one(function(e){delete u(t,cf)[cf][e.id],u(t,df)[df]=!0}),i},t.registerPickable=function(e){return u(this,ff)[ff].addItem(e)},t.deregisterPickable=function(e){u(this,ff)[ff].removeItem(e)},t.setImageDirty=function(e){u(this,of)[of]=!0},t.setBackgroundColor=function(e,t){u(this,lf)[lf].set(t),u(this,of)[of]=!0},t.setEdgesEnabled=function(e,t){u(this,sf)[sf]=t,u(this,of)[of]=!0},t.setPBREnabled=function(e,t){u(this,hf)[hf]=t,u(this,of)[of]=!0},t.getSAOSupported=function(){return Jv&&Jh.SUPPORTED_EXTENSIONS.OES_standard_derivatives},t.setSAOEnabled=function(e,t){u(this,af)[af]=t,u(this,of)[of]=!0},t.setTransparentEnabled=function(e,t){u(this,nf)[nf]=t,u(this,of)[of]=!0},t.clear=function(e){var t=u(this,tf)[tf].gl;t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),u(this,rf)[rf]?t.clearColor(1,1,1,1):t.clearColor(u(this,lf)[lf][0],u(this,lf)[lf][1],u(this,lf)[lf][2],1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},t.needsRebuild=function(e){for(var t in u(this,_f)[_f])u(this,_f)[_f][t].needRebuild()},t.needsRender=function(e){return u(this,of)[of]||u(this,df)[df]||u(this,vf)[vf]},t.render=function(e,t){(t=t||{}).force&&(u(this,of)[of]=!0),u(this,Ef)[Ef](),u(this,of)[of]&&(u(this,xf)[xf]({clear:!0}),u(this,of)[of]=!1)},t.pickSceneObject=function(e,t){return null},e}();function Cf(){u(this,df)[df]&&(u(this,Tf)[Tf](),u(this,df)[df]=!1,u(this,vf)[vf]=!0),u(this,vf)[vf]&&(u(this,vf)[vf]=!1,u(this,of)[of]=!0)}function kf(){var e=0;for(var t in u(this,cf)[cf])for(var i=u(this,cf)[cf][t],r=0,n=i.layerList.length;r<n;r++)u(this,uf)[uf][e++]=i.layerList[r];u(this,uf)[uf].length=e}function Df(e){u(this,Mf)[Mf](),u(this,af)[af]&&u(this,ef)[ef].sao.possible&&u(this,Of)[Of](e),u(this,Rf)[Rf](e)}function If(){Jh.SUPPORTED_EXTENSIONS.OES_element_index_uint&&(u(this,gf)[gf].OES_element_index_uint=u(this,tf)[tf].gl.getExtension("OES_element_index_uint")),u(this,bf)[bf]&&Jh.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(u(this,gf)[gf].EXT_frag_depth=u(this,tf)[tf].gl.getExtension("EXT_frag_depth")),Jh.SUPPORTED_EXTENSIONS.WEBGL_depth_texture&&(u(this,gf)[gf].WEBGL_depth_texture=u(this,tf)[tf].gl.getExtension("WEBGL_depth_texture"))}function Bf(e){}function Lf(e){u(this,tf)[tf].reset();var t=u(this,tf)[tf].gl;t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),t.clearColor(0,0,0,0),t.enable(t.DEPTH_TEST),t.frontFace(t.CCW),t.enable(t.CULL_FACE),t.depthMask(!0),!1!==e.clear&&t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}function Ff(e){var t=u(this,ef)[ef],i=u(this,tf)[tf],r=i.gl,n=[],s=[],o=[],a=[],h=[],l=[],c=[],d=[],v=[],f=[],p=[],y=[],g=[],b=[],w=[],m=[];i.reset(),i.withSAO=!1,i.pbrEnabled=u(this,hf)[hf]&&!!t.qualityRender,r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),u(this,rf)[rf]?r.clearColor(0,0,0,0):r.clearColor(u(this,lf)[lf][0],u(this,lf)[lf][1],u(this,lf)[lf][2],1),r.enable(r.DEPTH_TEST),r.frontFace(r.CCW),r.enable(r.CULL_FACE),r.depthMask(!0),r.lineWidth(1),i.lineWidth=1;var P=t.sao.possible;if(u(this,af)[af]&&P){var _=u(this,yf)[yf].getRenderBuffer("saoOcclusion",{depthTexture:!1,size:[r.drawingBufferWidth,r.drawingBufferHeight]});i.occlusionTexture=_?_.getTexture():null}else i.occlusionTexture=null;!1!==e.clear&&r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);for(var E=0,T=0,x=0,M=0,O=0,j=0,R=0,S=0,A=0,C=0,k=0,D=0,I=0,B=0,L=0,F=0,U=0,N=u(this,uf)[uf].length;U<N;U++){var X=u(this,uf)[uf][U],G=X.meshCounts;G.numCulled!==G.numMeshes&&0!==G.numVisible&&(G.numTransparent<G.numMeshes&&(u(this,af)[af]&&P&&X.sceneModel.qualityRender?n[E++]=X:u(this,Sf)[Sf](X,1,X.sceneModel.qualityRender)),u(this,nf)[nf]&&G.numTransparent&&(o[x++]=X),G.numXRayed>0&&t.xrayMaterial.fill&&(t.xrayMaterial.fillAlpha<1?c[R++]=X:h[O++]=X),G.numHighlighted>0&&t.highlightMaterial.fill&&(t.highlightMaterial.fillAlpha<1?p[k++]=X:v[A++]=X),G.numSelected>0&&t.selectedMaterial.fill&&(t.selectedMaterial.fillAlpha<1?w[L++]=X:g[I++]=X),u(this,sf)[sf]&&u(this,ef)[ef].edgeMaterial.edges&&G.numEdges>0&&(G.numTransparent<G.numMeshes&&(s[T++]=X),G.numTransparent>0&&(a[M++]=X),t.selectedMaterial.edgeAlpha<1?m[F++]=X:b[B++]=X,t.xrayMaterial.edgeAlpha<1?d[S++]=X:l[j++]=X,t.highlightMaterial.edgeAlpha<1?y[D++]=X:f[C++]=X))}E>0&&(i.withSAO=!0);for(var V=0;V<T;V++)u(this,Sf)[Sf](s[V],6);for(var H=0;H<O;H++)u(this,Sf)[Sf](h[H],5);for(var W=0;W<j;W++)u(this,Sf)[Sf](l[W],10);if(R>0||S>0||x>0||M>0){r.enable(r.CULL_FACE),r.enable(r.BLEND),u(this,rf)[rf]?(r.blendEquation(r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)):(r.blendEquation(r.FUNC_ADD),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA)),i.backfaces=!1,u(this,wf)[wf]||r.depthMask(!1);for(var Y=0;Y<S;Y++)u(this,Sf)[Sf](d[Y],10);for(var z=0;z<R;z++)u(this,Sf)[Sf](c[z],5);(x>0||M>0)&&r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);for(var K=0;K<M;K++)u(this,Sf)[Sf](a[K],7);for(var q=0;q<x;q++)u(this,Sf)[Sf](o[q],2);r.disable(r.BLEND),u(this,wf)[wf]||r.depthMask(!0)}if(A>0||C>0){i.lastProgramId=-1,r.clear(r.DEPTH_BUFFER_BIT);for(var Z=0;Z<C;Z++)u(this,Sf)[Sf](f[Z],8);for(var Q=0;Q<A;Q++)u(this,Sf)[Sf](v[Q],3)}if(k>0||D>0||A>0){i.lastProgramId=-1,r.clear(r.DEPTH_BUFFER_BIT),r.enable(r.CULL_FACE),r.enable(r.BLEND),u(this,rf)[rf]?(r.blendEquation(r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)):r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);for(var J=0;J<D;J++)u(this,Sf)[Sf](y[J],8);for(var $=0;$<k;$++)u(this,Sf)[Sf](p[$],3);r.disable(r.BLEND)}if(I>0||B>0){i.lastProgramId=-1,r.clear(r.DEPTH_BUFFER_BIT);for(var ee=0;ee<B;ee++)u(this,Sf)[Sf](b[ee],9);for(var te=0;te<I;te++)u(this,Sf)[Sf](g[te],4)}if(L>0||F>0){i.lastProgramId=-1,r.clear(r.DEPTH_BUFFER_BIT),r.enable(r.CULL_FACE),r.enable(r.BLEND),u(this,rf)[rf]?(r.blendEquation(r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)):r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);for(var ie=0;ie<F;ie++)u(this,Sf)[Sf](m[ie],9);for(var re=0;re<L;re++)u(this,Sf)[Sf](w[re],4);r.disable(r.BLEND)}for(var ne=Jh.MAX_TEXTURE_UNITS,se=0;se<ne;se++)r.activeTexture(r.TEXTURE0+se);r.bindTexture(r.TEXTURE_CUBE_MAP,null),r.bindTexture(r.TEXTURE_2D,null);for(var oe=Jh.MAX_VERTEX_ATTRIBS,ae=0;ae<oe;ae++)r.disableVertexAttribArray(ae)}function Uf(e,t,i){switch(void 0===i&&(i=!0),e.renderState.primitive){case wt:case Pt:case mt:switch(t){case 1:if(e.meshCounts.numTransparent===e.meshCounts.numMeshes||e.meshCounts.numXRayed===e.meshCounts.numMeshes)return;i||u(this,_f)[_f].colorTriangles.draw(e);break;case 2:if(0===e.meshCounts.numTransparent)return;i||u(this,_f)[_f].colorTriangles.draw(e)}}}var Nf=/*#__PURE__*/c("prefixMessageWithID"),Xf=/*#__PURE__*/c("registerView"),Gf=/*#__PURE__*/c("deregisterView"),Vf=/*#__PURE__*/function(){function t(t){void 0===t&&(t={}),Object.defineProperty(this,Gf,{value:Yf}),Object.defineProperty(this,Xf,{value:Wf}),Object.defineProperty(this,Nf,{value:Hf}),this.id=void 0,this.destroyed=void 0,this.capabilities=void 0,this.onTick=void 0,this.onViewCreated=void 0,this.onViewDestroyed=void 0,this.localeService=void 0,this.data=void 0,this.scene=void 0,this.views=void 0,this.viewList=void 0,this.numViews=void 0,this.pluginList=void 0,this.startTime=(new Date).getTime(),this.renderer=void 0,this.onTick=new v(new e.EventDispatcher),this.onViewCreated=new v(new e.EventDispatcher),this.onViewDestroyed=new v(new e.EventDispatcher),this.id=t.id||Ii(),this.localeService=t.localeService||new g,this.data=new kr(this),this.scene=new Pr(this,{}),this.viewList=[],this.numViews=0,this.pluginList=[],this.views={},this.destroyed=!1,this.capabilities={maxViews:0,astcSupported:!1,etc1Supported:!1,etc2Supported:!1,dxtSupported:!1,bptcSupported:!1,pvrtcSupported:!1},this.renderer=t.renderer||new Af({}),this.renderer.getCapabilities(this.capabilities),this.renderer.init(this),or.registerViewer(this)}var i=t.prototype;return i.createView=function(e){var t=this;if(this.viewList.length>=this.capabilities.maxViews)return this.error("Attempted to create too many Views with View.createView() - maximum of "+this.capabilities.maxViews+" is allowed"),null;var i=e.id||Ii();if(this.views[i]&&(this.error('View with ID "'+i+'" already exists - will randomly-generate ID'),i=Ii()),!((e.canvasElement||document.getElementById(e.canvasId))instanceof HTMLCanvasElement))throw"Mandatory View config expected: valid canvasId or canvasElement";var r=new Yh(ki({id:i,viewer:this},e));return u(this,Xf)[Xf](r),r.viewIndex=this.renderer.registerView(r),r.onDestroyed.one(function(){u(t,Gf)[Gf](r),t.renderer.deregisterView(r.viewIndex),t.onViewDestroyed.dispatch(t,r)}),this.onViewCreated.dispatch(this,r),this.log("View created: "+r.id),r},i.registerPlugin=function(e){this.pluginList.push(e)},i.deregisterPlugin=function(e){for(var t=0,i=this.pluginList.length;t<i;t++){var r=this.pluginList[t];if(r===e)return r.clear(),void this.pluginList.splice(t,1)}},i.sendToPlugins=function(e,t){for(var i=0,r=this.pluginList.length;i<r;i++){var n=this.pluginList[i];n.send&&n.send(e,t)}},i.redraw=function(){for(var e in this.views)this.views[e].redraw()},i.log=function(e){e="[LOG] "+u(this,Nf)[Nf](e),window.console.log(e)},i.warn=function(e){e="[WARN] "+u(this,Nf)[Nf](e),window.console.warn(e)},i.error=function(e){e="[ERROR] "+u(this,Nf)[Nf](e),window.console.error(e)},i.destroy=function(){if(!this.destroyed){or.deregisterViewer(this);for(var e=this.pluginList.slice(),t=0,i=e.length;t<i;t++)e[t].destroy();for(var r in this.views)this.views[r].destroy();this.scene.destroy(),this.onTick.clear(),this.onViewCreated.clear(),this.onViewDestroyed.clear()}},i.render=function(e){for(var t=0;t<this.viewList.length;t++)this.renderer.render(t,{force:!0})},t}();function Hf(e){return" ["+this.constructor.name+' "'+Di(this.id)+'"]: '+e}function Wf(e){if(!this.views[e.id]){this.views[e.id]=e;for(var t=0;;t++)if(!this.viewList[t])return this.viewList[t]=e,this.numViews++,void(e.viewIndex=t)}}function Yf(e){this.views[e.id]&&(delete this.views[e.id],delete this.viewList[e.viewIndex],this.numViews--)}var zf=/*#__PURE__*/c("state"),Kf=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(o(r),zf,{writable:!0,value:void 0}),r.view=t,u(o(r),zf)[zf]={type:"ambient",color:new Float32Array(i.color||[.7,.7,.7]),intensity:null!=i.intensity?i.intensity:1},r.view.registerLight(o(r)),r}return n(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.view.deregisterLight(this)},r(t,[{key:"color",get:function(){return u(this,zf)[zf].color},set:function(e){u(this,zf)[zf].color.set(e),this.view.redraw()}},{key:"intensity",get:function(){return u(this,zf)[zf].intensity},set:function(e){u(this,zf)[zf].intensity=void 0!==e?e:1,this.view.redraw()}}]),t}(ur),qf=/*#__PURE__*/c("state"),Zf=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(o(r),qf,{writable:!0,value:void 0}),r.view=t,u(o(r),qf)[qf]={type:"dir",dir:new Float32Array(i.dir||[1,1,1]),color:new Float32Array(i.color||[.7,.7,.8]),intensity:null!=i.intensity?i.intensity:1,space:i.space||"view"},r.view.registerLight(o(r)),r}return n(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.view.deregisterLight(this),this.view.redraw()},r(t,[{key:"dir",get:function(){return u(this,qf)[qf].dir},set:function(e){u(this,qf)[qf].dir.set(e),this.view.redraw()}},{key:"color",get:function(){return u(this,qf)[qf].color},set:function(e){u(this,qf)[qf].color.set(e),this.view.redraw()}},{key:"intensity",get:function(){return u(this,qf)[qf].intensity},set:function(e){u(this,qf)[qf].intensity=e,this.view.redraw()}}]),t}(ur),Qf=/*#__PURE__*/c("state"),Jf=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(o(r),Qf,{writable:!0,value:void 0}),r.view=t,u(o(r),Qf)[Qf]={type:"point",pos:new Float64Array(i.pos||[1,1,1]),color:new Float32Array(i.color||[.7,.7,.8]),intensity:1,attenuation:new Float32Array([i.constantAttenuation,i.linearAttenuation,i.quadraticAttenuation]),space:i.space||"view"},r.view.registerLight(o(r)),r}return n(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.view.deregisterLight(this),this.view.redraw()},r(t,[{key:"pos",get:function(){return u(this,Qf)[Qf].pos},set:function(e){u(this,Qf)[Qf].pos.set(e||[1,1,1]),this.view.redraw()}},{key:"color",get:function(){return u(this,Qf)[Qf].color},set:function(e){u(this,Qf)[Qf].color.set(e||[.7,.7,.8]),this.view.redraw()}},{key:"intensity",get:function(){return u(this,Qf)[Qf].intensity},set:function(e){e!==u(this,Qf)[Qf].intensity&&(u(this,Qf)[Qf].intensity=e,this.view.redraw())}},{key:"constantAttenuation",get:function(){return u(this,Qf)[Qf].attenuation[0]},set:function(e){u(this,Qf)[Qf].attenuation[0]=e,this.view.redraw()}},{key:"linearAttenuation",get:function(){return u(this,Qf)[Qf].attenuation[1]},set:function(e){u(this,Qf)[Qf].attenuation[1]=e,this.view.redraw()}},{key:"quadraticAttenuation",get:function(){return u(this,Qf)[Qf].attenuation[2]},set:function(e){u(this,Qf)[Qf].attenuation[2]=e,this.view.redraw()}}]),t}(ur),$f=/*#__PURE__*/function(){function e(){this.projection=void 0,this.up=void 0,this.look=void 0,this.eye=void 0,this.eye=new Float64Array(3),this.look=new Float64Array(3),this.up=new Float64Array(3),this.projection={}}var t=e.prototype;return t.saveCamera=function(e){var t=e.camera,i=t.project;this.eye.set(t.eye),this.look.set(t.look),this.up.set(t.up),i instanceof Ur&&(this.projection={projection:Tt,fov:i.fov,fovAxis:i.fovAxis,near:i.near,far:i.far}),i instanceof Hr&&(this.projection={projection:xt,scale:i.scale,near:i.near,far:i.far}),i instanceof Kr&&(this.projection={projection:"frustum",left:i.left,right:i.right,top:i.top,bottom:i.bottom,near:i.near,far:i.far}),this.projection={projection:"custom",matrix:i.projMatrix.slice()}},t.restoreCamera=function(e,t){var i=e.camera,r=this.projection;function n(){switch(r.type){case Tt:i.perspective.fov=r.fov,i.perspective.fovAxis=r.fovAxis,i.perspective.near=r.near,i.perspective.far=r.far;break;case xt:i.ortho.scale=r.scale,i.ortho.near=r.near,i.ortho.far=r.far;break;case"frustum":i.frustum.left=r.left,i.frustum.right=r.right,i.frustum.top=r.top,i.frustum.bottom=r.bottom,i.frustum.near=r.near,i.frustum.far=r.far;break;case"custom":i.customProjection.projMatrix=r.matrix}}t?e.cameraFlight.flyTo({eye:this.eye,look:this.look,up:this.up,orthoScale:r.scale,projection:r.projection},function(){n(),t()}):(i.eye=this.eye,i.look=this.look,i.up=this.up,n(),i.projection=r.projection)},e}(),ep=new Float32Array(3),tp=/*#__PURE__*/c("viewObjectsVisible"),ip=/*#__PURE__*/c("viewObjectsEdges"),rp=/*#__PURE__*/c("viewObjectsXRayed"),np=/*#__PURE__*/c("viewObjectsHighlighted"),sp=/*#__PURE__*/c("viewObjectsSelected"),op=/*#__PURE__*/c("viewObjectsClippable"),ap=/*#__PURE__*/c("viewObjectsPickable"),hp=/*#__PURE__*/c("viewObjectsColorize"),lp=/*#__PURE__*/c("viewObjectsOpacity"),cp=/*#__PURE__*/c("numViewObjects"),up=/*#__PURE__*/c("mask"),dp=/*#__PURE__*/function(){function e(){Object.defineProperty(this,tp,{writable:!0,value:void 0}),Object.defineProperty(this,ip,{writable:!0,value:void 0}),Object.defineProperty(this,rp,{writable:!0,value:void 0}),Object.defineProperty(this,np,{writable:!0,value:void 0}),Object.defineProperty(this,sp,{writable:!0,value:void 0}),Object.defineProperty(this,op,{writable:!0,value:void 0}),Object.defineProperty(this,ap,{writable:!0,value:void 0}),Object.defineProperty(this,hp,{writable:!0,value:void 0}),Object.defineProperty(this,lp,{writable:!0,value:void 0}),Object.defineProperty(this,cp,{writable:!0,value:void 0}),Object.defineProperty(this,up,{writable:!0,value:void 0}),u(this,tp)[tp]=[],u(this,ip)[ip]=[],u(this,rp)[rp]=[],u(this,np)[np]=[],u(this,sp)[sp]=[],u(this,op)[op]=[],u(this,ap)[ap]=[],u(this,hp)[hp]=[],u(this,lp)[lp]=[],u(this,cp)[cp]=0}var t=e.prototype;return t.saveObjects=function(e,t,i){if(t.rootDataObject){var r=[];u(this,cp)[cp]=0,u(this,up)[up]=i?ki(i,{}):null;for(var n=e.objects,s=!i||i.visible,o=!i||i.edges,a=!i||i.xrayed,h=!i||i.highlighted,l=!i||i.selected,c=!i||i.clippable,d=!i||i.pickable,v=!i||i.colorize,f=!i||i.opacity,p=0,y=r.length;p<y;p++){var g=n[r[p]];if(g){if(s&&(u(this,tp)[tp][p]=g.visible),o&&(u(this,ip)[ip][p]=g.edges),a&&(u(this,rp)[rp][p]=g.xrayed),h&&(u(this,np)[np][p]=g.highlighted),l&&(u(this,sp)[sp][p]=g.selected),c&&(u(this,op)[op][p]=g.clippable),d&&(u(this,ap)[ap][p]=g.pickable),v){var b=g.colorize;u(this,hp)[hp][3*p+0]=b[0],u(this,hp)[hp][3*p+1]=b[1],u(this,hp)[hp][3*p+2]=b[2]}f&&(u(this,lp)[lp][p]=g.opacity),u(this,cp)[cp]++}}}},t.restoreViewObjects=function(e,t){if(t.rootDataObject)for(var i=[],r=u(this,up)[up],n=!r||r.visible,s=!r||r.edges,o=!r||r.xrayed,a=!r||r.highlighted,h=!r||r.selected,l=!r||r.clippable,c=!r||r.pickable,d=!r||r.colorize,v=!r||r.opacity,f=e.objects,p=0,y=i.length;p<y;p++){var g=f[i[p]];g&&(n&&(g.visible=u(this,tp)[tp][p]),s&&(g.edges=u(this,ip)[ip][p]),o&&(g.xrayed=u(this,rp)[rp][p]),a&&(g.highlighted=u(this,np)[np][p]),h&&(g.selected=u(this,sp)[sp][p]),l&&(g.clippable=u(this,op)[op][p]),c&&(g.pickable=u(this,ap)[ap][p]),d&&(ep[0]=u(this,hp)[hp][3*p+0],ep[1]=u(this,hp)[hp][3*p+1],ep[2]=u(this,hp)[hp][3*p+2],g.colorize=ep),v&&(g.opacity=u(this,lp)[lp][p]))}},e}(),vp=new Float32Array(3),fp=/*#__PURE__*/c("viewObjectsVisible"),pp=/*#__PURE__*/c("viewObjectsEdges"),yp=/*#__PURE__*/c("viewObjectsXrayed"),gp=/*#__PURE__*/c("viewObjectsHighlighted"),bp=/*#__PURE__*/c("viewObjectsSelected"),wp=/*#__PURE__*/c("viewObjectsClippable"),mp=/*#__PURE__*/c("viewObjectsPickable"),Pp=/*#__PURE__*/c("viewObjectsColorize"),_p=/*#__PURE__*/c("viewObjectsHasColorize"),Ep=/*#__PURE__*/c("viewObjectsOpacity"),Tp=/*#__PURE__*/c("mask"),xp=/*#__PURE__*/function(){function e(){Object.defineProperty(this,fp,{writable:!0,value:void 0}),Object.defineProperty(this,pp,{writable:!0,value:void 0}),Object.defineProperty(this,yp,{writable:!0,value:void 0}),Object.defineProperty(this,gp,{writable:!0,value:void 0}),Object.defineProperty(this,bp,{writable:!0,value:void 0}),Object.defineProperty(this,wp,{writable:!0,value:void 0}),Object.defineProperty(this,mp,{writable:!0,value:void 0}),Object.defineProperty(this,Pp,{writable:!0,value:void 0}),Object.defineProperty(this,_p,{writable:!0,value:void 0}),Object.defineProperty(this,Ep,{writable:!0,value:void 0}),this.numObjects=void 0,Object.defineProperty(this,Tp,{writable:!0,value:void 0}),u(this,fp)[fp]=[],u(this,pp)[pp]=[],u(this,yp)[yp]=[],u(this,gp)[gp]=[],u(this,bp)[bp]=[],u(this,wp)[wp]=[],u(this,mp)[mp]=[],u(this,Pp)[Pp]=[],u(this,_p)[_p]=[],u(this,Ep)[Ep]=[],this.numObjects=0}var t=e.prototype;return t.saveObjects=function(e,t){this.numObjects=0,u(this,Tp)[Tp]=t?ki(t,{}):null;var i=e.objects,r=!t||t.visible,n=!t||t.edges,s=!t||t.xrayed,o=!t||t.highlighted,a=!t||t.selected,h=!t||t.clippable,l=!t||t.pickable,c=!t||t.colorize,d=!t||t.opacity;for(var v in i)if(i.hasOwnProperty(v)){var f=i[v],p=this.numObjects;if(r&&(u(this,fp)[fp][p]=f.visible),n&&(u(this,pp)[pp][p]=f.edges),s&&(u(this,yp)[yp][p]=f.xrayed),o&&(u(this,gp)[gp][p]=f.highlighted),a&&(u(this,bp)[bp][p]=f.selected),h&&(u(this,wp)[wp][p]=f.clippable),l&&(u(this,mp)[mp][p]=f.pickable),c){var y=f.colorize;y?(u(this,Pp)[Pp][3*p+0]=y[0],u(this,Pp)[Pp][3*p+1]=y[1],u(this,Pp)[Pp][3*p+2]=y[2],u(this,_p)[_p][p]=!0):u(this,_p)[_p][p]=!1}d&&(u(this,Ep)[Ep][p]=f.opacity),this.numObjects++}},t.restoreViewObjects=function(e){var t=u(this,Tp)[Tp],i=!t||t.visible,r=!t||t.edges,n=!t||t.xrayed,s=!t||t.highlighted,o=!t||t.selected,a=!t||t.clippable,h=!t||t.pickable,l=!t||t.colorize,c=!t||t.opacity,d=0,v=e.objects;for(var f in v)if(v.hasOwnProperty(f)){var p=v[f];i&&(p.visible=u(this,fp)[fp][d]),r&&(p.edges=u(this,pp)[pp][d]),n&&(p.xrayed=u(this,yp)[yp][d]),s&&(p.highlighted=u(this,gp)[gp][d]),o&&(p.selected=u(this,bp)[bp][d]),a&&(p.clippable=u(this,wp)[wp][d]),h&&(p.pickable=u(this,mp)[mp][d]),l&&(u(this,_p)[_p][d]?(vp[0]=u(this,Pp)[Pp][3*d+0],vp[1]=u(this,Pp)[Pp][3*d+1],vp[2]=u(this,Pp)[Pp][3*d+2],p.colorize=vp):p.colorize=null),c&&(p.opacity=u(this,Ep)[Ep][d]),d++}},e}(),Mp=0,Op={ETC1S:0,UASTC_4x4:1},jp={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},Rp={RGBAFormat:dt,RGBA_ASTC_4x4_Format:37808,RGBA_BPTC_Format:36492,RGBA_ETC2_EAC_Format:37496,RGBA_PVRTC_4BPPV1_Format:35842,RGBA_S3TC_DXT5_Format:ft,RGB_ETC1_Format:36196,RGB_ETC2_Format:37492,RGB_PVRTC_4BPPV1_Format:35840,RGB_S3TC_DXT1_Format:vt},Sp=/*#__PURE__*/c("transcoderPath"),Ap=/*#__PURE__*/c("transcoderBinary"),Cp=/*#__PURE__*/c("transcoderPending"),kp=/*#__PURE__*/c("workerPool"),Dp=/*#__PURE__*/c("workerSourceURL"),Ip=/*#__PURE__*/c("workerConfig"),Bp=/*#__PURE__*/c("supportedFileTypes"),Lp=/*#__PURE__*/c("withCredentials"),Fp=/*#__PURE__*/c("initTranscoder"),Up=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,Fp,{value:Np}),Object.defineProperty(this,Sp,{writable:!0,value:void 0}),Object.defineProperty(this,Ap,{writable:!0,value:void 0}),Object.defineProperty(this,Cp,{writable:!0,value:void 0}),Object.defineProperty(this,kp,{writable:!0,value:void 0}),Object.defineProperty(this,Dp,{writable:!0,value:void 0}),Object.defineProperty(this,Ip,{writable:!0,value:void 0}),Object.defineProperty(this,Bp,{writable:!0,value:void 0}),Object.defineProperty(this,Lp,{writable:!0,value:void 0}),u(this,Sp)[Sp]=e.transcoderPath||"https://cdn.jsdelivr.net/npm/@xeokit/xeokit-viewer/dist/basis/",u(this,Ap)[Ap]=null,u(this,Cp)[Cp]=null,u(this,kp)[kp]=new Ui,u(this,Dp)[Dp]="",e.workerLimit&&u(this,kp)[kp].setWorkerLimit(e.workerLimit),u(this,Ip)[Ip]=null,u(this,Lp)[Lp]=!1,u(this,Bp)[Bp]=["xkt2"]}var t=e.prototype;return t.init=function(e){u(this,Ip)[Ip]={astcSupported:e.astcSupported,etc1Supported:e.etc1Supported,etc2Supported:e.etc2Supported,dxtSupported:e.dxtSupported,bptcSupported:e.bptcSupported,pvrtcSupported:e.pvrtcSupported}},t.transcode=function(e,t){var i=this;return void 0===t&&(t={}),new Promise(function(r,n){var s=t;u(i,Fp)[Fp]().then(function(){return u(i,kp)[kp].postMessage({type:"transcode",buffers:e,taskConfig:s},e)}).then(function(e){var t=e.data,i=t.mipmaps,s=t.format,o=t.dfdTransferFn,a=t.dfdFlags;if("error"===t.type)return n(t.error);r({mipmaps:i,props:{format:s,minFilter:1===i.length?ct:ut,magFilter:1===i.length?ct:ut,encoding:2===o?yt:pt,premultiplyAlpha:!!(1&a)}})})})},t.destroy=function(){URL.revokeObjectURL(u(this,Dp)[Dp]),u(this,kp)[kp].destroy(),Mp--},e}();function Np(){var e=this;if(!u(this,Cp)[Cp]){var t=new Xi;t.setPath(u(this,Sp)[Sp]),t.setWithCredentials(u(this,Lp)[Lp]);var i=t.loadAsync("basis_transcoder.js"),r=new Xi;r.setPath(u(this,Sp)[Sp]),r.setResponseType("arraybuffer"),r.setWithCredentials(u(this,Lp)[Lp]);var n=r.loadAsync("basis_transcoder.wasm");u(this,Cp)[Cp]=Promise.all([i,n]).then(function(t){var i=t[0],r=t[1],n=Xp.toString(),s=["/* constants */","let _EngineFormat = "+JSON.stringify(Rp),"let _TranscoderFormat = "+JSON.stringify(jp),"let _BasisFormat = "+JSON.stringify(Op),"/* basis_transcoder.js */",i,"/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");u(e,Dp)[Dp]=URL.createObjectURL(new Blob([s])),u(e,Ap)[Ap]=r,u(e,kp)[kp].setWorkerCreator(function(){var t=new Worker(u(e,Dp)[Dp]),i=u(e,Ap)[Ap].slice(0);return t.postMessage({type:"init",config:u(e,Ip)[Ip],transcoderBinary:i},[i]),t})}),Mp>0&&console.warn("KTX2TextureTranscoder: Multiple active KTX2TextureTranscoder may cause performance issues. Use a single KTX2TextureTranscoder instance, or call .dispose() on old instances."),Mp++}return u(this,Cp)[Cp]}var Xp=function(){var e,t,i,r=_EngineFormat,n=_TranscoderFormat,s=_BasisFormat;self.addEventListener("message",function(o){var c,u=o.data;switch(u.type){case"init":e=u.config,c=u.transcoderBinary,t=new Promise(function(e){i={wasmBinary:c,onRuntimeInitialized:e},BASIS(i)}).then(function(){i.initializeBasis(),void 0===i.KTX2File&&console.warn("KTX2TextureTranscoder: Please update Basis Universal transcoder.")});break;case"transcode":t.then(function(){try{for(var t=function(t){var o=new i.KTX2File(new Uint8Array(t));function c(){o.close(),o.delete()}if(!o.isValid())throw c(),new Error("KTX2TextureTranscoder: Invalid or unsupported .ktx2 file");var u=o.isUASTC()?s.UASTC_4x4:s.ETC1S,d=o.getWidth(),v=o.getHeight(),f=o.getLevels(),p=o.getHasAlpha(),y=o.getDFDTransferFunc(),g=o.getDFDFlags(),b=function(t,i,o,c){for(var u=t===s.ETC1S?a:h,d=0;d<u.length;d++){var v=u[d];if(e[v.if]&&v.basisFormat.includes(t)&&!(c&&v.transcoderFormat.length<2)&&(!v.needsPowerOfTwo||l(i)&&l(o)))return{transcoderFormat:v.transcoderFormat[c?1:0],engineFormat:v.engineFormat[c?1:0]}}return console.warn("KTX2TextureTranscoder: No suitable compressed texture format found. Decoding to RGBA32."),{transcoderFormat:n.RGBA32,engineFormat:r.RGBAFormat}}(u,d,v,p),w=b.transcoderFormat,m=b.engineFormat;if(!d||!v||!f)throw c(),new Error("KTX2TextureTranscoder: Invalid texture");if(!o.startTranscoding())throw c(),new Error("KTX2TextureTranscoder: .startTranscoding failed");for(var P=[],_=0;_<f;_++){var E=o.getImageLevelInfo(_,0,0),T=E.origWidth,x=E.origHeight,M=new Uint8Array(o.getImageTranscodedSizeInBytes(_,0,0,w));if(!o.transcodeImage(M,_,0,0,w,0,-1,-1))throw c(),new Error("KTX2TextureTranscoder: .transcodeImage failed.");P.push({data:M,width:T,height:x})}return c(),{width:d,height:v,hasAlpha:p,mipmaps:P,format:m,dfdTransferFn:y,dfdFlags:g}}(u.buffers[0]),o=t.width,c=t.height,d=t.hasAlpha,v=t.mipmaps,f=t.format,p=t.dfdTransferFn,y=t.dfdFlags,g=[],b=0;b<v.length;++b)g.push(v[b].data.buffer);self.postMessage({type:"transcode",id:u.id,width:o,height:c,hasAlpha:d,mipmaps:v,format:f,dfdTransferFn:p,dfdFlags:y},g)}catch(e){console.error("[BasisWorker]: "+e),self.postMessage({type:"error",id:u.id,error:e.message})}})}});var o=[{if:"astcSupported",basisFormat:[s.UASTC_4x4],transcoderFormat:[n.ASTC_4x4,n.ASTC_4x4],engineFormat:[r.RGBA_ASTC_4x4_Format,r.RGBA_ASTC_4x4_Format],priorityETC1S:Infinity,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[n.BC7_M5,n.BC7_M5],engineFormat:[r.RGBA_BPTC_Format,r.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[n.BC1,n.BC3],engineFormat:[r.RGB_S3TC_DXT1_Format,r.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[n.ETC1,n.ETC2],engineFormat:[r.RGB_ETC2_Format,r.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[n.ETC1],engineFormat:[r.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[n.PVRTC1_4_RGB,n.PVRTC1_4_RGBA],engineFormat:[r.RGB_PVRTC_4BPPV1_Format,r.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],a=o.sort(function(e,t){return e.priorityETC1S-t.priorityETC1S}),h=o.sort(function(e,t){return e.priorityUASTC-t.priorityUASTC});function l(e){return e<=2||0==(e&e-1)&&0!==e}},Gp=/*#__PURE__*/function(){function e(e,t,i){this.id=void 0,this.viewer=void 0,this.id=e,this.viewer=t,t.registerPlugin(this)}var t=e.prototype;return t.log=function(e){console.log("[xeokit plugin "+this.id+"]: "+e)},t.warn=function(e){console.warn("[xeokit plugin "+this.id+"]: "+e)},t.error=function(e){console.error("[xeokit plugin "+this.id+"]: "+e)},t.send=function(e,t){},t.clear=function(){},t.destroy=function(){this.viewer.deregisterPlugin(this)},e}();exports.AmbientLight=Kf,exports.Camera=gn,exports.CameraControl=da,exports.CameraFlightAnimation=$n,exports.CameraMemento=$f,exports.Canvas=os,exports.Component=ur,exports.CustomProjection=Jr,exports.Data=kr,exports.DataModel=Ar,exports.DataObject=Or,exports.DirLight=Zf,exports.EdgeMaterial=Ta,exports.EmphasisMaterial=_a,exports.EventEmitter=v,exports.Frustum=Kr,exports.KTX2TextureTranscoder=Up,exports.LocaleService=g,exports.Metrics=Qa,exports.ModelMemento=dp,exports.Ortho=Hr,exports.Perspective=Ur,exports.PickResult=Ya,exports.Plugin=Gp,exports.PointLight=Jf,exports.PointsMaterial=Ma,exports.Property=Tr,exports.PropertySet=xr,exports.RTCViewMat=en,exports.Relationship=Mr,exports.SAO=$a,exports.Scene=Pr,exports.SectionPlane=ma,exports.Transform=function(e){},exports.View=Yh,exports.ViewLayer=mh,exports.ViewObject=ba,exports.ViewObjectsMemento=xp,exports.WebGLRenderer=Af,exports.WebViewer=Vf,exports.constants=jt,exports.keycodes={__proto__:null,KEY_BACKSPACE:8,KEY_TAB:9,KEY_ENTER:13,KEY_SHIFT:16,KEY_CTRL:17,KEY_ALT:18,KEY_PAUSE_BREAK:19,KEY_CAPS_LOCK:20,KEY_ESCAPE:27,KEY_PAGE_UP:33,KEY_PAGE_DOWN:34,KEY_END:35,KEY_HOME:36,KEY_LEFT_ARROW:37,KEY_UP_ARROW:38,KEY_RIGHT_ARROW:39,KEY_DOWN_ARROW:40,KEY_INSERT:45,KEY_DELETE:46,KEY_NUM_0:48,KEY_NUM_1:49,KEY_NUM_2:50,KEY_NUM_3:51,KEY_NUM_4:52,KEY_NUM_5:53,KEY_NUM_6:54,KEY_NUM_7:55,KEY_NUM_8:56,KEY_NUM_9:57,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,KEY_LEFT_WINDOW:91,KEY_RIGHT_WINDOW:92,KEY_SELECT_KEY:93,KEY_NUMPAD_0:96,KEY_NUMPAD_1:97,KEY_NUMPAD_2:98,KEY_NUMPAD_3:99,KEY_NUMPAD_4:100,KEY_NUMPAD_5:101,KEY_NUMPAD_6:102,KEY_NUMPAD_7:103,KEY_NUMPAD_8:104,KEY_NUMPAD_9:105,KEY_MULTIPLY:106,KEY_ADD:107,KEY_SUBTRACT:109,KEY_DECIMAL_POINT:110,KEY_DIVIDE:111,KEY_F1:112,KEY_F2:113,KEY_F3:114,KEY_F4:115,KEY_F5:116,KEY_F6:117,KEY_F7:118,KEY_F8:119,KEY_F9:120,KEY_F10:121,KEY_F11:122,KEY_F12:123,KEY_NUM_LOCK:144,KEY_SCROLL_LOCK:145,KEY_SEMI_COLON:186,KEY_EQUAL_SIGN:187,KEY_COMMA:188,KEY_DASH:189,KEY_PERIOD:190,KEY_FORWARD_SLASH:191,KEY_GRAVE_ACCENT:192,KEY_OPEN_BRACKET:219,KEY_BACK_SLASH:220,KEY_CLOSE_BRACKET:221,KEY_SINGLE_QUOTE:222,KEY_SPACE:32},exports.math=Hi;
//# sourceMappingURL=xeokit-webviewer.modern.js.map
