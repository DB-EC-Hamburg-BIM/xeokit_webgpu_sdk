var e=require("@xeokit/core"),t=require("strongly-typed-events");function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,"symbol"==typeof(i=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key))?i:String(i),n)}var i}function n(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function i(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,o(e,t)}function o(e,t){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},o(e,t)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var a=0;function c(e){return"__private_"+a+++"_"+e}function l(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var d=function(e,t){this.propertySet=void 0,this.name=void 0,this.value=void 0,this.type=void 0,this.valueType=void 0,this.description=void 0,this.propertySet=e,this.name=t.name,this.type=t.type,this.value=t.value,this.valueType=t.valueType,this.description=t.description},u=function(e,t){if(this.models=void 0,this.id=void 0,this.originalSystemId=void 0,this.name=void 0,this.type=void 0,this.properties=void 0,this.models=[e],this.id=t.id,this.name=t.name,this.type=t.type,this.properties=[],t.properties)for(var r=0,n=t.properties.length;r<n;r++){var i=new d(this,t.properties[r]);this.properties.push(i)}},h=function(e,t,r,n,i,o){this.data=void 0,this.models=void 0,this.id=void 0,this.name=void 0,this.type=void 0,this.propertySets=void 0,this.relating=void 0,this.related=void 0,this.data=e,this.models=[t],this.id=r,this.name=n,this.type=i,this.propertySets=o||[],this.related={},this.relating={}},f=function(e,t,r){this.type=void 0,this.relatingObject=void 0,this.relatedObject=void 0,this.type=e,this.relatingObject=t,this.relatedObject=r},p=/*#__PURE__*/c("destroyed"),g=/*#__PURE__*/c("removeObjectFromModels"),y=/*#__PURE__*/function(r){function n(n,i,o,a){var c;return c=r.call(this,n)||this,Object.defineProperty(s(c),g,{value:m}),c.data=void 0,c.projectId=void 0,c.revisionId=void 0,c.author=void 0,c.createdAt=void 0,c.creatingApplication=void 0,c.schema=void 0,c.propertySets=void 0,c.objects=void 0,c.rootObjects=void 0,c.objectsByType=void 0,c.relationships=void 0,c.typeCounts=void 0,c.onBuilt=void 0,c.built=void 0,Object.defineProperty(s(c),p,{writable:!0,value:void 0}),c.onBuilt=new e.EventEmitter(new t.EventDispatcher),c.data=n,c.id=i,c.projectId=o.projectId||"",c.revisionId=o.revisionId||"",c.author=o.author||"",c.createdAt=o.createdAt||"",c.creatingApplication=o.creatingApplication||"",c.schema=o.schema||"",c.propertySets={},c.objects={},c.objectsByType={},c.relationships=[],c.typeCounts={},c.rootObjects={},c.built=!1,l(s(c),p)[p]=!1,c.fromJSON(o),c}i(n,r);var o=n.prototype;return o.fromJSON=function(t){if(this.destroyed)return new e.SDKError("Failed to add components to DataModel - DataModel already destroyed");if(this.built)throw new e.SDKError("Failed to add components to DataModel - DataModel already built");if(t.propertySets)for(var r=0,n=t.propertySets.length;r<n;r++)this.createPropertySet(t.propertySets[r]);if(t.objects)for(var i=0,o=t.objects.length;i<o;i++)this.createObject(t.objects[i]);if(t.relationships)for(var s=0,a=t.relationships.length;s<a;s++)this.createRelationship(t.relationships[s])},o.createPropertySet=function(t){if(this.destroyed)return new e.SDKError("Failed to create PropertySet - DataModel already destroyed");if(this.built)return new e.SDKError("DataModel already built");if(this.propertySets[t.id])return new e.SDKError("Failed to create PropertySet - PropertySet with same ID already created in this DataModel. It's OK to have duplicates shared between DataModels, but they must be unique within each DataModel.");var r=this.data.propertySets[t.id];return r?(this.propertySets[t.id]=r,r.models.push(this),r):(r=new u(this,t),this.propertySets[t.id]=r,this.data.propertySets[t.id]=r,r)},o.createObject=function(t){if(this.destroyed)return new e.SDKError("Failed to create DataObject - DataModel already destroyed");if(this.built)return new e.SDKError("Failed to create DataObject - DataModel already built");var r=t.id;if(this.objects[r])return new e.SDKError("Failed to create DataObject - DataObject with same ID already created in this DataModel. It's OK to have duplicates shared between DataModels, but they must be unique within each DataModel.");var n=t.type,i=this.data.objects[r];if(i)this.objects[r]=i,this.data.objects[r]=i,this.objectsByType[n]||(this.objectsByType[n]={}),this.objectsByType[n][r]=i,this.typeCounts[n]=void 0===this.typeCounts[n]?1:this.typeCounts[n]+1,i.models.push(this);else{var o=[];if(t.propertySetIds)for(var s=0,a=t.propertySetIds.length;s<a;s++){var c=t.propertySetIds[s],l=this.propertySets[c];if(!l)return new e.SDKError('Failed to create DataObject - PropertySet not found: "'+c+'"');o.push(l)}i=new h(this.data,this,r,t.name,t.type,o),this.objects[r]=i,this.data.objects[r]=i,this.data.objectsByType[n]||(this.data.objectsByType[n]={}),this.data.objectsByType[n][r]=i,this.data.typeCounts[n]=void 0===this.data.typeCounts[n]?1:this.data.typeCounts[n]+1,i.models.push(this),this.data.onObjectCreated.dispatch(this.data,i)}return i},o.createRelationship=function(t){if(this.destroyed)return new e.SDKError("Failed to create Relationship - DataModel already destroyed");if(this.built)return new e.SDKError("Failed to create Relationship - DataModel already built");var r=this.data.objects[t.relatingObjectId];if(!r)return new e.SDKError("Failed to create Relationship - relating DataObject not found: "+t.relatingObjectId);var n=this.data.objects[t.relatedObjectId];if(!n)return new e.SDKError("Failed to create Relationship - related DataObject not found: "+t.relatedObjectId);var i=new f(t.type,r,n);return n.relating[t.type]||(n.relating[t.type]=[]),n.relating[t.type].push(i),r.related[t.type]||(r.related[t.type]=[]),r.related[t.type].push(i),this.relationships.push(i),i},o.build=function(){return this.destroyed?new e.SDKError("Failed to build DataModel - DataModel already destroyed"):this.built?new e.SDKError("Failed to build DataModel - DataModel already built"):(this.built=!0,void this.onBuilt.dispatch(this,null))},o.getJSON=function(){if(this.destroyed)return new e.SDKError("DataModel already destroyed");if(this.built)return new e.SDKError("DataModel already built");var t={id:this.id,propertySets:[],objects:[],relationships:[]};for(var r in this.propertySets){for(var n,i=this.propertySets[r],o={id:r,name:i.name,properties:[],type:i.type,originalSystemId:i.originalSystemId},s=0,a=i.properties.length;s<a;s++){var c=i.properties[s];o.properties.push({name:c.name,value:c.value,type:c.type,valueType:c.valueType,description:c.description})}null==(n=t.propertySets)||n.push(o)}for(var l in this.objects){var d,u=this.objects[l],h={id:l,type:u.type,name:u.name,propertySetIds:[]};if(u.propertySets)for(var f=0,p=u.propertySets.length;f<p;f++){var g;null==(g=h.propertySetIds)||g.push(u.propertySets[f].id)}null==(d=t.objects)||d.push(h)}for(var y=0,m=this.relationships.length;y<m;y++){var v,w=this.relationships[y];null==(v=t.relationships)||v.push({type:w.type,relatingObjectId:w.relatingObject.id,relatedObjectId:w.relatedObject.id})}return t},o.destroy=function(){if(this.destroyed)return new e.SDKError("Failed to destroy DataModel - DataModel already destroyed");for(var t in this.objects){var n=this.objects[t];if(n.models.length>1)l(this,g)[g](n);else{delete this.data.objects[t];var i=n.type;if(0==--this.data.typeCounts[i])for(var o in delete this.data.typeCounts[i],delete this.data.objectsByType[i],this.data.onObjectDestroyed.dispatch(this.data,n),n.relating)for(var s=n.relating[o],a=0,c=s.length;a<c;a++)for(var d=s[a].relatedObject.relating[o],u=0,h=d.length;u<h;u++)d[0].relatingObject===n&&(d[u]=d[u])}}l(this,p)[p]=!0,this.onBuilt.clear(),r.prototype.destroy.call(this)},n}(e.Component);function m(e){for(var t=0,r=e.models.length;t<r;t++)if(e.models[t]===this){e.models=e.models.splice(t,1);break}}var v=/*#__PURE__*/function(r){function n(){var n;return(n=r.call(this,null,{})||this).models=void 0,n.propertySets=void 0,n.objects=void 0,n.rootObjects=void 0,n.objectsByType=void 0,n.typeCounts=void 0,n.onModelCreated=void 0,n.onModelDestroyed=void 0,n.onObjectCreated=void 0,n.onObjectDestroyed=void 0,n.models={},n.propertySets={},n.objects={},n.rootObjects={},n.objectsByType={},n.typeCounts={},n.onModelCreated=new e.EventEmitter(new t.EventDispatcher),n.onModelDestroyed=new e.EventEmitter(new t.EventDispatcher),n.onObjectCreated=new e.EventEmitter(new t.EventDispatcher),n.onObjectDestroyed=new e.EventEmitter(new t.EventDispatcher),n}i(n,r);var o=n.prototype;return o.createModel=function(t,r){var n=this;if(this.destroyed)return new e.SDKError("Data already destroyed");var i=t.id;if(this.models[i])return new e.SDKError("DataModel already created in this Data: "+i);var o=new y(this,i,t,r);return this.models[o.id]=o,o.onDestroyed.one(function(){delete n.models[o.id],n.onModelDestroyed.dispatch(n,o)}),o.onBuilt.one(function(){n.onModelCreated.dispatch(n,o)}),o},o.getObjectIdsByType=function(t){if(this.destroyed)return new e.SDKError("Data already destroyed");var r=this.objectsByType[t];return r?Object.keys(r):[]},o.searchObjects=function(t){if(this.destroyed)return new e.SDKError("Data already destroyed");var r=t.includeObjects&&t.includeObjects.length>0?w(t.includeObjects):null,n=t.excludeObjects&&t.excludeObjects.length>0?w(t.excludeObjects):null,i=t.includeRelating&&t.includeRelating.length>0?w(t.includeRelating):null,o=t.excludeRelating&&t.excludeRelating.length>0?w(t.excludeRelating):null;function s(e,a){if(e){var c=!0;(n&&n[e.type]||r&&!r[e.type])&&(c=!1),0===a&&!1===t.includeStart&&(c=!1),c&&(t.resultObjectIds?t.resultObjectIds.push(e.id):t.resultObjects?t.resultObjects.push(e):t.resultCallback&&t.resultCallback(e));var l=e.related;for(var d in l){var u=l[d];if(u)for(var h=0,f=u.length;h<f;h++){var p=!0;(o&&o[e.type]||i&&!i[e.type])&&(p=!1),p&&s(u[h].relatedObject,a+1)}}}}if(t.startObjectId){var a=this.objects[t.startObjectId];if(!a)return new e.SDKError('Failed to search DataObjects - starting DataObject not found in Data: "'+t.startObjectId+'"');s(a,0)}else if(t.startObject){if(t.startObject.data!=this)return new e.SDKError('Failed to search DataObjects - starting DataObject not in same Data: "'+t.startObjectId+'"');s(t.startObject,1)}else for(var c in this.rootObjects)s(this.rootObjects[c],1)},o.clear=function(){if(this.destroyed)return new e.SDKError("Data already destroyed");for(var t in this.models)this.models[t].destroy()},o.destroy=function(){if(this.destroyed)return new e.SDKError("Data already destroyed");this.clear(),this.onModelCreated.clear(),this.onModelDestroyed.clear(),r.prototype.destroy.call(this)},n}(e.Component);function w(e){for(var t={},r=0,n=e.length;r<n;r++)t[e[r]]=!0;return t}var b=Float64Array,_=-Number.MAX_SAFE_INTEGER,x=Number.MAX_SAFE_INTEGER;function k(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const S=Boolean("object"!=typeof process||"[object process]"!==String(process)||process.browser);function M(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}"undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);const E={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},T=E.global||E.self||E.window||{},D="object"!=typeof process||"[object process]"!==String(process)||process.browser,A="function"==typeof importScripts,B="undefined"!=typeof window&&void 0!==window.orientation;function j(e){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j(e)}function I(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==j(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==j(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===j(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}"undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);class O{constructor(e,t){I(this,"name",void 0),I(this,"workerThread",void 0),I(this,"isRunning",!0),I(this,"result",void 0),I(this,"_resolve",()=>{}),I(this,"_reject",()=>{}),this.name=e,this.workerThread=t,this.result=new Promise((e,t)=>{this._resolve=e,this._reject=t})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){M(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){M(this.isRunning),this.isRunning=!1,this._reject(e)}}class C{terminate(){}}const P=new Map;function R(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function U(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0;const n=r||new Set;if(e)if(F(e))n.add(e);else if(F(e.buffer))n.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"==typeof e)for(const r in e)U(e[r],t,n);return void 0===r?Array.from(n):[]}function F(e){return!!e&&(e instanceof ArrayBuffer||"undefined"!=typeof MessagePort&&e instanceof MessagePort||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)}function z(e){if(null===e)return{};const t=Object.assign({},e);return Object.keys(t).forEach(r=>{t[r]="object"!=typeof e[r]||ArrayBuffer.isView(e[r])||e[r]instanceof Array?"function"==typeof t[r]||t[r]instanceof RegExp?{}:e[r]:z(e[r])}),t}const L=()=>{};class K{static isSupported(){return"undefined"!=typeof Worker&&D||void 0!==C&&!D}constructor(e){I(this,"name",void 0),I(this,"source",void 0),I(this,"url",void 0),I(this,"terminated",!1),I(this,"worker",void 0),I(this,"onMessage",void 0),I(this,"onError",void 0),I(this,"_loadableURL","");const{name:t,source:r,url:n}=e;M(r||n),this.name=t,this.source=r,this.url=n,this.onMessage=L,this.onError=e=>console.log(e),this.worker=D?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=L,this.onError=L,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||U(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(t+="".concat(e.message," in ")),e.lineno&&(t+=":".concat(e.lineno,":").concat(e.colno)),new Error(t)}_createBrowserWorker(){this._loadableURL=function(e){M(e.source&&!e.url||!e.source&&e.url);let t=P.get(e.source||e.url);return t||(e.url&&(t=(r=e.url).startsWith("http")?R("try {\n  importScripts('".concat(r,"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}")):r,P.set(e.url,t)),e.source&&(t=R(e.source),P.set(e.source,t))),M(t),t;var r}({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},e.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},e.onmessageerror=e=>console.error(e),e}_createNodeWorker(){let e;if(this.url){const t=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new C(t,{eval:!1})}else{if(!this.source)throw new Error("no worker");e=new C(this.source,{eval:!0})}return e.on("message",e=>{this.onMessage(e)}),e.on("error",e=>{this.onError(e)}),e.on("exit",e=>{}),e}}class N{static isSupported(){return K.isSupported()}constructor(e){I(this,"name","unnamed"),I(this,"source",void 0),I(this,"url",void 0),I(this,"maxConcurrency",1),I(this,"maxMobileConcurrency",1),I(this,"onDebug",()=>{}),I(this,"reuseWorkers",!0),I(this,"props",{}),I(this,"jobQueue",[]),I(this,"idleQueue",[]),I(this,"count",0),I(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}async startJob(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e,t,r)=>e.done(r),r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(e,t)=>e.error(t);const n=new Promise(n=>(this.jobQueue.push({name:e,onMessage:t,onError:r,onStart:n}),this));return this._startQueuedJob(),await n}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const r=new O(t.name,e);e.onMessage=e=>t.onMessage(r,e.type,e.payload),e.onError=e=>t.onError(r,e),t.onStart(r);try{await r.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new K({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return B?this.maxMobileConcurrency:this.maxConcurrency}}const Z={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class G{static isSupported(){return K.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return G._workerFarm=G._workerFarm||new G({}),G._workerFarm.setProps(e),G._workerFarm}constructor(e){I(this,"props",void 0),I(this,"workerPools",new Map),this.props={...Z},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:r,url:n}=e;let i=this.workerPools.get(t);return i||(i=new N({name:t,source:r,url:n}),i.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,i)),i}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}I(G,"_workerFarm",void 0);const W="latest",H="3.3.1";function V(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=t[e.id]||{},n="".concat(e.id,"-worker.js");let i=r.workerUrl;if(i||"compression"!==e.id||(i=t.workerUrl),"test"===t._workerType&&(i="modules/".concat(e.module,"/dist/").concat(n)),!i){let t=e.version;"latest"===t&&(t=W);const r=t?"@".concat(t):"";i="https://unpkg.com/@loaders.gl/".concat(e.module).concat(r,"/dist/").concat(n)}return M(i),i}async function J(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const i=function(e){const t=e.version!==H?" (worker-utils@".concat(H,")"):"";return"".concat(e.name,"@").concat(e.version).concat(t)}(e),o=G.getWorkerFarm(r),{source:s}=r,a={name:i,source:s};s||(a.url=V(e,r));const c=o.getWorkerPool(a),l=r.jobName||e.name,d=await c.startJob(l,q.bind(null,n)),u=z(r);return d.postMessage("process",{input:t,options:u}),(await d.result).result}async function q(e,t,r,n){switch(r){case"done":t.done(n);break;case"error":t.error(new Error(n.error));break;case"process":const{id:i,input:o,options:s}=n;try{if(!e.process)return void t.postMessage("error",{id:i,error:"Worker not set up to process on main thread"});const r=await e.process(o,s);t.postMessage("done",{id:i,result:r})}catch(e){const r=e instanceof Error?e.message:"unknown error";t.postMessage("error",{id:i,error:r})}break;default:console.warn("process-on-worker: unknown message ".concat(r))}}var Y={__proto__:null,default:{}};const Q={};async function X(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t&&(e=function(e,t,r){if(e.startsWith("http"))return e;const n=r.modules||{};return n[e]?n[e]:D?r.CDN?(M(r.CDN.startsWith("http")),"".concat(r.CDN,"/").concat(t,"@").concat("3.3.1","/dist/libs/").concat(e)):A?"../src/libs/".concat(e):"modules/".concat(t,"/src/libs/").concat(e):"modules/".concat(t,"/dist/libs/").concat(e)}(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})),Q[e]=Q[e]||async function(e){if(e.endsWith("wasm")){const t=await fetch(e);return await t.arrayBuffer()}if(!D)try{return Y&&void 0}catch{return null}if(A)return importScripts(e);const t=await fetch(e);return function(e,t){if(!D)return;if(A)return eval.call(T,e),null;const r=document.createElement("script");r.id=t;try{r.appendChild(document.createTextNode(e))}catch(t){r.text=e}return document.body.appendChild(r),null}(await t.text(),e)}(e),await Q[e]}async function $(e,t,r,n,i){const o=e.id,s=V(e,r),a=G.getWorkerFarm(r).getWorkerPool({name:o,url:s});r=JSON.parse(JSON.stringify(r)),n=JSON.parse(JSON.stringify(n||{}));const c=await a.startJob("process-on-worker",ee.bind(null,i));c.postMessage("process",{input:t,options:r,context:n});const l=await c.result;return await l.result}async function ee(e,t,r,n){switch(r){case"done":t.done(n);break;case"error":t.error(new Error(n.error));break;case"process":const{id:i,input:o,options:s}=n;try{const r=await e(o,s);t.postMessage("done",{id:i,result:r})}catch(e){const r=e instanceof Error?e.message:"unknown error";t.postMessage("error",{id:i,error:r})}break;default:console.warn("parse-with-worker unknown message ".concat(r))}}function te(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const n=t.map(e=>e instanceof ArrayBuffer?new Uint8Array(e):e),i=n.reduce((e,t)=>e+t.byteLength,0),o=new Uint8Array(i);let s=0;for(const e of n)o.set(e,s),s+=e.byteLength;return o.buffer}let re="";const ne={};function ie(e){for(const t in ne)e.startsWith(t)&&(e=e.replace(t,ne[t]));return e.startsWith("http://")||e.startsWith("https://")||(e="".concat(re).concat(e)),e}function oe(e){if((t=e)&&"object"==typeof t&&t.isBuffer)return(void 0)(e);var t;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if("string"==typeof e){const t=e;return(new TextEncoder).encode(t).buffer}if(e&&"object"==typeof e&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}const se="3.3.1",ae="https://unpkg.com/@loaders.gl/textures@".concat(se,"/dist/libs/basis_encoder.wasm"),ce="https://unpkg.com/@loaders.gl/textures@".concat(se,"/dist/libs/basis_encoder.js");let le;const de={name:"Basis Universal Supercompressed GPU Texture",id:"ktx2-basis-writer",module:"textures",version:"3.3.1",extensions:["ktx2"],options:{useSRGB:!1,qualityLevel:10,encodeUASTC:!1,mipmaps:!1},encode:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{useSRGB:r=!1,qualityLevel:n=10,encodeUASTC:i=!1,mipmaps:o=!1}=t,{BasisEncoder:s}=await async function(e){const t=e.modules||{};return t.basisEncoder?t.basisEncoder:(le=le||async function(e){let t=null,r=null;return[t,r]=await Promise.all([await X(ce,"textures",e),await X(ae,"textures",e)]),t=t||globalThis.BASIS,await function(e,t){const r={};return t&&(r.wasmBinary=t),new Promise(t=>{e(r).then(e=>{const{BasisFile:r,KTX2File:n,initializeBasis:i,BasisEncoder:o}=e;i(),t({BasisFile:r,KTX2File:n,BasisEncoder:o})})})}(t,r)}(e),await le)}(t),a=new s;try{const t=new Uint8Array(e.width*e.height*4);a.setCreateKTX2File(!0),a.setKTX2UASTCSupercompression(!0),a.setKTX2SRGBTransferFunc(!0),a.setSliceSourceImage(0,e.data,e.width,e.height,!1),a.setPerceptual(r),a.setMipSRGB(r),a.setQualityLevel(n),a.setUASTC(i),a.setMipGen(o);const s=a.encode(t);return t.subarray(0,s).buffer}catch(e){throw console.error("Basis Universal Supercompressed GPU Texture encoder Error: ",e),e}finally{a.delete()}}},{_parseImageNode:ue}=globalThis,he="undefined"!=typeof Image,fe="undefined"!=typeof ImageBitmap,pe=Boolean(ue),ge=!!S||pe,ye=/^data:image\/svg\+xml/,me=/\.svg((\?|#).*)?$/;function ve(e){return e&&(ye.test(e)||me.test(e))}function we(e,t){if(ve(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function be(e,t,r){const n=function(e,t){if(ve(t)){let t=(new TextDecoder).decode(e);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(t=unescape(encodeURIComponent(t)))}catch(e){throw new Error(e.message)}return"data:image/svg+xml;base64,".concat(btoa(t))}return we(e,t)}(e,r),i=self.URL||self.webkitURL,o="string"!=typeof n&&i.createObjectURL(n);try{return await async function(e,t){const r=new Image;return r.src=e,t.image&&t.image.decode&&r.decode?(await r.decode(),r):await new Promise((t,n)=>{try{r.onload=()=>t(r),r.onerror=t=>n(new Error("Could not load image ".concat(e,": ").concat(t)))}catch(e){n(e)}})}(o||n,t)}finally{o&&i.revokeObjectURL(o)}}const _e={};let xe=!0;const ke=!1,Se=!0;function Me(e){const t=Ee(e);return function(e){const t=Ee(e);return t.byteLength>=24&&2303741511===t.getUint32(0,ke)?{mimeType:"image/png",width:t.getUint32(16,ke),height:t.getUint32(20,ke)}:null}(t)||function(e){const t=Ee(e);if(!(t.byteLength>=3&&65496===t.getUint16(0,ke)&&255===t.getUint8(2)))return null;const{tableMarkers:r,sofMarkers:n}=function(){const e=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)e.add(t);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}();let i=2;for(;i+9<t.byteLength;){const e=t.getUint16(i,ke);if(n.has(e))return{mimeType:"image/jpeg",height:t.getUint16(i+5,ke),width:t.getUint16(i+7,ke)};if(!r.has(e))return null;i+=2,i+=t.getUint16(i,ke)}return null}(t)||function(e){const t=Ee(e);return t.byteLength>=10&&1195984440===t.getUint32(0,ke)?{mimeType:"image/gif",width:t.getUint16(6,Se),height:t.getUint16(8,Se)}:null}(t)||function(e){const t=Ee(e);return t.byteLength>=14&&16973===t.getUint16(0,ke)&&t.getUint32(2,Se)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,Se),height:t.getUint32(22,Se)}:null}(t)}function Ee(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}const Te={id:"image",module:"images",name:"Images",version:"3.3.1",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg"],parse:async function(e,t,r){const n=((t=t||{}).image||{}).type||"auto",{url:i}=r||{};let o;switch(function(e){switch(e){case"auto":case"data":return function(){if(fe)return"imagebitmap";if(he)return"image";if(ge)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(e){switch(e){case"auto":return fe||he||ge;case"imagebitmap":return fe;case"image":return he;case"data":return ge;default:throw new Error("@loaders.gl/images: image ".concat(e," not supported in this environment"))}}(e),e}}(n)){case"imagebitmap":o=await async function(e,t,r){let n;n=ve(r)?await be(e,t,r):we(e,r);const i=t&&t.imagebitmap;return await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!function(e){for(const t in e||_e)return!1;return!0}(t)&&xe||(t=null),t)try{return await createImageBitmap(e,t)}catch(e){console.warn(e),xe=!1}return await createImageBitmap(e)}(n,i)}(e,t,i);break;case"image":o=await be(e,t,i);break;case"data":o=await async function(e,t){const{mimeType:r}=Me(e)||{},n=globalThis._parseImageNode;return k(n),await n(e,r)}(e);break;default:k(!1)}return"data"===n&&(o=function(e){switch(function(e){const t=function(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&e instanceof Image?"image":e&&"object"==typeof e&&e.data&&e.width&&e.height?"data":null}(e);if(!t)throw new Error("Not an image");return t}(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw new Error("getImageData");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}(o)),o},tests:[e=>Boolean(Me(new DataView(e)))],options:{image:{type:"auto",decode:!0}}};var De=1e3,Ae=1001,Be=2e4,je=20001,Ie=20002,Oe=20003,Ce=20004;function Pe(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Re(e){return new FloatArrayClass(e||2)}function Ue(e){return new Float64Array(e||3)}function Fe(e){return new FloatArrayClass(e||4)}function ze(e,t,r){return r||(r=e),r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r}function Le(e,t,r){return r||(r=e),r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r}function Ke(e,t,r){r||(r=e);var n=e[0],i=e[1],o=e[2],s=t[0],a=t[1],c=t[2];return r[0]=i*c-o*a,r[1]=o*s-n*c,r[2]=n*a-i*s,r}function Ne(e){return Math.sqrt(function(e){return Pe(e,e)}(e))}function Ze(e,t){return ze(e,1/Ne(e),t)}function Ge(e){return function(e){return new b(e)}(e||16)}function We(e){return e||(e=Ge()),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}Fe(),Fe(),Re();var He=Ge(),Ve=Ge();function Je(e,t,r){return void 0===r&&(r=e),r[0]=e[0]*t[0]+t[12],r[1]=e[1]*t[5]+t[13],r[2]=e[2]*t[10]+t[14],r}function qe(e){return new Float64Array(e||6)}function Ye(e){return void 0===e&&(e=qe()),e[0]=x,e[1]=x,e[2]=x,e[3]=_,e[4]=_,e[5]=_,e}function Qe(e,t){for(var r,n,i,o=0,s=t.length;o<s;o+=3)n=t[o+1],i=t[o+2],e[0]>(r=t[o])&&(e[0]=r),e[1]>n&&(e[1]=n),e[2]>i&&(e[2]=i),e[3]<r&&(e[3]=r),e[4]<n&&(e[4]=n),e[5]<i&&(e[5]=i);return e}var Xe=function(e){this.positionsCompressed=void 0,this.uvsCompressed=void 0,this.colorsCompressed=void 0,this.indices=void 0,this.edgeIndices=void 0,this.positionsCompressed=e.positionsCompressed,this.uvsCompressed=e.uvsCompressed,this.colorsCompressed=e.colorsCompressed,this.indices=e.indices,this.edgeIndices=e.edgeIndices},$e=function(e){this.id=void 0,this.primitive=void 0,this.positionsDecompressMatrix=void 0,this.aabb=void 0,this.uvsDecompressMatrix=void 0,this.geometryBuckets=void 0,this.rendererGeometry=void 0,this.geometryBuckets=[];for(var t=0,r=e.geometryBuckets.length;t<r;t++)this.geometryBuckets[t]=new Xe(e.geometryBuckets[t]);this.id=e.id,this.positionsDecompressMatrix=e.positionsDecompressMatrix,this.primitive=e.primitive},et=/*#__PURE__*/c("positionsDecompressed"),tt=/*#__PURE__*/c("positionsWorld"),rt=/*#__PURE__*/function(){function e(){this.object=void 0,this.mesh=void 0,this.meshIndex=void 0,this.geometry=void 0,this.geometryBucket=void 0,this.geometryBucketIndex=void 0,Object.defineProperty(this,et,{writable:!0,value:void 0}),Object.defineProperty(this,tt,{writable:!0,value:void 0}),this.object=null,this.mesh=null,this.meshIndex=0,this.geometry=null,this.geometryBucket=null,this.geometryBucketIndex=0,l(this,et)[et]=null,l(this,tt)[tt]=null}return e.prototype.reset=function(){l(this,et)[et]=null,l(this,tt)[tt]=null},n(e,[{key:"totalGeometryBuckets",get:function(){var e=0;if(this.object)for(var t=0,r=this.object.meshes.length;t<r;t++)e+=this.object.meshes[t].geometry.geometryBuckets.length;return e}},{key:"numPrimitives",get:function(){var e=this.geometry.primitive;return this.geometryBucket.indices.length/(e===Ie?3:e===je?2:1)}},{key:"positionsDecompressed",get:function(){return l(this,et)[et]||(l(this,et)[et]=new Float32Array(this.geometryBucket.positionsCompressed.length),function(e,t,r){void 0===r&&(r=new Float32Array(e.length));for(var n=0,i=e.length;n<i;n+=3)r[n+0]=e[n+0]*t[0]+t[12],r[n+1]=e[n+1]*t[5]+t[13],r[n+2]=e[n+2]*t[10]+t[14]}(this.geometryBucket.positionsCompressed,this.geometry.positionsDecompressMatrix,l(this,et)[et])),l(this,et)[et]}},{key:"positionsWorld",get:function(){if(!l(this,tt)[tt]){var e=this.positionsDecompressed;l(this,tt)[tt]=new Float64Array(e.length),function(e,t,r){var n;r||(r=t);var i,o,s,a=t.length,c=e[0],l=e[1],d=e[2],u=e[3],h=e[4],f=e[5],p=e[6],g=e[7],y=e[8],m=e[9],v=e[10],w=e[11],b=e[12],_=e[13],x=e[14],k=e[15];for(n=0;n<a;n+=3)r[n+0]=c*(i=t[n+0])+h*(o=t[n+1])+y*(s=t[n+2])+b,r[n+1]=l*i+f*o+m*s+_,r[n+2]=d*i+p*o+v*s+x,r[n+3]=u*i+g*o+w*s+k}(e,this.mesh.matrix,l(this,tt)[tt])}return l(this,tt)[tt]}},{key:"uvsDecompressed",get:function(){return null}}]),e}(),nt=new rt,it=/*#__PURE__*/c("aabb"),ot=/*#__PURE__*/c("aabbDirty"),st=/*#__PURE__*/function(){function e(e){this.model=void 0,this.id=void 0,this.meshes=void 0,this.layerId=void 0,this.rendererObject=void 0,Object.defineProperty(this,it,{writable:!0,value:void 0}),Object.defineProperty(this,ot,{writable:!0,value:void 0}),this.id=e.id,this.layerId=e.layerId,this.meshes=e.meshes,l(this,it)[it]=qe(),l(this,ot)[ot]=!0,this.rendererObject=null}return e.prototype.setAABBDirty=function(){l(this,ot)[ot]=!0},n(e,[{key:"aabb",get:function(){var e=this;return l(this,ot)[ot]&&(Ye(l(this,it)[it]),function(e,t){nt.reset(),nt.object=e;for(var r=0,n=e.meshes.length;r<n;r++){var i=e.meshes[r];nt.mesh=i,nt.meshIndex=r;var o=i.geometry;nt.geometry=o;for(var s=0,a=o.geometryBuckets.length;s<a;s++)if(nt.geometryBucket=o.geometryBuckets[s],nt.geometryBucketIndex=s,t(nt))return!0}}(this,function(t){return Qe(l(e,it)[it],t.positionsWorld),!1}),l(this,ot)[ot]=!1),l(this,it)[it]}}]),e}(),at=function(e,t){this.id=void 0,this.colorTexture=void 0,this.metallicRoughnessTexture=void 0,this.occlusionTexture=void 0,this.emissiveTexture=void 0,this.rendererTextureSet=void 0,this.id=e.id,this.colorTexture=t.colorTexture,this.metallicRoughnessTexture=t.metallicRoughnessTexture,this.occlusionTexture=t.occlusionTexture,this.emissiveTexture=t.emissiveTexture,this.rendererTextureSet=null},ct=function(e){this.rendererTexture=void 0,this.id=void 0,this.src=void 0,this.imageData=void 0,this.buffers=void 0,this.image=void 0,this.height=void 0,this.width=void 0,this.compressed=void 0,this.mediaType=void 0,this.magFilter=void 0,this.minFilter=void 0,this.wrapS=void 0,this.wrapT=void 0,this.wrapR=void 0,this.flipY=void 0,this.encoding=void 0,this.preloadColor=void 0,this.channel=void 0,this.id=e.id,this.imageData=e.imageData,this.src=e.src,this.mediaType=e.mediaType,this.minFilter=e.minFilter||1007,this.magFilter=e.magFilter||1007,this.wrapS=e.wrapS||De,this.wrapT=e.wrapT||De,this.wrapR=e.wrapR||De,this.encoding=e.encoding||3e3,this.preloadColor=Fe(e.preloadColor||[1,1,1,1]),this.channel=0,this.rendererTexture=null},lt=/*#__PURE__*/c("color"),dt=/*#__PURE__*/c("matrix"),ut=/*#__PURE__*/c("metallic"),ht=/*#__PURE__*/c("roughness"),ft=/*#__PURE__*/c("opacity"),pt=/*#__PURE__*/function(){function e(e){this.id=void 0,this.geometry=void 0,this.textureSet=void 0,this.rendererMesh=void 0,this.object=void 0,Object.defineProperty(this,lt,{writable:!0,value:void 0}),Object.defineProperty(this,dt,{writable:!0,value:void 0}),Object.defineProperty(this,ut,{writable:!0,value:void 0}),Object.defineProperty(this,ht,{writable:!0,value:void 0}),Object.defineProperty(this,ft,{writable:!0,value:void 0}),this.id=e.id,l(this,dt)[dt]=e.matrix?Ge(e.matrix):We(),this.geometry=e.geometry,this.textureSet=e.textureSet,this.rendererMesh=null,this.color=e.color||Ue([1,1,1]),this.metallic=null!=e.metallic?e.metallic:0,this.roughness=null!=e.roughness?e.roughness:1,this.opacity=null!=e.opacity?e.opacity:1}return n(e,[{key:"color",get:function(){return l(this,lt)[lt]},set:function(e){var t=l(this,lt)[lt];t||((t=l(this,lt)[lt]=new Float32Array(4))[3]=1),e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.rendererMesh&&this.rendererMesh.setColor(l(this,lt)[lt])}},{key:"matrix",get:function(){return l(this,dt)[dt]},set:function(e){e?l(this,dt)[dt].set(e):We(l(this,dt)[dt]),this.rendererMesh&&this.rendererMesh.setMatrix(l(this,dt)[dt]),this.object&&this.object.setAABBDirty()}},{key:"metallic",get:function(){return l(this,ut)[ut]},set:function(e){e=null!=e?e:1,l(this,ut)[ut]!==e&&(l(this,ut)[ut]=e,this.rendererMesh&&this.rendererMesh.setMetallic(l(this,ut)[ut]))}},{key:"roughness",get:function(){return l(this,ht)[ht]},set:function(e){e=null!=e?e:1,l(this,ht)[ht]!==e&&(l(this,ht)[ht]=e,this.rendererMesh&&this.rendererMesh.setRoughness(l(this,ht)[ht]))}},{key:"opacity",get:function(){return l(this,ft)[ft]},set:function(e){e=null!=e?e:1,l(this,ft)[ft]!==e&&(l(this,ft)[ft]=e)}}]),e}(),gt=[],yt=[],mt=[],vt=[],wt=[],bt=0,_t=new Uint16Array(3),xt=new Uint16Array(3),kt=new Uint16Array(3),St=Ue(),Mt=Ue(),Et=Ue(),Tt=Ue(),Dt=Ue(),At=Ue(),Bt=Ue(),jt=null;function It(e,t){for(var r,n=0;n<3;n++)if(0!=(r=jt[3*e+n]-jt[3*t+n]))return r;return 0}var Ot=null,Ct=null;function Pt(e,t){var r,n,i,o,s,a,c=3*e,l=3*t,d=Math.min(r=Ct[c],n=Ct[c+1],i=Ct[c+2]),u=Math.min(o=Ct[l],s=Ct[l+1],a=Ct[l+2]);if(d!=u)return d-u;var h=Math.max(r,n,i),f=Math.max(o,s,a);return h!=f?h-f:0}const Rt=e=>"function"==typeof e,Ut=e=>null!==e&&"object"==typeof e,Ft=e=>Ut(e)&&e.constructor==={}.constructor,zt=e=>e&&"function"==typeof e[Symbol.iterator],Lt=e=>e&&"function"==typeof e[Symbol.asyncIterator],Kt=e=>"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,Nt=e=>"undefined"!=typeof Blob&&e instanceof Blob,Zt=e=>e&&"object"==typeof e&&e.isBuffer,Gt=e=>(e=>"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||Ut(e)&&Rt(e.tee)&&Rt(e.cancel)&&Rt(e.getReader))(e)||(e=>Ut(e)&&Rt(e.read)&&Rt(e.pipe)&&(e=>"boolean"==typeof e)(e.readable))(e),Wt=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Ht=/^([-\w.]+\/[-\w.+]+)/;function Vt(e){const t=Ht.exec(e);return t?t[1]:e}function Jt(e){const t=Wt.exec(e);return t?t[1]:""}const qt=/\?.*/;function Yt(e){if(Kt(e)){const t=Qt(e.url||"");return{url:t,type:Vt(e.headers.get("content-type")||"")||Jt(t)}}return Nt(e)?{url:Qt(e.name||""),type:e.type||""}:"string"==typeof e?{url:Qt(e),type:Jt(e)}:{url:"",type:""}}function Qt(e){return e.replace(qt,"")}async function Xt(e){if(Kt(e))return e;const t={},r=function(e){return Kt(e)?e.headers["content-length"]||-1:Nt(e)?e.size:"string"==typeof e?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}(e);r>=0&&(t["content-length"]=String(r));const{url:n,type:i}=Yt(e);i&&(t["content-type"]=i);const o=await async function(e){if("string"==typeof e)return"data:,".concat(e.slice(0,5));if(e instanceof Blob){const t=e.slice(0,5);return await new Promise(e=>{const r=new FileReader;r.onload=t=>{var r;return e(null==t||null===(r=t.target)||void 0===r?void 0:r.result)},r.readAsDataURL(t)})}if(e instanceof ArrayBuffer){const t=function(e){let t="";const r=new Uint8Array(e);for(let e=0;e<r.byteLength;e++)t+=String.fromCharCode(r[e]);return btoa(t)}(e.slice(0,5));return"data:base64,".concat(t)}return null}(e);o&&(t["x-first-bytes"]=o),"string"==typeof e&&(e=(new TextEncoder).encode(e));const s=new Response(e,{headers:t});return Object.defineProperty(s,"url",{value:n}),s}async function $t(e,t){if("string"==typeof e){e=ie(e);let r=t;return null!=t&&t.fetch&&"function"!=typeof(null==t?void 0:t.fetch)&&(r=t.fetch),await fetch(e,r)}return await Xt(e)}function er(){return!("object"==typeof process&&"[object process]"===String(process)&&!process.browser)||function(e){if("undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"==typeof process.versions&&Boolean(process.versions.electron))return!0;const t="object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}()}const tr={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document,process:"object"==typeof process&&process},rr=tr.window||tr.self||tr.global,nr=tr.process||{},ir="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source";er();class or{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";I(this,"storage",void 0),I(this,"id",void 0),I(this,"config",void 0),this.storage=function(e){try{const t=window[e],r="__storage_test__";return t.setItem(r,r),t.removeItem(r),t}catch(e){return null}}(r),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function sr(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600;const i=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>n&&(r=Math.min(r,n/e.width));const o=e.width*r,s=e.height*r,a=["font-size:1px;","padding:".concat(Math.floor(s/2),"px ").concat(Math.floor(o/2),"px;"),"line-height:".concat(s,"px;"),"background:url(".concat(i,");"),"background-size:".concat(o,"px ").concat(s,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),a]}let ar;function cr(e){return"string"==typeof e?ar[e.toUpperCase()]||ar.WHITE:e}function lr(e,t){if(!e)throw new Error(t||"Assertion failed")}function dr(){let e;var t,r;if(er&&"performance"in rr)e=null==rr||null===(t=rr.performance)||void 0===t||null===(r=t.now)||void 0===r?void 0:r.call(t);else if("hrtime"in nr){var n;const t=null==nr||null===(n=nr.hrtime)||void 0===n?void 0:n.call(nr);e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}!function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"}(ar||(ar={}));const ur={debug:er&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},hr={enabled:!0,level:0};function fr(){}const pr={},gr={once:!0};class yr{constructor(){let{id:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:""};I(this,"id",void 0),I(this,"VERSION",ir),I(this,"_startTs",dr()),I(this,"_deltaTs",dr()),I(this,"_storage",void 0),I(this,"userData",{}),I(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new or("__probe-".concat(this.id,"__"),hr),this.timeStamp("".concat(this.id," started")),function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"];const r=Object.getPrototypeOf(e),n=Object.getOwnPropertyNames(r);for(const r of n)"function"==typeof e[r]&&(t.find(e=>r===e)||(e[r]=e[r].bind(e)))}(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((dr()-this._startTs).toPrecision(10))}getDelta(){return Number((dr()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){return this._storage.setConfiguration({enabled:!(arguments.length>0&&void 0!==arguments[0])||arguments[0]}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){lr(e,t)}warn(e){return this._getLogFunction(0,e,ur.warn,arguments,gr)}error(e){return this._getLogFunction(0,e,ur.error,arguments)}deprecated(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}removed(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}probe(e,t){return this._getLogFunction(e,t,ur.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,ur.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];return this._getLogFunction(e,t,ur.debug||ur.info,arguments,gr)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||fr,r&&[r],{tag:wr(t)}):fr}image(e){let{logLevel:t,priority:r,image:n,message:i="",scale:o=1}=e;return this._shouldLog(t||r)?er?function(e){let{image:t,message:r="",scale:n=1}=e;if("string"==typeof t){const e=new Image;return e.onload=()=>{const t=sr(e,r,n);console.log(...t)},e.src=t,fr}const i=t.nodeName||"";if("img"===i.toLowerCase())return console.log(...sr(t,r,n)),fr;if("canvas"===i.toLowerCase()){const e=new Image;return e.onload=()=>console.log(...sr(e,r,n)),e.src=t.toDataURL(),fr}return fr}({image:n,message:i,scale:o}):(console.warn("removed"),fr):fr}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||fr)}group(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1};const n=vr({logLevel:e,message:t,opts:r}),{collapsed:i}=r;return n.method=(i?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,t){return this.group(e,t,Object.assign({},arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||fr)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=mr(e)}_getLogFunction(e,t,r,n,i){if(this._shouldLog(e)){i=vr({logLevel:e,message:t,args:n,opts:i}),lr(r=r||i.method),i.total=this.getTotal(),i.delta=this.getDelta(),this._deltaTs=dr();const o=i.tag||i.message;if(i.once){if(pr[o])return fr;pr[o]=dr()}return t=function(e,t,r){if("string"==typeof t){const s=r.time?function(e){const t=Math.max((arguments.length>1&&void 0!==arguments[1]?arguments[1]:8)-e.length,0);return"".concat(" ".repeat(t)).concat(e)}(function(e){let t;return t=e<10?"".concat(e.toFixed(2),"ms"):e<100?"".concat(e.toFixed(1),"ms"):e<1e3?"".concat(e.toFixed(0),"ms"):"".concat((e/1e3).toFixed(2),"s"),t}(r.total)):"";n=t=r.time?"".concat(e,": ").concat(s,"  ").concat(t):"".concat(e,": ").concat(t),i=r.color,o=r.background,er||"string"!=typeof n||(i&&(i=cr(i),n="[".concat(i,"m").concat(n,"[39m")),o&&(i=cr(o),n="[".concat(o+10,"m").concat(n,"[49m"))),t=n}var n,i,o;return t}(this.id,i.message,i),r.bind(console,t,...i.args)}return fr}}function mr(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return lr(Number.isFinite(t)&&t>=0),t}function vr(e){const{logLevel:t,message:r}=e;e.logLevel=mr(t);const n=e.args?Array.from(e.args):[];for(;n.length&&n.shift()!==r;);switch(typeof t){case"string":case"function":void 0!==r&&n.unshift(r),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());const i=typeof e.message;return lr("string"===i||"object"===i),Object.assign(e,{args:n},e.opts)}function wr(e){for(const t in e)for(const r in e[t])return r||"untitled";return"empty"}I(yr,"VERSION",ir);const br=new yr({id:"loaders.gl"});class _r{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}const xr={fetch:null,mimeType:void 0,nothrow:!1,log:new class{constructor(){I(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.log.bind(this.console,...t)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.info.bind(this.console,...t)}warn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.warn.bind(this.console,...t)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.error.bind(this.console,...t)}},CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:S,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},kr={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Sr(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state=e._state||{},e._state}const Mr=()=>{const e=Sr();return e.globalOptions=e.globalOptions||{...xr},e.globalOptions};function Er(e,t){const r=Mr(),n=e||r;return"function"==typeof n.fetch?n.fetch:Ut(n.fetch)?e=>$t(e,n):null!=t&&t.fetch?null==t?void 0:t.fetch:$t}function Tr(e,t,r,n,i){const o=t||"Top level",s=t?"".concat(t,"."):"";for(const a in e){const c=!t&&Ut(e[a]);if(!(a in r)&&("baseUri"!==a||t)&&("workerUrl"!==a||!t))if(a in n)br.warn("".concat(o," loader option '").concat(s).concat(a,"' no longer supported, use '").concat(n[a],"'"))();else if(!c){const e=Dr(a,i);br.warn("".concat(o," loader option '").concat(s).concat(a,"' not recognized. ").concat(e))()}}}function Dr(e,t){const r=e.toLowerCase();let n="";for(const i of t)for(const t in i.options){if(e===t)return"Did you mean '".concat(i.id,".").concat(t,"'?");const o=t.toLowerCase();(r.startsWith(o)||o.startsWith(r))&&(n=n||"Did you mean '".concat(i.id,".").concat(t,"'?"))}return n}function Ar(e,t){for(const r in t)r in t&&(e[r]=Ft(t[r])&&Ft(e[r])?{...e[r],...t[r]}:t[r])}function Br(e){var t;return!!e&&(Array.isArray(e)&&(e=e[0]),Array.isArray(null===(t=e)||void 0===t?void 0:t.extensions))}function jr(e){var t,r;let n;return k(e,"null loader"),k(Br(e),"invalid loader"),Array.isArray(e)&&(n=e[1],e=e[0],e={...e,options:{...e.options,...n}}),(null!==(t=e)&&void 0!==t&&t.parseTextSync||null!==(r=e)&&void 0!==r&&r.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}const Ir=()=>{const e=Sr();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry},Or=new yr({id:"loaders.gl"}),Cr=/\.([^.]+)$/;function Pr(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!Rr(e))return null;if(t&&!Array.isArray(t))return jr(t);let i=[];t&&(i=i.concat(t)),null!=r&&r.ignoreRegisteredLoaders||i.push(...Ir()),function(e){for(const t of e)jr(t)}(i);const o=function(e,t,r,n){const{url:i,type:o}=Yt(e),s=i||(null==n?void 0:n.url);let a=null,c="";var l;return null!=r&&r.mimeType&&(a=Fr(t,null==r?void 0:r.mimeType),c="match forced by supplied MIME type ".concat(null==r?void 0:r.mimeType)),a=a||function(e,t){const r=t&&Cr.exec(t),n=r&&r[1];return n?function(e,t){t=t.toLowerCase();for(const r of e)for(const e of r.extensions)if(e.toLowerCase()===t)return r;return null}(e,n):null}(t,s),c=c||(a?"matched url ".concat(s):""),a=a||Fr(t,o),c=c||(a?"matched MIME type ".concat(o):""),a=a||function(e,t){if(!t)return null;for(const r of e)if("string"==typeof t){if(zr(t,r))return r}else if(ArrayBuffer.isView(t)){if(Lr(t.buffer,t.byteOffset,r))return r}else if(t instanceof ArrayBuffer&&Lr(t,0,r))return r;return null}(t,e),c=c||(a?"matched initial data ".concat(Kr(e)):""),a=a||Fr(t,null==r?void 0:r.fallbackMimeType),c=c||(a?"matched fallback MIME type ".concat(o):""),c&&Or.log(1,"selectLoader selected ".concat(null===(l=a)||void 0===l?void 0:l.name,": ").concat(c,".")),a}(e,i,r,n);if(!(o||null!=r&&r.nothrow))throw new Error(Ur(e));return o}function Rr(e){return!(e instanceof Response&&204===e.status)}function Ur(e){const{url:t,type:r}=Yt(e);let n="No valid loader found (";n+=t?"".concat(function(e){const t=e&&e.lastIndexOf("/");return t>=0?e.substr(t+1):""}(t),", "):"no url provided, ",n+="MIME type: ".concat(r?'"'.concat(r,'"'):"not provided",", ");const i=e?Kr(e):"";return n+=i?' first bytes: "'.concat(i,'"'):"first bytes: not available",n+=")",n}function Fr(e,t){for(const r of e){if(r.mimeTypes&&r.mimeTypes.includes(t))return r;if(t==="application/x.".concat(r.id))return r}return null}function zr(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some(t=>e.startsWith(t))}function Lr(e,t,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(n=>function(e,t,r,n){if(n instanceof ArrayBuffer)return function(e,t,r){if(e.byteLength<(r=r||e.byteLength)||t.byteLength<r)return!1;const n=new Uint8Array(e),i=new Uint8Array(t);for(let e=0;e<n.length;++e)if(n[e]!==i[e])return!1;return!0}(n,e,n.byteLength);switch(typeof n){case"function":return n(e,r);case"string":return n===Nr(e,t,n.length);default:return!1}}(e,t,r,n))}function Kr(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return"string"==typeof e?e.slice(0,t):ArrayBuffer.isView(e)?Nr(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?Nr(e,0,t):""}function Nr(e,t,r){if(e.byteLength<t+r)return"";const n=new DataView(e);let i="";for(let e=0;e<r;e++)i+=String.fromCharCode(n.getUint8(t+e));return i}const Zr=262144,Gr=262144,Wr=1048576;function Hr(e,t){return S?async function*(e,t){const r=e.getReader();let n;try{for(;;){const e=n||r.read();null!=t&&t._streamReadAhead&&(n=r.read());const{done:i,value:o}=await e;if(i)return;yield oe(o)}}catch(e){r.releaseLock()}}(e,t):async function*(e,t){for await(const t of e)yield oe(t)}(e)}const Vr="Cannot convert supplied data type";async function Jr(e,t,r,n){M(!n||"object"==typeof n),!t||Array.isArray(t)||Br(t)||(n=void 0,r=t,t=void 0),e=await e,r=r||{};const{url:i}=Yt(e),o=function(e,t){if(!t&&e&&!Array.isArray(e))return e;let r;if(e&&(r=Array.isArray(e)?e:[e]),t&&t.loaders){const e=Array.isArray(t.loaders)?t.loaders:[t.loaders];r=r?[...r,...e]:e}return r&&r.length?r:null}(t,n),s=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!Rr(e))return null;let i=Pr(e,t,{...r,nothrow:!0},n);if(i)return i;if(Nt(e)&&(i=Pr(e=await e.slice(0,10).arrayBuffer(),t,r,n)),!(i||null!=r&&r.nothrow))throw new Error(Ur(e));return i}(e,o,r);return s?(n=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(r)return r;const n={fetch:Er(t,e),...e};return Array.isArray(n.loaders)||(n.loaders=null),n}({url:i,parse:Jr,loaders:o},r=function(e,t,r,n){return r=r||[],function(e,t){Tr(e,null,xr,kr,t);for(const r of t)Tr(e&&e[r.id]||{},r.id,r.options&&r.options[r.id]||{},r.deprecatedOptions&&r.deprecatedOptions[r.id]||{},t)}(e,r=Array.isArray(r)?r:[r]),function(e,t,r){const n={...e.options||{}};return function(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}(n,r),null===n.log&&(n.log=new _r),Ar(n,Mr()),Ar(n,t),n}(t,e,n)}(r,s,o,i),n),await async function(e,t,r,n){if(M(e,"no worker provided"),Kt(t)){const e=t,{ok:r,redirected:i,status:o,statusText:s,type:a,url:c}=e,l=Object.fromEntries(e.headers.entries());n.response={headers:l,ok:r,redirected:i,status:o,statusText:s,type:a,url:c}}if(t=await async function(e,t,r){const n=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||n)return function(e,t,r){if(t.text&&"string"==typeof e)return e;if(Zt(e)&&(e=e.buffer),e instanceof ArrayBuffer){const r=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let r=e.buffer;const n=e.byteLength||e.length;return 0===e.byteOffset&&n===r.byteLength||(r=r.slice(e.byteOffset,e.byteOffset+n)),r}throw new Error(Vr)}(e,t);if(Nt(e)&&(e=await Xt(e)),Kt(e)){const r=e;return await async function(e){if(!e.ok){const t=await async function(e){let t="Failed to fetch resource ".concat(e.url," (").concat(e.status,"): ");try{const r=e.headers.get("Content-Type");let n=e.statusText;r.includes("application/json")&&(n+=" ".concat(await e.text())),t+=n,t=t.length>60?"".concat(t.slice(0,60),"..."):t}catch(e){}return t}(e);throw new Error(t)}}(r),t.binary?await r.arrayBuffer():await r.text()}if(Gt(e)&&(e=function(e,t){if("string"==typeof e)return function*(e,t){const r=(null==t?void 0:t.chunkSize)||Zr;let n=0;const i=new TextEncoder;for(;n<e.length;){const t=Math.min(e.length-n,r),o=e.slice(n,n+t);n+=t,yield i.encode(o)}}(e,t);if(e instanceof ArrayBuffer)return function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{chunkSize:r=Gr}=t;let n=0;for(;n<e.byteLength;){const t=Math.min(e.byteLength-n,r),i=new ArrayBuffer(t),o=new Uint8Array(e,n,t);new Uint8Array(i).set(o),n+=t,yield i}}(e,t);if(Nt(e))return async function*(e,t){const r=(null==t?void 0:t.chunkSize)||Wr;let n=0;for(;n<e.size;){const t=n+r,i=await e.slice(n,t).arrayBuffer();n=t,yield i}}(e,t);if(Gt(e))return Hr(e,t);if(Kt(e))return Hr(e.body,t);throw new Error("makeIterator")}(e,r)),zt(e)||Lt(e))return async function(e){const t=[];for await(const r of e)t.push(r);return te(...t)}(e);throw new Error(Vr)}(t,e,r),e.parseTextSync&&"string"==typeof t)return r.dataType="text",e.parseTextSync(t,r,n,e);if(function(e,t){return!!G.isSupported()&&!!(D||null!=t&&t._nodeWorkers)&&e.worker&&(null==t?void 0:t.worker)}(e,r))return await $(e,t,r,n,Jr);if(e.parseText&&"string"==typeof t)return await e.parseText(t,r,n,e);if(e.parse)return await e.parse(t,r,n,e);throw M(!e.parseSync),new Error("".concat(e.id," loader - no parser found and worker is disabled"))}(s,e,r,n)):null}async function qr(e,t,r){if(function(e,t){return!!G.isSupported()&&!!(S||null!=t&&t._nodeWorkers)&&e.worker&&(null==t?void 0:t.worker)}(t,r={...Mr(),...r}))return await J(t,e,r);if(t.encode)return await t.encode(e,r);if(t.encodeSync)return t.encodeSync(e,r);if(t.encodeText)return(new TextEncoder).encode(await t.encodeText(e,r));if(t.encodeInBatches){const n=function(e,t,r){if(t.encodeInBatches){const n=function(e){return[{table:e,start:0,end:e.length}]}(e);return t.encodeInBatches(n,r)}throw new Error("Writer could not encode data in batches")}(e,t,r),i=[];for await(const e of n)i.push(e);return te(...i)}if(!S&&t.encodeURLtoURL){const n=Yr("input");await async function(e,t,r){e=ie(e),S||await(void 0)(e,t,{flag:"w"}),k(!1)}(n,e);const i=Yr("output"),o=await async function(e,t,r,n){if(e=ie(e),t=ie(t),S||!r.encodeURLtoURL)throw new Error;return await r.encodeURLtoURL(e,t,n)}(n,i,t,r);return(await $t(o)).arrayBuffer()}throw new Error("Writer could not encode data")}function Yr(e){return"/tmp/".concat(e)}var Qr={0:{useSRGB:!0,qualityLevel:50,encodeUASTC:!0,mipmaps:!0},3:{useSRGB:!0,encodeUASTC:!0,qualityLevel:10,mipmaps:!1},1:{useSRGB:!1,encodeUASTC:!0,qualityLevel:50,mipmaps:!0},2:{useSRGB:!1,encodeUASTC:!0,qualityLevel:10,mipmaps:!1},4:{useSRGB:!1,encodeUASTC:!0,qualityLevel:10,mipmaps:!1}},Xr=/*#__PURE__*/c("texturesList"),$r=/*#__PURE__*/c("numObjects"),en=/*#__PURE__*/c("meshUsedByObject"),tn=/*#__PURE__*/c("removeUnusedTextures"),rn=/*#__PURE__*/c("compressTextures"),nn=/*#__PURE__*/function(r){function n(n,i){var o;return o=r.call(this,n,{id:i.id})||this,Object.defineProperty(s(o),rn,{value:sn}),Object.defineProperty(s(o),tn,{value:on}),o.scene=void 0,o.layerId=void 0,o.built=void 0,o.edgeThreshold=void 0,o.geometries=void 0,o.textures=void 0,o.textureSets=void 0,o.meshes=void 0,o.objects=void 0,o.aabb=void 0,o.onBuilt=void 0,o.rendererModel=void 0,Object.defineProperty(s(o),Xr,{writable:!0,value:void 0}),Object.defineProperty(s(o),$r,{writable:!0,value:void 0}),Object.defineProperty(s(o),en,{writable:!0,value:void 0}),o.scene=n,o.onBuilt=new e.EventEmitter(new t.EventDispatcher),o.onDestroyed=new e.EventEmitter(new t.EventDispatcher),l(s(o),$r)[$r]=0,l(s(o),en)[en]={},o.id=i.id||"default",o.layerId=i.layerId,o.edgeThreshold=10,o.geometries={},o.textures={},l(s(o),Xr)[Xr]=[],o.textureSets={},o.meshes={},o.objects={},o.aabb=qe(),o.built=!1,o.rendererModel=null,o.fromJSON(i),o}i(n,r);var o=n.prototype;return o.fromJSON=function(t){if(this.destroyed)return new e.SDKError("Failed to add components to SceneModel - SceneModel already destroyed");if(this.built)return new e.SDKError("Failed to add components to SceneModel - SceneModel already built");if(t.geometries)for(var r=0,n=t.geometries.length;r<n;r++)this.createGeometry(t.geometries[r]);if(t.textures)for(var i=0,o=t.textures.length;i<o;i++)this.createTexture(t.textures[i]);if(t.textureSets)for(var s=0,a=t.textureSets.length;s<a;s++)this.createTextureSet(t.textureSets[s]);if(t.meshes)for(var c=0,l=t.meshes.length;c<l;c++)this.createMesh(t.meshes[c]);if(t.objects)for(var d=0,u=t.objects.length;d<u;d++)this.createObject(t.objects[d])},o.createTransform=function(t){return this.destroyed?new e.SDKError("Failed to create Transform in SceneModel - SceneModel already destroyed"):this.built?new e.SDKError("Failed to create Transform in SceneModel - SceneModel already built"):void 0},o.createTexture=function(t){if(this.destroyed)return new e.SDKError("Failed to create Texture in SceneModel - SceneModel already destroyed");if(this.built)return new e.SDKError("Failed to create Texture in SceneModel - SceneModel already built");if(!t.imageData&&!t.src&&!t.buffers)return new e.SDKError("Failed to create Texture in SceneModel - Parameter expected: textureParams.imageData, textureParams.src or textureParams.buffers");if(this.textures[t.id])return new e.SDKError("Failed to create Texture in SceneModel - Texture already exists with this ID: "+t.id);t.src&&t.src.split(".").pop();var r=new ct(t);return this.textures[t.id]=r,l(this,Xr)[Xr].push(r),r},o.createTextureSet=function(t){if(this.destroyed)return new e.SDKError("Failed to create TextureSet in SceneModel - SceneModel already destroyed");if(this.built)return new e.SDKError("Failed to create TextureSet in SceneModel - SceneModel already built");if(this.textureSets[t.id])return new e.SDKError("Failed to create TextureSet in SceneModel - TextureSet already exists with this ID: "+t.id);var r,n,i,o,s;if(null!=t.colorTextureId){if(!(r=this.textures[t.colorTextureId]))return new e.SDKError("Failed to create TextureSet in SceneModel - Texture not found: "+t.colorTextureId+" - ensure that you create it first with createTexture()");r.channel=0}if(null!=t.metallicRoughnessTextureId){if(!(n=this.textures[t.metallicRoughnessTextureId]))return new e.SDKError("Failed to create TextureSet in SceneModel - Texture not found: "+t.metallicRoughnessTextureId+" - ensure that you create it first with createTexture()");n.channel=1}if(null!=t.normalsTextureId){if(!(i=this.textures[t.normalsTextureId]))return new e.SDKError("Failed to create TextureSet in SceneModel - Texture not found: "+t.normalsTextureId+" - ensure that you create it first with createTexture()");i.channel=2}if(null!=t.emissiveTextureId){if(!(o=this.textures[t.emissiveTextureId]))return new e.SDKError("Failed to create TextureSet in SceneModel - Texture not found: "+t.emissiveTextureId+" - ensure that you create it first with createTexture()");o.channel=3}if(null!=t.occlusionTextureId){if(!(s=this.textures[t.occlusionTextureId]))return new e.SDKError("Failed to create TextureSet in SceneModel - Texture not found: "+t.occlusionTextureId+" - ensure that you create it first with createTexture()");s.channel=4}var a=new at(t,{emissiveTexture:o,occlusionTexture:s,metallicRoughnessTexture:n,colorTexture:r});return this.textureSets[t.id]=a,a},o.createGeometry=function(t){if(this.destroyed)return new e.SDKError("Failed to create Geometry in SceneModel - SceneModel already destroyed");if(this.built)return new e.SDKError("Failed to create Geometry in SceneModel - SceneModel already built");if(!t)return new e.SDKError("Failed to create Geometry in SceneModel - Parameters expected: geometryParams");if(null==t.id)return new e.SDKError("Failed to create Geometry in SceneModel - Parameter expected: geometryParams.id");var r=t.id;if(this.geometries[r])return new e.SDKError("Failed to create Geometry in SceneModel - Geometry with this ID already created: "+r);var n=t.primitive;if(n!==Be&&n!==je&&n!==Ie&&n!==Oe&&n!==Ce)return new e.SDKError("Failed to create Geometry in SceneModel - Unsupported value for geometryParams.primitive: '"+n+"' - supported values are PointsPrimitive, LinesPrimitive, TrianglesPrimitive, SolidPrimitive and SurfacePrimitive");if(!t.positions)return new e.SDKError("Failed to create Geometry in SceneModel - Param expected: geometryParams.positions");if(!t.indices&&n!==Be)return new e.SDKError("Failed to create Geometry in SceneModel - Param expected: geometryParams.indices (required for primitive type)");if(t.uvs&&t.uvs.length/2!=t.positions.length/3)return new e.SDKError("Failed to create Geometry in SceneModel - mismatch between given quantities of vertex positions and UVs");if(t.indices)for(var i=t.positions.length/3,o=0,s=t.indices.length;o<s;o++){var a=t.indices[o];if(a<0||a>=i)return new e.SDKError("Failed to create Geometry in SceneModel - indices out of range of vertex positions");if(t.uvs&&(a<0||a>=t.uvs.length/2))return new e.SDKError("Failed to create Geometry in SceneModel - indices out of range of vertex UVs")}var c=new $e(function(e){var t=Ge(),r=Ye();Qe(r,e.positions);var n,i=function(e,t,r){for(var n=e.length,i=new Uint16Array(n),o=t[0],s=t[1],a=t[2],c=t[3]-o,l=t[4]-s,d=t[5]-a,u=65525,h=u/c,f=u/l,p=u/d,g=function(e){return e>=0?e:0},y=0;y<n;y+=3)i[y+0]=Math.floor(g(e[y+0]-o)*h),i[y+1]=Math.floor(g(e[y+1]-s)*f),i[y+2]=Math.floor(g(e[y+2]-a)*p);return We(He),function(e,t){var r=He||We();r[12]=e[0],r[13]=e[1],r[14]=e[2]}(t),We(Ve),function(e,t){void 0===t&&(t=We()),t[0]=e[0],t[5]=e[1],t[10]=e[2]}([c/u,l/u,d/u],Ve),function(e,t,r){r||(r=He);var n=He[0],i=He[1],o=He[2],s=He[3],a=He[4],c=He[5],l=He[6],d=He[7],u=He[8],h=He[9],f=He[10],p=He[11],g=He[12],y=He[13],m=He[14],v=He[15],w=Ve[0],b=Ve[1],_=Ve[2],x=Ve[3],k=Ve[4],S=Ve[5],M=Ve[6],E=Ve[7],T=Ve[8],D=Ve[9],A=Ve[10],B=Ve[11],j=Ve[12],I=Ve[13],O=Ve[14],C=Ve[15];r[0]=w*n+b*a+_*u+x*g,r[1]=w*i+b*c+_*h+x*y,r[2]=w*o+b*l+_*f+x*m,r[3]=w*s+b*d+_*p+x*v,r[4]=k*n+S*a+M*u+E*g,r[5]=k*i+S*c+M*h+E*y,r[6]=k*o+S*l+M*f+E*m,r[7]=k*s+S*d+M*p+E*v,r[8]=T*n+D*a+A*u+B*g,r[9]=T*i+D*c+A*h+B*y,r[10]=T*o+D*l+A*f+B*m,r[11]=T*s+D*d+A*p+B*v,r[12]=j*n+I*a+O*u+C*g,r[13]=j*i+I*c+O*h+C*y,r[14]=j*o+I*l+O*f+C*m,r[15]=j*s+I*d+O*p+C*v}(0,0,r),i}(e.positions,r,t),o=e.primitive!==Oe&&e.primitive!==Ce&&e.primitive!==Ie||!e.indices?null:function(e,t,r,n){!function(e,t){var r,n,i,o,s,a,c={},l=Math.pow(10,4),d=0;for(s=0,a=e.length;s<a;s+=3)r=e[s],n=e[s+1],i=e[s+2],void 0===c[o=Math.round(r*l)+"_"+Math.round(n*l)+"_"+Math.round(i*l)]&&(c[o]=d/3,gt[d++]=r,gt[d++]=n,gt[d++]=i),yt[s/3]=c[o];for(s=0,a=t.length;s<a;s++)vt[s]=yt[t[s]],mt[vt[s]]=t[s]}(e,t),function(e,t){bt=0;for(var r=0,n=e;r<n;r+=3){var i=3*vt[r],o=3*vt[r+1],s=3*vt[r+2];t?(_t[0]=gt[i],_t[1]=gt[i+1],_t[2]=gt[i+2],xt[0]=gt[o],xt[1]=gt[o+1],xt[2]=gt[o+2],kt[0]=gt[s],kt[1]=gt[s+1],kt[2]=gt[s+2],Je(_t,t,St),Je(xt,t,Mt),Je(kt,t,Et)):(St[0]=gt[i],St[1]=gt[i+1],St[2]=gt[i+2],Mt[0]=gt[o],Mt[1]=gt[o+1],Mt[2]=gt[o+2],Et[0]=gt[s],Et[1]=gt[s+1],Et[2]=gt[s+2]),Le(Et,Mt,Tt),Le(St,Mt,Dt),Ke(Tt,Dt,At),Ze(At,Bt);var a=wt[bt]||(wt[bt]={normal:Ue()});a.normal[0]=Bt[0],a.normal[1]=Bt[1],a.normal[2]=Bt[2],bt++}}(t.length,r);for(var i,o,s,a,c,l,d,u,h=[],f=Math.cos(.0174532925*10),p={},g=!1,y=0,m=t.length;y<m;y+=3)for(var v=y/3,w=0;w<3;w++)i=vt[y+w],o=vt[y+(w+1)%3],void 0===p[c=(s=Math.min(i,o))+","+(a=Math.max(i,o))]?p[c]={index1:s,index2:a,face1:v,face2:void 0}:p[c].face2=v;for(c in p)void 0!==(l=p[c]).face2&&Pe(wt[l.face1].normal,wt[l.face2].normal)>f||(d=mt[l.index1],u=mt[l.index2],(!g&&d>65535||u>65535)&&(g=!0),h.push(d),h.push(u));return g?new Uint32Array(h):new Uint16Array(h)}(i,e.indices,t),s=function(e){var t=e.positionsCompressed,r=e.indices,n=e.edgeIndices;!function(e){if(!(null!==Ot&&Ot.length>=e)){Ot=new Uint32Array(e);for(var t=0;t<e;t++)Ot[t]=t}}(t.length/3);var i=Ot.slice(0,t.length/3),o=Ot.slice(0,t.length/3);jt=t,i.sort(It);var s=0;o[i[0]]=0;for(var a=1,c=i.length;a<c;a++)0!=It(i[a],i[a-1])&&s++,o[i[a]]=s;var l=new Uint16Array(3*(s+1));l[3*(s=0)+0]=t[3*i[0]+0],l[3*s+1]=t[3*i[0]+1],l[3*s+2]=t[3*i[0]+2];for(var d=1,u=i.length;d<u;d++)0!==It(i[d],i[d-1])&&(l[3*++s+0]=t[3*i[d]+0],l[3*s+1]=t[3*i[d]+1],l[3*s+2]=t[3*i[d]+2]),o[i[d]]=s;jt=null;for(var h,f=new Uint32Array(r.length),p=0,g=r.length;p<g;p++)f[p]=o[r[p]];if(n){h=new Uint32Array(n.length);for(var y=0,m=n.length;y<m;y++)h[y]=o[n[y]]}return[l,f,h]}({positionsCompressed:i,uvs:e.uvs,indices:e.indices,edgeIndices:o}),a=function(e,t,r){void 0===r&&(r=!1);var n=e.positionsCompressed||[],i=function(e,t){for(var r=new Int32Array(e.length/3),n=0,i=r.length;n<i;n++)r[n]=n;Ct=new Int32Array(e.length);for(var o=0,s=e.length;o<s;o++)Ct[o]=e[o]>>t;r.sort(Pt);for(var a=new Int32Array(e.length),c=0,l=r.length;c<l;c++)a[3*c+0]=e[3*r[c]+0],a[3*c+1]=e[3*r[c]+1],a[3*c+2]=e[3*r[c]+2];return a}(e.indices||[],t),o=[];function s(e,t){if(e>t){var r=e;e=t,t=r}function n(r,n){return r!=e?e-r:n!=t?t-n:0}for(var i=0,s=(o.length>>1)-1;i<=s;){var a=s+i>>1,c=n(o[2*a],o[2*a+1]);if(c>0)i=a+1;else{if(!(c<0))return a;s=a-1}}return-i-1}var a=new Int32Array(o.length/2);a.fill(0);var c=n.length/3;if(c>8*(1<<t))return[e];var l=new Int32Array(c);l.fill(-1);var d=[];function u(){l.fill(-1);var e={positionsCompressed:[],indices:[],edgeIndices:[],maxNumPositions:(1<<t)-t,numPositions:0,bucketNumber:d.length};return d.push(e),e}for(var h=u(),f=0,p=i.length;f<p;f+=3){var g=0,y=i[f],m=i[f+1],v=i[f+2];if(-1==l[y]&&g++,-1==l[m]&&g++,-1==l[v]&&g++,g+h.numPositions>h.maxNumPositions&&(h=u()),h.bucketNumber>8)return[e];-1==l[y]&&(l[y]=h.numPositions++,h.positionsCompressed.push(n[3*y]),h.positionsCompressed.push(n[3*y+1]),h.positionsCompressed.push(n[3*y+2])),-1==l[m]&&(l[m]=h.numPositions++,h.positionsCompressed.push(n[3*m]),h.positionsCompressed.push(n[3*m+1]),h.positionsCompressed.push(n[3*m+2])),-1==l[v]&&(l[v]=h.numPositions++,h.positionsCompressed.push(n[3*v]),h.positionsCompressed.push(n[3*v+1]),h.positionsCompressed.push(n[3*v+2])),h.indices.push(l[y]),h.indices.push(l[m]),h.indices.push(l[v]);var w=void 0;(w=s(y,m))>=0&&0==a[w]&&(a[w]=1,h.edgeIndices.push(l[o[2*w]]),h.edgeIndices.push(l[o[2*w+1]])),(w=s(y,v))>=0&&0==a[w]&&(a[w]=1,h.edgeIndices.push(l[o[2*w]]),h.edgeIndices.push(l[o[2*w+1]])),(w=s(m,v))>=0&&0==a[w]&&(a[w]=1,h.edgeIndices.push(l[o[2*w]]),h.edgeIndices.push(l[o[2*w+1]]))}var b=t/8,_=2*n.length+(i.length+o.length)*(t/8*2),x=0;return d.forEach(function(e){x+=2*e.positionsCompressed.length+(e.indices.length+e.edgeIndices.length)*b}),x>_?[e]:(r&&function(e,t){var r={};e.forEach(function(e){for(var t=e.indices,n=e.edgeIndices,i=e.positionsCompressed,o=0,s=t.length;o<s;o+=3)r[i[3*t[o]]+"_"+i[3*t[o]+1]+"_"+i[3*t[o]+2]+"/"+i[3*t[o+1]]+"_"+i[3*t[o+1]+1]+"_"+i[3*t[o+1]+2]+"/"+i[3*t[o+2]]+"_"+i[3*t[o+2]+1]+"_"+i[3*t[o+2]+2]]=!0;for(o=0,s=n.length;o<s;o+=2);});for(var n=t.indices,i=t.positionsCompressed,o=0,s=n.length;o<s;o+=3){var a=i[3*n[o]]+"_"+i[3*n[o]+1]+"_"+i[3*n[o]+2]+"/"+i[3*n[o+1]]+"_"+i[3*n[o+1]+1]+"_"+i[3*n[o+1]+2]+"/"+i[3*n[o+2]]+"_"+i[3*n[o+2]+1]+"_"+i[3*n[o+2]+2];if(!(a in r))throw console.log("Not found "+a),"Ohhhh!"}}(d,e),d)}({positionsCompressed:n=s[0],indices:s[1],edgeIndices:s[2]},n.length/3>65536?16:8);return{id:e.id,primitive:e.primitive===Oe&&a.length>1?Ie:e.primitive,aabb:r,positionsDecompressMatrix:t,uvsDecompressMatrix:void 0,geometryBuckets:a}}(t));return this.geometries[r]=c,c},o.createGeometryCompressed=function(t){if(this.destroyed)return new e.SDKError("Failed to add compressed Geometry to SceneModel - SceneModel already destroyed");if(this.built)return new e.SDKError("Failed to add compressed Geometry to SceneModel - SceneModel already built");if(!t)return new e.SDKError("Failed to add compressed Geometry to SceneModel - Parameters expected: geometryCompressedParams");var r=t.id;if(this.geometries[r])return new e.SDKError("Failed to add compressed Geometry to SceneModel - Geometry with this ID already created: "+r);var n=t.primitive;if(n!==Be&&n!==je&&n!==Ie&&n!==Oe&&n!==Ce)return new e.SDKError("Failed to add compressed Geometry to SceneModel - Unsupported value for geometryCompressedParams.primitive: '"+n+"' - supported values are PointsPrimitive, LinesPrimitive, TrianglesPrimitive, SolidPrimitive and SurfacePrimitive");var i=new $e(t);return this.geometries[r]=i,i},o.createMesh=function(t){if(this.destroyed)return new e.SDKError("Failed to create Mesh in SceneModel - SceneModel already destroyed");if(this.built)return new e.SDKError("Failed to create Mesh in SceneModel - SceneModel already built");if(this.meshes[t.id])return new e.SDKError("Failed to create Mesh in SceneModel - Mesh already exists with this ID: "+t.id);var r=this.geometries[t.geometryId];if(!r)return new e.SDKError("Failed to create Mesh in SceneModel - Geometry not found: "+t.geometryId);var n=t.textureSetId?this.textureSets[t.textureSetId]:void 0;if(t.textureSetId&&!n)return new e.SDKError("Failed to create Mesh in SceneModel - TextureSet not found: "+t.textureSetId);var i=new pt({id:t.id,geometry:r,textureSet:n,matrix:t.matrix,color:t.color,opacity:t.opacity,roughness:t.roughness,metallic:t.metallic});return this.meshes[t.id]=i,i},o.createObject=function(t){if(this.destroyed)return new e.SDKError("Failed to create SceneObject - SceneModel already destroyed");if(this.built)return new e.SDKError("Failed to create SceneObject SceneModel already built");if(0===t.meshIds.length)return new e.SDKError("Failed to create SceneObject - no meshes specified");if(this.scene.objects[t.id])return new e.SDKError("Failed to create SceneObject - SceneObject already exists in Scene: "+t.id);for(var r=t.meshIds,n=[],i=0,o=r.length;i<o;i++){var s=r[i],a=this.meshes[s];if(!a)return new e.SDKError("Failed to create SceneObject - Mesh not found: "+s);if(l(this,en)[en][s])return new e.SDKError("Failed to create SceneObject - Mesh "+s+" already belongs to another SceneObject");n.push(a),l(this,en)[en][a.id]=!0}for(var c=new st({id:t.id,layerId:t.layerId||this.layerId,model:this,meshes:n}),d=0,u=n.length;d<u;d++)n[d].object=c;return l(this,$r)[$r]++,this.objects[t.id]=c,c},o.build=function(){try{var t=this;return Promise.resolve(new Promise(function(r){if(t.destroyed)throw new e.SDKError("Failed to build SceneModel - SceneModel already destroyed");if(t.built)throw new e.SDKError("Failed to build SceneModel - SceneModel already built");l(t,tn)[tn](),l(t,rn)[rn]().then(function(){t.built=!0,t.onBuilt.dispatch(t,null),r(t)}).catch(function(e){throw e})}))}catch(e){return Promise.reject(e)}},n}(e.Component);function on(){}function sn(){var t=this,r=l(this,Xr)[Xr].length;return new Promise(function(n){if(0!==r)for(var i=function(){var i=l(t,Xr)[Xr][o],s=Qr[i.channel]||{};if(i.src){var a=i.src;switch(a.split(".").pop()){case"jpeg":case"jpg":case"png":(async function(e,t,r,n){Array.isArray(t)||Br(t)||(r=t,t=void 0);const i=Er(r);let o=e;return"string"==typeof e&&(o=await i(e)),Nt(e)&&(o=await i(e)),await Jr(o,t,r)})(a,Te,{image:{type:"data"}}).then(function(t){i.compressed?qr(t,de,s).then(function(e){var t=new Uint8Array(e);i.imageData=t,--r<=0&&n()}).catch(function(t){return new e.SDKError("Failed to compress texture: "+t)}):(i.imageData=new Uint8Array(1),--r<=0&&n())}).catch(function(t){return new e.SDKError("Failed to load texture image: "+t)});break;default:--r<=0&&n()}}i.imageData&&(i.compressed?qr(i.imageData,de,s).then(function(e){i.imageData=new Uint8Array(e),--r<=0&&n()}).catch(function(t){return new e.SDKError("Failed to compress texture: "+t)}):(i.imageData=new Uint8Array(1),--r<=0&&n()))},o=0,s=l(t,Xr)[Xr].length;o<s;o++)i();else n()})}var an,cn,ln=/*#__PURE__*/c("onModelBuilts"),dn=/*#__PURE__*/c("onModelDestroys"),un=/*#__PURE__*/c("center"),hn=/*#__PURE__*/c("aabbDirty"),fn=/*#__PURE__*/c("aabb"),pn=/*#__PURE__*/c("registerObjects"),gn=/*#__PURE__*/c("deregisterObjects"),yn=/*#__PURE__*/function(r){function o(){var n;return n=r.call(this,null,{})||this,Object.defineProperty(s(n),gn,{value:vn}),Object.defineProperty(s(n),pn,{value:mn}),n.models=void 0,n.objects=void 0,n.onModelCreated=void 0,n.onModelDestroyed=void 0,Object.defineProperty(s(n),ln,{writable:!0,value:void 0}),Object.defineProperty(s(n),dn,{writable:!0,value:void 0}),Object.defineProperty(s(n),un,{writable:!0,value:void 0}),Object.defineProperty(s(n),hn,{writable:!0,value:void 0}),Object.defineProperty(s(n),fn,{writable:!0,value:void 0}),l(s(n),fn)[fn]=qe(),l(s(n),hn)[hn]=!0,n.models={},n.objects={},l(s(n),ln)[ln]={},l(s(n),dn)[dn]={},n.onModelCreated=new e.EventEmitter(new t.EventDispatcher),n.onModelDestroyed=new e.EventEmitter(new t.EventDispatcher),n}i(o,r);var a=o.prototype;return a.createModel=function(t){var r=this;if(this.destroyed)return new e.SDKError("Scene already destroyed");var n=t.id;if(this.models[n])return new e.SDKError("SceneModel already created in this Scene: "+n);var i=new nn(this,t);return this.models[n]=i,i.onDestroyed.one(function(){delete r.models[i.id],l(r,gn)[gn](i),r.onModelDestroyed.dispatch(r,i)}),i.onBuilt.one(function(){l(r,pn)[pn](i),r.onModelCreated.dispatch(r,i)}),i},a.setAABBDirty=function(){l(this,hn)[hn]||(l(this,hn)[hn]=!0)},a.clear=function(){if(this.destroyed)return new e.SDKError("Scene already destroyed");for(var t in this.models)this.models[t].destroy()},a.destroy=function(){this.clear(),this.onModelCreated.clear(),this.onModelDestroyed.clear(),r.prototype.destroy.call(this)},n(o,[{key:"center",get:function(){if(l(this,hn)[hn]){var e=this.aabb;l(this,un)[un][0]=(e[0]+e[3])/2,l(this,un)[un][1]=(e[1]+e[4])/2,l(this,un)[un][2]=(e[2]+e[5])/2}return l(this,un)[un]}},{key:"aabb",get:function(){if(l(this,hn)[hn]){var e,t=x,r=x,n=x,i=_,o=_,s=_,a=this.objects,c=!1;for(var d in a)a.hasOwnProperty(d)&&((e=a[d].aabb)[0]<t&&(t=e[0]),e[1]<r&&(r=e[1]),e[2]<n&&(n=e[2]),e[3]>i&&(i=e[3]),e[4]>o&&(o=e[4]),e[5]>s&&(s=e[5]),c=!0);c||(t=-100,r=-100,n=-100,i=100,o=100,s=100),l(this,fn)[fn][0]=t,l(this,fn)[fn][1]=r,l(this,fn)[fn][2]=n,l(this,fn)[fn][3]=i,l(this,fn)[fn][4]=o,l(this,fn)[fn][5]=s,l(this,hn)[hn]=!1}return l(this,fn)[fn]}}]),o}(e.Component);function mn(e){var t=e.objects;for(var r in t){var n=t[r];this.objects[n.id]=n}l(this,hn)[hn]=!0}function vn(e){var t=e.objects;for(var r in t)delete this.objects[t[r].id];l(this,hn)[hn]=!0}function wn(e,t,r){r=r||2;var n,i,o,s,a,c,l,d=t&&t.length,u=d?t[0]*r:e.length,h=bn(e,0,u,r,!0),f=[];if(!h||h.next===h.prev)return f;if(d&&(h=function(e,t,r,n){var i,o,s,a=[];for(i=0,o=t.length;i<o;i++)(s=bn(e,t[i]*n,i<o-1?t[i+1]*n:e.length,n,!1))===s.next&&(s.steiner=!0),a.push(jn(s));for(a.sort(Tn),i=0;i<a.length;i++)Dn(a[i],r),r=_n(r,r.next);return r}(e,t,h,r)),e.length>80*r){n=o=e[0],i=s=e[1];for(var p=r;p<u;p+=r)(a=e[p])<n&&(n=a),(c=e[p+1])<i&&(i=c),a>o&&(o=a),c>s&&(s=c);l=0!==(l=Math.max(o-n,s-i))?1/l:0}return xn(h,f,r,n,i,l),f}function bn(e,t,r,n,i){var o,s;if(i===Gn(e,t,r,n)>0)for(o=t;o<r;o+=n)s=Kn(o,e[o],e[o+1],s);else for(o=r-n;o>=t;o-=n)s=Kn(o,e[o],e[o+1],s);return s&&Pn(s,s.next)&&(Nn(s),s=s.next),s}function _n(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!Pn(n,n.next)&&0!==Cn(n.prev,n,n.next))n=n.next;else{if(Nn(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function xn(e,t,r,n,i,o,s){if(e){!s&&o&&function(e,t,r,n){var i=e;do{null===i.z&&(i.z=Bn(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,o,s,a,c,l=1;do{for(r=e,e=null,o=null,s=0;r;){for(s++,n=r,a=0,t=0;t<l&&(a++,n=n.nextZ);t++);for(c=l;a>0||c>0&&n;)0!==a&&(0===c||!n||r.z<=n.z)?(i=r,r=r.nextZ,a--):(i=n,n=n.nextZ,c--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;r=n}o.nextZ=null,l*=2}while(s>1)}(i)}(e,n,i,o);for(var a,c,l=e;e.prev!==e.next;)if(a=e.prev,c=e.next,o?Sn(e,n,i,o):kn(e))t.push(a.i/r),t.push(e.i/r),t.push(c.i/r),Nn(e),e=c.next,l=c.next;else if((e=c)===l){s?1===s?xn(e=Mn(_n(e),t,r),t,r,n,i,o,2):2===s&&En(e,t,r,n,i,o):xn(_n(e),t,r,n,i,o,1);break}}}function kn(e){var t=e.prev,r=e,n=e.next;if(Cn(t,r,n)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(In(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&Cn(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Sn(e,t,r,n){var i=e.prev,o=e,s=e.next;if(Cn(i,o,s)>=0)return!1;for(var a=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,c=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,l=Bn(i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,t,r,n),d=Bn(a,c,t,r,n),u=e.prevZ,h=e.nextZ;u&&u.z>=l&&h&&h.z<=d;){if(u!==e.prev&&u!==e.next&&In(i.x,i.y,o.x,o.y,s.x,s.y,u.x,u.y)&&Cn(u.prev,u,u.next)>=0)return!1;if(u=u.prevZ,h!==e.prev&&h!==e.next&&In(i.x,i.y,o.x,o.y,s.x,s.y,h.x,h.y)&&Cn(h.prev,h,h.next)>=0)return!1;h=h.nextZ}for(;u&&u.z>=l;){if(u!==e.prev&&u!==e.next&&In(i.x,i.y,o.x,o.y,s.x,s.y,u.x,u.y)&&Cn(u.prev,u,u.next)>=0)return!1;u=u.prevZ}for(;h&&h.z<=d;){if(h!==e.prev&&h!==e.next&&In(i.x,i.y,o.x,o.y,s.x,s.y,h.x,h.y)&&Cn(h.prev,h,h.next)>=0)return!1;h=h.nextZ}return!0}function Mn(e,t,r){var n=e;do{var i=n.prev,o=n.next.next;!Pn(i,o)&&Rn(i,n,n.next,o)&&zn(i,o)&&zn(o,i)&&(t.push(i.i/r),t.push(n.i/r),t.push(o.i/r),Nn(n),Nn(n.next),n=e=o),n=n.next}while(n!==e);return _n(n)}function En(e,t,r,n,i,o){var s=e;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&On(s,a)){var c=Ln(s,a);return s=_n(s,s.next),c=_n(c,c.next),xn(s,t,r,n,i,o),void xn(c,t,r,n,i,o)}a=a.next}s=s.next}while(s!==e)}function Tn(e,t){return e.x-t.x}function Dn(e,t){if(t=function(e,t){var r,n=t,i=e.x,o=e.y,s=-Infinity;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var a=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=i&&a>s){if(s=a,a===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===s)return r;var c,l=r,d=r.x,u=r.y,h=Infinity;n=r;do{i>=n.x&&n.x>=d&&i!==n.x&&In(o<u?i:s,o,d,u,o<u?s:i,o,n.x,n.y)&&(c=Math.abs(o-n.y)/(i-n.x),zn(n,e)&&(c<h||c===h&&(n.x>r.x||n.x===r.x&&An(r,n)))&&(r=n,h=c)),n=n.next}while(n!==l);return r}(e,t),t){var r=Ln(t,e);_n(t,t.next),_n(r,r.next)}}function An(e,t){return Cn(e.prev,e,t.prev)<0&&Cn(t.next,e,e.next)<0}function Bn(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function jn(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function In(e,t,r,n,i,o,s,a){return(i-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(n-a)-(r-s)*(t-a)>=0&&(r-s)*(o-a)-(i-s)*(n-a)>=0}function On(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&Rn(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(zn(e,t)&&zn(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)&&(Cn(e.prev,e,t.prev)||Cn(e,t.prev,t))||Pn(e,t)&&Cn(e.prev,e,e.next)>0&&Cn(t.prev,t,t.next)>0)}function Cn(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Pn(e,t){return e.x===t.x&&e.y===t.y}function Rn(e,t,r,n){var i=Fn(Cn(e,t,r)),o=Fn(Cn(e,t,n)),s=Fn(Cn(r,n,e)),a=Fn(Cn(r,n,t));return i!==o&&s!==a||!(0!==i||!Un(e,r,t))||!(0!==o||!Un(e,n,t))||!(0!==s||!Un(r,e,n))||!(0!==a||!Un(r,t,n))}function Un(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function Fn(e){return e>0?1:e<0?-1:0}function zn(e,t){return Cn(e.prev,e,e.next)<0?Cn(e,t,e.next)>=0&&Cn(e,e.prev,t)>=0:Cn(e,t,e.prev)<0||Cn(e,e.next,t)<0}function Ln(e,t){var r=new Zn(e.i,e.x,e.y),n=new Zn(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function Kn(e,t,r,n){var i=new Zn(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Nn(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Zn(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Gn(e,t,r,n){for(var i=0,o=t,s=r-n;o<r;o+=n)i+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return i}wn.deviation=function(e,t,r,n){var i=t&&t.length,o=Math.abs(Gn(e,0,i?t[0]*r:e.length,r));if(i)for(var s=0,a=t.length;s<a;s++)o-=Math.abs(Gn(e,t[s]*r,s<a-1?t[s+1]*r:e.length,r));var c=0;for(s=0;s<n.length;s+=3){var l=n[s]*r,d=n[s+1]*r,u=n[s+2]*r;c+=Math.abs((e[l]-e[u])*(e[d+1]-e[l+1])-(e[l]-e[d])*(e[u+1]-e[l+1]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},wn.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var s=0;s<t;s++)r.vertices.push(e[i][o][s]);i>0&&r.holes.push(n+=e[i-1].length)}return r},(an={})[1e3]="BasicEntity",an[1001]="BasicAggregation",(cn={})[2e3]="Bridge",cn[2001]="BridgePart",cn[2002]="BridgeInstallation",cn[2003]="BridgeConstructiveElement",cn[2004]="BridgeRoom",cn[2005]="BridgeFurniture",cn[2006]="Building",cn[2007]="BuildingPart",cn[2008]="BuildingInstallation",cn[2009]="BuildingConstructiveElement",cn[2010]="BuildingFurniture",cn[2011]="BuildingStorey",cn[2012]="BuildingRoom",cn[2013]="BuildingUnit",cn[2014]="CityFurniture",cn[2015]="CityObjectGroup",cn[2016]="LandUse",cn[2017]="OtherConstruction",cn[2018]="PlantCover",cn[2019]="SolitaryVegetationObject",cn[2020]="TINRelief",cn[2021]="TransportationSquare",cn[2022]="Railway",cn[2023]="Road",cn[2024]="Tunnel",cn[2025]="TunnelPart",cn[2026]="TunnelInstallation",cn[2027]="TunnelInstallation",cn[2028]="TunnelHollowSpace",cn[2029]="TunnelFurniture",cn[2030]="WaterBody",cn[2031]="Waterway";var Wn={Bridge:2e3,BridgePart:2001,BridgeInstallation:2002,BridgeConstructiveElement:2003,BridgeRoom:2004,BridgeFurniture:2005,Building:2006,BuildingPart:2007,BuildingInstallation:2008,BuildingConstructiveElement:2009,BuildingFurniture:2010,BuildingStorey:2011,BuildingRoom:2012,BuildingUnit:2013,CityFurniture:2014,CityObjectGroup:2015,LandUse:2016,OtherConstruction:2017,PlantCover:2018,SolitaryVegetationObject:2019,TINRelief:2020,TransportationSquare:2021,Railway:2022,Road:2023,Tunnel:2024,TunnelPart:2025,TunnelInstallation:2026,TunnelConstructiveElement:2026,TunnelHollowSpace:2028,TunnelFurniture:2029,WaterBody:2030,Waterway:2031},Hn=Re(),Vn=Ue(),Jn=Ue(),qn=Ue();function Yn(e,t,r){for(var n=[],i=t.scale||Ue([1,1,1]),o=t.translate||Ue([0,0,0]),s=0,a=0;s<e.length;s++,a+=3){var c=e[s][0]*i[0]+o[0],l=e[s][1]*i[1]+o[1],d=e[s][2]*i[2]+o[2];n.push(r?[c,d,l]:[c,l,d])}return n}function Qn(e,t,r){if(e.dataModel&&e.dataModel.createObject({id:r,name:t.type+" : "+r,type:0|Wn[t.type],parent:t.parents?t.parents[0]:null}),e.sceneModel){if(!(t.geometry&&t.geometry.length>0))return;for(var n=[],i=0,o=t.geometry.length;i<o;i++){var s=t.geometry[i],a=void 0,c=void 0,l=e.fileData.appearance;if(l){var d=l.materials;if(d){var u=s.material;if(u){var h=Object.keys(u);if(h.length>0){var f=u[h[0]];if(void 0!==f.value)a=d[f.value];else{var p=f.values;if(p){c=[];for(var g=0,y=p.length;g<y;g++)c.push(d[p[i]])}}}}}}c?$n(e,s,c,n):ti(e,s,a,n)}n.length>0&&e.sceneModel.createObject({id:r,meshIds:n})}}function Xn(e,t,r){t.parents&&e.dataModel.createRelationship({relatingObjectId:t.parents[0],relatedObjectId:r,type:1001})}function $n(e,t,r,n){switch(t.type){case"MultiPoint":case"MultiLineString":break;case"MultiSurface":case"CompositeSurface":ei(e,r,t.boundaries,n);break;case"Solid":for(var i=t.boundaries,o=0;o<i.length;o++)ei(e,r,i[o],n);break;case"MultiSolid":case"CompositeSolid":for(var s=t.boundaries,a=0;a<s.length;a++)for(var c=0;c<s[a].length;c++)ei(e,r,s[a][c],n)}}function ei(e,t,r,n){for(var i=e.vertices,o=e.sceneModel,s=0;s<r.length;s++){for(var a=r[s],c=t[s]||{diffuseColor:[.8,.8,.8],transparency:1},l=[],d=[],u=[],h={positions:[],indices:[]},f=0;f<a.length;f++){l.length>0&&d.push(l.length);var p=ni(e,a[f],u,h);l.push.apply(l,p)}if(3===l.length)h.indices.push(l[0]),h.indices.push(l[1]),h.indices.push(l[2]);else if(l.length>3){for(var g=[],y=0;y<l.length;y++)g.push({x:i[u[l[y]]][0],y:i[u[l[y]]][1],z:i[u[l[y]]][2]});for(var m=ii(g,Ue()),v=[],w=0;w<g.length;w++)oi(g[w],m,Hn),v.unshift(Hn[0]),v.unshift(Hn[1]);for(var b=wn(v,d,2),_=0;_<b.length;_+=3)h.indices.unshift(l[b[_]]),h.indices.unshift(l[b[_+1]]),h.indices.unshift(l[b[_+2]])}var x=""+e.nextId++;o.createGeometry({id:x,primitive:Ie,positions:h.positions,indices:h.indices});var k=""+e.nextId++;o.createMesh({id:k,geometryId:x,color:c&&c.diffuseColor?c.diffuseColor:[.8,.8,.8],opacity:c&&void 0!==c.transparency?1-c.transparency:1}),n.push(k)}}function ti(e,t,r,n){var i=e.sceneModel,o=[],s={positions:[],indices:[]};switch(t.type){case"MultiPoint":case"MultiLineString":break;case"MultiSurface":case"CompositeSurface":ri(e,t.boundaries,o,s);break;case"Solid":for(var a=t.boundaries,c=0;c<a.length;c++)ri(e,a[c],o,s);break;case"MultiSolid":case"CompositeSolid":for(var l=t.boundaries,d=0;d<l.length;d++)for(var u=0;u<l[d].length;u++)ri(e,l[d][u],o,s)}if(s.positions.length>0&&s.indices.length>0){var h=""+e.nextId++;i.createGeometry({id:h,primitive:Ie,positions:s.positions,indices:s.indices});var f=""+e.nextId++;i.createMesh({id:f,geometryId:h,color:r&&r.diffuseColor?r.diffuseColor:[.8,.8,.8],opacity:1}),n.push(f)}}function ri(e,t,r,n){for(var i=e.vertices,o=0;o<t.length;o++){for(var s=[],a=[],c=0;c<t[o].length;c++){s.length>0&&a.push(s.length);var l=ni(e,t[o][c],r,n);s.push.apply(s,l)}if(3===s.length)n.indices.push(s[0]),n.indices.push(s[1]),n.indices.push(s[2]);else if(s.length>3){for(var d=[],u=0;u<s.length;u++)d.push({x:i[r[s[u]]][0],y:i[r[s[u]]][1],z:i[r[s[u]]][2]});for(var h=ii(d,Ue()),f=[],p=0;p<d.length;p++)oi(d[p],h,Hn),f.unshift(Hn[0]),f.unshift(Hn[1]);for(var g=wn(f,a,2),y=0;y<g.length;y+=3)n.indices.unshift(s[g[y]]),n.indices.unshift(s[g[y+1]]),n.indices.unshift(s[g[y+2]])}}}function ni(e,t,r,n){for(var i=e.vertices,o=[],s=0,a=t.length;s<a;s++){var c=t[s];if(r.includes(c)){var l=r.indexOf(c);o.push(l)}else n.positions.push(i[c][0]),n.positions.push(i[c][1]),n.positions.push(i[c][2]),o.push(r.length),r.push(c)}return o}function ii(e,t){for(var r=0;r<e.length;r++){var n=r+1;n===e.length&&(n=0),t[0]+=(e[r].y-e[n].y)*(e[r].z+e[n].z),t[1]+=(e[r].z-e[n].z)*(e[r].x+e[n].x),t[2]+=(e[r].x-e[n].x)*(e[r].y+e[n].y)}return Ze(t)}function oi(e,t,r){var n=Vn,i=Jn,o=qn;n[0]=e.x,n[1]=e.y,n[2]=e.z,i[0]=t.x,i[1]=t.y,i[2]=t.z,o[0]=1.1,o[1]=1.1,o[2]=1.1,Ne(Le(o,i))<.01&&(o[0]+=1,o[1]+=2,o[2]+=3);var s=ze(i,Pe(o,i),Ue());o[0]-=s[0],o[1]-=s[1],o[2]-=s[2],Ze(o);var a=Ke(i,o,Ue()),c=Pe(n,o),l=Pe(n,a);r[0]=c,r[1]=l}function si(e){let t=e.length;for(;--t>=0;)e[t]=0}const ai=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),ci=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),li=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),di=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ui=new Array(576);si(ui);const hi=new Array(60);si(hi);const fi=new Array(512);si(fi);const pi=new Array(256);si(pi);const gi=new Array(29);si(gi);const yi=new Array(30);function mi(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}let vi,wi,bi;function _i(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}si(yi);const xi=e=>e<256?fi[e]:fi[256+(e>>>7)],ki=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Si=(e,t,r)=>{e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,ki(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},Mi=(e,t,r)=>{Si(e,r[2*t],r[2*t+1])},Ei=(e,t)=>{let r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1},Ti=(e,t,r)=>{const n=new Array(16);let i,o,s=0;for(i=1;i<=15;i++)s=s+r[i-1]<<1,n[i]=s;for(o=0;o<=t;o++){let t=e[2*o+1];0!==t&&(e[2*o]=Ei(n[t]++,t))}},Di=e=>{let t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},Ai=e=>{e.bi_valid>8?ki(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Bi=(e,t,r,n)=>{const i=2*t,o=2*r;return e[i]<e[o]||e[i]===e[o]&&n[t]<=n[r]},ji=(e,t,r)=>{const n=e.heap[r];let i=r<<1;for(;i<=e.heap_len&&(i<e.heap_len&&Bi(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!Bi(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n},Ii=(e,t,r)=>{let n,i,o,s,a=0;if(0!==e.sym_next)do{n=255&e.pending_buf[e.sym_buf+a++],n+=(255&e.pending_buf[e.sym_buf+a++])<<8,i=e.pending_buf[e.sym_buf+a++],0===n?Mi(e,i,t):(o=pi[i],Mi(e,o+256+1,t),s=ai[o],0!==s&&(i-=gi[o],Si(e,i,s)),n--,o=xi(n),Mi(e,o,r),s=ci[o],0!==s&&(n-=yi[o],Si(e,n,s)))}while(a<e.sym_next);Mi(e,256,t)},Oi=(e,t)=>{const r=t.dyn_tree,n=t.stat_desc.static_tree,i=t.stat_desc.has_stree,o=t.stat_desc.elems;let s,a,c,l=-1;for(e.heap_len=0,e.heap_max=573,s=0;s<o;s++)0!==r[2*s]?(e.heap[++e.heap_len]=l=s,e.depth[s]=0):r[2*s+1]=0;for(;e.heap_len<2;)c=e.heap[++e.heap_len]=l<2?++l:0,r[2*c]=1,e.depth[c]=0,e.opt_len--,i&&(e.static_len-=n[2*c+1]);for(t.max_code=l,s=e.heap_len>>1;s>=1;s--)ji(e,r,s);c=o;do{s=e.heap[1],e.heap[1]=e.heap[e.heap_len--],ji(e,r,1),a=e.heap[1],e.heap[--e.heap_max]=s,e.heap[--e.heap_max]=a,r[2*c]=r[2*s]+r[2*a],e.depth[c]=(e.depth[s]>=e.depth[a]?e.depth[s]:e.depth[a])+1,r[2*s+1]=r[2*a+1]=c,e.heap[1]=c++,ji(e,r,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const r=t.dyn_tree,n=t.max_code,i=t.stat_desc.static_tree,o=t.stat_desc.has_stree,s=t.stat_desc.extra_bits,a=t.stat_desc.extra_base,c=t.stat_desc.max_length;let l,d,u,h,f,p,g=0;for(h=0;h<=15;h++)e.bl_count[h]=0;for(r[2*e.heap[e.heap_max]+1]=0,l=e.heap_max+1;l<573;l++)d=e.heap[l],h=r[2*r[2*d+1]+1]+1,h>c&&(h=c,g++),r[2*d+1]=h,d>n||(e.bl_count[h]++,f=0,d>=a&&(f=s[d-a]),p=r[2*d],e.opt_len+=p*(h+f),o&&(e.static_len+=p*(i[2*d+1]+f)));if(0!==g){do{for(h=c-1;0===e.bl_count[h];)h--;e.bl_count[h]--,e.bl_count[h+1]+=2,e.bl_count[c]--,g-=2}while(g>0);for(h=c;0!==h;h--)for(d=e.bl_count[h];0!==d;)u=e.heap[--l],u>n||(r[2*u+1]!==h&&(e.opt_len+=(h-r[2*u+1])*r[2*u],r[2*u+1]=h),d--)}})(e,t),Ti(r,l,e.bl_count)},Ci=(e,t,r)=>{let n,i,o=-1,s=t[1],a=0,c=7,l=4;for(0===s&&(c=138,l=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=s,s=t[2*(n+1)+1],++a<c&&i===s||(a<l?e.bl_tree[2*i]+=a:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,a=0,o=i,0===s?(c=138,l=3):i===s?(c=6,l=3):(c=7,l=4))},Pi=(e,t,r)=>{let n,i,o=-1,s=t[1],a=0,c=7,l=4;for(0===s&&(c=138,l=3),n=0;n<=r;n++)if(i=s,s=t[2*(n+1)+1],!(++a<c&&i===s)){if(a<l)do{Mi(e,i,e.bl_tree)}while(0!=--a);else 0!==i?(i!==o&&(Mi(e,i,e.bl_tree),a--),Mi(e,16,e.bl_tree),Si(e,a-3,2)):a<=10?(Mi(e,17,e.bl_tree),Si(e,a-3,3)):(Mi(e,18,e.bl_tree),Si(e,a-11,7));a=0,o=i,0===s?(c=138,l=3):i===s?(c=6,l=3):(c=7,l=4)}};let Ri=!1;const Ui=(e,t,r,n)=>{Si(e,0+(n?1:0),3),Ai(e),ki(e,r),ki(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r};var Fi={_tr_init:e=>{Ri||((()=>{let e,t,r,n,i;const o=new Array(16);for(r=0,n=0;n<28;n++)for(gi[n]=r,e=0;e<1<<ai[n];e++)pi[r++]=n;for(pi[r-1]=n,i=0,n=0;n<16;n++)for(yi[n]=i,e=0;e<1<<ci[n];e++)fi[i++]=n;for(i>>=7;n<30;n++)for(yi[n]=i<<7,e=0;e<1<<ci[n]-7;e++)fi[256+i++]=n;for(t=0;t<=15;t++)o[t]=0;for(e=0;e<=143;)ui[2*e+1]=8,e++,o[8]++;for(;e<=255;)ui[2*e+1]=9,e++,o[9]++;for(;e<=279;)ui[2*e+1]=7,e++,o[7]++;for(;e<=287;)ui[2*e+1]=8,e++,o[8]++;for(Ti(ui,287,o),e=0;e<30;e++)hi[2*e+1]=5,hi[2*e]=Ei(e,5);vi=new mi(ui,ai,257,286,15),wi=new mi(hi,ci,0,30,15),bi=new mi(new Array(0),li,0,19,7)})(),Ri=!0),e.l_desc=new _i(e.dyn_ltree,vi),e.d_desc=new _i(e.dyn_dtree,wi),e.bl_desc=new _i(e.bl_tree,bi),e.bi_buf=0,e.bi_valid=0,Di(e)},_tr_stored_block:Ui,_tr_flush_block:(e,t,r,n)=>{let i,o,s=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),Oi(e,e.l_desc),Oi(e,e.d_desc),s=(e=>{let t;for(Ci(e,e.dyn_ltree,e.l_desc.max_code),Ci(e,e.dyn_dtree,e.d_desc.max_code),Oi(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*di[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),i=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=i&&(i=o)):i=o=r+5,r+4<=i&&-1!==t?Ui(e,t,r,n):4===e.strategy||o===i?(Si(e,2+(n?1:0),3),Ii(e,ui,hi)):(Si(e,4+(n?1:0),3),((e,t,r,n)=>{let i;for(Si(e,t-257,5),Si(e,r-1,5),Si(e,n-4,4),i=0;i<n;i++)Si(e,e.bl_tree[2*di[i]+1],3);Pi(e,e.dyn_ltree,t-1),Pi(e,e.dyn_dtree,r-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),Ii(e,e.dyn_ltree,e.dyn_dtree)),Di(e),n&&Ai(e)},_tr_tally:(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(pi[r]+256+1)]++,e.dyn_dtree[2*xi(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{Si(e,2,3),Mi(e,256,ui),(e=>{16===e.bi_valid?(ki(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}},zi=(e,t,r,n)=>{let i=65535&e|0,o=e>>>16&65535|0,s=0;for(;0!==r;){s=r>2e3?2e3:r,r-=s;do{i=i+t[n++]|0,o=o+i|0}while(--s);i%=65521,o%=65521}return i|o<<16|0};const Li=new Uint32Array((()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t})());var Ki=(e,t,r,n)=>{const i=Li,o=n+r;e^=-1;for(let r=n;r<o;r++)e=e>>>8^i[255&(e^t[r])];return-1^e},Ni={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Zi={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Gi,_tr_stored_block:Wi,_tr_flush_block:Hi,_tr_tally:Vi,_tr_align:Ji}=Fi,{Z_NO_FLUSH:qi,Z_PARTIAL_FLUSH:Yi,Z_FULL_FLUSH:Qi,Z_FINISH:Xi,Z_BLOCK:$i,Z_OK:eo,Z_STREAM_END:to,Z_STREAM_ERROR:ro,Z_DATA_ERROR:no,Z_BUF_ERROR:io,Z_DEFAULT_COMPRESSION:oo,Z_FILTERED:so,Z_HUFFMAN_ONLY:ao,Z_RLE:co,Z_FIXED:lo,Z_DEFAULT_STRATEGY:uo,Z_UNKNOWN:ho,Z_DEFLATED:fo}=Zi,po=258,go=262,yo=42,mo=113,vo=666,wo=(e,t)=>(e.msg=Ni[t],t),bo=e=>2*e-(e>4?9:0),_o=e=>{let t=e.length;for(;--t>=0;)e[t]=0},xo=e=>{let t,r,n,i=e.w_size;t=e.hash_size,n=t;do{r=e.head[--n],e.head[n]=r>=i?r-i:0}while(--t);t=i,n=t;do{r=e.prev[--n],e.prev[n]=r>=i?r-i:0}while(--t)};let ko=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask;const So=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))},Mo=(e,t)=>{Hi(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,So(e.strm)},Eo=(e,t)=>{e.pending_buf[e.pending++]=t},To=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Do=(e,t,r,n)=>{let i=e.avail_in;return i>n&&(i=n),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),r),1===e.state.wrap?e.adler=zi(e.adler,t,i,r):2===e.state.wrap&&(e.adler=Ki(e.adler,t,i,r)),e.next_in+=i,e.total_in+=i,i)},Ao=(e,t)=>{let r,n,i=e.max_chain_length,o=e.strstart,s=e.prev_length,a=e.nice_match;const c=e.strstart>e.w_size-go?e.strstart-(e.w_size-go):0,l=e.window,d=e.w_mask,u=e.prev,h=e.strstart+po;let f=l[o+s-1],p=l[o+s];e.prev_length>=e.good_match&&(i>>=2),a>e.lookahead&&(a=e.lookahead);do{if(r=t,l[r+s]===p&&l[r+s-1]===f&&l[r]===l[o]&&l[++r]===l[o+1]){o+=2,r++;do{}while(l[++o]===l[++r]&&l[++o]===l[++r]&&l[++o]===l[++r]&&l[++o]===l[++r]&&l[++o]===l[++r]&&l[++o]===l[++r]&&l[++o]===l[++r]&&l[++o]===l[++r]&&o<h);if(n=po-(h-o),o=h-po,n>s){if(e.match_start=t,s=n,n>=a)break;f=l[o+s-1],p=l[o+s]}}}while((t=u[t&d])>c&&0!=--i);return s<=e.lookahead?s:e.lookahead},Bo=e=>{const t=e.w_size;let r,n,i;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-go)&&(e.window.set(e.window.subarray(t,t+t-n),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),xo(e),n+=t),0===e.strm.avail_in)break;if(r=Do(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=r,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=ko(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=ko(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<go&&0!==e.strm.avail_in)},jo=(e,t)=>{let r,n,i,o=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,s=0,a=e.strm.avail_in;do{if(r=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i)break;if(i=e.strm.avail_out-i,n=e.strstart-e.block_start,r>n+e.strm.avail_in&&(r=n+e.strm.avail_in),r>i&&(r=i),r<o&&(0===r&&t!==Xi||t===qi||r!==n+e.strm.avail_in))break;s=t===Xi&&r===n+e.strm.avail_in?1:0,Wi(e,0,0,s),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,So(e.strm),n&&(n>r&&(n=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+n),e.strm.next_out),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n,e.block_start+=n,r-=n),r&&(Do(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(0===s);return a-=e.strm.avail_in,a&&(a>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=a&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-a,e.strm.next_in),e.strstart),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),s?4:t!==qi&&t!==Xi&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(Do(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,o=i>e.w_size?e.w_size:i,n=e.strstart-e.block_start,(n>=o||(n||t===Xi)&&t!==qi&&0===e.strm.avail_in&&n<=i)&&(r=n>i?i:n,s=t===Xi&&0===e.strm.avail_in&&r===n?1:0,Wi(e,e.block_start,r,s),e.block_start+=r,So(e.strm)),s?3:1)},Io=(e,t)=>{let r,n;for(;;){if(e.lookahead<go){if(Bo(e),e.lookahead<go&&t===qi)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=ko(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-go&&(e.match_length=Ao(e,r)),e.match_length>=3)if(n=Vi(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=ko(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=ko(e,e.ins_h,e.window[e.strstart+1]);else n=Vi(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(Mo(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Xi?(Mo(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Mo(e,!1),0===e.strm.avail_out)?1:2},Oo=(e,t)=>{let r,n,i;for(;;){if(e.lookahead<go){if(Bo(e),e.lookahead<go&&t===qi)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=ko(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-go&&(e.match_length=Ao(e,r),e.match_length<=5&&(e.strategy===so||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,n=Vi(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=ko(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(Mo(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(n=Vi(e,0,e.window[e.strstart-1]),n&&Mo(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=Vi(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Xi?(Mo(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Mo(e,!1),0===e.strm.avail_out)?1:2};function Co(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}const Po=[new Co(0,0,0,0,jo),new Co(4,4,8,4,Io),new Co(4,5,16,8,Io),new Co(4,6,32,32,Io),new Co(4,4,16,16,Oo),new Co(8,16,32,32,Oo),new Co(8,16,128,128,Oo),new Co(8,32,128,256,Oo),new Co(32,128,258,1024,Oo),new Co(32,258,258,4096,Oo)];function Ro(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=fo,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),_o(this.dyn_ltree),_o(this.dyn_dtree),_o(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),_o(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),_o(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Uo=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==yo&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==mo&&t.status!==vo?1:0},Fo=e=>{if(Uo(e))return wo(e,ro);e.total_in=e.total_out=0,e.data_type=ho;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?yo:mo,e.adler=2===t.wrap?0:1,t.last_flush=-2,Gi(t),eo},zo=e=>{const t=Fo(e);return t===eo&&(e=>{e.window_size=2*e.w_size,_o(e.head),e.max_lazy_match=Po[e.level].max_lazy,e.good_match=Po[e.level].good_length,e.nice_match=Po[e.level].nice_length,e.max_chain_length=Po[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0})(e.state),t},Lo=(e,t,r,n,i,o)=>{if(!e)return ro;let s=1;if(t===oo&&(t=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),i<1||i>9||r!==fo||n<8||n>15||t<0||t>9||o<0||o>lo||8===n&&1!==s)return wo(e,ro);8===n&&(n=9);const a=new Ro;return e.state=a,a.strm=e,a.status=yo,a.wrap=s,a.gzhead=null,a.w_bits=n,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=t,a.strategy=o,a.method=r,zo(e)};var Ko={deflateInit:(e,t)=>Lo(e,t,fo,15,8,uo),deflateInit2:Lo,deflateReset:zo,deflateResetKeep:Fo,deflateSetHeader:(e,t)=>Uo(e)||2!==e.state.wrap?ro:(e.state.gzhead=t,eo),deflate:(e,t)=>{if(Uo(e)||t>$i||t<0)return e?wo(e,ro):ro;const r=e.state;if(!e.output||0!==e.avail_in&&!e.input||r.status===vo&&t!==Xi)return wo(e,0===e.avail_out?io:ro);const n=r.last_flush;if(r.last_flush=t,0!==r.pending){if(So(e),0===e.avail_out)return r.last_flush=-1,eo}else if(0===e.avail_in&&bo(t)<=bo(n)&&t!==Xi)return wo(e,io);if(r.status===vo&&0!==e.avail_in)return wo(e,io);if(r.status===yo&&0===r.wrap&&(r.status=mo),r.status===yo){let t=fo+(r.w_bits-8<<4)<<8,n=-1;if(n=r.strategy>=ao||r.level<2?0:r.level<6?1:6===r.level?2:3,t|=n<<6,0!==r.strstart&&(t|=32),t+=31-t%31,To(r,t),0!==r.strstart&&(To(r,e.adler>>>16),To(r,65535&e.adler)),e.adler=1,r.status=mo,So(e),0!==r.pending)return r.last_flush=-1,eo}if(57===r.status)if(e.adler=0,Eo(r,31),Eo(r,139),Eo(r,8),r.gzhead)Eo(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),Eo(r,255&r.gzhead.time),Eo(r,r.gzhead.time>>8&255),Eo(r,r.gzhead.time>>16&255),Eo(r,r.gzhead.time>>24&255),Eo(r,9===r.level?2:r.strategy>=ao||r.level<2?4:0),Eo(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(Eo(r,255&r.gzhead.extra.length),Eo(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=Ki(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(Eo(r,0),Eo(r,0),Eo(r,0),Eo(r,0),Eo(r,0),Eo(r,9===r.level?2:r.strategy>=ao||r.level<2?4:0),Eo(r,3),r.status=mo,So(e),0!==r.pending)return r.last_flush=-1,eo;if(69===r.status){if(r.gzhead.extra){let t=r.pending,n=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+n>r.pending_buf_size;){let i=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+i),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>t&&(e.adler=Ki(e.adler,r.pending_buf,r.pending-t,t)),r.gzindex+=i,So(e),0!==r.pending)return r.last_flush=-1,eo;t=0,n-=i}let i=new Uint8Array(r.gzhead.extra);r.pending_buf.set(i.subarray(r.gzindex,r.gzindex+n),r.pending),r.pending+=n,r.gzhead.hcrc&&r.pending>t&&(e.adler=Ki(e.adler,r.pending_buf,r.pending-t,t)),r.gzindex=0}r.status=73}if(73===r.status){if(r.gzhead.name){let t,n=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>n&&(e.adler=Ki(e.adler,r.pending_buf,r.pending-n,n)),So(e),0!==r.pending)return r.last_flush=-1,eo;n=0}t=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,Eo(r,t)}while(0!==t);r.gzhead.hcrc&&r.pending>n&&(e.adler=Ki(e.adler,r.pending_buf,r.pending-n,n)),r.gzindex=0}r.status=91}if(91===r.status){if(r.gzhead.comment){let t,n=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>n&&(e.adler=Ki(e.adler,r.pending_buf,r.pending-n,n)),So(e),0!==r.pending)return r.last_flush=-1,eo;n=0}t=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,Eo(r,t)}while(0!==t);r.gzhead.hcrc&&r.pending>n&&(e.adler=Ki(e.adler,r.pending_buf,r.pending-n,n))}r.status=103}if(103===r.status){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(So(e),0!==r.pending))return r.last_flush=-1,eo;Eo(r,255&e.adler),Eo(r,e.adler>>8&255),e.adler=0}if(r.status=mo,So(e),0!==r.pending)return r.last_flush=-1,eo}if(0!==e.avail_in||0!==r.lookahead||t!==qi&&r.status!==vo){let n=0===r.level?jo(r,t):r.strategy===ao?((e,t)=>{let r;for(;;){if(0===e.lookahead&&(Bo(e),0===e.lookahead)){if(t===qi)return 1;break}if(e.match_length=0,r=Vi(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(Mo(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Xi?(Mo(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Mo(e,!1),0===e.strm.avail_out)?1:2})(r,t):r.strategy===co?((e,t)=>{let r,n,i,o;const s=e.window;for(;;){if(e.lookahead<=po){if(Bo(e),e.lookahead<=po&&t===qi)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=e.strstart-1,n=s[i],n===s[++i]&&n===s[++i]&&n===s[++i])){o=e.strstart+po;do{}while(n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&i<o);e.match_length=po-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=Vi(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=Vi(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(Mo(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Xi?(Mo(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Mo(e,!1),0===e.strm.avail_out)?1:2})(r,t):Po[r.level].func(r,t);if(3!==n&&4!==n||(r.status=vo),1===n||3===n)return 0===e.avail_out&&(r.last_flush=-1),eo;if(2===n&&(t===Yi?Ji(r):t!==$i&&(Wi(r,0,0,!1),t===Qi&&(_o(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),So(e),0===e.avail_out))return r.last_flush=-1,eo}return t!==Xi?eo:r.wrap<=0?to:(2===r.wrap?(Eo(r,255&e.adler),Eo(r,e.adler>>8&255),Eo(r,e.adler>>16&255),Eo(r,e.adler>>24&255),Eo(r,255&e.total_in),Eo(r,e.total_in>>8&255),Eo(r,e.total_in>>16&255),Eo(r,e.total_in>>24&255)):(To(r,e.adler>>>16),To(r,65535&e.adler)),So(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?eo:to)},deflateEnd:e=>{if(Uo(e))return ro;const t=e.state.status;return e.state=null,t===mo?wo(e,no):eo},deflateSetDictionary:(e,t)=>{let r=t.length;if(Uo(e))return ro;const n=e.state,i=n.wrap;if(2===i||1===i&&n.status!==yo||n.lookahead)return ro;if(1===i&&(e.adler=zi(e.adler,t,r,0)),n.wrap=0,r>=n.w_size){0===i&&(_o(n.head),n.strstart=0,n.block_start=0,n.insert=0);let e=new Uint8Array(n.w_size);e.set(t.subarray(r-n.w_size,r),0),t=e,r=n.w_size}const o=e.avail_in,s=e.next_in,a=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,Bo(n);n.lookahead>=3;){let e=n.strstart,t=n.lookahead-2;do{n.ins_h=ko(n,n.ins_h,n.window[e+3-1]),n.prev[e&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=e,e++}while(--t);n.strstart=e,n.lookahead=2,Bo(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=s,e.input=a,e.avail_in=o,n.wrap=i,eo},deflateInfo:"pako deflate (from Nodeca project)"};const No=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Zo={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(const t in r)No(r,t)&&(e[t]=r[t])}}return e},flattenChunks:e=>{let t=0;for(let r=0,n=e.length;r<n;r++)t+=e[r].length;const r=new Uint8Array(t);for(let t=0,n=0,i=e.length;t<i;t++){let i=e[t];r.set(i,n),n+=i.length}return r}};let Go=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Go=!1}const Wo=new Uint8Array(256);for(let e=0;e<256;e++)Wo[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Wo[254]=Wo[254]=1;var Ho={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,r,n,i,o,s=e.length,a=0;for(i=0;i<s;i++)r=e.charCodeAt(i),55296==(64512&r)&&i+1<s&&(n=e.charCodeAt(i+1),56320==(64512&n)&&(r=65536+(r-55296<<10)+(n-56320),i++)),a+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(a),o=0,i=0;o<a;i++)r=e.charCodeAt(i),55296==(64512&r)&&i+1<s&&(n=e.charCodeAt(i+1),56320==(64512&n)&&(r=65536+(r-55296<<10)+(n-56320),i++)),r<128?t[o++]=r:r<2048?(t[o++]=192|r>>>6,t[o++]=128|63&r):r<65536?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|63&r):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|63&r);return t},buf2string:(e,t)=>{const r=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let n,i;const o=new Array(2*r);for(i=0,n=0;n<r;){let t=e[n++];if(t<128){o[i++]=t;continue}let s=Wo[t];if(s>4)o[i++]=65533,n+=s-1;else{for(t&=2===s?31:3===s?15:7;s>1&&n<r;)t=t<<6|63&e[n++],s--;s>1?o[i++]=65533:t<65536?o[i++]=t:(t-=65536,o[i++]=55296|t>>10&1023,o[i++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&Go)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let r="";for(let n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r})(o,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let r=t-1;for(;r>=0&&128==(192&e[r]);)r--;return r<0||0===r?t:r+Wo[e[r]]>t?r:t}},Vo=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Jo=Object.prototype.toString,{Z_NO_FLUSH:qo,Z_SYNC_FLUSH:Yo,Z_FULL_FLUSH:Qo,Z_FINISH:Xo,Z_OK:$o,Z_STREAM_END:es,Z_DEFAULT_COMPRESSION:ts,Z_DEFAULT_STRATEGY:rs,Z_DEFLATED:ns}=Zi;function is(e){this.options=Zo.assign({level:ts,method:ns,chunkSize:16384,windowBits:15,memLevel:8,strategy:rs},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Vo,this.strm.avail_out=0;let r=Ko.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==$o)throw new Error(Ni[r]);if(t.header&&Ko.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?Ho.string2buf(t.dictionary):"[object ArrayBuffer]"===Jo.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,r=Ko.deflateSetDictionary(this.strm,e),r!==$o)throw new Error(Ni[r]);this._dict_set=!0}}function os(e,t){const r=new is(t);if(r.push(e,!0),r.err)throw r.msg||Ni[r.err];return r.result}is.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize;let i,o;if(this.ended)return!1;for(o=t===~~t?t:!0===t?Xo:qo,r.input="string"==typeof e?Ho.string2buf(e):"[object ArrayBuffer]"===Jo.call(e)?new Uint8Array(e):e,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(o===Yo||o===Qo)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(i=Ko.deflate(r,o),i===es)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),i=Ko.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===$o;if(0!==r.avail_out){if(o>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},is.prototype.onData=function(e){this.chunks.push(e)},is.prototype.onEnd=function(e){e===$o&&(this.result=Zo.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var ss={Deflate:is,deflate:os,deflateRaw:function(e,t){return(t=t||{}).raw=!0,os(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,os(e,t)},constants:Zi};const as=16209;var cs=function(e,t){let r,n,i,o,s,a,c,l,d,u,h,f,p,g,y,m,v,w,b,_,x,k,S,M;const E=e.state;r=e.next_in,S=e.input,n=r+(e.avail_in-5),i=e.next_out,M=e.output,o=i-(t-e.avail_out),s=i+(e.avail_out-257),a=E.dmax,c=E.wsize,l=E.whave,d=E.wnext,u=E.window,h=E.hold,f=E.bits,p=E.lencode,g=E.distcode,y=(1<<E.lenbits)-1,m=(1<<E.distbits)-1;e:do{f<15&&(h+=S[r++]<<f,f+=8,h+=S[r++]<<f,f+=8),v=p[h&y];t:for(;;){if(w=v>>>24,h>>>=w,f-=w,w=v>>>16&255,0===w)M[i++]=65535&v;else{if(!(16&w)){if(0==(64&w)){v=p[(65535&v)+(h&(1<<w)-1)];continue t}if(32&w){E.mode=16191;break e}e.msg="invalid literal/length code",E.mode=as;break e}b=65535&v,w&=15,w&&(f<w&&(h+=S[r++]<<f,f+=8),b+=h&(1<<w)-1,h>>>=w,f-=w),f<15&&(h+=S[r++]<<f,f+=8,h+=S[r++]<<f,f+=8),v=g[h&m];r:for(;;){if(w=v>>>24,h>>>=w,f-=w,w=v>>>16&255,!(16&w)){if(0==(64&w)){v=g[(65535&v)+(h&(1<<w)-1)];continue r}e.msg="invalid distance code",E.mode=as;break e}if(_=65535&v,w&=15,f<w&&(h+=S[r++]<<f,f+=8,f<w&&(h+=S[r++]<<f,f+=8)),_+=h&(1<<w)-1,_>a){e.msg="invalid distance too far back",E.mode=as;break e}if(h>>>=w,f-=w,w=i-o,_>w){if(w=_-w,w>l&&E.sane){e.msg="invalid distance too far back",E.mode=as;break e}if(x=0,k=u,0===d){if(x+=c-w,w<b){b-=w;do{M[i++]=u[x++]}while(--w);x=i-_,k=M}}else if(d<w){if(x+=c+d-w,w-=d,w<b){b-=w;do{M[i++]=u[x++]}while(--w);if(x=0,d<b){w=d,b-=w;do{M[i++]=u[x++]}while(--w);x=i-_,k=M}}}else if(x+=d-w,w<b){b-=w;do{M[i++]=u[x++]}while(--w);x=i-_,k=M}for(;b>2;)M[i++]=k[x++],M[i++]=k[x++],M[i++]=k[x++],b-=3;b&&(M[i++]=k[x++],b>1&&(M[i++]=k[x++]))}else{x=i-_;do{M[i++]=M[x++],M[i++]=M[x++],M[i++]=M[x++],b-=3}while(b>2);b&&(M[i++]=M[x++],b>1&&(M[i++]=M[x++]))}break}}break}}while(r<n&&i<s);b=f>>3,r-=b,f-=b<<3,h&=(1<<f)-1,e.next_in=r,e.next_out=i,e.avail_in=r<n?n-r+5:5-(r-n),e.avail_out=i<s?s-i+257:257-(i-s),E.hold=h,E.bits=f};const ls=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ds=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),us=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),hs=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var fs=(e,t,r,n,i,o,s,a)=>{const c=a.bits;let l,d,u,h,f,p,g=0,y=0,m=0,v=0,w=0,b=0,_=0,x=0,k=0,S=0,M=null;const E=new Uint16Array(16),T=new Uint16Array(16);let D,A,B,j=null;for(g=0;g<=15;g++)E[g]=0;for(y=0;y<n;y++)E[t[r+y]]++;for(w=c,v=15;v>=1&&0===E[v];v--);if(w>v&&(w=v),0===v)return i[o++]=20971520,i[o++]=20971520,a.bits=1,0;for(m=1;m<v&&0===E[m];m++);for(w<m&&(w=m),x=1,g=1;g<=15;g++)if(x<<=1,x-=E[g],x<0)return-1;if(x>0&&(0===e||1!==v))return-1;for(T[1]=0,g=1;g<15;g++)T[g+1]=T[g]+E[g];for(y=0;y<n;y++)0!==t[r+y]&&(s[T[t[r+y]]++]=y);if(0===e?(M=j=s,p=20):1===e?(M=ls,j=ds,p=257):(M=us,j=hs,p=0),S=0,y=0,g=m,f=o,b=w,_=0,u=-1,k=1<<w,h=k-1,1===e&&k>852||2===e&&k>592)return 1;for(;;){D=g-_,s[y]+1<p?(A=0,B=s[y]):s[y]>=p?(A=j[s[y]-p],B=M[s[y]-p]):(A=96,B=0),l=1<<g-_,d=1<<b,m=d;do{d-=l,i[f+(S>>_)+d]=D<<24|A<<16|B|0}while(0!==d);for(l=1<<g-1;S&l;)l>>=1;if(0!==l?(S&=l-1,S+=l):S=0,y++,0==--E[g]){if(g===v)break;g=t[r+s[y]]}if(g>w&&(S&h)!==u){for(0===_&&(_=w),f+=m,b=g-_,x=1<<b;b+_<v&&(x-=E[b+_],!(x<=0));)b++,x<<=1;if(k+=1<<b,1===e&&k>852||2===e&&k>592)return 1;u=S&h,i[u]=w<<24|b<<16|f-o|0}}return 0!==S&&(i[f+S]=g-_<<24|64<<16|0),a.bits=w,0};const{Z_FINISH:ps,Z_BLOCK:gs,Z_TREES:ys,Z_OK:ms,Z_STREAM_END:vs,Z_NEED_DICT:ws,Z_STREAM_ERROR:bs,Z_DATA_ERROR:_s,Z_MEM_ERROR:xs,Z_BUF_ERROR:ks,Z_DEFLATED:Ss}=Zi,Ms=16180,Es=16190,Ts=16191,Ds=16192,As=16194,Bs=16199,js=16200,Is=16206,Os=16209,Cs=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Ps(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Rs=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<Ms||t.mode>16211?1:0},Us=e=>{if(Rs(e))return bs;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Ms,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,ms},Fs=e=>{if(Rs(e))return bs;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Us(e)},zs=(e,t)=>{let r;if(Rs(e))return bs;const n=e.state;return t<0?(r=0,t=-t):(r=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?bs:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,Fs(e))},Ls=(e,t)=>{if(!e)return bs;const r=new Ps;e.state=r,r.strm=e,r.window=null,r.mode=Ms;const n=zs(e,t);return n!==ms&&(e.state=null),n};let Ks,Ns,Zs=!0;const Gs=e=>{if(Zs){Ks=new Int32Array(512),Ns=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(fs(1,e.lens,0,288,Ks,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;fs(2,e.lens,0,32,Ns,0,e.work,{bits:5}),Zs=!1}e.lencode=Ks,e.lenbits=9,e.distcode=Ns,e.distbits=5},Ws=(e,t,r,n)=>{let i;const o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),n>=o.wsize?(o.window.set(t.subarray(r-o.wsize,r),0),o.wnext=0,o.whave=o.wsize):(i=o.wsize-o.wnext,i>n&&(i=n),o.window.set(t.subarray(r-n,r-n+i),o.wnext),(n-=i)?(o.window.set(t.subarray(r-n,r),0),o.wnext=n,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0};var Hs={inflateReset:Fs,inflateReset2:zs,inflateResetKeep:Us,inflateInit:e=>Ls(e,15),inflateInit2:Ls,inflate:(e,t)=>{let r,n,i,o,s,a,c,l,d,u,h,f,p,g,y,m,v,w,b,_,x,k,S=0;const M=new Uint8Array(4);let E,T;const D=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Rs(e)||!e.output||!e.input&&0!==e.avail_in)return bs;r=e.state,r.mode===Ts&&(r.mode=Ds),s=e.next_out,i=e.output,c=e.avail_out,o=e.next_in,n=e.input,a=e.avail_in,l=r.hold,d=r.bits,u=a,h=c,k=ms;e:for(;;)switch(r.mode){case Ms:if(0===r.wrap){r.mode=Ds;break}for(;d<16;){if(0===a)break e;a--,l+=n[o++]<<d,d+=8}if(2&r.wrap&&35615===l){0===r.wbits&&(r.wbits=15),r.check=0,M[0]=255&l,M[1]=l>>>8&255,r.check=Ki(r.check,M,2,0),l=0,d=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",r.mode=Os;break}if((15&l)!==Ss){e.msg="unknown compression method",r.mode=Os;break}if(l>>>=4,d-=4,x=8+(15&l),0===r.wbits&&(r.wbits=x),x>15||x>r.wbits){e.msg="invalid window size",r.mode=Os;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=512&l?16189:Ts,l=0,d=0;break;case 16181:for(;d<16;){if(0===a)break e;a--,l+=n[o++]<<d,d+=8}if(r.flags=l,(255&r.flags)!==Ss){e.msg="unknown compression method",r.mode=Os;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=Os;break}r.head&&(r.head.text=l>>8&1),512&r.flags&&4&r.wrap&&(M[0]=255&l,M[1]=l>>>8&255,r.check=Ki(r.check,M,2,0)),l=0,d=0,r.mode=16182;case 16182:for(;d<32;){if(0===a)break e;a--,l+=n[o++]<<d,d+=8}r.head&&(r.head.time=l),512&r.flags&&4&r.wrap&&(M[0]=255&l,M[1]=l>>>8&255,M[2]=l>>>16&255,M[3]=l>>>24&255,r.check=Ki(r.check,M,4,0)),l=0,d=0,r.mode=16183;case 16183:for(;d<16;){if(0===a)break e;a--,l+=n[o++]<<d,d+=8}r.head&&(r.head.xflags=255&l,r.head.os=l>>8),512&r.flags&&4&r.wrap&&(M[0]=255&l,M[1]=l>>>8&255,r.check=Ki(r.check,M,2,0)),l=0,d=0,r.mode=16184;case 16184:if(1024&r.flags){for(;d<16;){if(0===a)break e;a--,l+=n[o++]<<d,d+=8}r.length=l,r.head&&(r.head.extra_len=l),512&r.flags&&4&r.wrap&&(M[0]=255&l,M[1]=l>>>8&255,r.check=Ki(r.check,M,2,0)),l=0,d=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&r.flags&&(f=r.length,f>a&&(f=a),f&&(r.head&&(x=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(o,o+f),x)),512&r.flags&&4&r.wrap&&(r.check=Ki(r.check,n,f,o)),a-=f,o+=f,r.length-=f),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&r.flags){if(0===a)break e;f=0;do{x=n[o+f++],r.head&&x&&r.length<65536&&(r.head.name+=String.fromCharCode(x))}while(x&&f<a);if(512&r.flags&&4&r.wrap&&(r.check=Ki(r.check,n,f,o)),a-=f,o+=f,x)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&r.flags){if(0===a)break e;f=0;do{x=n[o+f++],r.head&&x&&r.length<65536&&(r.head.comment+=String.fromCharCode(x))}while(x&&f<a);if(512&r.flags&&4&r.wrap&&(r.check=Ki(r.check,n,f,o)),a-=f,o+=f,x)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&r.flags){for(;d<16;){if(0===a)break e;a--,l+=n[o++]<<d,d+=8}if(4&r.wrap&&l!==(65535&r.check)){e.msg="header crc mismatch",r.mode=Os;break}l=0,d=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=Ts;break;case 16189:for(;d<32;){if(0===a)break e;a--,l+=n[o++]<<d,d+=8}e.adler=r.check=Cs(l),l=0,d=0,r.mode=Es;case Es:if(0===r.havedict)return e.next_out=s,e.avail_out=c,e.next_in=o,e.avail_in=a,r.hold=l,r.bits=d,ws;e.adler=r.check=1,r.mode=Ts;case Ts:if(t===gs||t===ys)break e;case Ds:if(r.last){l>>>=7&d,d-=7&d,r.mode=Is;break}for(;d<3;){if(0===a)break e;a--,l+=n[o++]<<d,d+=8}switch(r.last=1&l,l>>>=1,d-=1,3&l){case 0:r.mode=16193;break;case 1:if(Gs(r),r.mode=Bs,t===ys){l>>>=2,d-=2;break e}break;case 2:r.mode=16196;break;case 3:e.msg="invalid block type",r.mode=Os}l>>>=2,d-=2;break;case 16193:for(l>>>=7&d,d-=7&d;d<32;){if(0===a)break e;a--,l+=n[o++]<<d,d+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",r.mode=Os;break}if(r.length=65535&l,l=0,d=0,r.mode=As,t===ys)break e;case As:r.mode=16195;case 16195:if(f=r.length,f){if(f>a&&(f=a),f>c&&(f=c),0===f)break e;i.set(n.subarray(o,o+f),s),a-=f,o+=f,c-=f,s+=f,r.length-=f;break}r.mode=Ts;break;case 16196:for(;d<14;){if(0===a)break e;a--,l+=n[o++]<<d,d+=8}if(r.nlen=257+(31&l),l>>>=5,d-=5,r.ndist=1+(31&l),l>>>=5,d-=5,r.ncode=4+(15&l),l>>>=4,d-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=Os;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;d<3;){if(0===a)break e;a--,l+=n[o++]<<d,d+=8}r.lens[D[r.have++]]=7&l,l>>>=3,d-=3}for(;r.have<19;)r.lens[D[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,E={bits:r.lenbits},k=fs(0,r.lens,0,19,r.lencode,0,r.work,E),r.lenbits=E.bits,k){e.msg="invalid code lengths set",r.mode=Os;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;S=r.lencode[l&(1<<r.lenbits)-1],y=S>>>24,m=S>>>16&255,v=65535&S,!(y<=d);){if(0===a)break e;a--,l+=n[o++]<<d,d+=8}if(v<16)l>>>=y,d-=y,r.lens[r.have++]=v;else{if(16===v){for(T=y+2;d<T;){if(0===a)break e;a--,l+=n[o++]<<d,d+=8}if(l>>>=y,d-=y,0===r.have){e.msg="invalid bit length repeat",r.mode=Os;break}x=r.lens[r.have-1],f=3+(3&l),l>>>=2,d-=2}else if(17===v){for(T=y+3;d<T;){if(0===a)break e;a--,l+=n[o++]<<d,d+=8}l>>>=y,d-=y,x=0,f=3+(7&l),l>>>=3,d-=3}else{for(T=y+7;d<T;){if(0===a)break e;a--,l+=n[o++]<<d,d+=8}l>>>=y,d-=y,x=0,f=11+(127&l),l>>>=7,d-=7}if(r.have+f>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=Os;break}for(;f--;)r.lens[r.have++]=x}}if(r.mode===Os)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=Os;break}if(r.lenbits=9,E={bits:r.lenbits},k=fs(1,r.lens,0,r.nlen,r.lencode,0,r.work,E),r.lenbits=E.bits,k){e.msg="invalid literal/lengths set",r.mode=Os;break}if(r.distbits=6,r.distcode=r.distdyn,E={bits:r.distbits},k=fs(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,E),r.distbits=E.bits,k){e.msg="invalid distances set",r.mode=Os;break}if(r.mode=Bs,t===ys)break e;case Bs:r.mode=js;case js:if(a>=6&&c>=258){e.next_out=s,e.avail_out=c,e.next_in=o,e.avail_in=a,r.hold=l,r.bits=d,cs(e,h),s=e.next_out,i=e.output,c=e.avail_out,o=e.next_in,n=e.input,a=e.avail_in,l=r.hold,d=r.bits,r.mode===Ts&&(r.back=-1);break}for(r.back=0;S=r.lencode[l&(1<<r.lenbits)-1],y=S>>>24,m=S>>>16&255,v=65535&S,!(y<=d);){if(0===a)break e;a--,l+=n[o++]<<d,d+=8}if(m&&0==(240&m)){for(w=y,b=m,_=v;S=r.lencode[_+((l&(1<<w+b)-1)>>w)],y=S>>>24,m=S>>>16&255,v=65535&S,!(w+y<=d);){if(0===a)break e;a--,l+=n[o++]<<d,d+=8}l>>>=w,d-=w,r.back+=w}if(l>>>=y,d-=y,r.back+=y,r.length=v,0===m){r.mode=16205;break}if(32&m){r.back=-1,r.mode=Ts;break}if(64&m){e.msg="invalid literal/length code",r.mode=Os;break}r.extra=15&m,r.mode=16201;case 16201:if(r.extra){for(T=r.extra;d<T;){if(0===a)break e;a--,l+=n[o++]<<d,d+=8}r.length+=l&(1<<r.extra)-1,l>>>=r.extra,d-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;S=r.distcode[l&(1<<r.distbits)-1],y=S>>>24,m=S>>>16&255,v=65535&S,!(y<=d);){if(0===a)break e;a--,l+=n[o++]<<d,d+=8}if(0==(240&m)){for(w=y,b=m,_=v;S=r.distcode[_+((l&(1<<w+b)-1)>>w)],y=S>>>24,m=S>>>16&255,v=65535&S,!(w+y<=d);){if(0===a)break e;a--,l+=n[o++]<<d,d+=8}l>>>=w,d-=w,r.back+=w}if(l>>>=y,d-=y,r.back+=y,64&m){e.msg="invalid distance code",r.mode=Os;break}r.offset=v,r.extra=15&m,r.mode=16203;case 16203:if(r.extra){for(T=r.extra;d<T;){if(0===a)break e;a--,l+=n[o++]<<d,d+=8}r.offset+=l&(1<<r.extra)-1,l>>>=r.extra,d-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=Os;break}r.mode=16204;case 16204:if(0===c)break e;if(f=h-c,r.offset>f){if(f=r.offset-f,f>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=Os;break}f>r.wnext?(f-=r.wnext,p=r.wsize-f):p=r.wnext-f,f>r.length&&(f=r.length),g=r.window}else g=i,p=s-r.offset,f=r.length;f>c&&(f=c),c-=f,r.length-=f;do{i[s++]=g[p++]}while(--f);0===r.length&&(r.mode=js);break;case 16205:if(0===c)break e;i[s++]=r.length,c--,r.mode=js;break;case Is:if(r.wrap){for(;d<32;){if(0===a)break e;a--,l|=n[o++]<<d,d+=8}if(h-=c,e.total_out+=h,r.total+=h,4&r.wrap&&h&&(e.adler=r.check=r.flags?Ki(r.check,i,h,s-h):zi(r.check,i,h,s-h)),h=c,4&r.wrap&&(r.flags?l:Cs(l))!==r.check){e.msg="incorrect data check",r.mode=Os;break}l=0,d=0}r.mode=16207;case 16207:if(r.wrap&&r.flags){for(;d<32;){if(0===a)break e;a--,l+=n[o++]<<d,d+=8}if(4&r.wrap&&l!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=Os;break}l=0,d=0}r.mode=16208;case 16208:k=vs;break e;case Os:k=_s;break e;case 16210:return xs;default:return bs}return e.next_out=s,e.avail_out=c,e.next_in=o,e.avail_in=a,r.hold=l,r.bits=d,(r.wsize||h!==e.avail_out&&r.mode<Os&&(r.mode<Is||t!==ps))&&Ws(e,e.output,e.next_out,h-e.avail_out),u-=e.avail_in,h-=e.avail_out,e.total_in+=u,e.total_out+=h,r.total+=h,4&r.wrap&&h&&(e.adler=r.check=r.flags?Ki(r.check,i,h,e.next_out-h):zi(r.check,i,h,e.next_out-h)),e.data_type=r.bits+(r.last?64:0)+(r.mode===Ts?128:0)+(r.mode===Bs||r.mode===As?256:0),(0===u&&0===h||t===ps)&&k===ms&&(k=ks),k},inflateEnd:e=>{if(Rs(e))return bs;let t=e.state;return t.window&&(t.window=null),e.state=null,ms},inflateGetHeader:(e,t)=>{if(Rs(e))return bs;const r=e.state;return 0==(2&r.wrap)?bs:(r.head=t,t.done=!1,ms)},inflateSetDictionary:(e,t)=>{const r=t.length;let n,i,o;return Rs(e)?bs:(n=e.state,0!==n.wrap&&n.mode!==Es?bs:n.mode===Es&&(i=1,i=zi(i,t,r,0),i!==n.check)?_s:(o=Ws(e,t,r,r),o?(n.mode=16210,xs):(n.havedict=1,ms)))},inflateInfo:"pako inflate (from Nodeca project)"},Vs=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Js=Object.prototype.toString,{Z_NO_FLUSH:qs,Z_FINISH:Ys,Z_OK:Qs,Z_STREAM_END:Xs,Z_NEED_DICT:$s,Z_STREAM_ERROR:ea,Z_DATA_ERROR:ta,Z_MEM_ERROR:ra}=Zi;function na(e){this.options=Zo.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Vo,this.strm.avail_out=0;let r=Hs.inflateInit2(this.strm,t.windowBits);if(r!==Qs)throw new Error(Ni[r]);if(this.header=new Vs,Hs.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Ho.string2buf(t.dictionary):"[object ArrayBuffer]"===Js.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=Hs.inflateSetDictionary(this.strm,t.dictionary),r!==Qs)))throw new Error(Ni[r])}na.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize,i=this.options.dictionary;let o,s,a;if(this.ended)return!1;for(s=t===~~t?t:!0===t?Ys:qs,r.input="[object ArrayBuffer]"===Js.call(e)?new Uint8Array(e):e,r.next_in=0,r.avail_in=r.input.length;;){for(0===r.avail_out&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),o=Hs.inflate(r,s),o===$s&&i&&(o=Hs.inflateSetDictionary(r,i),o===Qs?o=Hs.inflate(r,s):o===ta&&(o=$s));r.avail_in>0&&o===Xs&&r.state.wrap>0&&0!==e[r.next_in];)Hs.inflateReset(r),o=Hs.inflate(r,s);switch(o){case ea:case ta:case $s:case ra:return this.onEnd(o),this.ended=!0,!1}if(a=r.avail_out,r.next_out&&(0===r.avail_out||o===Xs))if("string"===this.options.to){let e=Ho.utf8border(r.output,r.next_out),t=r.next_out-e,i=Ho.buf2string(r.output,e);r.next_out=t,r.avail_out=n-t,t&&r.output.set(r.output.subarray(e,e+t),0),this.onData(i)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(o!==Qs||0!==a){if(o===Xs)return o=Hs.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(0===r.avail_in)break}}return!0},na.prototype.onData=function(e){this.chunks.push(e)},na.prototype.onEnd=function(e){e===Qs&&(this.result="string"===this.options.to?this.chunks.join(""):Zo.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};const{deflate:ia}=ss;var oa=ia,sa=require("commander"),aa=require("./package.json"),ca=require("fs"),la=new sa.Command;la.version(aa.version,"-v, --version"),la.option("-i, --input [file]","path to input CityJSON file").option("-o, --output [file]","path to output XKT file"),la.on("--help",function(){console.log("\n\nXKT version: 10")}),la.parse(process.argv);var da=la.opts();function ua(e){da.log&&console.log(e)}void 0===da.input&&(console.error("[cityjson2xkt] Error: please specify a path to a CityJSON input file (-i)."),la.help(),process.exit(1)),void 0===da.output&&(console.error("[cityjson2xkt] Error: please specify output XKT file path (-o)."),la.help(),process.exit(1)),function(){try{var t;ua("[cityjson2xkt] Running cityjson2xkt v"+aa.version+"..."),ua("[cityjson2xkt] Reading CityJSON file "+da.input+"...");try{t=ca.readFileSync(da.input)}catch(e){console.error("[cityjson2xkt] Error reading CityJSON file: "+e),process.exit(1)}var r=(new v).createModel({id:"foo"});if(r instanceof e.SDKError)console.error("[cityjson2xkt] Error converting CityJSON file: "+r.message),process.exit(1);else{var n=(new yn).createModel({id:"foo"});n instanceof e.SDKError?(console.error("[cityjson2xkt] Error converting CityJSON file: "+n.message),process.exit(1)):function(t,r){if(void 0===r&&(r={rotateX:!1}),t.sceneModel){if(t.sceneModel.destroyed)throw new e.SDKError("SceneModel already destroyed");if(t.sceneModel.built)throw new e.SDKError("SceneModel already built")}if(t.dataModel){if(t.dataModel.destroyed)throw new e.SDKError("DataModel already destroyed");if(t.dataModel.built)throw new e.SDKError("DataModel already built")}return new Promise(function(e,n){var i=t.fileData;!function(e){var t=e.fileData.CityObjects;for(var r in t)Qn(e,t[r],r);if(e.dataModel)for(var n in t)Xn(e,t[n],n)}({fileData:i,vertices:i.transform&&t.sceneModel?Yn(i.vertices,i.transform,r.rotateX):i.vertices,sceneModel:t.sceneModel,dataModel:t.dataModel,nextId:0}),e()})}({fileData:t,dataModel:r,sceneModel:n}).then(function(){n.build().then(function(){r.build();var t=function(t){if(t.sceneModel.destroyed)throw new e.SDKError("SceneModel already destroyed");if(!t.sceneModel.built)throw new e.SDKError("SceneModel not yet built");if(t.dataModel){if(t.dataModel.destroyed)throw new e.SDKError("DataModel already destroyed");if(!t.dataModel.built)throw new e.SDKError("DataModel not yet built")}return n=function(e){for(var t,r=e.sceneModel,n=e.dataModel,i=Object.values(r.geometries),o=Object.values(r.textures),s=Object.values(r.textureSets),a=Object.values(r.meshes),c=Object.values(r.objects),l=i.length,d=o.length,u=s.length,h=a.length,f=c.length,p=0,g=0,y=0,m=0,v=0,w=0,b=0,_=0,x=0,k=0,S={},M={},E={},T=0;T<l;T++){var D=i[T].geometryBuckets;p+=D.length;for(var A=0,B=D.length;A<B;A++){var j=D[A];if(j.positionsCompressed){var I=j.positionsCompressed.length/3;g+=j.positionsCompressed.length,j.indices&&(I<=256?m+=j.indices.length:I<=65536?v+=j.indices.length:w+=j.indices.length),j.edgeIndices&&(I<=256?b+=j.edgeIndices.length:I<=65536?_+=j.edgeIndices.length:x+=j.edgeIndices.length),j.uvsCompressed&&(y+=j.uvsCompressed.length)}}}for(var O=0;O<d;O++)k+=o[O].imageData.byteLength;t=16*l;var C={metadata:n?n.getJSON():{},textureData:new Uint8Array(k),eachTextureDataPortion:new Uint32Array(d),eachTextureAttributes:new Uint16Array(9*d),positions:new Uint16Array(g),colors:new Uint8Array(0),uvs:new Float32Array(y),indices8Bit:new Uint8Array(m),indices16Bit:new Uint16Array(v),indices32Bit:new Uint32Array(w),edgeIndices8Bit:new Uint8Array(b),edgeIndices16Bit:new Uint16Array(_),edgeIndices32Bit:new Uint32Array(x),eachTextureSetTextures:new Int32Array(5*u),decodeMatrices:new Float32Array(t),eachBucketPositionsPortion:new Uint32Array(p),eachBucketColorsPortion:new Uint32Array(p),eachBucketUVsPortion:new Uint32Array(p),eachBucketIndicesPortion:new Uint32Array(p),eachBucketEdgeIndicesPortion:new Uint32Array(p),eachBucketIndicesBitness:new Uint8Array(p),eachGeometryPrimitiveType:new Uint8Array(l),eachGeometryBucketPortion:new Uint32Array(l),eachGeometryDecodeMatricesPortion:new Uint32Array(l),matrices:new Float32Array(0),eachMeshGeometriesPortion:new Uint32Array(h),eachMeshMatricesPortion:new Uint32Array(h),eachMeshTextureSet:new Uint32Array(h),eachMeshMaterialAttributes:new Uint8Array(6*h),eachObjectId:[],eachObjectMeshesPortion:new Uint32Array(f)},P=0,R=0,U=0,F=0,z=0,L=0,K=0,N=0,Z=0,G=0,W=0,H=0;for(var V in r.geometries){var J=r.geometries[V],q=J.geometryBuckets;C.eachGeometryPrimitiveType[H]=J.primitive,C.eachGeometryBucketPortion[H]=P,C.eachGeometryDecodeMatricesPortion[H]=W,C.decodeMatrices.set(J.positionsDecompressMatrix,W),W+=16;for(var Y=0,Q=q.length;Y<Q;Y++){var X=q[Y],$=X.positionsCompressed.length/3,ee=$<=256?0:$<=65536?1:2;if(C.eachBucketPositionsPortion[P]=R,C.eachBucketColorsPortion[P]=U,C.eachBucketUVsPortion[P]=F,C.eachBucketIndicesBitness[P]=ee,C.positions.set(X.positionsCompressed,R),R+=X.positionsCompressed.length,X.indices)switch(ee){case 0:C.indices8Bit.set(X.indices,z),C.eachBucketIndicesPortion[H]=z,z+=X.indices.length;break;case 1:C.indices16Bit.set(X.indices,L),C.eachBucketIndicesPortion[H]=L,L+=X.indices.length;break;case 2:C.indices32Bit.set(X.indices,K),C.eachBucketIndicesPortion[H]=K,K+=X.indices.length}if(X.edgeIndices)switch(ee){case 0:C.edgeIndices8Bit.set(X.edgeIndices,N),C.eachBucketEdgeIndicesPortion[H]=N,N+=X.edgeIndices.length;break;case 1:C.edgeIndices16Bit.set(X.edgeIndices,Z),C.eachBucketEdgeIndicesPortion[H]=Z,Z+=X.edgeIndices.length;break;case 2:C.edgeIndices32Bit.set(X.edgeIndices,G),C.eachBucketEdgeIndicesPortion[H]=G,G+=X.edgeIndices.length}X.colorsCompressed&&(C.colors.set(X.colorsCompressed,U),U+=X.colorsCompressed.length),X.uvsCompressed&&(C.uvs.set(X.uvsCompressed,F),F+=X.uvsCompressed.length),P++}S[J.id]=H,H++}for(var te=0,re=o.length,ne=0;te<re;te++){var ie=o[te],oe=ie.imageData;C.textureData.set(oe,ne),C.eachTextureDataPortion[te]=ne,ne+=oe.byteLength;var se=9*te;C.eachTextureAttributes[se++]=ie.compressed?1:0,C.eachTextureAttributes[se++]=ie.mediaType||0,C.eachTextureAttributes[se++]=ie.width,C.eachTextureAttributes[se++]=ie.height,C.eachTextureAttributes[se++]=ie.minFilter||1008,C.eachTextureAttributes[se++]=ie.magFilter||1008,C.eachTextureAttributes[se++]=ie.wrapS||Ae,C.eachTextureAttributes[se++]=ie.wrapT||Ae,C.eachTextureAttributes[se++]=ie.wrapR||Ae,M[ie.id]=te}for(var ae=0,ce=s.length,le=0;ae<ce;ae++){var de=s[ae];C.eachTextureSetTextures[le++]=de.colorTexture?M[de.colorTexture.id]:-1,C.eachTextureSetTextures[le++]=de.metallicRoughnessTexture?M[de.metallicRoughnessTexture.id]:-1,C.eachTextureSetTextures[le++]=de.emissiveTexture?M[de.emissiveTexture.id]:-1,C.eachTextureSetTextures[le++]=de.occlusionTexture?M[de.occlusionTexture.id]:-1,E[de.id]=ae}for(var ue=0,he=0,fe=0,pe=0;pe<f;pe++){var ge=c[pe],ye=ge.meshes.length;C.eachObjectId[pe]=ge.id,C.eachObjectMeshesPortion[pe]=fe;for(var me=0;me<ye;me++){var ve=ge.meshes[me];C.eachMeshGeometriesPortion[me]=S[ve.geometry.id],C.eachMeshMatricesPortion[me]=he,C.matrices.set(ve.matrix,he),he+=16,C.eachMeshTextureSet[me]=ve.textureSet?E[ve.textureSet.id]:-1,C.eachMeshMaterialAttributes[ue++]=255*ve.color[0],C.eachMeshMaterialAttributes[ue++]=255*ve.color[1],C.eachMeshMaterialAttributes[ue++]=255*ve.color[2],C.eachMeshMaterialAttributes[ue++]=255*ve.opacity,C.eachMeshMaterialAttributes[ue++]=255*ve.metallic,C.eachMeshMaterialAttributes[ue++]=255*ve.roughness}fe+=ye}return C}({sceneModel:t.sceneModel,dataModel:t.dataModel}),i=JSON.stringify(["{}"]).replace(/[\u007F-\uFFFF]/g,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).substr(-4)}),function(e){var t=new Uint32Array(e.length+2);t[0]=11,t[1]=e.length;for(var r=0,n=0,i=e.length;n<i;n++){var o=e[n].length;t[n+2]=o,r+=o}var s=new Uint8Array(t.buffer),a=new Uint8Array(s.length+r);a.set(s);for(var c=s.length,l=0,d=e.length;l<d;l++){var u=e[l];a.set(u,c),c+=u.length}return a.buffer}([(r={metadata:oa(i),textureData:oa(n.textureData.buffer),eachTextureDataPortion:oa(n.eachTextureDataPortion.buffer),eachTextureAttributes:oa(n.eachTextureAttributes.buffer),positions:oa(n.positions.buffer),colors:oa(n.colors.buffer),uvs:oa(n.uvs.buffer),indices8Bit:oa(n.indices8Bit.buffer),indices16Bit:oa(n.indices16Bit.buffer),indices32Bit:oa(n.indices32Bit.buffer),edgeIndices8Bit:oa(n.edgeIndices8Bit.buffer),edgeIndices16Bit:oa(n.edgeIndices16Bit.buffer),edgeIndices32Bit:oa(n.edgeIndices32Bit.buffer),eachTextureSetTextures:oa(n.eachTextureSetTextures.buffer),decodeMatrices:oa(n.decodeMatrices.buffer),eachBucketPositionsPortion:oa(n.eachBucketPositionsPortion.buffer),eachBucketColorsPortion:oa(n.eachBucketColorsPortion.buffer),eachBucketUVsPortion:oa(n.eachBucketUVsPortion.buffer),eachBucketIndicesPortion:oa(n.eachBucketIndicesPortion.buffer),eachBucketEdgeIndicesPortion:oa(n.eachBucketEdgeIndicesPortion.buffer),eachBucketIndicesBitness:oa(n.eachBucketIndicesBitness.buffer),eachGeometryPrimitiveType:oa(n.eachGeometryPrimitiveType.buffer),eachGeometryBucketPortion:oa(n.eachGeometryBucketPortion.buffer),eachGeometryDecodeMatricesPortion:oa(n.eachGeometryDecodeMatricesPortion.buffer),matrices:oa(n.matrices.buffer),eachMeshGeometriesPortion:oa(n.eachMeshGeometriesPortion.buffer),eachMeshMatricesPortion:oa(n.eachMeshMatricesPortion.buffer),eachMeshTextureSet:oa(n.eachMeshTextureSet.buffer),eachMeshMaterialAttributes:oa(n.eachMeshMaterialAttributes.buffer),eachObjectId:oa(JSON.stringify(n.eachObjectId).replace(/[\u007F-\uFFFF]/g,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).substr(-4)})),eachObjectMeshesPortion:oa(n.eachObjectMeshesPortion.buffer)}).metadata,r.textureData,r.eachTextureDataPortion,r.eachTextureAttributes,r.positions,r.colors,r.uvs,r.indices8Bit,r.indices16Bit,r.indices32Bit,r.edgeIndices8Bit,r.edgeIndices16Bit,r.edgeIndices32Bit,r.eachTextureSetTextures,r.decodeMatrices,r.eachBucketPositionsPortion,r.eachBucketColorsPortion,r.eachBucketUVsPortion,r.eachBucketIndicesPortion,r.eachBucketEdgeIndicesPortion,r.eachBucketIndicesBitness,r.eachGeometryPrimitiveType,r.eachGeometryBucketPortion,r.eachGeometryDecodeMatricesPortion,r.matrices,r.eachMeshGeometriesPortion,r.eachMeshMatricesPortion,r.eachMeshTextureSet,r.eachMeshMaterialAttributes,r.eachObjectId,r.eachObjectMeshesPortion]);var r,n,i}({dataModel:r,sceneModel:n}),i=function(e){var t=e.lastIndexOf("/");return 0!==t?e.substring(0,t+1):""}(da.output).trim();""===i||ca.existsSync(i)||ca.mkdirSync(i,{recursive:!0}),ca.writeFileSync(da.output,Buffer.from(t)),ua("[cityjson2xkt] Created XKT file: "+da.output),process.exit(0)}).catch(function(e){console.error("[cityjson2xkt] Error converting CityJSON file: "+e),process.exit(1)})}).catch(function(e){console.error("[cityjson2xkt] Error converting CityJSON file: "+e),process.exit(1)})}return Promise.resolve()}catch(e){return Promise.reject(e)}}().catch(function(e){console.error("Error:",e),process.exit(1)});
//# sourceMappingURL=cityjson2xkt.js.map
