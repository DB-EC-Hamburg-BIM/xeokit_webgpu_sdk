import{Map as t,isArray as e}from"@xeokit/utils";import{UnsignedByteType as i,UnsignedShort4444Type as r,UnsignedShort5551Type as a,ByteType as s,ShortType as n,UnsignedShortType as h,IntType as E,UnsignedIntType as o,FloatType as _,HalfFloatType as l,AlphaFormat as T,RGBAFormat as u,LuminanceFormat as d,LuminanceAlphaFormat as R,DepthFormat as f,DepthStencilFormat as A,RedFormat as S,RGBFormat as c,RedIntegerFormat as m,RGFormat as g,RGIntegerFormat as p,RGBAIntegerFormat as P,RGB_S3TC_DXT1_Format as v,RGBA_S3TC_DXT1_Format as x,RGBA_S3TC_DXT3_Format as M,RGBA_S3TC_DXT5_Format as U,sRGBEncoding as B,RGB_PVRTC_4BPPV1_Format as I,RGB_PVRTC_2BPPV1_Format as F,RGBA_PVRTC_4BPPV1_Format as C,RGBA_PVRTC_2BPPV1_Format as D,RGB_ETC1_Format as N,RGB_ETC2_Format as G,RGBA_ETC2_EAC_Format as b,RGBA_ASTC_4x4_Format as O,RGBA_ASTC_5x4_Format as X,RGBA_ASTC_5x5_Format as L,RGBA_ASTC_6x5_Format as y,RGBA_ASTC_6x6_Format as w,RGBA_ASTC_8x5_Format as H,RGBA_ASTC_8x6_Format as W,RGBA_ASTC_8x8_Format as K,RGBA_ASTC_10x5_Format as V,RGBA_ASTC_10x6_Format as Y,RGBA_ASTC_10x8_Format as k,RGBA_ASTC_10x10_Format as j,RGBA_ASTC_12x10_Format as z,RGBA_ASTC_12x12_Format as Z,RGBA_BPTC_Format as J,UnsignedInt248Type as q,RepeatWrapping as Q,ClampToEdgeWrapping as $,NearestMipMapNearestFilter as tt,NearestMipMapLinearFilter as et,LinearMipMapNearestFilter as it,LinearMipMapLinearFilter as rt,NearestFilter as at,LinearFilter as st,NearestMipmapNearestFilter as nt,NearestMipmapLinearFilter as ht}from"@xeokit/constants";var Et=/*#__PURE__*/function(){function t(t,e,i,r,a,s,n,h,E){switch(this.gl=void 0,this.itemType=void 0,this.itemByteSize=void 0,this.type=void 0,this.allocated=void 0,this.usage=void 0,this.length=void 0,this.dataLength=void 0,this.numItems=void 0,this.itemSize=void 0,this.normalized=void 0,this.stride=void 0,this.offset=void 0,this.handle=void 0,this.gl=t,this.type=e,this.allocated=!1,i.constructor){case Uint8Array:this.itemType=t.UNSIGNED_BYTE,this.itemByteSize=1;break;case Int8Array:this.itemType=t.BYTE,this.itemByteSize=1;break;case Uint16Array:this.itemType=t.UNSIGNED_SHORT,this.itemByteSize=2;break;case Int16Array:this.itemType=t.SHORT,this.itemByteSize=2;break;case Uint32Array:this.itemType=t.UNSIGNED_INT,this.itemByteSize=4;break;case Int32Array:this.itemType=t.INT,this.itemByteSize=4;break;default:this.itemType=t.FLOAT,this.itemByteSize=4}this.usage=s,this.length=0,this.dataLength=r,this.numItems=0,this.itemSize=a,this.normalized=!!n,this.stride=h||0,this.offset=E||0,this._allocate(i)}var e=t.prototype;return e._allocate=function(t){if(this.allocated=!1,this.handle=this.gl.createBuffer(),!this.handle)throw new Error("Failed to allocate WebGL ArrayBuffer");this.handle&&(this.gl.bindBuffer(this.type,this.handle),this.gl.bufferData(this.type,t.length>this.dataLength?t.slice(0,this.dataLength):t,this.usage),this.gl.bindBuffer(this.type,null),this.length=t.length,this.numItems=this.length/this.itemSize,this.allocated=!0)},e.setData=function(t,e){this.allocated&&(t.length+(e||0)>this.length?(this.destroy(),this._allocate(t)):(this.gl.bindBuffer(this.type,this.handle),e||0===e?this.gl.bufferSubData(this.type,e*this.itemByteSize,t):this.gl.bufferData(this.type,t,this.usage),this.gl.bindBuffer(this.type,null)))},e.bind=function(){this.allocated&&this.gl.bindBuffer(this.type,this.handle)},e.unbind=function(){this.allocated&&this.gl.bindBuffer(this.type,null)},e.destroy=function(){this.allocated&&(this.gl.deleteBuffer(this.handle),this.allocated=!1)},t}(),ot=/*#__PURE__*/function(){function t(t,e){this.gl=void 0,this.location=void 0,this.gl=t,this.location=e}return t.prototype.bindArrayBuffer=function(t){t&&(t.bind(),this.gl.enableVertexAttribArray(this.location),this.gl.vertexAttribPointer(this.location,t.itemSize,t.itemType,t.normalized,t.stride,t.offset))},t}(),_t=0;function lt(t){return"__private_"+_t+++"_"+t}function Tt(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var ut=/*#__PURE__*/lt("onDestroyed"),dt=/*#__PURE__*/function(){function t(t){void 0===t&&(t={}),this.gl=void 0,this.texture=void 0,this.textureWidth=void 0,this.textureHeight=void 0,this.textureData=void 0,Object.defineProperty(this,ut,{writable:!0,value:void 0}),this.gl=t.gl,this.texture=t.texture,this.textureWidth=t.textureWidth,this.textureHeight=t.textureHeight,this.textureData=t.textureData,Tt(this,ut)[ut]=t.onDestroyed}var e=t.prototype;return e.bindTexture=function(t,e,i){this.gl&&e.bindTexture(this,i)},e.bind=function(t){return!(!this.gl||!this.texture||(this.gl.activeTexture(this.gl["TEXTURE"+t]),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),0))},e.disableFiltering=function(){this.gl&&(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE))},e.unbind=function(t){},e.destroy=function(){this.gl&&this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null,Tt(this,ut)[ut]&&Tt(this,ut)[ut]())},t}(),Rt=/*#__PURE__*/function(){function t(t,e,i){if(this.errors=void 0,this.allocated=void 0,this.compiled=void 0,this.handle=void 0,this.allocated=!1,this.compiled=!1,this.handle=t.createShader(e),this.handle){if(this.allocated=!0,t.shaderSource(this.handle,i),t.compileShader(this.handle),this.compiled=t.getShaderParameter(this.handle,t.COMPILE_STATUS),!this.compiled&&!t.isContextLost()){for(var r=i.split("\n"),a=[],s=0;s<r.length;s++)a.push(s+1+": "+r[s]+"\n");this.errors=[],this.errors.push(""),this.errors.push(t.getShaderInfoLog(this.handle)||""),this.errors=this.errors.concat(a.join(""))}}else this.errors=["Failed to allocate"]}return t.prototype.destroy=function(){},t}(),ft=/*#__PURE__*/function(){function t(t,e){this.location=void 0,this.gl=void 0,this.gl=t,this.location=e}return t.prototype.bindTexture=function(t,e){return!!t.bind(e)&&(this.gl.uniform1i(this.location,e),!0)},t}(),At=new t({},""),St=/*#__PURE__*/function(){function t(t,e){if(this.id=void 0,this.vertexShader=void 0,this.fragmentShader=void 0,this.attributes=void 0,this.samplers=void 0,this.uniforms=void 0,this.errors=void 0,this.validated=void 0,this.linked=void 0,this.compiled=void 0,this.allocated=void 0,this.gl=void 0,this.source=void 0,this.handle=void 0,this.id=At.addItem({}),this.source=e,this.gl=t,this.allocated=!1,this.compiled=!1,this.linked=!1,this.validated=!1,this.errors=[],this.uniforms={},this.samplers={},this.attributes={},this.vertexShader=new Rt(t,t.VERTEX_SHADER,this.source.vertex),this.fragmentShader=new Rt(t,t.FRAGMENT_SHADER,this.source.fragment),!this.vertexShader.allocated)return this.errors=["Vertex shader failed to allocate"].concat(this.vertexShader.errors),void ct(this.errors);if(!this.fragmentShader.allocated)return this.errors=["Fragment shader failed to allocate"].concat(this.fragmentShader.errors),void ct(this.errors);if(this.allocated=!0,!this.vertexShader.compiled)return this.errors=["Vertex shader failed to compile"].concat(this.vertexShader.errors),void ct(this.errors);if(!this.fragmentShader.compiled)return this.errors=["Fragment shader failed to compile"].concat(this.fragmentShader.errors),void ct(this.errors);if(this.compiled=!0,this.handle=t.createProgram(),this.handle){if(t.attachShader(this.handle,this.vertexShader.handle),t.attachShader(this.handle,this.fragmentShader.handle),t.linkProgram(this.handle),this.linked=t.getProgramParameter(this.handle,t.LINK_STATUS),this.validated=!0,!this.linked||!this.validated)return this.errors=[],this.errors.push(""),this.errors.push(t.getProgramInfoLog(this.handle)),this.errors.push("\nVertex shader:\n"),this.errors=this.errors.concat(this.source.vertex),this.errors.push("\nFragment shader:\n"),this.errors=this.errors.concat(this.source.fragment),void ct(this.errors);for(var i=t.getProgramParameter(this.handle,t.ACTIVE_UNIFORMS),r=0;r<i;++r){var a=t.getActiveUniform(this.handle,r);if(a){var s=a.name;"\0"===s[s.length-1]&&(s=s.substr(0,s.length-1));var n=t.getUniformLocation(this.handle,s);a.type===t.SAMPLER_2D||a.type===t.SAMPLER_CUBE||35682===a.type?this.samplers[s]=new ft(t,n):this.uniforms[s]=n}}for(var h=t.getProgramParameter(this.handle,t.ACTIVE_ATTRIBUTES),E=0;E<h;E++){var o=t.getActiveAttrib(this.handle,E);if(o){var _=t.getAttribLocation(this.handle,o.name);this.attributes[o.name]=new ot(t,_)}}this.allocated=!0}else this.errors=["Failed to allocate program"]}var e=t.prototype;return e.bind=function(){this.allocated&&this.gl.useProgram(this.handle)},e.getLocation=function(t){return this.uniforms[t]},e.getAttribute=function(t){return this.attributes[t]},e.getSampler=function(t){return this.samplers[t]},e.bindTexture=function(t,e,i){if(!this.allocated)return!1;var r=this.samplers[t];return!!r&&r.bindTexture(e,i)},e.destroy=function(){this.allocated&&(At.removeItem(this.id),this.gl.deleteProgram(this.handle),this.gl.deleteShader(this.vertexShader.handle),this.gl.deleteShader(this.fragmentShader.handle),this.attributes={},this.uniforms={},this.samplers={},this.allocated=!1)},t}();function ct(t){console.error(t.join("\n"))}var mt=function(){var t=document.createElement("canvas"),e=String.fromCharCode;if(!t.getContext)return{saveAsBMP:function(){},saveAsPNG:function(){},saveAsJPEG:function(){}};var i=!!t.getContext("2d").getImageData,r=!!t.toDataURL,a=!!window.btoa,s=function(t){window.open(t)||(document.location.href=t)},n=function(t,e){return"data:"+e+";base64,"+t},h=function(t){var e=document.createElement("img");return e.src=t,e},E=function(t,e,i,r){if(e&&i){var a=document.createElement("canvas");a.width=e,a.height=i,a.style.width=e+"px",a.style.height=i+"px";var s=a.getContext("2d");return r?(s.save(),s.scale(1,-1),s.imageSmoothingEnabled=!0,s.drawImage(t,0,0,t.width,t.height,0,0,e,-i),s.restore()):(s.imageSmoothingEnabled=!0,s.drawImage(t,0,0,t.width,t.height,0,0,e,i)),a}return t};return{saveAsPNG:function(t,e,i,a,n){if(!r)return!1;var o=E(t,i,a,n).toDataURL("image/png");return e?h(o):(s(o),!0)},saveAsJPEG:function(t,e,i,a,n){if(!r)return!1;var o="image/jpeg",_=E(t,i,a,n).toDataURL(o);return 5==_.indexOf(o)&&(e?h(_):(s(_),!0))},saveAsBMP:function(t,o,_,l,T){if(!(r&&i&&a))return!1;var u="image/bmp",d=function(t){var e=parseInt(t.width),i=parseInt(t.height);return t.getContext("2d").getImageData(0,0,e,i)}(E(t,_,l,T)),R=function(t){var i="",r=t.width,a=t.height;i+="BM";var s=r*a*4+54;i+=e(s%256),s=Math.floor(s/256),i+=e(s%256),s=Math.floor(s/256),i+=e(s%256),s=Math.floor(s/256),i+=e(s%256),i+=e(0,0,0,0,54,0,0,0),i+=e(40,0,0,0);var n=r;i+=e(n%256),n=Math.floor(n/256),i+=e(n%256),n=Math.floor(n/256),i+=e(n%256),n=Math.floor(n/256),i+=e(n%256);var h=a;i+=e(h%256),h=Math.floor(h/256),i+=e(h%256),h=Math.floor(h/256),i+=e(h%256),h=Math.floor(h/256),i+=e(h%256),i+=e(1,0,32,0),i+=e(0,0,0,0);var E=r*a*4;i+=e(E%256),E=Math.floor(E/256),i+=e(E%256),E=Math.floor(E/256),i+=e(E%256),E=Math.floor(E/256),i+=e(E%256),i+=e(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var o,_,l,T,u=t.data,d="",R=a;do{for(l=r*(R-1)*4,T="",o=0;o<r;o++)T+=e(u[l+(_=4*o)+2],u[l+_+1],u[l+_],u[l+_+3]);d+=T}while(--R);return function(t){var i,r,a="";if("string"==typeof t)a=t;else for(r=t,i=0;i<r.length;i++)a+=e(r[i]);return btoa(a)}(i+d)}(d);return o?h(n(R,u)):(s(n(R,u)),!0)}}}(),gt=/*#__PURE__*/lt("canvas"),pt=/*#__PURE__*/lt("gl"),Pt=/*#__PURE__*/lt("allocated"),vt=/*#__PURE__*/lt("buffer"),xt=/*#__PURE__*/lt("bound"),Mt=/*#__PURE__*/lt("size"),Ut=/*#__PURE__*/lt("hasDepthTexture"),Bt=/*#__PURE__*/lt("imageDataCache"),It=/*#__PURE__*/lt("texture"),Ft=/*#__PURE__*/lt("depthTexture"),Ct=/*#__PURE__*/lt("touch"),Dt=/*#__PURE__*/lt("getImageDataCache"),Nt=/*#__PURE__*/function(){function t(t,e,i){Object.defineProperty(this,Dt,{value:bt}),Object.defineProperty(this,Ct,{value:Gt}),Object.defineProperty(this,gt,{writable:!0,value:void 0}),Object.defineProperty(this,pt,{writable:!0,value:void 0}),Object.defineProperty(this,Pt,{writable:!0,value:void 0}),Object.defineProperty(this,vt,{writable:!0,value:void 0}),Object.defineProperty(this,xt,{writable:!0,value:void 0}),Object.defineProperty(this,Mt,{writable:!0,value:void 0}),Object.defineProperty(this,Ut,{writable:!0,value:void 0}),Object.defineProperty(this,Bt,{writable:!0,value:void 0}),Object.defineProperty(this,It,{writable:!0,value:void 0}),Object.defineProperty(this,Ft,{writable:!0,value:void 0}),Tt(this,gt)[gt]=t,Tt(this,pt)[pt]=e,Tt(this,Pt)[Pt]=!1,Tt(this,vt)[vt]=null,Tt(this,xt)[xt]=!1,Tt(this,Mt)[Mt]=i.size,Tt(this,Ut)[Ut]=!!i.depthTexture}var e=t.prototype;return e.setSize=function(t){Tt(this,Mt)[Mt]=t},e.bind=function(){if(Tt(this,Ct)[Ct](),!Tt(this,xt)[xt]){var t=Tt(this,pt)[pt];t.bindFramebuffer(t.FRAMEBUFFER,Tt(this,vt)[vt].framebuf),Tt(this,xt)[xt]=!0}},e.clear=function(){if(!Tt(this,xt)[xt])throw"Render buffer not bound";var t=Tt(this,pt)[pt];t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},e.read=function(t,e){var i=t,r=Tt(this,pt)[pt].drawingBufferHeight-e,a=new Uint8Array(4),s=Tt(this,pt)[pt];return s.readPixels(i,r,1,1,s.RGBA,s.UNSIGNED_BYTE,a),a},e.readImage=function(t){var e=Tt(this,pt)[pt],i=Tt(this,Dt)[Dt](),r=i.pixelData,a=i.canvas,s=i.imageData,n=i.context;e.readPixels(0,0,Tt(this,vt)[vt].width,Tt(this,vt)[vt].height,e.RGBA,e.UNSIGNED_BYTE,r),s.data.set(r),n.putImageData(s,0,0);var h,E=t.width||a.width,o=t.height||a.height,_=t.format||"jpeg",l=!0;switch(_){case"jpeg":h=mt.saveAsJPEG(a,!0,E,o,l);break;case"png":h=mt.saveAsPNG(a,!0,E,o,l);break;case"bmp":h=mt.saveAsBMP(a,!0,E,o,l);break;default:console.error("Unsupported image format: '"+_+"' - supported types are 'jpeg', 'bmp' and 'png' - defaulting to 'jpeg'"),h=mt.saveAsJPEG(a,!0,E,o,l)}return h.src},e.unbind=function(){var t=Tt(this,pt)[pt];t.bindFramebuffer(t.FRAMEBUFFER,null),Tt(this,xt)[xt]=!1},e.getTexture=function(){var t=this;return Tt(this,It)[It]||(Tt(this,It)[It]={bind:function(e){return!(!Tt(t,vt)[vt]||!Tt(t,vt)[vt].texture||(Tt(t,pt)[pt].activeTexture(Tt(t,pt)[pt]["TEXTURE"+e]),Tt(t,pt)[pt].bindTexture(Tt(t,pt)[pt].TEXTURE_2D,Tt(t,vt)[vt].texture),0))},unbind:function(e){Tt(t,vt)[vt]&&Tt(t,vt)[vt].texture&&(Tt(t,pt)[pt].activeTexture(Tt(t,pt)[pt]["TEXTURE"+e]),Tt(t,pt)[pt].bindTexture(Tt(t,pt)[pt].TEXTURE_2D,null))}})},e.hasDepthTexture=function(){return Tt(this,Ut)[Ut]},e.getDepthTexture=function(){var t=this;return Tt(this,Ut)[Ut]?Tt(this,Ft)[Ft]||(Tt(this,Ft)[Ft]={bind:function(e){return!(!Tt(t,vt)[vt]||!Tt(t,vt)[vt].depthTexture||(Tt(t,pt)[pt].activeTexture(Tt(t,pt)[pt]["TEXTURE"+e]),Tt(t,pt)[pt].bindTexture(Tt(t,pt)[pt].TEXTURE_2D,Tt(t,vt)[vt].depthTexture),0))},unbind:function(e){Tt(t,vt)[vt]&&Tt(t,vt)[vt].depthTexture&&(Tt(t,pt)[pt].activeTexture(Tt(t,pt)[pt]["TEXTURE"+e]),Tt(t,pt)[pt].bindTexture(Tt(t,pt)[pt].TEXTURE_2D,null))}}):null},e.destroy=function(){if(Tt(this,Pt)[Pt]){var t=Tt(this,pt)[pt];t.deleteTexture(Tt(this,vt)[vt].texture),t.deleteTexture(Tt(this,vt)[vt].depthTexture),t.deleteFramebuffer(Tt(this,vt)[vt].framebuf),t.deleteRenderbuffer(Tt(this,vt)[vt].renderbuf),Tt(this,Pt)[Pt]=!1,Tt(this,vt)[vt]=null,Tt(this,xt)[xt]=!1}Tt(this,Bt)[Bt]=null},t}();function Gt(){var t,e,i=Tt(this,pt)[pt];if(Tt(this,Mt)[Mt]?(t=Tt(this,Mt)[Mt][0],e=Tt(this,Mt)[Mt][1]):(t=i.drawingBufferWidth,e=i.drawingBufferHeight),Tt(this,vt)[vt]){if(Tt(this,vt)[vt].width===t&&Tt(this,vt)[vt].height===e)return;i.deleteTexture(Tt(this,vt)[vt].texture),i.deleteFramebuffer(Tt(this,vt)[vt].framebuf),i.deleteRenderbuffer(Tt(this,vt)[vt].renderbuf)}var r,a=i.createTexture();i.bindTexture(i.TEXTURE_2D,a),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null),Tt(this,Ut)[Ut]&&(r=i.createTexture(),i.bindTexture(i.TEXTURE_2D,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.DEPTH_COMPONENT,t,e,0,i.DEPTH_COMPONENT,i.UNSIGNED_INT,null));var s=i.createRenderbuffer();i.bindRenderbuffer(i.RENDERBUFFER,s),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,t,e);var n=i.createFramebuffer();if(i.bindFramebuffer(i.FRAMEBUFFER,n),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,a,0),Tt(this,Ut)[Ut]?i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,r,0):i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,s),i.bindTexture(i.TEXTURE_2D,null),i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,n),!i.isFramebuffer(n))throw"Invalid framebuffer";i.bindFramebuffer(i.FRAMEBUFFER,null);var h=i.checkFramebufferStatus(i.FRAMEBUFFER);switch(h){case i.FRAMEBUFFER_COMPLETE:break;case i.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case i.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case i.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case i.FRAMEBUFFER_UNSUPPORTED:throw"Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED";default:throw"Incomplete framebuffer: "+h}Tt(this,vt)[vt]={framebuf:n,renderbuf:s,texture:a,depthTexture:r,width:t,height:e},Tt(this,xt)[xt]=!1}function bt(){var t=Tt(this,vt)[vt].width,e=Tt(this,vt)[vt].height,i=Tt(this,Bt)[Bt];if(i&&(i.width===t&&i.height===e||(Tt(this,Bt)[Bt]=null,i=null)),!i){var r=document.createElement("canvas");r.width=t,r.height=e;var a=r.getContext("2d"),s=a.createImageData(t,e);i={pixelData:new Uint8Array(t*e*4),canvas:r,context:a,imageData:s,width:t,height:e},Tt(this,Bt)[Bt]=i}return i}function Ot(t,e){if(void 0===t._cachedExtensions&&(t._cachedExtensions={}),void 0!==t._cachedExtensions[e])return t._cachedExtensions[e];var i;switch(e){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=t.getExtension(e)}return t._cachedExtensions[e]=i,i}function Xt(t,e,nt){var ht,Et=e;if(Et===i)return t.UNSIGNED_BYTE;if(Et===r)return t.UNSIGNED_SHORT_4_4_4_4;if(Et===a)return t.UNSIGNED_SHORT_5_5_5_1;if(Et===s)return t.BYTE;if(Et===n)return t.SHORT;if(Et===h)return t.UNSIGNED_SHORT;if(Et===E)return t.INT;if(Et===o)return t.UNSIGNED_INT;if(Et===_)return t.FLOAT;if(Et===l)return t.HALF_FLOAT;if(Et===T)return t.ALPHA;if(Et===u)return t.RGBA;if(Et===d)return t.LUMINANCE;if(Et===R)return t.LUMINANCE_ALPHA;if(Et===f)return t.DEPTH_COMPONENT;if(Et===A)return t.DEPTH_STENCIL;if(Et===S)return t.RED;if(Et===c)return t.RGBA;if(Et===m)return t.RED_INTEGER;if(Et===g)return t.RG;if(Et===p)return t.RG_INTEGER;if(Et===P)return t.RGBA_INTEGER;if(Et===v||Et===x||Et===M||Et===U)if(nt===B){var ot=Ot(t,"WEBGL_compressed_texture_s3tc_srgb");if(null===ot)return null;if(Et===v)return ot.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(Et===x)return ot.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(Et===M)return ot.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(Et===U)return ot.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(ht=Ot(t,"WEBGL_compressed_texture_s3tc")))return null;if(Et===v)return ht.COMPRESSED_RGB_S3TC_DXT1_EXT;if(Et===x)return ht.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(Et===M)return ht.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(Et===U)return ht.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(Et===I||Et===F||Et===C||Et===D){var _t=Ot(t,"WEBGL_compressed_texture_pvrtc");if(null===_t)return null;if(Et===I)return _t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(Et===F)return _t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(Et===C)return _t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(Et===D)return _t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(Et===N){var lt=Ot(t,"WEBGL_compressed_texture_etc1");return null!==lt?lt.COMPRESSED_RGB_ETC1_WEBGL:null}if(Et===G||Et===b){var Tt=Ot(t,"WEBGL_compressed_texture_etc");if(null===Tt)return null;if(Et===G)return nt===B?Tt.COMPRESSED_SRGB8_ETC2:Tt.COMPRESSED_RGB8_ETC2;if(Et===b)return nt===B?Tt.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:Tt.COMPRESSED_RGBA8_ETC2_EAC}if(Et===O||Et===X||Et===L||Et===y||Et===w||Et===H||Et===W||Et===K||Et===V||Et===Y||Et===k||Et===j||Et===z||Et===Z){var ut=Ot(t,"WEBGL_compressed_texture_astc");if(null===ut)return null;if(Et===O)return nt===B?ut.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:ut.COMPRESSED_RGBA_ASTC_4x4_KHR;if(Et===X)return nt===B?ut.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:ut.COMPRESSED_RGBA_ASTC_5x4_KHR;if(Et===L)return nt===B?ut.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:ut.COMPRESSED_RGBA_ASTC_5x5_KHR;if(Et===y)return nt===B?ut.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:ut.COMPRESSED_RGBA_ASTC_6x5_KHR;if(Et===w)return nt===B?ut.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:ut.COMPRESSED_RGBA_ASTC_6x6_KHR;if(Et===H)return nt===B?ut.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:ut.COMPRESSED_RGBA_ASTC_8x5_KHR;if(Et===W)return nt===B?ut.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:ut.COMPRESSED_RGBA_ASTC_8x6_KHR;if(Et===K)return nt===B?ut.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:ut.COMPRESSED_RGBA_ASTC_8x8_KHR;if(Et===V)return nt===B?ut.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:ut.COMPRESSED_RGBA_ASTC_10x5_KHR;if(Et===Y)return nt===B?ut.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:ut.COMPRESSED_RGBA_ASTC_10x6_KHR;if(Et===k)return nt===B?ut.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:ut.COMPRESSED_RGBA_ASTC_10x8_KHR;if(Et===j)return nt===B?ut.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:ut.COMPRESSED_RGBA_ASTC_10x10_KHR;if(Et===z)return nt===B?ut.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:ut.COMPRESSED_RGBA_ASTC_12x10_KHR;if(Et===Z)return nt===B?ut.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:ut.COMPRESSED_RGBA_ASTC_12x12_KHR}if(Et===J){var dt=Ot(t,"EXT_texture_compression_bptc");if(null===dt)return null;if(Et===J)return nt===B?dt.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:dt.COMPRESSED_RGBA_BPTC_UNORM_EXT}return Et===q?t.UNSIGNED_INT_24_8:Et===Q?t.REPEAT:Et===$?t.CLAMP_TO_EDGE:Et===tt||Et===et?t.NEAREST_MIPMAP_LINEAR:Et===it?t.LINEAR_MIPMAP_NEAREST:Et===rt?t.LINEAR_MIPMAP_LINEAR:Et===at?t.NEAREST:Et===st?t.LINEAR:null}var Lt=new Uint8Array([0,0,0,1]),yt=/*#__PURE__*/function(){function t(t){this.gl=void 0,this.target=void 0,this.format=void 0,this.type=void 0,this.internalFormat=void 0,this.premultiplyAlpha=void 0,this.flipY=void 0,this.unpackAlignment=void 0,this.wrapS=void 0,this.wrapT=void 0,this.wrapR=void 0,this.texture=void 0,this.allocated=void 0,this.minFilter=void 0,this.magFilter=void 0,this.encoding=void 0,this.gl=t.gl,this.target=t.target||t.gl.TEXTURE_2D,this.format=t.format||u,this.type=t.type||i,this.internalFormat=-1,this.premultiplyAlpha=!!t.premultiplyAlpha,this.flipY=!!t.flipY,this.unpackAlignment=4,this.wrapS=t.wrapS||Q,this.wrapT=t.wrapT||Q,this.wrapR=t.wrapR||Q,this.texture=t.gl.createTexture(),t.preloadColor&&this.setPreloadColor(t.preloadColor),this.allocated=!0}var r=t.prototype;return r.setPreloadColor=function(t){t?(Lt[0]=Math.floor(255*t[0]),Lt[1]=Math.floor(255*t[1]),Lt[2]=Math.floor(255*t[2]),Lt[3]=Math.floor(255*(void 0!==t[3]?t[3]:1))):(Lt[0]=0,Lt[1]=0,Lt[2]=0,Lt[3]=255);var e=this.gl;if(e.bindTexture(this.target,this.texture),this.target===e.TEXTURE_CUBE_MAP)for(var i=[e.TEXTURE_CUBE_MAP_POSITIVE_X,e.TEXTURE_CUBE_MAP_NEGATIVE_X,e.TEXTURE_CUBE_MAP_POSITIVE_Y,e.TEXTURE_CUBE_MAP_NEGATIVE_Y,e.TEXTURE_CUBE_MAP_POSITIVE_Z,e.TEXTURE_CUBE_MAP_NEGATIVE_Z],r=0,a=i.length;r<a;r++)e.texImage2D(i[r],0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,Lt);else e.texImage2D(this.target,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,Lt);e.bindTexture(this.target,null)},r.setTarget=function(t){this.target=t||this.gl.TEXTURE_2D},r.setImage=function(t,i){void 0===i&&(i={});var r=this.gl;void 0!==i.format&&(this.format=i.format),void 0!==i.internalFormat&&(this.internalFormat=i.internalFormat),void 0!==i.encoding&&(this.encoding=i.encoding),void 0!==i.type&&(this.type=i.type),void 0!==i.flipY&&(this.flipY=i.flipY),void 0!==i.premultiplyAlpha&&(this.premultiplyAlpha=i.premultiplyAlpha),void 0!==i.unpackAlignment&&(this.unpackAlignment=i.unpackAlignment),void 0!==i.minFilter&&(this.minFilter=i.minFilter),void 0!==i.magFilter&&(this.magFilter=i.magFilter),void 0!==i.wrapS&&(this.wrapS=i.wrapS),void 0!==i.wrapT&&(this.wrapT=i.wrapT),void 0!==i.wrapR&&(this.wrapR=i.wrapR),r.bindTexture(this.target,this.texture),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,this.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,this.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.NONE);var a=Xt(r,this.minFilter);r.texParameteri(this.target,r.TEXTURE_MIN_FILTER,a);var s=Xt(r,this.magFilter);s&&r.texParameteri(this.target,r.TEXTURE_MAG_FILTER,s);var n=Xt(r,this.wrapS);n&&r.texParameteri(this.target,r.TEXTURE_WRAP_S,n);var h=Xt(r,this.wrapT);h&&r.texParameteri(this.target,r.TEXTURE_WRAP_T,h);var E=Xt(r,this.format,this.encoding),o=Xt(r,this.type),_=wt(r,this.internalFormat,E,o,this.encoding,!1);if(this.target===r.TEXTURE_CUBE_MAP){if(e(t))for(var l=t,T=[r.TEXTURE_CUBE_MAP_POSITIVE_X,r.TEXTURE_CUBE_MAP_NEGATIVE_X,r.TEXTURE_CUBE_MAP_POSITIVE_Y,r.TEXTURE_CUBE_MAP_NEGATIVE_Y,r.TEXTURE_CUBE_MAP_POSITIVE_Z,r.TEXTURE_CUBE_MAP_NEGATIVE_Z],u=0,d=T.length;u<d;u++)r.texImage2D(T[u],0,_,E,o,l[u])}else r.texImage2D(r.TEXTURE_2D,0,_,E,o,t);r.bindTexture(this.target,null)},r.setCompressedData=function(t){var e=this.gl,i=t.mipmaps||[],r=i.length,a=t.props;void 0!==a.format&&(this.format=a.format),void 0!==a.internalFormat&&(this.internalFormat=a.internalFormat),void 0!==a.encoding&&(this.encoding=a.encoding),void 0!==a.type&&(this.type=a.type),void 0!==a.flipY&&(this.flipY=a.flipY),void 0!==a.premultiplyAlpha&&(this.premultiplyAlpha=a.premultiplyAlpha),void 0!==a.unpackAlignment&&(this.unpackAlignment=a.unpackAlignment),void 0!==a.minFilter&&(this.minFilter=a.minFilter),void 0!==a.magFilter&&(this.magFilter=a.magFilter),void 0!==a.wrapS&&(this.wrapS=a.wrapS),void 0!==a.wrapT&&(this.wrapT=a.wrapT),void 0!==a.wrapR&&(this.wrapR=a.wrapR),e.activeTexture(e.TEXTURE0+0),e.bindTexture(this.target,this.texture);var s=i.length>1;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,this.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,this.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE);var n=Xt(e,this.wrapS);n&&e.texParameteri(this.target,e.TEXTURE_WRAP_S,n);var h=Xt(e,this.wrapT);if(h&&e.texParameteri(this.target,e.TEXTURE_WRAP_T,h),this.type===e.TEXTURE_3D||this.type===e.TEXTURE_2D_ARRAY){var E=Xt(e,this.wrapR);E&&e.texParameteri(this.target,e.TEXTURE_WRAP_R,E),e.texParameteri(this.type,e.TEXTURE_WRAP_R,E)}s?(e.texParameteri(this.target,e.TEXTURE_MIN_FILTER,Ht(e,this.minFilter)),e.texParameteri(this.target,e.TEXTURE_MAG_FILTER,Ht(e,this.magFilter))):(e.texParameteri(this.target,e.TEXTURE_MIN_FILTER,Xt(e,this.minFilter)),e.texParameteri(this.target,e.TEXTURE_MAG_FILTER,Xt(e,this.magFilter)));var o=Xt(e,this.format,this.encoding),_=Xt(e,this.type),l=wt(e,this.internalFormat,o,_,this.encoding,!1);e.texStorage2D(e.TEXTURE_2D,r,l,i[0].width,i[0].height);for(var T=0,d=i.length;T<d;T++){var R=i[T];this.format!==u?null!==o?e.compressedTexSubImage2D(e.TEXTURE_2D,T,0,0,R.width,R.height,o,R.data):console.warn("Attempt to load unsupported compressed texture format in .setCompressedData()"):e.texSubImage2D(e.TEXTURE_2D,T,0,0,R.width,R.height,o,_,R.data)}e.bindTexture(this.target,null)},r.setProps=function(t){var e=this.gl;e.bindTexture(this.target,this.texture),this._uploadProps(t),e.bindTexture(this.target,null)},r._uploadProps=function(t){var e=this.gl;if(void 0!==t.format&&(this.format=t.format),void 0!==t.internalFormat&&(this.internalFormat=t.internalFormat),void 0!==t.encoding&&(this.encoding=t.encoding),void 0!==t.type&&(this.type=t.type),void 0!==t.minFilter){var i=Xt(e,t.minFilter);i&&(this.minFilter=t.minFilter,e.texParameteri(this.target,e.TEXTURE_MIN_FILTER,i),i!==e.NEAREST_MIPMAP_NEAREST&&i!==e.LINEAR_MIPMAP_NEAREST&&i!==e.NEAREST_MIPMAP_LINEAR&&i!==e.LINEAR_MIPMAP_LINEAR||e.generateMipmap(this.target))}if(void 0!==t.magFilter){var r=Xt(e,t.magFilter);r&&(this.magFilter=t.magFilter,e.texParameteri(this.target,e.TEXTURE_MAG_FILTER,r))}if(void 0!==t.wrapS){var a=Xt(e,t.wrapS);a&&(this.wrapS=t.wrapS,e.texParameteri(this.target,e.TEXTURE_WRAP_S,a))}if(void 0!==t.wrapT){var s=Xt(e,t.wrapT);s&&(this.wrapT=t.wrapT,e.texParameteri(this.target,e.TEXTURE_WRAP_T,s))}},r.bind=function(t){if(!this.allocated)return!1;if(this.texture){var e=this.gl;return e.activeTexture(e["TEXTURE"+t]),e.bindTexture(this.target,this.texture),!0}return!1},r.unbind=function(t){if(this.allocated&&this.texture){var e=this.gl;e.activeTexture(e["TEXTURE"+t]),e.bindTexture(this.target,null)}},r.destroy=function(){this.allocated&&this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null)},t}();function wt(t,e,i,r,a,s){if(void 0===s&&(s=!1),null!==e){if(void 0!==t[e])return t[e];console.warn("Attempt to use non-existing WebGL internal format '"+e+"'")}var n=i;return i===t.RED&&(r===t.FLOAT&&(n=t.R32F),r===t.HALF_FLOAT&&(n=t.R16F),r===t.UNSIGNED_BYTE&&(n=t.R8)),i===t.RG&&(r===t.FLOAT&&(n=t.RG32F),r===t.HALF_FLOAT&&(n=t.RG16F),r===t.UNSIGNED_BYTE&&(n=t.RG8)),i===t.RGBA&&(r===t.FLOAT&&(n=t.RGBA32F),r===t.HALF_FLOAT&&(n=t.RGBA16F),r===t.UNSIGNED_BYTE&&(n=a===B&&!1===s?t.SRGB8_ALPHA8:t.RGBA8),r===t.UNSIGNED_SHORT_4_4_4_4&&(n=t.RGBA4),r===t.UNSIGNED_SHORT_5_5_5_1&&(n=t.RGB5_A1)),n!==t.R16F&&n!==t.R32F&&n!==t.RG16F&&n!==t.RG32F&&n!==t.RGBA16F&&n!==t.RGBA32F||Ot(t,"EXT_color_buffer_float"),n}function Ht(t,e){return e===at||e===nt||e===ht?t.NEAREST:t.LINEAR}var Wt={WEBGL:!1,SUPPORTED_EXTENSIONS:{}},Kt=document.createElement("canvas");if(Kt){var Vt=Kt.getContext("webgl2",{antialias:!0});Wt.WEBGL=!!Vt,Wt.WEBGL&&(Wt.ANTIALIAS=Vt.getContextAttributes().antialias,Wt.FS_MAX_FLOAT_PRECISION=Vt.getShaderPrecisionFormat?Vt.getShaderPrecisionFormat(Vt.FRAGMENT_SHADER,Vt.HIGH_FLOAT).precision>0?"highp":Vt.getShaderPrecisionFormat(Vt.FRAGMENT_SHADER,Vt.MEDIUM_FLOAT).precision>0?"mediump":"lowp":"mediump",Wt.DEPTH_BUFFER_BITS=Vt.getParameter(Vt.DEPTH_BITS),Wt.MAX_TEXTURE_SIZE=Vt.getParameter(Vt.MAX_TEXTURE_SIZE),Wt.MAX_CUBE_MAP_SIZE=Vt.getParameter(Vt.MAX_CUBE_MAP_TEXTURE_SIZE),Wt.MAX_RENDERBUFFER_SIZE=Vt.getParameter(Vt.MAX_RENDERBUFFER_SIZE),Wt.MAX_TEXTURE_UNITS=Vt.getParameter(Vt.MAX_COMBINED_TEXTURE_IMAGE_UNITS),Wt.MAX_TEXTURE_IMAGE_UNITS=Vt.getParameter(Vt.MAX_TEXTURE_IMAGE_UNITS),Wt.MAX_VERTEX_ATTRIBS=Vt.getParameter(Vt.MAX_VERTEX_ATTRIBS),Wt.MAX_VERTEX_UNIFORM_VECTORS=Vt.getParameter(Vt.MAX_VERTEX_UNIFORM_VECTORS),Wt.MAX_FRAGMENT_UNIFORM_VECTORS=Vt.getParameter(Vt.MAX_FRAGMENT_UNIFORM_VECTORS),Wt.MAX_VARYING_VECTORS=Vt.getParameter(Vt.MAX_VARYING_VECTORS),Vt.getSupportedExtensions().forEach(function(t){Wt.SUPPORTED_EXTENSIONS[t]=!0}),Wt.depthTexturesSupported=Wt.SUPPORTED_EXTENSIONS.WEBGL_depth_texture)}export{mt as Canvas2Image,Et as GLArrayBuf,ot as GLAttribute,dt as GLDataTexture,St as GLProgram,Nt as GLRenderBuffer,ft as GLSampler,Rt as GLShader,yt as GLTexture,Wt as WEBGL_INFO,Xt as convertConstant,Ot as getExtension};
//# sourceMappingURL=index.es.map
