!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@xeokit/utils"),require("@xeokit/constants")):"function"==typeof define&&define.amd?define(["exports","@xeokit/utils","@xeokit/constants"],e):e((t||self).webglutils={},t.utils,t.constants)}(this,function(t,e,i){var r=/*#__PURE__*/function(){function t(t,e,i,r,a,n,s,_,o){switch(this.gl=void 0,this.itemType=void 0,this.itemByteSize=void 0,this.type=void 0,this.allocated=void 0,this.usage=void 0,this.length=void 0,this.dataLength=void 0,this.numItems=void 0,this.itemSize=void 0,this.normalized=void 0,this.stride=void 0,this.offset=void 0,this.handle=void 0,this.gl=t,this.type=e,this.allocated=!1,i.constructor){case Uint8Array:this.itemType=t.UNSIGNED_BYTE,this.itemByteSize=1;break;case Int8Array:this.itemType=t.BYTE,this.itemByteSize=1;break;case Uint16Array:this.itemType=t.UNSIGNED_SHORT,this.itemByteSize=2;break;case Int16Array:this.itemType=t.SHORT,this.itemByteSize=2;break;case Uint32Array:this.itemType=t.UNSIGNED_INT,this.itemByteSize=4;break;case Int32Array:this.itemType=t.INT,this.itemByteSize=4;break;default:this.itemType=t.FLOAT,this.itemByteSize=4}this.usage=n,this.length=0,this.dataLength=r,this.numItems=0,this.itemSize=a,this.normalized=!!s,this.stride=_||0,this.offset=o||0,this._allocate(i)}var e=t.prototype;return e._allocate=function(t){if(this.allocated=!1,this.handle=this.gl.createBuffer(),!this.handle)throw new Error("Failed to allocate WebGL ArrayBuffer");this.handle&&(this.gl.bindBuffer(this.type,this.handle),this.gl.bufferData(this.type,t.length>this.dataLength?t.slice(0,this.dataLength):t,this.usage),this.gl.bindBuffer(this.type,null),this.length=t.length,this.numItems=this.length/this.itemSize,this.allocated=!0)},e.setData=function(t,e){this.allocated&&(t.length+(e||0)>this.length?(this.destroy(),this._allocate(t)):(this.gl.bindBuffer(this.type,this.handle),e||0===e?this.gl.bufferSubData(this.type,e*this.itemByteSize,t):this.gl.bufferData(this.type,t,this.usage),this.gl.bindBuffer(this.type,null)))},e.bind=function(){this.allocated&&this.gl.bindBuffer(this.type,this.handle)},e.unbind=function(){this.allocated&&this.gl.bindBuffer(this.type,null)},e.destroy=function(){this.allocated&&(this.gl.deleteBuffer(this.handle),this.allocated=!1)},t}(),a=/*#__PURE__*/function(){function t(t,e){this.gl=void 0,this.location=void 0,this.gl=t,this.location=e}return t.prototype.bindArrayBuffer=function(t){t&&(t.bind(),this.gl.enableVertexAttribArray(this.location),this.gl.vertexAttribPointer(this.location,t.itemSize,t.itemType,t.normalized,t.stride,t.offset))},t}(),n=0;function s(t){return"__private_"+n+++"_"+t}function _(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var o=/*#__PURE__*/s("onDestroyed"),h=/*#__PURE__*/function(){function t(t){void 0===t&&(t={}),this.gl=void 0,this.texture=void 0,this.textureWidth=void 0,this.textureHeight=void 0,this.textureData=void 0,Object.defineProperty(this,o,{writable:!0,value:void 0}),this.gl=t.gl,this.texture=t.texture,this.textureWidth=t.textureWidth,this.textureHeight=t.textureHeight,this.textureData=t.textureData,_(this,o)[o]=t.onDestroyed}var e=t.prototype;return e.bindTexture=function(t,e,i){this.gl&&e.bindTexture(this,i)},e.bind=function(t){return!(!this.gl||!this.texture||(this.gl.activeTexture(this.gl["TEXTURE"+t]),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),0))},e.disableFiltering=function(){this.gl&&(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE))},e.unbind=function(t){},e.destroy=function(){this.gl&&this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null,_(this,o)[o]&&_(this,o)[o]())},t}(),E=/*#__PURE__*/function(){function t(t,e,i){if(this.errors=void 0,this.allocated=void 0,this.compiled=void 0,this.handle=void 0,this.allocated=!1,this.compiled=!1,this.handle=t.createShader(e),this.handle){if(this.allocated=!0,t.shaderSource(this.handle,i),t.compileShader(this.handle),this.compiled=t.getShaderParameter(this.handle,t.COMPILE_STATUS),!this.compiled&&!t.isContextLost()){for(var r=i.split("\n"),a=[],n=0;n<r.length;n++)a.push(n+1+": "+r[n]+"\n");this.errors=[],this.errors.push(""),this.errors.push(t.getShaderInfoLog(this.handle)||""),this.errors=this.errors.concat(a.join(""))}}else this.errors=["Failed to allocate"]}return t.prototype.destroy=function(){},t}(),T=/*#__PURE__*/function(){function t(t,e){this.location=void 0,this.gl=void 0,this.gl=t,this.location=e}return t.prototype.bindTexture=function(t,e){return!!t.bind(e)&&(this.gl.uniform1i(this.location,e),!0)},t}(),l=new e.Map({},""),R=/*#__PURE__*/function(){function t(t,e){if(this.id=void 0,this.vertexShader=void 0,this.fragmentShader=void 0,this.attributes=void 0,this.samplers=void 0,this.uniforms=void 0,this.errors=void 0,this.validated=void 0,this.linked=void 0,this.compiled=void 0,this.allocated=void 0,this.gl=void 0,this.source=void 0,this.handle=void 0,this.id=l.addItem({}),this.source=e,this.gl=t,this.allocated=!1,this.compiled=!1,this.linked=!1,this.validated=!1,this.errors=[],this.uniforms={},this.samplers={},this.attributes={},this.vertexShader=new E(t,t.VERTEX_SHADER,this.source.vertex),this.fragmentShader=new E(t,t.FRAGMENT_SHADER,this.source.fragment),!this.vertexShader.allocated)return this.errors=["Vertex shader failed to allocate"].concat(this.vertexShader.errors),void u(this.errors);if(!this.fragmentShader.allocated)return this.errors=["Fragment shader failed to allocate"].concat(this.fragmentShader.errors),void u(this.errors);if(this.allocated=!0,!this.vertexShader.compiled)return this.errors=["Vertex shader failed to compile"].concat(this.vertexShader.errors),void u(this.errors);if(!this.fragmentShader.compiled)return this.errors=["Fragment shader failed to compile"].concat(this.fragmentShader.errors),void u(this.errors);if(this.compiled=!0,this.handle=t.createProgram(),this.handle){if(t.attachShader(this.handle,this.vertexShader.handle),t.attachShader(this.handle,this.fragmentShader.handle),t.linkProgram(this.handle),this.linked=t.getProgramParameter(this.handle,t.LINK_STATUS),this.validated=!0,!this.linked||!this.validated)return this.errors=[],this.errors.push(""),this.errors.push(t.getProgramInfoLog(this.handle)),this.errors.push("\nVertex shader:\n"),this.errors=this.errors.concat(this.source.vertex),this.errors.push("\nFragment shader:\n"),this.errors=this.errors.concat(this.source.fragment),void u(this.errors);for(var i=t.getProgramParameter(this.handle,t.ACTIVE_UNIFORMS),r=0;r<i;++r){var n=t.getActiveUniform(this.handle,r);if(n){var s=n.name;"\0"===s[s.length-1]&&(s=s.substr(0,s.length-1));var _=t.getUniformLocation(this.handle,s);n.type===t.SAMPLER_2D||n.type===t.SAMPLER_CUBE||35682===n.type?this.samplers[s]=new T(t,_):this.uniforms[s]=_}}for(var o=t.getProgramParameter(this.handle,t.ACTIVE_ATTRIBUTES),h=0;h<o;h++){var R=t.getActiveAttrib(this.handle,h);if(R){var d=t.getAttribLocation(this.handle,R.name);this.attributes[R.name]=new a(t,d)}}this.allocated=!0}else this.errors=["Failed to allocate program"]}var e=t.prototype;return e.bind=function(){this.allocated&&this.gl.useProgram(this.handle)},e.getLocation=function(t){return this.uniforms[t]},e.getAttribute=function(t){return this.attributes[t]},e.getSampler=function(t){return this.samplers[t]},e.bindTexture=function(t,e,i){if(!this.allocated)return!1;var r=this.samplers[t];return!!r&&r.bindTexture(e,i)},e.destroy=function(){this.allocated&&(l.removeItem(this.id),this.gl.deleteProgram(this.handle),this.gl.deleteShader(this.vertexShader.handle),this.gl.deleteShader(this.fragmentShader.handle),this.attributes={},this.uniforms={},this.samplers={},this.allocated=!1)},t}();function u(t){console.error(t.join("\n"))}var d=function(){var t=document.createElement("canvas"),e=String.fromCharCode;if(!t.getContext)return{saveAsBMP:function(){},saveAsPNG:function(){},saveAsJPEG:function(){}};var i=!!t.getContext("2d").getImageData,r=!!t.toDataURL,a=!!window.btoa,n=function(t){window.open(t)||(document.location.href=t)},s=function(t,e){return"data:"+e+";base64,"+t},_=function(t){var e=document.createElement("img");return e.src=t,e},o=function(t,e,i,r){if(e&&i){var a=document.createElement("canvas");a.width=e,a.height=i,a.style.width=e+"px",a.style.height=i+"px";var n=a.getContext("2d");return r?(n.save(),n.scale(1,-1),n.imageSmoothingEnabled=!0,n.drawImage(t,0,0,t.width,t.height,0,0,e,-i),n.restore()):(n.imageSmoothingEnabled=!0,n.drawImage(t,0,0,t.width,t.height,0,0,e,i)),a}return t};return{saveAsPNG:function(t,e,i,a,s){if(!r)return!1;var h=o(t,i,a,s).toDataURL("image/png");return e?_(h):(n(h),!0)},saveAsJPEG:function(t,e,i,a,s){if(!r)return!1;var h="image/jpeg",E=o(t,i,a,s).toDataURL(h);return 5==E.indexOf(h)&&(e?_(E):(n(E),!0))},saveAsBMP:function(t,h,E,T,l){if(!(r&&i&&a))return!1;var R="image/bmp",u=function(t){var e=parseInt(t.width),i=parseInt(t.height);return t.getContext("2d").getImageData(0,0,e,i)}(o(t,E,T,l)),d=function(t){var i="",r=t.width,a=t.height;i+="BM";var n=r*a*4+54;i+=e(n%256),n=Math.floor(n/256),i+=e(n%256),n=Math.floor(n/256),i+=e(n%256),n=Math.floor(n/256),i+=e(n%256),i+=e(0,0,0,0,54,0,0,0),i+=e(40,0,0,0);var s=r;i+=e(s%256),s=Math.floor(s/256),i+=e(s%256),s=Math.floor(s/256),i+=e(s%256),s=Math.floor(s/256),i+=e(s%256);var _=a;i+=e(_%256),_=Math.floor(_/256),i+=e(_%256),_=Math.floor(_/256),i+=e(_%256),_=Math.floor(_/256),i+=e(_%256),i+=e(1,0,32,0),i+=e(0,0,0,0);var o=r*a*4;i+=e(o%256),o=Math.floor(o/256),i+=e(o%256),o=Math.floor(o/256),i+=e(o%256),o=Math.floor(o/256),i+=e(o%256),i+=e(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var h,E,T,l,R=t.data,u="",d=a;do{for(T=r*(d-1)*4,l="",h=0;h<r;h++)l+=e(R[T+(E=4*h)+2],R[T+E+1],R[T+E],R[T+E+3]);u+=l}while(--d);return function(t){var i,r,a="";if("string"==typeof t)a=t;else for(r=t,i=0;i<r.length;i++)a+=e(r[i]);return btoa(a)}(i+u)}(u);return h?_(s(d,R)):(n(s(d,R)),!0)}}}(),A=/*#__PURE__*/s("canvas"),f=/*#__PURE__*/s("gl"),m=/*#__PURE__*/s("allocated"),S=/*#__PURE__*/s("buffer"),c=/*#__PURE__*/s("bound"),p=/*#__PURE__*/s("size"),g=/*#__PURE__*/s("hasDepthTexture"),P=/*#__PURE__*/s("imageDataCache"),B=/*#__PURE__*/s("texture"),x=/*#__PURE__*/s("depthTexture"),F=/*#__PURE__*/s("touch"),v=/*#__PURE__*/s("getImageDataCache"),G=/*#__PURE__*/function(){function t(t,e,i){Object.defineProperty(this,v,{value:M}),Object.defineProperty(this,F,{value:C}),Object.defineProperty(this,A,{writable:!0,value:void 0}),Object.defineProperty(this,f,{writable:!0,value:void 0}),Object.defineProperty(this,m,{writable:!0,value:void 0}),Object.defineProperty(this,S,{writable:!0,value:void 0}),Object.defineProperty(this,c,{writable:!0,value:void 0}),Object.defineProperty(this,p,{writable:!0,value:void 0}),Object.defineProperty(this,g,{writable:!0,value:void 0}),Object.defineProperty(this,P,{writable:!0,value:void 0}),Object.defineProperty(this,B,{writable:!0,value:void 0}),Object.defineProperty(this,x,{writable:!0,value:void 0}),_(this,A)[A]=t,_(this,f)[f]=e,_(this,m)[m]=!1,_(this,S)[S]=null,_(this,c)[c]=!1,_(this,p)[p]=i.size,_(this,g)[g]=!!i.depthTexture}var e=t.prototype;return e.setSize=function(t){_(this,p)[p]=t},e.bind=function(){if(_(this,F)[F](),!_(this,c)[c]){var t=_(this,f)[f];t.bindFramebuffer(t.FRAMEBUFFER,_(this,S)[S].framebuf),_(this,c)[c]=!0}},e.clear=function(){if(!_(this,c)[c])throw"Render buffer not bound";var t=_(this,f)[f];t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},e.read=function(t,e){var i=t,r=_(this,f)[f].drawingBufferHeight-e,a=new Uint8Array(4),n=_(this,f)[f];return n.readPixels(i,r,1,1,n.RGBA,n.UNSIGNED_BYTE,a),a},e.readImage=function(t){var e=_(this,f)[f],i=_(this,v)[v](),r=i.pixelData,a=i.canvas,n=i.imageData,s=i.context;e.readPixels(0,0,_(this,S)[S].width,_(this,S)[S].height,e.RGBA,e.UNSIGNED_BYTE,r),n.data.set(r),s.putImageData(n,0,0);var o,h=t.width||a.width,E=t.height||a.height,T=t.format||"jpeg",l=!0;switch(T){case"jpeg":o=d.saveAsJPEG(a,!0,h,E,l);break;case"png":o=d.saveAsPNG(a,!0,h,E,l);break;case"bmp":o=d.saveAsBMP(a,!0,h,E,l);break;default:console.error("Unsupported image format: '"+T+"' - supported types are 'jpeg', 'bmp' and 'png' - defaulting to 'jpeg'"),o=d.saveAsJPEG(a,!0,h,E,l)}return o.src},e.unbind=function(){var t=_(this,f)[f];t.bindFramebuffer(t.FRAMEBUFFER,null),_(this,c)[c]=!1},e.getTexture=function(){var t=this;return _(this,B)[B]||(_(this,B)[B]={bind:function(e){return!(!_(t,S)[S]||!_(t,S)[S].texture||(_(t,f)[f].activeTexture(_(t,f)[f]["TEXTURE"+e]),_(t,f)[f].bindTexture(_(t,f)[f].TEXTURE_2D,_(t,S)[S].texture),0))},unbind:function(e){_(t,S)[S]&&_(t,S)[S].texture&&(_(t,f)[f].activeTexture(_(t,f)[f]["TEXTURE"+e]),_(t,f)[f].bindTexture(_(t,f)[f].TEXTURE_2D,null))}})},e.hasDepthTexture=function(){return _(this,g)[g]},e.getDepthTexture=function(){var t=this;return _(this,g)[g]?_(this,x)[x]||(_(this,x)[x]={bind:function(e){return!(!_(t,S)[S]||!_(t,S)[S].depthTexture||(_(t,f)[f].activeTexture(_(t,f)[f]["TEXTURE"+e]),_(t,f)[f].bindTexture(_(t,f)[f].TEXTURE_2D,_(t,S)[S].depthTexture),0))},unbind:function(e){_(t,S)[S]&&_(t,S)[S].depthTexture&&(_(t,f)[f].activeTexture(_(t,f)[f]["TEXTURE"+e]),_(t,f)[f].bindTexture(_(t,f)[f].TEXTURE_2D,null))}}):null},e.destroy=function(){if(_(this,m)[m]){var t=_(this,f)[f];t.deleteTexture(_(this,S)[S].texture),t.deleteTexture(_(this,S)[S].depthTexture),t.deleteFramebuffer(_(this,S)[S].framebuf),t.deleteRenderbuffer(_(this,S)[S].renderbuf),_(this,m)[m]=!1,_(this,S)[S]=null,_(this,c)[c]=!1}_(this,P)[P]=null},t}();function C(){var t,e,i=_(this,f)[f];if(_(this,p)[p]?(t=_(this,p)[p][0],e=_(this,p)[p][1]):(t=i.drawingBufferWidth,e=i.drawingBufferHeight),_(this,S)[S]){if(_(this,S)[S].width===t&&_(this,S)[S].height===e)return;i.deleteTexture(_(this,S)[S].texture),i.deleteFramebuffer(_(this,S)[S].framebuf),i.deleteRenderbuffer(_(this,S)[S].renderbuf)}var r,a=i.createTexture();i.bindTexture(i.TEXTURE_2D,a),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null),_(this,g)[g]&&(r=i.createTexture(),i.bindTexture(i.TEXTURE_2D,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.DEPTH_COMPONENT,t,e,0,i.DEPTH_COMPONENT,i.UNSIGNED_INT,null));var n=i.createRenderbuffer();i.bindRenderbuffer(i.RENDERBUFFER,n),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,t,e);var s=i.createFramebuffer();if(i.bindFramebuffer(i.FRAMEBUFFER,s),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,a,0),_(this,g)[g]?i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,r,0):i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,n),i.bindTexture(i.TEXTURE_2D,null),i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,s),!i.isFramebuffer(s))throw"Invalid framebuffer";i.bindFramebuffer(i.FRAMEBUFFER,null);var o=i.checkFramebufferStatus(i.FRAMEBUFFER);switch(o){case i.FRAMEBUFFER_COMPLETE:break;case i.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case i.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case i.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case i.FRAMEBUFFER_UNSUPPORTED:throw"Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED";default:throw"Incomplete framebuffer: "+o}_(this,S)[S]={framebuf:s,renderbuf:n,texture:a,depthTexture:r,width:t,height:e},_(this,c)[c]=!1}function M(){var t=_(this,S)[S].width,e=_(this,S)[S].height,i=_(this,P)[P];if(i&&(i.width===t&&i.height===e||(_(this,P)[P]=null,i=null)),!i){var r=document.createElement("canvas");r.width=t,r.height=e;var a=r.getContext("2d"),n=a.createImageData(t,e);i={pixelData:new Uint8Array(t*e*4),canvas:r,context:a,imageData:n,width:t,height:e},_(this,P)[P]=i}return i}function U(t,e){if(void 0===t._cachedExtensions&&(t._cachedExtensions={}),void 0!==t._cachedExtensions[e])return t._cachedExtensions[e];var i;switch(e){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=t.getExtension(e)}return t._cachedExtensions[e]=i,i}function I(t,e,r){var a,n=e;if(n===i.UnsignedByteType)return t.UNSIGNED_BYTE;if(n===i.UnsignedShort4444Type)return t.UNSIGNED_SHORT_4_4_4_4;if(n===i.UnsignedShort5551Type)return t.UNSIGNED_SHORT_5_5_5_1;if(n===i.ByteType)return t.BYTE;if(n===i.ShortType)return t.SHORT;if(n===i.UnsignedShortType)return t.UNSIGNED_SHORT;if(n===i.IntType)return t.INT;if(n===i.UnsignedIntType)return t.UNSIGNED_INT;if(n===i.FloatType)return t.FLOAT;if(n===i.HalfFloatType)return t.HALF_FLOAT;if(n===i.AlphaFormat)return t.ALPHA;if(n===i.RGBAFormat)return t.RGBA;if(n===i.LuminanceFormat)return t.LUMINANCE;if(n===i.LuminanceAlphaFormat)return t.LUMINANCE_ALPHA;if(n===i.DepthFormat)return t.DEPTH_COMPONENT;if(n===i.DepthStencilFormat)return t.DEPTH_STENCIL;if(n===i.RedFormat)return t.RED;if(n===i.RGBFormat)return t.RGBA;if(n===i.RedIntegerFormat)return t.RED_INTEGER;if(n===i.RGFormat)return t.RG;if(n===i.RGIntegerFormat)return t.RG_INTEGER;if(n===i.RGBAIntegerFormat)return t.RGBA_INTEGER;if(n===i.RGB_S3TC_DXT1_Format||n===i.RGBA_S3TC_DXT1_Format||n===i.RGBA_S3TC_DXT3_Format||n===i.RGBA_S3TC_DXT5_Format)if(r===i.sRGBEncoding){var s=U(t,"WEBGL_compressed_texture_s3tc_srgb");if(null===s)return null;if(n===i.RGB_S3TC_DXT1_Format)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===i.RGBA_S3TC_DXT1_Format)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===i.RGBA_S3TC_DXT3_Format)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===i.RGBA_S3TC_DXT5_Format)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(a=U(t,"WEBGL_compressed_texture_s3tc")))return null;if(n===i.RGB_S3TC_DXT1_Format)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===i.RGBA_S3TC_DXT1_Format)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===i.RGBA_S3TC_DXT3_Format)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===i.RGBA_S3TC_DXT5_Format)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===i.RGB_PVRTC_4BPPV1_Format||n===i.RGB_PVRTC_2BPPV1_Format||n===i.RGBA_PVRTC_4BPPV1_Format||n===i.RGBA_PVRTC_2BPPV1_Format){var _=U(t,"WEBGL_compressed_texture_pvrtc");if(null===_)return null;if(n===i.RGB_PVRTC_4BPPV1_Format)return _.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===i.RGB_PVRTC_2BPPV1_Format)return _.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===i.RGBA_PVRTC_4BPPV1_Format)return _.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===i.RGBA_PVRTC_2BPPV1_Format)return _.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===i.RGB_ETC1_Format){var o=U(t,"WEBGL_compressed_texture_etc1");return null!==o?o.COMPRESSED_RGB_ETC1_WEBGL:null}if(n===i.RGB_ETC2_Format||n===i.RGBA_ETC2_EAC_Format){var h=U(t,"WEBGL_compressed_texture_etc");if(null===h)return null;if(n===i.RGB_ETC2_Format)return r===i.sRGBEncoding?h.COMPRESSED_SRGB8_ETC2:h.COMPRESSED_RGB8_ETC2;if(n===i.RGBA_ETC2_EAC_Format)return r===i.sRGBEncoding?h.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:h.COMPRESSED_RGBA8_ETC2_EAC}if(n===i.RGBA_ASTC_4x4_Format||n===i.RGBA_ASTC_5x4_Format||n===i.RGBA_ASTC_5x5_Format||n===i.RGBA_ASTC_6x5_Format||n===i.RGBA_ASTC_6x6_Format||n===i.RGBA_ASTC_8x5_Format||n===i.RGBA_ASTC_8x6_Format||n===i.RGBA_ASTC_8x8_Format||n===i.RGBA_ASTC_10x5_Format||n===i.RGBA_ASTC_10x6_Format||n===i.RGBA_ASTC_10x8_Format||n===i.RGBA_ASTC_10x10_Format||n===i.RGBA_ASTC_12x10_Format||n===i.RGBA_ASTC_12x12_Format){var E=U(t,"WEBGL_compressed_texture_astc");if(null===E)return null;if(n===i.RGBA_ASTC_4x4_Format)return r===i.sRGBEncoding?E.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:E.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===i.RGBA_ASTC_5x4_Format)return r===i.sRGBEncoding?E.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:E.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===i.RGBA_ASTC_5x5_Format)return r===i.sRGBEncoding?E.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:E.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===i.RGBA_ASTC_6x5_Format)return r===i.sRGBEncoding?E.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:E.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===i.RGBA_ASTC_6x6_Format)return r===i.sRGBEncoding?E.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:E.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===i.RGBA_ASTC_8x5_Format)return r===i.sRGBEncoding?E.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:E.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===i.RGBA_ASTC_8x6_Format)return r===i.sRGBEncoding?E.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:E.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===i.RGBA_ASTC_8x8_Format)return r===i.sRGBEncoding?E.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:E.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===i.RGBA_ASTC_10x5_Format)return r===i.sRGBEncoding?E.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:E.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===i.RGBA_ASTC_10x6_Format)return r===i.sRGBEncoding?E.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:E.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===i.RGBA_ASTC_10x8_Format)return r===i.sRGBEncoding?E.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:E.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===i.RGBA_ASTC_10x10_Format)return r===i.sRGBEncoding?E.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:E.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===i.RGBA_ASTC_12x10_Format)return r===i.sRGBEncoding?E.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:E.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===i.RGBA_ASTC_12x12_Format)return r===i.sRGBEncoding?E.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:E.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===i.RGBA_BPTC_Format){var T=U(t,"EXT_texture_compression_bptc");if(null===T)return null;if(n===i.RGBA_BPTC_Format)return r===i.sRGBEncoding?T.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:T.COMPRESSED_RGBA_BPTC_UNORM_EXT}return n===i.UnsignedInt248Type?t.UNSIGNED_INT_24_8:n===i.RepeatWrapping?t.REPEAT:n===i.ClampToEdgeWrapping?t.CLAMP_TO_EDGE:n===i.NearestMipMapNearestFilter||n===i.NearestMipMapLinearFilter?t.NEAREST_MIPMAP_LINEAR:n===i.LinearMipMapNearestFilter?t.LINEAR_MIPMAP_NEAREST:n===i.LinearMipMapLinearFilter?t.LINEAR_MIPMAP_LINEAR:n===i.NearestFilter?t.NEAREST:n===i.LinearFilter?t.LINEAR:null}var D=new Uint8Array([0,0,0,1]),N=/*#__PURE__*/function(){function t(t){this.gl=void 0,this.target=void 0,this.format=void 0,this.type=void 0,this.internalFormat=void 0,this.premultiplyAlpha=void 0,this.flipY=void 0,this.unpackAlignment=void 0,this.wrapS=void 0,this.wrapT=void 0,this.wrapR=void 0,this.texture=void 0,this.allocated=void 0,this.minFilter=void 0,this.magFilter=void 0,this.encoding=void 0,this.gl=t.gl,this.target=t.target||t.gl.TEXTURE_2D,this.format=t.format||i.RGBAFormat,this.type=t.type||i.UnsignedByteType,this.internalFormat=-1,this.premultiplyAlpha=!!t.premultiplyAlpha,this.flipY=!!t.flipY,this.unpackAlignment=4,this.wrapS=t.wrapS||i.RepeatWrapping,this.wrapT=t.wrapT||i.RepeatWrapping,this.wrapR=t.wrapR||i.RepeatWrapping,this.texture=t.gl.createTexture(),t.preloadColor&&this.setPreloadColor(t.preloadColor),this.allocated=!0}var r=t.prototype;return r.setPreloadColor=function(t){t?(D[0]=Math.floor(255*t[0]),D[1]=Math.floor(255*t[1]),D[2]=Math.floor(255*t[2]),D[3]=Math.floor(255*(void 0!==t[3]?t[3]:1))):(D[0]=0,D[1]=0,D[2]=0,D[3]=255);var e=this.gl;if(e.bindTexture(this.target,this.texture),this.target===e.TEXTURE_CUBE_MAP)for(var i=[e.TEXTURE_CUBE_MAP_POSITIVE_X,e.TEXTURE_CUBE_MAP_NEGATIVE_X,e.TEXTURE_CUBE_MAP_POSITIVE_Y,e.TEXTURE_CUBE_MAP_NEGATIVE_Y,e.TEXTURE_CUBE_MAP_POSITIVE_Z,e.TEXTURE_CUBE_MAP_NEGATIVE_Z],r=0,a=i.length;r<a;r++)e.texImage2D(i[r],0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,D);else e.texImage2D(this.target,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,D);e.bindTexture(this.target,null)},r.setTarget=function(t){this.target=t||this.gl.TEXTURE_2D},r.setImage=function(t,i){void 0===i&&(i={});var r=this.gl;void 0!==i.format&&(this.format=i.format),void 0!==i.internalFormat&&(this.internalFormat=i.internalFormat),void 0!==i.encoding&&(this.encoding=i.encoding),void 0!==i.type&&(this.type=i.type),void 0!==i.flipY&&(this.flipY=i.flipY),void 0!==i.premultiplyAlpha&&(this.premultiplyAlpha=i.premultiplyAlpha),void 0!==i.unpackAlignment&&(this.unpackAlignment=i.unpackAlignment),void 0!==i.minFilter&&(this.minFilter=i.minFilter),void 0!==i.magFilter&&(this.magFilter=i.magFilter),void 0!==i.wrapS&&(this.wrapS=i.wrapS),void 0!==i.wrapT&&(this.wrapT=i.wrapT),void 0!==i.wrapR&&(this.wrapR=i.wrapR),r.bindTexture(this.target,this.texture),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,this.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,this.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.NONE);var a=I(r,this.minFilter);r.texParameteri(this.target,r.TEXTURE_MIN_FILTER,a);var n=I(r,this.magFilter);n&&r.texParameteri(this.target,r.TEXTURE_MAG_FILTER,n);var s=I(r,this.wrapS);s&&r.texParameteri(this.target,r.TEXTURE_WRAP_S,s);var _=I(r,this.wrapT);_&&r.texParameteri(this.target,r.TEXTURE_WRAP_T,_);var o=I(r,this.format,this.encoding),h=I(r,this.type),E=b(r,this.internalFormat,o,h,this.encoding,!1);if(this.target===r.TEXTURE_CUBE_MAP){if(e.isArray(t))for(var T=t,l=[r.TEXTURE_CUBE_MAP_POSITIVE_X,r.TEXTURE_CUBE_MAP_NEGATIVE_X,r.TEXTURE_CUBE_MAP_POSITIVE_Y,r.TEXTURE_CUBE_MAP_NEGATIVE_Y,r.TEXTURE_CUBE_MAP_POSITIVE_Z,r.TEXTURE_CUBE_MAP_NEGATIVE_Z],R=0,u=l.length;R<u;R++)r.texImage2D(l[R],0,E,o,h,T[R])}else r.texImage2D(r.TEXTURE_2D,0,E,o,h,t);r.bindTexture(this.target,null)},r.setCompressedData=function(t){var e=this.gl,r=t.mipmaps||[],a=r.length,n=t.props;void 0!==n.format&&(this.format=n.format),void 0!==n.internalFormat&&(this.internalFormat=n.internalFormat),void 0!==n.encoding&&(this.encoding=n.encoding),void 0!==n.type&&(this.type=n.type),void 0!==n.flipY&&(this.flipY=n.flipY),void 0!==n.premultiplyAlpha&&(this.premultiplyAlpha=n.premultiplyAlpha),void 0!==n.unpackAlignment&&(this.unpackAlignment=n.unpackAlignment),void 0!==n.minFilter&&(this.minFilter=n.minFilter),void 0!==n.magFilter&&(this.magFilter=n.magFilter),void 0!==n.wrapS&&(this.wrapS=n.wrapS),void 0!==n.wrapT&&(this.wrapT=n.wrapT),void 0!==n.wrapR&&(this.wrapR=n.wrapR),e.activeTexture(e.TEXTURE0+0),e.bindTexture(this.target,this.texture);var s=r.length>1;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,this.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,this.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE);var _=I(e,this.wrapS);_&&e.texParameteri(this.target,e.TEXTURE_WRAP_S,_);var o=I(e,this.wrapT);if(o&&e.texParameteri(this.target,e.TEXTURE_WRAP_T,o),this.type===e.TEXTURE_3D||this.type===e.TEXTURE_2D_ARRAY){var h=I(e,this.wrapR);h&&e.texParameteri(this.target,e.TEXTURE_WRAP_R,h),e.texParameteri(this.type,e.TEXTURE_WRAP_R,h)}s?(e.texParameteri(this.target,e.TEXTURE_MIN_FILTER,L(e,this.minFilter)),e.texParameteri(this.target,e.TEXTURE_MAG_FILTER,L(e,this.magFilter))):(e.texParameteri(this.target,e.TEXTURE_MIN_FILTER,I(e,this.minFilter)),e.texParameteri(this.target,e.TEXTURE_MAG_FILTER,I(e,this.magFilter)));var E=I(e,this.format,this.encoding),T=I(e,this.type),l=b(e,this.internalFormat,E,T,this.encoding,!1);e.texStorage2D(e.TEXTURE_2D,a,l,r[0].width,r[0].height);for(var R=0,u=r.length;R<u;R++){var d=r[R];this.format!==i.RGBAFormat?null!==E?e.compressedTexSubImage2D(e.TEXTURE_2D,R,0,0,d.width,d.height,E,d.data):console.warn("Attempt to load unsupported compressed texture format in .setCompressedData()"):e.texSubImage2D(e.TEXTURE_2D,R,0,0,d.width,d.height,E,T,d.data)}e.bindTexture(this.target,null)},r.setProps=function(t){var e=this.gl;e.bindTexture(this.target,this.texture),this._uploadProps(t),e.bindTexture(this.target,null)},r._uploadProps=function(t){var e=this.gl;if(void 0!==t.format&&(this.format=t.format),void 0!==t.internalFormat&&(this.internalFormat=t.internalFormat),void 0!==t.encoding&&(this.encoding=t.encoding),void 0!==t.type&&(this.type=t.type),void 0!==t.minFilter){var i=I(e,t.minFilter);i&&(this.minFilter=t.minFilter,e.texParameteri(this.target,e.TEXTURE_MIN_FILTER,i),i!==e.NEAREST_MIPMAP_NEAREST&&i!==e.LINEAR_MIPMAP_NEAREST&&i!==e.NEAREST_MIPMAP_LINEAR&&i!==e.LINEAR_MIPMAP_LINEAR||e.generateMipmap(this.target))}if(void 0!==t.magFilter){var r=I(e,t.magFilter);r&&(this.magFilter=t.magFilter,e.texParameteri(this.target,e.TEXTURE_MAG_FILTER,r))}if(void 0!==t.wrapS){var a=I(e,t.wrapS);a&&(this.wrapS=t.wrapS,e.texParameteri(this.target,e.TEXTURE_WRAP_S,a))}if(void 0!==t.wrapT){var n=I(e,t.wrapT);n&&(this.wrapT=t.wrapT,e.texParameteri(this.target,e.TEXTURE_WRAP_T,n))}},r.bind=function(t){if(!this.allocated)return!1;if(this.texture){var e=this.gl;return e.activeTexture(e["TEXTURE"+t]),e.bindTexture(this.target,this.texture),!0}return!1},r.unbind=function(t){if(this.allocated&&this.texture){var e=this.gl;e.activeTexture(e["TEXTURE"+t]),e.bindTexture(this.target,null)}},r.destroy=function(){this.allocated&&this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null)},t}();function b(t,e,r,a,n,s){if(void 0===s&&(s=!1),null!==e){if(void 0!==t[e])return t[e];console.warn("Attempt to use non-existing WebGL internal format '"+e+"'")}var _=r;return r===t.RED&&(a===t.FLOAT&&(_=t.R32F),a===t.HALF_FLOAT&&(_=t.R16F),a===t.UNSIGNED_BYTE&&(_=t.R8)),r===t.RG&&(a===t.FLOAT&&(_=t.RG32F),a===t.HALF_FLOAT&&(_=t.RG16F),a===t.UNSIGNED_BYTE&&(_=t.RG8)),r===t.RGBA&&(a===t.FLOAT&&(_=t.RGBA32F),a===t.HALF_FLOAT&&(_=t.RGBA16F),a===t.UNSIGNED_BYTE&&(_=n===i.sRGBEncoding&&!1===s?t.SRGB8_ALPHA8:t.RGBA8),a===t.UNSIGNED_SHORT_4_4_4_4&&(_=t.RGBA4),a===t.UNSIGNED_SHORT_5_5_5_1&&(_=t.RGB5_A1)),_!==t.R16F&&_!==t.R32F&&_!==t.RG16F&&_!==t.RG32F&&_!==t.RGBA16F&&_!==t.RGBA32F||U(t,"EXT_color_buffer_float"),_}function L(t,e){return e===i.NearestFilter||e===i.NearestMipmapNearestFilter||e===i.NearestMipmapLinearFilter?t.NEAREST:t.LINEAR}var X={WEBGL:!1,SUPPORTED_EXTENSIONS:{}},O=document.createElement("canvas");if(O){var y=O.getContext("webgl2",{antialias:!0});X.WEBGL=!!y,X.WEBGL&&(X.ANTIALIAS=y.getContextAttributes().antialias,X.FS_MAX_FLOAT_PRECISION=y.getShaderPrecisionFormat?y.getShaderPrecisionFormat(y.FRAGMENT_SHADER,y.HIGH_FLOAT).precision>0?"highp":y.getShaderPrecisionFormat(y.FRAGMENT_SHADER,y.MEDIUM_FLOAT).precision>0?"mediump":"lowp":"mediump",X.DEPTH_BUFFER_BITS=y.getParameter(y.DEPTH_BITS),X.MAX_TEXTURE_SIZE=y.getParameter(y.MAX_TEXTURE_SIZE),X.MAX_CUBE_MAP_SIZE=y.getParameter(y.MAX_CUBE_MAP_TEXTURE_SIZE),X.MAX_RENDERBUFFER_SIZE=y.getParameter(y.MAX_RENDERBUFFER_SIZE),X.MAX_TEXTURE_UNITS=y.getParameter(y.MAX_COMBINED_TEXTURE_IMAGE_UNITS),X.MAX_TEXTURE_IMAGE_UNITS=y.getParameter(y.MAX_TEXTURE_IMAGE_UNITS),X.MAX_VERTEX_ATTRIBS=y.getParameter(y.MAX_VERTEX_ATTRIBS),X.MAX_VERTEX_UNIFORM_VECTORS=y.getParameter(y.MAX_VERTEX_UNIFORM_VECTORS),X.MAX_FRAGMENT_UNIFORM_VECTORS=y.getParameter(y.MAX_FRAGMENT_UNIFORM_VECTORS),X.MAX_VARYING_VECTORS=y.getParameter(y.MAX_VARYING_VECTORS),y.getSupportedExtensions().forEach(function(t){X.SUPPORTED_EXTENSIONS[t]=!0}),X.depthTexturesSupported=X.SUPPORTED_EXTENSIONS.WEBGL_depth_texture)}t.Canvas2Image=d,t.GLArrayBuf=r,t.GLAttribute=a,t.GLDataTexture=h,t.GLProgram=R,t.GLRenderBuffer=G,t.GLSampler=T,t.GLShader=E,t.GLTexture=N,t.WEBGL_INFO=X,t.convertConstant=I,t.getExtension=U});
//# sourceMappingURL=index.umd.js.map
