var t=require("@xeokit/utils"),e=require("@xeokit/constants"),r=/*#__PURE__*/function(){function t(t,e,r,i,a,n,s,_,o){switch(this.gl=void 0,this.itemType=void 0,this.itemByteSize=void 0,this.type=void 0,this.allocated=void 0,this.usage=void 0,this.length=void 0,this.dataLength=void 0,this.numItems=void 0,this.itemSize=void 0,this.normalized=void 0,this.stride=void 0,this.offset=void 0,this.handle=void 0,this.gl=t,this.type=e,this.allocated=!1,r.constructor){case Uint8Array:this.itemType=t.UNSIGNED_BYTE,this.itemByteSize=1;break;case Int8Array:this.itemType=t.BYTE,this.itemByteSize=1;break;case Uint16Array:this.itemType=t.UNSIGNED_SHORT,this.itemByteSize=2;break;case Int16Array:this.itemType=t.SHORT,this.itemByteSize=2;break;case Uint32Array:this.itemType=t.UNSIGNED_INT,this.itemByteSize=4;break;case Int32Array:this.itemType=t.INT,this.itemByteSize=4;break;default:this.itemType=t.FLOAT,this.itemByteSize=4}this.usage=n,this.length=0,this.dataLength=i,this.numItems=0,this.itemSize=a,this.normalized=!!s,this.stride=_||0,this.offset=o||0,this._allocate(r)}var e=t.prototype;return e._allocate=function(t){if(this.allocated=!1,this.handle=this.gl.createBuffer(),!this.handle)throw new Error("Failed to allocate WebGL ArrayBuffer");this.handle&&(this.gl.bindBuffer(this.type,this.handle),this.gl.bufferData(this.type,t.length>this.dataLength?t.slice(0,this.dataLength):t,this.usage),this.gl.bindBuffer(this.type,null),this.length=t.length,this.numItems=this.length/this.itemSize,this.allocated=!0)},e.setData=function(t,e){this.allocated&&(t.length+(e||0)>this.length?(this.destroy(),this._allocate(t)):(this.gl.bindBuffer(this.type,this.handle),e||0===e?this.gl.bufferSubData(this.type,e*this.itemByteSize,t):this.gl.bufferData(this.type,t,this.usage),this.gl.bindBuffer(this.type,null)))},e.bind=function(){this.allocated&&this.gl.bindBuffer(this.type,this.handle)},e.unbind=function(){this.allocated&&this.gl.bindBuffer(this.type,null)},e.destroy=function(){this.allocated&&(this.gl.deleteBuffer(this.handle),this.allocated=!1)},t}(),i=/*#__PURE__*/function(){function t(t,e){this.gl=void 0,this.location=void 0,this.gl=t,this.location=e}return t.prototype.bindArrayBuffer=function(t){t&&(t.bind(),this.gl.enableVertexAttribArray(this.location),this.gl.vertexAttribPointer(this.location,t.itemSize,t.itemType,t.normalized,t.stride,t.offset))},t}(),a=0;function n(t){return"__private_"+a+++"_"+t}function s(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var _=/*#__PURE__*/n("onDestroyed"),o=/*#__PURE__*/function(){function t(t){void 0===t&&(t={}),this.gl=void 0,this.texture=void 0,this.textureWidth=void 0,this.textureHeight=void 0,this.textureData=void 0,Object.defineProperty(this,_,{writable:!0,value:void 0}),this.gl=t.gl,this.texture=t.texture,this.textureWidth=t.textureWidth,this.textureHeight=t.textureHeight,this.textureData=t.textureData,s(this,_)[_]=t.onDestroyed}var e=t.prototype;return e.bindTexture=function(t,e,r){this.gl&&e.bindTexture(this,r)},e.bind=function(t){return!(!this.gl||!this.texture||(this.gl.activeTexture(this.gl["TEXTURE"+t]),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),0))},e.disableFiltering=function(){this.gl&&(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE))},e.unbind=function(t){},e.destroy=function(){this.gl&&this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null,s(this,_)[_]&&s(this,_)[_]())},t}(),h=/*#__PURE__*/function(){function t(t,e,r){if(this.errors=void 0,this.allocated=void 0,this.compiled=void 0,this.handle=void 0,this.allocated=!1,this.compiled=!1,this.handle=t.createShader(e),this.handle){if(this.allocated=!0,t.shaderSource(this.handle,r),t.compileShader(this.handle),this.compiled=t.getShaderParameter(this.handle,t.COMPILE_STATUS),!this.compiled&&!t.isContextLost()){for(var i=r.split("\n"),a=[],n=0;n<i.length;n++)a.push(n+1+": "+i[n]+"\n");this.errors=[],this.errors.push(""),this.errors.push(t.getShaderInfoLog(this.handle)||""),this.errors=this.errors.concat(a.join(""))}}else this.errors=["Failed to allocate"]}return t.prototype.destroy=function(){},t}(),E=/*#__PURE__*/function(){function t(t,e){this.location=void 0,this.gl=void 0,this.gl=t,this.location=e}return t.prototype.bindTexture=function(t,e){return!!t.bind(e)&&(this.gl.uniform1i(this.location,e),!0)},t}(),T=new t.Map({},""),l=/*#__PURE__*/function(){function t(t,e){if(this.id=void 0,this.vertexShader=void 0,this.fragmentShader=void 0,this.attributes=void 0,this.samplers=void 0,this.uniforms=void 0,this.errors=void 0,this.validated=void 0,this.linked=void 0,this.compiled=void 0,this.allocated=void 0,this.gl=void 0,this.source=void 0,this.handle=void 0,this.id=T.addItem({}),this.source=e,this.gl=t,this.allocated=!1,this.compiled=!1,this.linked=!1,this.validated=!1,this.errors=[],this.uniforms={},this.samplers={},this.attributes={},this.vertexShader=new h(t,t.VERTEX_SHADER,this.source.vertex),this.fragmentShader=new h(t,t.FRAGMENT_SHADER,this.source.fragment),!this.vertexShader.allocated)return this.errors=["Vertex shader failed to allocate"].concat(this.vertexShader.errors),void R(this.errors);if(!this.fragmentShader.allocated)return this.errors=["Fragment shader failed to allocate"].concat(this.fragmentShader.errors),void R(this.errors);if(this.allocated=!0,!this.vertexShader.compiled)return this.errors=["Vertex shader failed to compile"].concat(this.vertexShader.errors),void R(this.errors);if(!this.fragmentShader.compiled)return this.errors=["Fragment shader failed to compile"].concat(this.fragmentShader.errors),void R(this.errors);if(this.compiled=!0,this.handle=t.createProgram(),this.handle){if(t.attachShader(this.handle,this.vertexShader.handle),t.attachShader(this.handle,this.fragmentShader.handle),t.linkProgram(this.handle),this.linked=t.getProgramParameter(this.handle,t.LINK_STATUS),this.validated=!0,!this.linked||!this.validated)return this.errors=[],this.errors.push(""),this.errors.push(t.getProgramInfoLog(this.handle)),this.errors.push("\nVertex shader:\n"),this.errors=this.errors.concat(this.source.vertex),this.errors.push("\nFragment shader:\n"),this.errors=this.errors.concat(this.source.fragment),void R(this.errors);for(var r=t.getProgramParameter(this.handle,t.ACTIVE_UNIFORMS),a=0;a<r;++a){var n=t.getActiveUniform(this.handle,a);if(n){var s=n.name;"\0"===s[s.length-1]&&(s=s.substr(0,s.length-1));var _=t.getUniformLocation(this.handle,s);n.type===t.SAMPLER_2D||n.type===t.SAMPLER_CUBE||35682===n.type?this.samplers[s]=new E(t,_):this.uniforms[s]=_}}for(var o=t.getProgramParameter(this.handle,t.ACTIVE_ATTRIBUTES),l=0;l<o;l++){var u=t.getActiveAttrib(this.handle,l);if(u){var d=t.getAttribLocation(this.handle,u.name);this.attributes[u.name]=new i(t,d)}}this.allocated=!0}else this.errors=["Failed to allocate program"]}var e=t.prototype;return e.bind=function(){this.allocated&&this.gl.useProgram(this.handle)},e.getLocation=function(t){return this.uniforms[t]},e.getAttribute=function(t){return this.attributes[t]},e.getSampler=function(t){return this.samplers[t]},e.bindTexture=function(t,e,r){if(!this.allocated)return!1;var i=this.samplers[t];return!!i&&i.bindTexture(e,r)},e.destroy=function(){this.allocated&&(T.removeItem(this.id),this.gl.deleteProgram(this.handle),this.gl.deleteShader(this.vertexShader.handle),this.gl.deleteShader(this.fragmentShader.handle),this.attributes={},this.uniforms={},this.samplers={},this.allocated=!1)},t}();function R(t){console.error(t.join("\n"))}var u=function(){var t=document.createElement("canvas"),e=String.fromCharCode;if(!t.getContext)return{saveAsBMP:function(){},saveAsPNG:function(){},saveAsJPEG:function(){}};var r=!!t.getContext("2d").getImageData,i=!!t.toDataURL,a=!!window.btoa,n=function(t){window.open(t)||(document.location.href=t)},s=function(t,e){return"data:"+e+";base64,"+t},_=function(t){var e=document.createElement("img");return e.src=t,e},o=function(t,e,r,i){if(e&&r){var a=document.createElement("canvas");a.width=e,a.height=r,a.style.width=e+"px",a.style.height=r+"px";var n=a.getContext("2d");return i?(n.save(),n.scale(1,-1),n.imageSmoothingEnabled=!0,n.drawImage(t,0,0,t.width,t.height,0,0,e,-r),n.restore()):(n.imageSmoothingEnabled=!0,n.drawImage(t,0,0,t.width,t.height,0,0,e,r)),a}return t};return{saveAsPNG:function(t,e,r,a,s){if(!i)return!1;var h=o(t,r,a,s).toDataURL("image/png");return e?_(h):(n(h),!0)},saveAsJPEG:function(t,e,r,a,s){if(!i)return!1;var h="image/jpeg",E=o(t,r,a,s).toDataURL(h);return 5==E.indexOf(h)&&(e?_(E):(n(E),!0))},saveAsBMP:function(t,h,E,T,l){if(!(i&&r&&a))return!1;var R="image/bmp",u=function(t){var e=parseInt(t.width),r=parseInt(t.height);return t.getContext("2d").getImageData(0,0,e,r)}(o(t,E,T,l)),d=function(t){var r="",i=t.width,a=t.height;r+="BM";var n=i*a*4+54;r+=e(n%256),n=Math.floor(n/256),r+=e(n%256),n=Math.floor(n/256),r+=e(n%256),n=Math.floor(n/256),r+=e(n%256),r+=e(0,0,0,0,54,0,0,0),r+=e(40,0,0,0);var s=i;r+=e(s%256),s=Math.floor(s/256),r+=e(s%256),s=Math.floor(s/256),r+=e(s%256),s=Math.floor(s/256),r+=e(s%256);var _=a;r+=e(_%256),_=Math.floor(_/256),r+=e(_%256),_=Math.floor(_/256),r+=e(_%256),_=Math.floor(_/256),r+=e(_%256),r+=e(1,0,32,0),r+=e(0,0,0,0);var o=i*a*4;r+=e(o%256),o=Math.floor(o/256),r+=e(o%256),o=Math.floor(o/256),r+=e(o%256),o=Math.floor(o/256),r+=e(o%256),r+=e(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var h,E,T,l,R=t.data,u="",d=a;do{for(T=i*(d-1)*4,l="",h=0;h<i;h++)l+=e(R[T+(E=4*h)+2],R[T+E+1],R[T+E],R[T+E+3]);u+=l}while(--d);return function(t){var r,i,a="";if("string"==typeof t)a=t;else for(i=t,r=0;r<i.length;r++)a+=e(i[r]);return btoa(a)}(r+u)}(u);return h?_(s(d,R)):(n(s(d,R)),!0)}}}(),d=/*#__PURE__*/n("canvas"),A=/*#__PURE__*/n("gl"),f=/*#__PURE__*/n("allocated"),m=/*#__PURE__*/n("buffer"),S=/*#__PURE__*/n("bound"),p=/*#__PURE__*/n("size"),c=/*#__PURE__*/n("hasDepthTexture"),g=/*#__PURE__*/n("imageDataCache"),P=/*#__PURE__*/n("texture"),B=/*#__PURE__*/n("depthTexture"),x=/*#__PURE__*/n("touch"),F=/*#__PURE__*/n("getImageDataCache"),v=/*#__PURE__*/function(){function t(t,e,r){Object.defineProperty(this,F,{value:C}),Object.defineProperty(this,x,{value:G}),Object.defineProperty(this,d,{writable:!0,value:void 0}),Object.defineProperty(this,A,{writable:!0,value:void 0}),Object.defineProperty(this,f,{writable:!0,value:void 0}),Object.defineProperty(this,m,{writable:!0,value:void 0}),Object.defineProperty(this,S,{writable:!0,value:void 0}),Object.defineProperty(this,p,{writable:!0,value:void 0}),Object.defineProperty(this,c,{writable:!0,value:void 0}),Object.defineProperty(this,g,{writable:!0,value:void 0}),Object.defineProperty(this,P,{writable:!0,value:void 0}),Object.defineProperty(this,B,{writable:!0,value:void 0}),s(this,d)[d]=t,s(this,A)[A]=e,s(this,f)[f]=!1,s(this,m)[m]=null,s(this,S)[S]=!1,s(this,p)[p]=r.size,s(this,c)[c]=!!r.depthTexture}var e=t.prototype;return e.setSize=function(t){s(this,p)[p]=t},e.bind=function(){if(s(this,x)[x](),!s(this,S)[S]){var t=s(this,A)[A];t.bindFramebuffer(t.FRAMEBUFFER,s(this,m)[m].framebuf),s(this,S)[S]=!0}},e.clear=function(){if(!s(this,S)[S])throw"Render buffer not bound";var t=s(this,A)[A];t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},e.read=function(t,e){var r=t,i=s(this,A)[A].drawingBufferHeight-e,a=new Uint8Array(4),n=s(this,A)[A];return n.readPixels(r,i,1,1,n.RGBA,n.UNSIGNED_BYTE,a),a},e.readImage=function(t){var e=s(this,A)[A],r=s(this,F)[F](),i=r.pixelData,a=r.canvas,n=r.imageData,_=r.context;e.readPixels(0,0,s(this,m)[m].width,s(this,m)[m].height,e.RGBA,e.UNSIGNED_BYTE,i),n.data.set(i),_.putImageData(n,0,0);var o,h=t.width||a.width,E=t.height||a.height,T=t.format||"jpeg",l=!0;switch(T){case"jpeg":o=u.saveAsJPEG(a,!0,h,E,l);break;case"png":o=u.saveAsPNG(a,!0,h,E,l);break;case"bmp":o=u.saveAsBMP(a,!0,h,E,l);break;default:console.error("Unsupported image format: '"+T+"' - supported types are 'jpeg', 'bmp' and 'png' - defaulting to 'jpeg'"),o=u.saveAsJPEG(a,!0,h,E,l)}return o.src},e.unbind=function(){var t=s(this,A)[A];t.bindFramebuffer(t.FRAMEBUFFER,null),s(this,S)[S]=!1},e.getTexture=function(){var t=this;return s(this,P)[P]||(s(this,P)[P]={bind:function(e){return!(!s(t,m)[m]||!s(t,m)[m].texture||(s(t,A)[A].activeTexture(s(t,A)[A]["TEXTURE"+e]),s(t,A)[A].bindTexture(s(t,A)[A].TEXTURE_2D,s(t,m)[m].texture),0))},unbind:function(e){s(t,m)[m]&&s(t,m)[m].texture&&(s(t,A)[A].activeTexture(s(t,A)[A]["TEXTURE"+e]),s(t,A)[A].bindTexture(s(t,A)[A].TEXTURE_2D,null))}})},e.hasDepthTexture=function(){return s(this,c)[c]},e.getDepthTexture=function(){var t=this;return s(this,c)[c]?s(this,B)[B]||(s(this,B)[B]={bind:function(e){return!(!s(t,m)[m]||!s(t,m)[m].depthTexture||(s(t,A)[A].activeTexture(s(t,A)[A]["TEXTURE"+e]),s(t,A)[A].bindTexture(s(t,A)[A].TEXTURE_2D,s(t,m)[m].depthTexture),0))},unbind:function(e){s(t,m)[m]&&s(t,m)[m].depthTexture&&(s(t,A)[A].activeTexture(s(t,A)[A]["TEXTURE"+e]),s(t,A)[A].bindTexture(s(t,A)[A].TEXTURE_2D,null))}}):null},e.destroy=function(){if(s(this,f)[f]){var t=s(this,A)[A];t.deleteTexture(s(this,m)[m].texture),t.deleteTexture(s(this,m)[m].depthTexture),t.deleteFramebuffer(s(this,m)[m].framebuf),t.deleteRenderbuffer(s(this,m)[m].renderbuf),s(this,f)[f]=!1,s(this,m)[m]=null,s(this,S)[S]=!1}s(this,g)[g]=null},t}();function G(){var t,e,r=s(this,A)[A];if(s(this,p)[p]?(t=s(this,p)[p][0],e=s(this,p)[p][1]):(t=r.drawingBufferWidth,e=r.drawingBufferHeight),s(this,m)[m]){if(s(this,m)[m].width===t&&s(this,m)[m].height===e)return;r.deleteTexture(s(this,m)[m].texture),r.deleteFramebuffer(s(this,m)[m].framebuf),r.deleteRenderbuffer(s(this,m)[m].renderbuf)}var i,a=r.createTexture();r.bindTexture(r.TEXTURE_2D,a),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t,e,0,r.RGBA,r.UNSIGNED_BYTE,null),s(this,c)[c]&&(i=r.createTexture(),r.bindTexture(r.TEXTURE_2D,i),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texImage2D(r.TEXTURE_2D,0,r.DEPTH_COMPONENT,t,e,0,r.DEPTH_COMPONENT,r.UNSIGNED_INT,null));var n=r.createRenderbuffer();r.bindRenderbuffer(r.RENDERBUFFER,n),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,t,e);var _=r.createFramebuffer();if(r.bindFramebuffer(r.FRAMEBUFFER,_),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,a,0),s(this,c)[c]?r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,i,0):r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,n),r.bindTexture(r.TEXTURE_2D,null),r.bindRenderbuffer(r.RENDERBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,_),!r.isFramebuffer(_))throw"Invalid framebuffer";r.bindFramebuffer(r.FRAMEBUFFER,null);var o=r.checkFramebufferStatus(r.FRAMEBUFFER);switch(o){case r.FRAMEBUFFER_COMPLETE:break;case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case r.FRAMEBUFFER_UNSUPPORTED:throw"Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED";default:throw"Incomplete framebuffer: "+o}s(this,m)[m]={framebuf:_,renderbuf:n,texture:a,depthTexture:i,width:t,height:e},s(this,S)[S]=!1}function C(){var t=s(this,m)[m].width,e=s(this,m)[m].height,r=s(this,g)[g];if(r&&(r.width===t&&r.height===e||(s(this,g)[g]=null,r=null)),!r){var i=document.createElement("canvas");i.width=t,i.height=e;var a=i.getContext("2d"),n=a.createImageData(t,e);r={pixelData:new Uint8Array(t*e*4),canvas:i,context:a,imageData:n,width:t,height:e},s(this,g)[g]=r}return r}function M(t,e){if(void 0===t._cachedExtensions&&(t._cachedExtensions={}),void 0!==t._cachedExtensions[e])return t._cachedExtensions[e];var r;switch(e){case"WEBGL_depth_texture":r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=t.getExtension(e)}return t._cachedExtensions[e]=r,r}function U(t,r,i){var a,n=r;if(n===e.UnsignedByteType)return t.UNSIGNED_BYTE;if(n===e.UnsignedShort4444Type)return t.UNSIGNED_SHORT_4_4_4_4;if(n===e.UnsignedShort5551Type)return t.UNSIGNED_SHORT_5_5_5_1;if(n===e.ByteType)return t.BYTE;if(n===e.ShortType)return t.SHORT;if(n===e.UnsignedShortType)return t.UNSIGNED_SHORT;if(n===e.IntType)return t.INT;if(n===e.UnsignedIntType)return t.UNSIGNED_INT;if(n===e.FloatType)return t.FLOAT;if(n===e.HalfFloatType)return t.HALF_FLOAT;if(n===e.AlphaFormat)return t.ALPHA;if(n===e.RGBAFormat)return t.RGBA;if(n===e.LuminanceFormat)return t.LUMINANCE;if(n===e.LuminanceAlphaFormat)return t.LUMINANCE_ALPHA;if(n===e.DepthFormat)return t.DEPTH_COMPONENT;if(n===e.DepthStencilFormat)return t.DEPTH_STENCIL;if(n===e.RedFormat)return t.RED;if(n===e.RGBFormat)return t.RGBA;if(n===e.RedIntegerFormat)return t.RED_INTEGER;if(n===e.RGFormat)return t.RG;if(n===e.RGIntegerFormat)return t.RG_INTEGER;if(n===e.RGBAIntegerFormat)return t.RGBA_INTEGER;if(n===e.RGB_S3TC_DXT1_Format||n===e.RGBA_S3TC_DXT1_Format||n===e.RGBA_S3TC_DXT3_Format||n===e.RGBA_S3TC_DXT5_Format)if(i===e.sRGBEncoding){var s=M(t,"WEBGL_compressed_texture_s3tc_srgb");if(null===s)return null;if(n===e.RGB_S3TC_DXT1_Format)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===e.RGBA_S3TC_DXT1_Format)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===e.RGBA_S3TC_DXT3_Format)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===e.RGBA_S3TC_DXT5_Format)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(a=M(t,"WEBGL_compressed_texture_s3tc")))return null;if(n===e.RGB_S3TC_DXT1_Format)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===e.RGBA_S3TC_DXT1_Format)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===e.RGBA_S3TC_DXT3_Format)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===e.RGBA_S3TC_DXT5_Format)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===e.RGB_PVRTC_4BPPV1_Format||n===e.RGB_PVRTC_2BPPV1_Format||n===e.RGBA_PVRTC_4BPPV1_Format||n===e.RGBA_PVRTC_2BPPV1_Format){var _=M(t,"WEBGL_compressed_texture_pvrtc");if(null===_)return null;if(n===e.RGB_PVRTC_4BPPV1_Format)return _.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===e.RGB_PVRTC_2BPPV1_Format)return _.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===e.RGBA_PVRTC_4BPPV1_Format)return _.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===e.RGBA_PVRTC_2BPPV1_Format)return _.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===e.RGB_ETC1_Format){var o=M(t,"WEBGL_compressed_texture_etc1");return null!==o?o.COMPRESSED_RGB_ETC1_WEBGL:null}if(n===e.RGB_ETC2_Format||n===e.RGBA_ETC2_EAC_Format){var h=M(t,"WEBGL_compressed_texture_etc");if(null===h)return null;if(n===e.RGB_ETC2_Format)return i===e.sRGBEncoding?h.COMPRESSED_SRGB8_ETC2:h.COMPRESSED_RGB8_ETC2;if(n===e.RGBA_ETC2_EAC_Format)return i===e.sRGBEncoding?h.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:h.COMPRESSED_RGBA8_ETC2_EAC}if(n===e.RGBA_ASTC_4x4_Format||n===e.RGBA_ASTC_5x4_Format||n===e.RGBA_ASTC_5x5_Format||n===e.RGBA_ASTC_6x5_Format||n===e.RGBA_ASTC_6x6_Format||n===e.RGBA_ASTC_8x5_Format||n===e.RGBA_ASTC_8x6_Format||n===e.RGBA_ASTC_8x8_Format||n===e.RGBA_ASTC_10x5_Format||n===e.RGBA_ASTC_10x6_Format||n===e.RGBA_ASTC_10x8_Format||n===e.RGBA_ASTC_10x10_Format||n===e.RGBA_ASTC_12x10_Format||n===e.RGBA_ASTC_12x12_Format){var E=M(t,"WEBGL_compressed_texture_astc");if(null===E)return null;if(n===e.RGBA_ASTC_4x4_Format)return i===e.sRGBEncoding?E.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:E.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===e.RGBA_ASTC_5x4_Format)return i===e.sRGBEncoding?E.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:E.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===e.RGBA_ASTC_5x5_Format)return i===e.sRGBEncoding?E.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:E.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===e.RGBA_ASTC_6x5_Format)return i===e.sRGBEncoding?E.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:E.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===e.RGBA_ASTC_6x6_Format)return i===e.sRGBEncoding?E.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:E.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===e.RGBA_ASTC_8x5_Format)return i===e.sRGBEncoding?E.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:E.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===e.RGBA_ASTC_8x6_Format)return i===e.sRGBEncoding?E.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:E.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===e.RGBA_ASTC_8x8_Format)return i===e.sRGBEncoding?E.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:E.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===e.RGBA_ASTC_10x5_Format)return i===e.sRGBEncoding?E.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:E.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===e.RGBA_ASTC_10x6_Format)return i===e.sRGBEncoding?E.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:E.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===e.RGBA_ASTC_10x8_Format)return i===e.sRGBEncoding?E.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:E.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===e.RGBA_ASTC_10x10_Format)return i===e.sRGBEncoding?E.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:E.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===e.RGBA_ASTC_12x10_Format)return i===e.sRGBEncoding?E.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:E.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===e.RGBA_ASTC_12x12_Format)return i===e.sRGBEncoding?E.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:E.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===e.RGBA_BPTC_Format){var T=M(t,"EXT_texture_compression_bptc");if(null===T)return null;if(n===e.RGBA_BPTC_Format)return i===e.sRGBEncoding?T.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:T.COMPRESSED_RGBA_BPTC_UNORM_EXT}return n===e.UnsignedInt248Type?t.UNSIGNED_INT_24_8:n===e.RepeatWrapping?t.REPEAT:n===e.ClampToEdgeWrapping?t.CLAMP_TO_EDGE:n===e.NearestMipMapNearestFilter||n===e.NearestMipMapLinearFilter?t.NEAREST_MIPMAP_LINEAR:n===e.LinearMipMapNearestFilter?t.LINEAR_MIPMAP_NEAREST:n===e.LinearMipMapLinearFilter?t.LINEAR_MIPMAP_LINEAR:n===e.NearestFilter?t.NEAREST:n===e.LinearFilter?t.LINEAR:null}var I=new Uint8Array([0,0,0,1]),D=/*#__PURE__*/function(){function r(t){this.gl=void 0,this.target=void 0,this.format=void 0,this.type=void 0,this.internalFormat=void 0,this.premultiplyAlpha=void 0,this.flipY=void 0,this.unpackAlignment=void 0,this.wrapS=void 0,this.wrapT=void 0,this.wrapR=void 0,this.texture=void 0,this.allocated=void 0,this.minFilter=void 0,this.magFilter=void 0,this.encoding=void 0,this.gl=t.gl,this.target=t.target||t.gl.TEXTURE_2D,this.format=t.format||e.RGBAFormat,this.type=t.type||e.UnsignedByteType,this.internalFormat=-1,this.premultiplyAlpha=!!t.premultiplyAlpha,this.flipY=!!t.flipY,this.unpackAlignment=4,this.wrapS=t.wrapS||e.RepeatWrapping,this.wrapT=t.wrapT||e.RepeatWrapping,this.wrapR=t.wrapR||e.RepeatWrapping,this.texture=t.gl.createTexture(),t.preloadColor&&this.setPreloadColor(t.preloadColor),this.allocated=!0}var i=r.prototype;return i.setPreloadColor=function(t){t?(I[0]=Math.floor(255*t[0]),I[1]=Math.floor(255*t[1]),I[2]=Math.floor(255*t[2]),I[3]=Math.floor(255*(void 0!==t[3]?t[3]:1))):(I[0]=0,I[1]=0,I[2]=0,I[3]=255);var e=this.gl;if(e.bindTexture(this.target,this.texture),this.target===e.TEXTURE_CUBE_MAP)for(var r=[e.TEXTURE_CUBE_MAP_POSITIVE_X,e.TEXTURE_CUBE_MAP_NEGATIVE_X,e.TEXTURE_CUBE_MAP_POSITIVE_Y,e.TEXTURE_CUBE_MAP_NEGATIVE_Y,e.TEXTURE_CUBE_MAP_POSITIVE_Z,e.TEXTURE_CUBE_MAP_NEGATIVE_Z],i=0,a=r.length;i<a;i++)e.texImage2D(r[i],0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,I);else e.texImage2D(this.target,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,I);e.bindTexture(this.target,null)},i.setTarget=function(t){this.target=t||this.gl.TEXTURE_2D},i.setImage=function(e,r){void 0===r&&(r={});var i=this.gl;void 0!==r.format&&(this.format=r.format),void 0!==r.internalFormat&&(this.internalFormat=r.internalFormat),void 0!==r.encoding&&(this.encoding=r.encoding),void 0!==r.type&&(this.type=r.type),void 0!==r.flipY&&(this.flipY=r.flipY),void 0!==r.premultiplyAlpha&&(this.premultiplyAlpha=r.premultiplyAlpha),void 0!==r.unpackAlignment&&(this.unpackAlignment=r.unpackAlignment),void 0!==r.minFilter&&(this.minFilter=r.minFilter),void 0!==r.magFilter&&(this.magFilter=r.magFilter),void 0!==r.wrapS&&(this.wrapS=r.wrapS),void 0!==r.wrapT&&(this.wrapT=r.wrapT),void 0!==r.wrapR&&(this.wrapR=r.wrapR),i.bindTexture(this.target,this.texture),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,this.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,this.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,i.NONE);var a=U(i,this.minFilter);i.texParameteri(this.target,i.TEXTURE_MIN_FILTER,a);var n=U(i,this.magFilter);n&&i.texParameteri(this.target,i.TEXTURE_MAG_FILTER,n);var s=U(i,this.wrapS);s&&i.texParameteri(this.target,i.TEXTURE_WRAP_S,s);var _=U(i,this.wrapT);_&&i.texParameteri(this.target,i.TEXTURE_WRAP_T,_);var o=U(i,this.format,this.encoding),h=U(i,this.type),E=N(i,this.internalFormat,o,h,this.encoding,!1);if(this.target===i.TEXTURE_CUBE_MAP){if(t.isArray(e))for(var T=e,l=[i.TEXTURE_CUBE_MAP_POSITIVE_X,i.TEXTURE_CUBE_MAP_NEGATIVE_X,i.TEXTURE_CUBE_MAP_POSITIVE_Y,i.TEXTURE_CUBE_MAP_NEGATIVE_Y,i.TEXTURE_CUBE_MAP_POSITIVE_Z,i.TEXTURE_CUBE_MAP_NEGATIVE_Z],R=0,u=l.length;R<u;R++)i.texImage2D(l[R],0,E,o,h,T[R])}else i.texImage2D(i.TEXTURE_2D,0,E,o,h,e);i.bindTexture(this.target,null)},i.setCompressedData=function(t){var r=this.gl,i=t.mipmaps||[],a=i.length,n=t.props;void 0!==n.format&&(this.format=n.format),void 0!==n.internalFormat&&(this.internalFormat=n.internalFormat),void 0!==n.encoding&&(this.encoding=n.encoding),void 0!==n.type&&(this.type=n.type),void 0!==n.flipY&&(this.flipY=n.flipY),void 0!==n.premultiplyAlpha&&(this.premultiplyAlpha=n.premultiplyAlpha),void 0!==n.unpackAlignment&&(this.unpackAlignment=n.unpackAlignment),void 0!==n.minFilter&&(this.minFilter=n.minFilter),void 0!==n.magFilter&&(this.magFilter=n.magFilter),void 0!==n.wrapS&&(this.wrapS=n.wrapS),void 0!==n.wrapT&&(this.wrapT=n.wrapT),void 0!==n.wrapR&&(this.wrapR=n.wrapR),r.activeTexture(r.TEXTURE0+0),r.bindTexture(this.target,this.texture);var s=i.length>1;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,this.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,this.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.NONE);var _=U(r,this.wrapS);_&&r.texParameteri(this.target,r.TEXTURE_WRAP_S,_);var o=U(r,this.wrapT);if(o&&r.texParameteri(this.target,r.TEXTURE_WRAP_T,o),this.type===r.TEXTURE_3D||this.type===r.TEXTURE_2D_ARRAY){var h=U(r,this.wrapR);h&&r.texParameteri(this.target,r.TEXTURE_WRAP_R,h),r.texParameteri(this.type,r.TEXTURE_WRAP_R,h)}s?(r.texParameteri(this.target,r.TEXTURE_MIN_FILTER,b(r,this.minFilter)),r.texParameteri(this.target,r.TEXTURE_MAG_FILTER,b(r,this.magFilter))):(r.texParameteri(this.target,r.TEXTURE_MIN_FILTER,U(r,this.minFilter)),r.texParameteri(this.target,r.TEXTURE_MAG_FILTER,U(r,this.magFilter)));var E=U(r,this.format,this.encoding),T=U(r,this.type),l=N(r,this.internalFormat,E,T,this.encoding,!1);r.texStorage2D(r.TEXTURE_2D,a,l,i[0].width,i[0].height);for(var R=0,u=i.length;R<u;R++){var d=i[R];this.format!==e.RGBAFormat?null!==E?r.compressedTexSubImage2D(r.TEXTURE_2D,R,0,0,d.width,d.height,E,d.data):console.warn("Attempt to load unsupported compressed texture format in .setCompressedData()"):r.texSubImage2D(r.TEXTURE_2D,R,0,0,d.width,d.height,E,T,d.data)}r.bindTexture(this.target,null)},i.setProps=function(t){var e=this.gl;e.bindTexture(this.target,this.texture),this._uploadProps(t),e.bindTexture(this.target,null)},i._uploadProps=function(t){var e=this.gl;if(void 0!==t.format&&(this.format=t.format),void 0!==t.internalFormat&&(this.internalFormat=t.internalFormat),void 0!==t.encoding&&(this.encoding=t.encoding),void 0!==t.type&&(this.type=t.type),void 0!==t.minFilter){var r=U(e,t.minFilter);r&&(this.minFilter=t.minFilter,e.texParameteri(this.target,e.TEXTURE_MIN_FILTER,r),r!==e.NEAREST_MIPMAP_NEAREST&&r!==e.LINEAR_MIPMAP_NEAREST&&r!==e.NEAREST_MIPMAP_LINEAR&&r!==e.LINEAR_MIPMAP_LINEAR||e.generateMipmap(this.target))}if(void 0!==t.magFilter){var i=U(e,t.magFilter);i&&(this.magFilter=t.magFilter,e.texParameteri(this.target,e.TEXTURE_MAG_FILTER,i))}if(void 0!==t.wrapS){var a=U(e,t.wrapS);a&&(this.wrapS=t.wrapS,e.texParameteri(this.target,e.TEXTURE_WRAP_S,a))}if(void 0!==t.wrapT){var n=U(e,t.wrapT);n&&(this.wrapT=t.wrapT,e.texParameteri(this.target,e.TEXTURE_WRAP_T,n))}},i.bind=function(t){if(!this.allocated)return!1;if(this.texture){var e=this.gl;return e.activeTexture(e["TEXTURE"+t]),e.bindTexture(this.target,this.texture),!0}return!1},i.unbind=function(t){if(this.allocated&&this.texture){var e=this.gl;e.activeTexture(e["TEXTURE"+t]),e.bindTexture(this.target,null)}},i.destroy=function(){this.allocated&&this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null)},r}();function N(t,r,i,a,n,s){if(void 0===s&&(s=!1),null!==r){if(void 0!==t[r])return t[r];console.warn("Attempt to use non-existing WebGL internal format '"+r+"'")}var _=i;return i===t.RED&&(a===t.FLOAT&&(_=t.R32F),a===t.HALF_FLOAT&&(_=t.R16F),a===t.UNSIGNED_BYTE&&(_=t.R8)),i===t.RG&&(a===t.FLOAT&&(_=t.RG32F),a===t.HALF_FLOAT&&(_=t.RG16F),a===t.UNSIGNED_BYTE&&(_=t.RG8)),i===t.RGBA&&(a===t.FLOAT&&(_=t.RGBA32F),a===t.HALF_FLOAT&&(_=t.RGBA16F),a===t.UNSIGNED_BYTE&&(_=n===e.sRGBEncoding&&!1===s?t.SRGB8_ALPHA8:t.RGBA8),a===t.UNSIGNED_SHORT_4_4_4_4&&(_=t.RGBA4),a===t.UNSIGNED_SHORT_5_5_5_1&&(_=t.RGB5_A1)),_!==t.R16F&&_!==t.R32F&&_!==t.RG16F&&_!==t.RG32F&&_!==t.RGBA16F&&_!==t.RGBA32F||M(t,"EXT_color_buffer_float"),_}function b(t,r){return r===e.NearestFilter||r===e.NearestMipmapNearestFilter||r===e.NearestMipmapLinearFilter?t.NEAREST:t.LINEAR}var L={WEBGL:!1,SUPPORTED_EXTENSIONS:{}},X=document.createElement("canvas");if(X){var O=X.getContext("webgl2",{antialias:!0});L.WEBGL=!!O,L.WEBGL&&(L.ANTIALIAS=O.getContextAttributes().antialias,L.FS_MAX_FLOAT_PRECISION=O.getShaderPrecisionFormat?O.getShaderPrecisionFormat(O.FRAGMENT_SHADER,O.HIGH_FLOAT).precision>0?"highp":O.getShaderPrecisionFormat(O.FRAGMENT_SHADER,O.MEDIUM_FLOAT).precision>0?"mediump":"lowp":"mediump",L.DEPTH_BUFFER_BITS=O.getParameter(O.DEPTH_BITS),L.MAX_TEXTURE_SIZE=O.getParameter(O.MAX_TEXTURE_SIZE),L.MAX_CUBE_MAP_SIZE=O.getParameter(O.MAX_CUBE_MAP_TEXTURE_SIZE),L.MAX_RENDERBUFFER_SIZE=O.getParameter(O.MAX_RENDERBUFFER_SIZE),L.MAX_TEXTURE_UNITS=O.getParameter(O.MAX_COMBINED_TEXTURE_IMAGE_UNITS),L.MAX_TEXTURE_IMAGE_UNITS=O.getParameter(O.MAX_TEXTURE_IMAGE_UNITS),L.MAX_VERTEX_ATTRIBS=O.getParameter(O.MAX_VERTEX_ATTRIBS),L.MAX_VERTEX_UNIFORM_VECTORS=O.getParameter(O.MAX_VERTEX_UNIFORM_VECTORS),L.MAX_FRAGMENT_UNIFORM_VECTORS=O.getParameter(O.MAX_FRAGMENT_UNIFORM_VECTORS),L.MAX_VARYING_VECTORS=O.getParameter(O.MAX_VARYING_VECTORS),O.getSupportedExtensions().forEach(function(t){L.SUPPORTED_EXTENSIONS[t]=!0}),L.depthTexturesSupported=L.SUPPORTED_EXTENSIONS.WEBGL_depth_texture)}exports.Canvas2Image=u,exports.GLArrayBuf=r,exports.GLAttribute=i,exports.GLDataTexture=o,exports.GLProgram=l,exports.GLRenderBuffer=v,exports.GLSampler=E,exports.GLShader=h,exports.GLTexture=D,exports.WEBGL_INFO=L,exports.convertConstant=U,exports.getExtension=M;
//# sourceMappingURL=index.js.map
